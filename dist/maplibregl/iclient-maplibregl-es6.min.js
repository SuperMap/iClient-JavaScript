/*!
 * 
 *          iclient-maplibregl
 *          CopyrightÂ© 2000 - 2024 SuperMap Software Co.Ltd
 *          license: Apache-2.0
 *          version: v11.1.2
 *
 */(()=>{var t={444:function(t){!function(e){"use strict";if(e.__disableNativeFetch||!e.fetch){o.prototype.append=function(t,e){t=n(t),e=a(e);var r=this.map[t];r||(r=[],this.map[t]=r),r.push(e)},o.prototype.delete=function(t){delete this.map[n(t)]},o.prototype.get=function(t){var e=this.map[n(t)];return e?e[0]:null},o.prototype.getAll=function(t){return this.map[n(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(n(t))},o.prototype.set=function(t,e){this.map[n(t)]=[a(e)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(s){t.call(e,s,r,this)},this)},this)};var r={blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e},s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},c.call(d.prototype),c.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var i=[301,302,303,307,308];f.redirect=function(t,e){if(-1===i.indexOf(e))throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},e.Headers=o,e.Request=d,e.Response=f,e.fetch=function(t,e){return new Promise(function(s,i){var n;n=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var a=new XMLHttpRequest;var l=!1;function h(){if(4===a.readyState){var t=1223===a.status?204:a.status;if(t<100||t>599){if(l)return;return l=!0,void i(new TypeError("Network request failed"))}var e={status:t,statusText:a.statusText,headers:function(t){var e=new o;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var r=t.trim().split(":"),s=r.shift().trim(),i=r.join(":").trim();e.append(s,i)}),e}(a),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},r="response"in a?a.response:a.responseText;l||(l=!0,s(new f(r,e)))}}a.onreadystatechange=h,a.onload=h,a.onerror=function(){l||(l=!0,i(new TypeError("Network request failed")))},a.open(n.method,n.url,!0);try{"include"===n.credentials&&("withCredentials"in a?a.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(t){console&&console.warn&&console.warn("set withCredentials error:"+t)}"responseType"in a&&r.blob&&(a.responseType="blob"),n.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===n._bodyInit?null:n._bodyInit)})},e.fetch.polyfill=!0,t.exports&&(t.exports=e.fetch)}function n(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function a(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function h(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function u(t){var e=new FileReader;return e.readAsArrayBuffer(t),h(e)}function c(){return this.bodyUsed=!1,this._initBody=function(t,e){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(r.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t,this._options=e;else if(r.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!r.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText=""},r.blob?(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var t,e,r,s,i,n,a,o=l(this);if(o)return o;if(this._bodyBlob)return t=this._bodyBlob,e=this._options,r=new FileReader,s=e.headers.map["content-type"]?e.headers.map["content-type"].toString():"",i=/charset\=[0-9a-zA-Z\-\_]*;?/,n=t.type.match(i)||s.match(i),a=[t],n&&a.push(n[0].replace(/^charset\=/,"").replace(/;$/,"")),r.readAsText.apply(r,a),h(r);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=l(this);return t||Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t,e){var r,i,n=(e=e||{}).body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=(r=e.method||this.method||"GET",i=r.toUpperCase(),s.indexOf(i)>-1?i:r),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n,e)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(i))}}),e}function f(t,e){e||(e={}),this._initBody(t,e),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||""}}("undefined"!=typeof self?self:this)},348:function(t,e){var r,s,i;s=[e,t],void 0===(i="function"==typeof(r=function(t,e){"use strict";var r={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function s(t){try{delete window[t]}catch(e){window[t]=void 0}}function i(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}e.exports=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t,a=e.timeout||r.timeout,o=e.jsonpCallback||r.jsonpCallback,l=void 0;return new Promise(function(r,h){var u=e.jsonpCallbackFunction||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),c=o+"_"+u;window[u]=function(t){r({ok:!0,json:function(){return Promise.resolve(t)}}),l&&clearTimeout(l),i(c),s(u)},n+=-1===n.indexOf("?")?"?":"&";var d=document.createElement("script");d.setAttribute("src",""+n+o+"="+u),e.charset&&d.setAttribute("charset",e.charset),d.id=c,document.getElementsByTagName("head")[0].appendChild(d),l=setTimeout(function(){h(new Error("JSONP request to "+t+" timed out")),s(u),i(c),window[u]=function(){s(u)}},a),d.onerror=function(){h(new Error("JSONP request to "+t+" failed")),s(u),i(c),l&&clearTimeout(l)}})}})?r.apply(e,s):r)||(t.exports=i)},238:t=>{var e=[],r=[],s="insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).";function i(t,i){if(i=i||{},void 0===t)throw new Error(s);var n,a=!0===i.prepend?"prepend":"append",o=void 0!==i.container?i.container:document.querySelector("head"),l=e.indexOf(o);return-1===l&&(l=e.push(o)-1,r[l]={}),void 0!==r[l]&&void 0!==r[l][a]?n=r[l][a]:(n=r[l][a]=function(){var t=document.createElement("style");return t.setAttribute("type","text/css"),t}(),"prepend"===a?o.insertBefore(n,o.childNodes[0]):o.appendChild(n)),65279===t.charCodeAt(0)&&(t=t.substr(1,t.length)),n.styleSheet?n.styleSheet.cssText+=t:n.textContent+=t,n}t.exports=i,t.exports.insertCss=i},574:(t,e,r)=>{t=r.nmd(t);var s=200,i="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",o="[object Boolean]",l="[object Date]",h="[object Function]",u="[object GeneratorFunction]",c="[object Map]",d="[object Number]",p="[object Object]",f="[object RegExp]",m="[object Set]",y="[object String]",g="[object Symbol]",v="[object ArrayBuffer]",b="[object DataView]",S="[object Float32Array]",_="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",A="[object Int32Array]",M="[object Uint8Array]",C="[object Uint8ClampedArray]",E="[object Uint16Array]",T="[object Uint32Array]",O=/\w*$/,P=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,I={};I[a]=I["[object Array]"]=I[v]=I[b]=I[o]=I[l]=I[S]=I[_]=I[x]=I[w]=I[A]=I[c]=I[d]=I[p]=I[f]=I[m]=I[y]=I[g]=I[M]=I[C]=I[E]=I[T]=!0,I["[object Error]"]=I[h]=I["[object WeakMap]"]=!1;var N="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,k="object"==typeof self&&self&&self.Object===Object&&self,R=N||k||Function("return this")(),D=e&&!e.nodeType&&e,F=D&&t&&!t.nodeType&&t,B=F&&F.exports===D;function G(t,e){return t.set(e[0],e[1]),t}function j(t,e){return t.add(e),t}function U(t,e,r,s){var i=-1,n=t?t.length:0;for(s&&n&&(r=t[++i]);++i<n;)r=e(r,t[i],i,t);return r}function J(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function z(t){var e=-1,r=Array(t.size);return t.forEach(function(t,s){r[++e]=[s,t]}),r}function q(t,e){return function(r){return t(e(r))}}function V(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var H=Array.prototype,W=Function.prototype,Q=Object.prototype,Y=R["__core-js_shared__"],X=function(){var t=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=W.toString,K=Q.hasOwnProperty,$=Q.toString,tt=RegExp("^"+Z.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=B?R.Buffer:void 0,rt=R.Symbol,st=R.Uint8Array,it=q(Object.getPrototypeOf,Object),nt=Object.create,at=Q.propertyIsEnumerable,ot=H.splice,lt=Object.getOwnPropertySymbols,ht=et?et.isBuffer:void 0,ut=q(Object.keys,Object),ct=Dt(R,"DataView"),dt=Dt(R,"Map"),pt=Dt(R,"Promise"),ft=Dt(R,"Set"),mt=Dt(R,"WeakMap"),yt=Dt(Object,"create"),gt=Ut(ct),vt=Ut(dt),bt=Ut(pt),St=Ut(ft),_t=Ut(mt),xt=rt?rt.prototype:void 0,wt=xt?xt.valueOf:void 0;function At(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Mt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Et(t){this.__data__=new Mt(t)}function Tt(t,e){var r=zt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&qt(t)}(t)&&K.call(t,"callee")&&(!at.call(t,"callee")||$.call(t)==a)}(t)?function(t,e){for(var r=-1,s=Array(t);++r<t;)s[r]=e(r);return s}(t.length,String):[],s=r.length,i=!!s;for(var n in t)!e&&!K.call(t,n)||i&&("length"==n||Gt(n,s))||r.push(n);return r}function Ot(t,e,r){var s=t[e];K.call(t,e)&&Jt(s,r)&&(void 0!==r||e in t)||(t[e]=r)}function Pt(t,e){for(var r=t.length;r--;)if(Jt(t[r][0],e))return r;return-1}function Lt(t,e,r,s,i,n,P){var L;if(s&&(L=n?s(t,i,n,P):s(t)),void 0!==L)return L;if(!Wt(t))return t;var N=zt(t);if(N){if(L=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&K.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!e)return function(t,e){var r=-1,s=t.length;e||(e=Array(s));for(;++r<s;)e[r]=t[r];return e}(t,L)}else{var k=Bt(t),R=k==h||k==u;if(Vt(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if(k==p||k==a||R&&!n){if(J(t))return n?t:{};if(L=function(t){return"function"!=typeof t.constructor||jt(t)?{}:(e=it(t),Wt(e)?nt(e):{});var e}(R?{}:t),!e)return function(t,e){return kt(t,Ft(t),e)}(t,function(t,e){return t&&kt(e,Qt(e),t)}(L,t))}else{if(!I[k])return n?t:{};L=function(t,e,r,s){var i=t.constructor;switch(e){case v:return Nt(t);case o:case l:return new i(+t);case b:return function(t,e){var r=e?Nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,s);case S:case _:case x:case w:case A:case M:case C:case E:case T:return function(t,e){var r=e?Nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,s);case c:return function(t,e,r){return U(e?r(z(t),!0):z(t),G,new t.constructor)}(t,s,r);case d:case y:return new i(t);case f:return(h=new(a=t).constructor(a.source,O.exec(a))).lastIndex=a.lastIndex,h;case m:return function(t,e,r){return U(e?r(V(t),!0):V(t),j,new t.constructor)}(t,s,r);case g:return n=t,wt?Object(wt.call(n)):{}}var n;var a,h}(t,k,Lt,e)}}P||(P=new Et);var D=P.get(t);if(D)return D;if(P.set(t,L),!N)var F=r?function(t){return function(t,e,r){var s=e(t);return zt(t)?s:function(t,e){for(var r=-1,s=e.length,i=t.length;++r<s;)t[i+r]=e[r];return t}(s,r(t))}(t,Qt,Ft)}(t):Qt(t);return function(t,e){for(var r=-1,s=t?t.length:0;++r<s&&!1!==e(t[r],r,t););}(F||t,function(i,n){F&&(i=t[n=i]),Ot(L,n,Lt(i,e,r,s,n,t,P))}),L}function It(t){return!(!Wt(t)||X&&X in t)&&(Ht(t)||J(t)?tt:P).test(Ut(t))}function Nt(t){var e=new t.constructor(t.byteLength);return new st(e).set(new st(t)),e}function kt(t,e,r,s){r||(r={});for(var i=-1,n=e.length;++i<n;){var a=e[i],o=s?s(r[a],t[a],a,r,t):void 0;Ot(r,a,void 0===o?t[a]:o)}return r}function Rt(t,e){var r,s,i=t.__data__;return("string"==(s=typeof(r=e))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function Dt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return It(r)?r:void 0}At.prototype.clear=function(){this.__data__=yt?yt(null):{}},At.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},At.prototype.get=function(t){var e=this.__data__;if(yt){var r=e[t];return r===i?void 0:r}return K.call(e,t)?e[t]:void 0},At.prototype.has=function(t){var e=this.__data__;return yt?void 0!==e[t]:K.call(e,t)},At.prototype.set=function(t,e){return this.__data__[t]=yt&&void 0===e?i:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,r=Pt(e,t);return!(r<0||(r==e.length-1?e.pop():ot.call(e,r,1),0))},Mt.prototype.get=function(t){var e=this.__data__,r=Pt(e,t);return r<0?void 0:e[r][1]},Mt.prototype.has=function(t){return Pt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var r=this.__data__,s=Pt(r,t);return s<0?r.push([t,e]):r[s][1]=e,this},Ct.prototype.clear=function(){this.__data__={hash:new At,map:new(dt||Mt),string:new At}},Ct.prototype.delete=function(t){return Rt(this,t).delete(t)},Ct.prototype.get=function(t){return Rt(this,t).get(t)},Ct.prototype.has=function(t){return Rt(this,t).has(t)},Ct.prototype.set=function(t,e){return Rt(this,t).set(t,e),this},Et.prototype.clear=function(){this.__data__=new Mt},Et.prototype.delete=function(t){return this.__data__.delete(t)},Et.prototype.get=function(t){return this.__data__.get(t)},Et.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Mt){var i=r.__data__;if(!dt||i.length<s-1)return i.push([t,e]),this;r=this.__data__=new Ct(i)}return r.set(t,e),this};var Ft=lt?q(lt,Object):function(){return[]},Bt=function(t){return $.call(t)};function Gt(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||L.test(t))&&t>-1&&t%1==0&&t<e}function jt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Q)}function Ut(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Jt(t,e){return t===e||t!=t&&e!=e}(ct&&Bt(new ct(new ArrayBuffer(1)))!=b||dt&&Bt(new dt)!=c||pt&&"[object Promise]"!=Bt(pt.resolve())||ft&&Bt(new ft)!=m||mt&&"[object WeakMap]"!=Bt(new mt))&&(Bt=function(t){var e=$.call(t),r=e==p?t.constructor:void 0,s=r?Ut(r):void 0;if(s)switch(s){case gt:return b;case vt:return c;case bt:return"[object Promise]";case St:return m;case _t:return"[object WeakMap]"}return e});var zt=Array.isArray;function qt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!Ht(t)}var Vt=ht||function(){return!1};function Ht(t){var e=Wt(t)?$.call(t):"";return e==h||e==u}function Wt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Qt(t){return qt(t)?Tt(t):function(t){if(!jt(t))return ut(t);var e=[];for(var r in Object(t))K.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}t.exports=function(t){return Lt(t,!0,!0)}},858:(t,e,r)=>{var s="Expected a function",i=NaN,n="[object Symbol]",a=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,h=/^0o[0-7]+$/i,u=parseInt,c="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,d="object"==typeof self&&self&&self.Object===Object&&self,p=c||d||Function("return this")(),f=Object.prototype.toString,m=Math.max,y=Math.min,g=function(){return p.Date.now()};function v(t,e,r){var i,n,a,o,l,h,u=0,c=!1,d=!1,p=!0;if("function"!=typeof t)throw new TypeError(s);function f(e){var r=i,s=n;return i=n=void 0,u=e,o=t.apply(s,r)}function v(t){var r=t-h;return void 0===h||r>=e||r<0||d&&t-u>=a}function _(){var t=g();if(v(t))return x(t);l=setTimeout(_,function(t){var r=e-(t-h);return d?y(r,a-(t-u)):r}(t))}function x(t){return l=void 0,p&&i?f(t):(i=n=void 0,o)}function w(){var t=g(),r=v(t);if(i=arguments,n=this,h=t,r){if(void 0===l)return function(t){return u=t,l=setTimeout(_,e),c?f(t):o}(h);if(d)return l=setTimeout(_,e),f(h)}return void 0===l&&(l=setTimeout(_,e)),o}return e=S(e)||0,b(r)&&(c=!!r.leading,a=(d="maxWait"in r)?m(S(r.maxWait)||0,e):a,p="trailing"in r?!!r.trailing:p),w.cancel=function(){void 0!==l&&clearTimeout(l),u=0,i=h=n=l=void 0},w.flush=function(){return void 0===l?o:x(g())},w}function b(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function S(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&f.call(t)==n}(t))return i;if(b(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=b(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var r=l.test(t);return r||h.test(t)?u(t.slice(2),r?2:8):o.test(t)?i:+t}t.exports=function(t,e,r){var i=!0,n=!0;if("function"!=typeof t)throw new TypeError(s);return b(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),v(t,e,{leading:i,maxWait:e,trailing:n})}},388:(t,e,r)=>{var s=9007199254740991,i="[object Arguments]",n="[object Function]",a="[object GeneratorFunction]",o="[object Map]",l="[object Set]",h=/^\[object .+?Constructor\]$/,u=/^(?:0|[1-9]\d*)$/,c="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,d="object"==typeof self&&self&&self.Object===Object&&self,p=c||d||Function("return this")();function f(t,e){return function(t,e){for(var r=-1,s=t?t.length:0,i=Array(s);++r<s;)i[r]=e(t[r],r,t);return i}(e,function(e){return[e,t[e]]})}var m=Function.prototype,y=Object.prototype,g=p["__core-js_shared__"],v=function(){var t=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),b=m.toString,S=y.hasOwnProperty,_=y.toString,x=RegExp("^"+b.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=y.propertyIsEnumerable,A=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),M=B(p,"DataView"),C=B(p,"Map"),E=B(p,"Promise"),T=B(p,"Set"),O=B(p,"WeakMap"),P=U(M),L=U(C),I=U(E),N=U(T),k=U(O);function R(t,e){var r=J(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&z(t)}(t)&&S.call(t,"callee")&&(!w.call(t,"callee")||_.call(t)==i)}(t)?function(t,e){for(var r=-1,s=Array(t);++r<t;)s[r]=e(r);return s}(t.length,String):[],s=r.length,n=!!s;for(var a in t)!e&&!S.call(t,a)||n&&("length"==a||j(a,s))||r.push(a);return r}function D(t){return!(!V(t)||v&&v in t)&&(q(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?x:h).test(U(t))}function F(t){if(r=(e=t)&&e.constructor,s="function"==typeof r&&r.prototype||y,e!==s)return A(t);var e,r,s,i=[];for(var n in Object(t))S.call(t,n)&&"constructor"!=n&&i.push(n);return i}function B(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return D(r)?r:void 0}var G=function(t){return _.call(t)};function j(t,e){return!!(e=null==e?s:e)&&("number"==typeof t||u.test(t))&&t>-1&&t%1==0&&t<e}function U(t){if(null!=t){try{return b.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(M&&"[object DataView]"!=G(new M(new ArrayBuffer(1)))||C&&G(new C)!=o||E&&"[object Promise]"!=G(E.resolve())||T&&G(new T)!=l||O&&"[object WeakMap]"!=G(new O))&&(G=function(t){var e=_.call(t),r="[object Object]"==e?t.constructor:void 0,s=r?U(r):void 0;if(s)switch(s){case P:return"[object DataView]";case L:return o;case I:return"[object Promise]";case N:return l;case k:return"[object WeakMap]"}return e});var J=Array.isArray;function z(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=s}(t.length)&&!q(t)}function q(t){var e=V(t)?_.call(t):"";return e==n||e==a}function V(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var H=function(t){return function(e){var r,s,i,n=G(e);return n==o?(r=e,s=-1,i=Array(r.size),r.forEach(function(t,e){i[++s]=[e,t]}),i):n==l?function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=[t,t]}),r}(e):f(e,t(e))}}(function(t){return z(t)?R(t):F(t)});t.exports=H},234:(t,e,r)=>{t=r.nmd(t);var s=200,i="Expected a function",n="__lodash_hash_undefined__",a=1,o=2,l=1/0,h=9007199254740991,u="[object Arguments]",c="[object Array]",d="[object Boolean]",p="[object Date]",f="[object Error]",m="[object Function]",y="[object GeneratorFunction]",g="[object Map]",v="[object Number]",b="[object Object]",S="[object RegExp]",_="[object Set]",x="[object String]",w="[object Symbol]",A="[object ArrayBuffer]",M="[object DataView]",C=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,E=/^\w*$/,T=/^\./,O=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,P=/\\(\\)?/g,L=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[u]=N[c]=N[A]=N[d]=N[M]=N[p]=N[f]=N[m]=N[g]=N[v]=N[b]=N[S]=N[_]=N[x]=N["[object WeakMap]"]=!1;var k="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,R="object"==typeof self&&self&&self.Object===Object&&self,D=k||R||Function("return this")(),F=e&&!e.nodeType&&e,B=F&&t&&!t.nodeType&&t,G=B&&B.exports===F&&k.process,j=function(){try{return G&&G.binding("util")}catch(t){}}(),U=j&&j.isTypedArray;function J(t,e){return!!(t?t.length:0)&&function(t,e,r){if(e!=e)return function(t,e,r,s){var i=t.length,n=r+(s?1:-1);for(;s?n--:++n<i;)if(e(t[n],n,t))return n;return-1}(t,V,r);var s=r-1,i=t.length;for(;++s<i;)if(t[s]===e)return s;return-1}(t,e,0)>-1}function z(t,e,r){for(var s=-1,i=t?t.length:0;++s<i;)if(r(e,t[s]))return!0;return!1}function q(t,e){for(var r=-1,s=t?t.length:0;++r<s;)if(e(t[r],r,t))return!0;return!1}function V(t){return t!=t}function H(t,e){return t.has(e)}function W(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function Q(t){var e=-1,r=Array(t.size);return t.forEach(function(t,s){r[++e]=[s,t]}),r}function Y(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var X=Array.prototype,Z=Function.prototype,K=Object.prototype,$=D["__core-js_shared__"],tt=function(){var t=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),et=Z.toString,rt=K.hasOwnProperty,st=K.toString,it=RegExp("^"+et.call(rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=D.Symbol,at=D.Uint8Array,ot=K.propertyIsEnumerable,lt=X.splice,ht=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),ut=Ut(D,"DataView"),ct=Ut(D,"Map"),dt=Ut(D,"Promise"),pt=Ut(D,"Set"),ft=Ut(D,"WeakMap"),mt=Ut(Object,"create"),yt=Yt(ut),gt=Yt(ct),vt=Yt(dt),bt=Yt(pt),St=Yt(ft),_t=nt?nt.prototype:void 0,xt=_t?_t.valueOf:void 0,wt=_t?_t.toString:void 0;function At(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Mt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Et(t){var e=-1,r=t?t.length:0;for(this.__data__=new Ct;++e<r;)this.add(t[e])}function Tt(t){this.__data__=new Mt(t)}function Ot(t,e){var r=$t(t)||Kt(t)?function(t,e){for(var r=-1,s=Array(t);++r<t;)s[r]=e(r);return s}(t.length,String):[],s=r.length,i=!!s;for(var n in t)!e&&!rt.call(t,n)||i&&("length"==n||zt(n,s))||r.push(n);return r}function Pt(t,e){for(var r=t.length;r--;)if(Zt(t[r][0],e))return r;return-1}function Lt(t,e){for(var r=0,s=(e=qt(e,t)?[e]:Ft(e)).length;null!=t&&r<s;)t=t[Qt(e[r++])];return r&&r==s?t:void 0}function It(t,e){return null!=t&&e in Object(t)}function Nt(t,e,r,s,i){return t===e||(null==t||null==e||!se(t)&&!ie(e)?t!=t&&e!=e:function(t,e,r,s,i,n){var l=$t(t),h=$t(e),m=c,y=c;l||(m=(m=Jt(t))==u?b:m);h||(y=(y=Jt(e))==u?b:y);var C=m==b&&!W(t),E=y==b&&!W(e),T=m==y;if(T&&!C)return n||(n=new Tt),l||ae(t)?Gt(t,e,r,s,i,n):function(t,e,r,s,i,n,l){switch(r){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case A:return!(t.byteLength!=e.byteLength||!s(new at(t),new at(e)));case d:case p:case v:return Zt(+t,+e);case f:return t.name==e.name&&t.message==e.message;case S:case x:return t==e+"";case g:var h=Q;case _:var u=n&o;if(h||(h=Y),t.size!=e.size&&!u)return!1;var c=l.get(t);if(c)return c==e;n|=a,l.set(t,e);var m=Gt(h(t),h(e),s,i,n,l);return l.delete(t),m;case w:if(xt)return xt.call(t)==xt.call(e)}return!1}(t,e,m,r,s,i,n);if(!(i&o)){var O=C&&rt.call(t,"__wrapped__"),P=E&&rt.call(e,"__wrapped__");if(O||P){var L=O?t.value():t,I=P?e.value():e;return n||(n=new Tt),r(L,I,s,i,n)}}if(!T)return!1;return n||(n=new Tt),function(t,e,r,s,i,n){var a=i&o,l=oe(t),h=l.length,u=oe(e).length;if(h!=u&&!a)return!1;for(var c=h;c--;){var d=l[c];if(!(a?d in e:rt.call(e,d)))return!1}var p=n.get(t);if(p&&n.get(e))return p==e;var f=!0;n.set(t,e),n.set(e,t);for(var m=a;++c<h;){d=l[c];var y=t[d],g=e[d];if(s)var v=a?s(g,y,d,e,t,n):s(y,g,d,t,e,n);if(!(void 0===v?y===g||r(y,g,s,i,n):v)){f=!1;break}m||(m="constructor"==d)}if(f&&!m){var b=t.constructor,S=e.constructor;b!=S&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(f=!1)}return n.delete(t),n.delete(e),f}(t,e,r,s,i,n)}(t,e,Nt,r,s,i))}function kt(t){return!(!se(t)||tt&&tt in t)&&(ee(t)||W(t)?it:L).test(Yt(t))}function Rt(t){return"function"==typeof t?t:null==t?le:"object"==typeof t?$t(t)?function(t,e){if(qt(t)&&Vt(e))return Ht(Qt(t),e);return function(r){var s=function(t,e,r){var s=null==t?void 0:Lt(t,e);return void 0===s?r:s}(r,t);return void 0===s&&s===e?function(t,e){return null!=t&&function(t,e,r){var s,i=-1,n=(e=qt(e,t)?[e]:Ft(e)).length;for(;++i<n;){var a=Qt(e[i]);if(!(s=null!=t&&r(t,a)))break;t=t[a]}if(s)return s;return!!(n=t?t.length:0)&&re(n)&&zt(a,n)&&($t(t)||Kt(t))}(t,e,It)}(r,t):Nt(e,s,void 0,a|o)}}(t[0],t[1]):function(t){var e=function(t){var e=oe(t),r=e.length;for(;r--;){var s=e[r],i=t[s];e[r]=[s,i,Vt(i)]}return e}(t);if(1==e.length&&e[0][2])return Ht(e[0][0],e[0][1]);return function(r){return r===t||function(t,e,r,s){var i=r.length,n=i,l=!s;if(null==t)return!n;for(t=Object(t);i--;){var h=r[i];if(l&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++i<n;){var u=(h=r[i])[0],c=t[u],d=h[1];if(l&&h[2]){if(void 0===c&&!(u in t))return!1}else{var p=new Tt;if(s)var f=s(c,d,u,t,e,p);if(!(void 0===f?Nt(d,c,s,a|o,p):f))return!1}}return!0}(r,t,e)}}(t):qt(e=t)?(r=Qt(e),function(t){return null==t?void 0:t[r]}):function(t){return function(e){return Lt(e,t)}}(e);var e,r}function Dt(t){if(r=(e=t)&&e.constructor,s="function"==typeof r&&r.prototype||K,e!==s)return ht(t);var e,r,s,i=[];for(var n in Object(t))rt.call(t,n)&&"constructor"!=n&&i.push(n);return i}function Ft(t){return $t(t)?t:Wt(t)}At.prototype.clear=function(){this.__data__=mt?mt(null):{}},At.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},At.prototype.get=function(t){var e=this.__data__;if(mt){var r=e[t];return r===n?void 0:r}return rt.call(e,t)?e[t]:void 0},At.prototype.has=function(t){var e=this.__data__;return mt?void 0!==e[t]:rt.call(e,t)},At.prototype.set=function(t,e){return this.__data__[t]=mt&&void 0===e?n:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,r=Pt(e,t);return!(r<0||(r==e.length-1?e.pop():lt.call(e,r,1),0))},Mt.prototype.get=function(t){var e=this.__data__,r=Pt(e,t);return r<0?void 0:e[r][1]},Mt.prototype.has=function(t){return Pt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var r=this.__data__,s=Pt(r,t);return s<0?r.push([t,e]):r[s][1]=e,this},Ct.prototype.clear=function(){this.__data__={hash:new At,map:new(ct||Mt),string:new At}},Ct.prototype.delete=function(t){return jt(this,t).delete(t)},Ct.prototype.get=function(t){return jt(this,t).get(t)},Ct.prototype.has=function(t){return jt(this,t).has(t)},Ct.prototype.set=function(t,e){return jt(this,t).set(t,e),this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,n),this},Et.prototype.has=function(t){return this.__data__.has(t)},Tt.prototype.clear=function(){this.__data__=new Mt},Tt.prototype.delete=function(t){return this.__data__.delete(t)},Tt.prototype.get=function(t){return this.__data__.get(t)},Tt.prototype.has=function(t){return this.__data__.has(t)},Tt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Mt){var i=r.__data__;if(!ct||i.length<s-1)return i.push([t,e]),this;r=this.__data__=new Ct(i)}return r.set(t,e),this};var Bt=pt&&1/Y(new pt([,-0]))[1]==l?function(t){return new pt(t)}:function(){};function Gt(t,e,r,s,i,n){var l=i&o,h=t.length,u=e.length;if(h!=u&&!(l&&u>h))return!1;var c=n.get(t);if(c&&n.get(e))return c==e;var d=-1,p=!0,f=i&a?new Et:void 0;for(n.set(t,e),n.set(e,t);++d<h;){var m=t[d],y=e[d];if(s)var g=l?s(y,m,d,e,t,n):s(m,y,d,t,e,n);if(void 0!==g){if(g)continue;p=!1;break}if(f){if(!q(e,function(t,e){if(!f.has(e)&&(m===t||r(m,t,s,i,n)))return f.add(e)})){p=!1;break}}else if(m!==y&&!r(m,y,s,i,n)){p=!1;break}}return n.delete(t),n.delete(e),p}function jt(t,e){var r,s,i=t.__data__;return("string"==(s=typeof(r=e))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function Ut(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return kt(r)?r:void 0}var Jt=function(t){return st.call(t)};function zt(t,e){return!!(e=null==e?h:e)&&("number"==typeof t||I.test(t))&&t>-1&&t%1==0&&t<e}function qt(t,e){if($t(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!ne(t))||(E.test(t)||!C.test(t)||null!=e&&t in Object(e))}function Vt(t){return t==t&&!se(t)}function Ht(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}(ut&&Jt(new ut(new ArrayBuffer(1)))!=M||ct&&Jt(new ct)!=g||dt&&"[object Promise]"!=Jt(dt.resolve())||pt&&Jt(new pt)!=_||ft&&"[object WeakMap]"!=Jt(new ft))&&(Jt=function(t){var e=st.call(t),r=e==b?t.constructor:void 0,s=r?Yt(r):void 0;if(s)switch(s){case yt:return M;case gt:return g;case vt:return"[object Promise]";case bt:return _;case St:return"[object WeakMap]"}return e});var Wt=Xt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ne(t))return wt?wt.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}(e);var r=[];return T.test(t)&&r.push(""),t.replace(O,function(t,e,s,i){r.push(s?i.replace(P,"$1"):e||t)}),r});function Qt(t){if("string"==typeof t||ne(t))return t;var e=t+"";return"0"==e&&1/t==-l?"-0":e}function Yt(t){if(null!=t){try{return et.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Xt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var r=function(){var s=arguments,i=e?e.apply(this,s):s[0],n=r.cache;if(n.has(i))return n.get(i);var a=t.apply(this,s);return r.cache=n.set(i,a),a};return r.cache=new(Xt.Cache||Ct),r}function Zt(t,e){return t===e||t!=t&&e!=e}function Kt(t){return function(t){return ie(t)&&te(t)}(t)&&rt.call(t,"callee")&&(!ot.call(t,"callee")||st.call(t)==u)}Xt.Cache=Ct;var $t=Array.isArray;function te(t){return null!=t&&re(t.length)&&!ee(t)}function ee(t){var e=se(t)?st.call(t):"";return e==m||e==y}function re(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=h}function se(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function ie(t){return!!t&&"object"==typeof t}function ne(t){return"symbol"==typeof t||ie(t)&&st.call(t)==w}var ae=U?function(t){return function(e){return t(e)}}(U):function(t){return ie(t)&&re(t.length)&&!!N[st.call(t)]};function oe(t){return te(t)?Ot(t):Dt(t)}function le(t){return t}t.exports=function(t,e){return t&&t.length?function(t,e,r){var i=-1,n=J,a=t.length,o=!0,l=[],h=l;if(r)o=!1,n=z;else if(a>=s){var u=e?null:Bt(t);if(u)return Y(u);o=!1,n=H,h=new Et}else h=e?[]:l;t:for(;++i<a;){var c=t[i],d=e?e(c):c;if(c=r||0!==c?c:0,o&&d==d){for(var p=h.length;p--;)if(h[p]===d)continue t;e&&h.push(d),l.push(c)}else n(h,d,r)||(h!==l&&h.push(d),l.push(c))}return l}(t,Rt(e)):[]}},836:function(t,e,r){!function(){"use strict";function t(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})}function e(t){return new this(function(e,r){if(!t||void 0===t.length)return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var s=Array.prototype.slice.call(t);if(0===s.length)return e([]);var i=s.length;function n(t,r){if(r&&("object"==typeof r||"function"==typeof r)){var a=r.then;if("function"==typeof a)return void a.call(r,function(e){n(t,e)},function(r){s[t]={status:"rejected",reason:r},0==--i&&e(s)})}s[t]={status:"fulfilled",value:r},0==--i&&e(s)}for(var a=0;a<s.length;a++)n(a,s[a])})}var s=setTimeout;function i(t){return Boolean(t&&void 0!==t.length)}function n(){}function a(t){if(!(this instanceof a))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,a._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var s;try{s=r(t._value)}catch(t){return void h(e.promise,t)}l(e.promise,s)}else(1===t._state?l:h)(e.promise,t._value)})):t._deferreds.push(e)}function l(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof a)return t._state=3,t._value=e,void u(t);if("function"==typeof r)return void c((s=r,i=e,function(){s.apply(i,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){h(t,e)}var s,i}function h(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&a._immediateFn(function(){t._handled||a._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;e<r;e++)o(t,t._deferreds[e]);t._deferreds=null}function c(t,e){var r=!1;try{t(function(t){r||(r=!0,l(e,t))},function(t){r||(r=!0,h(e,t))})}catch(t){if(r)return;r=!0,h(e,t)}}a.prototype.catch=function(t){return this.then(null,t)},a.prototype.then=function(t,e){var r=new this.constructor(n);return o(this,new function(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}(t,e,r)),r},a.prototype.finally=t,a.all=function(t){return new a(function(e,r){if(!i(t))return r(new TypeError("Promise.all accepts an array"));var s=Array.prototype.slice.call(t);if(0===s.length)return e([]);var n=s.length;function a(t,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var o=i.then;if("function"==typeof o)return void o.call(i,function(e){a(t,e)},r)}s[t]=i,0==--n&&e(s)}catch(t){r(t)}}for(var o=0;o<s.length;o++)a(o,s[o])})},a.allSettled=e,a.resolve=function(t){return t&&"object"==typeof t&&t.constructor===a?t:new a(function(e){e(t)})},a.reject=function(t){return new a(function(e,r){r(t)})},a.race=function(t){return new a(function(e,r){if(!i(t))return r(new TypeError("Promise.race accepts an array"));for(var s=0,n=t.length;s<n;s++)a.resolve(t[s]).then(e,r)})},a._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){s(t,0)},a._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var d=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();"function"!=typeof d.Promise?d.Promise=a:(d.Promise.prototype.finally||(d.Promise.prototype.finally=t),d.Promise.allSettled||(d.Promise.allSettled=e))}()},399:function(t){t.exports=function(){"use strict";function t(t,e,r){var s=t[e];t[e]=t[r],t[r]=s}function e(t,e){return t<e?-1:t>e?1:0}return function(r,s,i,n,a){!function e(r,s,i,n,a){for(;n>i;){if(n-i>600){var o=n-i+1,l=s-i+1,h=Math.log(o),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(o-u)/o)*(l-o/2<0?-1:1),d=Math.max(i,Math.floor(s-l*u/o+c)),p=Math.min(n,Math.floor(s+(o-l)*u/o+c));e(r,s,d,p,a)}var f=r[s],m=i,y=n;for(t(r,i,s),a(r[n],f)>0&&t(r,i,n);m<y;){for(t(r,m,y),m++,y--;a(r[m],f)<0;)m++;for(;a(r[y],f)>0;)y--}0===a(r[i],f)?t(r,i,y):t(r,++y,n),y<=s&&(i=y+1),s<=y&&(n=y-1)}}(r,s,i||0,n||r.length-1,a||e)}}()},519:(t,e,r)=>{"use strict";t.exports=i,t.exports.default=i;var s=r(399);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function n(t,e,r){if(!r)return e.indexOf(t);for(var s=0;s<e.length;s++)if(r(t,e[s]))return s;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,r,s,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var n,a=e;a<r;a++)n=t.children[a],l(i,t.leaf?s(n):n);return i}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,r,i,n){for(var a,o=[e,r];o.length;)(r=o.pop())-(e=o.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,s(t,a,e,r,n),o.push(e,a,a,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],s=this.toBBox;if(!f(t,e))return r;for(var i,n,a,o,l=[];e;){for(i=0,n=e.children.length;i<n;i++)a=e.children[i],f(t,o=e.leaf?s(a):a)&&(e.leaf?r.push(a):p(t,o)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!f(t,e))return!1;for(var s,i,n,a,o=[];e;){for(s=0,i=e.children.length;s<i;s++)if(n=e.children[s],f(t,a=e.leaf?r(n):n)){if(e.leaf||p(t,a))return!0;o.push(n)}e=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var s=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var i=this.data;this.data=s,s=i}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var r,s,i,a,o=this.data,l=this.toBBox(t),h=[],u=[];o||h.length;){if(o||(o=h.pop(),s=h[h.length-1],r=u.pop(),a=!0),o.leaf&&-1!==(i=n(t,o.children,e)))return o.children.splice(i,1),h.push(o),this._condense(h),this;a||o.leaf||!p(o,l)?s?(r++,o=s.children[r],a=!1):o=null:(h.push(o),u.push(r),r=0,s=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,s){var i,n=r-e+1,o=this._maxEntries;if(n<=o)return a(i=m(t.slice(e,r+1)),this.toBBox),i;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),(i=m([])).leaf=!1,i.height=s;var l,h,u,c,d=Math.ceil(n/o),p=d*Math.ceil(Math.sqrt(o));for(y(t,e,r,p,this.compareMinX),l=e;l<=r;l+=p)for(y(t,l,u=Math.min(l+p-1,r),d,this.compareMinY),h=l;h<=u;h+=d)c=Math.min(h+d-1,u),i.children.push(this._build(t,h,c,s-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,s){for(var i,n,a,o,l,h,u,d,p,f;s.push(e),!e.leaf&&s.length-1!==r;){for(u=d=1/0,i=0,n=e.children.length;i<n;i++)l=c(a=e.children[i]),p=t,f=a,(h=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=h,u=l<u?l:u,o=a):h===d&&l<u&&(u=l,o=a);e=o||e.children[0]}return e},_insert:function(t,e,r){var s=this.toBBox,i=r?t:s(t),n=[],a=this._chooseSubtree(i,this.data,e,n);for(a.children.push(t),l(a,i);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(i,n,e)},_split:function(t,e){var r=t[e],s=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,s);var n=this._chooseSplitIndex(r,i,s),o=m(r.children.splice(n,r.children.length-n));o.height=r.height,o.leaf=r.leaf,a(r,this.toBBox),a(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var s,i,n,a,l,h,u,d,p,f,m,y,g,v;for(h=u=1/0,s=e;s<=r-e;s++)i=o(t,0,s,this.toBBox),n=o(t,s,r,this.toBBox),p=i,f=n,void 0,void 0,void 0,void 0,m=Math.max(p.minX,f.minX),y=Math.max(p.minY,f.minY),g=Math.min(p.maxX,f.maxX),v=Math.min(p.maxY,f.maxY),a=Math.max(0,g-m)*Math.max(0,v-y),l=c(i)+c(n),a<h?(h=a,d=s,u=l<u?l:u):a===h&&l<u&&(u=l,d=s);return d},_chooseSplitAxis:function(t,e,r){var s=t.leaf?this.compareMinX:h,i=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,s)<this._allDistMargin(t,e,r,i)&&t.children.sort(s)},_allDistMargin:function(t,e,r,s){t.children.sort(s);var i,n,a=this.toBBox,h=o(t,0,e,a),u=o(t,r-e,r,a),c=d(h)+d(u);for(i=e;i<r-e;i++)n=t.children[i],l(h,t.leaf?a(n):n),c+=d(h);for(i=r-e-1;i>=e;i--)n=t.children[i],l(u,t.leaf?a(n):n),c+=d(u);return c},_adjustParentBBoxes:function(t,e,r){for(var s=r;s>=0;s--)l(e[s],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},430:function(t,e,r){var s,i;!function(n,a){"use strict";t.exports?t.exports=a():void 0===(i="function"==typeof(s=a)?s.call(e,r,e,t):s)||(t.exports=i)}(0,function(t){"use strict";var e=t&&t.IPv6;return{best:function(t){var e,r,s=t.toLowerCase().split(":"),i=s.length,n=8;for(""===s[0]&&""===s[1]&&""===s[2]?(s.shift(),s.shift()):""===s[0]&&""===s[1]?s.shift():""===s[i-1]&&""===s[i-2]&&s.pop(),-1!==s[(i=s.length)-1].indexOf(".")&&(n=7),e=0;e<i&&""!==s[e];e++);if(e<n)for(s.splice(e,1,"0000");s.length<n;)s.splice(e,0,"0000");for(var a=0;a<n;a++){r=s[a].split("");for(var o=0;o<3&&"0"===r[0]&&r.length>1;o++)r.splice(0,1);s[a]=r.join("")}var l=-1,h=0,u=0,c=-1,d=!1;for(a=0;a<n;a++)d?"0"===s[a]?u+=1:(d=!1,u>h&&(l=c,h=u)):"0"===s[a]&&(d=!0,c=a,u=1);u>h&&(l=c,h=u),h>1&&s.splice(l,h,""),i=s.length;var p="";for(""===s[0]&&(p=":"),a=0;a<i&&(p+=s[a],a!==i-1);a++)p+=":";return""===s[i-1]&&(p+=":"),p},noConflict:function(){return t.IPv6===this&&(t.IPv6=e),this}}})},704:function(t,e,r){var s,i;!function(n,a){"use strict";t.exports?t.exports=a():void 0===(i="function"==typeof(s=a)?s.call(e,r,e,t):s)||(t.exports=i)}(0,function(t){"use strict";var e=t&&t.SecondLevelDomains,r={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;var s=t.lastIndexOf(".",e-1);if(s<=0||s>=e-1)return!1;var i=r.list[t.slice(e+1)];return!!i&&i.indexOf(" "+t.slice(s+1,e)+" ")>=0},is:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;if(t.lastIndexOf(".",e-1)>=0)return!1;var s=r.list[t.slice(e+1)];return!!s&&s.indexOf(" "+t.slice(0,e)+" ")>=0},get:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return null;var s=t.lastIndexOf(".",e-1);if(s<=0||s>=e-1)return null;var i=r.list[t.slice(e+1)];return i?i.indexOf(" "+t.slice(s+1,e)+" ")<0?null:t.slice(s+1):null},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return r})},193:function(t,e,r){var s,i,n;!function(a,o){"use strict";t.exports?t.exports=o(r(340),r(430),r(704)):(i=[r(340),r(430),r(704)],void 0===(n="function"==typeof(s=o)?s.apply(e,i):s)||(t.exports=n))}(0,function(t,e,r,s){"use strict";var i=s&&s.URI;function n(t,e){var r=arguments.length>=1,s=arguments.length>=2;if(!(this instanceof n))return r?s?new n(t,e):new n(t):new n;if(void 0===t){if(r)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}if(null===t&&r)throw new TypeError("null is not a valid argument for URI");return this.href(t),void 0!==e?this.absoluteTo(e):this}n.version="1.19.11";var a=n.prototype,o=Object.prototype.hasOwnProperty;function l(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function h(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function u(t){return"Array"===h(t)}function c(t,e){var r,s,i={};if("RegExp"===h(e))i=null;else if(u(e))for(r=0,s=e.length;r<s;r++)i[e[r]]=!0;else i[e]=!0;for(r=0,s=t.length;r<s;r++){(i&&void 0!==i[t[r]]||!i&&e.test(t[r]))&&(t.splice(r,1),s--,r--)}return t}function d(t,e){var r,s;if(u(e)){for(r=0,s=e.length;r<s;r++)if(!d(t,e[r]))return!1;return!0}var i=h(e);for(r=0,s=t.length;r<s;r++)if("RegExp"===i){if("string"==typeof t[r]&&t[r].match(e))return!0}else if(t[r]===e)return!0;return!1}function p(t,e){if(!u(t)||!u(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var r=0,s=t.length;r<s;r++)if(t[r]!==e[r])return!1;return!0}function f(t){return t.replace(/^\/+|\/+$/g,"")}function m(t){return escape(t)}function y(t){return encodeURIComponent(t).replace(/[!'()*]/g,m).replace(/\*/g,"%2A")}n._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:n.preventInvalidHostname,duplicateQueryParameters:n.duplicateQueryParameters,escapeQuerySpace:n.escapeQuerySpace}},n.preventInvalidHostname=!1,n.duplicateQueryParameters=!1,n.escapeQuerySpace=!0,n.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,n.idn_expression=/[^a-z0-9\._-]/i,n.punycode_expression=/(xn--)/i,n.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,n.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,n.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?Â«Â»ââââ]))/gi,n.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?Â«Â»âââââ]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},n.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,n.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,n.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},n.hostProtocols=["http","https"],n.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,n.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},n.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return n.domAttributes[e]}},n.encode=y,n.decode=decodeURIComponent,n.iso8859=function(){n.encode=escape,n.decode=unescape},n.unicode=function(){n.encode=y,n.decode=decodeURIComponent},n.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},n.encodeQuery=function(t,e){var r=n.encode(t+"");return void 0===e&&(e=n.escapeQuerySpace),e?r.replace(/%20/g,"+"):r},n.decodeQuery=function(t,e){t+="",void 0===e&&(e=n.escapeQuerySpace);try{return n.decode(e?t.replace(/\+/g,"%20"):t)}catch(e){return t}};var g,v={encode:"encode",decode:"decode"},b=function(t,e){return function(r){try{return n[e](r+"").replace(n.characters[t][e].expression,function(r){return n.characters[t][e].map[r]})}catch(t){return r}}};for(g in v)n[g+"PathSegment"]=b("pathname",v[g]),n[g+"UrnPathSegment"]=b("urnpath",v[g]);var S=function(t,e,r){return function(s){var i;i=r?function(t){return n[e](n[r](t))}:n[e];for(var a=(s+"").split(t),o=0,l=a.length;o<l;o++)a[o]=i(a[o]);return a.join(t)}};function _(t){return function(e,r){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!r),this)}}function x(t,e){return function(r,s){return void 0===r?this._parts[t]||"":(null!==r&&(r+="").charAt(0)===e&&(r=r.substring(1)),this._parts[t]=r,this.build(!s),this)}}n.decodePath=S("/","decodePathSegment"),n.decodeUrnPath=S(":","decodeUrnPathSegment"),n.recodePath=S("/","encodePathSegment","decode"),n.recodeUrnPath=S(":","encodeUrnPathSegment","decode"),n.encodeReserved=b("reserved","encode"),n.parse=function(t,e){var r;return e||(e={preventInvalidHostname:n.preventInvalidHostname}),(r=(t=(t=t.replace(n.leading_whitespace_expression,"")).replace(n.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(e.fragment=t.substring(r+1)||null,t=t.substring(0,r)),(r=t.indexOf("?"))>-1&&(e.query=t.substring(r+1)||null,t=t.substring(0,r)),"//"===(t=(t=t.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(e.protocol=null,t=t.substring(2),t=n.parseAuthority(t,e)):(r=t.indexOf(":"))>-1&&(e.protocol=t.substring(0,r)||null,e.protocol&&!e.protocol.match(n.protocol_expression)?e.protocol=void 0:"//"===t.substring(r+1,r+3).replace(/\\/g,"/")?(t=t.substring(r+3),t=n.parseAuthority(t,e)):(t=t.substring(r+1),e.urn=!0)),e.path=t,e},n.parseHost=function(t,e){t||(t="");var r,s,i=(t=t.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=t.length),"["===t.charAt(0))r=t.indexOf("]"),e.hostname=t.substring(1,r)||null,e.port=t.substring(r+2,i)||null,"/"===e.port&&(e.port=null);else{var a=t.indexOf(":"),o=t.indexOf("/"),l=t.indexOf(":",a+1);-1!==l&&(-1===o||l<o)?(e.hostname=t.substring(0,i)||null,e.port=null):(s=t.substring(0,i).split(":"),e.hostname=s[0]||null,e.port=s[1]||null)}return e.hostname&&"/"!==t.substring(i).charAt(0)&&(i++,t="/"+t),e.preventInvalidHostname&&n.ensureValidHostname(e.hostname,e.protocol),e.port&&n.ensureValidPort(e.port),t.substring(i)||"/"},n.parseAuthority=function(t,e){return t=n.parseUserinfo(t,e),n.parseHost(t,e)},n.parseUserinfo=function(t,e){var r=t;-1!==t.indexOf("\\")&&(t=t.replace(/\\/g,"/"));var s,i=t.indexOf("/"),a=t.lastIndexOf("@",i>-1?i:t.length-1);return a>-1&&(-1===i||a<i)?(s=t.substring(0,a).split(":"),e.username=s[0]?n.decode(s[0]):null,s.shift(),e.password=s[0]?n.decode(s.join(":")):null,t=r.substring(a+1)):(e.username=null,e.password=null),t},n.parseQuery=function(t,e){if(!t)return{};if(!(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var r,s,i,a={},l=t.split("&"),h=l.length,u=0;u<h;u++)r=l[u].split("="),s=n.decodeQuery(r.shift(),e),i=r.length?n.decodeQuery(r.join("="),e):null,"__proto__"!==s&&(o.call(a,s)?("string"!=typeof a[s]&&null!==a[s]||(a[s]=[a[s]]),a[s].push(i)):a[s]=i);return a},n.build=function(t){var e="",r=!1;return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//",r=!0),e+=n.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&r&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},n.buildHost=function(t){var e="";return t.hostname?(n.ip6_expression.test(t.hostname)?e+="["+t.hostname+"]":e+=t.hostname,t.port&&(e+=":"+t.port),e):""},n.buildAuthority=function(t){return n.buildUserinfo(t)+n.buildHost(t)},n.buildUserinfo=function(t){var e="";return t.username&&(e+=n.encode(t.username)),t.password&&(e+=":"+n.encode(t.password)),e&&(e+="@"),e},n.buildQuery=function(t,e,r){var s,i,a,l,h="";for(i in t)if("__proto__"!==i&&o.call(t,i))if(u(t[i]))for(s={},a=0,l=t[i].length;a<l;a++)void 0!==t[i][a]&&void 0===s[t[i][a]+""]&&(h+="&"+n.buildQueryParameter(i,t[i][a],r),!0!==e&&(s[t[i][a]+""]=!0));else void 0!==t[i]&&(h+="&"+n.buildQueryParameter(i,t[i],r));return h.substring(1)},n.buildQueryParameter=function(t,e,r){return n.encodeQuery(t,r)+(null!==e?"="+n.encodeQuery(e,r):"")},n.addQuery=function(t,e,r){if("object"==typeof e)for(var s in e)o.call(e,s)&&n.addQuery(t,s,e[s]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=r);"string"==typeof t[e]&&(t[e]=[t[e]]),u(r)||(r=[r]),t[e]=(t[e]||[]).concat(r)}},n.setQuery=function(t,e,r){if("object"==typeof e)for(var s in e)o.call(e,s)&&n.setQuery(t,s,e[s]);else{if("string"!=typeof e)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");t[e]=void 0===r?null:r}},n.removeQuery=function(t,e,r){var s,i,a;if(u(e))for(s=0,i=e.length;s<i;s++)t[e[s]]=void 0;else if("RegExp"===h(e))for(a in t)e.test(a)&&(t[a]=void 0);else if("object"==typeof e)for(a in e)o.call(e,a)&&n.removeQuery(t,a,e[a]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===h(r)?!u(t[e])&&r.test(t[e])?t[e]=void 0:t[e]=c(t[e],r):t[e]!==String(r)||u(r)&&1!==r.length?u(t[e])&&(t[e]=c(t[e],r)):t[e]=void 0:t[e]=void 0}},n.hasQuery=function(t,e,r,s){switch(h(e)){case"String":break;case"RegExp":for(var i in t)if(o.call(t,i)&&e.test(i)&&(void 0===r||n.hasQuery(t,i,r)))return!0;return!1;case"Object":for(var a in e)if(o.call(e,a)&&!n.hasQuery(t,a,e[a]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(h(r)){case"Undefined":return e in t;case"Boolean":return r===Boolean(u(t[e])?t[e].length:t[e]);case"Function":return!!r(t[e],e,t);case"Array":return!!u(t[e])&&(s?d:p)(t[e],r);case"RegExp":return u(t[e])?!!s&&d(t[e],r):Boolean(t[e]&&t[e].match(r));case"Number":r=String(r);case"String":return u(t[e])?!!s&&d(t[e],r):t[e]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},n.joinPaths=function(){for(var t=[],e=[],r=0,s=0;s<arguments.length;s++){var i=new n(arguments[s]);t.push(i);for(var a=i.segment(),o=0;o<a.length;o++)"string"==typeof a[o]&&e.push(a[o]),a[o]&&r++}if(!e.length||!r)return new n("");var l=new n("").segment(e);return""!==t[0].path()&&"/"!==t[0].path().slice(0,1)||l.path("/"+l.path()),l.normalize()},n.commonPath=function(t,e){var r,s=Math.min(t.length,e.length);for(r=0;r<s;r++)if(t.charAt(r)!==e.charAt(r)){r--;break}return r<1?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":("/"===t.charAt(r)&&"/"===e.charAt(r)||(r=t.substring(0,r).lastIndexOf("/")),t.substring(0,r+1))},n.withinString=function(t,e,r){r||(r={});var s=r.start||n.findUri.start,i=r.end||n.findUri.end,a=r.trim||n.findUri.trim,o=r.parens||n.findUri.parens,l=/[a-z0-9-]=["']?$/i;for(s.lastIndex=0;;){var h=s.exec(t);if(!h)break;var u=h.index;if(r.ignoreHtml){var c=t.slice(Math.max(u-3,0),u);if(c&&l.test(c))continue}for(var d=u+t.slice(u).search(i),p=t.slice(u,d),f=-1;;){var m=o.exec(p);if(!m)break;var y=m.index+m[0].length;f=Math.max(f,y)}if(!((p=f>-1?p.slice(0,f)+p.slice(f).replace(a,""):p.replace(a,"")).length<=h[0].length||r.ignore&&r.ignore.test(p))){var g=e(p,u,d=u+p.length,t);void 0!==g?(g=String(g),t=t.slice(0,u)+g+t.slice(d),s.lastIndex=u+g.length):s.lastIndex=d}}return s.lastIndex=0,t},n.ensureValidHostname=function(e,r){var s=!!e,i=!1;if(!!r&&(i=d(n.hostProtocols,r)),i&&!s)throw new TypeError("Hostname cannot be empty, if protocol is "+r);if(e&&e.match(n.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(e).match(n.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-:_]')}},n.ensureValidPort=function(t){if(t){var e=Number(t);if(!(/^[0-9]+$/.test(e)&&e>0&&e<65536))throw new TypeError('Port "'+t+'" is not a valid port')}},n.noConflict=function(t){if(t){var e={URI:this.noConflict()};return s.URITemplate&&"function"==typeof s.URITemplate.noConflict&&(e.URITemplate=s.URITemplate.noConflict()),s.IPv6&&"function"==typeof s.IPv6.noConflict&&(e.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&"function"==typeof s.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=s.SecondLevelDomains.noConflict()),e}return s.URI===this&&(s.URI=i),this},a.build=function(t){return!0===t?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=n.build(this._parts),this._deferred_build=!1),this},a.clone=function(){return new n(this)},a.valueOf=a.toString=function(){return this.build(!1)._string},a.protocol=_("protocol"),a.username=_("username"),a.password=_("password"),a.hostname=_("hostname"),a.port=_("port"),a.query=x("query","?"),a.fragment=x("fragment","#"),a.search=function(t,e){var r=this.query(t,e);return"string"==typeof r&&r.length?"?"+r:r},a.hash=function(t,e){var r=this.fragment(t,e);return"string"==typeof r&&r.length?"#"+r:r},a.pathname=function(t,e){if(void 0===t||!0===t){var r=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?n.decodeUrnPath:n.decodePath)(r):r}return this._parts.urn?this._parts.path=t?n.recodeUrnPath(t):"":this._parts.path=t?n.recodePath(t):"/",this.build(!e),this},a.path=a.pathname,a.href=function(t,e){var r;if(void 0===t)return this.toString();this._string="",this._parts=n._parts();var s=t instanceof n,i="object"==typeof t&&(t.hostname||t.path||t.pathname);t.nodeName&&(t=t[n.getDomAttribute(t)]||"",i=!1);if(!s&&i&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=n.parse(String(t),this._parts);else{if(!s&&!i)throw new TypeError("invalid input");var a=s?t._parts:t;for(r in a)"query"!==r&&o.call(this._parts,r)&&(this._parts[r]=a[r]);a.query&&this.query(a.query,!1)}return this.build(!e),this},a.is=function(t){var e=!1,s=!1,i=!1,a=!1,o=!1,l=!1,h=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,s=n.ip4_expression.test(this._parts.hostname),i=n.ip6_expression.test(this._parts.hostname),o=(a=!(e=s||i))&&r&&r.has(this._parts.hostname),l=a&&n.idn_expression.test(this._parts.hostname),h=a&&n.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return a;case"sld":return o;case"ip":return e;case"ip4":case"ipv4":case"inet4":return s;case"ip6":case"ipv6":case"inet6":return i;case"idn":return l;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return h}return null};var w=a.protocol,A=a.port,M=a.hostname;a.protocol=function(t,e){if(t&&!(t=t.replace(/:(\/\/)?$/,"")).match(n.protocol_expression))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return w.call(this,t,e)},a.scheme=a.protocol,a.port=function(t,e){return this._parts.urn?void 0===t?"":this:(void 0!==t&&(0===t&&(t=null),t&&(":"===(t+="").charAt(0)&&(t=t.substring(1)),n.ensureValidPort(t))),A.call(this,t,e))},a.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var r={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==n.parseHost(t,r))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=r.hostname,this._parts.preventInvalidHostname&&n.ensureValidHostname(t,this._parts.protocol)}return M.call(this,t,e)},a.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var r=this.protocol();return this.authority()?(r?r+"://":"")+this.authority():""}var s=n(t);return this.protocol(s.protocol()).authority(s.authority()).build(!e),this},a.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?n.buildHost(this._parts):"";if("/"!==n.parseHost(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},a.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?n.buildAuthority(this._parts):"";if("/"!==n.parseAuthority(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},a.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var r=n.buildUserinfo(this._parts);return r?r.substring(0,r.length-1):r}return"@"!==t[t.length-1]&&(t+="@"),n.parseUserinfo(t,this._parts),this.build(!e),this},a.resource=function(t,e){var r;return void 0===t?this.path()+this.search()+this.hash():(r=n.parse(t),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!e),this)},a.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var s=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,s),a=new RegExp("^"+l(i));if(t&&"."!==t.charAt(t.length-1)&&(t+="."),-1!==t.indexOf(":"))throw new TypeError("Domains cannot contain colons");return t&&n.ensureValidHostname(t,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(a,t),this.build(!e),this},a.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var s=this._parts.hostname.length-this.tld(e).length-1;return s=this._parts.hostname.lastIndexOf(".",s-1)+1,this._parts.hostname.substring(s)||""}if(!t)throw new TypeError("cannot set domain empty");if(-1!==t.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(n.ensureValidHostname(t,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var i=new RegExp(l(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,t)}return this.build(!e),this},a.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(s+1);return!0!==e&&r&&r.list[i.toLowerCase()]&&r.get(this._parts.hostname)||i}var n;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');n=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(n,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");n=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(n,t)}return this.build(!e),this},a.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,s=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return t?n.decodePath(s):s}var i=this._parts.path.length-this.filename().length,a=this._parts.path.substring(0,i),o=new RegExp("^"+l(a));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=n.recodePath(t),this._parts.path=this._parts.path.replace(o,t),this.build(!e),this},a.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("string"!=typeof t){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),s=this._parts.path.substring(r+1);return t?n.decodePathSegment(s):s}var i=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(i=!0);var a=new RegExp(l(this.filename())+"$");return t=n.recodePath(t),this._parts.path=this._parts.path.replace(a,t),i?this.normalizePath(e):this.build(!e),this},a.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var r,s,i=this.filename(),a=i.lastIndexOf(".");return-1===a?"":(r=i.substring(a+1),s=/^[a-z0-9%]+$/i.test(r)?r:"",t?n.decodePathSegment(s):s)}"."===t.charAt(0)&&(t=t.substring(1));var o,h=this.suffix();if(h)o=t?new RegExp(l(h)+"$"):new RegExp(l("."+h)+"$");else{if(!t)return this;this._parts.path+="."+n.recodePath(t)}return o&&(t=n.recodePath(t),this._parts.path=this._parts.path.replace(o,t)),this.build(!e),this},a.segment=function(t,e,r){var s=this._parts.urn?":":"/",i=this.path(),n="/"===i.substring(0,1),a=i.split(s);if(void 0!==t&&"number"!=typeof t&&(r=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(n&&a.shift(),t<0&&(t=Math.max(a.length+t,0)),void 0===e)return void 0===t?a:a[t];if(null===t||void 0===a[t])if(u(e)){a=[];for(var o=0,l=e.length;o<l;o++)(e[o].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(f(e[o])))}else(e||"string"==typeof e)&&(e=f(e),""===a[a.length-1]?a[a.length-1]=e:a.push(e));else e?a[t]=f(e):a.splice(t,1);return n&&a.unshift(""),this.path(a.join(s),r)},a.segmentCoded=function(t,e,r){var s,i,a;if("number"!=typeof t&&(r=e,e=t,t=void 0),void 0===e){if(u(s=this.segment(t,e,r)))for(i=0,a=s.length;i<a;i++)s[i]=n.decode(s[i]);else s=void 0!==s?n.decode(s):void 0;return s}if(u(e))for(i=0,a=e.length;i<a;i++)e[i]=n.encode(e[i]);else e="string"==typeof e||e instanceof String?n.encode(e):e;return this.segment(t,e,r)};var C=a.query;return a.query=function(t,e){if(!0===t)return n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var r=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace),s=t.call(this,r);return this._parts.query=n.buildQuery(s||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=n.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):C.call(this,t,e)},a.setQuery=function(t,e,r){var s=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)s[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in t)o.call(t,i)&&(s[i]=t[i])}return this._parts.query=n.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},a.addQuery=function(t,e,r){var s=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.addQuery(s,t,void 0===e?null:e),this._parts.query=n.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},a.removeQuery=function(t,e,r){var s=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.removeQuery(s,t,e),this._parts.query=n.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},a.hasQuery=function(t,e,r){var s=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.hasQuery(s,t,e,r)},a.setSearch=a.setQuery,a.addSearch=a.addQuery,a.removeSearch=a.removeQuery,a.hasSearch=a.hasQuery,a.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},a.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},a.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},a.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===n.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},a.normalizePath=function(t){var e,r=this._parts.path;if(!r)return this;if(this._parts.urn)return this._parts.path=n.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;var s,i,a="";for("/"!==(r=n.recodePath(r)).charAt(0)&&(e=!0,r="/"+r),"/.."!==r.slice(-3)&&"/."!==r.slice(-2)||(r+="/"),r=r.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(a=r.substring(1).match(/^(\.\.\/)+/)||"")&&(a=a[0]);-1!==(s=r.search(/\/\.\.(\/|$)/));)0!==s?(-1===(i=r.substring(0,s).lastIndexOf("/"))&&(i=s),r=r.substring(0,i)+r.substring(s+3)):r=r.substring(3);return e&&this.is("relative")&&(r=a+r.substring(1)),this._parts.path=r,this.build(!t),this},a.normalizePathname=a.normalizePath,a.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(n.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},a.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},a.normalizeSearch=a.normalizeQuery,a.normalizeHash=a.normalizeFragment,a.iso8859=function(){var t=n.encode,e=n.decode;n.encode=escape,n.decode=decodeURIComponent;try{this.normalize()}finally{n.encode=t,n.decode=e}return this},a.unicode=function(){var t=n.encode,e=n.decode;n.encode=y,n.decode=unescape;try{this.normalize()}finally{n.encode=t,n.decode=e}return this},a.readable=function(){var e=this.clone();e.username("").password("").normalize();var r="";if(e._parts.protocol&&(r+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(r+=t.toUnicode(e._parts.hostname),e._parts.port&&(r+=":"+e._parts.port)):r+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(r+="/"),r+=e.path(!0),e._parts.query){for(var s="",i=0,a=e._parts.query.split("&"),o=a.length;i<o;i++){var l=(a[i]||"").split("=");s+="&"+n.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==l[1]&&(s+="="+n.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+s.substring(1)}return r+=n.decodeQuery(e.hash(),!0)},a.absoluteTo=function(t){var e,r,s,i=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof n||(t=new n(t)),i._parts.protocol)return i;if(i._parts.protocol=t._parts.protocol,this._parts.hostname)return i;for(r=0;s=a[r];r++)i._parts[s]=t._parts[s];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(e=(e=t.directory())||(0===t.path().indexOf("/")?"/":""),i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=t._parts.path,i._parts.query||(i._parts.query=t._parts.query)),i.build(),i},a.relativeTo=function(t){var e,r,s,i,a,o=this.clone().normalize();if(o._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new n(t).normalize(),e=o._parts,r=t._parts,i=o.path(),a=t.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===r.protocol&&(e.protocol=null),e.username!==r.username||e.password!==r.password)return o.build();if(null!==e.protocol||null!==e.username||null!==e.password)return o.build();if(e.hostname!==r.hostname||e.port!==r.port)return o.build();if(e.hostname=null,e.port=null,i===a)return e.path="",o.build();if(!(s=n.commonPath(i,a)))return o.build();var l=r.path.substring(s.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=l+e.path.substring(s.length)||"./",o.build()},a.equals=function(t){var e,r,s,i,a,l=this.clone(),h=new n(t),c={};if(l.normalize(),h.normalize(),l.toString()===h.toString())return!0;if(s=l.query(),i=h.query(),l.query(""),h.query(""),l.toString()!==h.toString())return!1;if(s.length!==i.length)return!1;for(a in e=n.parseQuery(s,this._parts.escapeQuerySpace),r=n.parseQuery(i,this._parts.escapeQuerySpace),e)if(o.call(e,a)){if(u(e[a])){if(!p(e[a],r[a]))return!1}else if(e[a]!==r[a])return!1;c[a]=!0}for(a in r)if(o.call(r,a)&&!c[a])return!1;return!0},a.preventInvalidHostname=function(t){return this._parts.preventInvalidHostname=!!t,this},a.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},a.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},n})},340:function(t,e,r){var s;t=r.nmd(t),function(i){e&&e.nodeType,t&&t.nodeType;var n="object"==typeof r.g&&r.g;n.global!==n&&n.window!==n&&n.self;var a,o=2147483647,l=36,h=1,u=26,c=38,d=700,p=72,f=128,m="-",y=/^xn--/,g=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-h,_=Math.floor,x=String.fromCharCode;function w(t){throw new RangeError(b[t])}function A(t,e){for(var r=t.length,s=[];r--;)s[r]=e(t[r]);return s}function M(t,e){var r=t.split("@"),s="";return r.length>1&&(s=r[0]+"@",t=r[1]),s+A((t=t.replace(v,".")).split("."),e).join(".")}function C(t){for(var e,r,s=[],i=0,n=t.length;i<n;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<n?56320==(64512&(r=t.charCodeAt(i++)))?s.push(((1023&e)<<10)+(1023&r)+65536):(s.push(e),i--):s.push(e);return s}function E(t){return A(t,function(t){var e="";return t>65535&&(e+=x((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=x(t)}).join("")}function T(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function O(t,e,r){var s=0;for(t=r?_(t/d):t>>1,t+=_(t/e);t>S*u>>1;s+=l)t=_(t/S);return _(s+(S+1)*t/(t+c))}function P(t){var e,r,s,i,n,a,c,d,y,g,v,b=[],S=t.length,x=0,A=f,M=p;for((r=t.lastIndexOf(m))<0&&(r=0),s=0;s<r;++s)t.charCodeAt(s)>=128&&w("not-basic"),b.push(t.charCodeAt(s));for(i=r>0?r+1:0;i<S;){for(n=x,a=1,c=l;i>=S&&w("invalid-input"),((d=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||d>_((o-x)/a))&&w("overflow"),x+=d*a,!(d<(y=c<=M?h:c>=M+u?u:c-M));c+=l)a>_(o/(g=l-y))&&w("overflow"),a*=g;M=O(x-n,e=b.length+1,0==n),_(x/e)>o-A&&w("overflow"),A+=_(x/e),x%=e,b.splice(x++,0,A)}return E(b)}function L(t){var e,r,s,i,n,a,c,d,y,g,v,b,S,A,M,E=[];for(b=(t=C(t)).length,e=f,r=0,n=p,a=0;a<b;++a)(v=t[a])<128&&E.push(x(v));for(s=i=E.length,i&&E.push(m);s<b;){for(c=o,a=0;a<b;++a)(v=t[a])>=e&&v<c&&(c=v);for(c-e>_((o-r)/(S=s+1))&&w("overflow"),r+=(c-e)*S,e=c,a=0;a<b;++a)if((v=t[a])<e&&++r>o&&w("overflow"),v==e){for(d=r,y=l;!(d<(g=y<=n?h:y>=n+u?u:y-n));y+=l)M=d-g,A=l-g,E.push(x(T(g+M%A,0))),d=_(M/A);E.push(x(T(d,0))),n=O(r,S,s==i),r=0,++s}++r,++e}return E.join("")}a={version:"1.3.2",ucs2:{decode:C,encode:E},decode:P,encode:L,toASCII:function(t){return M(t,function(t){return g.test(t)?"xn--"+L(t):t})},toUnicode:function(t){return M(t,function(t){return y.test(t)?P(t.slice(4).toLowerCase()):t})}},void 0===(s=function(){return a}.call(e,r,e,t))||(t.exports=s)}()}},e={};function r(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.n=(t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e}),r.d=((t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}),r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=((t,e)=>Object.prototype.hasOwnProperty.call(t,e)),r.nmd=(t=>(t.paths=[],t.children||(t.children=[]),t)),(()=>{"use strict";const t=maplibregl;var e=r.n(t),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF4AAAAdCAYAAAAjHtusAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozYWZlOGIwMi01MWE3LTRiZjYtYWVkYS05MGQ2ZTQ4YjZiMmUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODg0NkFBQUE3RjEzMTFFNzhFRjJFQkY4RjcxQjc1NjIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODg0NkFBQTk3RjEzMTFFNzhFRjJFQkY4RjcxQjc1NjIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4MWI3NzdhNC1lZmEyLTQ1MzUtOGQzNi03MmRjNDkyODMzN2UiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpjYTYzODVjMi1jNDQ1LTExN2EtYTc0ZC1lM2I5MzJlMGE4Y2QiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5q1HM0AAAF/ElEQVR42tSabYhUVRjHZ7W01C1uaCRW4F3oi9SXCUnwQ9gsGUFvOEtQH1bLu5VS9sbYh5KicjYt29qiGQwVg2xWWKgocob91AvC+CWsoJqB3qHMSdTMpZyeU/+Df07n3pk7997Z6cBv99z7nHvOvf/z/pxJNZvNVI/jCKXmv6EquAmVkxPSlvtp2GItr0/96fFQForChJAWDiVYTkMYMu4XBFcYjLOwWS3sNwmn8NGzZ0h4Flv/zwIdchAnh/slCGmmKUNIBzYPaXOUr0vPuEjD71JAPh7l61embzinhV3V8nnCGmGT8LwlzSL8/yUh4Tfjo9T/CgnCIYNKycA2Qq21AcHU/VHE80Idoo3Qs0W6p0UtUnkZvEMDeVcCyqxEafF7hL8Qf0oYsIj+lfC9cH1CwhchWAGCtZO+AooQOkdC1Km1VtCb63StW73uFSzgKFUkNwBbmZGGmqowhvg8ZNpH9oXChcIcYRdeNomgxLkaH+S1SGubAxyIpFv+Zp+0DYjrAS00j/dem2VGEl6FJ4Qa4quEu8j2hTCJ+GJhe4JjfQMf6JCYPPbysMPxBlp0BUKOogEF9Rg9/heNvNKYfM0KsZUZaYxX4STGrzJa+zbhPeFH2DcK10KItcI+pI0rVElwXl1ULaKnIJhDw0oRQpTQc1zcbwRU8ATy4DR6yMlTzwkqMziEWHvubJ4Nk4ZtHdnqwvwY17xq3Z4FjrG+z2Kdrdf2ZSGD+xlLPh6t1R0jP9fI22ZzKI92yvQl7EbmBxI4S7Y+vIAOL87QZqsc5uNnssxZIcfYjXT9snCR7jjobidp+FkxA2v+Cq1QervMDmp4P7Xs3YZtE9kOC3P/By6JGaETl8ElwueYTNTDq4UDsKnd7YfCNbT239LF1udS72xYJt1UWxNfN4IIP4bWuTpEja01JtMFZFsm/AHbtHBlDE6yasA4moYTrUbvdBTXHqUrAH4uSadbyzF+vbBM2IsNkS3MNa5305JxqfA02T4TnkX8XOH1mPw8ruVejpxbI9hZD2Cz1U7LdrrUvjP/WfZinNZhr6V27hP+FPZh9aLvLxVO4DllX0G2OcKnlO/DCblxaz6uXBtmi+8mBaP3/SP8IuEIiTRoPPQm2TaEmEyXo0JU+F0YiPFD0hhOsiE/vqeEVwyTgF8L51OilcIZ2I4Ll5NttvAJPfukUeB2sk0ZPSbKIUUJpCII7+DasWy08uhNNazT0wGHI7mAtB7KqMKm38HhDdAUibTVKGicbB8YAqrJ9DRsp43JdB4qUof1HQrPE6XTQWu3Ce/inVzjXhXpMiTwUYugNVQ+p80jrUsV5EH0POKeuXO9QjhFq5GryNYvfEMCDhsftYVsB9ETtG0V9ZjfhCURhbcJFpfwVZ9jvhxsLHwTYtp2svlWQw3vXL8UnqHVSIG8l8ex+tHhBXgjddgqHEZ8ufAA2aaEnYgrF/KrPXrEmMUqZ9THLW06xhoBaVueQpkug+ewOUphE3Qv2Q5gGamXYa+QbVq4O+DQ5FHyZqrjxNt7UHh9uuRa0F7HjCF8o9PCTOGnscM7g2u1Hl9C9oeEnxC/1ajZg8JLiM9Hj9GHJseMShwL2DO0G5yEWn3Zh1QUods5CPkIoqlwAZxhXMsb6HrcEPBxchhdJ6wj29vCW4hfLOzo8J3rltYX50nXQAATSf/K4DEaGlTLvplsk/QCpoD60EQ7gLYZc8H9wq+I3yncEOEcNhuz6HWf3XEiwU/4Y8YEqVp2P10rt+8REvBGw026i4aDcbL9jF8r8Blmf4fCOzhViiscskygXRdehf3CO4hfigmTBXyQrl8TFtD1IzQX3CbcQrY3hPcRv4z8OmHPXwchVNln2MmE7BX6VwIFi/he6uxvb6JM3m0fdqvx/ATidxg2JeC7VDErAw5NzGfvwRJVheEIQ8Mg/pdwIM+UOmi9Q8ivCsrIy0tF+wVbEcLrd3Pb2XisEb4Tdlhsi4WP4RBbaLGrHfC3PrvMIezy9rTpGm5lz9LOMG15xvFxD/j5gjzjjDbMOzk+9zzt3v5bgAEAibzFeFHVgYkAAAAASUVORK5CYII=";class i{constructor(t){this.imageUrl=null,this.link=null,this.width=null,this.height=null,this.alt="SuperMap iClient",this._extend(this,t)}onAdd(t){this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl iclient-logo",this._container.style.marginTop=0,this._container.style.marginBottom=0,this._container.style.marginLeft=0,this._container.style.marginRight=0;var e=s;this.imageUrl&&(e=this.imageUrl);var r=this.alt,i="94px",n="29px",a="width:"+i+";height:"+n+";";this.imageUrl&&(a="width:"+(i=this.width)+";height:"+(n=this.height)+";",i&&n||(a=""));var o=this.link;return this._container.innerHTML="<a href='"+o+"' target='_blank'><img src="+e+" alt='"+r+"' style='"+a+"margin-bottom: 2px'></a>",this._createStyleSheet(),this._container}_createStyleSheet(){var t=document.createElement("style");t.type="text/css",t.innerHTML=".iclient-logo{margin:0 !important;}.iclient-logo a{border: none;display: block;height:31px;}.iclient-logo img{border: none;white-space: nowrap}",document.getElementsByTagName("head")[0].appendChild(t)}_extend(t){for(var e=0;e<Object.getOwnPropertyNames(arguments).length;e++){var r=Object.getOwnPropertyNames(arguments)[e];if("caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r){var s=arguments[r];if(s)for(var i=0;i<Object.getOwnPropertyNames(s).length;i++){var n=Object.getOwnPropertyNames(s)[i];"caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r&&(t[n]=s[n])}}}return t}}class n{constructor(t,e){this.w=t?parseFloat(t):0,this.h=t?parseFloat(e):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new n(this.w,this.h)}equals(t){var e=!1;return null!=t&&(e=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),e}destroy(){this.w=null,this.h=null}}class a{constructor(t,e,r){this.x=t?parseFloat(t):0,this.y=e?parseFloat(e):0,this.mode=r,this.CLASS_NAME="SuperMap.Pixel"}toString(){return"x="+this.x+",y="+this.y}clone(){return new a(this.x,this.y,this.mode)}equals(t){var e=!1;return null!=t&&(e=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,e){if(null==t||null==e)throw new TypeError("Pixel.add cannot receive null values");return new a(this.x+t,this.y+e)}offset(t){var e=this.clone();return t&&(e=this.add(t.x,t.y)),e}destroy(){this.x=null,this.y=null,this.mode=null}}a.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"};var o=function(...t){class e{constructor(e){for(var r=0;r<t.length;r++)i(this,new t[r](e))}}for(var r=0;r<t.length;r++){var s=t[r];i(e,s),i(e.prototype,s.prototype),i(e.prototype,new s)}return e;function i(t,e){var r=Object.getOwnPropertyNames(e);Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e)));for(var s=0;s<r.length;s++){var i=r[s];if("constructor"!==i&&"prototype"!==i&&"name"!==i&&"length"!==i){let r=Object.getOwnPropertyDescriptor(e,i);window.ActiveXObject?Object.defineProperty(t,i,r||{}):Object.defineProperty(t,i,r)}}}},l={startsWith:function(t,e){return 0==t.indexOf(e)},contains:function(t,e){return-1!=t.indexOf(e)},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(t){for(var e=t.split("-"),r=e[0],s=1,i=e.length;s<i;s++){var n=e[s];r+=n.charAt(0).toUpperCase()+n.substring(1)}return r},format:function(t,e,r){e||(e=window);return t.replace(l.tokenRegEx,function(t,s){for(var i,n=s.split(/\.+/),a=0;a<n.length;a++)0==a&&(i=e),i=i[n[a]];return"function"==typeof i&&(i=r?i.apply(null,r):i()),void 0===i?"undefined":i})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(t){return l.numberRegEx.test(t)},numericIf:function(t){return l.isNumeric(t)?parseFloat(t):t}},h={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(t,e){var r=0;return e>0&&(r=parseFloat(t.toPrecision(e))),r},format:function(t,e,r,s){e=void 0!==e?e:0,r=void 0!==r?r:h.thousandsSeparator,s=void 0!==s?s:h.decimalSeparator,null!=e&&(t=parseFloat(t.toFixed(e)));var i=t.toString().split(".");1===i.length&&null==e&&(e=0);var n,a=i[0];if(r)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(a);)a=a.replace(o,"$1"+r+"$2");if(0==e)n=a;else{var l=i.length>1?i[1]:"0";null!=e&&(l+=new Array(e-l.length+1).join("0")),n=a+s+l}return n}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(t){return h.limitSigDigs(this,t)});var u={bind:function(t,e){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var s=r.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,s)}},bindAsEventListener:function(t,e){return function(r){return t.call(e,r||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},c={filter:function(t,e,r){var s=[];if(Array.prototype.filter)s=t.filter(e,r);else{var i=t.length;if("function"!=typeof e)throw new TypeError;for(var n=0;n<i;n++)if(n in t){var a=t[n];e.call(r,a,n,t)&&s.push(a)}}return s}};class d{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=v.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new d}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){this.getBounds()?this.bounds.extend(t):this.setBounds(t)}getBounds(){return null==this.bounds&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}var p=r(193),f=r.n(p);const m=function(){var t,e="",r="",s="pc",i=navigator.userAgent.toLowerCase();return i.indexOf("msie")>-1||i.indexOf("trident")>-1&&i.indexOf("rv")>-1?(e="msie",t=i.match(/msie ([\d.]+)/)||i.match(/rv:([\d.]+)/)):i.indexOf("chrome")>-1?(e="chrome",t=i.match(/chrome\/([\d.]+)/)):i.indexOf("firefox")>-1?(e="firefox",t=i.match(/firefox\/([\d.]+)/)):i.indexOf("opera")>-1?(e="opera",t=i.match(/version\/([\d.]+)/)):i.indexOf("safari")>-1&&(e="safari",t=i.match(/version\/([\d.]+)/)),r=t?t[1]:"",i.indexOf("ipad")>-1||i.indexOf("ipod")>-1||i.indexOf("iphone")>-1?s="apple":i.indexOf("android")>-1&&(r=(t=i.match(/version\/([\d.]+)/))?t[1]:"",s="android"),{name:e,version:r,device:s}}(),y=function(){var t=!0,e=m;return document.createElement("canvas").getContext?("firefox"===e.name&&parseFloat(e.version)<5&&(t=!1),"safari"===e.name&&parseFloat(e.version)<4&&(t=!1),"opera"===e.name&&parseFloat(e.version)<10&&(t=!1),"msie"===e.name&&parseFloat(e.version)<9&&(t=!1)):t=!1,t}(),g=function(){var t=navigator.userAgent.toLowerCase();return-1===t.indexOf("webkit")&&-1!==t.indexOf("gecko")}(),v={assign(t){for(var e=0;e<Object.getOwnPropertyNames(arguments).length;e++){var r=Object.getOwnPropertyNames(arguments)[e];if("caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r){var s=arguments[r];if(s)for(var i=0;i<Object.getOwnPropertyNames(s).length;i++){var n=Object.getOwnPropertyNames(s)[i];"caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r&&(t[n]=s[n])}}}return t},extend:function(t,e){if(t=t||{},e){for(var r in e){var s=e[r];void 0!==s&&(t[r]=s)}!("function"==typeof window.Event&&e instanceof window.Event)&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},copy:function(t,e){var r;if(t=t||{},e)for(var s in t)void 0!==(r=e[s])&&(t[s]=r)},reset:function(t){for(var e in t=t||{})if(t.hasOwnProperty(e)){if("object"==typeof t[e]&&t[e]instanceof Array){for(var r in t[e])t[e][r].destroy&&t[e][r].destroy();t[e].length=0}else"object"==typeof t[e]&&t[e]instanceof Object&&t[e].destroy&&t[e].destroy();t[e]=null}},getElement:function(){for(var t=[],e=0,r=arguments.length;e<r;e++){var s=arguments[e];if("string"==typeof s&&(s=document.getElementById(s)),1===arguments.length)return s;t.push(s)}return t},isElement:function(t){return!(!t||1!==t.nodeType)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},removeItem:function(t,e){for(var r=t.length-1;r>=0;r--)t[r]===e&&t.splice(r,1);return t},indexOf:function(t,e){if(null==t)return-1;if("function"==typeof t.indexOf)return t.indexOf(e);for(var r=0,s=t.length;r<s;r++)if(t[r]===e)return r;return-1},modifyDOMElement:function(t,e,r,s,i,n,a,o){e&&(t.id=e),r&&(t.style.left=r.x+"px",t.style.top=r.y+"px"),s&&(t.style.width=s.w+"px",t.style.height=s.h+"px"),i&&(t.style.position=i),n&&(t.style.border=n),a&&(t.style.overflow=a),parseFloat(o)>=0&&parseFloat(o)<1?(t.style.filter="alpha(opacity="+100*o+")",t.style.opacity=o):1===parseFloat(o)&&(t.style.filter="",t.style.opacity="")},applyDefaults:function(t,e){t=t||{};var r="function"==typeof window.Event&&e instanceof window.Event;for(var s in e)(void 0===t[s]||!r&&e.hasOwnProperty&&e.hasOwnProperty(s)&&!t.hasOwnProperty(s))&&(t[s]=e[s]);return!r&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},getParameterString:function(t){var e=[];for(var r in t){var s,i=t[r];if(null!=i&&"function"!=typeof i)s=Array.isArray(i)||"[object Object]"===i.toString()?encodeURIComponent(JSON.stringify(i)):encodeURIComponent(i),e.push(encodeURIComponent(r)+"="+s)}return e.join("&")},urlAppend:function(t,e){var r=t;if(e){0===e.indexOf("?")&&(e=e.substring(1));var s=(t+" ").split(/[?&]/);r+=" "===s.pop()?e:s.length?"&"+e:"?"+e}return r},urlPathAppend:function(t,e){let r=t;if(!e)return r;0===e.indexOf("/")&&(e=e.substring(1));const s=t.split("?");return s[0].indexOf("/",s[0].length-1)<0&&(s[0]+="/"),r=`${s[0]}${e}${s.length>1?`?${s[1]}`:""}`},DEFAULT_PRECISION:14,toFloat:function(t,e){return null==e&&(e=v.DEFAULT_PRECISION),"number"!=typeof t&&(t=parseFloat(t)),0===e?t:parseFloat(t.toPrecision(e))},rad:function(t){return t*Math.PI/180},getParameters:function(t){t=null===t||void 0===t?window.location.href:t;var e="";if(l.contains(t,"?")){var r=t.indexOf("?")+1,s=l.contains(t,"#")?t.indexOf("#"):t.length;e=t.substring(r,s)}for(var i={},n=e.split(/[&;]/),a=0,o=n.length;a<o;++a){var h=n[a].split("=");if(h[0]){var u=h[0];try{u=decodeURIComponent(u)}catch(t){u=unescape(u)}var c=(h[1]||"").replace(/\+/g," ");try{c=decodeURIComponent(c)}catch(t){c=unescape(c)}1==(c=c.split(",")).length&&(c=c[0]),i[u]=c}}return i},lastSeqID:0,createUniqueID:function(t){return null==t&&(t="id_"),v.lastSeqID+=1,t+v.lastSeqID},normalizeScale:function(t){return t>1?1/t:t},getResolutionFromScale:function(t,e){var r;t&&(null==e&&(e="degrees"),r=1/(v.normalizeScale(t)*b[e]*96));return r},getScaleFromResolution:function(t,e){return null==e&&(e="degrees"),t*b[e]*96},getBrowser:function(){return m},isSupportCanvas:y,supportCanvas:function(){return v.isSupportCanvas},isInTheSameDomain:function(t){if(!t)return!0;return-1===t.indexOf("//")||v.isSameDomain(t,document.location.toString())},isSameDomain:(t,e)=>new(f())(t).normalize().origin()===new(f())(e).normalize().origin(),calculateDpi:function(t,e,r,s,i){if(t&&e&&r){var n,a=t.getWidth(),o=t.getHeight(),l=e.w,h=e.h;if(i=i||6378137,"degree"===(s=s||"degrees").toLowerCase()||"degrees"===s.toLowerCase()||"dd"===s.toLowerCase()){let t=a/l,e=o/h;n=254/(t>e?t:e)/r/(2*Math.PI*i/360)/1e4}else{n=254/(a/l)/r/1e4}return n}},toJSON:function(t){var e=t;if(null==e)return null;switch(e.constructor){case String:return e=(e=(e=(e=(e=(e=(e='"'+e.replace(/(["\\])/g,"\\$1")+'"').replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace("<","&lt;")).replace(">","&gt;")).replace(/%/g,"%25")).replace(/&/g,"%26");case Array:for(var r="",s=0,i=e.length;s<i;s++)r+=v.toJSON(e[s]),s!==e.length-1&&(r+=",");return"["+r+"]";case Number:return isFinite(e)?String(e):null;case Boolean:return String(e);case Date:return"{'__type':\"System.DateTime\",'Year':"+e.getFullYear()+",'Month':"+(e.getMonth()+1)+",'Day':"+e.getDate()+",'Hour':"+e.getHours()+",'Minute':"+e.getMinutes()+",'Second':"+e.getSeconds()+",'Millisecond':"+e.getMilliseconds()+",'TimezoneOffset':"+e.getTimezoneOffset()+"}";default:if(null!=e.toJSON&&"function"==typeof e.toJSON)return e.toJSON();if("object"==typeof e){if(e.length){let t=[];for(let r=0,s=e.length;r<s;r++)t.push(v.toJSON(e[r]));return"["+t.join(",")+"]"}let t=[];for(let r in e)"function"!=typeof e[r]&&"CLASS_NAME"!==r&&"parent"!==r&&t.push("'"+r+"':"+v.toJSON(e[r]));return t.length>0?"{"+t.join(",")+"}":"{}"}return e.toString()}},getResolutionFromScaleDpi:function(t,e,r,s){return s=s||6378137,r=r||"",t>0&&e>0?(t=v.normalizeScale(t),"degree"===r.toLowerCase()||"degrees"===r.toLowerCase()||"dd"===r.toLowerCase()?254/e/t/(2*Math.PI*s/360)/1e4:254/e/t/1e4):-1},getScaleFromResolutionDpi:function(t,e,r,s){return s=s||6378137,r=r||"",t>0&&e>0?"degree"===r.toLowerCase()||"degrees"===r.toLowerCase()||"dd"===r.toLowerCase()?254/e/t/(2*Math.PI*s/360)/1e4:254/e/t/1e4:-1},transformResult:function(t){return t.responseText&&"string"==typeof t.responseText&&(t=JSON.parse(t.responseText)),t},copyAttributes:function(t,e){if(t=t||{},e)for(var r in e){var s=e[r];void 0!==s&&"CLASS_NAME"!==r&&"function"!=typeof s&&(t[r]=s)}return t},copyAttributesWithClip:function(t,e,r){if(t=t||{},e)for(var s in e){var i=!1;if(r&&r.length)for(var n=0,a=r.length;n<a;n++)if(s===r[n]){i=!0;break}if(!0!==i){var o=e[s];void 0!==o&&"CLASS_NAME"!==s&&"function"!=typeof o&&(t[s]=o)}}return t},cloneObject:function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date){let e=new Date;return e.setTime(t.getTime()),e}if(t instanceof Array){return t.slice(0)}if(t instanceof Object){let r={};for(var e in t)t.hasOwnProperty(e)&&(r[e]=v.cloneObject(t[e]));return r}throw new Error("Unable to copy obj! Its type isn't supported.")},lineIntersection:function(t,e,r,s){var i,n,a=null,o=(s.x-r.x)*(t.y-r.y)-(s.y-r.y)*(t.x-r.x),l=(e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x),h=(s.y-r.y)*(e.x-t.x)-(s.x-r.x)*(e.y-t.y);if(0!=h)n=l/h,a=(i=o/h)>=0&&n<=1&&i<=1&&n>=0?new d.Point(t.x+i*(e.x-t.x),t.y+i*(e.y-t.y)):"No Intersection";else if(0==o&&0==l){var u=Math.max(t.y,e.y),c=Math.min(t.y,e.y),p=Math.max(t.x,e.x),f=Math.min(t.x,e.x);a=(r.y>=c&&r.y<=u||s.y>=c&&s.y<=u)&&r.x>=f&&r.x<=p||s.x>=f&&s.x<=p?"Coincident":"Parallel"}else a="Parallel";return a},getTextBounds:function(t,e,r){document.body.appendChild(r),r.style.width="auto",r.style.height="auto",t.fontSize&&(r.style.fontSize=t.fontSize),t.fontFamily&&(r.style.fontFamily=t.fontFamily),t.fontWeight&&(r.style.fontWeight=t.fontWeight),r.style.position="relative",r.style.visibility="hidden",r.style.display="inline-block",r.innerHTML=e;var s=r.clientWidth,i=r.clientHeight;return document.body.removeChild(r),{textWidth:s,textHeight:i}},convertPath:function(t,e){return e?t.replace(/\{([\w-\.]+)\}/g,(t,r)=>{var s;return s=e.hasOwnProperty(r)?function(t){if(void 0==t||null==t)return"";if(t instanceof Date)return t.toJSON();if(function(t){if("string"!=typeof t&&"object"!=typeof t)return!1;try{const e=t.toString();return"[object Object]"===e||"[object Array]"===e}catch(t){return!1}}(t))return JSON.stringify(t);return t.toString()}(e[r]):t,encodeURIComponent(s)}):t}},b={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};b.in=b.inches,b.degrees=b.dd,b.nmi=1852*b.m;const S=.0254000508001016;v.extend(b,{Inch:b.inches,Meter:39.37,Foot:12,IFoot:11.999976,ClarkeFoot:11.999868327581488,SearsFoot:11.999955194477684,GoldCoastFoot:11.999964589846002,IInch:.9999979999999999,MicroInch:999998e-9,Mil:9.99998e-7,Centimeter:.3937,Kilometer:39370,Yard:36,SearsYard:35.99986558343306,IndianYard:35.99987015540864,IndianYd37:35.999740205100004,IndianYd62:35.999880755999996,IndianYd75:35.999868945,IndianFoot:11.9999567087,IndianFt37:11.9999134017,IndianFt62:11.999960252000001,IndianFt75:11.999956315,Mile:63360,IYard:35.999928,IMile:63359.87328,NautM:72913.24,"Lat-66":4367838.370169282,"Lat-83":4367954.152606599,Decimeter:3.9370000000000003,Millimeter:.03937,Dekameter:393.7,Decameter:393.7,Hectometer:3937,GermanMeter:39.370535294205006,CaGrid:39.359685060000004,ClarkeChain:791.991309620512,GunterChain:792.0000000000001,BenoitChain:791.9977268035781,SearsChain:791.9970428354235,ClarkeLink:7.91991309620512,GunterLink:7.920000000000001,BenoitLink:7.919977268035781,SearsLink:7.919970428354236,Rod:198.00000000000014,IntnlChain:791.998416,IntnlLink:7.91998416,Perch:198.00000000000014,Pole:198.00000000000014,Furlong:7919.999999999997,Rood:148.75036777426,CapeFoot:11.999868185255002,Brealey:14763.75,ModAmFt:12.000458400000001,Fathom:71.999856,"NautM-UK":72959.85408,"50kilometers":1968500,"150kilometers":5905500}),v.extend(b,{mm:b.Meter/1e3,cm:b.Meter/100,dm:100*b.Meter,km:1e3*b.Meter,kmi:b.nmi,fath:b.Fathom,ch:b.IntnlChain,link:b.IntnlLink,"us-in":b.inches,"us-ft":b.Foot,"us-yd":b.Yard,"us-ch":b.GunterChain,"us-mi":b.Mile,"ind-yd":b.IndianYd37,"ind-ft":b.IndianFt37,"ind-ch":791.9942845122}),b.degree=b.dd,b.meter=b.m,b.foot=b.ft,b.inch=b.inches,b.mile=b.mi,b.kilometer=b.km,b.yard=b.yd;class _{constructor(t,e){v.isArray(t)&&(e=t[1],t=t[0]),this.lon=t?v.toFloat(t):0,this.lat=e?v.toFloat(e):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new _(this.lon,this.lat)}add(t,e){if(null==t||null==e)throw new TypeError("LonLat.add cannot receive null values");return new _(this.lon+v.toFloat(t),this.lat+v.toFloat(e))}equals(t){var e=!1;return null!=t&&(e=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),e}wrapDateLine(t){var e=this.clone();if(t){for(;e.lon<t.left;)e.lon+=t.getWidth();for(;e.lon>t.right;)e.lon-=t.getWidth()}return e}destroy(){this.lon=null,this.lat=null}static fromString(t){var e=t.split(",");return new _(e[0],e[1])}static fromArray(t){var e=v.isArray(t),r=e&&t[0],s=e&&t[1];return new _(r,s)}}class x{constructor(t,e,r,s){v.isArray(t)&&(s=t[3],r=t[2],e=t[1],t=t[0]),this.left=null!=t?v.toFloat(t):this.left,this.bottom=null!=e?v.toFloat(e):this.bottom,this.right=null!=r?v.toFloat(r):this.right,this.top=null!=s?v.toFloat(s):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new x(this.left,this.bottom,this.right,this.top)}equals(t){var e=!1;return null!=t&&(e=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),e}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return!0===t?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,e){null==t&&(t=6);var r=Math.pow(10,t),s=Math.round(this.left*r)/r,i=Math.round(this.bottom*r)/r,n=Math.round(this.right*r)/r,a=Math.round(this.top*r)/r;return!0===e?i+","+s+","+a+","+n:s+","+i+","+n+","+a}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new n(this.getWidth(),this.getHeight())}getCenterPixel(){return new a((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new _((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,e){var r,s;t=t||1,null==e&&(e=this.getCenterLonLat()),"SuperMap.LonLat"===e.CLASS_NAME?(r=e.lon,s=e.lat):(r=e.x,s=e.y);var i=(this.left-r)*t+r,n=(this.bottom-s)*t+s,a=(this.right-r)*t+r,o=(this.top-s)*t+s;return new x(i,n,a,o)}add(t,e){if(null==t||null==e)throw new TypeError("Bounds.add cannot receive null values");return new x(this.left+t,this.bottom+e,this.right+t,this.top+e)}extend(t){var e=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":e=new x(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":e=new x(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":e=t}e&&(this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top))}}containsLonLat(t,e){"boolean"==typeof e&&(e={inclusive:e}),e=e||{};var r=this.contains(t.lon,t.lat,e.inclusive),s=e.worldBounds;if(s&&!r){var i=s.getWidth(),n=(s.left+s.right)/2,a=Math.round((t.lon-n)/i);r=this.containsLonLat({lon:t.lon-a*i,lat:t.lat},{inclusive:e.inclusive})}return r}containsPixel(t,e){return this.contains(t.x,t.y,e)}contains(t,e,r){if(null==r&&(r=!0),null==t||null==e)return!1;return r?t>=this.left&&t<=this.right&&e>=this.bottom&&e<=this.top:t>this.left&&t<this.right&&e>this.bottom&&e<this.top}intersectsBounds(t,e){if("boolean"==typeof e&&(e={inclusive:e}),(e=e||{}).worldBounds){var r=this.wrapDateLine(e.worldBounds);t=t.wrapDateLine(e.worldBounds)}else r=this;null==e.inclusive&&(e.inclusive=!0);var s=!1,i=r.left===t.right||r.right===t.left||r.top===t.bottom||r.bottom===t.top;if(e.inclusive||!i){var n=t.bottom>=r.bottom&&t.bottom<=r.top||r.bottom>=t.bottom&&r.bottom<=t.top,a=t.top>=r.bottom&&t.top<=r.top||r.top>t.bottom&&r.top<t.top,o=t.left>=r.left&&t.left<=r.right||r.left>=t.left&&r.left<=t.right,l=t.right>=r.left&&t.right<=r.right||r.right>=t.left&&r.right<=t.right;s=(n||a)&&(o||l)}if(e.worldBounds&&!s){var h=e.worldBounds,u=h.getWidth(),c=!h.containsBounds(r),d=!h.containsBounds(t);c&&!d?(t=t.add(-u,0),s=r.intersectsBounds(t,{inclusive:e.inclusive})):d&&!c&&(r=r.add(-u,0),s=t.intersectsBounds(r,{inclusive:e.inclusive}))}return s}containsBounds(t,e,r){null==e&&(e=!1),null==r&&(r=!0);var s=this.contains(t.left,t.bottom,r),i=this.contains(t.right,t.bottom,r),n=this.contains(t.left,t.top,r),a=this.contains(t.right,t.top,r);return e?s||i||n||a:s&&i&&n&&a}determineQuadrant(t){var e="",r=this.getCenterLonLat();return e+=t.lat<r.lat?"b":"t",e+=t.lon<r.lon?"l":"r"}wrapDateLine(t,e){var r=(e=e||{}).leftTolerance||0,s=e.rightTolerance||0,i=this.clone();if(t){for(var n=t.getWidth();i.left<t.left&&i.right-s<=t.left;)i=i.add(n,0);for(;i.left+r>=t.right&&i.right>t.right;)i=i.add(-n,0);var a=i.left+r;a<t.right&&a>t.left&&i.right-s>t.right&&(i=i.add(-n,0))}return i}toServerJSONObject(){return{rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom}}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,e){var r=t.split(",");return x.fromArray(r,e)}static fromArray(t,e){return!0===e?new x(t[1],t[0],t[3],t[2]):new x(t[0],t[1],t[2],t[3])}static fromSize(t){return new x(0,t.h,t.w,0)}static oppositeQuadrant(t){var e="";return e+="t"===t.charAt(0)?"b":"t",e+="l"===t.charAt(1)?"r":"l"}}class w extends d{constructor(t,e,r,s){super(t,e,r,s),this.x=parseFloat(t),this.y=parseFloat(e),this.tag=s||0==s?parseFloat(s):null,this.type=r||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return null==t&&(t=new w(this.x,this.y)),v.applyDefaults(t,this),t}calculateBounds(){this.bounds=new x(this.x,this.y,this.x,this.y)}equals(t){var e=!1;return null!=t&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}move(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(){return[this]}}class A extends d{constructor(t){super(),this.components=[],this.componentTypes=null,null!=t&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){for(var t=new A,e=0,r=this.components.length;e<r;e++)t.addComponent(this.components[e].clone());return v.applyDefaults(t,this),t}getComponentsString(){for(var t=[],e=0,r=this.components.length;e<r;e++)t.push(this.components[e].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;var t=new x,e=this.components;if(e)for(var r=0,s=e.length;r<s;r++)t.extend(e[r].getBounds());null!=t.left&&null!=t.bottom&&null!=t.right&&null!=t.top&&this.setBounds(t)}addComponents(t){v.isArray(t)||(t=[t]);for(var e=0,r=t.length;e<r;e++)this.addComponent(t[e])}addComponent(t,e){var r=!1;if(t&&(null==this.componentTypes||v.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(null!=e&&e<this.components.length){var s=this.components.slice(0,e),i=this.components.slice(e,this.components.length);s.push(t),this.components=s.concat(i)}else this.components.push(t);t.parent=this,this.clearBounds(),r=!0}return r}removeComponents(t){var e=!1;v.isArray(t)||(t=[t]);for(var r=t.length-1;r>=0;--r)e=this.removeComponent(t[r])||e;return e}removeComponent(t){return v.removeItem(this.components,t),this.clearBounds(),!0}getArea(){for(var t=0,e=0,r=this.components.length;e<r;e++)t+=this.components[e].getArea();return t}equals(t){var e=!0;if(t&&t.CLASS_NAME&&this.CLASS_NAME===t.CLASS_NAME)if(v.isArray(t.components)&&t.components.length===this.components.length){for(var r=0,s=this.components.length;r<s;++r)if(!this.components[r].equals(t.components[r])){e=!1;break}}else e=!1;else e=!1;return e}getVertices(t){for(var e=[],r=0,s=this.components.length;r<s;++r)Array.prototype.push.apply(e,this.components[r].getVertices(t));return e}}class M extends A{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,e){this.addComponent(t,e)}removePoint(t){this.removeComponent(t)}}class C extends M{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}class E extends C{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){var e=this.components&&this.components.length>2;return e&&super.removeComponent.apply(this,arguments),e}getSortedSegments(){for(var t,e,r=this.components.length-1,s=new Array(r),i=0;i<r;++i)t=this.components[i],e=this.components[i+1],t.x<e.x?s[i]={x1:t.x,y1:t.y,x2:e.x,y2:e.y}:s[i]={x1:e.x,y1:e.y,x2:t.x,y2:t.y};return s.sort(function(t,e){return t.x1-e.x1})}getVertices(t){return!0===t?[this.components[0],this.components[this.components.length-1]]:!1===t?this.components.slice(1,this.components.length-1):this.components.slice()}static calculateCircle(t){if(t.length<3)return t;var e={},r=t[0],s=t[1],i=t[2],n=0,a=0,o=!0,l=0,h=0,u=0,c=[],d=(i.y-r.y)/(i.x-r.x),p=i.y-d*i.x;if(i.x!=r.x&&i.y!=r.y&&s.y==d*s.x+p||i.x==r.x&&s.x==r.x||i.y==r.y&&s.y==r.y||i.x==r.x&&i.y==r.y||i.x==s.x&&i.y==s.y||r.x==s.x&&r.y==s.y)c.push(r),c.push(s),c.push(i);else{var f=(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y))*(2*(i.y-r.y))-(i.x*i.x+i.y*i.y-(r.x*r.x+r.y*r.y))*(2*(s.y-r.y)),m=2*(s.x-r.x)*(i.x*i.x+i.y*i.y-(r.x*r.x+r.y*r.y))-2*(i.x-r.x)*(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y)),y=4*((s.x-r.x)*(i.y-r.y)-(i.x-r.x)*(s.y-r.y));e.x=f/y,e.y=m/y;var g=(2*(n=Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y)))*n-((r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y)))/(2*n*n);g=(g=g>=1?1:g)<=-1?-1:g,u=180*Math.acos(g)/Math.PI,a=(u=i.x==r.x?e.x>r.x&&s.x>r.x||e.x<r.x&&s.x<r.x?360-u:u:e.y>d*e.x+p&&s.y>d*s.x+p||e.y<d*e.x+p&&s.y<d*s.x+p?360-u:u)/72,i.y!=r.y?i.x==r.x?i.y>r.y?s.x<r.x&&(o=!1):s.x>r.x&&(o=!1):i.x<r.x?s.y<d*s.x+p&&(o=!1):s.y>d*s.x+p&&(o=!1):i.x>r.x?s.y>r.y&&(o=!1):s.y<r.y&&(o=!1);var v=(r.y-e.y)/(r.x-e.x),b=v>=0?180*Math.atan(v)/Math.PI:Math.abs(180*Math.atan(v)/Math.PI)+90,S=Math.abs(e.y);r.y==S&&S==i.y&&r.x<i.x&&(b+=180);var _=r.y-e.y;c.push(r);for(var x=1;x<72;x++){l=a*x,h=b,o?_>=0?v>=0?h+=l:h=180-(h-90)+l:h=v>0?h-180+l:90-h+l:_>=0?v>=0?h-=l:h=180-(h-90)-l:h=v>=0?h-180-l:90-h-l,h=h*Math.PI/180;var A=e.x+n*Math.cos(h),M=e.y+n*Math.sin(h);c.push(new w(A,M))}c.push(i)}return c}static createLineEPS(t){var e=[],r=t.length;if(r<2)return t;for(var s=0;s<r;){if("LTypeArc"==t[s].type){var i=E.createLineArc(e,s,r,t);e=i[0],s=i[1]}else e.push(t[s]),s++}return e}static createLineArc(t,e,r,s){if(0==e){let i=E.addPointEPS(s,e,r,"LTypeArc");Array.prototype.push.apply(t,i[0]),e=i[1]+1}else if(e==r-1){var i=[s[e-1],s[e]],n=E.calculateCircle(i);Array.prototype.push.apply(t,n),e++}else{let i=E.addPointEPS(s,e,r,"LTypeArc");t.pop(),Array.prototype.push.apply(t,i[0]),e=i[1]+1}return[t,e]}static addPointEPS(t,e,r,s){var i,n=[],a=e+1;return 0==e?Array.prototype.push.apply(n,[t[e],t[e+1]]):e==r-1?Array.prototype.push.apply(n,[t[e-1],t[e]]):Array.prototype.push.apply(n,[t[e-1],t[e],t[e+1]]),"LTypeCurve"==s?i=E.calculatePointsFBZN(n):"LTypeArc"==s&&(i=E.calculateCircle(n)),[i,a]}}class T extends E{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,e){var r=!1,s=this.components.pop();null==e&&t.equals(s)||(r=super.addComponent.apply(this,arguments));var i=this.components[0];return super.addComponent.apply(this,[i]),r}removeComponent(t){var e=this.components&&this.components.length>3;if(e){this.components.pop(),super.removeComponent.apply(this,arguments);var r=this.components[0];super.addComponent.apply(this,[r])}return e}getArea(){var t=0;if(this.components&&this.components.length>2){for(var e=0,r=0,s=this.components.length;r<s-1;r++){var i=this.components[r],n=this.components[r+1];e+=(i.x+n.x)*(n.y-i.y)}t=-e/2}return t}getVertices(t){return!0===t?[]:this.components.slice(0,this.components.length-1)}}class O extends A{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(var e=1,r=this.components.length;e<r;e++)t-=Math.abs(this.components[e].getArea())}return t}}class P{constructor(t,e,r){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=v.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=null!=r?r:{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}const L={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};class I extends P{constructor(t,e,r){super(null,null,e),this.fid=null,this.geometry=t||null,this.attributes={},e&&(this.attributes=v.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=r||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",I.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new I(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===L.UPDATE)switch(this.state){case L.UNKNOWN:case L.DELETE:this.state=t;break;case L.UPDATE:case L.INSERT:}else if(t===L.INSERT)switch(this.state){case L.UNKNOWN:break;default:this.state=t}else if(t===L.DELETE)switch(this.state){case L.INSERT:case L.DELETE:break;case L.UNKNOWN:case L.UPDATE:this.state=t}else t===L.UNKNOWN&&(this.state=t)}}class N{constructor(t){this.data=null,this.keepData=!1,v.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}class k extends N{constructor(t){super(t),this.indent="    ",this.space=" ",this.newline="\n",this.level=0,this.pretty=!1,this.nativeJSON=!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(t){if(null==t)return"null";if(t.constructor===Date)return this.serialize.date.apply(this,[t]);if(t.constructor===Array)return this.serialize.array.apply(this,[t]);var e,r,s,i=["{"];this.level+=1;var n=!1;for(e in t)t.hasOwnProperty(e)&&(r=this.write.apply(this,[e,this.pretty]),s=this.write.apply(this,[t[e],this.pretty]),null!=r&&null!=s&&(n&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),s),n=!0));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"}"),i.join("")},array:function(t){var e,r=["["];this.level+=1;for(var s=0,i=t.length;s<i;++s)null!=(e=this.write.apply(this,[t[s],this.pretty]))&&(s>0&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),e));return this.level-=1,r.push(this.writeNewline(),this.writeIndent(),"]"),r.join("")},string:function(t){var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(t)?'"'+t.replace(/([\x00-\x1f\\"])/g,function(t,r){var s=e[r];return s||(s=r.charCodeAt(),"\\u00"+Math.floor(s/16).toString(16)+(s%16).toString(16))})+'"':'"'+t+'"'},number:function(t){return isFinite(t)?String(t):"null"},boolean:function(t){return String(t)},date:function(t){function e(t){return t<10?"0"+t:t}return'"'+t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+'"'}}}read(t,e){var r;if(this.nativeJSON)try{r=JSON.parse(t,e)}catch(e){return{data:t}}return this.keepData&&(this.data=r),r}write(t,e){this.pretty=!!e;var r=null,s=typeof t;if(this.serialize[s])try{r=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[s].apply(this,[t])}catch(t){}return r}writeIndent(){var t=[];if(this.pretty)for(var e=0;e<this.level;++e)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class R extends A{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}class D extends A{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}class F{constructor(t,e,r){this.red=t||0==t?t:255,this.green=e||0,this.blue=r||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){this.red=null,this.green=null,this.blue=null}static fromJson(t){if(t){var e=new F,r=255;null!==t.red&&(r=Number(t.red)),e.red=r;var s=0;null!==t.green&&(s=Number(t.green)),e.green=s;var i=0;return null!==t.blue&&(i=Number(t.blue)),e.blue=i,e}}}class B{constructor(t){this.fillBackColor=new F(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new F(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new F(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){var t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){var t={};return t=v.copyAttributes(t,this)}static fromJson(t){if(t)return new B({fillBackColor:F.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:F.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:F.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}class G extends w{constructor(t){super(t),this.measure=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){var e=!1;if(null!=t){var r=this.x===t.x&&this.y===t.y&&this.measure===t.measure,s=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),i=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);e=r||s&&i}return e}toJson(){var t="{";return null!=this.measure&&void 0!=this.measure&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}"}destroy(){this.measure=null,this.x=null,this.y=null}static fromJson(t){if(t)return new G({x:t.x,y:t.y,measure:t.measure})}}class j extends A{constructor(t,e){super(t,e),this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],e&&v.extend(this,e),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){var t="{";if(null!=this.id&&void 0!=this.id&&(t+='"id":'+this.id+","),null!=this.center&&void 0!=this.center&&(t+='"center":'+this.center+","),null!=this.style&&void 0!=this.style&&(t+='"style":'+this.style+","),null!=this.length&&void 0!=this.length&&(t+='"length":'+this.length+","),null!=this.maxM&&void 0!=this.maxM&&(t+='"maxM":'+this.maxM+","),null!=this.minM&&void 0!=this.minM&&(t+='"minM":'+this.minM+","),null!=this.type&&void 0!=this.type&&(t+='"type":"'+this.type+'",'),null!=this.parts&&void 0!=this.parts){t+='"parts":['+this.parts[0];for(var e=1;e<this.parts.length;e++)t+=","+this.parts[e];t+="],"}if(null!=this.components&&this.components.length>0){t+='"points":[';for(var r=0,s=this.components.length;r<s;r++)for(var i=0,n=this.components[r].components.length;i<n;i++)t+=this.components[r].components[i].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}"}destroy(){var t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(t){var e=t.parts||[],r=t.points||[],s=e.length,i=[];if(!(s>0))return null;for(var n=0,a=0,o=[];n<s;n++){for(var l=0;l<e[n];l++)o.push(G.fromJson(r[a+l]));a+=e[n],o[0].equals(o[e[n]-1])?i.push(new T(o)):i.push(new E(o)),o=[]}return new j(i,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}}var U={GEOJSON:"GEOJSON",ISERVER:"ISERVER",FGB:"FGB"},J={ISERVER:"ISERVER",IPORTAL:"IPORTAL",ONLINE:"ONLINE"},z={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",POINTEPS:"POINTEPS",LINEEPS:"LINEEPS",REGIONEPS:"REGIONEPS",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",RECTANGLE:"RECTANGLE",UNKNOWN:"UNKNOWN",GEOCOMPOUND:"GEOCOMPOUND"},q={ATTRIBUTE:"ATTRIBUTE",ATTRIBUTEANDGEOMETRY:"ATTRIBUTEANDGEOMETRY",GEOMETRY:"GEOMETRY"},V={CONTAIN:"CONTAIN",CROSS:"CROSS",DISJOINT:"DISJOINT",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",NONE:"NONE",OVERLAP:"OVERLAP",TOUCH:"TOUCH",WITHIN:"WITHIN"},H={DISTANCE:"DISTANCE",AREA:"AREA"},W={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"},Q={CENTIMETER:"CENTIMETER",DECIMETER:"DECIMETER",FOOT:"FOOT",INCH:"INCH",KILOMETER:"KILOMETER",METER:"METER",MILE:"MILE",MILLIMETER:"MILLIMETER",YARD:"YARD"},Y={CAPTION:"CAPTION",CAPTION_PERCENT:"CAPTION_PERCENT",CAPTION_VALUE:"CAPTION_VALUE",PERCENT:"PERCENT",VALUE:"VALUE"},X={AREA:"AREA",BAR:"BAR",BAR3D:"BAR3D",LINE:"LINE",PIE:"PIE",PIE3D:"PIE3D",POINT:"POINT",RING:"RING",ROSE:"ROSE",ROSE3D:"ROSE3D",STACK_BAR:"STACK_BAR",STACK_BAR3D:"STACK_BAR3D",STEP:"STEP"},Z={ALL:"ALL",NONE:"NONE",YAXES:"YAXES"},K={CONSTANT:"CONSTANT",LOGARITHM:"LOGARITHM",SQUAREROOT:"SQUAREROOT"},$={CUSTOMINTERVAL:"CUSTOMINTERVAL",EQUALINTERVAL:"EQUALINTERVAL",LOGARITHM:"LOGARITHM",QUANTILE:"QUANTILE",SQUAREROOT:"SQUAREROOT",STDDEVIATION:"STDDEVIATION"},tt={BLACK_WHITE:"BLACKWHITE",BLUE_BLACK:"BLUEBLACK",BLUE_RED:"BLUERED",BLUE_WHITE:"BLUEWHITE",CYAN_BLACK:"CYANBLACK",CYAN_BLUE:"CYANBLUE",CYAN_GREEN:"CYANGREEN",CYAN_WHITE:"CYANWHITE",GREEN_BLACK:"GREENBLACK",GREEN_BLUE:"GREENBLUE",GREEN_ORANGE_VIOLET:"GREENORANGEVIOLET",GREEN_RED:"GREENRED",GREEN_WHITE:"GREENWHITE",PINK_BLACK:"PINKBLACK",PINK_BLUE:"PINKBLUE",PINK_RED:"PINKRED",PINK_WHITE:"PINKWHITE",RAIN_BOW:"RAINBOW",RED_BLACK:"REDBLACK",RED_WHITE:"REDWHITE",SPECTRUM:"SPECTRUM",TERRAIN:"TERRAIN",YELLOW_BLACK:"YELLOWBLACK",YELLOW_BLUE:"YELLOWBLUE",YELLOW_GREEN:"YELLOWGREEN",YELLOW_RED:"YELLOWRED",YELLOW_WHITE:"YELLOWWHITE"},et={TOPLEFT:"TOPLEFT",TOPCENTER:"TOPCENTER",TOPRIGHT:"TOPRIGHT",BASELINELEFT:"BASELINELEFT",BASELINECENTER:"BASELINECENTER",BASELINERIGHT:"BASELINERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOMCENTER:"BOTTOMCENTER",BOTTOMRIGHT:"BOTTOMRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLECENTER:"MIDDLECENTER",MIDDLERIGHT:"MIDDLERIGHT"},rt={NORMAL:"ALONG_LINE_NORMAL",LB_TO_RT:"LEFT_BOTTOM_TO_RIGHT_TOP",LT_TO_RB:"LEFT_TOP_TO_RIGHT_BOTTOM",RB_TO_LT:"RIGHT_BOTTOM_TO_LEFT_TOP",RT_TO_LB:"RIGHT_TOP_TO_LEFT_BOTTOM"},st={DIAMOND:"DIAMOND",ELLIPSE:"ELLIPSE",MARKER:"MARKER",NONE:"NONE",RECT:"RECT",ROUNDRECT:"ROUNDRECT",TRIANGLE:"TRIANGLE"},it={NEWLINE:"NEWLINE",NONE:"NONE",OMIT:"OMIT"},nt={FLAT:"FLAT",ROUND:"ROUND"},at={CLIP:"CLIP",ERASE:"ERASE",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",UNION:"UNION",UPDATE:"UPDATE",XOR:"XOR"},ot={INDEXEDHDFS:"INDEXEDHDFS",UDB:"UDB",MONGODB:"MONGODB",PG:"PG"},lt={BSPLINE:"BSPLINE",POLISH:"POLISH"},ht={ISOLINE:"ISOLINE",ISOREGION:"ISOREGION"},ut={DATASET_AND_RECORDSET:"DATASET_AND_RECORDSET",DATASET_ONLY:"DATASET_ONLY",RECORDSET_ONLY:"RECORDSET_ONLY"},ct={ADD:"add",UPDATE:"update",DELETE:"delete"},dt={LESS_TIME:"LESS_TIME",LESS_TRANSFER:"LESS_TRANSFER",LESS_WALK:"LESS_WALK",MIN_DISTANCE:"MIN_DISTANCE"},pt={BUS:"BUS",SUBWAY:"SUBWAY",NO_SUBWAY:"NO_SUBWAY",NONE:"NONE"},ft={EXPONENTIAL:"EXPONENTIAL",GAUSSIAN:"GAUSSIAN",SPHERICAL:"SPHERICAL"},mt={EXP1:"EXP1",EXP2:"EXP2"},yt={IP:"IP",REFERER:"Referer",REQUESTIP:"RequestIP",NONE:"NONE",SERVER:"SERVER",WEB:"WEB"},gt={CLIP:"clip",INTERSECT:"intersect"},vt={SQUAREMETER:"SquareMeter",SQUAREKILOMETER:"SquareKiloMeter",HECTARE:"Hectare",ARE:"Are",ACRE:"Acre",SQUAREFOOT:"SquareFoot",SQUAREYARD:"SquareYard",SQUAREMILE:"SquareMile"},bt={METER:"Meter",KILOMETER:"Kilometer",YARD:"Yard",FOOT:"Foot",MILE:"Mile"},St={MAX:"max",MIN:"min",AVERAGE:"average",SUM:"sum",VARIANCE:"variance",STDDEVIATION:"stdDeviation"},_t={SUMMARYMESH:"SUMMARYMESH",SUMMARYREGION:"SUMMARYREGION"},xt={REGIONNOOVERLAP:"REGIONNOOVERLAP",REGIONNOOVERLAPWITH:"REGIONNOOVERLAPWITH",REGIONCONTAINEDBYREGION:"REGIONCONTAINEDBYREGION",REGIONCOVEREDBYREGION:"REGIONCOVEREDBYREGION",LINENOOVERLAP:"LINENOOVERLAP",LINENOOVERLAPWITH:"LINENOOVERLAPWITH",POINTNOIDENTICAL:"POINTNOIDENTICAL"},wt={GEOHASH_GRID:"geohash_grid"},At={AVG:"avg",MAX:"max",MIN:"min",SUM:"sum"},Mt={NDVI:"NDVI",HILLSHADE:"HILLSHADE"},Ct={CUSTOM:"CUSTOM",INTERSECTION:"INTERSECTION",UNION:"UNION"},Et={CUSTOM:"CUSTOM",MAX:"MAX",MIN:"MIN"};class Tt{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){var t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){var t=this;switch(t.type.toUpperCase()){case z.POINT:return t.toGeoPoint();case z.LINE:return t.toGeoLine();case z.LINEM:return t.toGeoLinem();case z.REGION:return t.toGeoRegion();case z.POINTEPS:return t.toGeoPoint();case z.LINEEPS:return t.toGeoLineEPS();case z.REGIONEPS:return t.toGeoRegionEPS();case z.GEOCOMPOUND:return t.transformGeoCompound()}}toGeoPoint(){var t=this.parts||[],e=this.points||[],r=t.length;if(r>0){if(1===r)return new w(e[0].x,e[0].y);var s=[];for(let t=0;t<r;t++)s.push(new w(e[t].x,e[t].y));return new M(s)}return null}toGeoLine(){var t=this.parts||[],e=this.points||[],r=t.length;if(r>0){if(1===r){let r=[];for(let s=0;s<t[0];s++)r.push(new w(e[s].x,e[s].y));return r[0].equals(r[t[0]-1])?new T(r):new E(r)}{let s=[];for(let i=0;i<r;i++){let r=[];for(let s=0;s<t[i];s++)r.push(new w(e[s].x,e[s].y));s.push(new E(r)),e.splice(0,t[i])}return new R(s)}}return null}toGeoLineEPS(){var t,e,r,s,i,n=this.parts||[],a=this.points||[],o=n.length;if(o>0){if(1===o){for(t=0,r=[];t<n[0];t++)r.push(new w(a[t].x,a[t].y,a[t].type));return r[0].equals(r[n[0]-1])?(i=E.createLineEPS(r),new T(i)):(i=E.createLineEPS(r),new E(i))}for(t=0,s=[];t<o;t++){for(e=0,r=[];e<n[t];e++)r.push(new w(a[e].x,a[e].y));i=E.createLineEPS(r),s.push(new E(i)),a.splice(0,n[t])}return new R(s)}return null}toGeoLinem(){return j.fromJson(this)}toGeoRegion(){var t=this.parts||[],e=this.partTopo||[],r=this.points||[],s=t.length;if(s<=0)return null;var i=[],n=[];if(1==s){for(let t=0;t<r.length;t++)n.push(new w(r[t].x,r[t].y));return i.push(new O([new T(n)])),new D(i)}var a=[],o=[],l=[],h=[],u=[];for(let i=0,a=0;i<s;i++){for(let e=0;e<t[i];e++)n.push(new w(r[a+e].x,r[a+e].y));a+=t[i];var c=new O([new T(n)]);n=[],l.push(c),0===e.length&&h.push(c.getBounds()),u.push(1),o.push(c.getArea())}if(0===e.length){Tt.bubbleSort(o,l,e,h);var d=[];for(let t=1;t<l.length;t++)for(let e=t-1;e>=0;e--)if(d[t]=-1,h[e].containsBounds(h[t])){u[t]=-1*u[e],u[t]<0&&(d[t]=e);break}for(let t=0;t<l.length;t++)u[t]>0?i.push(l[t]):(i[d[t]].components=i[d[t]].components.concat(l[t].components),i.push(""))}else{i=new Array;for(let t=0;t<l.length;t++)if(e[t]&&-1==e[t]?a=a.concat(l[t].components):(a.length>0&&i.length>0&&(i[i.length-1].components=i[i.length-1].components.concat(a),a=[]),i.push(l[t])),t==s-1){var p=i.length;if(p)i[p-1].components=i[p-1].components.concat(a);else for(let t=0,e=a.length;t<e;t++)i.push(new O(a))}}return new D(i)}toGeoRegionEPS(){var t=this.parts||[],e=this.partTopo||[],r=this.points||[],s=t.length;if(s<=0)return null;var i,n=[],a=[];if(1==s){for(var o=0;o<r.length;o++)a.push(new w(r[o].x,r[o].y));return i=E.createLineEPS(a),n.push(new O([new T(i)])),new D(n)}var l=[],h=[],u=[],c=[],d=[];for(let n=0,o=0;n<s;n++){for(let e=0;e<t[n];e++)a.push(new w(r[o+e].x,r[o+e].y));o+=t[n],i=E.createLineEPS(a);var p=new O([new T(i)]);a=[],u.push(p),0===e.length&&c.push(p.getBounds()),d.push(1),h.push(p.getArea())}if(0===e.length){Tt.bubbleSort(h,u,e,c);var f=[];for(let t=1;t<u.length;t++)for(let e=t-1;e>=0;e--)if(f[t]=-1,c[e].containsBounds(c[t])){d[t]=-1*d[e],d[t]<0&&(f[t]=e);break}for(let t=0;t<u.length;t++)d[t]>0?n.push(u[t]):(n[f[t]].components=n[f[t]].components.concat(u[t].components),n.push(""))}else{n=new Array;for(let t=0;t<u.length;t++)if(e[t]&&-1==e[t]?l=l.concat(u[t].components):(l.length>0&&n.length>0&&(n[n.length-1].components=n[n.length-1].components.concat(l),l=[]),n.push(u[t])),t==s-1){var m=n.length;if(m)n[m-1].components=n[m-1].components.concat(l);else for(let t=0,e=l.length;t<e;t++)n.push(new O(l))}}return new D(n)}transformGeoCompound(){const t=this.geoParts||[],e=t.length;if(e<=0)return null;const r=[];for(let s=0;s<e;s++){const e=t[s];r.push(new Tt(e).toGeometry())}return new A(r)}static fromJson(t){if(t)return new Tt({id:t.id,style:B.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(t){var e=0,r=[],s=[],i=null,n=t.components,a=t.CLASS_NAME,o={epsgCode:t.SRID};if(isNaN(t.id)||(e=t.id),"SuperMap.Geometry.LinearRing"!=a&&"SuperMap.Geometry.LineString"!=a&&(t instanceof M||t instanceof R)){let t=n.length;for(let e=0;e<t;e++){const t=n[e].getVertices();let i=t.length;r.push(i);for(let e=0;e<i;e++)s.push(new w(t[e].x,t[e].y))}i="SuperMap.Geometry.MultiPoint"==a?z.POINT:z.LINE}else if(t instanceof D){let t=n.length;for(let e=0;e<t;e++){let t=n[e].components,i=t.length;for(let e=0;e<i;e++){const i=t[e].getVertices(),n=i.length+1;r.push(n);for(let t=0;t<n-1;t++)s.push(new w(i[t].x,i[t].y));s.push(new w(i[0].x,i[0].y))}}i=z.REGION}else if(t instanceof O){let t=n.length;for(let e=0;e<t;e++){const t=n[e].getVertices();let i=t.length+1;r.push(i);for(let e=0;e<i-1;e++)s.push(new w(t[e].x,t[e].y));s.push(new w(t[0].x,t[0].y))}i=z.REGION}else{const e=t.getVertices();let n=e.length;for(let t=0;t<n;t++)s.push(new w(e[t].x,e[t].y));t instanceof T&&(s.push(new w(e[0].x,e[0].y)),n++),r.push(n),i=t instanceof w?z.POINT:z.LINE}return new Tt({id:e,style:null,parts:r,points:s,type:i,prjCoordSys:o})}}static IsClockWise(t){var e=t.length;if(e<3)return 0;var r=t[0].y*(t[e-1].x-t[1].x);t.push(t[0]);for(var s=1;s<e;s++)r+=t[s].y*(t[s-1].x-t[s+1].x);return.5*r}static bubbleSort(t,e,r,s){for(var i=0;i<t.length;i++)for(var n=0;n<t.length;n++)if(t[i]>t[n]){var a=t[n];t[n]=t[i],t[i]=a;var o=e[n];if(e[n]=e[i],e[i]=o,r&&r.length>0){var l=r[n];r[n]=r[i],r[i]=l}if(s&&s.length>0){var h=s[n];s[n]=s[i],s[i]=h}}}}class Ot extends k{constructor(t){super(t),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(t){if(!1===this.ignoreExtraDims&&2!=t.length)throw"Only 2D points are supported: "+t;return new w(t[0],t[1])},multipoint:function(t){for(var e=[],r=null,s=0,i=t.length;s<i;++s){try{r=this.parseCoords.point.apply(this,[t[s]])}catch(t){throw t}e.push(r)}return new M(e)},linestring:function(t){for(var e=[],r=null,s=0,i=t.length;s<i;++s){try{r=this.parseCoords.point.apply(this,[t[s]])}catch(t){throw t}e.push(r)}return new E(e)},multilinestring:function(t){for(var e=[],r=null,s=0,i=t.length;s<i;++s){try{r=this.parseCoords.linestring.apply(this,[t[s]])}catch(t){throw t}e.push(r)}return new R(e)},polygon:function(t){for(var e,r,s=[],i=0,n=t.length;i<n;++i){try{r=this.parseCoords.linestring.apply(this,[t[i]])}catch(t){throw t}e=new T(r.components),s.push(e)}return new O(s)},multipolygon:function(t){for(var e=[],r=null,s=0,i=t.length;s<i;++s){try{r=this.parseCoords.polygon.apply(this,[t[s]])}catch(t){throw t}e.push(r)}return new D(e)},box:function(t){if(2!=t.length)throw"GeoJSON box coordinates must have 2 elements";return new O([new T([new w(t[0][0],t[0][1]),new w(t[1][0],t[0][1]),new w(t[1][0],t[1][1]),new w(t[0][0],t[1][1]),new w(t[0][0],t[0][1])])])}},this.extract={feature:function(t){var e=this.extract.geometry.apply(this,[t.geometry]),r={type:"Feature",properties:this.createAttributes(t),geometry:e};return t.geometry&&"TEXT"===t.geometry.type&&(r.properties.texts=t.geometry.texts,r.properties.textStyle=t.geometry.textStyle),t.fid&&(r.id=t.fid),t.ID&&(r.id=t.ID),r},geometry:function(t){if(null==t)return null;!t.parts&&t.points&&(t.parts=[t.points.length]);var e,r=t.hasOwnProperty("geometryType")?t:new Tt(t).toGeometry()||t,s=r.geometryType||r.type;return"LinearRing"===s&&(s="LineString"),"LINEM"===s&&(s="MultiLineString"),e=this.extract[s.toLowerCase()].apply(this,[r]),"Collection"===(s="TEXT"===s?"Point":s)?{type:"GeometryCollection",geometries:e}:{type:s,coordinates:e}},point:function(t){var e=[t.x,t.y];for(var r in t)"x"===r||"y"===r||null===t[r]||isNaN(t[r])||e.push(t[r]);return e},text:function(t){return[t.points[0].x,t.points[0].y]},multipoint:function(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e},linestring:function(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e},multilinestring:function(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.linestring.apply(this,[t.components[r]]));return e},polygon:function(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.linestring.apply(this,[t.components[r]]));return e},multipolygon:function(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.polygon.apply(this,[t.components[r]]));return e},collection:function(t){for(var e=t.components.length,r=new Array(e),s=0;s<e;++s)r[s]=this.extract.geometry.apply(this,[t.components[s]]);return r}}}read(t,e,r){e=e||"FeatureCollection";var s=null,i=null;if(i="string"==typeof t?super.read(t,r):t){if("string"!=typeof i.type);else if(this.isValidType(i,e))switch(e){case"Geometry":try{s=this.parseGeometry(i)}catch(t){}break;case"Feature":try{(s=this.parseFeature(i)).type="Feature"}catch(t){}break;case"FeatureCollection":switch(s=[],i.type){case"Feature":try{s.push(this.parseFeature(i))}catch(t){s=null}break;case"FeatureCollection":for(var n=0,a=i.features.length;n<a;++n)try{s.push(this.parseFeature(i.features[n]))}catch(t){s=null}break;default:try{var o=this.parseGeometry(i);s.push(new I(o))}catch(t){s=null}}}}else;return s}write(t,e){return super.write(this.toGeoJSON(t),e)}fromGeoJSON(t,e,r){let s=this.read(t,e,r);return v.isArray(s)?s.map(t=>this._toiSevrerFeature(t)):this._toiSevrerFeature(s)}toGeoJSON(t){var e={type:null};if(v.isArray(t)){e.type="FeatureCollection";var r=t.length;e.features=new Array(r);for(var s=0;s<r;++s){var i=t[s];if(n(i)){let t={};t.geometry=i,e.features[s]=this.extract.feature.apply(this,[t])}else e.features[s]=this.extract.feature.apply(this,[i])}}else if(n(t)){let r={};r.geometry=t,e=this.extract.feature.apply(this,[r])}else e=this.extract.feature.apply(this,[t]);function n(t){return t.hasOwnProperty("parts")&&t.hasOwnProperty("points")||t.hasOwnProperty("geoParts")}return e}isValidType(t,e){var r=!1;switch(e){case"Geometry":-1==v.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)||(r=!0);break;case"FeatureCollection":r=!0;break;default:t.type==e&&(r=!0)}return r}parseFeature(t){var e,r,s,i;s=t.properties?t.properties:{},i=t.geometry&&t.geometry.bbox||t.bbox;try{r=this.parseGeometry(t.geometry)}catch(t){throw t}return e=new I(r,s),i&&(e.bounds=x.fromArray(i)),t.id&&(e.geometry.id=t.id,e.fid=t.id),e}parseGeometry(t){if(null==t)return null;var e;if("GeometryCollection"==t.type){if(!v.isArray(t.geometries))throw"GeometryCollection must have geometries array: "+t;for(var r=t.geometries.length,s=new Array(r),i=0;i<r;++i)s[i]=this.parseGeometry.apply(this,[t.geometries[i]]);e=new A(s)}else{if(!v.isArray(t.coordinates))throw"Geometry must have coordinates array: "+t;if(!this.parseCoords[t.type.toLowerCase()])throw"Unsupported geometry type: "+t.type;try{e=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(t){throw t}}return e}createCRSObject(t){var e=t.layer.projection.toString(),r={};if(e.match(/epsg:/i)){var s=parseInt(e.substring(e.indexOf(":")+1));r=4326==s?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+s}}}return r}_toiSevrerFeature(t){const e=t.attributes,r=[],s=[];for(var i in e)r.push(i),s.push(e[i]);const n={fieldNames:r,fieldValues:s,geometry:Tt.fromGeometry(t.geometry)};return n.geometry.id=t.fid,n}createAttributes(t){if(!t)return null;var e={};!function(t,e){if(!t.hasOwnProperty("fieldNames")||!t.hasOwnProperty("fieldValues"))return;var r=t.fieldNames,s=t.fieldValues;for(var i in r)e[r[i]]=s[i]}(t,e);var r=["fieldNames","fieldValues","geometry","stringID","ID"];for(var s in t)r.indexOf(s)>-1||(e[s]=t[s]);return e}}const Pt=function(t){return"[object Array]"==Object.prototype.toString.call(t)},Lt=function(t){return"string"==typeof t&&t.constructor===String},It={toSuperMapGeometry(t){if(t&&t.type)return(new Ot).read(t,"FeatureCollection")[0].geometry},toSuperMapBounds:t=>Pt(t)?new x(t[0],t[1],t[2],t[3]):new x(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),toSuperMapPoint:t=>Pt(t)?new w(t[0],t[1]):t.lng&&t.lat?new w(t.lng,t.lat):new w(t.geometry.coordinates[0],t.geometry.coordinates[1]),toSuperMapPolygon(t){const e=t.getWest(),r=t.getEast(),s=t.getSouth(),i=t.getNorth();return new O([new T([new w(e,s),new w(r,s),new w(r,i),new w(e,i)])])},isArray:Pt,toGeoJSON(t){if(t)return(new Ot).toGeoJSON(t)},toProcessingParam(t){var e={};if(t.length<1)e="";else{for(var r=[],s=0;s<t.length;s++){var i={};i.x=t[s][0],i.y=t[s][1],r.push(i)}e.type="REGION",e.points=r}return e},extend(t){for(var e=0;e<Object.getOwnPropertyNames(arguments).length;e++){var r=Object.getOwnPropertyNames(arguments)[e];if("caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r){var s=arguments[r];if(s)for(var i=0;i<Object.getOwnPropertyNames(s).length;i++){var n=Object.getOwnPropertyNames(s)[i];"caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r&&(t[n]=s[n])}}}return t},isNumber(t){if(""===t)return!1;let e=Number(t);return 0===e||!isNaN(e)},isString:Lt,newGuid(t){let e=t||32,r="";for(let t=1;t<e;t++){r+=Math.floor(16*Math.random()).toString(16)}return r},hexToRgba(t,e){var r=[],s=[];if(3==(t=t.replace(/#/,"")).length){var i=[];for(let e=0;e<3;e++)i.push(t.charAt(e)+t.charAt(e));t=i.join("")}for(let e=0;e<6;e+=2)r[e]="0x"+t.substr(e,2),s.push(parseInt(Number(r[e])));return s.push(e),"rgba("+s.join(",")+")"},isMatchAdministrativeName(t,e){if(Lt(e)){let r=t.substr(0,2);return"å¼ å®¶"===r&&(r=t.substr(0,3)),!!e.match(new RegExp(r))}return!1}};!function(){e().Map.prototype.overlayLayersManager={},void 0===e().Map.prototype.addLayerBak&&(e().Map.prototype.addLayerBak=e().Map.prototype.addLayer,e().Map.prototype.addLayer=function(t,e){return t.source||"custom"===t.type||"background"===t.type?(this.addLayerBak(t,e),t.overlay&&!this.overlayLayersManager[t.id]&&(this.overlayLayersManager[t.id]=t),this):this.overlayLayersManager[t.id]||this.style._layers[t.id]?void this.fire("error",{error:new Error("A layer with this id already exists.")}):(function(t,e){t.onAdd&&t.onAdd(e)}(t,this),this.overlayLayersManager[t.id]=t,this)}),e().Map.prototype.getLayer=function(t){return this.overlayLayersManager[t]?this.overlayLayersManager[t]:this.style.getLayer(t)},e().Map.prototype.moveLayer=function(t,r){return this.overlayLayersManager[t]?(this.overlayLayersManager[t].moveLayer?this.overlayLayersManager[t].moveLayer(t,r):function(t,r){var s=document.getElementById(t);if(r){var i=document.getElementById(r);i||e().Evented.prototype.fire("error",{error:new Error(`Layer with id "${r}" does not exist on this document.`)})}s&&i?i.parentNode.insertBefore(s,i):s.parentNode.appendChild(s)}(t,r),this):this.style._layers[t]?(this.style.moveLayer(t,r),this._update(!0),this):void 0},e().Map.prototype.removeLayer=function(t){return this.overlayLayersManager[t]&&delete this.overlayLayersManager[t],this.style.removeLayer(t),this._update(!0),this},e().Map.prototype.setLayoutProperty=function(t,e,r){return this.overlayLayersManager[t]?("visibility"===e&&(r="visible"===r,s=this.overlayLayersManager[t],i=r,s.setVisibility&&s.setVisibility(i),this.style.fire("data",{dataType:"style"})),this):(this.style.setLayoutProperty(t,e,r),this._update(!0),this);var s,i},e().Map.prototype.updateTransform=function(t,r,s,i,n,a,o){this.transform.units=t;var l=this.mercatorZfromAltitude;e().MercatorCoordinate.fromLngLat=function(t,i){i=i||0;const n=e().LngLat.convert(t);return new(e().MercatorCoordinate)((n.lng-r)/a,(s-n.lat)/o,l(i,n.lat))},e().MercatorCoordinate.prototype.toLngLat=function(){return new(e().LngLat)(this.x*a+r,s-this.y*o)},this.customConvertPoint=window.URL.createObjectURL(new Blob(["customConvertPoint = {projectX:function(x){return (x - "+i+") / "+a+" + 0.5},projectY:function(y){y = 0.5 - ((y - "+n+") / "+o+");return y < 0 ? 0 : y > 1 ? 1 : y;},toY:function(y){return (0.5-y)*"+o+"+"+n+";}}"],{type:"text/javascript"}))}}();class Nt extends e().Evented{constructor(t,e){super(),this.options=e||{},this.url=t,this.fire("initialized",this)}}r(836),r(444);var kt=r(348),Rt=r.n(kt);let Dt=window.fetch;var Ft,Bt,Gt={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(t){for(var e in t){this.queryKeys.push(e),"string"!=typeof t[e]&&(t[e]=v.toJSON(t[e]));var r=encodeURIComponent(t[e]);this.queryValues.push(r)}},issue:function(t){for(var e=this,r=e.getUid(),s=t.url,i=[],n=s,a=0,o=e.queryKeys?e.queryKeys.length:0,l=0;l<o;l++)if(n.length+e.queryKeys[l].length+2>=e.limitLength){if(0==a)return!1;i.push(n),n=s,a=0,l--}else if(n.length+e.queryKeys[l].length+2+e.queryValues[l].length>e.limitLength)for(var h=e.queryValues[l];h.length>0;){var u=e.limitLength-n.length-e.queryKeys[l].length-2;n.indexOf("?")>-1?n+="&":n+="?";var c=h.substring(0,u);"%"===c.substring(u-1,u)?(u-=1,c=h.substring(0,u)):"%"===c.substring(u-2,u-1)&&(u-=2,c=h.substring(0,u)),n+=e.queryKeys[l]+"="+c,h=h.substring(u),c.length>0&&(i.push(n),n=s,a=0)}else a++,n.indexOf("?")>-1?n+="&":n+="?",n+=e.queryKeys[l]+"="+e.queryValues[l];return i.push(n),e.send(i,"SuperMapJSONPCallbacks_"+r,t&&t.proxy)},getUid:function(){return 1e3*(new Date).getTime()+Math.floor(1e17*Math.random())},send:function(t,e,r){var s=t.length;if(s>0)return new Promise(i=>{for(var n=(new Date).getTime(),a=0;a<s;a++){var o=t[a];o.indexOf("?")>-1?o+="&":o+="?",o+="sectionCount="+s,o+="&sectionIndex="+a,o+="&jsonpUserID="+n,r&&(o=decodeURIComponent(o),o=r+encodeURIComponent(o)),Rt()(o,{jsonpCallbackFunction:e,timeout:3e4}).then(t=>{i(t.json())})}})},GET:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings(t.params),this.issue(t)},POST:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)},PUT:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)},DELETE:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)}},jt=function(){return void 0!=Ft?Ft:window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},Ut=function(){return Bt||45e3},Jt={commit:function(t,e,r,s){switch(t=t?t.toUpperCase():t){case"GET":return this.get(e,r,s);case"POST":return this.post(e,r,s);case"PUT":return this.put(e,r,s);case"DELETE":return this.delete(e,r,s);default:return this.get(e,r,s)}},supportDirectRequest:function(t,e){return!!v.isInTheSameDomain(t)||(void 0!=e.crossOrigin?e.crossOrigin:jt()||e.proxy)},get:function(t,e,r){r=r||{};if(t=v.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){var s={url:t=t.replace(".json",".jsonp"),data:e};return Gt.GET(s)}return this.urlIsLong(t)?this._postSimulatie("GET",t.substring(0,t.indexOf("?")),e,r):this._fetch(t,e,r,"GET")},delete:function(t,e,r){r=r||{};if(t=v.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var s={url:t+="&_method=DELETE",data:e};return Gt.DELETE(s)}return this.urlIsLong(t)?this._postSimulatie("DELETE",t.substring(0,t.indexOf("?")),e,r):this._fetch(t,e,r,"DELETE")},post:function(t,e,r){if(r=r||{},t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var s={url:v.urlAppend(t,"_method=POST"),data:e};return Gt.POST(s)}return this._fetch(t,e,r,"POST")},put:function(t,e,r){if(r=r||{},t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var s={url:t+="&_method=PUT",data:e};return Gt.PUT(s)}return this._fetch(t,e,r,"PUT")},urlIsLong:function(t){for(var e=0,r=null,s=0,i=t.length;s<i;s++)(r=t.charCodeAt(s))<127?e++:128<=r&&r<=2047?e+=2:2048<=r&&r<=65535&&(e+=3);return!(e<2e3)},_postSimulatie:function(t,e,r,s){return e+=(e.indexOf("?")>-1?"&":"?")+"_method="+t,"string"!=typeof r&&(r=JSON.stringify(r)),this.post(e,r,s)},_processUrl:function(t,e){if(this._isMVTRequest(t))return t;if(-1===t.indexOf(".json")&&!e.withoutFormatSuffix)if(t.indexOf("?")<0)t+=".json";else{var r=t.split("?");2===r.length&&(t=r[0]+".json?"+r[1])}return e&&e.proxy&&("function"==typeof e.proxy?t=e.proxy(t):(t=decodeURIComponent(t),t=e.proxy+encodeURIComponent(t))),t},_fetch:function(t,e,r,s){return(r=r||{}).headers=r.headers||{},r.headers["Content-Type"]||FormData.prototype.isPrototypeOf(e)||(r.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),r.timeout?this._timeout(r.timeout,Dt(t,{method:s,headers:r.headers,body:"PUT"===s||"POST"===s?e:void 0,credentials:this._getWithCredentials(r),mode:"cors",timeout:Ut()}).then(function(t){return t})):Dt(t,{method:s,body:"PUT"===s||"POST"===s?e:void 0,headers:r.headers,credentials:this._getWithCredentials(r),mode:"cors",timeout:Ut()}).then(function(t){return t})},_getWithCredentials:function(t){return!0===t.withCredentials?"include":!1===t.withCredentials?"omit":"same-origin"},_fetchJsonp:function(t,e){return e=e||{},Rt()(t,{method:"GET",timeout:e.timeout}).then(function(t){return t})},_timeout:function(t,e){return new Promise(function(r,s){setTimeout(function(){s(new Error("timeout"))},t),e.then(r,s)})},_getParameterString:function(t){var e=[];for(var r in t){var s,i=t[r];if(null!=i&&"function"!=typeof i)s=Array.isArray(i)||"[object Object]"===i.toString()?encodeURIComponent(JSON.stringify(i)):encodeURIComponent(i),e.push(encodeURIComponent(r)+"="+s)}return e.join("&")},_isMVTRequest:function(t){return t.indexOf(".mvt")>-1||t.indexOf(".pbf")>-1}},zt={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(t){return t.target||t.srcElement},isSingleTouch:function(t){return t.touches&&1===t.touches.length},isMultiTouch:function(t){return t.touches&&t.touches.length>1},isLeftClick:function(t){return t.which&&1===t.which||t.button&&1===t.button},isRightClick:function(t){return t.which&&3===t.which||t.button&&2===t.button},stop:function(t,e){e||(t.preventDefault?t.preventDefault():t.returnValue=!1),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},findElement:function(t,e){for(var r=zt.element(t);r.parentNode&&(!r.tagName||r.tagName.toUpperCase()!=e.toUpperCase());)r=r.parentNode;return r},observe:function(t,e,r,s){var i=v.getElement(t);if(s=s||!1,"keypress"===e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(e="keydown"),this.observers||(this.observers={}),!i._eventCacheID){var n="eventCacheID_";i.id&&(n=i.id+"_"+n),i._eventCacheID=v.createUniqueID(n)}var a=i._eventCacheID;this.observers[a]||(this.observers[a]=[]),this.observers[a].push({element:i,name:e,observer:r,useCapture:s}),i.addEventListener?"mousewheel"===e?i.addEventListener(e,r,{useCapture:s,passive:!1}):i.addEventListener(e,r,s):i.attachEvent&&i.attachEvent("on"+e,r)},stopObservingElement:function(t){var e=v.getElement(t)._eventCacheID;this._removeElementObservers(zt.observers[e])},_removeElementObservers:function(t){if(t)for(var e=t.length-1;e>=0;e--){var r=t[e],s=new Array(r.element,r.name,r.observer,r.useCapture);zt.stopObserving.apply(this,s)}},stopObserving:function(t,e,r,s){s=s||!1;var i=v.getElement(t),n=i._eventCacheID;"keypress"===e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(e="keydown");var a=!1,o=zt.observers[n];if(o)for(var l=0;!a&&l<o.length;){var h=o[l];if(h.name===e&&h.observer===r&&h.useCapture===s){o.splice(l,1),0==o.length&&delete zt.observers[n],a=!0;break}l++}return a&&(i.removeEventListener?i.removeEventListener(e,r,s):i&&i.detachEvent&&i.detachEvent("on"+e,r)),a},unloadCache:function(){if(zt&&zt.observers){for(var t in zt.observers){var e=zt.observers[t];zt._removeElementObservers.apply(this,[e])}zt.observers=!1}},CLASS_NAME:"SuperMap.Event"};zt.observe(window,"resize",zt.unloadCache,!1);class qt{constructor(t,e,r,s,i){if(this.BROWSER_EVENTS=["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown","MSPointerDown","MSPointerUp","pointerdown","pointerup","MSGestureStart","MSGestureChange","MSGestureEnd","contextmenu"],this.listeners={},this.object=t,this.element=null,this.eventTypes=[],this.eventHandler=null,this.fallThrough=s,this.includeXY=!1,this.extensions={},this.extensionCount={},this.clearMouseListener=null,v.extend(this,i),null!=r)for(var n=0,a=r.length;n<a;n++)this.addEventType(r[n]);null!=e&&this.attachToElement(e),this.CLASS_NAME="SuperMap.Events"}destroy(){for(var t in this.extensions)"boolean"!=typeof this.extensions[t]&&this.extensions[t].destroy();this.extensions=null,this.element&&(zt.stopObservingElement(this.element),this.element.hasScrollEvent&&zt.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.eventTypes=null,this.fallThrough=null,this.eventHandler=null}addEventType(t){this.listeners[t]||(this.eventTypes.push(t),this.listeners[t]=[])}attachToElement(t){this.element?zt.stopObservingElement(this.element):(this.eventHandler=u.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=u.bind(this.clearMouseCache,this)),this.element=t;for(var e=0,r=this.BROWSER_EVENTS.length;e<r;e++){var s=this.BROWSER_EVENTS[e];this.addEventType(s),zt.observe(t,s,this.eventHandler)}zt.observe(t,"dragstart",zt.stop)}on(t){for(var e in t)"scope"!==e&&t.hasOwnProperty(e)&&this.register(e,t.scope,t[e])}register(t,e,r,s){if(t in qt&&!this.extensions[t]&&(this.extensions[t]=new qt[t](this)),null!=r&&-1!==v.indexOf(this.eventTypes,t)){null==e&&(e=this.object);var i=this.listeners[t];i||(i=[],this.listeners[t]=i,this.extensionCount[t]=0);var n={obj:e,func:r};s?(i.splice(this.extensionCount[t],0,n),"object"==typeof s&&s.extension&&this.extensionCount[t]++):i.push(n)}}registerPriority(t,e,r){this.register(t,e,r,!0)}un(t){for(var e in t)"scope"!==e&&t.hasOwnProperty(e)&&this.unregister(e,t.scope,t[e])}unregister(t,e,r){null==e&&(e=this.object);var s=this.listeners[t];if(null!=s)for(var i=0,n=s.length;i<n;i++)if(s[i].obj===e&&s[i].func===r){s.splice(i,1);break}}remove(t){null!=this.listeners[t]&&(this.listeners[t]=[])}triggerEvent(t,e){var r=this.listeners[t];if(r&&0!=r.length){var s;null==e&&(e={}),e.object=this.object,e.element=this.element,e.type||(e.type=t);for(var i=0,n=(r=r.slice()).length;i<n;i++){var a=r[i];if(void 0!=(s=a.func.apply(a.obj,[e]))&&!1===s)break}return this.fallThrough||zt.stop(e,!0),s}}handleBrowserEvent(t){var e=t.type,r=this.listeners[e];if(r&&0!=r.length){var s=t.touches;if(s&&s[0]){for(var i,n=0,a=0,o=s.length,l=0;l<o;++l)n+=(i=s[l]).clientX,a+=i.clientY;t.clientX=n/o,t.clientY=a/o}this.includeXY&&(t.xy=this.getMousePosition(t)),this.triggerEvent(e,t)}}clearMouseCache(){this.element.scrolls=null,this.element.lefttop=null;var t=document.body;t&&(0==t.scrollTop&&0==t.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)}getMousePosition(t){if(this.includeXY?this.element.hasScrollEvent||(zt.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var e=v.getViewportElement();this.element.scrolls=[e.scrollLeft,e.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=v.pagePosition(this.element)),new a(t.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],t.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])}}qt.prototype.BROWSER_EVENTS=["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown","MSPointerDown","MSPointerUp","pointerdown","pointerup","MSGestureStart","MSGestureChange","MSGestureEnd","contextmenu"];class Vt{constructor(t,e){this.value=t||"",this.name=e||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}Vt.CREDENTIAL=null;class Ht{static generateToken(t,e){var r=this.servers[t];if(r)return Jt.post(r.tokenServiceUrl,JSON.stringify(e.toJSON())).then(function(t){return t.text()})}static registerServers(t){this.servers=this.servers||{},v.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var r=t[e];this.servers[r.server]=r}}static registerToken(t,e){if(this.tokens=this.tokens||{},t&&e){var r=this._getTokenStorageKey(t);this.tokens[r]=e}}static registerKey(t,e){if(this.keys=this.keys||{},t&&!(t.length<1)&&e){t=v.isArray(t)?t:[t];for(var r=0;r<t.length;r++){var s=this._getUrlRestString(t[0])||t[0];this.keys[s]=e}}}static getServerInfo(t){return this.servers=this.servers||{},this.servers[t]}static getToken(t){if(t){this.tokens=this.tokens||{};var e=this._getTokenStorageKey(t);return this.tokens[e]}}static getKey(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;return this.keys[e]}static loginiServer(t,e,r,s){t=v.urlPathAppend(t,"services/security/login");var i={username:e&&e.toString(),password:r&&r.toString(),rememberme:s};i=JSON.stringify(i);return Jt.post(t,i,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){return t.json()})}static logoutiServer(t){t=v.urlPathAppend(t,"services/security/logout");return Jt.get(t,"",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0}).then(function(){return!0}).catch(function(){return!1})}static loginOnline(t,e){var r=Ht.SSO+"/login?service="+t;this._open(r,e)}static loginiPortal(t,e,r){t=v.urlPathAppend(t,"web/login");var s={username:e&&e.toString(),password:r&&r.toString()};s=JSON.stringify(s);return Jt.post(t,s,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!1}).then(function(t){return t.json()})}static logoutiPortal(t){t=v.urlPathAppend(t,"services/security/logout");return Jt.get(t,"",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0}).then(function(){return!0}).catch(function(){return!1})}static loginManager(t,e){var r=v.urlPathAppend(t,"/security/tokens"),s=e||{},i={username:s.userName&&s.userName.toString(),password:s.password&&s.password.toString()};i=JSON.stringify(i);var n=this;return Jt.post(r,i,{headers:{Accept:"*/*","Content-Type":"application/json; charset=UTF-8"}}).then(function(t){return t.text()}).then(function(t){return n.imanagerToken=t,t})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(t){if(t){var e=this._getTokenStorageKey(t);this.tokens=this.tokens||{},this.tokens[e]&&delete this.tokens[e]}}static destroyKey(t){if(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;this.keys[e]&&delete this.keys[e]}}static appendCredential(t){var e=t,r=this.getToken(t),s=r?new Vt(r,"token"):null;return s||(s=(r=this.getKey(t))?new Vt(r,"key"):null),s&&(e=v.urlAppend(e,s.getUrlParameters())),e}static _open(t,e){e=null==e||e;var r=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,s=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,i="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+s+", left="+r+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";e?window.open(t,"login"):window.open(t,"login",i)}static _getTokenStorageKey(t){var e=t.match(/(.*?):\/\/([^\/]+)/i);return e?e[0]:t}static _getUrlRestString(t){if(!t)return t;var e=t.match(/(http|https):\/\/(.*\/rest)/i);return e?e[0]:t}}Ht.INNER_WINDOW_WIDTH=600,Ht.INNER_WINDOW_HEIGHT=600,Ht.SSO="https://sso.supermap.com",Ht.ONLINE="https://www.supermapol.com";class Wt{constructor(t,e){let r=this;this.EVENT_TYPES=["processCompleted","processFailed"],this.events=null,this.eventListeners=null,this.url=null,this.urls=null,this.proxy=null,this.index=null,this.length=null,this.totalTimes=null,this.POLLING_TIMES=3,this.isInTheSameDomain=null,this.withCredentials=!1,v.isArray(t)?(r.urls=t,r.length=t.length,r.totalTimes=r.length,1===r.length?r.url=t[0]:(r.index=parseInt(Math.random()*r.length),r.url=t[r.index])):(r.totalTimes=1,r.url=t),v.isArray(t)&&!r.isServiceSupportPolling()&&(r.url=t[0],r.totalTimes=1),e=e||{},this.crossOrigin=e.crossOrigin,this.headers=e.headers,v.extend(this,e),r.isInTheSameDomain=v.isInTheSameDomain(r.url),r.events=new qt(r,null,r.EVENT_TYPES,!0),r.eventListeners instanceof Object&&r.events.on(r.eventListeners),this.CLASS_NAME="SuperMap.CommonServiceBase"}destroy(){let t=this;v.isArray(t.urls)&&(t.urls=null,t.index=null,t.length=null,t.totalTimes=null),t.url=null,t.isInTheSameDomain=null,t.EVENT_TYPES=null,t.events&&(t.events.destroy(),t.events=null),t.eventListeners&&(t.eventListeners=null)}request(t){let e=t.scope.format;if("string"==typeof t.success&&(t.scope.format=t.success,e=t.success,t.success=null,t.failure=null),e&&!this.supportDataFormat(e))throw new Error(`${this.CLASS_NAME} is not surport ${e} format!`);let r=this;return t.url=t.url||r.url,this._returnContent(t)&&!t.url.includes("returnContent=true")&&(t.url=v.urlAppend(t.url,"returnContent=true")),t.proxy=t.proxy||r.proxy,t.withCredentials=void 0!=t.withCredentials?t.withCredentials:r.withCredentials,t.crossOrigin=void 0!=t.crossOrigin?t.crossOrigin:r.crossOrigin,t.headers=t.headers||r.headers,t.isInTheSameDomain=r.isInTheSameDomain,t.withoutFormatSuffix=t.scope.withoutFormatSuffix||!1,t.url=Ht.appendCredential(t.url),r.calculatePollingTimes(),t.scope=r,r.totalTimes>0?(r.totalTimes--,r.ajaxPolling(t)):r._commit(t)}ajaxPolling(t){let e=this,r=t.url,s=/^http:\/\/([a-z]{9}|(\d+\.){3}\d+):\d{0,4}/;return e.index=parseInt(Math.random()*e.length),e.url=e.urls[e.index],r=r.replace(s,s.exec(e.url)[0]),t.url=r,t.isInTheSameDomain=v.isInTheSameDomain(r),e._commit(t)}calculatePollingTimes(){let t=this;t.times?t.totalTimes>t.POLLING_TIMES?t.times>t.POLLING_TIMES?t.totalTimes=t.POLLING_TIMES:t.totalTimes=t.times:t.times<t.totalTimes&&(t.totalTimes=t.times):t.totalTimes>t.POLLING_TIMES&&(t.totalTimes=t.POLLING_TIMES),t.totalTimes--}isServiceSupportPolling(){return!("SuperMap.REST.ThemeService"===this.CLASS_NAME||"SuperMap.REST.EditFeaturesService"===this.CLASS_NAME)}transformResult(t,e){return{result:t=v.transformResult(t),options:e}}transformErrorResult(t,e){return{error:(t=v.transformResult(t)).error||t,options:e}}serviceProcessCompleted(t,e){t=this.transformResult(t).result,this.events.triggerEvent("processCompleted",{result:t,options:e})}serviceProcessFailed(t,e){let r=(t=this.transformErrorResult(t).error).error||t;this.events.triggerEvent("processFailed",{error:r,options:e})}_returnContent(t){return t.scope.format!==U.FGB&&!!t.scope.returnContent}supportDataFormat(t){return this.dataFormat().includes(t)}dataFormat(){return[U.GEOJSON,U.ISERVER]}_commit(t){if("POST"===t.method||"PUT"===t.method||"PATCH"===t.method)if(t.params&&(t.url=v.urlAppend(t.url,v.getParameterString(t.params||{}))),"object"==typeof t.data)try{t.params=v.toJSON(t.data)}catch(t){console.log("ä¸æ¯jsonå¯¹è±¡")}else t.params=t.data;return Jt.commit(t.method,t.url,t.params,{headers:t.headers,withoutFormatSuffix:t.withoutFormatSuffix,withCredentials:t.withCredentials,crossOrigin:t.crossOrigin,timeout:t.async?0:null,proxy:t.proxy}).then(function(t){return t.text?t.text():t.json?t.json():t}).then(function(e){let r=e;return"string"==typeof e&&(r=(new k).read(e)),(!r||r.error||r.code>=300&&304!==r.code)&&(r=r&&r.error?{error:r.error}:{error:r}),r&&t.scope.format===U.FGB&&(r.newResourceLocation=r.newResourceLocation.replace(".json","")+".fgb"),r}).catch(function(t){return{error:t}}).then(e=>{let r={object:this};if(e.error){const i="processFailed";if(this.events&&this.events.listeners[i]&&this.events.listeners[i].length){var s=t.failure&&(t.scope?u.bind(t.failure,t.scope):t.failure);s?s(e,t):this.serviceProcessFailed(e,t)}else(r={...r,...this.transformErrorResult(e,t)}).type=i,t.failure&&t.failure(r)}else{const s="processCompleted";if(this.events&&this.events.listeners[s]&&this.events.listeners[s].length){var i=t.success&&(t.scope?u.bind(t.success,t.scope):t.success);i?i(e,t):this.serviceProcessCompleted(e,t)}else e.succeed=void 0==e.succeed||e.succeed,(r={...r,...this.transformResult(e,t)}).type=s,t.success&&t.success(r)}return r})}}class Qt{constructor(t){t.filters&&"string"==typeof t.filters&&(t.filters=t.filters.split(",")),this.address=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,v.extend(this,t)}destroy(){this.address=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null}}class Yt{constructor(t){t.filters&&(t.filters=t.filters.split(",")),this.x=null,this.y=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,this.geoDecodingRadius=null,v.extend(this,t)}destroy(){this.x=null,this.y=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,this.geoDecodingRadius=null}}class Xt extends Wt{constructor(t,e){super(t,e),this.options=e||{},this.CLASS_NAME="SuperMap.AddressMatchService"}destroy(){super.destroy()}code(t,e,r){if(e instanceof Qt)return this.processAsync(t,e,r)}decode(t,e,r){if(e instanceof Yt)return this.processAsync(t,e,r)}processAsync(t,e,r){return this.request({method:"GET",url:t,params:e,scope:this,success:r,failure:r})}transformResult(t,e){return t.succeed&&delete t.succeed,{result:t,options:e}}}class Zt{constructor(t){t&&(this.customParams=null,this.prjCoordSys=null,this.expectCount=1e5,this.networkType=z.LINE,this.queryOption=q.ATTRIBUTEANDGEOMETRY,this.queryParams=null,this.startRecord=0,this.holdTime=10,this.returnCustomResult=!1,this.returnFeatureWithFieldCaption=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.QueryParameters")}destroy(){var t=this;if(t.customParams=null,t.expectCount=null,t.networkType=null,t.queryOption=null,t.queryParams){for(var e=0,r=t.queryParams,s=r.length;e<s;e++)r[e].destroy();t.queryParams=null}t.startRecord=null,t.holdTime=null,t.returnCustomResult=null,t.prjCoordSys=null}}class Kt{constructor(t){this.isQueryPoint=null,this.isQueryLine=null,this.isQueryRegion=null,this.attributeFilter=null,this.chartFeatureInfoSpecCode=null,v.extend(this,t),this.CLASS_NAME="SuperMap.ChartQueryFilterParameter"}destroy(){var t=this;t.isQueryPoint=null,t.isQueryLine=null,t.isQueryRegion=null,t.attributeFilter=null,t.chartFeatureInfoSpecCode=null}toJson(){var t="";return t+='"isQueryPoint":'+this.isQueryPoint+",",t+='"isQueryLine":'+this.isQueryLine+",",t+='"isQueryRegion":'+this.isQueryRegion+",",this.attributeFilter&&(t+='"attributeFilter": "'+this.attributeFilter+'",'),t="{"+(t+='"chartFeatureInfoSpecCode":'+this.chartFeatureInfoSpecCode)+"}"}}class $t{constructor(t){this.queryMode=null,this.bounds=null,this.chartLayerNames=null,this.chartQueryFilterParameters=null,this.returnContent=!0,this.startRecord=0,this.expectCount=null,v.extend(this,t),this.CLASS_NAME="SuperMap.ChartQueryParameters"}destroy(){var t=this;t.queryMode=null,t.bounds=null,t.chartLayerNames=null,t.chartQueryFilterParameters=null,t.returnContent=!0,t.startRecord=0,t.expectCount=null}getVariablesJson(){var t="";if(t+='"queryMode":"'+this.queryMode+'",',this.chartLayerNames&&this.chartLayerNames.length){for(var e=[],r=this.chartLayerNames.length,s=0;s<r;s++)e.push('"'+this.chartLayerNames[s]+'"');t+='"chartLayerNames":'+("["+e.join(",")+"]")+","}if("ChartBoundsQuery"===this.queryMode&&this.bounds&&(t+='"bounds":{"leftBottom":{"x":'+this.bounds.left+',"y":'+this.bounds.bottom+'},"rightTop":{"x":'+this.bounds.right+',"y":'+this.bounds.top+"}},"),this.chartQueryFilterParameters&&this.chartQueryFilterParameters.length){for(var i=[],n=this.chartQueryFilterParameters.length,a=0;a<n;a++){var o=this.chartQueryFilterParameters[a];o instanceof Kt&&i.push(o.toJson())}var l="["+i.join(",")+"]";l='"chartQueryParams":'+l+",",l+='"startRecord":'+this.startRecord+",",t+='"chartQueryParameters":'+(l="{"+(l+='"expectCount":'+this.expectCount)+"}")}return t="{"+t+"}"}}class te extends Wt{constructor(t,e){super(t,e),e=e||{},this.returnContent=null,this.format=U.GEOJSON,v.extend(this,e);e.format&&(this.format=e.format.toUpperCase()),this.url&&(this.url=v.urlPathAppend(this.url,"queryResults"),this.CLASS_NAME="SuperMap.ChartQueryService")}destroy(){Wt.prototype.destroy.apply(this,arguments),this.returnContent=null,this.format=null}processAsync(t,e){if(t instanceof $t){var r,s=this;return s.returnContent=t.returnContent,r=t.getVariablesJson(),s.returnContent&&(s.url=v.urlAppend(s.url,"returnContent=true")),s.request({method:"POST",data:r,scope:s,success:e,failure:e})}}transformResult(t,e){if((t=v.transformResult(t))&&t.recordsets&&this.format===U.GEOJSON)for(var r=0,s=t.recordsets,i=s.length;r<i;r++)if(s[r].features){var n=new Ot;s[r].features=n.toGeoJSON(s[r].features)}return{result:t,options:e}}getQueryParameters(t){return new Zt({queryMode:t.queryMode,bounds:t.bounds,chartLayerNames:t.chartLayerNames,chartQueryFilterParameters:t.chartQueryFilterParameters,returnContent:t.returnContent})}}class ee extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ChartFeatureInfoSpecsService"}destroy(){super.destroy(),v.reset(this)}processAsync(t){return this.isTempLayers||v.urlPathAppend(this.url,"chartFeatureInfoSpecs"),this.request({method:"GET",params:null,scope:this,success:t,failure:t})}}class re{constructor(t,e){this.url=t,this.options=e||{}}queryChart(t,e,r){var s=this,i=t,n=s._processFormat(r);return new te(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).processAsync(i,e)}getChartFeatureInfo(t){var e=this,r=v.urlPathAppend(e.url,"chartFeatureInfoSpecs");return new ee(r,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}_processFormat(t){return t||U.GEOJSON}}class se extends Wt{constructor(t,e){(e=e||{}).EVENT_TYPES=["broadcastSocketConnected","broadcastSocketClosed","broadcastSocketError","broadcastFailed","broadcastSucceeded","subscribeSocketConnected","subscribeSocketClosed","subscribeSocketError","messageSucceeded","setFilterParamSucceeded"],super(t,e),this.geometry=null,this.prjCoordSys=null,this.excludeField=null,v.extend(this,e),this.CLASS_NAME="SuperMap.DataFlowService"}initBroadcast(){var t=this;return this.broadcastWebSocket=this._connect(v.urlPathAppend(t.url,"broadcast")),this.broadcastWebSocket.onopen=function(e){t.broadcastWebSocket.isOpen=!0,e.eventType="broadcastSocketConnected",t.events.triggerEvent("broadcastSocketConnected",e)},this.broadcastWebSocket.onclose=function(e){t.broadcastWebSocket&&(t.broadcastWebSocket.isOpen=!1),e.eventType="broadcastSocketClosed",t.events.triggerEvent("broadcastSocketClosed",e)},this.broadcastWebSocket.onerror=function(e){e.eventType="broadcastSocketError",t.events.triggerEvent("broadcastSocketError",e)},this}broadcast(t){this.broadcastWebSocket&&this.broadcastWebSocket.isOpen?(this.broadcastWebSocket.send(JSON.stringify(t)),this.events.triggerEvent("broadcastSucceeded")):this.events.triggerEvent("broadcastFailed")}initSubscribe(){var t=this;return this.subscribeWebSocket=this._connect(v.urlPathAppend(t.url,"subscribe")),this.subscribeWebSocket.onopen=function(e){t.subscribeWebSocket.send(t._getFilterParams()),e.eventType="subscribeSocketConnected",t.events.triggerEvent("subscribeSocketConnected",e)},this.subscribeWebSocket.onclose=function(e){e.eventType="subscribeWebSocketClosed",t.events.triggerEvent("subscribeWebSocketClosed",e)},this.subscribeWebSocket.onerror=function(e){e.eventType="subscribeSocketError",t.events.triggerEvent("subscribeSocketError",e)},this.subscribeWebSocket.onmessage=function(e){t._onMessage(e)},this}setExcludeField(t){return this.excludeField=t,this.subscribeWebSocket.send(this._getFilterParams()),this}setGeometry(t){return this.geometry=t,this.subscribeWebSocket.send(this._getFilterParams()),this}unSubscribe(){this.subscribeWebSocket&&(this.subscribeWebSocket.close(),this.subscribeWebSocket=null)}unBroadcast(){this.broadcastWebSocket&&(this.broadcastWebSocket.close(),this.broadcastWebSocket=null)}destroy(){Wt.prototype.destroy.apply(this,arguments);this.geometry=null,this.prjCoordSys=null,this.excludeField=null,this.unBroadcast(),this.unSubscribe()}_getFilterParams(){var t={filterParam:{prjCoordSys:this.prjCoordSys,excludeField:this.excludeField,geometry:this.geometry}};return v.toJSON(t)}_onMessage(t){if(t.data&&t.data.indexOf("filterParam")>=0){var e=JSON.parse(t.data);return t.filterParam=e,t.eventType="setFilterParamSucceeded",void this.events.triggerEvent("setFilterParamSucceeded",t)}var r=JSON.parse(t.data);t.featureResult=r,t.eventType="messageSucceeded",this.events.triggerEvent("messageSucceeded",t)}_connect(t){return t=Ht.appendCredential(t),"WebSocket"in window?new WebSocket(t):"MozWebSocket"in window?new(0,window.MozWebSocket)(t):(console.log("no WebSocket"),null)}}class ie extends Wt{constructor(t,e){super(t,e),e&&(this.datasource=null,this.dataset=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.DatasetService")}destroy(){super.destroy();this.datasource=null,this.dataset=null}getDatasetsService(t,e){const r=v.urlPathAppend(this.url,`datasources/name/${t}/datasets`);return this.processAsync(r,"GET",e)}getDatasetService(t,e,r){const s=v.urlPathAppend(this.url,`datasources/name/${t}/datasets/name/${e}`);return this.processAsync(s,"GET",r)}setDatasetService(t,e){if(!t)return;const r=v.urlPathAppend(this.url,`datasources/name/${t.datasourceName}/datasets/name/${t.datasetName}`);return delete t.datasourceName,this.processAsync(r,"PUT",e,t)}deleteDatasetService(t,e,r){const s=v.urlPathAppend(this.url,`datasources/name/${t}/datasets/name/${e}`);return this.processAsync(s,"DELETE",r)}processAsync(t,e,r,s){let i={url:t,method:e,scope:this,success:r,failure:r};return s&&(i.data=v.toJSON(s)),this.request(i)}}class ne{constructor(t){t&&(this.datasourceName=null,this.datasetName=null,this.datasetType=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.CreateDatasetParameters")}destroy(){this.datasourceName=null,this.datasetName=null,this.datasetType=null}}class ae{constructor(t){t&&(this.datasourceName=null,this.datasetName=null,this.isFileCache=null,this.description=null,this.prjCoordSys=null,this.charset=null,this.palette=null,this.noValue=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.UpdateDatasetParameters")}destroy(){var t=this;t.datasourceName=null,t.datasetName=null,t.isFileCache=null,t.prjCoordSys=null,t.charset=null,t.palette=null,t.noValue=null}}class oe{constructor(t){t&&(this.datasourceName=null,this.description=null,this.coordUnit=null,this.distanceUnit=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.SetDatasourceParameters")}destroy(){this.datasourceName=null,this.description=null,this.coordUnit=null,this.distanceUnit=null}}class le extends Wt{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.DatasourceService"}destroy(){super.destroy()}getDatasourceService(t,e){let r=v.urlPathAppend(this.url,`datasources/name/${t}`);return this.processAsync(r,"GET",e)}getDatasourcesService(t){let e=v.urlPathAppend(this.url,"datasources");return this.processAsync(e,"GET",t)}setDatasourceService(t,e){if(!t)return;const r=v.urlPathAppend(this.url,`datasources/name/${t.datasourceName}`);return this.processAsync(r,"PUT",e,t)}processAsync(t,e,r,s){let i={url:t,method:e,scope:this,success:r,failure:r};return s&&(i.data=v.toJSON(s)),this.request(i)}}class he{constructor(t){this.dataSourceName=null,this.dataSetName=null,this.features=null,this.editType=ct.ADD,this.IDs=null,this.returnContent=!1,this.isUseBatch=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.EditFeaturesParameters"}destroy(){var t=this;t.dataSourceName=null,t.dataSetName=null,t.features=null,t.editType=null,t.IDs=null,t.returnContent=null}static toJsonParameters(t){var e,r,s;if(t.editType===ct.DELETE){if(null===t.IDs)return;s={ids:t.IDs}}else if(s=[],t.features){r=t.features.length;for(var i=0;i<r;i++)(e=t.features[i]).geometry=Tt.fromGeometry(e.geometry),s.push(e)}return v.toJSON(s)}}class ue extends Wt{constructor(t,e){super(t,e),this.returnContent=!1,this.isUseBatch=!1,e&&v.extend(this,e),this.url=v.urlPathAppend(this.url,"features"),this.CLASS_NAME="SuperMap.EditFeaturesService"}destroy(){super.destroy();this.returnContent=null,this.isUseBatch=null,this.fromIndex=null,this.toIndex=null}processAsync(t,e){if(t instanceof he){var r=this,s="POST",i="",n=t.editType,a=null;if(r.returnContent=t.returnContent,r.isUseBatch=t.isUseBatch,a=he.toJsonParameters(t),n===ct.DELETE){a=i=v.toJSON(t.IDs);var o=v.urlAppend(r.url,v.getParameterString({ids:i}));Jt.urlIsLong(o)?(r.url=v.urlAppend(r.url,v.getParameterString({_method:"DELETE"})),s="POST"):(r.url=o,s="DELETE")}else n===ct.UPDATE?s="PUT":(r.isUseBatch&&(r.url=v.urlAppend(r.url,`isUseBatch=${r.isUseBatch}`),r.returnContent=!1),r.returnContent&&(r.url=v.urlAppend(r.url,"returnContent=true"),s="POST"));return r.request({method:s,data:a,scope:r,success:e,failure:e})}}getMetaData(t,e){var r=t.featureId;return this.url=v.urlPathAppend(this.url,r+"/metadata"),this.request({method:"GET",data:null,scope:this,success:e,failure:e})}}class ce extends Wt{constructor(t,e){super(t,e),e=e||{},this.returnContent=!0,this.fromIndex=0,this.toIndex=19,this.hasGeometry=!0,this.maxFeatures=null,this.format=U.GEOJSON,v.extend(this,e),this.url=v.urlPathAppend(this.url,"featureResults"),this.CLASS_NAME="SuperMap.GetFeaturesServiceBase"}destroy(){super.destroy();var t=this;t.returnContent=null,t.fromIndex=null,t.toIndex=null,t.maxFeatures=null,t.format=null,t.hasGeometry=null}processAsync(t,e){if(t){var r,s=this,i=!0;return s.returnContent=t.returnContent,s.fromIndex=t.fromIndex,s.toIndex=t.toIndex,s.maxFeatures=t.maxFeatures,s.hasGeometry=t.hasGeometry,s.returnContent&&(i=!1),null!=s.fromIndex&&null!=s.toIndex&&!isNaN(s.fromIndex)&&!isNaN(s.toIndex)&&s.fromIndex>=0&&s.toIndex>=0&&!i&&(s.url=v.urlAppend(s.url,`fromIndex=${s.fromIndex}&toIndex=${s.toIndex}`)),t.returnCountOnly&&(s.url=v.urlAppend(s.url,"&returnCountOnly="+t.returnContent)),r=s.getJsonParameters(t),s.request({method:"POST",data:r,scope:s,success:e,failure:e})}}transformResult(t,e){if(t=v.transformResult(t),this.format===U.GEOJSON&&t.features){var r=new Ot;t.features=r.toGeoJSON(t.features)}return{result:t,options:e}}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}}class de{constructor(t){this.attributeFilter=null,this.name=null,this.joinItems=null,this.linkItems=null,this.ids=null,this.orderBy=null,this.groupBy=null,this.fields=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.FilterParameter"}destroy(){var t=this;if(t.attributeFilter=null,t.name=null,t.joinItems){for(let e=0,r=t.joinItems,s=r.length;e<s;e++)r[e].destroy();t.joinItems=null}if(t.linkItems){for(let e=0,r=t.linkItems,s=r.length;e<s;e++)r[e].destroy();t.linkItems=null}t.ids=null,t.orderBy=null,t.groupBy=null,t.fields=null}}class pe{constructor(t){this.datasetNames=null,this.targetEpsgCode=null,this.targetPrj=null,this.returnContent=!0,this.fromIndex=0,this.toIndex=19,this.returnCountOnly=!1,this.maxFeatures=null,this.hasGeometry=!0,this.aggregations=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesParametersBase"}destroy(){var t=this;t.datasetNames=null,t.returnContent=null,t.fromIndex=null,t.toIndex=null,t.hasGeometry=null,t.maxFeatures=null,t.targetEpsgCode=null,t.targetPrj=null,t.aggregation&&(t.aggregation=null)}}class fe extends pe{constructor(t){super(t),this.getFeatureMode="ID",this.IDs=null,this.fields=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByIDsParameters"}destroy(){super.destroy();var t=this;if(t.IDs=null,t.getFeatureMode=null,t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}}static toJsonParameters(t){var e,r;return e={datasetNames:t.datasetNames,getFeatureMode:"ID",ids:t.IDs},t.fields&&((r=new de).name=t.datasetNames,r.fields=t.fields,e.queryParameter=r),t.targetEpsgCode&&(e.targetEpsgCode=t.targetEpsgCode),"boolean"==typeof t.hasGeometry&&(e.hasGeometry=t.hasGeometry),!t.targetEpsgCode&&t.targetPrj&&(e.targetPrj=t.targetPrj),t.aggregations&&(e.aggregations=t.aggregations),v.toJSON(e)}}class me extends ce{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByIDsService"}destroy(){super.destroy()}getJsonParameters(t){return fe.toJsonParameters(t)}}class ye extends pe{constructor(t){super(t),this.getFeatureMode="SQL",this.queryParameter=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesBySQLParameters"}destroy(){super.destroy();this.getFeatureMode=null,this.queryParameter&&(this.queryParameter.destroy(),this.queryParameter=null)}static toJsonParameters(t){var e={datasetNames:t.datasetNames,getFeatureMode:"SQL",queryParameter:t.queryParameter};return t.maxFeatures&&!isNaN(t.maxFeatures)&&(e.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(e.hasGeometry=t.hasGeometry),t.aggregations&&(e.aggregations=t.aggregations),t.targetEpsgCode&&(e.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(e.targetPrj=t.targetPrj),t.aggregations&&(e.aggregations=t.aggregations),v.toJSON(e)}}class ge extends ce{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesBySQLService"}destroy(){super.destroy()}getJsonParameters(t){return ye.toJsonParameters(t)}}class ve extends pe{constructor(t){super(t),this.getFeatureMode=ve.getFeatureMode.BOUNDS,this.bounds=null,this.fields=null,this.attributeFilter=null,this.spatialQueryMode=V.CONTAIN,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByBoundsParameters"}destroy(){super.destroy();var t=this;if(t.bounds&&(t.bounds.destroy(),t.bounds=null),t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.attributeFilter=null,t.spatialQueryMode=null,t.getFeatureMode=null}static toJsonParameters(t){var e,r,s;return r={leftBottom:{x:t.bounds.left,y:t.bounds.bottom},rightTop:{x:t.bounds.right,y:t.bounds.top}},s={datasetNames:t.datasetNames,getFeatureMode:ve.getFeatureMode.BOUNDS,bounds:r,spatialQueryMode:t.spatialQueryMode},t.fields&&((e=new de).name=t.datasetNames,e.fields=t.fields,s.queryParameter=e),t.attributeFilter&&(s.attributeFilter=t.attributeFilter,s.getFeatureMode=ve.getFeatureMode.BOUNDS_ATTRIBUTEFILTER),t.maxFeatures&&!isNaN(t.maxFeatures)&&(s.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(s.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(s.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(s.targetPrj=t.targetPrj),t.aggregations&&(s.aggregations=t.aggregations),v.toJSON(s)}}ve.getFeatureMode={BOUNDS:"BOUNDS",BOUNDS_ATTRIBUTEFILTER:"BOUNDS_ATTRIBUTEFILTER"};class be extends ce{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByBoundsService"}destroy(){super.destroy()}getJsonParameters(t){return ve.toJsonParameters(t)}}class Se extends pe{constructor(t){super(t),this.bufferDistance=null,this.attributeFilter=null,this.geometry=null,this.fields=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByBufferParameters"}destroy(){super.destroy();var t=this;if(t.bufferDistance=null,t.attributeFilter=null,t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.geometry&&(t.geometry.destroy(),t.geometry=null)}static toJsonParameters(t){var e,r,s;return s=Tt.fromGeometry(t.geometry),r={datasetNames:t.datasetNames,getFeatureMode:"BUFFER",bufferDistance:t.bufferDistance,geometry:s},t.fields&&((e=new de).name=t.datasetNames,e.fields=t.fields,r.queryParameter=e),t.attributeFilter&&(r.attributeFilter=t.attributeFilter,r.getFeatureMode="BUFFER_ATTRIBUTEFILTER"),t.maxFeatures&&!isNaN(t.maxFeatures)&&(r.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(r.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(r.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(r.targetPrj=t.targetPrj),v.toJSON(r)}}class _e extends ce{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByBufferService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Se)return Se.toJsonParameters(t)}}class xe extends pe{constructor(t){super(t),this.getFeatureMode="SPATIAL",this.geometry=null,this.fields=null,this.attributeFilter=null,this.spatialQueryMode=V.CONTAIN,v.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByGeometryParameters"}destroy(){super.destroy();var t=this;if(t.geometry&&(t.geometry.destroy(),t.geometry=null),t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.attributeFilter=null,t.spatialQueryMode=null,t.getFeatureMode=null}static toJsonParameters(t){var e,r,s;return r=Tt.fromGeometry(t.geometry),s={datasetNames:t.datasetNames,getFeatureMode:"SPATIAL",geometry:r,spatialQueryMode:t.spatialQueryMode},t.fields&&((e=new de).name=t.datasetNames,e.fields=t.fields,s.queryParameter=e),t.attributeFilter&&(s.attributeFilter=t.attributeFilter,s.getFeatureMode="SPATIAL_ATTRIBUTEFILTER"),t.maxFeatures&&!isNaN(t.maxFeatures)&&(s.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(s.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(s.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(s.targetPrj=t.targetPrj),t.aggregations&&(s.aggregations=t.aggregations),v.toJSON(s)}}class we extends ce{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByGeometryService"}destroy(){super.destroy()}getJsonParameters(t){return xe.toJsonParameters(t)}}class Ae{constructor(t,e){this.url=t,this.options=e||{}}getFeaturesByIDs(t,e,r){var s=this;return new me(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:r}).processAsync(t,e)}getFeaturesByBounds(t,e,r){var s=this;return new be(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}getFeaturesByBuffer(t,e,r){var s=this;return new _e(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}getFeaturesBySQL(t,e,r){var s=this;return new ge(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}getFeaturesByGeometry(t,e,r){var s=this;return new we(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}editFeatures(t,e){if(t&&t.dataSourceName&&t.dataSetName){var r=this,s=r.url,i=t.dataSourceName,n=t.dataSetName;return s=v.urlPathAppend(s,"datasources/"+i+"/datasets/"+n),new ue(s,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}getMetadata(t,e){var r=this,s=r.url,i=t.dataSourceName,n=t.dataSetName;return s=v.urlPathAppend(s,"datasources/"+i+"/datasets/"+n),new ue(s,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).getMetaData(t,e)}_processFormat(t){return t||U.GEOJSON}}class Me extends Wt{constructor(t,e){super(t,e),this.datasource=null,this.dataset=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.GetFieldsService"}destroy(){super.destroy();this.datasource=null,this.dataset=null}processAsync(t){var e=this;return e.url=v.urlPathAppend(e.url,`datasources/${e.datasource}/datasets/${e.dataset}/fields`),e.request({method:"GET",data:null,scope:e,success:t,failure:t})}}class Ce{constructor(t){this.datasource=null,this.dataset=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.FieldParameters"}destroy(){this.datasource=null,this.dataset=null}}class Ee extends Ce{constructor(t){super(t),this.fieldName=null,this.statisticMode=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.FieldStatisticsParameters"}destroy(){this.fieldName=null,this.statisticMode=null}}class Te extends Wt{constructor(t,e){super(t,e),this.datasource=null,this.dataset=null,this.field=null,this.statisticMode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.FieldStatisticService"}destroy(){super.destroy();this.datasource=null,this.dataset=null,this.field=null,this.statisticMode=null}processAsync(t){var e=this,r="datasources/"+e.datasource+"/datasets/"+e.dataset+"/fields/"+e.field+"/"+e.statisticMode;return e.url=v.urlPathAppend(e.url,r),e.request({method:"GET",data:null,scope:e,success:t,failure:t})}}class Oe{constructor(t,e){this.url=t,this.options=e||{}}getFields(t,e){var r=this;return new Me(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,datasource:t.datasource,dataset:t.dataset}).processAsync(e)}getFieldStatisticsInfo(t,e){if(t instanceof Ee){var r=this,s=t.fieldName,i=t.statisticMode;i&&!Array.isArray(i)&&(i=[i]),r.currentStatisticResult={fieldName:s},r._statisticsCallback=e,i.forEach(e=>{r.currentStatisticResult[e]=null,r._fieldStatisticRequest(t.datasource,t.dataset,s,e)})}}_fieldStatisticRequest(t,e,r,s){var i=this;new Te(i.url,{datasource:t,dataset:e,field:r,statisticMode:s,crossOrigin:i.options.crossOrigin,headers:i.options.headers}).processAsync(i._processCompleted.bind(i))}_processCompleted(t){var e=this;if(t.error)e._statisticsCallback(t);else{var r=!0,s=t.result;for(var i in this.currentStatisticResult&&null==e.currentStatisticResult[s.mode]&&(this.currentStatisticResult[s.mode]=s.result),e.currentStatisticResult)if(null==e.currentStatisticResult[i]){r=!1;break}r&&e._statisticsCallback({result:e.currentStatisticResult})}}}class Pe{constructor(t){this.datasetName=null,this.dataSourceName=null,this.X=null,this.Y=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetGridCellInfosParameters"}destroy(){this.datasetName=null,this.dataSourceName=null,this.X=null,this.Y=null}}class Le extends Wt{constructor(t,e){super(t,e),this.datasetName=null,this.dataSourceName=null,this.datasetType=null,this.X=null,this.Y=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.GetGridCellInfosService"}destroy(){super.destroy();var t=this;t.X=null,t.Y=null,t.datasetName=null,t.dataSourceName=null,t.datasetType=null}processAsync(t,e){if(t instanceof Pe){v.extend(this,t);var r=this;return r.url=v.urlPathAppend(r.url,`datasources/${r.dataSourceName}/datasets/${r.datasetName}`),r.request({method:"GET",data:null,scope:r,success(t){!e&&t.result||(t=t.result?t.result:t,r.getDatasetInfoCompleted(t,e))},failure:e}).then(({result:t})=>t&&r.getDatasetInfoCompleted(t))}}getDatasetInfoCompleted(t,e){return t=v.transformResult(t),this.datasetType=t.datasetInfo.type,this.queryGridInfos(e)}queryGridInfos(t){var e=this,r=v.urlPathAppend(e.url,"GRID"==e.datasetType?"gridValue":"imageValue");return null!=e.X&&null!=e.Y&&(r=v.urlAppend(r,`x=${e.X}&y=${e.Y}`)),e.request({url:r,method:"GET",data:null,scope:e,success:t,failure:t})}}class Ie extends Wt{constructor(t,e){super(t,e=e||{}),this.CLASS_NAME="SuperMap.GeoprocessingService",this.headers={},this.crossOrigin=!0}getTools(t){return this._processAsync({url:`${this.url}/list`,callback:t})}getTool(t,e){return this._processAsync({url:`${this.url}/${t}`,callback:e})}execute(t,e,r,s){const i={parameter:e=e||null,environment:r=r||null};return this._processAsync({url:`${this.url}/${t}/execute`,executeParamter:i,callback:s})}submitJob(t,e,r,s){e=e||null,r=r||null;const i=JSON.stringify({parameter:e,environments:r});return this._processAsync({url:`${this.url}/${t}/jobs`,method:"POST",callback:s,params:i})}waitForJobCompletion(t,e,r,s){const i=this,n=setInterval(function(){i._processAsync({url:`${i.url}/${e}/jobs/${t}`,callback:function(t){const e=t.result.state.runState;t.options.statusCallback&&t.options.statusCallback(e),-1!==["FINISHED","FAILED","CANCELED"].indexOf(e)&&(clearInterval(n),s(t))}})},r.interval)}getJobInfo(t,e,r){return this._processAsync({url:`${this.url}/${t}/jobs/${e}`,callback:r})}cancelJob(t,e,r){return this._processAsync({url:`${this.url}/${t}/jobs/${e}/cancel`,callback:r})}getJobs(t,e){let r=`${this.url}/jobs`;t&&"string"==typeof t?r=`${this.url}/${t}/jobs`:e=t,this._processAsync({url:r,callback:e})}getResults(t,e,r,s){let i=`${this.url}/${t}/jobs/${e}/results`;return r&&("string"==typeof r?i=`${i}/${r}`:s=r),this._processAsync({url:i,callback:s})}_processAsync({url:t,method:e,callback:r,paramter:s}){return this.request({url:t,method:e||"GET",params:s,headers:{"Content-type":"application/json"},scope:this,success:r,failure:r})}}class Ne{constructor(t,e){if(!t)return this;this.memoryData=null,this.type=t,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.Theme"}destroy(){this.memoryData&&(this.memoryData.destroy(),this.memoryData=null),this.type=null}toServerJSONObject(){}}class ke{constructor(t){this.align=et.BASELINECENTER,this.backColor=new F(255,255,255),this.foreColor=new F(0,0,0),this.backOpaque=!1,this.sizeFixed=!0,this.fontHeight=6,this.fontWidth=0,this.fontWeight=400,this.fontName="Times New Roman",this.bold=!1,this.italic=!1,this.italicAngle=0,this.shadow=!1,this.strikeout=!1,this.outline=!1,this.opaqueRate=0,this.underline=!1,this.rotation=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerTextStyle"}destroy(){var t=this;t.align=null,t.backColor&&(t.backColor.destroy(),t.backColor=null),t.foreColor&&(t.foreColor.destroy(),t.foreColor=null),t.backOpaque=null,t.sizeFixed=null,t.fontHeight=null,t.fontWidth=null,t.fontWeight=null,t.fontName=null,t.bold=null,t.italic=null,t.italicAngle=null,t.shadow=null,t.strikeout=null,t.outline=null,t.opaqueRate=null,t.underline=null,t.rotation=null}static fromObj(t){var e=new ke(t);return v.copy(e,t),e.backColor=F.fromJson(t.backColor),e.foreColor=F.fromJson(t.foreColor),e}}class Re{constructor(t){this.caption=null,this.end=0,this.start=0,this.visible=!0,this.style=new ke,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}static fromObj(t){if(t){var e=new Re;return v.copy(e,t),e}}}class De{constructor(t){this.caption=null,this.style=new B,this.unique=null,this.visible=!0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeUniqueItem"}destroy(){var t=this;t.caption=null,t.unique=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){var e=new De;return v.copy(e,t),e.style=B.fromJson(t.style),e}}class Fe{constructor(t){this.offsetFixed=!1,this.offsetX="0.0",this.offsetY="0.0",t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeOffset"}destroy(){this.offsetFixed=null,this.offsetX=null,this.offsetY=null}static fromObj(t){if(t){var e=new Fe;return v.copy(e,t),e}}}class Be{constructor(t){this.defaultStyle=null,this.separator=null,this.separatorEnabled=!1,this.splitIndexes=null,this.styles=new ke,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.LabelMixedTextStyle"}destroy(){var t=this;if(t.defaultStyle&&(t.defaultStyle.destroy(),t.defaultStyle=null),t.separator=null,t.separatorEnabled=null,t.splitIndexes&&(t.splitIndexes=null),t.styles){for(var e=0,r=t.styles,s=r.length;e<s;e++)r[e].destroy();t.styles=null}}static fromObj(t){if(t){var e=new Be,r=t.styles;if(v.copy(e,t),e.defaultStyle=new ke(t.defaultStyle),r){e.styles=[];for(var s=0,i=r.length;s<i;s++)e.styles.push(new ke(r[s]))}return e}}}class Ge{constructor(t){this.maxTextHeight=0,this.maxTextWidth=0,this.minTextHeight=0,this.minTextWidth=0,this.uniformStyle=new ke,this.uniformMixedStyle=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelText"}destroy(){var t=this;t.maxTextHeight=null,t.maxTextWidth=null,t.minTextHeight=null,t.minTextWidth=null,t.uniformStyle&&(t.uniformStyle.destroy(),t.uniformStyle=null),t.uniformMixedStyle&&(t.uniformMixedStyle.destroy(),t.uniformMixedStyle=null)}static fromObj(t){if(t){var e=new Ge;return v.copy(e,t),e.uniformStyle=ke.fromObj(t.uniformStyle),e.uniformMixedStyle=Be.fromObj(t.uniformMixedStyle),e}}}class je{constructor(t){this.isAlongLine=!0,this.alongLineDirection=rt.LB_TO_RT,this.angleFixed=!1,this.repeatedLabelAvoided=!1,this.repeatIntervalFixed=!1,this.labelRepeatInterval=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelAlongLine"}destroy(){var t=this;t.isAlongLine=null,t.alongLineDirection=null,t.angleFixed=null,t.repeatedLabelAvoided=null,t.repeatIntervalFixed=null,t.labelRepeatInterval=null}static fromObj(t){if(t){var e=new je;return v.copy(e,t),e}}}class Ue{constructor(t){this.labelBackShape=st.NONE,this.backStyle=new B,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelBackground"}destroy(){this.labelBackShape=null,this.backStyle&&(this.backStyle.destroy(),this.backStyle=null)}static fromObj(t){if(t){var e=new Ue;return e.labelBackShape=t.labelBackShape,e.backStyle=B.fromJson(t.backStyle),e}}}class Je extends Ne{constructor(t){super("LABEL",t),this.alongLine=new je,this.background=new Ue,this.items=null,this.uniqueItems=null,this.labelExpression=null,this.labelOverLengthMode=it.NONE,this.matrixCells=null,this.maxLabelLength=256,this.numericPrecision=0,this.offset=new Fe,this.overlapAvoided=!0,this.rangeExpression=null,this.uniqueExpression=null,this.smallGeometryLabeled=!1,this.text=new Ge,this.textSpace=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabel"}destroy(){super.destroy();var t=this;if(t.alongLine=null,t.background&&(t.background.destroy(),t.background=null),t.items){for(var e=0,r=t.items,s=r.length;e<s;e++)r[e].destroy();t.items=null}if(t.uniqueItems){for(var i=0,n=t.uniqueItems,a=n.length;i<a;i++)n[i].destory();t.uniqueItems=null}t.labelExpression=null,t.labelOverLengthMode=null,t.matrixCells=null,t.maxLabelLength=null,t.numericPrecision=null,t.overlapAvoided=null,t.rangeExpression=null,t.uniqueExpression=null,t.offset&&(t.offset.destroy(),t.offset=null),t.overlapAvoided=null,t.smallGeometryLabeled=null,t.text&&(t.text.destroy(),t.text=null),t.textSpace=null}toJSON(){return v.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,t.memoryData=this.memoryData,this.alongLine&&(t.alongLine=this.alongLine.isAlongLine,t.alongLineDirection=this.alongLine.alongLineDirection,t.angleFixed=this.alongLine.angleFixed,t.isLabelRepeated=this.alongLine.isLabelRepeated,t.labelRepeatInterval=this.alongLine.labelRepeatInterval,t.repeatedLabelAvoided=this.alongLine.repeatedLabelAvoided,t.repeatIntervalFixed=this.alongLine.repeatIntervalFixed),this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),this.text&&(t.maxTextHeight=this.text.maxTextHeight,t.maxTextWidth=this.text.maxTextWidth,t.minTextHeight=this.text.minTextHeight,t.minTextWidth=this.text.minTextWidth,t.uniformStyle=this.text.uniformStyle,t.uniformMixedStyle=this.text.uniformMixedStyle),this.background&&(t.labelBackShape=this.background.labelBackShape,t.backStyle=this.background.backStyle),t.labelOverLengthMode=this.labelOverLengthMode,t.maxLabelLength=this.maxLabelLength,t.smallGeometryLabeled=this.smallGeometryLabeled,t.rangeExpression=this.rangeExpression,t.uniqueExpression=this.uniqueExpression,t.numericPrecision=this.numericPrecision,t.items=this.items,t.uniqueItems=this.uniqueItems,t.labelExpression=this.labelExpression,t.overlapAvoided=this.overlapAvoided,t.matrixCells=this.matrixCells,t.textSpace=this.textSpace,t}static fromObj(t){if(t){var e=new Je,r=t.items,s=t.uniqueItems,i=t.matrixCells;if(t.matrixCells=null,v.copy(e,t),e.alongLine=je.fromObj(t),e.background=Ue.fromObj(t),r){e.items=[];for(var n=0,a=r.length;n<a;n++)e.items.push(Re.fromObj(r[n]))}if(s){e.uniqueItems=[];for(let t=0,r=s.length;t<r;t++)e.uniqueItems.push(De.fromObj(s[t]))}if(i){e.matrixCells=[];for(let t=0,e=i.length;t<e;t++);}return e.offset=Fe.fromObj(t),e.text=Ge.fromObj(t),e}}}class ze extends Ne{constructor(t){super("UNIQUE",t),this.defaultStyle=new B,this.items=null,this.uniqueExpression=null,this.colorGradientType=tt.YELLOW_RED,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeUnique"}destroy(){super.destroy();var t=this;if(t.uniqueExpression=null,t.colorGradientType=null,t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.defaultStyle&&(t.defaultStyle.destroy(),t.defaultStyle=null)}toServerJSONObject(){var t={};if((t=v.copyAttributes(t,this)).defaultStyle&&t.defaultStyle.toServerJSONObject&&(t.defaultStyle=t.defaultStyle.toServerJSONObject()),t.items){for(var e=[],r=t.items.length,s=0;s<r;s++)e.push(t.items[s].toServerJSONObject());t.items=e}return t}static fromObj(t){var e=new ze,r=t.items,s=r?r.length:0;v.extend(e,t),e.items=[],e.defaultStyle=B.fromJson(t.defaultStyle);for(var i=0;i<s;i++)e.items.push(De.fromObj(r[i]));return e}}class qe{constructor(t){this.axesColor=new F(0,0,0),this.axesDisplayed=!1,this.axesGridDisplayed=!1,this.axesTextDisplayed=!1,this.axesTextStyle=new ke,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphAxes"}destroy(){var t=this;t.axesColor&&(t.axesColor.destroy(),t.axesColor=null),t.axesDisplayed=null,t.axesGridDisplayed=null,t.axesTextDisplayed=null,t.axesTextStyle&&(t.axesTextStyle.destroy(),t.axesTextStyle=null)}static fromObj(t){if(t){var e=new qe;return v.copy(e,t),e.axesColor=F.fromJson(t.axesColor),e.axesTextStyle=ke.fromObj(t.axesTextStyle),e}}}class Ve{constructor(t){this.maxGraphSize=0,this.minGraphSize=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphSize"}destroy(){this.maxGraphSize=null,this.minGraphSize=null}static fromObj(t){var e=new Ve;return v.copy(e,t),e}}class He{constructor(t){this.graphTextDisplayed=!1,this.graphTextFormat=Y.CAPTION,this.graphTextStyle=new ke,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphText"}destroy(){var t=this;t.graphTextDisplayed=null,t.graphTextFormat=null,t.graphTextStyle&&(t.graphTextStyle.destroy(),t.graphTextStyle=null)}static fromObj(t){var e=new He;return v.copy(e,t),e.graphTextStyle=ke.fromObj(t.graphTextStyle),e}}class We{constructor(t){this.caption=null,this.graphExpression=null,this.memoryDoubleValues=null,this.uniformStyle=new B,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphItem"}destroy(){this.caption=null,this.graphExpression=null,this.memoryDoubleValues=null,this.uniformStyle=null}static fromObj(t){if(t){var e=new We;return v.copy(e,t),e.uniformStyle=B.fromJson(t.uniformStyle),e}}}class Qe extends Ne{constructor(t){super("GRAPH",t),this.barWidth=0,this.graduatedMode=K.CONSTANT,this.graphAxes=new qe,this.graphSize=new Ve,this.graphSizeFixed=!1,this.graphText=new He,this.graphType=X.AREA,this.graphAxesTextDisplayMode=Z.NONE,this.items=null,this.memoryKeys=null,this.negativeDisplayed=!1,this.offset=new Fe,this.overlapAvoided=!0,this.roseAngle=0,this.startAngle=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraph"}destroy(){super.destroy();var t=this;if(t.barWidth=null,t.graduatedMode=null,t.graphAxes&&(t.graphAxes.destroy(),t.graphAxes=null),t.graphSize&&(t.graphSize.destroy(),t.graphSize=null),t.graphSizeFixed=null,t.graphText&&(t.graphText.destroy(),t.graphText=null),t.graphType=null,t.items){for(var e=0,r=t.items,s=r.length;e<s;e++)r[e].destroy();t.items=null}t.memoryKeys=null,t.negativeDisplayed=null,t.offset&&(t.offset.destroy(),t.offset=null),t.overlapAvoided=null,t.roseAngle=null,t.startAngle=null,t.graphAxesTextDisplayMode=null}toJSON(){return v.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,this.graphText&&(t.graphTextDisplayed=this.graphText.graphTextDisplayed,t.graphTextFormat=this.graphText.graphTextFormat,t.graphTextStyle=this.graphText.graphTextStyle),this.graphAxes&&(t.axesColor=this.graphAxes.axesColor,t.axesDisplayed=this.graphAxes.axesDisplayed,t.axesGridDisplayed=this.graphAxes.axesGridDisplayed,t.axesTextDisplayed=this.graphAxes.axesTextDisplayed,t.axesTextStyle=this.graphAxes.axesTextStyle),this.graphSize&&(t.maxGraphSize=this.graphSize.maxGraphSize,t.minGraphSize=this.graphSize.minGraphSize),this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),t.barWidth=this.barWidth,t.graduatedMode=this.graduatedMode,t.graphSizeFixed=this.graphSizeFixed,t.graphType=this.graphType,t.graphAxesTextDisplayMode=this.graphAxesTextDisplayMode,t.items=this.items,t.memoryKeys=this.memoryKeys,t.negativeDisplayed=this.negativeDisplayed,t.overlapAvoided=this.overlapAvoided,t.roseAngle=this.roseAngle,t.startAngle=this.startAngle,t}static fromObj(t){var e=new Qe,r=t.items,s=r?r.length:0;v.copy(e,t),e.items=[],e.graphAxes=qe.fromObj(t),e.graphSize=Ve.fromObj(t),e.graphText=He.fromObj(t),e.offset=Fe.fromObj(t);for(var i=0;i<s;i++)e.items.push(We.fromObj(r[i]));return e}}class Ye extends Ne{constructor(t){super("DOTDENSITY",t),this.dotExpression=null,this.style=new B,this.value=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeDotDensity"}destroy(){var t=this;t.dotExpression=null,t.value=null,t.style&&(t.style.destroy(),t.style=null)}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){if(t){var e=new Ye;return v.copy(e,t),e.style=B.fromJson(t.style),e}}}class Xe{constructor(t){this.negativeDisplayed=!1,this.negativeStyle=new B,this.positiveStyle=new B,this.zeroDisplayed=!1,this.zeroStyle=new B,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraduatedSymbolStyle"}destroy(){var t=this;t.negativeDisplayed=null,t.negativeStyle=null,t.positiveStyle=null,t.zeroDisplayed=null,t.zeroStyle=null}static fromObj(t){if(t){var e=new Xe;return v.copy(e,t),e.negativeStyle=B.fromJson(t.negativeStyle),e.positiveStyle=B.fromJson(t.positiveStyle),e.zeroStyle=B.fromJson(t.zeroStyle),e}}}class Ze extends Ne{constructor(t){super("GRADUATEDSYMBOL",t),this.baseValue=0,this.expression=null,this.graduatedMode=K.CONSTAN,this.offset=new Fe,this.style=new Xe,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraduatedSymbol"}destroy(){super.destroy();var t=this;t.expression=null,t.graduatedMode=K.CONSTANT,t.offset&&(t.offset.destroy(),t.offset=null),t.style&&(t.style.destroy(),t.style=null)}toJSON(){return v.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,t.memoryData=this.memoryData,t.baseValue=this.baseValue,t.expression=this.expression,t.graduatedMode=this.graduatedMode,this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),this.style&&(t.negativeStyle=this.style.negativeStyle,t.negativeDisplayed=this.style.negativeDisplayed,t.positiveStyle=this.style.positiveStyle,t.zeroDisplayed=this.style.zeroDisplayed,t.zeroStyle=this.style.zeroStyle),t}static fromObj(t){if(t){var e=new Ze;return v.copy(e,t),e.offset=Fe.fromObj(t),e.style=Xe.fromObj(t),e}}}class Ke{constructor(t){this.caption=null,this.end=0,this.start=0,this.style=new B,this.visible=!0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeRangeItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){if(t){var e=new Ke;return v.copy(e,t),e.style=B.fromJson(t.style),e}}}class $e extends Ne{constructor(t){super("RANGE",t),this.precision="1.0E-12",this.items=null,this.rangeExpression=null,this.rangeMode=$.EQUALINTERVAL,this.rangeParameter=0,this.colorGradientType=tt.YELLOW_RED,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeRange"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.rangeExpression=null,t.rangeMode=null,t.rangeParameter=null,t.colorGradientType=null}static fromObj(t){if(t){var e=new $e;v.copy(e,t);var r=t.items,s=r?r.length:0;e.items=[];for(var i=0;i<s;i++)e.items.push(Ke.fromObj(r[i]));return e}}}class tr{constructor(t){t=t||{},this.bounds=null,this.caption=null,this.description=null,this.name=null,this.queryable=null,this.subLayers=null,this.type=null,this.visible=null,v.extend(this,t),this.CLASS_NAME="SuperMap.UGCLayer"}destroy(){v.reset(this)}fromJson(t){t=t||{},v.extend(this,t);var e=this.bounds;e&&(this.bounds=new x(e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y))}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).bounds&&t.bounds.toServerJSONObject&&(t.bounds=t.bounds.toServerJSONObject()),t}}class er extends tr{constructor(t){super(t=t||{}),this.completeLineSymbolDisplayed=null,this.maxScale=null,this.minScale=null,this.minVisibleGeometrySize=null,this.opaqueRate=null,this.symbolScalable=null,this.symbolScale=null,this.overlapDisplayed=null,this.overlapDisplayedOptions=null,this.CLASS_NAME="SuperMap.UGCMapLayer"}destroy(){super.destroy(),v.reset(this)}fromJson(t){super.fromJson(t)}toServerJSONObject(){return super.toServerJSONObject()}}class rr{constructor(t){this.foreignTableName=null,this.joinFilter=null,this.joinType=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.JoinItem"}destroy(){this.foreignTableName=null,this.joinFilter=null,this.joinType=null}toServerJSONObject(){var t={};return t=v.copyAttributes(t,this)}}class sr{constructor(t){t=t||{},this.bounds=null,this.dataSourceName=null,this.description=null,this.encodeType=null,this.isReadOnly=null,this.name=null,this.prjCoordSys=null,this.tableName=null,this.type=null,v.extend(this,t);var e=this.bounds;e&&(this.bounds=new x(e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y)),this.CLASS_NAME="SuperMap.DatasetInfo"}destroy(){v.reset(this)}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).bounds&&t.bounds.toServerJSONObject&&(t.bounds=t.bounds.toServerJSONObject()),t}}class ir extends er{constructor(t){super(t=t||{}),this.datasetInfo=null,this.displayFilter=null,this.joinItems=null,this.representationField=null,this.ugcLayerType=null,this.CLASS_NAME="SuperMap.UGCSubLayer"}fromJson(t){if(super.fromJson(t),this.datasetInfo&&(this.datasetInfo=new sr(this.datasetInfo)),this.joinItems&&this.joinItems.length){for(var e=[],r=0;r<this.joinItems.length;r++)e[r]=new rr(this.joinItems[r]);this.joinItems=e}}destroy(){super.destroy(),v.reset(this)}toServerJSONObject(){var t=super.toServerJSONObject();if(t.joinItems){for(var e=[],r=0;r<t.joinItems.length;r++)t.joinItems[r].toServerJSONObject&&(e[r]=t.joinItems[r].toServerJSONObject());t.joinItems=e}return t.datasetInfo&&t.datasetInfo.toServerJSONObject&&(t.datasetInfo=t.datasetInfo.toServerJSONObject()),t}}class nr extends ir{constructor(t){super(t=t||{}),this.theme=null,this.themeElementPosition=null,this.CLASS_NAME="SuperMap.ServerTheme"}destroy(){super.destroy(),v.reset(this)}fromJson(t){super.fromJson(t);var e=this.theme;switch(e&&e.type){case"LABEL":this.theme=Je.fromObj(e);break;case"UNIQUE":this.theme=ze.fromObj(e);break;case"GRAPH":this.theme=Qe.fromObj(e);break;case"DOTDENSITY":this.theme=Ye.fromObj(e);break;case"GRADUATEDSYMBOL":this.theme=Ze.fromObj(e);break;case"RANGE":this.theme=$e.fromObj(e)}this.themeElementPosition&&(this.themeElementPosition=new _(this.themeElementPosition.x,this.themeElementPosition.y))}toServerJSONObject(){var t=super.toServerJSONObject();return t.themeElementPosition&&t.themeElementPosition.toServerJSONObject&&(t.themeElementPosition=t.themeElementPosition.toServerJSONObject()),t.theme&&t.theme.toServerJSONObject&&(t.theme=t.theme.toServerJSONObject()),t}}class ar{constructor(t){t=t||{},this.elevation=null,this.color=null,v.extend(this,t);var e=this.color;e&&(this.color=new F(e.red,e.green,e.blue)),this.CLASS_NAME="SuperMap.ColorDictionary"}destroy(){v.reset(this)}toServerJSONObject(){var t={};return t=v.copyAttributes(t,this)}}class or extends ir{constructor(t){super(t=t||{}),this.colorDictionarys=null,this.brightness=null,this.colorGradientType=null,this.colors=null,this.contrast=null,this.dashStyle=null,this.gridType=null,this.horizontalSpacing=null,this.sizeFixed=null,this.solidStyle=null,this.specialColor=null,this.specialValue=null,this.specialValueTransparent=null,this.verticalSpacing=null,this.CLASS_NAME="SuperMap.Grid"}destroy(){super.destroy(),v.reset(this)}fromJson(t){if(super.fromJson(t),this.specialColor&&(this.specialColor=new F(this.specialColor.red,this.specialColor.green,this.specialColor.blue)),this.colors){var e,r=[];for(var s in this.colors)e=this.colors[s],r.push(new F(e.red,e.green,e.blue));this.colors=r}if(this.dashStyle&&(this.dashStyle=new B(this.dashStyle)),this.solidStyle&&(this.solidStyle=new B(this.solidStyle)),this.colorDictionary){var i,n=[];for(var a in this.colorDictionary)i=this.colorDictionary[a],n.push(new ar({elevation:a,color:i}));this.colorDictionarys=n}delete this.colorDictionary}toServerJSONObject(){var t=super.toServerJSONObject();return t.dashStyle&&t.dashStyle.toServerJSONObject&&(t.dashStyle=t.dashStyle.toServerJSONObject()),t.solidStyle&&t.solidStyle.toServerJSONObject&&(t.solidStyle=t.solidStyle.toServerJSONObject()),t}}class lr extends ir{constructor(t){super(t=t||{}),this.brightness=null,this.colorSpaceType=null,this.contrast=null,this.displayBandIndexes=null,this.transparent=null,this.transparentColor=null,this.transparentColorTolerance=null,this.CLASS_NAME="SuperMap.Image"}destroy(){super.destroy(),v.reset(this)}fromJson(t){super.fromJson(t),this.transparentColor&&(this.transparentColor=new F(this.transparentColor.red,this.transparentColor.green,this.transparentColor.blue))}toServerJSONObject(){return super.toServerJSONObject()}}class hr extends ir{constructor(t){super(t=t||{}),this.style=null,this.CLASS_NAME="SuperMap.Vector"}destroy(){super.destroy(),v.reset(this)}fromJson(t){super.fromJson(t);var e=this.style;e&&(this.style=new B(e))}toServerJSONObject(){var t=super.toServerJSONObject();return t.style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}}class ur extends Wt{constructor(t,e){super(t,e),this.isTempLayers=!1,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.GetLayersInfoService"}destroy(){super.destroy(),v.reset(this)}processAsync(t){var e=this;return e.isTempLayers||(e.url=v.urlPathAppend(e.url,"layers")),e.request({method:"GET",params:null,scope:e,success:t,failure:t})}transformResult(t,e){var r,s;return s=(r=!!(t=v.transformResult(t))&&t.length>0?t[0].subLayers.layers:null)?r.length:0,this.handleLayers(s,r),{result:t[0],options:e}}handleLayers(t,e){var r;if(t)for(var s=0;s<t;s++){if(e[s].subLayers&&e[s].subLayers.layers&&e[s].subLayers.layers.length>0)this.handleLayers(e[s].subLayers.layers.length,e[s].subLayers.layers);else switch(e[s].ugcLayerType){case"THEME":(r=new nr).fromJson(e[s]),e[s]=r;break;case"GRID":(r=new or).fromJson(e[s]),e[s]=r;break;case"IMAGE":(r=new lr).fromJson(e[s]),e[s]=r;break;case"VECTOR":(r=new hr).fromJson(e[s]),e[s]=r}}}}class cr extends Wt{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.GetLayersLegendInfoService"}destroy(){super.destroy(),v.reset(this)}processAsync(t,e){return this.url=v.urlPathAppend(this.url,"/legend"),this.request({method:"GET",params:t,scope:this,success:e,failure:e})}}class dr extends Wt{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.SetLayerInfoService"}destroy(){super.destroy(),v.reset(this)}processAsync(t,e){if(t){var r=v.toJSON(t);return this.request({method:"PUT",data:r,scope:this,success:e,failure:e})}}}class pr extends Wt{constructor(t,e){super(t,e),this.resourceID=null,this.isTempLayers=!1,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.SetLayersInfoService"}destroy(){super.destroy(),v.reset(this)}processAsync(t,e){if(t){var r,s=[],i=this,n="";i.isTempLayers?(i.url=v.urlPathAppend(i.url,"tempLayersSet/"+i.resourceID),n="PUT"):(i.url=v.urlPathAppend(i.url,"tempLayersSet"),n="POST"),t.subLayers||(t.subLayers={layers:[]}),t.subLayers.layers||(t.subLayers.layers=[]);var a=t.subLayers.layers,o=a.length;for(let t in a){if("GRID"===a[t].ugcLayerType){var l={},h=a[t].colorDictionarys;for(var u in h){l[h[u].elevation]=h[u].color}}a[t].colorDictionary=l,delete a[t].colorDictionarys}for(let t=0;t<o;t++)a[t].toJsonObject?s.push(a[t].toJsonObject()):s.push(a[t]);(r=v.extend(r,t)).subLayers={layers:s},r.object=null;var c=v.toJSON([r]);return i.request({method:n,data:c,scope:i,success:e,failure:e})}}}class fr{constructor(t){this.layerStatusList=[],this.holdTime=15,this.resourceID=null,t&&v.extend(this,t)}destroy(){this.layerStatusList=null,this.holdTime=null,this.resourceID=null}toJSON(){var t="{";t+='"layers":[';for(var e=[],r=0,s=this.layerStatusList.length;r<s;r++)e.push(this.layerStatusList[r].toJSON());return t+=e,t+="]",t+="}"}}class mr extends Wt{constructor(t,e){super(t,e),this.lastparams=null,this.mapUrl=t,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.SetLayerStatusService"}destroy(){super.destroy(),v.reset(this)}processAsync(t,e){if(t instanceof fr){var r=this;if(r.url=r.mapUrl,null==t.resourceID)return r.url=v.urlPathAppend(r.url,"tempLayersSet"),r.lastparams=t,r.request({method:"POST",scope:r,success:r.createTempLayerComplete.bind(r,e),failure:e});r.url=v.urlPathAppend(r.url,"tempLayersSet/"+t.resourceID),r.url=v.urlAppend(r.url,"elementRemain=true&reference="+t.resourceID+"&holdTime="+t.holdTime.toString());var s="[{";return s+='"type":"UGC",',null!=t.layerStatusList&&t.layerStatusList.length>0&&(s+='"subLayers":'+t.toJSON()),s+=',"visible":true,',s+='"name":"'+this.getMapName(this.mapUrl)+'"',s+="}]",r.request({method:"PUT",data:s,scope:r,success:e,failure:e})}}createTempLayerComplete(t,e){return e=e.result?e.result:e,(e=v.transformResult(e)).succeed&&(this.lastparams.resourceID=e.newResourceID),this.processAsync(this.lastparams,t)}getMapName(t){var e=t;"/"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1));var r=e.lastIndexOf("/");return e.substring(r+1,e.length)}transformResult(t,e){return null!=(t=v.transformResult(t))&&null!=this.lastparams&&null!=this.lastparams.resourceID&&(t.newResourceID=this.lastparams.resourceID),{result:t,options:e}}}class yr{constructor(t,e){this.url=t,this.options=e||{}}getLayersInfo(t){var e=this;return new ur(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}getLayersLegendInfo(t,e){var r=this;return new cr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}setLayerInfo(t,e){if(t){var r=this,s=t.resourceID,i=t.tempLayerName,n=t.layerInfo;if(s&&i){var a=v.urlPathAppend(r.url,"tempLayersSet/"+s+"/"+i);return new dr(a,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(n,e)}}}setLayersInfo(t,e){if(t){var r=this,s=t.resourceID,i=!!t.isTempLayers&&t.isTempLayers,n=t.layersInfo;if((!i||s)&&n)return new pr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,resourceID:s,isTempLayers:i}).processAsync(n,e)}}setLayerStatus(t,e){if(t){var r=this;return new mr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}}class gr extends Wt{constructor(t,e){super(t,e),this.projection=null,this.CLASS_NAME="SuperMap.MapService",e&&v.extend(this,e);var r=this;if(r.projection){var s=r.projection.split(":");s instanceof Array&&(2===s.length&&(r.url=v.urlAppend(r.url,`prjCoordSys=${encodeURIComponent(`{"epsgCode":"${s[1]}"}`)}`)),1===s.length&&(r.url=v.urlAppend(r.url,`prjCoordSys=${encodeURIComponent(`{"epsgCode":"${s[0]}"}`)}`)))}}destroy(){super.destroy()}processAsync(t){return this.request({method:"GET",scope:this,success:t,failure:t})}transformResult(t,e){var r=(t=v.transformResult(t)).code>=200&&t.code<300||0==t.code||304===t.code,s=t.code&&r;return!t.code||s?{result:t,options:e}:{error:t,options:e}}}class vr extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TilesetsService"}destroy(){super.destroy()}processAsync(t){if(this.url){return this.url=v.urlPathAppend(this.url,"tilesets"),this.request({method:"GET",scope:this,success:t,failure:t})}}}class br extends Nt{constructor(t,e){super(t,e)}getMapInfo(t){var e=this;return new gr(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers,projection:e.options.projection}).processAsync(t)}getWKT(t){var e=this;return new gr(v.urlPathAppend(e.url,"prjCoordSys.wkt"),{proxy:e.options.proxy,withCredentials:e.options.withCredentials,withoutFormatSuffix:!0,crossOrigin:e.options.crossOrigin,headers:e.options.headers,projection:e.options.projection}).processAsync(t)}getTilesets(t){var e=this;return new vr(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}}class Sr{constructor(t,e){t&&(this.geometry=t,this.unit=W.METER,this.prjCoordSys=null,this.distanceMode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.MeasureParameters")}destroy(){this.geometry=null,this.unit=null,this.prjCoordSys=null}}class _r extends Wt{constructor(t,e){super(t,e),this.measureMode=H.DISTANCE,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.MeasureService"}destroy(){super.destroy();this.measureMode=null}processAsync(t,e){if(t instanceof Sr){var r,s,i=this,n=t.geometry;if(n){i.url=v.urlPathAppend(i.url,i.measureMode===H.AREA?"area":"distance");var a,o,l,h=Tt.fromGeometry(n);if(h)return r=h.parts[0],s=h.points.splice(0,r),t.prjCoordSys?("object"==typeof t.prjCoordSys?a='{"epsgCode"'+(o=t.prjCoordSys.projCode).substring(o.indexOf(":"),o.length)+"}":"string"==typeof t.prjCoordSys&&(a='{"epsgCode"'+t.prjCoordSys.substring(t.prjCoordSys.indexOf(":"),t.prjCoordSys.length)+"}"),l={point2Ds:v.toJSON(s),unit:t.unit,prjCoordSys:a,distanceMode:t.distanceMode||"Geodesic"}):l={point2Ds:v.toJSON(s),unit:t.unit,distanceMode:t.distanceMode||"Geodesic"},i.request({method:"GET",params:l,scope:i,success:e,failure:e})}}}}class xr extends Wt{constructor(t,e){super(t,e),this.format=U.GEOJSON,this.CLASS_NAME="SuperMap.NetworkAnalystServiceBase"}destroy(){super.destroy(),this.format=null}transformResult(t,e){var r;return(t=v.transformResult(t))&&this.format===U.GEOJSON&&"function"==typeof this.toGeoJSONResult&&(r=this.toGeoJSONResult(t)),r||(r=t),{result:r,options:e}}toGeoJSONResult(t){return null}}class wr{constructor(t){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.isUncertainDirectionValid=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.BurstPipelineAnalystParameters"}destroy(){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.isUncertainDirectionValid=null}}class Ar extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.BurstPipelineAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(!(t instanceof wr))return null;var r;if(this.url=v.urlPathAppend(this.url,"burstAnalyse"),r={sourceNodeIDs:t.sourceNodeIDs,isUncertainDirectionValid:t.isUncertainDirectionValid},null!==t.edgeID&&null!==t.nodeID)throw new Error("edgeID and nodeID cannot be null at the same time.");if(null===t.edgeID&&null===t.nodeID)throw new Error("edgeID and nodeID cannot be null at the same time.");return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}class Mr{constructor(t){t&&(this.returnEdgeFeatures=!1,this.returnEdgeGeometry=!1,this.returnEdgeIDs=!1,this.returnNodeFeatures=!1,this.returnNodeGeometry=!1,this.returnNodeIDs=!1,this.returnPathGuides=!1,this.returnRoutes=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.TransportationAnalystResultSetting")}destroy(){var t=this;t.returnEdgeFeatures=null,t.returnEdgeGeometry=null,t.returnEdgeIDs=null,t.returnNodeFeatures=null,t.returnNodeGeometry=null,t.returnNodeIDs=null,t.returnPathGuides=null,t.returnRoutes=null}}class Cr{constructor(t){t&&(this.barrierEdgeIDs=null,this.barrierNodeIDs=null,this.barrierPoints=null,this.weightFieldName=null,this.turnWeightField=null,this.resultSetting=new Mr,v.extend(this,t),this.CLASS_NAME="SuperMap.TransportationAnalystParameter")}destroy(){var t=this;if(t.barrierEdgeIDs=null,t.barrierNodeIDs=null,t.weightFieldName=null,t.turnWeightField=null,t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.barrierPoints&&t.barrierPoints.length)for(var e in t.barrierPoints)t.barrierPoints[e].destroy();t.barrierPoints=null}}class Er{constructor(t){this.isAnalyzeById=!1,this.nodes=null,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.ComputeWeightMatrixParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Tr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ComputeWeightMatrixService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Er){var r,s=this;return s.url=v.urlPathAppend(s.url,"weightmatrix"),r={parameter:v.toJSON(t.parameter),nodes:s.getJson(t.isAnalyzeById,t.nodes)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getJson(t,e){var r="[",s=e?e.length:0;if(!1===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+=e[t];return r+="]"}}class Or{constructor(t){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.returnFeatures=!0,this.isUncertainDirectionValid=!1,this.queryType=null,v.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalystStreamParameters"}destroy(){var t=this;t.edgeID=null,t.nodeID=null,t.weightName=null,t.returnFeatures=null,t.isUncertainDirectionValid=null,t.type=null}}class Pr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystStreamService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Or){var r,s=this;if(0===t.queryType)s.url=v.urlPathAppend(s.url,"upstreamcirticalfaclilities");else{if(1!==t.queryType)return;s.url=v.urlPathAppend(s.url,"downstreamcirticalfaclilities")}if(r={sourceNodeIDs:t.sourceNodeIDs,isUncertainDirectionValid:t.isUncertainDirectionValid,returnFeatures:t.returnFeatures},!(null!==t.edgeID&&null!==t.nodeID||null===t.edgeID&&null===t.nodeID))return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}toGeoJSONResult(t){if(!t)return null;var e=new Ot;return t.edgesFeatures&&(t.edgesFeatures=e.toGeoJSON(t.edgesFeatures)),t.nodesFeatures&&(t.nodesFeatures=e.toGeoJSON(t.nodesFeatures)),t}}class Lr{constructor(t){this.edgeID=null,this.nodeID=null,this.weightName=null,this.returnFeatures=!0,this.isUncertainDirectionValid=!0,this.traceType=null,this.withIndex=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TraceAnalystParameters"}destroy(){var t=this;t.edgeID=null,t.nodeID=null,t.weightName=null,t.returnFeatures=null,t.isUncertainDirectionValid=null,t.type=null,t.withIndex=null}}class Ir extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TraceAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Lr){var r,s=this;if(0===t.traceType)s.url=v.urlPathAppend(s.url,"traceup");else{if(1!==t.traceType)return;s.url=v.urlPathAppend(s.url,"tracedown")}if(r={weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid,returnFeatures:t.returnFeatures},!(null!==t.edgeID&&null!==t.nodeID||null===t.edgeID&&null===t.nodeID))return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}toGeoJSONResult(t){if(!t)return null;var e=new Ot;return t.edgesFeatures&&(t.edgesFeatures=e.toGeoJSON(t.edgesFeatures)),t.nodesFeatures&&(t.nodesFeatures=e.toGeoJSON(t.nodesFeatures)),t}}class Nr{constructor(t){this.connected=null,this.returnFeatures=!0,this.edgeIDs=null,this.nodeIDs=null,this.withIndex=null,v.extend(this,t),this.CLASS_NAME="SuperMap.ConnectedEdgesAnalystParameters"}destroy(){var t=this;t.edgeIDs=null,t.nodeIDs=null,t.connected=null,t.returnFeatures=null,t.withIndex=null}}class kr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ConnectedEdgesAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Nr){var r;if(this.url=v.urlPathAppend(this.url,"connectededges"),r={connected:t.connected,returnFeatures:t.returnFeatures},!(null!==t.edgeIDs&&null!==t.nodeIDs||null===t.edgeIDs&&null===t.nodeIDs))return null!==t.edgeIDs?r.edgeIDs=t.edgeIDs:r.nodeIDs=t.nodeIDs,this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}toGeoJSONResult(t){if(!t)return null;var e=new Ot;return t.edgesFeatures&&(t.edgesFeatures=e.toGeoJSON(t.edgesFeatures)),t.nodesFeatures&&(t.nodesFeatures=e.toGeoJSON(t.nodesFeatures)),t}}class Rr{constructor(t){this.event=null,this.expectFacilityCount=1,this.facilities=null,this.fromEvent=!1,this.isAnalyzeById=!1,this.maxWeight=0,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.FindClosestFacilitiesParameters"}destroy(){var t=this;t.event=null,t.expectFacilityCount=null,t.facilities=null,t.fromEvent=null,t.isAnalyzeById=null,t.maxWeight=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Dr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindClosestFacilitiesService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Rr){var r,s=this;return s.url=v.urlPathAppend(s.url,"closestfacility"),r={expectFacilityCount:t.expectFacilityCount,fromEvent:t.fromEvent,maxWeight:t.maxWeight,parameter:v.toJSON(t.parameter),event:v.toJSON(t.event),facilities:s.getJson(t.isAnalyzeById,t.facilities)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getJson(t,e){var r="[",s=e?e.length:0;if(!1===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.facilityPathList)return t;var e=new Ot;return t.facilityPathList.map(function(t){return t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t}),t}}class Fr{constructor(t){this.expectedSupplyCenterCount=null,this.isFromCenter=!1,this.supplyCenters=null,this.turnWeightField=null,this.weightName=null,v.extend(this,t),this.CLASS_NAME="SuperMap.FindLocationParameters"}destroy(){var t=this;if(t.expectedSupplyCenterCount=null,t.isFromCenter=null,t.turnWeightField=null,t.weightName=null,t.supplyCenters){for(var e=0,r=t.supplyCenters,s=r.length;e<s;e++)r[e].destroy();t.supplyCenters=null}}}class Br extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindLocationService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Fr){var r,s=this;return s.url=v.urlPathAppend(s.url,"location"),r={isFromCenter:t.isFromCenter,expectedSupplyCenterCount:t.expectedSupplyCenterCount,weightName:t.weightName,turnWeightField:t.turnWeightField,returnEdgeFeature:!0,returnEdgeGeometry:!0,returnNodeFeature:!0,mapParameter:v.toJSON(t.mapParameter),supplyCenters:s.getCentersJson(t.supplyCenters)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getCentersJson(t){for(var e="[",r=t?t.length:0,s=0;s<r;s++)s>0&&(e+=","),e+=v.toJSON(t[s]);return e+="]"}toGeoJSONResult(t){if(!t)return null;var e=new Ot;return t.demandResults&&(t.demandResults=e.toGeoJSON(t.demandResults)),t.supplyResults&&(t.supplyResults=e.toGeoJSON(t.supplyResults)),t}}class Gr{constructor(t){this.centers=null,this.hasLeastTotalCost=!1,this.isAnalyzeById=!1,this.nodes=null,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.FindMTSPPathsParameters"}destroy(){var t=this;t.centers=null,t.hasLeastTotalCost=null,t.isAnalyzeById=null,t.nodes=null,t.maxWeight=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class jr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindMTSPPathsService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Gr){var r,s=this,i=s.getJson(t.isAnalyzeById,t.centers),n=s.getJson(t.isAnalyzeById,t.nodes);return s.url=v.urlPathAppend(s.url,"mtsppath"),r={centers:i,nodes:n,parameter:v.toJSON(t.parameter),hasLeastTotalCost:t.hasLeastTotalCost},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getJson(t,e){var r="[",s=e?e.length:0;if(!1===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.pathList)return null;var e=new Ot;return t.pathList.map(function(t){return t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t}),t}}class Ur{constructor(t){this.isAnalyzeById=!1,this.hasLeastEdgeCount=null,this.nodes=null,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.FindPathParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.hasLeastEdgeCount=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Jr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindPathService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Ur){var r,s=this;return s.url=v.urlPathAppend(s.url,"path"),r={hasLeastEdgeCount:t.hasLeastEdgeCount,parameter:v.toJSON(t.parameter),nodes:s.getJson(t.isAnalyzeById,t.nodes)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getJson(t,e){var r="[",s=e?e.length:0;if(!1===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.pathList||t.pathList.length<1)return null;var e=new Ot;return t.pathList.forEach(function(t){t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures))}),t}}class zr{constructor(t){this.isAnalyzeById=!1,this.isCenterMutuallyExclusive=!1,this.centers=null,this.isFromCenter=!1,this.weights=null,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.FindServiceAreasParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.isCenterMutuallyExclusive=null,t.centers=null,t.isFromCenter=null,t.weights=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class qr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindServiceAreasService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof zr){var r,s=this;return s.url=v.urlPathAppend(s.url,"servicearea"),r={isFromCenter:t.isFromCenter,isCenterMutuallyExclusive:t.isCenterMutuallyExclusive,parameter:v.toJSON(t.parameter),centers:s.getJson(t.isAnalyzeById,t.centers),weights:s.getJson(!0,t.weights)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getJson(t,e){var r="[",s=e?e.length:0;if(!1===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<s;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.serviceAreaList)return t;var e=new Ot;return t.serviceAreaList.map(function(t){return t.serviceRegion&&(t.serviceRegion=e.toGeoJSON(t.serviceRegion)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t.routes&&(t.routes=e.toGeoJSON(t.routes)),t}),t}}class Vr{constructor(t){this.endNodeAssigned=!1,this.isAnalyzeById=!1,this.nodes=null,this.parameter=new Cr,v.extend(this,t),this.CLASS_NAME="SuperMap.FindTSPPathsParameters"}destroy(){var t=this;t.endNodeAssigned=null,t.isAnalyzeById=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Hr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindTSPPathsService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Vr){var r,s=this;return s.url=v.urlPathAppend(s.url,"tsppath"),r={parameter:v.toJSON(t.parameter),endNodeAssigned:t.endNodeAssigned,nodes:s.getNodesJson(t)},s.request({method:"GET",params:r,scope:s,success:e,failure:e})}}getNodesJson(t){var e,r,s,i,n="";if(!1===t.isAnalyzeById){for(e="[",r=0,s=(i=t.nodes).length;r<s;r++)r>0&&(e+=","),e+='{"x":'+i[r].x+',"y":'+i[r].y+"}";n+=e+="]"}else if(!0===t.isAnalyzeById){let e="[",r=t.nodes,s=r.length;for(let t=0;t<s;t++)t>0&&(e+=","),e+=r[t];n+=e+="]"}return n}toGeoJSONResult(t){if(!t||!t.tspPathList)return null;var e=new Ot;return t.tspPathList.forEach(function(t){t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures))}),t}}class Wr{constructor(t){t&&(this.edgeId="",this.fromNodeId="",this.toNodeId="",this.weightField="",this.edgeWeight="",v.extend(this,t),this.CLASS_NAME="SuperMap.UpdateEdgeWeightParameters")}destroy(){this.edgeId=null,this.fromNodeId=null,this.toNodeId=null,this.weightField=null,this.edgeWeight=null}}class Qr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.UpdateEdgeWeightService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Wr){var r=this,s=r.parse(t);r.url=v.urlPathAppend(r.url,s);var i=t.edgeWeight?t.edgeWeight:null;return r.request({method:"PUT",scope:r,data:i,success:e,failure:e})}}parse(t){if(t){var e="";for(var r in t)if(""!==t[r]&&"edgeWeight"!==t[r])switch(r){case"edgeId":e+="/edgeweight/"+t[r];break;case"fromNodeId":e+="/fromnode/"+t[r];break;case"toNodeId":e+="/tonode/"+t[r];break;case"weightField":e+="/weightfield/"+t[r]}return e}}}class Yr{constructor(t){t&&(this.nodeId="",this.fromEdgeId="",this.toEdgeId="",this.weightField="",this.turnNodeWeight="",v.extend(this,t),this.CLASS_NAME="SuperMap.UpdateTurnNodeWeightParameters")}destroy(){this.nodeId=null,this.fromEdgeId=null,this.toEdgeId=null,this.weightField=null,this.turnNodeWeight=null}}class Xr extends xr{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.UpdateTurnNodeWeightService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Yr){var r=this,s=r.parse(t);r.url=v.urlPathAppend(r.url,s);var i=t.turnNodeWeight?t.turnNodeWeight:null;return r.request({method:"PUT",scope:r,data:i,success:e,failure:e})}}parse(t){if(t){var e="";for(var r in t)if(""!==t[r]&&"turnNodeWeight"!==t[r])switch(r){case"nodeId":e+="/turnnodeweight/"+t[r];break;case"fromEdgeId":e+="/fromedge/"+t[r];break;case"toEdgeId":e+="/toedge/"+t[r];break;case"weightField":e+="/weightfield/"+t[r]}return e}}}class Zr{constructor(t,e){this.url=t,this.options=e||{}}burstPipelineAnalyst(t,e){var r=this;return new Ar(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}computeWeightMatrix(t,e){var r=this;return new Tr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}findClosestFacilities(t,e,r){var s=this;return new Dr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}traceAnalyst(t,e,r){var s=this;return new Ir(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}connectedEdgesAnalyst(t,e,r){var s=this;return new kr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}streamFacilityAnalyst(t,e,r){var s=this;return new Pr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}findLocation(t,e,r){var s=this;return new Br(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}findPath(t,e,r){var s=this;return new Jr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}findTSPPaths(t,e,r){var s=this;return new Hr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}findMTSPPaths(t,e,r){var s=this;return new jr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}findServiceAreas(t,e,r){var s=this;return new qr(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}updateEdgeWeight(t,e){var r=this;return new Qr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}updateTurnNodeWeight(t,e){var r=this;return new Xr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}_processFormat(t){return t||U.GEOJSON}}class Kr{constructor(t){this.edgeID=null,this.nodeID=null,this.weightName=null,this.isUncertainDirectionValid=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalyst3DParameters"}destroy(){this.edgeID=null,this.nodeID=null,this.weightName=null,this.isUncertainDirectionValid=null}}class $r extends Kr{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystSinks3DParameters"}destroy(){super.destroy()}}class ts extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystSinks3DService"}destroy(){Wt.prototype.destroy.apply(this,arguments)}processAsync(t,e){if(t instanceof $r){var r;return this.url=v.urlPathAppend(this.url,"sinks"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class es extends Kr{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystSources3DParameters"}destroy(){super.destroy()}}class rs extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystSources3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof es){var r;return this.url=v.urlPathAppend(this.url,"sources"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class ss extends Kr{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystTraceup3DParameters"}destroy(){super.destroy()}}class is extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystTraceup3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ss){var r;return this.url=v.urlPathAppend(this.url,"traceupresult"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class ns extends Kr{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystTracedown3DParameters"}destroy(){super.destroy()}}class as extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystTracedown3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ns){var r;return this.url=v.urlPathAppend(this.url,"tracedownresult"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class os extends Kr{constructor(t){super(t),t=t||{},this.sourceNodeIDs=null,v.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalystUpstream3DParameters"}destroy(){super.destroy(),this.sourceNodeIDs=null}}class ls extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystUpstream3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof os){var r;return this.url=v.urlPathAppend(this.url,"upstreamcirticalfaclilities"),r={sourceNodeIDs:t.sourceNodeIDs,edgeID:t.edgeID,nodeID:t.nodeID,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class hs{constructor(t,e){this.url=t,this.options=e||{}}sinksFacilityAnalyst(t,e){var r=this;return new ts(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}sourcesFacilityAnalyst(t,e){var r=this;return new rs(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}traceUpFacilityAnalyst(t,e){var r=this;return new is(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}traceDownFacilityAnalyst(t,e){var r=this;return new as(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}upstreamFacilityAnalyst(t,e){var r=this;return new ls(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}class us extends Wt{constructor(t,e){super(t,e=e||{}),this.CLASS_NAME="SuperMap.ProcessingServiceBase"}destroy(){super.destroy()}getJobs(t,e){var r=this;return Jt.get(Ht.appendCredential(t),null,{proxy:r.proxy}).then(function(t){return t.json()}).then(function(t){const s={result:t,object:r,type:"processCompleted"};return e(s),s}).catch(function(t){const s={error:t,object:r,type:"processFailed"};return e(s),s})}addJob(t,e,r,s,i,n){var a=this,o=null;e&&e instanceof r&&(o=new Object,r.toObject(e,o));let l=Object.assign({"Content-Type":"application/x-www-form-urlencoded"},a.headers||{});var h={proxy:a.proxy,headers:l,withCredentials:a.withCredentials,crossOrigin:a.crossOrigin,isInTheSameDomain:a.isInTheSameDomain};return Jt.post(Ht.appendCredential(t),JSON.stringify(o),h).then(function(t){return t.json()}).then(function(t){return t.succeed?a.transformResult(t,s,i,n):((t=a.transformErrorResult(t)).options=a,t.type="processFailed",i(t),t)}).catch(function(t){return(t=a.transformErrorResult({error:t})).options=a,t.type="processFailed",i(t),t})}transformResult(t,e,r,s){t=v.transformResult(t),e=e||1e3;var i=this;if(t)return new Promise(n=>{var a=setInterval(function(){Jt.get(Ht.appendCredential(t.newResourceLocation),{_t:(new Date).getTime()}).then(function(t){return t.json()}).then(function(t){if(n({object:i,id:t.id,state:t.state}),s({id:t.id,state:t.state,object:i}),"LOST"===t.state.runState||"KILLED"===t.state.runState||"FAILED"===t.state.runState){clearInterval(a);const e={error:t.state.errorMsg,state:t.state.runState,object:i,type:"processFailed"};n(e),r(e)}if("FINISHED"===t.state.runState&&t.setting.serviceInfo){clearInterval(a);const e={result:t,object:i,type:"processCompleted"};n(e),r(e)}}).catch(function(t){clearInterval(a);const e={error:t,object:i,type:"processFailed"};n(e),r(e)})},e)})}}class cs{constructor(t){this.alias=null,this.connect=null,this.dataBase=null,this.driver=null,this.engineType=null,this.exclusive=null,this.OpenLinkTable=null,this.password=null,this.readOnly=null,this.server=null,this.user=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.DatasourceConnectionInfo"}destroy(){var t=this;t.alias=null,t.connect=null,t.dataBase=null,t.driver=null,t.engineType=null,t.exclusive=null,t.OpenLinkTable=null,t.password=null,t.readOnly=null,t.server=null,t.user=null}}class ds{constructor(t){this.type=ot.UDB,this.datasetName="analystResult",this.datasourceInfo=null,this.outputPath="",v.extend(this,t),this.CLASS_NAME="SuperMap.OutputSetting"}destroy(){var t=this;t.type=null,t.datasetName=null,t.outputPath=null,t.datasourceInfo instanceof cs&&(t.datasourceInfo.destroy(),t.datasourceInfo=null)}}class ps{constructor(t){this.items=null,this.numericPrecision=1,this.rangeMode=$.EQUALINTERVAL,this.rangeCount="",this.colorGradientType=tt.YELLOW_RED,v.extend(this,t),this.CLASS_NAME="SuperMap.MappingParameters"}destroy(){var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.numericPrecision=null,t.rangeMode=null,t.rangeCount=null,t.colorGradientType=null}}class fs{constructor(t){t&&(this.datasetName="",this.query="",this.resolution=80,this.method=0,this.meshType=0,this.fields="",this.radius=300,this.meshSizeUnit=bt.METER,this.radiusUnit=bt.METER,this.areaUnit=vt.SQUAREMILE,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.KernelDensityJobParameter")}destroy(){this.datasetName=null,this.query=null,this.resolution=null,this.method=null,this.radius=null,this.meshType=null,this.fields=null,this.meshSizeUnit=null,this.radiusUnit=null,this.areaUnit=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class ms extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/density"),this.CLASS_NAME="SuperMap.KernelDensityJobsService"}destroy(){super.destroy()}getKernelDensityJobs(t){return super.getJobs(this.url,t)}getKernelDensityJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addKernelDensityJob(t,e,r,s){return super.addJob(this.url,t,fs,e,r,s)}}class ys{constructor(t){t&&(this.datasetName="",this.datasetQuery="",this.geometryQuery="",this.mode=V.CONTAIN,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SingleObjectQueryJobsParameter")}destroy(){this.datasetName=null,this.datasetQuery=null,this.geometryQuery=null,this.mode=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class gs extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/query"),this.CLASS_NAME="SuperMap.SingleObjectQueryJobsService"}destroy(){super.destroy()}getQueryJobs(t){return super.getJobs(this.url,t)}getQueryJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addQueryJob(t,e,r,s){return super.addJob(this.url,t,ys,e,r,s)}}class vs{constructor(t){t&&(this.datasetName="",this.regionDataset="",this.query="",this.resolution=100,this.meshType=0,this.statisticModes=St.AVERAGE,this.fields="",this.type=_t.SUMMARYMESH,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SummaryMeshJobParameter")}destroy(){this.datasetName=null,this.query=null,this.resolution=null,this.statisticModes=null,this.meshType=null,this.fields=null,this.regionDataset=null,this.type=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"type"!==r?"output"!==r?("SUMMARYMESH"===t.type&&"regionDataset"!==r||"SUMMARYREGION"===t.type&&!s(["meshType","resolution","query"],r))&&(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):e.type=t[r]:(e.input=e.input||{},e.input[r]=t[r]);function s(t,e){for(var r=t.length;r--;)if(t[r]===e)return!0;return!1}}}class bs extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/aggregatepoints"),this.CLASS_NAME="SuperMap.SummaryMeshJobsService"}destroy(){super.destroy()}getSummaryMeshJobs(t){return super.getJobs(this.url,t)}getSummaryMeshJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addSummaryMeshJob(t,e,r,s){return super.addJob(this.url,t,vs,e,r,s)}}class Ss{constructor(t){t=t||{},this.datasetName="",this.datasetVectorClip="",this.geometryClip="",this.mode=gt.CLIP,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.VectorClipJobsParameter"}destroy(){this.datasetName=null,this.datasetVectorClip=null,this.geometryClip=null,this.mode=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class _s extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/vectorclip"),this.CLASS_NAME="SuperMap.VectorClipJobsService"}destroy(){super.destroy()}getVectorClipJobs(t){return super.getJobs(this.url,t)}getVectorClipJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addVectorClipJob(t,e,r,s){return super.addJob(this.url,t,Ss,e,r,s)}}class xs{constructor(t){t&&(this.datasetName="",this.datasetOverlay="",this.mode="",this.srcFields="",this.overlayFields="",this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.OverlayGeoJobParameter")}destroy(){this.datasetName=null,this.datasetOverlay=null,this.mode=null,this.srcFields=null,this.overlayFields=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!=r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class ws extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/overlay"),this.CLASS_NAME="SuperMap.OverlayGeoJobsService"}destroy(){super.destroy()}getOverlayGeoJobs(t){return super.getJobs(this.url,t)}getOverlayGeoJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addOverlayGeoJob(t,e,r,s){return super.addJob(this.url,t,xs,e,r,s)}}class As{constructor(t){t&&(this.datasetName="",this.regionDataset="",this.sumShape=!0,this.query="",this.standardSummaryFields=!1,this.standardFields="",this.standardStatisticModes="",this.weightedSummaryFields=!1,this.weightedFields="",this.weightedStatisticModes="",this.meshType=0,this.resolution=100,this.meshSizeUnit=bt.METER,this.type=_t.SUMMARYMESH,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SummaryRegionJobParameter")}destroy(){this.datasetName=null,this.sumShape=null,this.regionDataset=null,this.query=null,this.standardSummaryFields=null,this.standardFields=null,this.standardStatisticModes=null,this.weightedSummaryFields=null,this.weightedFields=null,this.weightedStatisticModes=null,this.meshType=null,this.resolution=null,this.meshSizeUnit=null,this.type=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"type"!==r&&"type"!==r?"output"!==r?("SUMMARYREGION"===t.type||"SUMMARYMESH"===t.type&&"regionDataset"!==r)&&(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):e.type=t[r]:(e.input=e.input||{},e.input[r]=t[r])}}class Ms extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/summaryregion"),this.CLASS_NAME="SuperMap.SummaryRegionJobsService"}destroy(){super.destroy()}getSummaryRegionJobs(t){return super.getJobs(this.url,t)}getSummaryRegionJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addSummaryRegionJob(t,e,r,s){return super.addJob(this.url,t,As,e,r,s)}}class Cs{constructor(t){if(this.datasetName="",this.bounds="",this.distance="",this.distanceField="",this.distanceUnit=bt.METER,this.dissolveField="",this.output=null,this.mappingParameters=null,!t)return this;v.extend(this,t),this.CLASS_NAME="SuperMap.BuffersAnalystJobsParameter"}destroy(){this.datasetName=null,this.bounds=null,this.distance=null,this.distanceField=null,this.distanceUnit=null,this.dissolveField=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},"bounds"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Es extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/buffers"),this.CLASS_NAME="SuperMap.BuffersAnalystJobsService"}destroy(){super.destroy()}getBuffersJobs(t){return super.getJobs(this.url,t)}getBuffersJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addBuffersJob(t,e,r,s){return super.addJob(this.url,t,Cs,e,r,s)}}class Ts{constructor(t){t&&(this.datasetName="",this.datasetTopology="",this.tolerance="",this.rule=xt.REGIONNOOVERLAP,this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TopologyValidatorJobsParameter")}destroy(){this.datasetName=null,this.datasetTopology=null,this.tolerance=null,this.rule=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Os extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/topologyvalidator"),this.CLASS_NAME="SuperMap.TopologyValidatorJobsService"}destroy(){super.destroy()}getTopologyValidatorJobs(t){return super.getJobs(this.url,t)}getTopologyValidatorJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addTopologyValidatorJob(t,e,r,s){return super.addJob(this.url,t,Ts,e,r,s)}}class Ps{constructor(t){t&&(this.datasetName="",this.groupField="",this.attributeField="",this.statisticModes="",this.output=null,this.mappingParameters=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SummaryAttributesJobsParameter")}destroy(){this.datasetName=null,this.groupField=null,this.attributeField=null,this.statisticModes=null,this.output instanceof ds&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof ps&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Ls extends us{constructor(t,e){super(t,e),this.url=v.urlPathAppend(this.url,"spatialanalyst/summaryattributes"),this.CLASS_NAME="SuperMap.SummaryAttributesJobsService"}destroy(){super.destroy()}getSummaryAttributesJobs(t){return super.getJobs(this.url,t)}getSummaryAttributesJob(t,e){return super.getJobs(v.urlPathAppend(this.url,t),e)}addSummaryAttributesJob(t,e,r,s){return super.addJob(this.url,t,Ps,e,r,s)}}class Is{constructor(t,e){this.url=t,this.options=e||{},this.kernelDensityJobs={},this.summaryMeshJobs={},this.queryJobs={},this.summaryRegionJobs={},this.vectorClipJobs={},this.overlayGeoJobs={},this.buffersJobs={},this.topologyValidatorJobs={},this.summaryAttributesJobs={}}getKernelDensityJobs(t,e){var r=this,s=r._processFormat(e);return new ms(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getKernelDensityJobs(t)}getKernelDensityJob(t,e,r){var s=this,i=s._processFormat(r);return new ms(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getKernelDensityJob(t,e)}addKernelDensityJob(t,e,r,s){var i=this,n=i._processFormat(s);return new ms(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addKernelDensityJob(t,r,e,function(t){i.kernelDensityJobs[t.id]=t.state})}getKernelDensityJobState(t){return this.kernelDensityJobs[t]}getSummaryMeshJobs(t,e){var r=this,s=r._processFormat(e);return new bs(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getSummaryMeshJobs(t)}getSummaryMeshJob(t,e,r){var s=this,i=s._processFormat(r);return new bs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getSummaryMeshJob(t,e)}addSummaryMeshJob(t,e,r,s){var i=this,n=i._processFormat(s);return new bs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addSummaryMeshJob(t,r,e,function(t){i.summaryMeshJobs[t.id]=t.state})}getSummaryMeshJobState(t){return this.summaryMeshJobs[t]}getQueryJobs(t,e){var r=this,s=r._processFormat(e);return new gs(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getQueryJobs(t)}getQueryJob(t,e,r){var s=this,i=s._processFormat(r);return new gs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getQueryJob(t,e)}addQueryJob(t,e,r,s){var i=this,n=i._processFormat(s);return new gs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addQueryJob(t,r,e,function(t){i.queryJobs[t.id]=t.state})}getQueryJobState(t){return this.queryJobs[t]}getSummaryRegionJobs(t,e){var r=this,s=r._processFormat(e);return new Ms(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getSummaryRegionJobs(t)}getSummaryRegionJob(t,e,r){var s=this,i=s._processFormat(r);return new Ms(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getSummaryRegionJob(t,e)}addSummaryRegionJob(t,e,r,s){var i=this,n=i._processFormat(s);return new Ms(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addSummaryRegionJob(t,r,e,function(t){i.summaryRegionJobs[t.id]=t.state})}getSummaryRegionJobState(t){return this.summaryRegionJobs[t]}getVectorClipJobs(t,e){var r=this,s=r._processFormat(e);return new _s(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getVectorClipJobs(t)}getVectorClipJob(t,e,r){var s=this,i=s._processFormat(r);return new _s(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getVectorClipJob(t,e)}addVectorClipJob(t,e,r,s){var i=this,n=i._processFormat(s);return new _s(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addVectorClipJob(t,r,e,function(t){i.vectorClipJobs[t.id]=t.state})}getVectorClipJobState(t){return this.vectorClipJobs[t]}getOverlayGeoJobs(t,e){var r=this,s=r._processFormat(e);return new ws(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getOverlayGeoJobs(t)}getOverlayGeoJob(t,e,r){var s=this,i=s._processFormat(r);return new ws(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getOverlayGeoJob(t,e)}addOverlayGeoJob(t,e,r,s){var i=this,n=i._processFormat(s);return new ws(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addOverlayGeoJob(t,r,e,function(t){i.overlayGeoJobs[t.id]=t.state})}getoverlayGeoJobState(t){return this.overlayGeoJobs[t]}getBuffersJobs(t,e){var r=this,s=r._processFormat(e);return new Es(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getBuffersJobs(t)}getBuffersJob(t,e,r){var s=this,i=s._processFormat(r);return new Es(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getBuffersJob(t,e)}addBuffersJob(t,e,r,s){var i=this,n=i._processFormat(s);return new Es(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addBuffersJob(t,r,e,function(t){i.buffersJobs[t.id]=t.state})}getBuffersJobState(t){return this.buffersJobs[t]}getTopologyValidatorJobs(t,e){var r=this,s=r._processFormat(e);return new Os(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getTopologyValidatorJobs(t)}getTopologyValidatorJob(t,e,r){var s=this,i=s._processFormat(r);return new Os(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getTopologyValidatorJob(t,e)}addTopologyValidatorJob(t,e,r,s){var i=this,n=i._processFormat(s);return new Os(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addTopologyValidatorJob(t,r,e,function(t){i.topologyValidatorJobs[t.id]=t.state})}getTopologyValidatorJobState(t){return this.topologyValidatorJobs[t]}getSummaryAttributesJobs(t,e){var r=this,s=r._processFormat(e);return new Ls(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:s}).getSummaryAttributesJobs(t)}getSummaryAttributesJob(t,e,r){var s=this,i=s._processFormat(r);return new Ls(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:i}).getSummaryAttributesJob(t,e)}addSummaryAttributesJob(t,e,r,s){var i=this,n=i._processFormat(s);return new Ls(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).addSummaryAttributesJob(t,r,e,function(t){i.summaryAttributesJobs[t.id]=t.state})}getSummaryAttributesJobState(t){return this.summaryAttributesJobs[t]}_processFormat(t){return t||U.GEOJSON}}class Ns extends Wt{constructor(t,e){super(t,e),this.returnContent=!1,this.format=U.GEOJSON,this.returnFeatureWithFieldCaption=!1,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.QueryService",this.url&&(e&&e.format&&(this.format=e.format.toUpperCase()),this.url=v.urlPathAppend(this.url,"queryResults"))}destroy(){super.destroy();this.returnContent=null,this.format=null}processAsync(t,e){if(t instanceof Zt){var r,s=this,i=null;return s.returnContent=t.returnContent,r=s.getJsonParameters(t),s.returnContent||(i=t.returnCustomResult)&&(s.url=v.urlAppend(s.url,"returnCustomResult="+i)),s.returnFeatureWithFieldCaption=t.returnFeatureWithFieldCaption,s.request({method:"POST",data:r,scope:s,success:e,failure:e})}}transformResult(t,e){t=v.transformResult(t);var r=new Ot;if(t&&t.recordsets)for(var s=0,i=t.recordsets,n=i.length;s<n;s++)i[s].features&&(!0===this.returnFeatureWithFieldCaption&&i[s].features.map(t=>(t.fieldNames=i[s].fieldCaptions,t)),this.format===U.GEOJSON&&(i[s].features=r.toGeoJSON(i[s].features)));return{result:t,options:e}}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}getQueryParameters(t){return new Zt({customParams:t.customParams,expectCount:t.expectCount,networkType:t.networkType,queryOption:t.queryOption,queryParams:t.queryParams,startRecord:t.startRecord,prjCoordSys:t.prjCoordSys,holdTime:t.holdTime})}}class ks extends Zt{constructor(t){super(t=t||{}),this.returnContent=!0,this.bounds=null,v.extend(this,t),this.CLASS_NAME="SuperMap.QueryByBoundsParameters"}destroy(){super.destroy();this.returnContent=null,this.bounds&&(this.bounds=null)}}class Rs extends Ns{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByBoundsService"}destroy(){super.destroy()}getJsonParameters(t){if(!(t instanceof ks))return null;var e,r="",s=t.bounds;return e=this.getQueryParameters(t),r+="'queryMode':'BoundsQuery','queryParameters':",r+=v.toJSON(e),r="{"+(r+=",'bounds': {'rightTop':{'y':"+s.top+",'x':"+s.right+"},'leftBottom':{'y':"+s.bottom+",'x':"+s.left+"}}")+"}"}}class Ds extends Zt{constructor(t){super(t=t||{}),this.geometry=null,this.isNearest=null,this.returnContent=!0,v.extend(this,t),this.CLASS_NAME="SuperMap.QueryByDistanceParameters"}destroy(){super.destroy();var t=this;t.returnContent=null,t.distance=null,t.isNearest=null,t.geometry&&(t.geometry.destroy(),t.geometry=null)}}class Fs extends Ns{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByDistanceService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Ds){var e="",r=this.getQueryParameters(t),s=Tt.fromGeometry(t.geometry);return e+=t.isNearest?"'queryMode':'FindNearest','queryParameters':":"'queryMode':'DistanceQuery','queryParameters':",e+=v.toJSON(r),e="{"+(e+=",'geometry':"+v.toJSON(s)+",'distance':"+t.distance)+"}"}}}class Bs extends Zt{constructor(t){super(t=t||{}),this.returnContent=!0,v.extend(this,t),this.CLASS_NAME="SuperMap.QueryBySQLParameters"}destroy(){super.destroy();this.returnContent=null}}class Gs extends Ns{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryBySQLService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Bs){var e,r="";return e=this.getQueryParameters(t),r+="'queryMode':'SqlQuery','queryParameters':",r="{"+(r+=v.toJSON(e))+"}"}}}class js extends Zt{constructor(t){super(t=t||{}),this.returnContent=!0,this.geometry=null,this.spatialQueryMode=V.INTERSECT,v.extend(this,t),this.CLASS_NAME="SuperMap.QueryByGeometryParameters"}destroy(){super.destroy();this.returnContent=null,this.geometry=null,this.spatialQueryMode=null}}class Us extends Ns{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByGeometryService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof js){var e,r="",s=t.geometry,i=Tt.fromGeometry(s);return e=this.getQueryParameters(t),r+="'queryMode':'SpatialQuery','queryParameters':",r="{"+(r+=v.toJSON(e)+",'geometry':"+v.toJSON(i)+",'spatialQueryMode':"+v.toJSON(t.spatialQueryMode))+"}"}}}class Js{constructor(t,e){this.options=e||{},this.url=t}queryByBounds(t,e,r){var s=this;return new Rs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}queryByDistance(t,e,r){var s=this;return new Fs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:r}).processAsync(t,e)}queryBySQL(t,e,r){var s=this;return new Gs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:r}).processAsync(t,e)}queryByGeometry(t,e,r){var s=this;return new Us(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:r}).processAsync(t,e)}_processFormat(t){return t||U.GEOJSON}}class zs extends Wt{constructor(t,e){super(t,e),this.format=e&&e.format||U.GEOJSON,this.CLASS_NAME="SuperMap.SpatialAnalystBase"}destroy(){super.destroy(),this.format=null}transformResult(t,e){var r;if((t=v.transformResult(t))&&this.format===U.GEOJSON&&"function"==typeof this.toGeoJSONResult)if(v.isArray(t)){for(var s=0;s<t.length;s++)t[s]=this.toGeoJSONResult(t[s]);r=t}else r=this.toGeoJSONResult(t);return r||(r=t),{result:r,options:e}}toGeoJSONResult(t){if(!t)return null;t.result&&t.result.resultGeometry&&(t=t.result);var e=new Ot;if(t.recordsets)for(var r=0,s=t.recordsets,i=s.length;r<i;r++)s[r].features&&(s[r].features=e.toGeoJSON(s[r].features));else t.recordset&&t.recordset.features&&(t.recordset.features=e.toGeoJSON(t.recordset.features));return t.resultGeometry&&(t.resultGeometry=e.toGeoJSON(t.resultGeometry)),t.regions&&(t.regions=e.toGeoJSON(t.regions)),t}}class qs{constructor(t){this.dataset=null,this.targetDatasourceName=null,this.totalGridName=null,this.diffuseDatasetGridName=null,this.durationDatasetGridName=null,this.directDatasetGridName=null,this.latitude=null,this.timeMode="MULTIDAYS",this.dayStart=null,this.dayEnd=null,this.hourStart=null,this.hourEnd=null,this.transmittance=null,this.hourInterval=null,this.dayInterval=null,this.deleteExistResultDataset=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.AreaSolarRadiationParameters"}destroy(){var t=this;t.dataset=null,t.zFactor=1,t.averageCurvatureName=null,t.profileCurvatureName=null,t.planCurvatureName=null,t.deleteExistResultDataset=!0}static toObject(t,e){var r={};for(var s in t){if("dataset"!==s)"latitude"===s||"timeMode"===s||"dayStart"===s||("dayEnd"===s||"hourStart"===s||"hourEnd"===s)||("transmittance"===s||"hourInterval"===s||"dayInterval"===s)?r[s]=t[s]:e[s]=t[s]}e.parameter=r}}class Vs extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.AreaSolarRadiationService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof qs){var r=this,s={};t instanceof qs&&(r.url=v.urlPathAppend(r.url,`datasets/${t.dataset}/solarradiation`)),r.url=v.urlAppend(r.url,"returnContent=true"),qs.toObject(t,s);var i=v.toJSON(s);return r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}}class Hs{constructor(t){this.exp=null,this.value=100,v.extend(this,t),this.CLASS_NAME="SuperMap.BufferDistance"}destroy(){this.exp=null,this.value=null}}class Ws{constructor(t){this.endType=nt.FLAT,this.leftDistance=new Hs,this.rightDistance=new Hs,this.semicircleLineSegment=4,this.radiusUnit=Q.METER,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.BufferSetting"}destroy(){let t=this;t.endType=null,t.leftDistance&&(t.leftDistance.destroy(),t.leftDistance=null),t.rightDistance&&(t.rightDistance.destroy(),t.rightDistance=null),t.semicircleLineSegment=null,t.radiusUnit=null}}class Qs{constructor(t){this.bufferSetting=new Ws,v.extend(this,t),this.CLASS_NAME="SuperMap.BufferAnalystParameters"}destroy(){this.bufferSetting&&(this.bufferSetting.destroy(),this.bufferSetting=null)}}class Ys{constructor(t){this.expectCount=1e3,this.dataset=null,this.dataReturnMode=ut.RECORDSET_ONLY,this.deleteExistResultDataset=!0,v.extend(this,t),this.CLASS_NAME="SuperMap.DataReturnOption"}destroy(){this.expectCount=null,this.dataset=null,this.dataReturnMode=null,this.deleteExistResultDataset=null}}class Xs extends Qs{constructor(t){super(t),this.dataset=null,this.filterQueryParameter=new de,this.resultSetting=new Ys,this.isAttributeRetained=!0,this.isUnion=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.DatasetBufferAnalystParameters"}destroy(){super.destroy();var t=this;t.dataset=null,t.filterQueryParameter&&(t.filterQueryParameter.destroy(),t.filterQueryParameter=null),t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.isAttributeRetained=null,t.isUnion=null}static toObject(t,e){for(var r in t)if("bufferSetting"===r)t.bufferSetting.radiusUnit=t.bufferSetting.radiusUnit.toUpperCase(),e.bufferAnalystParameter=t.bufferSetting;else if("resultSetting"===r)e.dataReturnOption=t.resultSetting;else{if("dataset"===r)continue;e[r]=t[r]}}}class Zs extends Qs{constructor(t){super(t),this.sourceGeometry=null,this.sourceGeometrySRID=null,t&&v.extend(this,t),this.CLASS_NAME=" SuperMap.GeometryBufferAnalystParameters"}destroy(){super.destroy();this.sourceGeometry&&(this.sourceGeometry.destroy(),this.sourceGeometry=null)}static toObject(t,e){for(var r in t)if("bufferSetting"===r){var s={};for(var i in t.bufferSetting)s[i]=t.bufferSetting[i];e.analystParameter=s}else"sourceGeometry"===r?e.sourceGeometry=Tt.fromGeometry(t.sourceGeometry):e[r]=t[r]}}class Ks extends zs{constructor(t,e){super(t,e),this.mode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.BufferAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},s=this;t instanceof Xs?(s.mode="datasets",s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/buffer"),Xs.toObject(t,r)):t instanceof Zs&&(s.mode="geometry",s.url=v.urlPathAppend(s.url,"geometry/buffer"),Zs.toObject(t,r));var i=v.toJSON(r);return this.returnContent=!0,s.request({method:"POST",data:i,scope:s,success:e,failure:e})}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}}class $s{constructor(t){this.dataset=null,this.bounds=null,this.fieldName=null,this.resultGridDatasetResolution=null,this.searchRadius=null,this.targetDatasource=null,this.resultGridName=null,this.deleteExistResultDataset=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.DensityKernelAnalystParameters"}destroy(){var t=this;t.dataset=null,t.bounds=null,t.fieldName=null,t.resultGridDatasetResolution=null,t.searchRadius=null,t.targetDatasource=null,t.resultGridName=null,t.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class ti extends zs{constructor(t,e){super(t,e),this.mode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.DensityAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r=this,s=new Object;t instanceof $s&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/densityanalyst/kernel"),r.mode="kernel"),$s.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class ei{constructor(t){this.routeTable=null,this.routeIDField=null,this.attributeFilter=null,this.eventTable=null,this.eventRouteIDField=null,this.measureField=null,this.measureStartField=null,this.measureEndField=null,this.measureOffsetField=null,this.errorInfoField=null,this.retainedFields=null,this.dataReturnOption=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GenerateSpatialDataParameters"}destroy(){var t=this;t.routeTable&&(t.routeTable=null),t.routeIDField=null,t.attributeFilter=null,t.eventTable=null,t.eventRouteIDField=null,t.measureField=null,t.measureStartField=null,t.measureEndField=null,t.measureOffsetField=null,t.errorInfoField=null,t.dataReturnOption&&(t.dataReturnOption.destroy(),t.dataReturnOption=null)}}class ri extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GenerateSpatialDataService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ei){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="datasets/"+t.routeTable+"/linearreferencing/generatespatialdata";return this.url=v.urlPathAppend(this.url,e),this.url=v.urlAppend(this.url,"returnContent=true"),v.toJSON(t)}}class si{constructor(t){this.dataset=null,this.sourceFilter=null,this.referenceFilter=null,this.spatialRelationType=null,this.isBorderInside=null,this.returnFeature=null,this.returnGeoRelatedOnly=null,this.startRecord=0,this.expectCount=500,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GeoRelationAnalystParameters"}destroy(){var t=this;t.sourceFilter&&t.sourceFilter.destroy(),t.sourceFilter=null,t.referenceFilter&&t.referenceFilter.destroy(),t.referenceFilter=null,t.dataset=null,t.spatialRelationType=null,t.isBorderInside=null,t.returnFeature=null,t.returnGeoRelatedOnly=null,t.startRecord=null,t.expectCount=null}}class ii extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GeoRelationAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof si){var r=this;r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/georelation");var s=v.toJSON(t);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}}class ni{constructor(t){t&&(this.bounds=null,this.searchRadius=0,this.zValueFieldName=null,this.zValueScale=1,this.resolution=null,this.filterQueryParameter=null,this.outputDatasetName=null,this.outputDatasourceName=null,this.pixelFormat=null,this.dataset=null,this.inputPoints=null,this.InterpolationAnalystType="dataset",this.clipParam=null,v.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationAnalystParameters")}destroy(){var t=this;t.bounds=null,t.searchRadius=null,t.zValueFieldName=null,t.zValueScale=null,t.resolution=null,t.filterQueryParameter=null,t.outputDatasetName=null,t.pixelFormat=null}static toObject(t,e){for(var r in t)if("inputPoints"===r&&"geometry"===t.InterpolationAnalystType){for(var s=[],i=0;i<t.inputPoints.length;i++){var n=t.inputPoints[i],a={x:n.x,y:n.y,z:n.tag};s.push(a)}e[r]=s}else e[r]=t[r]}}class ai extends ni{constructor(t){super(t),this.smooth=.1,this.tension=40,this.searchMode=null,this.expectedCount=12,this.maxPointCountForInterpolation=200,this.maxPointCountInNode=50,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationRBFAnalystParameters"}destroy(){super.destroy();var t=this;t.smooth=null,t.tension=null,t.searchMode=null,t.expectedCount=null,t.maxPointCountForInterpolation=null,t.maxPointCountInNode=null}static toObject(t,e){for(var r in t)e[r]=t[r]}}class oi extends ni{constructor(t){super(t),t&&v.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationDensityAnalystParameters"}destroy(){super.destroy()}}class li extends ni{constructor(t){super(t),this.power=2,this.searchMode=null,this.expectedCount=12,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationIDWAnalystParameters"}destroy(){super.destroy();this.power=null,this.searchMode=null,this.expectedCount=null}}class hi{constructor(t){t&&(this.clipRegion=null,this.createResultDataset=!1,this.resultDatasetName=null,this.resultDatasourceName=null,this.returnResultRegion=!0,v.extend(this,t),this.CLASS_NAME="SuperMap.ThiessenAnalystParameters")}destroy(){var t=this;t.clipRegion&&(t.clipRegion.destroy(),t.clipRegion=null),t.createResultDataset=null,t.resultDatasetName=null,t.resultDatasourceName=null,t.returnResultRegion=null}}class ui extends ni{constructor(t){super(t),this.type=null,this.mean=null,this.angle=0,this.nugget=0,this.range=0,this.sill=0,this.variogramMode=ft.SPHERICAL,this.exponent=mt.EXP1,this.searchMode=null,this.expectedCount=12,this.maxPointCountForInterpolation=200,this.maxPointCountInNode=50,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationKrigingAnalystParameters"}destroy(){super.destroy();var t=this;t.type=null,t.mean=null,t.angle=null,t.nugget=null,t.range=null,t.sill=null,t.variogramMode=null,t.exponent=null,t.searchMode=null,t.expectedCount=null,t.maxPointCountForInterpolation=null,t.maxPointCountInNode=null}}class ci extends zs{constructor(t,e){super(t,e),this.mode=null,e&&v.extend(this,e)}destroy(){super.destroy(),this.mode=null,this.CLASS_NAME="SuperMap.InterpolationAnalystService"}processAsync(t,e){var r={},s=this;t instanceof oi?(s.mode="Density","geometry"===t.InterpolationAnalystType?s.url=v.urlPathAppend(s.url,"geometry/interpolation/density"):s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/interpolation/density")):t instanceof li?(s.mode="IDW","geometry"===t.InterpolationAnalystType?s.url=v.urlPathAppend(s.url,"geometry/interpolation/idw"):s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/interpolation/idw")):t instanceof ai?(s.mode="RBF","geometry"===t.InterpolationAnalystType?s.url=v.urlPathAppend(s.url,"geometry/interpolation/rbf"):s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/interpolation/rbf")):t instanceof ui&&(s.mode="Kriging","geometry"===t.InterpolationAnalystType?s.url=v.urlPathAppend(s.url,"geometry/interpolation/kriging"):s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/interpolation/kriging")),ni.toObject(t,r);var i=v.toJSON(r);return s.url=v.urlAppend(s.url,"returnContent=true"),s.request({method:"POST",data:i,scope:s,success:e,failure:e})}}class di{constructor(t){t&&(this.dataset=null,this.extractRegion=null,this.expression=null,this.isZip=!1,this.ignoreNoValue=!1,this.targetDatasource=null,this.resultGridName=null,this.deleteExistResultDataset=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.MathExpressionAnalysisParameters")}destroy(){var t=this;t.dataset=null,t.bounds=null,t.expression=null,t.isZip=!0,t.ignoreNoValue=!0,t.targetDatasource=null,t.resultGridName=null,t.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)if("dataset"!==r&&(e[r]=t[r]),"extractRegion"===r&&t[r]){for(var s=t[r].components[0].components,i={},n=[],a=s.length,o=0;o<a-1;o++){var l={};l.x=s[o].x,l.y=s[o].y,n.push(l)}i.points=n,i.type="REGION",e[r]=i}}}class pi extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.MathExpressionAnalysisService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof di&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/mathanalyst")),di.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class fi{constructor(t){this.operation=at.UNION,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.OverlayAnalystParameters"}destroy(){this.operation=null}}class mi extends fi{constructor(t){super(t),this.operateDataset=null,this.operateDatasetFields=[],this.operateDatasetFilter=new de,this.operateRegions=[],this.sourceDataset=null,this.sourceDatasetFields=[],this.sourceDatasetFilter=new de,this.tolerance=0,this.resultSetting=new Ys,v.extend(this,t),this.CLASS_NAME="SuperMap.DatasetOverlayAnalystParameters"}destroy(){super.destroy();var t=this;if(t.operateDataset=null,t.operateDatasetFields=null,t.operateDatasetFilter&&(t.operateDatasetFilter.destroy(),t.operateDatasetFilter=null),t.operateRegions){for(var e=0,r=t.operateRegions,s=r.length;e<s;e++)r[e].destroy();t.operateRegions=null}t.sourceDataset=null,t.sourceDatasetFields=null,t.sourceDatasetFilter&&(t.sourceDatasetFilter.destroy(),t.sourceDatasetFilter=null),t.tolerance=null,t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null)}static toObject(t,e){for(var r in t)if("sourceDataset"!==r)if("operateRegions"===r){e.operateRegions=[];var s=t.operateRegions;for(var i in s)s.hasOwnProperty(i)&&(e.operateRegions[i]=Tt.fromGeometry(s[i]))}else"resultSetting"===r?e.dataReturnOption=t.resultSetting:e[r]=t[r]}}class yi extends fi{constructor(t){super(t),t&&t.operateGeometry&&(this.operateGeometry=t.operateGeometry),t&&t.sourceGeometry&&(this.sourceGeometry=t.sourceGeometry),t&&t.operateGeometries&&(this.operateGeometries=t.operateGeometries),t&&t.sourceGeometries&&(this.sourceGeometries=t.sourceGeometries),t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GeometryOverlayAnalystParameters"}destroy(){super.destroy();var t=this;t.sourceGeometry&&(t.sourceGeometry.destroy(),t.sourceGeometry=null),t.sourceGeometries&&(t.sourceGeometries.destroy(),t.sourceGeometries=null),t.sourceGeometry&&(t.sourceGeometry.destroy(),t.sourceGeometry=null),t.operateGeometries&&(t.operateGeometries.destroy(),t.operateGeometries=null)}static toObject(t,e){for(var r in t)if("sourceGeometry"===r)e.sourceGeometry=Tt.fromGeometry(t.sourceGeometry);else if("sourceGeometries"===r){for(var s=[],i=0;i<t.sourceGeometries.length;i++)s.push(Tt.fromGeometry(t.sourceGeometries[i]));e.sourceGeometries=s}else if("operateGeometry"===r)e.operateGeometry=Tt.fromGeometry(t.operateGeometry);else if("operateGeometries"===r){for(var n=[],a=0;a<t.operateGeometries.length;a++)n.push(Tt.fromGeometry(t.operateGeometries[a]));e.operateGeometries=n}else e[r]=t[r]}}class gi extends zs{constructor(t,e){super(t,e),this.mode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.OverlayAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},s=this;t instanceof mi?(s.mode="datasets",s.url=v.urlPathAppend(s.url,"datasets/"+t.sourceDataset+"/overlay"),mi.toObject(t,r)):t instanceof yi&&(s.mode="geometry",t.operateGeometries&&t.sourceGeometries?(s.url=v.urlPathAppend(s.url,"geometry/overlay/batch"),s.url=v.urlAppend(s.url,"ignoreAnalystParam=true")):s.url=v.urlPathAppend(s.url,"geometry/overlay"),yi.toObject(t,r)),this.returnContent=!0;var i=v.toJSON(r);return s.request({method:"POST",data:i,scope:s,success:e,failure:e})}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}}class vi{constructor(t){if(!t)return this;this.sourceRoute=null,this.point=null,this.tolerance=null,this.isIgnoreGap=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.RouteCalculateMeasureParameters"}destroy(){var t=this;t.sourceRoute=null,t.point=null,t.tolerance&&(t.tolerance=null),t.isIgnoreGap&&(t.isIgnoreGap=!1)}}class bi extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.RouteCalculateMeasureService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof vi){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){return this.url=v.urlPathAppend(this.url,"geometry/calculatemeasure"),this.url=v.urlAppend(this.url,"returnContent=true"),v.toJSON(t)}}class Si{constructor(t){if(!t)return this;this.sourceRoute=null,this.dataset=null,this.routeIDField=null,this.routeID=null,this.type=null,this.measure=null,this.offset=0,this.isIgnoreGap=!1,this.startMeasure=null,this.endMeasure=null;var e=t.sourceRoute,r={};if(e&&e instanceof d&&e.components){r.type=e.type,r.parts=e.parts;for(var s=[],i=0,n=e.components.length;i<n;i++)s=s.concat(e.components[i].components);r.points=s,t.sourceRoute=r}v.extend(this,t),this.CLASS_NAME="SuperMap.RouteLocatorParameters"}destroy(){var t=this;t.sourceRoute=null,t.type=null,t.measure=null,t.offset=0,t.isIgnoreGap=!1,t.startMeasure=null,t.endMeasure=null,t.dataset=null,t.routeID=null,t.routeIDField=null}}class _i extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.RouteLocatorService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Si){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="geometry/routelocator";return t.dataset&&(e="datasets/"+t.dataset+"/linearreferencing/routelocator",t.sourceRoute=null),this.url=v.urlPathAppend(this.url,e),this.url=v.urlAppend(this.url,"returnContent=true"),v.toJSON(t)}}class xi{constructor(t){this.clipRegion=null,this.datumValue=0,this.expectedZValues=null,this.interval=0,this.resampleTolerance=0,this.smoothMethod=lt.BSPLINE,this.smoothness=0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.SurfaceAnalystParametersSetting"}destroy(){var t=this;t.clipRegion&&(t.clipRegion.destroy(),t.clipRegion=null),t.datumValue=null,t.expectedZValues=null,t.interval=null,t.resampleTolerance=null,t.smoothMethod=null,t.smoothness=null}toJSON(){let t="'datumValue':"+v.toJSON(this.datumValue);if(t+=",'interval':"+v.toJSON(this.interval),t+=",'resampleTolerance':"+v.toJSON(this.resampleTolerance),t+=",'smoothMethod':"+v.toJSON(this.smoothMethod),t+=",'smoothness':"+v.toJSON(this.smoothness),null!=this.expectedZValues&&(t+=",'expectedZValues':"+v.toJSON(this.expectedZValues)),null!=this.clipRegion){var e=this.clipRegion;this.clipRegion instanceof d&&this.clipRegion.components&&(e=Tt.fromGeometry(this.clipRegion)),t+=",'clipRegion':"+v.toJSON(e)}return"{"+t+"}"}}class wi{constructor(t){this.resolution=0,this.extractParameter=new xi,this.resultSetting=new Ys,this.surfaceAnalystMethod=ht.ISOLINE,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.SurfaceAnalystParameters"}destroy(){var t=this;t.resolution=null,t.extractParameter&&(t.extractParameter.destroy(),t.extractParameter=null),t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.surfaceAnalystMethod=null}}class Ai extends wi{constructor(t){super(t),this.dataset=null,this.filterQueryParameter=new de,this.zValueFieldName=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.DatasetSurfaceAnalystParameters"}destroy(){super.destroy();var t=this;t.dataset=null,t.filterQueryParameter&&(t.filterQueryParameter.destroy(),t.filterQueryParameter=null),t.zValueFieldName=null}static toObject(t,e){for(var r in t)if("filterQueryParameter"===r&&(e.filterQueryParameter=t.filterQueryParameter),"extractParameter"===r)t.extractParameter.clipRegion instanceof d&&t.extractParameter.clipRegion.components&&(t.extractParameter.clipRegion=Tt.fromGeometry(t.extractParameter.clipRegion)),e.extractParameter=t.extractParameter;else{if("dataset"===r)continue;if("surfaceAnalystMethod"===r)continue;e[r]=t[r]}}}class Mi extends wi{constructor(t){super(t),this.points=null,this.zValues=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GeometrySurfaceAnalystParameters"}destroy(){super.destroy();if(this.points){for(var t=0,e=this.points,r=e.length;t<r;t++)e[t].destroy();this.points=null}this.zValues=null}}class Ci extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.SurfaceAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof wi){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="",r={};if(t instanceof Ai)this.url=v.urlPathAppend(this.url,"datasets/"+t.dataset+"/"+t.surfaceAnalystMethod.toLowerCase()),Ai.toObject(t,r),e=v.toJSON(r);else{if(!(t instanceof Mi))return;this.url=v.urlPathAppend(this.url,"geometry/"+t.surfaceAnalystMethod.toLowerCase()),e=v.toJSON(t)}return this.returnContent=!0,e}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}}class Ei{constructor(t){t&&(this.dataset=null,this.zFactor=1,this.averageCurvatureName=null,this.profileCurvatureName="",this.planCurvatureName="",this.deleteExistResultDataset=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.TerrainCurvatureCalculationParameters")}destroy(){var t=this;t.dataset=null,t.zFactor=1,t.averageCurvatureName=null,t.profileCurvatureName=null,t.planCurvatureName=null,t.deleteExistResultDataset=!0}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class Ti extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainCurvatureCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof Ei&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/curvature")),Ei.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class Oi{constructor(t){t&&(this.dataset=null,this.cutFillType="GRID",this.afterCutFillDataset=null,this.resultDataset=null,this.buildPyramid=null,this.deleteExistResultDataset=null,this.bufferRadius=null,this.isRoundHead=null,this.line3D=null,this.region=null,this.region3D=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TerrainCutFillCalculationParameters")}destroy(){var t=this;t.cutFillType=null,t.afterCutFillDataset=null,t.resultDataset=null,t.buildPyramid=null,t.deleteExistResultDataset=null,t.bufferRadius=null,t.isRoundHead=null,t.line3D=null,t.region=null,t.region3D=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class Pi extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainCutFillCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof Oi&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/cutfill")),Oi.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class Li{constructor(t){t&&(this.dataset=null,this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TerrainAspectCalculationParameters")}destroy(){this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class Ii extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainAspectCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof Li&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/aspect")),Li.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class Ni{constructor(t){t&&(this.dataset=null,this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null,this.zFactor=null,this.slopeType=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TerrainSlopeCalculationParameters")}destroy(){var t=this;t.terrainAnalystSetting=null,t.resultDatasetName=null,t.deleteExistResultDataset=null,t.zFactor=null,t.slopeType=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class ki extends zs{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainSlopeCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof Ni&&(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/slope")),Ni.toObject(t,s);var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class Ri extends hi{constructor(t){super(t),this.filterQueryParameter=null,this.dataset=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.DatasetThiessenAnalystParameters"}destroy(){super.destroy();this.filterQueryParameter&&(this.filterQueryParameter.destroy(),this.filterQueryParameter=null)}static toObject(t,e){for(var r in t)"clipRegion"===r?e.clipRegion=Tt.fromGeometry(t.clipRegion):e[r]=t[r]}}class Di extends hi{constructor(t){super(t),this.points=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GeometryThiessenAnalystParameters"}destroy(){super.destroy();if(this.points){for(var t=this.points.length-1;t>=0;t--)this.points[t].destroy();this.points=null}}static toObject(t,e){for(var r in t)"clipRegion"===r?e.clipRegion=Tt.fromGeometry(t.clipRegion):e[r]=t[r]}}class Fi extends zs{constructor(t,e){super(t,e),this.mode=null,e&&v.extend(this,e),this.CLASS_NAME="SuperMap.ThiessenAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},s=this;t instanceof Ri?(s.mode="datasets",s.url=v.urlPathAppend(s.url,"datasets/"+t.dataset+"/thiessenpolygon"),Ri.toObject(t,r)):t instanceof Di&&(s.mode="geometry",s.url=v.urlPathAppend(s.url,"geometry/thiessenpolygon"),Di.toObject(t,r));var i=v.toJSON(r);return this.returnContent=!0,s.request({method:"POST",data:i,scope:s,success:e,failure:e})}dataFormat(){return[U.GEOJSON,U.ISERVER,U.FGB]}}class Bi{constructor(t){this.referenceDatasetName=null,this.referenceFilterQueryParameter=null,this.createResultDataset=null,this.resultDatasetName=null,this.resultDatasourceName=null,this.minDistance=null,this.maxDistance=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.MinDistanceAnalystParameters"}destroy(){var t=this;t.referenceDatasetName=null,t.dataset=null,t.referenceFilterQueryParameter=null,t.createResultDataset=null,t.resultDatasetName=null,t.resultDatasourceName=null,t.minDistance=null,t.maxDistance=null}}class Gi extends Bi{constructor(t){super(t),this.dataset=null,this.inputFilterQueryParameter=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.DatasetMinDistanceAnalystParameters"}destroy(){super.destroy();this.dataset=null,this.inputFilterQueryParameter=null}}class ji extends Bi{constructor(t){super(t),this.inputGeometries=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.GeometryMinDistanceAnalystParameters"}destroy(){super.destroy();this.inputGeometries=null}static toObject(t,e){for(var r in t)if("inputGeometries"===r&&t.inputGeometries){for(var s=[],i=0;i<t.inputGeometries.length;i++)s.push(Tt.fromGeometry(t.inputGeometries[i]));e.inputGeometries=s}else e[r]=t[r]}}class Ui extends zs{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.MinDistanceAnalystService"}destroy(){super.destroy()}processAsync(t,e){var r=this,s={};t instanceof Gi?(r.url=v.urlPathAppend(r.url,"datasets/"+t.dataset+"/mindistance"),s=t):t instanceof ji&&(r.url=v.urlPathAppend(r.url,"geometry/mindistance"),ji.toObject(t,s));var i=v.toJSON(s);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class Ji extends zs{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.ConvexHullAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r=this;r.url=v.urlPathAppend(r.url,"geometry/3d/convexhull");var s=v.toJSON(t);return r.url=v.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class zi extends zs{constructor(t,e){super(t,e),e&&v.extend(this,e),this.CLASS_NAME="SuperMap.GeometryBatchAnalystService"}processAsync(t,e){var r=this;r.url=v.urlPathAppend(r.url,"geometry/batchanalyst"),r.url=v.urlAppend(r.url,"returnContent=true&ignoreAnalystParam=true");var s=r._processParams(t),i=v.toJSON(s);return r.request({method:"POST",data:i,scope:r,success:e,failure:e})}_processParams(t){var e=this;if(v.isArray(t)){var r=[];return t.map(function(t){return r.push(e._toJSON(t)),t}),r}}_toJSON(t){var e={};if("buffer"===t.analystName)e.analystName="buffer",e.param={},Zs.toObject(t.param,e.param);else if("overlay"===t.analystName)e.analystName="overlay",e.param={},yi.toObject(t.param,e.param);else if("interpolationDensity"===t.analystName)e.analystName="interpolationDensity",e.param={},ni.toObject(t.param,e.param);else if("interpolationidw"===t.analystName)e.analystName="interpolationidw",e.param={},ni.toObject(t.param,e.param);else if("interpolationRBF"===t.analystName)e.analystName="interpolationRBF",e.param={},ni.toObject(t.param,e.param);else if("interpolationKriging"===t.analystName)e.analystName="interpolationKriging",e.param={},ni.toObject(t.param,e.param);else{if("thiessenpolygon"!==t.analystName)return t;e.analystName="thiessenpolygon",e.param={},Di.toObject(t.param,e.param)}return e}destroy(){super.destroy()}}class qi{constructor(t,e){this.url=t,this.options=e||{}}getAreaSolarRadiationResult(t,e,r){var s=this;return new Vs(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}bufferAnalysis(t,e,r){var s=this;return new Ks(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}densityAnalysis(t,e,r){var s=this;return new ti(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}generateSpatialData(t,e,r){var s=this;return new ri(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}geoRelationAnalysis(t,e,r){var s=this;return new ii(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}interpolationAnalysis(t,e,r){var s=this;return new ci(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}mathExpressionAnalysis(t,e,r){var s=this;return new pi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}overlayAnalysis(t,e,r){var s=this;return new gi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}routeCalculateMeasure(t,e,r){var s=this;return new bi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}routeLocate(t,e,r){var s=this;return new _i(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}surfaceAnalysis(t,e,r){var s=this;return new Ci(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}terrainCurvatureCalculate(t,e,r){var s=this;return new Ti(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}terrainCutFillCalculate(t,e,r){var s=this;return new Pi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}terrainAspectCalculate(t,e,r){var s=this;return new Ii(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}terrainSlopeCalculate(t,e,r){var s=this;return new ki(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}thiessenAnalysis(t,e,r){var s=this;return new Fi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}minDistanceAnalysis(t,e,r){var s=this;return new Ui(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}convexHullAnalysis(t,e,r){var s=this;return new Ji(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:s._processFormat(r)}).processAsync(t,e)}geometrybatchAnalysis(t,e,r){for(var s=new zi(this.url,{format:this._processFormat(r)}),i=[],n=0;n<t.length;n++){var a=t[n];i.push({analystName:a.analystName,param:a.param})}return s.processAsync(i,e)}_processFormat(t){return t||U.GEOJSON}}class Vi{constructor(t){this.datasetNames=null,this.dataSourceNames=null,this.joinItems=null,this.themes=null,this.displayFilters=null,this.displayOrderBys=null,this.fieldValuesDisplayFilter=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeParameters"}destroy(){var t=this;if(t.datasetNames=null,t.dataSourceNames=null,t.joinItems){for(let e=0,r=t.joinItems,s=r.length;e<s;e++)r[e].destroy();t.joinItems=null}if(t.themes){for(let e=0,r=t.themes,s=r.length;e<s;e++)r[e].destroy();t.themes=null}}}class Hi extends Wt{constructor(t,e){super(t,e),e&&v.extend(this,e),this.url=v.urlPathAppend(this.url,"tempLayersSet"),this.CLASS_NAME="SuperMap.ThemeService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Vi){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e,r="",s=null,i=null,n=null;r+="[{'type': 'UGC','subLayers': {'layers': [";for(var a=0;a<t.themes.length;a++){s=t.themes[a];var o=v.toJSON(s);if(r+="{'theme': "+(o=o.slice(0,-1))+"},'type': 'UGC','ugcLayerType': 'THEME',",(i=t.displayFilters)&&i.length>0&&(1===i.length?r+="'displayFilter':\""+i[0]+'",':r+="'displayFilter':\""+i[a]+'",'),(n=t.displayOrderBy)&&n.length>0&&(1===n.length?r+="'displayOrderBy':'"+n[0]+"',":r+="'displayOrderBy':'"+n[a]+"',"),(e=t.fieldValuesDisplayFilter)&&(r+="'fieldValuesDisplayFilter':"+v.toJSON(e)+","),t.joinItems&&t.joinItems.length>0&&t.joinItems[a]&&(r+="'joinItems':["+v.toJSON(t.joinItems[a])+"],"),t.datasetNames&&t.dataSourceNames){var l=t.datasetNames[a]?a:t.datasetNames.length-1,h=t.dataSourceNames[a]?a:t.dataSourceNames.length-1;r+="'datasetInfo': {'name': '"+t.datasetNames[l]+"','dataSourceName': '"+t.dataSourceNames[h]+"'}},"}else r+="},"}t.themes&&t.themes.length>0&&(r=r.substring(0,r.length-1)),r+="]},";var u=this.url.split("/");return r+="'name': '"+u[u.length-2]+"'}]"}}class Wi{constructor(t){t=t||{},this.keyWord=null,this.returnPosition=!1,v.extend(this,t),this.CLASS_NAME="SuperMap.StopQueryParameters"}destroy(){v.reset(this)}}class Qi extends Wt{constructor(t,e){super(t,e),e=e||{},v.extend(this,e),this.CLASS_NAME="SuperMap.StopQueryService"}destroy(){super.destroy(),v.reset(this)}processAsync(t,e){if(t instanceof Wi){return this.url=v.urlPathAppend(this.url,"stops/keyword/"+t.keyWord),this.request({method:"GET",params:{returnPosition:t.returnPosition},scope:this,success:e,failure:e})}}}class Yi{constructor(t){t=t||{},this.transferLines=null,this.points=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TransferPathParameters"}destroy(){v.reset(this)}static toJson(t){if(t)return v.toJSON(t)}}class Xi extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TransferPathService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Yi){var r;return this.url=v.urlPathAppend(this.url,"path"),r={points:v.toJSON(t.points),transferLines:v.toJSON(t.transferLines)},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class Zi{constructor(t){t=t||{},this.solutionCount=6,this.transferPreference=pt.NONE,this.transferTactic=dt.LESS_TIME,this.walkingRatio=null,this.points=!1,this.evadeLines=null,this.evadeStops=null,this.priorLines=null,this.priorStops=null,this.travelTime=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TransferSolutionParameters"}destroy(){v.reset(this)}static toJson(t){if(t)return v.toJSON(t)}}class Ki extends Wt{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TransferSolutionService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Zi){var r;return this.url=v.urlPathAppend(this.url,"solutions"),r={points:v.toJSON(t.points),walkingRatio:t.walkingRatio,transferTactic:t.transferTactic,solutionCount:t.solutionCount,transferPreference:t.transferPreference},t.evadeLines&&(r.evadeLines=v.toJSON(t.evadeLines)),t.evadeStops&&(r.evadeStops=v.toJSON(t.evadeStops)),t.priorLines&&(r.priorLines=v.toJSON(t.priorLines)),t.priorStops&&(r.priorStops=v.toJSON(t.priorStops)),t.travelTime&&(r.travelTime=t.travelTime),this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class $i{constructor(t,e){this.url=t,this.options=e||{}}queryStop(t,e){var r=this;return new Qi(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}analysisTransferPath(t,e){var r=this;return new Xi(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}analysisTransferSolution(t,e){var r=this;return new Ki(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}class tn extends Wt{constructor(t,e){super(t,e),e&&v.extend(this,e),this.templates=[],this.CLASS_NAME="SuperMap.WebPrintingService",this.url}destroy(){super.destroy()}async createWebPrintingJob(t,e){if(t)return await this._processParams(t),this.processAsync("jobs","POST",e,t)}getPrintingJob(t,e){this.rollingProcess(this._processUrl(`jobs/${t}`),e)}getPrintingJobResult(t,e){return this.processAsync(`jobs/${t}/result`,"GET",e)}getLayoutTemplates(t){return this.processAsync("layouts","GET",t)}rollingProcess(t,e){var r=this;this.id&&clearInterval(this.id),this.id=setInterval(function(){r.request({url:t,method:"GET",scope:r,success:e,failure:e})},1e3)}processAsync(t,e,r,s){let i={url:this._processUrl(t),method:e,scope:this,success:r,failure:r};return s&&(i.data=v.toJSON(s)),this.request(i)}transformResult(t,e){return"FINISHED"===(t=v.transformResult(t)).status||"ERROR"===t.status?clearInterval(this.id):"RUNNING"===t.status&&(e.success=!1),{result:t,options:e}}_processUrl(t){return t?v.urlPathAppend(this.url,t):this.url}async _processParams(t){if(!t.layoutOptions)return;const{legendOptions:e,templateName:r}=t.layoutOptions;if(e&&(!t.layoutOptions.legendOptions.title&&(t.layoutOptions.legendOptions.title=""),t.layoutOptions.legendOptions.picAsBase64=t.layoutOptions.legendOptions.picAsBase64&&t.layoutOptions.legendOptions.picAsBase64.replace(/^data:.+;base64,/,""),t.layoutOptions.legendOptions.customItems&&t.layoutOptions.legendOptions.customItems.hasOwnProperty("picAsBase64")&&(t.layoutOptions.legendOptions.customItems.picAsBase64=t.layoutOptions.legendOptions.customItems.picAsBase64.replace(/^data:.+;base64,/,""))),!this.templates.length){const t=await this.getLayoutTemplates();this.templates=t.result}const s=this.templates.find(t=>t.templateName===r),{hasCopyright:i,hasSubtitle:n,hasAuthor:a,hasScaleBar:o,hasTitle:l,hasTime:h,hasSummaryText:u,hasLittleMap:c,hasNorthArrow:d,hasLegend:p}=s.layoutOptions,f=t.layoutOptions;l?void 0===f.title&&(t.layoutOptions.title=null):delete t.layoutOptions.title,n?void 0===f.subTitle&&(t.layoutOptions.subTitle=null):delete t.layoutOptions.subTitle,a?void 0===f.author&&(t.layoutOptions.author=null):delete t.layoutOptions.author,i?void 0===f.copyright&&(t.layoutOptions.copyright=null):delete t.layoutOptions.copyright,u?void 0===f.summaryText&&(t.layoutOptions.summaryText=null):delete t.layoutOptions.summaryText,h?void 0===f.time&&(t.layoutOptions.time=null):delete t.layoutOptions.time,c&&f.littleMapOptions||delete t.layoutOptions.littleMapOptions,o&&f.scaleBarOptions||delete t.layoutOptions.scaleBarOptions,d&&f.northArrowOptions||delete t.layoutOptions.northArrowOptions,p&&f.legendOptions||delete t.layoutOptions.legendOptions}}class en extends Wt{constructor(t,e){super(t,e),this.options=e||{},e&&v.extend(this,e),this.CLASS_NAME="SuperMap.ImageService"}destroy(){super.destroy()}getCollections(t){var e=v.convertPath("/collections"),r=v.urlPathAppend(this.url,e);return this._processAsync({url:r,mehtod:"GET",callback:t})}getCollectionByID(t,e){var r={collectionId:t},s=v.convertPath("/collections/{collectionId}",r),i=v.urlPathAppend(this.url,s);return this._processAsync({url:i,mehtod:"GET",callback:e})}search(t,e){var r={...t||{}},s=v.convertPath("/search"),i=v.urlPathAppend(this.url,s);return this._processAsync({url:i,method:"POST",data:r,callback:e})}_processAsync({url:t,method:e,callback:r,data:s}){return this.request({method:e||"GET",url:t,data:s,scope:this,success:r,failure:r})}}class rn extends Wt{constructor(t,e){super(t,e),this.options=e||{},e&&v.extend(this,e),this.CLASS_NAME="SuperMap.ImageCollectionService"}destroy(){super.destroy()}getLegend(t,e){var r={collectionId:this.options.collectionId};"function"==typeof t&&(e=t,t=null);var s=v.convertPath("/collections/{collectionId}/legend",r),i=v.urlPathAppend(this.url,s);return this._processAsync({url:i,method:"GET",params:t,callback:e})}getStatistics(t){var e={collectionId:this.options.collectionId},r=v.convertPath("/collections/{collectionId}/statistics",e),s=v.urlPathAppend(this.url,r);return this._processAsync({url:s,method:"GET",callback:t})}getTileInfo(t){var e={collectionId:this.options.collectionId},r=v.convertPath("/collections/{collectionId}/tileInfo",e),s=v.urlPathAppend(this.url,r);return this._processAsync({url:s,method:"GET",callback:t})}deleteItemByID(t,e){var r={collectionId:this.options.collectionId,featureId:t},s=v.convertPath("/collections/{collectionId}/items/{featureId}",r),i=v.urlPathAppend(this.url,s);return this._processAsync({url:i,method:"DELETE",callback:e})}getItemByID(t,e){var r={collectionId:this.options.collectionId,featureId:t},s=v.convertPath("/collections/{collectionId}/items/{featureId}",r),i=v.urlPathAppend(this.url,s);return this._processAsync({url:i,method:"GET",callback:e})}_processAsync({url:t,method:e,callback:r,params:s}){return this.request({method:e||"GET",url:t,params:s,scope:this,success:r,failure:r})}}class sn extends Wt{constructor(t,e){super(t,e),this.options=e||{},this.CLASS_NAME="SuperMap.KnowledgeGraphService"}destroy(){super.destroy()}query(t,e){const r=v.urlAppend(this.url+"/query.json",`cypherQuery=${encodeURI(t)}`);this.processAsync({url:r,method:"GET",callback:e})}getGraphMaps(t){const e=this.url+"/graphmaps.json";this.processAsync({url:e,method:"GET",callback:t})}getGraphMap(t,e){const r=this.url+`/graphmaps/${t}.json`;this.processAsync({url:r,method:"GET",callback:e})}async getGraphMapData(t){let e=[];const r=await this._getGraphMapData(t);if(!r)return;const s=r.dataContent.queries&&r.dataContent.queries.query||[];let i=[];i="string"==typeof s?[s]:s;const n=this._getGraphMapExpandQuery(r);n.length&&i.push(...n);for(let t=0;t<i.length;t++){const r=i[t],s=await this._queryDataBySql(r);e=e.concat([],s)}return{data:e,graphMap:r}}_getGraphMapExpandQuery(t){const e=[];return(t.dataContent.expand&&JSON.parse(t.dataContent.expand)||[]).forEach(t=>{e.push(`match p=(n)-[]-(m) where id(n)=${t} return p;`)}),e}processAsync({url:t,params:e,method:r,callback:s}){const i={method:r,url:t,scope:this,success:s,failure:s};return e&&(i.params=e),this.request(i)}_getGraphMapData(t){return new Promise((e,r)=>{this.getGraphMap(t,t=>{"processFailed"===t.type?r(t.error):""===t.result.data?r("æ æ°æ®"):e(t.result.graphMap)})})}_queryDataBySql(t){return new Promise((e,r)=>{this.query(t,t=>{"processFailed"===t.type?r(t.error):e(t.result)})})}}class nn extends Nt{constructor(t,e){super(t,e),this._knowledgeGraphService=new sn(t,e)}query(t,e){return this._knowledgeGraphService.query(t,e)}getGraphMaps(t){return this._knowledgeGraphService.getGraphMaps(t)}getGraphMap(t,e){return this._knowledgeGraphService.getGraphMap(t,e)}async getGraphMapData(t){return await this._knowledgeGraphService.getGraphMapData(t)}}var an=r(234),on=r.n(an);function ln(t,e){const r=(e=e||{}).styles&&e.styles.style,s=e.captionFields&&e.captionFields.captionField,i={nodes:[],edges:[]};return t.forEach(t=>{const e=t.path;if(e){const{nodes:t,edges:n}=function(t,e,r){const s={nodes:[],edges:[]};return t.forEach(t=>{if(un(t)){const r=dn(t,e);s.edges.push(r)}else{const i=cn(t,e,r);s.nodes.push(i)}}),s}(e,r,s);i.nodes.push(...t),i.edges.push(...n)}else if(un(t)){const e=dn(t,r);i.edges.push(e)}else{const e=cn(t,r,s);i.nodes.push(e)}}),{nodes:hn(i.nodes),edges:hn(i.edges,"edgeId")}}function hn(t,e="id"){return on()(t,e)}function un(t){return t.hasOwnProperty("start")&&t.hasOwnProperty("end")}function cn(t,e,r){const{id:s,properties:i,lables:n}=t,a=e?function(t,e){if(!e)return{};const{id:r,labels:s}=t,i=e.filter(t=>"entity"===t.type);for(let t=0;t<i.length;t++){const{color:e,textColor:n,font:a,size:o,entityTypes:l,entityIds:h}=i[t],u=JSON.parse(h||"[]"),c=JSON.parse(l||"[]");if(u.includes(r)||c.includes(s[0]))return{fillColor:e,fontSize:a.fontSize,fill:n,size:o,...fn(a.fontName),...pn(a.fontStyle)}}return{}}(t,e):{},o=function(t,e){const{id:r,labels:s,properties:i}=t;if(e){const t=e instanceof Array?e:[e];for(let e=0;e<t.length;e++){const{name:n,entityTypes:a,entityIds:o}=t[e],l=JSON.parse(o||"[]"),h=JSON.parse(a||"[]"),u=s&&s.join("&");if(l.includes(r)||h.includes(u))return i[n]}}return i[i._labelfieldname]}(t,r),l=a.fillColor||"",h={id:s+"",label:void 0===o?"":o+"",properties:i,lables:n};return a.size&&(h.size=a.size,delete a.size),a.fillColor&&(h.style={fill:l,stroke:l},delete a.fillColor),0!==Object.keys(a).length&&(h.labelCfg={style:a}),h}function dn(t,e){const{start:r,end:s,id:i,type:n,properties:a}=t,o=e?function(t,e){if(!e)return{};const{id:r,type:s}=t,i=e.filter(t=>"relationShip"===t.type);for(let t=0;t<i.length;t++){const{color:e,width:n,textColor:a,font:o,relationTypes:l,relationIds:h}=i[t],u=JSON.parse(h||"[]"),c=JSON.parse(l||"[]");if(u.includes(r)||c.includes(s))return{stroke:e,lineWidth:1.4*Number(n),fontSize:o.fontSize,fill:a,...fn(o.fontName),...pn(o.fontStyle)}}return{}}(t,e):{},l={source:r+"",target:s+"",edgeId:i+"",label:n,style:{},labelCfg:{},properties:a};return o.stroke&&(l.style.stroke=o.stroke,l.style.endArrow={path:"M 0,0 L 4,2 L 4,-2 Z",fill:o.stroke},delete o.stroke),o.lineWidth&&(l.style.lineWidth=o.lineWidth,delete o.lineWidth),l.labelCfg={style:o},l}function pn(t){return 1===t||"bold"===t?{fontWeight:"bold"}:2===t||"italic"===t?{fontStyle:"italic"}:"bolditalic"===t?{fontWeight:"bold",fontStyle:"italic"}:{}}function fn(t){if(!t)return{};const e=t.split(".");return{fontFamily:e[0],...pn(e[1])}}const mn=function(){try{return G6}catch(t){return{}}}();var yn=r.n(mn),gn=r(238),vn=r.n(gn),bn=r(858),Sn=r.n(bn);class _n{constructor(){this.config=null,this.graph=null,this.data=null,this.collpasedData={},this.importG6(),this.CLASS_NAME="SuperMap.G6Render"}importG6(){yn()||console.log("please import g6, egï¼https://gw.alipayobjects.com/os/lib/antv/g6/4.3.2/dist/g6.min.js")}initGraph(t){const e=new(yn().Graph)(t);return this.graph=e,t&&!1===t.highlightNode||this.highlightNode(e),t&&!1===t.highlightEdge||this.highlightEdge(e),!1===t.dragCanvas&&!1===t.dragNode||this.stopDefaultEventPropagation(),e}_getContextMenu(){return new(yn().Menu)({shouldBegin:t=>!!(t.target&&t.target.isCanvas&&t.target.isCanvas())||!!t.item,getContent:t=>{const{item:e}=t;if(t.target&&t.target.isCanvas&&t.target.isCanvas())return;if(!e)return;const r=e.getType(),s=e.getModel();return r&&s&&"node"===r?this.isCollpased(s.id)?"<ul>\n              <li id='expand'>å±å¼</li>\n            </ul>":"<ul>\n              <li id='collapse'>æå </li>\n            </ul>":void 0},handleMenuClick:(t,e)=>{switch(t.id.split("-")[0]){case"hide":this.hideItem(e);break;case"expand":this.expandNode(e);break;case"collapse":this.collapseNode(e);break;case"show":this.showItem(e)}},offsetX:26,offsetY:0,itemTypes:["node","edge","canvas"]})}_getGraphConfig(t){const e={speed:150,maxIteration:30,tick:Sn()(this.refreshPositions.bind(this),150)},r={type:"fruchterman",gravity:5},s={},i={type:"line",style:{endArrow:{path:"M 0,0 L 4,2 L 4,-2 Z",fill:"#e0e0e0"},lineWidth:.5},labelCfg:{autoRotate:!0,style:{fontSize:4,fill:"#333"}}},n={default:["drag-canvas","zoom-canvas","drag-node"]},a=this._getContextMenu(),o=[new(yn().ToolBar),a],l={lineWidth:3,stroke:"#b4d6ff"},h={stroke:"#b4d6ff",shadowColor:"#b4d6ff",shadowBlur:5,endArrow:{path:"M 0,0 L 4,2 L 4,-2 Z",fill:"#b4d6ff"}};if(!t)return this._setToolBarStyle(),((t="knowledgeGraph")=>{const a=document.querySelector(`#${t}`);return{container:t,width:a.scrollWidth,height:a.scrollHeight,plugins:o,modes:n,layout:{...r,...e},defaultNode:s,defaultEdge:i,nodeStateStyles:{hover:l},edgeStateStyles:{hover:h}}})();t.container=t.container||"knowledgeGraph";const u="string"==typeof t.container?document.querySelector(`#${t.container}`):t.container;return t.width=t.width||u.scrollWidth,t.height=t.height||u.scrollHeight,t.layout={...r,...t.layout||{},...!1!==t.animate?e:{}},t.defaultNode={...s,...t.defaultNode||{}},t.defaultEdge={...i,...t.defaultEdge||{}},t.modes={default:[!1!==t.dragCanvas&&"drag-canvas",!1!==t.zoomCanvas&&"zoom-canvas",!1!==t.dragNode&&"drag-node"]},t.nodeStateStyles={hover:{...l,...t.nodeHighlightStyle||{}}},t.edgeStateStyles={hover:{...h,...t.edgeHighlightStyle||{}}},!1!==t.showToolBar&&(t.plugins=[new(yn().ToolBar)],this._setToolBarStyle()),!1!==t.showContextMenu&&(t.plugins=[...t.plugins||[],a],this._setToolBarStyle()),t}changeSize(t,e){return this.graph.changeSize(t,e)}autoResize(){const t=this.getContainer();window.addEventListener("resize",()=>{const e=t.scrollWidth,r=t.scrollHeight;this.graph.changeSize(e,r),this.graph.refresh()})}zoom(t,e,r,s){this.graph.zoom(t,e,r,s)}zoomTo(t,e,r,s){this.graph.zoomTo(t,e,r,s)}fitView(t,e,r,s){this.graph.fitView(t,e,r,s)}fitCenter(t,e){this.graph.fitCenter(t,e)}getGraphCenterPoint(){return this.graph.getGraphCenterPoint()}getViewPortCenterPoint(){return this.graph.getViewPortCenterPoint()}getZoom(){return this.graph.getZoom()}getMinZoom(){return this.graph.getMinZoom()}setMinZoom(t){this.graph.setMinZoom(t)}getMaxZoom(){return this.graph.getMaxZoom()}setMaxZoom(t){this.graph.setMaxZoom(t)}getWidth(){return this.graph.getWidth()}getHeight(){return this.graph.getHeight()}setCenter(t){var e=this.graph.getWidth()/2,r=this.graph.getHeight()/2,s=this.graph.getCanvasByPoint(t.x,t.y);this.graph.translate(e-s.x,r-s.y)}_setToolBarStyle(){vn()("\n      .g6-component-toolbar li[code='redo'],\n      .g6-component-toolbar li[code='undo'],\n      .g6-component-toolbar li[code='realZoom'] {\n        display: none;\n      }\n      .g6-component-contextmenu {\n        position: absolute;\n        z-index: 2;\n        list-style-type: none;\n        border-radius: 6px;\n        font-size: 14px;\n        width: fit-content;\n        transition: opacity .2s;\n        text-align: center;\n        box-shadow: 0 5px 18px 0 rgba(0, 0, 0, 0.6);\n        border: 0px;\n      }\n      .g6-component-contextmenu ul {\n        padding-left: 0px;\n        margin: 0;\n      }\n      .g6-component-contextmenu li {\n        cursor: pointer;\n        list-style-type: none;\n        list-style: none;\n        margin-left: 0;\n        line-height: 38px;\n        padding: 0px 35px;\n      }\n      .g6-component-contextmenu li:hover {\n        color: #333;\n        background: #aaaaaa45;\n      }\n    ")}highlightNode(t=this.graph){t.on("node:mouseenter",function(e){const r=e.item;t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.setItemState(r,"hover",!0),t.paint(),t.setAutoPaint(!0)}),t.on("node:mouseleave",function(){t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.paint(),t.setAutoPaint(!0)})}highlightEdge(t=this.graph){t.on("edge:mouseenter",function(e){const r=e.item;t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.setItemState(r,"hover",!0),t.paint(),t.setAutoPaint(!0)}),t.on("edge:mouseleave",function(){t.setAutoPaint(!1),t.getEdges().forEach(function(e){t.clearItemStates(e)}),t.paint(),t.setAutoPaint(!0)})}setData(t,e=this.graph){this.data?e.changeData(t):e.data(t),this.data=t}render(t=this.graph){return t.render()}updateGraph(t,e=this.graph){this.data=t,e.changeData(t)}refresh(t=this.graph){t.refresh()}getContainer(t=this.graph){return t.getContainer()}getCanvas(t=this.graph){return t.get("canvas")}getNodes(t=this.graph){return t.getNodes()}getEdges(t=this.graph){return t.getEdges()}getNeighbors(t,e,r=this.graph){return r.getNeighbors(t,e)}findById(t,e=this.graph){return e.findById(t)}find(t,e,r=this.graph){return r.find(t,e)}findAll(t,e,r=this.graph){return r.findAll(t,e)}getEdgesByNode(t){return t.getEdges()}getInEdges(t){return t.getInEdges()}getOutEdges(t){return t.getOutEdges()}getSourceByEdge(t){return t.getSource()}getTargetByEdge(t){return t.getTarget()}expandNode(t){const e=t.getModel().id;this._expandCollapseNode(this.collpasedData[e],"show"),delete this.collpasedData[e]}collapseNode(t){const e=t.getModel().id,r=[];this._collapseFunc(t,r),this.collpasedData[e]=r,this._expandCollapseNode(r)}isCollpased(t){return!!this.collpasedData[t]}_collapseFunc(t,e=[]){const r=this.getNeighbors(t,"target"),s=this.getNeighbors(t,"source");for(let t=0;t<r.length;t++){const s=r[t],i=s.getModel();1===this.getNeighbors(s).length&&e.push({id:i.id})}for(let t=0;t<s.length;t++){const r=s[t],i=r.getModel();let n=this.getNeighbors(r),a=this.getNeighbors(r,"source");if(1===n.length||0===a.length)e.push({id:i.id});else{const t=[];this._collapseFunc(r,t),e.push({id:i.id,children:t})}}return e}_expandCollapseNode(t,e="hide"){t&&t.forEach(t=>{"hide"===e?this.hideItem(t.id):(this.showItem(t.id),this.isCollpased(t.id)&&delete this.collpasedData[t.id]),t.children&&this._expandCollapseNode(t.children,e)})}showItem(t,e,r=this.graph){r.showItem(t,e)}hideItem(t,e,r=this.graph){r.hideItem(t,e)}show(t){t.show()}hide(t){t.hide()}changeVisibility(t,e){t.changeVisibility(e)}isVisible(t){return t.isVisible()}getModel(t){return t.getModel()}addItem(t,e,r=this.graph){r.addItem(t,e)}removeItem(t,e=this.graph){e.removeItem(t)}updateItem(t,e,r=this.graph){r.updateItem(t,e)}refreshItem(t,e=this.graph){e.refreshItem(t)}refreshPositions(t=this.graph){t.refreshPositions()}on(t,e,r=this.graph){r.on(t,e)}off(t,e,r=this.graph){r.off(t,e)}toDataURL(t,e,r=this.graph){r.toDataURL(t,e)}bindNodeDefaultDragEvent(t=this.graph){t.on("node:dragstart",function(t){xn(t)}),t.on("node:drag",function(t){xn(t)}),t.on("node:dragend",function(t){t.item.get("model").fx=null,t.item.get("model").fy=null})}stopDefaultEventPropagation(t=this.graph){t.on("click",function(t){t.stopPropagation()}),t.on("mousedown",function(t){t.stopPropagation()}),t.on("mouseover",function(t){t.stopPropagation()}),t.on("mouseout",function(t){t.stopPropagation()})}clear(t=this.graph){t.clear()}destroy(t=this.graph){t.destroy()}}function xn(t){const e=t.item.get("model");return e.fx=t.x,e.fy=t.y,e.x=t.x,e.y=t.y,e}var wn=r(574),An=r.n(wn);class Mn{constructor(t,e="G6"){this.graph=null,this.config=An()(t),this.graphRender=null,this.type=e,this.createGraphRender(this.type),this.config=this.graphRender._getGraphConfig(this.config),this.createGraph(this.config),this.CLASS_NAME="SuperMap.KnowledgeGraph"}static dataFromGraphMap(t,e){return ln(t,e)}static dataFromKnowledgeGraphQuery(t){return ln(t)}handleNodeStatus(t){const{expand:e,collapse:r,hidden:s}=t;this.expandNodes(e),this.collapseNodes(r),this.hideNodes(s)}expandNodes(t){t&&t.forEach(t=>{this.expandNode(t+"")})}collapseNodes(t){t&&t.forEach(t=>{this.collapseNode(t+"")})}hideNodes(t){t&&t.forEach(t=>{this.hideItem(t+"")})}createGraphRender(t){"G6"===t&&(this.graphRender=new _n)}createGraph(t){const e=this.initGraph(t);return this.graph=e,this.autoResize(),e}getGraph(){return this.graph}autoResize(){this.config&&!1!==this.config.autoResize&&this.graphRender.autoResize()}zoom(t,e,r,s){this.graphRender.zoom(t,e,r,s)}zoomTo(t,e,r,s){this.graphRender.zoomTo(t,e,r,s)}fitView(t,e,r,s){this.graphRender.fitView(t,e,r,s)}fitCenter(t,e){this.graphRender.fitCenter(t,e)}getGraphCenterPoint(){return this.graphRender.getGraphCenterPoint()}getViewPortCenterPoint(){return this.graphRender.getViewPortCenterPoint()}getZoom(){return this.graphRender.getZoom()}getMinZoom(){return this.graphRender.getMinZoom()}setMinZoom(t){this.graphRender.setMinZoom(t)}getMaxZoom(){return this.graphRender.getMaxZoom()}setMaxZoom(t){this.graphRender.setMaxZoom(t)}getWidth(){return this.graphRender.getWidth()}getHeight(){return this.graphRender.getHeight()}initGraph(t){const e=this.graphRender.initGraph(t);this.graph=e;return this.graph.on("afterlayout",()=>{void 0!==this.config.zoom&&this.zoom(this.config.zoom),void 0!==this.config.center&&this.graphRender.setCenter({x:this.config.center[0],y:this.config.center[1]})}),e}setData(t,e=this.graph){t=t||{nodes:[],edges:[]},this.config&&this.config.nodeLabelMaxWidth&&(t.nodes=this.nodeLabelOpenEllipsis(this.config.nodeLabelMaxWidth,t.nodes)),this.graphRender.setData(t,e),this.render(e),this.data=t}render(t=this.graph){t&&this.graphRender.render(t)}updateGraph(t,e=this.graph){e&&this.graphRender.updateGraph(t,e)}refresh(){return this.graphRender.refresh()}changeSize(t,e){return this.graphRender.changeSize(t,e)}resize(t,e){this.graphRender.changeSize(t,e),this.graphRender.refresh()}getContainer(){return this.graphRender.getContainer()}getCanvas(){return this.graphRender.getCanvas()}getNodes(){return this.graphRender.getNodes()}getEdges(){return this.graphRender.getEdges()}getNeighbors(t,e){return this.graphRender.getNeighbors(t,e)}findById(t){return this.graphRender.findById(t)}find(t,e){return this.graphRender.find(t,e)}findAll(t,e){return this.graphRender.findAll(t,e)}getEdgesByNode(t){return this.graphRender.getEdgesByNode(t)}getInEdges(t){return this.graphRender.getInEdges(t)}getOutEdges(t){return this.graphRender.getOutEdges(t)}getSourceByEdge(t){return this.graphRender.getSourceByEdge(t)}getTargetByEdge(t){return this.graphRender.getTargetByEdge(t)}expandNode(t){const e=this.findById(t);e&&this.graphRender.expandNode(e)}collapseNode(t){const e=this.findById(t);e&&this.graphRender.collapseNode(e)}showItem(t,e){this.graphRender.showItem(t,e)}hideItem(t,e){this.graphRender.hideItem(t,e)}show(t){this.graphRender.show(t)}hide(t){this.graphRender.hide(t)}changeVisibility(t,e){this.graphRender.changeVisibility(t,e)}isVisible(t){return this.graphRender.isVisible(t)}getModel(t){return this.graphRender.getModel(t)}addItem(t,e){return this.graphRender.addItem(t,e)}removeItem(t){return this.graphRender.removeItem(t)}updateItem(t,e){return this.graphRender.updateItem(t,e)}refreshItem(t){return this.graphRender.refreshItem(t)}refreshPositions(){return this.graphRender.refreshPositions()}on(t,e){this.graphRender.on(t,e)}off(t,e){this.graphRender.off(t,e)}toDataURL(t,e){this.graphRender.toDataURL(t,e)}nodeLabelOpenEllipsis(t,e){return e?t?e.map(e=>{const r=e.labelCfg&&e.labelCfg.fontSize||this.defaultNode&&this.defaultNode.labelCfg&&this.defaultNode.labelCfg.fontSize||14;return e.label=function(t,e,r){const s=1*r;e*=1.6;if((t=>{let e=0;for(let r=0;r<t.length;r++)t.charCodeAt(r)>0&&t.charCodeAt(r)<128?e++:e+=2;return e})(t)*s>e){const r=Math.floor((e-20)/s),i=t.substring(0,r);return(t.substring(r).length+"â¦".length)*s>e?i+"\n"+t.substring(r,r+r-2)+"â¦":0==t.substring(r).length?i:i+"\n"+t.substring(r)}return t}(e.label,t,r),e}):e:[]}clear(t=this.graph){t&&t.clear()}destroy(t=this.graph){t&&t.destroy()}}const Cn=function(){try{return mapv}catch(t){return{}}}();var En=Cn.baiduMapLayer?Cn.baiduMapLayer.__proto__:Function;class Tn extends En{constructor(t,e,r,s,i){if(super(t,e,r),!En)return;this.options=r||{},this.transferCoordinate=s.transferCoordinate,this.getCenterPixel=s.getCenterPixel,this.getResolution=s.getResolution,this.validZoom=s.validZoom;let{mapElement:n,targetElement:a,id:o}=i;this.targetElement=a,this.canvas=this._createCanvas(o,n),this.canvasLayer={canvas:this.canvas,devicePixelRatio:this.devicePixelRatio},this.init(r),this.argCheck(r),this.stopAniamation=!1,this.animation=r.animation,this.clickEvent=this.clickEvent.bind(this),this.mousemoveEvent=this.mousemoveEvent.bind(this),this._canvasUpdate(),this.targetElement.appendChild(this.canvas),this._expectShow=!0,this.isShow=!0}clickEvent(t){var e=t.point;super.clickEvent(e,t)}mousemoveEvent(t){var e=t.point;super.mousemoveEvent(e,t)}getContext(){return this.canvas.getContext(this.context)}addData(t,e){var r=t;t&&t.get&&(r=t.get()),this.dataSet.add(r),this.update({options:e})}update(t){var e=t||{},r=e.data;r&&r.get&&(r=r.get()),void 0!=r&&this.dataSet.set(r),super.update({options:e.options})}getData(){return this.dataSet}removeData(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}clearData(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}updateData(t,e){t&&t.get&&this.dataSet.set(t.get()),this.update({options:e})}_createCanvas(t,e){const{width:r,height:s}=e.style;var i=document.createElement("canvas");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.id=t;var n="undefined"==typeof window?{}:window,a=this.devicePixelRatio=n.devicePixelRatio||1;return i.width=parseInt(r)*a,i.height=parseInt(s)*a,this.options.context&&"2d"!=this.options.context||i.getContext("2d").scale(a,a),i.style.width=r,i.style.height=s,i}_canvasUpdate(t){if(!this.stopAniamation){var e=this.options.animation,r=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void this.clear(r);"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else this.clear(r);if("2d"===this.context)for(var s in this.options)r[s]=this.options[s];else r.clear(r.COLOR_BUFFER_BIT);if(this.validZoom()){var i={transferCoordinate:this.transferCoordinate()},n=this.getResolution();void 0!==t&&(i.filter=function(r){var s=e.trails||10;return t&&r.time>t-s&&r.time<t});var a=this.dataSet.get(i);this.processData(a),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/n),this.options.width&&(this.options._width=this.options.width/n),this.options.height&&(this.options._height=this.options.height/n)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width);var o=this.getCenterPixel();this.drawContext(r,a,this.options,o),this.options.updateCallback&&this.options.updateCallback(t)}}}init(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.setZIndex(this.options.zIndex),this.initAnimator()}destroy(){this.targetElement.removeChild(this.canvas),this.clearData(),this.animator&&this.animator.stop(),this.animator=null}addAnimatorEvent(){}moveEndEvent(){this.stopAniamation=!1,this._canvasUpdate()}draw(){this._canvasUpdate()}visible(){return this.isShow}hide(){this.isShow=!1,this.canvas.style.display="none"}show(){this.isShow=!0,this.canvas.style.display="block"}setZIndex(t){this.canvas.style.zIndex=t}clear(t){t&&t.clearRect&&t.clearRect(0,0,parseInt(this.map.getCanvas().style.width),parseInt(this.map.getCanvas().style.height))}}var On=function(t){var e;if(!t)return e;return["m","meter","meters"].indexOf(t.toLocaleLowerCase())>-1?e=1:["degrees","deg","degree","dd"].indexOf(t.toLocaleLowerCase())>-1?e=2*Math.PI*6378137/360:t===W.KILOMETER?e=.001:t===W.INCH?e=1/.025399999918:t===W.FOOT&&(e=.3048),e};function Pn(t,e=!0,r=!0,s=[-180,180]){var i=s[1],n=s[0],a=i-n;return t===i&&e?t:t===n&&r?t:0===((t-n)%a+a)%a&&e?i:((t-n)%a+a)%a+n}function Ln(t){const e=parseInt(t);let r=parseInt(60*(t-e)),s=parseInt(60*(60*(t-e)-r));return`${e}Â°${r=0===parseInt(r/10)?`0${r}`:r}'${s=0===parseInt(s/10)?`0${s}`:s}`}function In(t,e,r){return 1/(t*e*(1/.0254)*On(r))}const Nn=function(){try{return THREE}catch(t){return{}}}();function kn(t,e,r){if(t===r||t===e)return t;let s=r-e;return((t-e)%s+s)%s+e}function Rn(t){return t*Math.PI/180}var Dn={matrix:[1,-1,0,0],projection:{R:6378137,minZoom:0,maxZoom:22,nativeMaxZoom:19,RAD:Math.PI/180,METERS_PER_DEGREE:6378137*Math.PI/180,MAX_LATITUDE:85.0511287798,project:function(t){const e=this.RAD,r=this.METERS_PER_DEGREE,s=this.MAX_LATITUDE;let i,n=t instanceof Array?{lng:t[0],lat:t[1]}:{lng:t.lng,lat:t.lat},a=n.lng,o=Math.max(Math.min(s,n.lat),-s);return{x:a*r,y:(i=0===o?0:Math.log(Math.tan((90+o)*e/2))/e)*r}},unproject:function(t){const e=t.x,r=t.y,s=this.RAD,i=this.METERS_PER_DEGREE;let n;return 0===r?n=0:(n=r/i,n=(2*Math.atan(Math.exp(n*s))-Math.PI/2)/s),{lng:kn(e/i,-180,180),lat:kn(n,-this.MAX_LATITUDE,this.MAX_LATITUDE)}},locate:function(t,e,r){if(!t)return null;if(e=e||0,r=r||0,!e&&!r)return t;let s=t.lng;if(0!==e){let r=Math.abs(e),i=Rn(t.lng);s=kn(180*(i+=2*Math.sqrt(Math.pow(Math.sin(r/(2*this.R)),2)/Math.pow(Math.cos(i),2))*(r>0?1:-1))/Math.PI,-180,180)}let i=t.lat;if(0!==r){let e=Math.abs(r),s=Rn(t.lat);i=kn(180*(s+=2*Math.sin(e/(2*this.R))*(e>0?1:-1))/Math.PI,-90,90)}return{lng:s,lat:i}},getResolution:function(t){if(!this.resolutions){for(var e=[],r=12756274*Math.PI,s=0;s<=this.maxZoom;s++)e[s]=r/(256*Math.pow(2,s));this.resolutions=e}let i=0|t,n=this.resolutions.length;i=i<0?0:i>n-1?n-1:i;const a=this.resolutions[i];if((0|t)!==t&&i!==n-1){return a+(this.resolutions[i+1]-a)*(t-i)}return a}},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},lngLatToPoint:function(t,e){var r=this.project(t);return this.transform(r,this.projection.getResolution(e))},locate:function(t,e,r){return this.projection.locate(t,e,r)},transform:function(t,e){return{x:this.matrix[0]*(t.x-this.matrix[2])/e,y:this.matrix[1]*(t.y-this.matrix[3])/e}}};const Fn=Dn.projection,{Color:Bn,Scene:Gn,WebGLRenderer:jn,PerspectiveCamera:Un,Vector3:Jn,Shape:zn,Mesh:qn,ExtrudeGeometry:Vn}=Nn,Hn=Math.PI/180,Wn=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Qn=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;class Yn{constructor(t,e,r){this._layer=t,this.renderer=e||"gl",this.options=r}setMap(t){this.map=t}render(){this._layer&&(this.prepare(),this._layer.fire("initialized"),this._layer&&this._layer.draw(this.context,this.scene,this.camera),this._layer.fire("draw"),this.renderScene())}update(){this.remove(),this.render()}renderScene(){this.locationCamera(),this.animationFrame=this.renderFrame(function(){this.animationFrame=null,this.context&&this.context.render(this.scene,this.camera)}.bind(this))}renderFrame(t){return Wn(function(){t&&"function"==typeof t&&t()})}resize(){this._resetElementSize(this.container),this._resetElementSize(this.canvas);let t=this.canvas.width,e=this.canvas.height,r=this.getMapSize();this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.context.setSize(r.width,r.height),this.renderScene()}prepare(){if(!this.map)return new Error("map object is necessary");this.canvas?this.clear(this.context):(this._initContainer(),this._initThreeRenderer(),this._layer.fire("rendererinitialized"))}getMapSize(){let t=this.map.getContainer();return{width:t.clientWidth,height:t.clientHeight}}cancelFrame(){null!=this.animationFrame&&Qn(this.animationFrame)}remove(){null!=this.animationFrame&&Qn(this.animationFrame),this.container.removeChild(this.canvas),this.container.parentNode.removeChild(this.container),this.context=null,this.canvas=null,this.container=null}clear(t){t&&t.clear&&t.clear(),t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}getScale(t){let e=this.map,r=null==t?e.getZoom():t,s=Fn.getResolution(Fn.nativeMaxZoom);return Fn.getResolution(r)/s}getCanvasContainer(){return this.container}getCanvas(){return this.canvas}locationCamera(){let t=this.map,e=this.getMapSize(),r=t.transform.zoomScale(Fn.nativeMaxZoom-t.getZoom()-1),s=Math.tan(t.transform.fov/2*Hn),i=this.camera,n=t.getPitch()*Hn,a=-r*e.height/2/s;i.position.z=a*Math.cos(n);let o=Dn.lngLatToPoint(t.getCenter(),Fn.nativeMaxZoom),l=Math.sin(n)*a,h=t.getBearing()*Hn;i.position.x=o.x+l*Math.sin(h),i.position.y=o.y-l*Math.cos(h),i.up.set(Math.sin(h),-Math.cos(h),0),i.lookAt(new Nn.Vector3(o.x,o.y,0)),i.updateProjectionMatrix()}toThreeShape(t){if(!t)return null;let e=this.getCoordinatesCenter(t),r=this.lngLatToPosition(e),s=t.map(t=>this.lngLatToPosition({lng:t[0],lat:t[1]}).sub(r));return new zn(s)}toThreeMesh(t,e,r,s){if(!t)return null;let i=t;s&&(i=this.removeDuplicatedCoordinates(t));let n=this.distanceToThreeVector3(e,e).x,a=this.toThreeShape(i),o=new Vn(a,{amount:n,bevelEnabled:!0}),l=new qn(o,r),h=this.lngLatToPosition(this.getCoordinatesCenter(i));return l.position.set(h.x,h.y,-n),l}addObject(t,e){e&&t&&this.setPosition(t,e),this.scene.add(t)}clearMesh(){let t=this.scene;if(!t)return this;for(let e=t.children.length-1;e>=0;e--)t.children[e]instanceof Nn.Mesh&&t.remove(t.children[e]);return this}clearAll(t){let e=this.scene;if(!e)return this;for(let r=e.children.length-1;r>=0;r--)!t&&e.children[r]instanceof Nn.Camera||e.remove(e.children[r]);return this}setPosition(t,e){if(!t||!e)return this;var r=this.lngLatToPosition(e);return t.position.set(r.x,r.y,r.z),this}lngLatToPosition(t){let e=Dn.projection.nativeMaxZoom,r=Dn.lngLatToPoint(t,e);return new Jn(r.x,r.y,-0)}distanceToThreeVector3(t,e,r){let s=this.map,i=r||s.getCenter(),n=Dn.projection.nativeMaxZoom,a=Dn.locate(i,t,e),o=Dn.lngLatToPoint(i,n),l=Dn.lngLatToPoint(a,n),h=Math.abs(l.x-o.x)*Math.sign(t),u=Math.abs(l.y-o.y)*Math.sign(e);return new Jn(h,u,0)}removeDuplicatedCoordinates(t){function e(t,e){return t[0]===e[0]&&t[1]===e[1]}let r=[].concat(t);for(let t=r.length-1;t>=1;t--)e(r[t],r[t-1])&&r.splice(t,1);return e(r[0],r[r.length-1])&&r.splice(r.length-1,1),r}getCoordinatesCenter(t){let e=0,r=0,s=0,i=0,n=t.length;for(;i<n;i++)t[i]&&(e+=t[i][0],r+=t[i][1],s++);return{lng:e/s,lat:r/s}}_initContainer(){var t=this._createCanvas(),e=this.container=document.createElement("div");e.id=this._layer.id,e.className="threejs-wrapper",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.overflow="hidden",this._resetElementSize(e),e.appendChild(t),this.map.getCanvasContainer().appendChild(e)}_createCanvas(){if(this.canvas)return;const t=this.canvas=document.createElement("canvas");return t.className="threejs-overlay",t.style.outline="none",this._resetElementSize(t),t}_resetElementSize(t){if(!t)return;const e=this.getMapSize(),r=window.devicePixelRatio?window.devicePixelRatio:1,s=r*e.width,i=r*e.height;t.width=s,t.height=i,t.style.width=e.width+"px",t.style.height=e.height+"px"}_initThreeRenderer(){let t,e=this.map,r=this.getMapSize();"gl"===(this.renderer||"gl")&&((t=new jn({canvas:this.canvas,alpha:!0,antialias:!0,preserveDrawingBuffer:!0},this.options)).autoClear=!0,t.clear()),t.setClearColor(new Bn(1,1,1),0),t.canvas=this.canvas,this.context=t;let s=e.transform.fov,i=Math.tan(s/2*Hn),n=this.getScale(Fn.minZoom)/this.getScale(Fn.nativeMaxZoom)*r.height/2/i;this.camera=new Un(s,r.width/r.height,1,n),this.scene=new Gn,this.scene.add(this.camera)}}class Xn{constructor(t,e){this.layerTypeID=t,this.data=[].concat(e.data),this.props=e.props?e.props:{},this.callback=e.callback?e.callback:{},this.id=e.layerId?e.layerId:v.createUniqueID("graphicLayer_"+this.layerTypeID+"_")}onAdd(){}render(){}setStyle(t){v.extend(this.props,t),this._createLayerByLayerTypeID(),this.update()}setData(t){this.data=this.data||[],this.data.length=0;let e=v.isArray(t)?[].concat(t):[t];this.layer.props.data||(this.layer.props.data=[]),this.layer.props.data.length=0;for(let t=0;t<e.length;t++)this.layer.props.data.push(e[t]);this.data=this.layer.props.data,this.update()}addData(t){this.data=this.data||[];let e=v.isArray(t)?[].concat(t):[t];this.layer.props.data||(this.layer.props.data=[]);for(let t=0;t<e.length;t++)this.layer.props.data.push(e[t]);this.update()}update(){if("Awaiting state"!==this.layer.lifecycle){let t={dataChanged:!0,propsChanged:!0,viewportChanged:!0,updateTriggersChanged:!0};this.layer.setChangeFlags(t)}this._draw()}clear(){this.removeData(),this.deckGL.finalize()}removeData(){this.data.length=0,this.layer.props.data&&(this.layer.props.data.length=0),this.update()}moveTo(t,e){var r=document.getElementById(this.id);if(e=void 0===e||e){var s=document.getElementById(t);r&&s&&s.parentNode.insertBefore(r,s)}else{var i=document.getElementById(t);if(r){if(i.nextSibling)return void i.parentNode.insertBefore(r,i.nextSibling);i.parentNode.appendChild(r)}}}setVisibility(t){this.canvas&&t!==this.visibility&&(this.visibility=t,this.canvas.style.display=t?"block":"none")}_draw(){let t=this._getState();t.layers=[this.layer],t.canvas=this.canvas,this.deckGL.setProps(t)}_getState(){let t={width:parseInt(this.canvas.style.width),height:parseInt(this.canvas.style.height),...this.getMapInfo()},e={};for(let r in t)e[r]=t[r];for(let t in this.props)e[t]=this.props[t];return this._isEPSG3857&&this._isEPSG3857()?(e.coordinateSystem=this.coordinateSystem,e.isGeographicCoordinateSystem=this.isGeographicCoordinateSystem):(e.coordinateSystem=1,e.isGeographicCoordinateSystem=!1),e.data=this.data,e}_createLayerByLayerTypeID(){if(this.props.data=this.data,this.props.isGeographicCoordinateSystem=this.isGeographicCoordinateSystem,this.props.coordinateSystem=this.coordinateSystem,this.props.pickable=Boolean(this.props.onClick)||Boolean(this.props.onHover),"scatter-plot"===this.layerTypeID)this.props.id="scatter-plot",this._createScatterPlotLayer();else if("path-layer"===this.layerTypeID)this.props.id="path-layer",this._createPathLayer();else if("polygon-layer"===this.layerTypeID)this.props.id="polygon-layer",this._createPolygonLayer();else if("arc-layer"===this.layerTypeID)this.props.id="arc-layer",this._createArcLineLayer();else{if("hexagon-layer"!==this.layerTypeID)throw new Error(this.layerTypeID+" does not support");this.props.id="hexagon-layer",this._createHexagonLayer()}}_createScatterPlotLayer(){var t=this;this.props.getPosition=this.callback.getPosition?this.callback.getPosition:function(t){if(!t)return[0,0,0];let e=t.getLngLat();return e&&[e.lng,e.lat,0]},this.callback.getColor&&(this.props.getColor=this.callback.getColor?this.callback.getColor:function(e){let r=e&&e.getStyle();return r&&r.color||t.props.color}),this.callback.getRadius&&(this.props.getRadius=this.callback.getRadius?this.callback.getRadius:function(e){let r=e&&e.getStyle();return r&&r.radius||t.props.radius}),(this.props.color||this.props.radius)&&(this.props.updateTriggers={},this.props.radius&&(this.props.updateTriggers.getRadius=[this.props.radius]),this.props.color&&(this.props.updateTriggers.getColor=[this.props.color])),this.layer=new window.DeckGL.ScatterplotLayer(this.props)}_createPathLayer(){this.props.getPath=this.callback.getPath?this.callback.getPath:function(t){return t.geometry.coordinates},this.callback.getColor&&(this.props.getColor=this.callback.getColor),this.callback.getWidth&&(this.props.getWidth=this.callback.getWidth),this.callback.getDashArray&&(this.props.getDashArray=this.callback.getDashArray),this.layer=new window.DeckGL.PathLayer(this.props)}_createPolygonLayer(){this.props.getPolygon=this.callback.getPolygon?this.callback.getPolygon:function(t){return t.geometry.coordinates},this.callback.getElevation&&(this.props.getElevation=this.callback.getElevation),this.callback.getFillColor&&(this.props.getFillColor=this.callback.getFillColor),this.callback.getLineColor&&(this.props.getLineColor=this.callback.getLineColor),this.callback.getLineWidth&&(this.props.getLineWidth=this.callback.getLineWidth),this.props.updateTriggers={},this.props.updateTriggers.getColor=this.props.color?this.props.color:[0,0,128,128],this.layer=new window.DeckGL.PolygonLayer(this.props)}_createArcLineLayer(){this.props.getSourcePosition=this.callback.getSourcePosition?this.callback.getSourcePosition:function(t){return t?t.geometry.coordinates[0]:[0,0,0]},this.props.getTargetPosition=this.callback.getTargetPosition?this.callback.getTargetPosition:function(t){return t?t.geometry.coordinates[1]:[0,0,0]},this.callback.getStrokeWidth&&(this.props.getStrokeWidth=this.callback.getStrokeWidth),this.callback.getSourceColor&&(this.props.getSourceColor=this.callback.getSourceColor),this.callback.getTargetColor&&(this.props.getTargetColor=this.callback.getTargetColor),this.layer=new window.DeckGL.ArcLayer(this.props)}_createHexagonLayer(){this.props.getPosition=this.callback.getPosition?this.callback.getPosition:function(t){return t?t.geometry.coordinates:[0,0,0]},this.callback.getColorValue&&(this.props.getColorValue=this.callback.getColorValue),this.callback.getElevationValue&&(this.props.getElevationValue=this.callback.getElevationValue),this.layer=new window.DeckGL.HexagonLayer(this.props)}_initContainer(t,e){const{width:r,height:s}=e.style;this.canvas=this._createCanvas(r,s),t.appendChild(this.canvas)}_createCanvas(t,e){let r=document.createElement("canvas");return r.id=this.id,r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.cursor="",r.width=parseInt(t),r.height=parseInt(e),r.style.width=t,r.style.height=e,r}}class Zn extends d{constructor(t,e,r){super(t,e,r),this.x=parseFloat(t),this.y=parseFloat(e),this.text=r.toString(),this.bsInfo={h:null,w:null},this.element=document.createElement("span"),this.CLASS_NAME="SuperMap.Geometry.GeoText",this.geometryType="GeoText"}destroy(){super.destroy(),this.x=null,this.y=null,this.text=null}getCentroid(){return new w(this.x,this.y)}clone(t){return null==t&&(t=new Zn(this.x,this.y,this.text)),v.applyDefaults(t,this),t}calculateBounds(){this.bounds=new x(this.x,this.y,this.x,this.y)}getLabelPxBoundsByLabel(t,e,r,s){var i,n,a,o,l=v.cloneObject(t),h=(s.label||this.text).split("\n").length;if(e=parseFloat(e),r=parseFloat(r),h>1&&(r=parseFloat(r)*h),s.labelAlign&&"cm"!==s.labelAlign)switch(s.labelAlign){case"lt":l.x+=e/2,l.y+=r/2;break;case"lm":l.x+=e/2;break;case"lb":l.x+=e/2,l.y-=r/2;break;case"ct":l.y+=r/2;break;case"cb":l.y-=r/2;break;case"rt":l.x-=e/2,l.y+=r/2;break;case"rm":l.x-=e/2;break;case"rb":l.x-=e/2,l.y-=r/2}return this.bsInfo.h=r,this.bsInfo.w=e,i=l.x-parseFloat(e)/2,n=l.y+parseFloat(r)/2,o=l.x+parseFloat(e)/2,a=l.y-parseFloat(r)/2,new x(i,n,o,a)}getLabelPxBoundsByText(t,e){var r,s,i,n,a=this.getLabelPxSize(e),o=v.cloneObject(t);if(e.labelAlign&&"cm"!==e.labelAlign)switch(e.labelAlign){case"lt":o.x+=a.w/2,o.y+=a.h/2;break;case"lm":o.x+=a.w/2;break;case"lb":o.x+=a.w/2,o.y-=a.h/2;break;case"ct":o.y+=a.h/2;break;case"cb":o.y-=a.h/2;break;case"rt":o.x-=a.w/2,o.y+=a.h/2;break;case"rm":o.x-=a.w/2;break;case"rb":o.x-=a.w/2,o.y-=a.h/2}return this.bsInfo.h=a.h,this.bsInfo.w=a.w,r=o.x-a.w/2,s=o.y+a.h/2,n=e.fontStyle&&"italic"===e.fontStyle?o.x+a.w/2+parseInt(parseFloat(e.fontSize)/2):o.x+a.w/2,i=o.y-a.h/2,new x(r,s,n,i)}getLabelPxSize(t){var e,r,s,i,n=parseFloat(t.strokeWidth);e=t.label||this.text,r=t.fontSize?parseFloat(t.fontSize):parseFloat("12px");var a=e.split("\n"),o=a.length;i=o>1?r*o+o+n+.2*r:r+n+.2*r+1,s=0,this.labelWTmp&&s<this.labelWTmp&&(s=this.labelWTmp);for(var l=0;l<o;l++){var h=this.getTextCount(a[l]),u=this.labelWTmp=v.getTextBounds(t,a[l],this.element).textWidth+1*h.textC+n;s<u&&(s=u)}var c=new Object;return c.h=i,c.w=s,c}getTextCount(t){for(var e={},r=0,s=0,i=0;i<t.length;i++)t.charCodeAt(i)>255?r++:s++;return e.cnC=r,e.enC=s,e.textC=t.length,e}}class Kn{constructor(t){this.fieldNames=null,this.fieldValues=null,this.geometry=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerFeature"}destroy(){var t=this;t.fieldNames=null,t.fieldValues=null,t.geometry&&(t.geometry.destroy(),t.geometry=null)}toFeature(){var t,e,r,s,i={},n=this;for(var a in t=n.fieldNames,e=n.fieldValues,t)i[t[a]]=e[a];return n.geometry&&(r=n.geometry.toGeometry()),s=new I(r,i),n.geometry&&n.geometry.id&&(s.fid=n.geometry.id),s}static fromJson(t){var e=null;if(t)return(e=t.geometry)&&(e=Tt.fromJson(e)),new Kn({fieldNames:t.fieldNames,fieldValues:t.fieldValues,geometry:e})}}class $n{constructor(t){this.options=t,this.rootCanvas=null,this.features=[],this.visibility=!0,this.opacity=t.opacity?t.opacity:1,this.colors=t.colors?t.colors:["blue","cyan","lime","yellow","red"],this.useGeoUnit=!!t.useGeoUnit&&t.useGeoUnit,this.radius=t.radius?t.radius:50,this.featureWeight=t.featureWeight?t.featureWeight:null,this.maxWeight=null,this.minWeight=null,this.canvasContext=null,this.maxWidth=null,this.maxHeight=null,this.extent={},this.mapElement=t.mapElement,this._createCanvasContainer(t.targetElement,t.size)}addFeatures(t){this.features=this.toiClientFeature(t),this.refresh()}refresh(){0!==this.features.length&&this.updateHeatPoints(this.extent)}setOpacity(t){t!==this.opacity&&(this.opacity=t,v.modifyDOMElement(this.rootCanvas,null,null,null,null,null,null,t))}updateHeatPoints(t){this.features&&this.features.length>0?this.convertFastToPixelPoints(t):this.canvasContext.clearRect(0,0,this.maxWidth,this.maxWidth)}convertFastToPixelPoints(t){var e,r,s,i,n,a,o,l=[],h=t.getEast()-t.getWest(),u=t.getNorth()-t.getSouth(),c=this.mapElement;i=h/c.width>u/c.height?h/c.width:u/c.height,this.useRadius=this.useGeoUnit?parseInt(this.radius/i):this.radius;for(var d=0;d<this.features.length;d++){var p=this.features[d],f=p.geometry,m=this.getPixelXY(new _(f.x,f.y));this.featureWeight?(m.weight=p.attributes[this.featureWeight],this.maxWeight||(n=n||m.weight,a=a||m.weight,n=Math.max(n,m.weight),a=Math.min(a,m.weight))):m.weight=1,e=Math.floor(m.x),r=Math.floor(m.y),s=m.weight,l.push([e,r,s])}this.maxWeight?this.draw(l,this.maxWeight):(o=n&&a?(n+a)/2:1,this.draw(l,o))}draw(t,e){if(!(this.maxHeight>0&&this.maxWidth>0))return!1;var r=this.canvasContext;r.setTransform(1,0,0,1,0,0),this.canvasContext.clearRect(0,0,this.maxWidth,this.maxHeight),this.drawCircle(this.useRadius),this.createGradient();for(var s=0;s<t.length;s++){var i=t[s];this.canvasContext.globalAlpha=Math.max(i[2]/e,.05),this.canvasContext.drawImage(this.circle,i[0]-this.useRadius,i[1]-this.useRadius)}var n=r.getImageData(0,0,this.maxWidth,this.maxHeight);this.colorize(n.data,this.grad),r.putImageData(n,0,0)}colorize(t,e){for(var r,s=0;s<t.length;s+=4)(r=4*t[s+3])&&(t[s]=e[r],t[s+1]=e[r+1],t[s+2]=e[r+2])}drawCircle(t){var e=t/2,r=this.circle=document.createElement("canvas"),s=r.getContext("2d");r.height=2*t,r.width=2*t,s.shadowOffsetX=s.shadowOffsetY=2*t,s.shadowBlur=e,s.shadowColor="#000000",s.beginPath(),s.arc(-t,-t,t/2,0,2*Math.PI,!0),s.closePath(),s.fill()}createGradient(){var t=this.colors,e=document.createElement("canvas"),r=e.getContext("2d"),s=r.createLinearGradient(0,0,0,256);e.height=256,e.width=1;for(var i=1,n=0,a=t.length;n<a;n++)s.addColorStop(i/a,t[n]),i++;r.fillStyle=s,r.fillRect(0,0,1,256),this.grad=r.getImageData(0,0,1,256).data}getPixelXY(t){let e;if(t instanceof w||t instanceof Zn){let r=this.options.convertLatlonToPixel({lon:t.x,lat:t.y});e={x:parseInt(r.x),y:parseInt(r.y)}}if(t instanceof _){let r=this.options.convertLatlonToPixel(t);e={x:parseInt(r.x),y:parseInt(r.y)}}return e}_createCanvasContainer(t){this.rootCanvas=document.createElement("canvas"),this.rootCanvas.id=this.options.id,this.rootCanvas.width=this.maxWidth=parseInt(this.mapElement.style.width),this.rootCanvas.height=this.maxHeight=parseInt(this.mapElement.style.height),this.canvasContext=this.rootCanvas.getContext("2d");const e=window.devicePixelRatio||1;1!==e&&this.canvasContext&&this.canvasContext.scale(e,e),v.modifyDOMElement(this.rootCanvas,null,{x:0,y:0},{w:this.maxWidth,h:this.maxHeight},"absolute",null,null,this.opacity),t.appendChild(this.rootCanvas)}toiClientFeature(t){v.isArray(t)||(t=[t]);let e=[];for(let r=0;r<t.length;r++)if(t[r]instanceof I)e.push(t[r]);else if(-1!=["FeatureCollection","Feature","Geometry"].indexOf(t[r].type)){let s=new Ot;e=e.concat(s.read(t[r]))}else{if(!t[r].geometry||!t[r].geometry.parts)throw new Error(`Features[${r}]'s type does not match, please check.`);e.push(Kn.fromJson(t[r]).toFeature())}return e}removeFeatures(t){if(t&&0!==t.length&&this.features&&0!==this.features.length){if(t===this.features)return this.removeAllFeatures();v.isArray(t)||(t=[t]);for(var e,r,s=[],i=0,n=t.length;i<n;i++)e=t[i],-1!==(r=v.indexOf(this.features,e))?this.features.splice(r,1):s.push(e);var a=0==s.length;return this.refresh(),{succeed:a,heatPointsFailedRemoved:s}}}removeAllFeatures(){this.features=[],this.refresh()}removeFromMap(){this.removeAllFeatures(),this.options.targetElement.removeChild(this.rootCanvas)}setVisibility(t){this.rootCanvas&&t!==this.visibility&&(this.visibility=t,this.rootCanvas.style.display=t?"block":"none")}setExtent(t){this.extent=t}_hide(){this.rootCanvas.style.display="none"}_show(){this.rootCanvas.style.display="block"}}const ta={color:[0,0,0,255],opacity:.8,radius:10,radiusScale:1,radiusMinPixels:0,radiusMaxPixels:Number.MAX_SAFE_INTEGER,strokeWidth:1,outline:!1};class ea{constructor(t,e,r,s){let i=v.assign(this,ta,e);this.id=t,this.graphics=[].concat(i.graphics),this.mapOptions=s,this.functions=r,this.visibility=!0,this.init()}init(){this.canvas&&this.mapOptions.targetElement.appendChild(this.canvas),this._initContainer();let t=this.getState(),{data:e,color:r,radius:s,opacity:i,highlightColor:n,radiusScale:a,radiusMinPixels:o,radiusMaxPixels:l,strokeWidth:h,outline:u}=t,c=this,d={id:"scatter-plot",data:e,pickable:Boolean(this.onClick)||Boolean(this.onHover),autoHighlight:!0,color:r,opacity:i,radius:s,radiusScale:a,highlightColor:n,radiusMinPixels:o,radiusMaxPixels:l,strokeWidth:h,outline:u,isGeographicCoordinateSystem:this.isGeographicCoordinateSystem,coordinateSystem:this.coordinateSystem,getPosition:function(t){if(!t)return[0,0,0];let e=t.getLngLat();return e&&[e.lng,e.lat,0]},getColor:function(t){let e=t&&t.getStyle();return e&&e.color||c.color},getRadius:function(t){let e=t&&t.getStyle();return e&&e.radius||c.radius},updateTriggers:{getColor:[r],getRadius:[s]}};this.onClick&&(d.onClick=this.onClick),this.onHover&&(d.onHover=this.onHover),this.layer=new window.DeckGL.ScatterplotLayer(d);let p={};for(let e in t)p[e]=t[e];let f=parseInt(this.canvas.style.width),m=parseInt(this.canvas.style.height);p.width=f,p.height=m,p.layers=[this.layer],p.canvas=this.canvas,this.deckGL=new window.DeckGL.experimental.DeckGLJS(p),this.draw()}setStyle(t){let e={color:this.color,radius:this.radius,opacity:this.opacity,highlightColor:this.highlightColor,radiusScale:this.radiusScale,radiusMinPixels:this.radiusMinPixels,radiusMaxPixels:this.radiusMaxPixels,strokeWidth:this.strokeWidth,outline:this.outline};v.assign(this,e,t),this.update()}setGraphics(t){this.graphics=this.graphics||[],this.graphics.length=0;let e=v.isArray(t)?[].concat(t):[t];this.layer.props.data||(this.layer.props.data=[]),this.layer.props.data.length=0;for(let t=0;t<e.length;t++)this.layer.props.data.push(e[t]);this.update()}addGraphics(t){this.graphics=this.graphics||[];let e=v.isArray(t)?[].concat(t):[t];this.layer.props.data||(this.layer.props.data=[]);for(let t=0;t<e.length;t++)this.layer.props.data.push(e[t]);this.update()}getGraphicBy(t,e){let r=null;for(let s in this.graphics)if(this.graphics[s][t]===e){r=this.graphics[s];break}return r}getGraphicById(t){return this.getGraphicBy("id",t)}getGraphicsByAttribute(t,e){var r,s=[];for(let i in this.graphics)(r=this.graphics[i])&&r.attributes&&r.attributes[t]===e&&s.push(r);return s}removeGraphics(t=null){if(!t||0===t.length||t===this.graphics)return this.graphics.length=0,this.layer.props.data&&(this.layer.props.data.length=0),void this.update();v.isArray(t)||(t=[t]);for(let e=t.length-1;e>=0;e--){let r=t[e],s=v.indexOf(this.graphics,r);-1!==s&&this.graphics.splice(s,1)}this.update()}update(){if("Awaiting state"!==this.layer.lifecycle){this.layer.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,updateTriggersChanged:!0});let t=this.getState(),e=parseInt(this.canvas.style.width),r=parseInt(this.canvas.style.height);t.width=e,t.height=r,this.layer.setState(t)}}clear(){this.removeGraphics(),this.deckGL.finalize()}remove(){this.mapOptions.targetElement.removeChild(this.canvas)}destroy(){this.remove(),this.clear()}moveTo(t,e){var r=document.getElementById(this.id);if(e=void 0===e||e){var s=document.getElementById(t);r&&s&&s.parentNode.insertBefore(r,s)}else{var i=document.getElementById(t);if(r){if(i.nextSibling)return void i.parentNode.insertBefore(r,i.nextSibling);i.parentNode.appendChild(r)}}}setVisibility(t){this.canvas&&t!==this.visibility&&(this.visibility=t,this.canvas.style.display=t?"block":"none")}draw(){let t=this.getState(),e={};for(let r in t)e[r]=t[r];let r=parseInt(this.canvas.style.width),s=parseInt(this.canvas.style.height);e.width=r,e.height=s,e.layers=[this.layer],e.canvas=this.canvas,this.deckGL.setProps(e)}_initContainer(){this.canvas=this._createCanvas(this.mapOptions.mapElement),this.mapOptions.targetElement.appendChild(this.canvas)}_createCanvas(t){let e=document.createElement("canvas");return this.id&&(e.id=this.id),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.cursor="",e.width=parseInt(t.style.width),e.height=parseInt(t.style.height),e.style.width=t.style.width,e.style.height=t.style.height,e}getState(){let t=this.functions.getMapState();return{data:this.graphics,color:this.color,radius:this.radius,opacity:this.opacity,highlightColor:this.highlightColor,radiusScale:this.radiusScale,radiusMinPixels:this.radiusMinPixels,radiusMaxPixels:this.radiusMaxPixels,strokeWidth:this.strokeWidth,outline:this.outline,...t}}}const ra={textSize:"12px",textFont:["12px Calibri","sans-serif"],textAnchor:"bottom",textColor:"rgba(0,0,0,1)",textHaloColor:"rgba(255,255,255,1)",textHaloWidth:1},sa={lineColor:"red",lineCap:"round",lineJoin:"round",lindDasharray:[.4,5],lineDashOffset:0,lineWidth:1},ia={showLabel:!0,opacity:1,visible:!0,interval:10,extent:null,minZoom:0,maxZoom:50,wrapX:!0,strokeStyle:sa,lngLabelFormatter:null,latLabelFormatter:null,lngLabelStyle:ra,latLabelStyle:ra};class na{constructor(t,e,r,s){this.map=t,this.id=s&&s.id,this.sourceId=this.id+"_line",this.canvasId=this.id,this.options=e,this.mapElement=s.mapElement,this.targetElement=s.targetElement,this.getMapStateByKey=r.getMapStateByKey,this.getDefaultExtent=r.getDefaultExtent,this.setVisibility=r.setVisibility,this.updateGraticuleLayer=r.updateGraticuleLayer,this.init()}init(){this._initialize(),this._createCanvas(),this._drawCanvas(),this.setVisibility(),this._drawLabel()}onRemove(){this.targetElement.removeChild(this.canvas),this.canvas=null}setMinZoom(t){this.options.minZoom=t,this.setVisibility()}setMaxZoom(t){this.options.maxZoom=t,this.setVisibility()}setShowLabel(t){this.options.showLabel=t,this._drawLabel()}setExtent(t){this.options.extent=this.getDefaultExtent(t),this.features=this._getGraticuleFeatures(),this.updateGraticuleLayer(),this._drawLabel()}setLngLabelStyle(t){this.options.lngLabelStyle=t,this._drawLabel()}setLatLabelStyle(t){this.options.latLabelStyle=t,this._drawLabel()}setIntervals(t){this.options.interval=t,this._calcInterval(),this.features=this._getGraticuleFeatures(),this.updateGraticuleLayer(),this._drawLabel()}draw(){this._reset()}_initialize(t=this.options){(t=t||{}).strokeStyle=Object.assign({},sa,t.strokeStyle||{}),t.lngLabelStyle=Object.assign({},ra,t.lngLabelStyle||{}),t.latLabelStyle=Object.assign({},ra,t.latLabelStyle||{}),this.options=Object.assign({},ia,t,{extent:this.getDefaultExtent(t.extent),wrapX:t.wrapX}),this.oldExtent=this.options.extent,this._calcInterval(),this.isRotate=!1,this.visible=this.options.visible,this.features=this._getGraticuleFeatures()}_createCanvas(){if(this.canvas)return;const t=this.mapElement;this.canvas=document.createElement("canvas"),this.canvas.id=this.canvasId,this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px";var e=("undefined"==typeof window?{}:window).devicePixelRatio||1;this.canvas.width=parseInt(t.style.width)*e,this.canvas.height=parseInt(t.style.height)*e,this.canvas.style.width=t.style.width,this.canvas.style.height=t.style.height,this.canvas.globalAlpha=this.options.opacity,this.targetElement.appendChild(this.canvas)}_drawCanvas(){this.canvas||this._createCanvas(),this.setVisibility(),this._reset()}_resizeCallback(){this.targetElement&&this.targetElement.removeChild(this.canvas),this.canvas=null,this._drawCanvas()}_reset(){this._updateRotate(),this._updateExtent(),this._calcInterval(),this._drawLabel()}_updateRotate(){const t=this.getMapStateByKey("getBearing");this.isRotate=t>-180&&t<=-90||t>=90&&t<180}_updateExtent(){if(this.options.wrapX&&!this.oldExtent){const{_ne:t,_sw:e}=this.getMapStateByKey("getBounds");this.options.extent=[e.lng,e.lat,t.lng,t.lat]}}_calcInterval(t=this.options.interval){"function"==typeof t?(t=t(this.map),this._currLngInterval=t,this._currLatInterval=t):(this._currLngInterval=t,this._currLatInterval=t)}_formatLat(t){return this.options.latFormatTickLabel?this.options.latLabelFormatter(t):t<0?Ln(-1*t)+"S":t>0?Ln(t)+"N":""+Ln(t)}_formatLng(t){return this.options.lngLabelFormatter?this.options.lngLabelFormatter(t):(t=Pn(t))>0&&t<=180?Ln(t)+"E":t<0&&t>=-180?Ln(-1*t)+"W":""+Ln(t)}_parsePxToInt(t){t.length>2&&"p"===t.charAt(t.length-2)&&(t=t.substr(0,t.length-2));try{return parseInt(t,10)}catch(t){console.log(t)}return 0}_drawLabel(t=this.visible){const e=this.canvas,r=e.getContext("2d");if(t&&this.options.showLabel){if(this.mapElement){this._currLngInterval&&this._currLatInterval||this._calcInterval(),r.clearRect(0,0,e.width,e.height);const{lngLabelStyle:t,latLabelStyle:s}=this.options,{lngPoints:i,latPonits:n}=this._getGridiculePoints();i.forEach(e=>{this._drawLng(r,e[0],e[1],e[2],t)}),n.forEach(t=>{this._drawLat(r,t[0],t[1],t[2],s)})}}else r.clearRect(0,0,e.width,e.height)}_drawLat(t,e,r,s,i){t=this._setLabelStyle(t,i);const n=this.canvas.width;let a=12;try{const e=t.font.split(" ")[0];a=this._parsePxToInt(e)}catch(t){console.log(t)}if(!s){const t=e;e=r,r=this.getMapStateByKey("project",[t,e])}const o=this._formatLat(e),l=t.measureText(o).width;t.strokeText(o,(s?n:r.x)-l,(s?r:r.y)+a/2),t.fillText(o,(s?n:r.x)-l,(s?r:r.y)+a/2)}_drawLng(t,e,r,s,i){t=this._setLabelStyle(t,i);const n=this.canvas.height;if(!s){const t=r;r=this.getMapStateByKey("project",[e,t])}const a=this._formatLng(e),o=t.measureText(a).width;t.strokeText(a,(s?r:r.x)-o/2,s?n:r.y),t.fillText(a,(s?r:r.x)-o/2,s?n:r.y)}_getLatPoints(t=[-180,180],e,r,s=this.features){if(!s)return;if(this.options.wrapX&&-180===t[0]&&180===t[1])return[];let i=[];return s.forEach(s=>{const n=s.geometry.coordinates[0][1];if(s.geometry.coordinates[1][1]===n){let s="number"==typeof r?r:t[1];this.isRotate&&(s="number"==typeof e?e:t[0]),this.options.wrapX&&(i=i.concat(this._getWrapPoints(s,n,[s,s]))),i.push([s,n])}}),i}_getLngPoints(t=[-90,90],e,r,s=this.features){if(!s)return;let i="number"==typeof e?e:t[0];this.isRotate&&(i="number"==typeof r?r:t[1]);let n=[];return s.forEach(t=>{let e=t.geometry.coordinates[0][0];t.geometry.coordinates[1][0]===e&&(n.push([e,i]),this.options.wrapX&&(n=n.concat(this._getWrapPoints(e,i))))}),n}_getWrapPoints(t,e,r=this.oldExtent){const s=[],{_ne:i,_sw:n}=this.getMapStateByKey("getBounds"),a=r.length>2?r[2]:r[1];for(;t>=n.lng;){const i=Pn(t,180===a,-180===r[0]);(!r||i>=r[0]&&i<=a)&&s.push([t,e]),t-=360}for(;t<=i.lng;){const i=Pn(t,180===a,-180===r[0]);(!r||i>=r[0]&&i<=a)&&s.push([t,e]),t+=360}return s}_getGridiculePoints(){const t=this._getEdgeLat(),e=this._getEdgeLng(),{latRange:r,lngRange:s,firstLat:i,firstLng:n,lastLat:a,lastLng:o}=this._getRange();return{latPonits:this._getUniquePoint(this._getLatPoints(s,n,o),t,1),lngPoints:this._getUniquePoint(this._getLngPoints(r,i,a),e,0)}}_getEdgeLat(t=this._currLatInterval){let e,r=[],s=[];const i=this.canvas.width,n=this.canvas.height,{extent:a}=this._getRange(),{_ne:o}=this.getMapStateByKey("getBounds");if(this.options.wrapX&&Pn(o.lng)>a[2])return[];const l=this._countDecimals(t);for(let o=0;o<=n;o++){const n=this.getMapStateByKey("unproject",[i,o]),h=Pn(n.lng);(this.options.wrapX?h>=a[0]&&h<=a[2]:n.lng>=a[0]&&n.lng<=a[2])&&n.lat>=a[1]&&n.lat<=a[3]&&(r.push([n.lat,o]),s.push(n.lat),void 0===e&&n.lat.toFixed(l)%t==0&&(e=Number(n.lat.toFixed(l))))}const{first:h,last:u,coordinates:c,points:d}=this._getIntersectRange(e,s,r,t);e=Math.min(Math.max(h,-90),90);const p=Math.max(Math.min(Math.round(u),90),-90);return-90!==e||-90!==p?this._getClosestCoordinate(e,p,c,d,t):[]}_getEdgeLng(t=this._currLngInterval){let e,r=[],s=[];const i=this.canvas.width,n=this.canvas.height,a=this.options.extent,o=this._countDecimals(t),{_sw:l}=this.getMapStateByKey("getBounds");if(this.options.wrapX&&Pn(l.lat)>a[3])return[];for(let l=0;l<=i;l++){const i=this.getMapStateByKey("unproject",[l,n]),h=Pn(i.lng);(this.options.wrapX?h>=a[0]&&h<=a[2]:i.lng>=a[0]&&i.lng<=a[2])&&i.lat>=a[1]&&i.lat<=a[3]&&(r.push([i.lng,l]),s.push(i.lng),void 0===e&&i.lng.toFixed(o)%t==0&&(e=Number(i.lng.toFixed(o))))}const{first:h,last:u,coordinates:c,points:d}=this._getIntersectRange(e,s,r,t);return e=h,this._getClosestCoordinate(e,u,c,d,t)}_getIntersectRange(t,e,r,s){let i=e[e.length-1];if(t>i){i=t,e.reverse(),r.reverse();const n=this._countDecimals(s);for(let r=0;r<=e.length;r++){const i=e[r];if(i.toFixed(n)%s==0){t=Number(i.toFixed(n));break}}}return{first:t,last:i,coordinates:e,points:r}}_getClosestCoordinate(t,e,r,s,i){let n=[],a=t;for(;a<=e;){const t=this._getClosestNumberIndex(a,r),e=s[t];n.push([Math.round(e[0]),e[1],!0]),a+=i,r=r.slice(t),s=s.slice(t)}return n}_getClosestNumberIndex(t,e){for(var r=0,s=Number.MAX_VALUE,i=0;i<e.length;i++){var n=Math.abs(e[i]-t);if(n<=s){if(n===s&&e[i]<e[r])continue;r=i,s=n}}return r}_getUniquePoint(t,e,r=0){if(this.options.wrapX)return t.concat(e);if(!e||0===e.length)return t;var s=e;const i=this.canvas.width,n=this.canvas.height;for(var a in t){const e=this.getMapStateByKey("project",t[a]),o=s.findIndex(e=>e[0]===t[a][r]);o<=-1?s.push(t[a]):e&&e.x>=0&&e.x<=i&&e.y>=0&&e.y<=n&&(s[o]=t[a])}return s}_countDecimals(t){return Math.floor(t)!==t&&t.toString().split(".")[1].length||0}_getGraticuleFeatures(){const t=this._currLngInterval||10,e=this._currLatInterval||10,r=[];let{latRange:s,lngRange:i,firstLat:n,firstLng:a,lastLat:o,lastLng:l}=this._getRange();this.options.wrapX&&!this.oldExtent&&(s=[-90,90],i=[-180,180],n=a=o=l=null),"number"==typeof a&&r.unshift(this._makeLineFeature(this._makeLineCoords(a,s,n,o))),"number"==typeof l&&r.unshift(this._makeLineFeature(this._makeLineCoords(l,s,n,o)));for(var h=i[0];h<=i[1];h+=t)r.unshift(this._makeLineFeature(this._makeLineCoords(h,s,n,o)));"number"==typeof n&&r.unshift(this._makeLineFeature(this._makeLineCoords(n,i,a,l,"lat"))),"number"==typeof o&&r.unshift(this._makeLineFeature(this._makeLineCoords(o,i,a,l,"lat")));for(var u=s[0];u<=s[1];u+=e)r.unshift(this._makeLineFeature(this._makeLineCoords(u,i,a,l,"lat")));return r}_getRange(t=this.options.extent&&[...this.options.extent]){t&&0!==t.length||(t=this.getDefaultExtent());const e={};if((t=t.map(t=>Number(t.toFixed(6))))[1]%this._currLatInterval!=0){e.firstLat=t[1];const r=Math.ceil(t[1]/this._currLatInterval);t[1]=r*this._currLatInterval}if(t[3]%this._currLatInterval!=0){e.lastLat=t[3];const r=Math.floor(t[3]/this._currLatInterval);t[3]=r*this._currLatInterval}if(t[0]%this._currLngInterval!=0){e.firstLng=t[0];const r=Math.ceil(t[0]/this._currLngInterval);t[0]=r*this._currLngInterval}if(t[2]%this._currLngInterval!=0){e.lastLng=t[2];const r=Math.floor(t[2]/this._currLngInterval);t[2]=r*this._currLngInterval}return Object.assign({latRange:[t[1],t[3]],lngRange:[t[0],t[2]],extent:t},e)}_makeLineCoords(t,e=[-90,90],r,s,i="lng"){t="lng"===i?this._lngFix(t):t,r="number"==typeof r?r:e[0],s="number"==typeof s?s:e[1];const n=Math.abs(r-s),a=[];for(var o=r;o<=s;o+=n)"lng"===i?a.push([t,o]):a.push([o,t]);return a}_makeLineFeature(t,e="LineString"){return{type:"Feature",geometry:{type:e,coordinates:t}}}_lngFix(t){return t>=180?180:t<=-180?-180:t}_transformStrokeStyle(t=this.options.strokeStyle){if(!t||"string"==typeof t)return{paint:{"line-color":t||"rgba(0,0,0,0.2)"}};const e={visibility:this.visible?"visible":"none","line-join":t.lineJoin||"round","line-cap":t.lineCap||"round"},r={"line-color":t.lineColor||"rgba(0,0,0,0.2)","line-width":t.lineWidth||1,"line-offset":t.lineDashOffset||0,"line-translate-anchor":"viewport"};return t.lineWidth&&("function"==typeof t.lineWidth?r["line-width"]=t.lineWidth(this.map):r["line-width"]=t.lineWidth),t.lindDasharray&&("function"==typeof t.lindDasharray?r["line-dasharray"]=t.lindDasharray(this.map):r["line-dasharray"]=t.lindDasharray),{layout:e,paint:r}}_setLabelStyle(t,e){return e.textColor&&(t.fillStyle=e.textColor),e.textSize&&(t.font=e.textSize+" "+(e.textFont||["Calibri","sans-serif"]).join(",")),e.textHaloColor&&(t.strokeStyle=e.textHaloColor,t.lineWidth=e.textHaloWidth||1),e.textAnchor&&(t.textBaseline=this._getTxetBaseline(e.textAnchor),t.textAligin=this._getTxetAlign(e.textAligin)),t}_getTxetBaseline(t){if(!t)return"bottom";const e=t.split("-");return e.includes("bottom")?"bottom":e.includes("top")?"top":e.includes("center")?"middle":void 0}_getTxetAlign(t){if(!t)return"center";const e=t.split("-");return e.includes("left")?"left":e.includes("right")?"right":e.includes("center")?"center":void 0}}const aa={textSize:"12px",textFont:["12px Calibri","sans-serif"],textAnchor:"bottom",textColor:"rgba(0,0,0,1)",textHaloColor:"rgba(255,255,255,1)",textHaloWidth:1},oa={lineColor:"red",lineCap:"round",lineJoin:"round",lindDasharray:[.4,5],lineDashOffset:0,lineWidth:1},la={showLabel:!0,opacity:1,visible:!0,interval:10,extent:null,minZoom:0,maxZoom:50,wrapX:!0,strokeStyle:oa,lngLabelFormatter:null,latLabelFormatter:null,lngLabelStyle:aa,latLabelStyle:aa};var ha;!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.MultiPoint=4]="MultiPoint",t[t.MultiLineString=5]="MultiLineString",t[t.MultiPolygon=6]="MultiPolygon",t[t.GeometryCollection=7]="GeometryCollection",t[t.CircularString=8]="CircularString",t[t.CompoundCurve=9]="CompoundCurve",t[t.CurvePolygon=10]="CurvePolygon",t[t.MultiCurve=11]="MultiCurve",t[t.MultiSurface=12]="MultiSurface",t[t.Curve=13]="Curve",t[t.Surface=14]="Surface",t[t.PolyhedralSurface=15]="PolyhedralSurface",t[t.TIN=16]="TIN",t[t.Triangle=17]="Triangle"}(ha||(ha={}));const ua=4,ca=4,da=new Int32Array(2),pa=new Float32Array(da.buffer),fa=new Float64Array(da.buffer),ma=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var ya;!function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}(ya||(ya={}));class ga{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new ga(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return da[0]=this.readInt32(t),pa[0]}readFloat64(t){return da[ma?0:1]=this.readInt32(t),da[ma?1:0]=this.readInt32(t+4),fa[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){pa[0]=e,this.writeInt32(t,da[0])}writeFloat64(t,e){fa[0]=e,this.writeInt32(t,da[ma?0:1]),this.writeInt32(t+4,da[ma?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+ua+ca)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<ca;e++)t+=String.fromCharCode(this.readInt8(this.position_+ua+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=ua;const s=this.bytes_.subarray(t,t+r);return e===ya.UTF8_BYTES?s:this.text_decoder_.decode(s)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+ua}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=ca)throw new Error("FlatBuffers: file identifier must be length "+ca);for(let e=0;e<ca;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+ua+e))return!1;return!0}createScalarList(t,e){const r=[];for(let s=0;s<e;++s){const e=t(s);null!==e&&r.push(e)}return r}createObjList(t,e){const r=[];for(let s=0;s<e;++s){const e=t(s);null!==e&&r.push(e.unpack())}return r}}function va(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var ba,Sa=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}return e=t,s=[{key:"getRootAsGeometry",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsGeometry",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startGeometry",value:function(t){t.startObject(8)}},{key:"addEnds",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"createEndsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}},{key:"startEndsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"addXy",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createXyVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startXyVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addZ",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"createZVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startZVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addM",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"createMVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startMVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addT",value:function(t,e){t.addFieldOffset(4,e,0)}},{key:"createTVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startTVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addTm",value:function(t,e){t.addFieldOffset(5,e,0)}},{key:"createTmVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}},{key:"startTmVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addType",value:function(t,e){t.addFieldInt8(6,e,ha.Unknown)}},{key:"addParts",value:function(t,e){t.addFieldOffset(7,e,0)}},{key:"createPartsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startPartsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"endGeometry",value:function(t){return t.endObject()}},{key:"createGeometry",value:function(e,r,s,i,n,a,o,l,h){return t.startGeometry(e),t.addEnds(e,r),t.addXy(e,s),t.addZ(e,i),t.addM(e,n),t.addT(e,a),t.addTm(e,o),t.addType(e,l),t.addParts(e,h),t.endGeometry(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"ends",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}},{key:"endsLength",value:function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"endsArray",value:function(){var t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"xy",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"xyLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"xyArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"z",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"zLength",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"zArray",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"m",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"mLength",value:function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"mArray",value:function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"t",value:function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"tLength",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"tArray",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"tm",value:function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}},{key:"tmLength",value:function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"type",value:function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):ha.Unknown}},{key:"parts",value:function(e,r){var s=this.bb.__offset(this.bb_pos,18);return s?(r||new t).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*e),this.bb):null}},{key:"partsLength",value:function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}}])&&va(e.prototype,r),s&&va(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,s}();function _a(t,e){for(var r=[],s=0;s<t.length;s+=2){var i=[t[s],t[s+1]];e&&i.push(e[s>>1]),r.push(i)}return r}function xa(t,e,r){if(!r||0===r.length)return[_a(t,e)];var s,i=0,n=Array.from(r).map(function(e){return t.slice(i,i=e<<1)});return e&&(i=0,s=Array.from(r).map(function(t){return e.slice(i,i=t)})),n.map(function(t,e){return _a(t,s?s[e]:void 0)})}function wa(t,e){var r=e;if(r===ha.Unknown&&(r=t.type()),r===ha.GeometryCollection){for(var s=[],i=0;i<t.partsLength();i++){var n=t.parts(i),a=n.type();s.push(wa(n,a))}return{type:ha[r],geometries:s}}if(r===ha.MultiPolygon){for(var o=[],l=0;l<t.partsLength();l++)o.push(wa(t.parts(l),ha.Polygon));return{type:ha[r],coordinates:o.map(function(t){return t.coordinates})}}var h=function(t,e){var r=t.xyArray(),s=t.zArray();switch(e){case ha.Point:var i=Array.from(r);return s&&i.push(s[0]),i;case ha.MultiPoint:case ha.LineString:return _a(r,s);case ha.MultiLineString:case ha.Polygon:return xa(r,s,t.endsArray())}}(t,r);return{type:ha[r],coordinates:h}}function Aa(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}!function(t){t[t.Byte=0]="Byte",t[t.UByte=1]="UByte",t[t.Bool=2]="Bool",t[t.Short=3]="Short",t[t.UShort=4]="UShort",t[t.Int=5]="Int",t[t.UInt=6]="UInt",t[t.Long=7]="Long",t[t.ULong=8]="ULong",t[t.Float=9]="Float",t[t.Double=10]="Double",t[t.String=11]="String",t[t.Json=12]="Json",t[t.DateTime=13]="DateTime",t[t.Binary=14]="Binary"}(ba||(ba={}));var Ma=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}return e=t,s=[{key:"getRootAsColumn",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsColumn",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startColumn",value:function(t){t.startObject(11)}},{key:"addName",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addType",value:function(t,e){t.addFieldInt8(1,e,ba.Byte)}},{key:"addTitle",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"addWidth",value:function(t,e){t.addFieldInt32(4,e,-1)}},{key:"addPrecision",value:function(t,e){t.addFieldInt32(5,e,-1)}},{key:"addScale",value:function(t,e){t.addFieldInt32(6,e,-1)}},{key:"addNullable",value:function(t,e){t.addFieldInt8(7,+e,1)}},{key:"addUnique",value:function(t,e){t.addFieldInt8(8,+e,0)}},{key:"addPrimaryKey",value:function(t,e){t.addFieldInt8(9,+e,0)}},{key:"addMetadata",value:function(t,e){t.addFieldOffset(10,e,0)}},{key:"endColumn",value:function(t){var e=t.endObject();return t.requiredField(e,4),e}},{key:"createColumn",value:function(e,r,s,i,n,a,o,l,h,u,c,d){return t.startColumn(e),t.addName(e,r),t.addType(e,s),t.addTitle(e,i),t.addDescription(e,n),t.addWidth(e,a),t.addPrecision(e,o),t.addScale(e,l),t.addNullable(e,h),t.addUnique(e,u),t.addPrimaryKey(e,c),t.addMetadata(e,d),t.endColumn(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"type",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):ba.Byte}},{key:"title",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"width",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"precision",value:function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"scale",value:function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"nullable",value:function(){var t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}},{key:"unique",value:function(){var t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"primaryKey",value:function(){var t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"metadata",value:function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&Aa(e.prototype,r),s&&Aa(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,s}();function Ca(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var Ea=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}return e=t,s=[{key:"getRootAsFeature",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsFeature",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startFeature",value:function(t){t.startObject(3)}},{key:"addGeometry",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addProperties",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createPropertiesVector",value:function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}},{key:"startPropertiesVector",value:function(t,e){t.startVector(1,e,1)}},{key:"addColumns",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"createColumnsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startColumnsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"endFeature",value:function(t){return t.endObject()}},{key:"finishFeatureBuffer",value:function(t,e){t.finish(e)}},{key:"finishSizePrefixedFeatureBuffer",value:function(t,e){t.finish(e,void 0,!0)}},{key:"createFeature",value:function(e,r,s,i){return t.startFeature(e),t.addGeometry(e,r),t.addProperties(e,s),t.addColumns(e,i),t.endFeature(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"geometry",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?(t||new Sa).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}},{key:"properties",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}},{key:"propertiesLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"propertiesArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"columns",value:function(t,e){var r=this.bb.__offset(this.bb_pos,8);return r?(e||new Ma).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}},{key:"columnsLength",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}}])&&Ca(e.prototype,r),s&&Ca(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,s}(),Ta=(new TextEncoder,new TextDecoder);function Oa(t,e){var r={};if(!e||0===e.length)return r;var s=t.propertiesArray();if(!s)return r;for(var i=new DataView(s.buffer,s.byteOffset),n=t.propertiesLength(),a=0;a<n;){var o=i.getUint16(a,!0);a+=2;var l=e[o],h=l.name;switch(l.type){case ba.Bool:r[h]=!!i.getUint8(a),a+=1;break;case ba.Byte:r[h]=i.getInt8(a),a+=1;break;case ba.UByte:r[h]=i.getUint8(a),a+=1;break;case ba.Short:r[h]=i.getInt16(a,!0),a+=2;break;case ba.UShort:r[h]=i.getUint16(a,!0),a+=2;break;case ba.Int:r[h]=i.getInt32(a,!0),a+=4;break;case ba.UInt:r[h]=i.getUint32(a,!0),a+=4;break;case ba.Long:r[h]=Number(i.getBigInt64(a,!0)),a+=8;break;case ba.ULong:r[h]=Number(i.getBigUint64(a,!0)),a+=8;break;case ba.Float:r[h]=i.getFloat32(a,!0),a+=4;break;case ba.Double:r[h]=i.getFloat64(a,!0),a+=8;break;case ba.DateTime:case ba.String:var u=i.getUint32(a,!0);a+=4,r[h]=Ta.decode(s.subarray(a,a+u)),a+=u;break;case ba.Json:var c=i.getUint32(a,!0);a+=4;var d=Ta.decode(s.subarray(a,a+c));r[h]=JSON.parse(d),a+=c;break;default:throw new Error("Unknown type "+l.type)}}return r}function Pa(t,e){var r=e.columns;return{type:"Feature",geometry:wa(t.geometry(),e.geometryType),properties:Oa(t,r)}}const La=new Uint8Array(0);function Ia(t){this._source=t,this._array=La,this._index=0}function Na(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}Ia.prototype.read=function(){var t=this,e=t._array.subarray(t._index);return t._source.read().then(function(r){return t._array=La,t._index=0,r.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:function(t,e){if(!t.length)return e;if(!e.length)return t;var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}(e,r.value)}})},Ia.prototype.slice=function(t){if((t|=0)<0)throw new Error("invalid length");var e=this,r=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var s=new Uint8Array(t);return s.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(n){return n.done?(e._array=La,e._index=0,r>0?s.subarray(0,r):null):r+n.value.length>=t?(e._array=n.value,e._index=t-r,s.set(n.value.subarray(0,t-r),r),s):(s.set(n.value,r),r+=n.value.length,i())})}()},Ia.prototype.cancel=function(){return this._source.cancel()};var ka=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}return e=t,s=[{key:"getRootAsCrs",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsCrs",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startCrs",value:function(t){t.startObject(6)}},{key:"addOrg",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addCode",value:function(t,e){t.addFieldInt32(1,e,0)}},{key:"addName",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"addWkt",value:function(t,e){t.addFieldOffset(4,e,0)}},{key:"addCodeString",value:function(t,e){t.addFieldOffset(5,e,0)}},{key:"endCrs",value:function(t){return t.endObject()}},{key:"createCrs",value:function(e,r,s,i,n,a,o){return t.startCrs(e),t.addOrg(e,r),t.addCode(e,s),t.addName(e,i),t.addDescription(e,n),t.addWkt(e,a),t.addCodeString(e,o),t.endCrs(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"org",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"code",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"wkt",value:function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"codeString",value:function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&Na(e.prototype,r),s&&Na(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,s}();function Ra(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var Da=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}return e=t,s=[{key:"getRootAsHeader",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsHeader",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startHeader",value:function(t){t.startObject(14)}},{key:"addName",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addEnvelope",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createEnvelopeVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startEnvelopeVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addGeometryType",value:function(t,e){t.addFieldInt8(2,e,ha.Unknown)}},{key:"addHasZ",value:function(t,e){t.addFieldInt8(3,+e,0)}},{key:"addHasM",value:function(t,e){t.addFieldInt8(4,+e,0)}},{key:"addHasT",value:function(t,e){t.addFieldInt8(5,+e,0)}},{key:"addHasTm",value:function(t,e){t.addFieldInt8(6,+e,0)}},{key:"addColumns",value:function(t,e){t.addFieldOffset(7,e,0)}},{key:"createColumnsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startColumnsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"addFeaturesCount",value:function(t,e){t.addFieldInt64(8,e,BigInt("0"))}},{key:"addIndexNodeSize",value:function(t,e){t.addFieldInt16(9,e,16)}},{key:"addCrs",value:function(t,e){t.addFieldOffset(10,e,0)}},{key:"addTitle",value:function(t,e){t.addFieldOffset(11,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(12,e,0)}},{key:"addMetadata",value:function(t,e){t.addFieldOffset(13,e,0)}},{key:"endHeader",value:function(t){return t.endObject()}},{key:"finishHeaderBuffer",value:function(t,e){t.finish(e)}},{key:"finishSizePrefixedHeaderBuffer",value:function(t,e){t.finish(e,void 0,!0)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"envelope",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"envelopeLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"envelopeArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"geometryType",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):ha.Unknown}},{key:"hasZ",value:function(){var t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasM",value:function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasT",value:function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasTm",value:function(){var t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"columns",value:function(t,e){var r=this.bb.__offset(this.bb_pos,18);return r?(e||new Ma).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}},{key:"columnsLength",value:function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"featuresCount",value:function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}},{key:"indexNodeSize",value:function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}},{key:"crs",value:function(t){var e=this.bb.__offset(this.bb_pos,24);return e?(t||new ka).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}},{key:"title",value:function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"metadata",value:function(t){var e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&Ra(e.prototype,r),s&&Ra(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,s}();function Fa(t){for(var e=Da.getRootAsHeader(t),r=e.featuresCount(),s=e.indexNodeSize(),i=[],n=0;n<e.columnsLength();n++){var a=e.columns(n);if(!a)throw new Error("Column unexpectedly missing");if(!a.name())throw new Error("Column name unexpectedly missing");i.push({name:a.name(),type:a.type(),title:a.title(),description:a.description(),width:a.width(),precision:a.precision(),scale:a.scale(),nullable:a.nullable(),unique:a.unique(),primary_key:a.primaryKey()})}var o=e.crs(),l=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(r),indexNodeSize:s,crs:l,title:e.title(),description:e.description(),metadata:e.metadata()}}var Ba=function(t,e){return(Ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Ga(t,e,r,s){return new(r||(r=Promise))(function(i,n){function a(t){try{l(s.next(t))}catch(t){n(t)}}function o(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,o)}l((s=s.apply(t,e||[])).next())})}function ja(t,e){var r,s,i,n,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&n[0]?s.return:n[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,n[1])).done)return i;switch(s=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){a.label=n[1];break}if(6===n[0]&&a.label<i[1]){a.label=i[1],i=n;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(n);break}i[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],s=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function Ua(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ja(t){return this instanceof Ja?(this.v=t,this):new Ja(t)}function za(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=r.apply(t,e||[]),n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(t){i[t]&&(s[t]=function(e){return new Promise(function(r,s){n.push([t,e,r,s])>1||o(t,e)})})}function o(t,e){try{(r=i[t](e)).value instanceof Ja?Promise.resolve(r.value.v).then(l,h):u(n[0][2],r)}catch(t){u(n[0][3],t)}var r}function l(t){o("next",t)}function h(t){o("throw",t)}function u(t,e){t(e),n.shift(),n.length&&o(n[0][0],n[0][1])}}var qa=function(t){function e(e){var r=t.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,r.constructor),r}return function(t,e){function r(){this.constructor=t}Ba(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error);(function(){function t(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),t.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();function Va(t){null!=t&&"function"==typeof t.then&&t.then(Ka,Ka)}var Ha=0,Wa=1,Qa=2,Ya=3,Xa=4,Za=1024,Ka=function(){};function $a(t){var e=t.err,r=Promise.resolve(t.execution).then(function(t){if(null!=e)throw e;return t});return t.err=void 0,t.execution=r.then(function(){},function(){}),void 0===t.pending?r:t.pending.then(function(){return r})}function to(t,e){var r=t.state>=Ya;return Promise.resolve(e).then(function(e){return!r&&t.state>=Xa?$a(t).then(function(t){return{value:t,done:!0}}):{value:e,done:r}})}function eo(t,e){var r,s;if(!(t.state>=Qa))if(t.state=Qa,t.onnext(),t.onstop(),null==t.err&&(t.err=e),0!==t.pushes.length||void 0!==t.buffer&&!t.buffer.empty)try{for(var i=Ua(t.pushes),n=i.next();!n.done;n=i.next()){n.value.resolve()}}catch(t){r={error:t}}finally{try{n&&!n.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}else ro(t)}function ro(t){var e,r;if(!(t.state>=Ya)){t.state<Qa&&eo(t),t.state=Ya,t.buffer=void 0;try{for(var s=Ua(t.nexts),i=s.next();!i.done;i=s.next()){var n=i.value,a=void 0===t.pending?$a(t):t.pending.then(function(){return $a(t)});n.resolve(to(t,a))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}t.pushes=[],t.nexts=[]}}function so(t){t.state>=Xa||(t.state<Ya&&ro(t),t.state=Xa)}function io(t){if(!(t.state>=Wa)){t.state=Wa;var e=function(t,e){if(Va(e),t.pushes.length>=Za)throw new qa("No more than "+Za+" pending calls to push are allowed on a single repeater.");if(t.state>=Qa)return Promise.resolve(void 0);var r,s=void 0===t.pending?Promise.resolve(e):t.pending.then(function(){return e});s=s.catch(function(e){t.state<Qa&&(t.err=e),so(t)}),t.nexts.length?(t.nexts.shift().resolve(to(t,s)),r=t.nexts.length?Promise.resolve(t.nexts[0].value):new Promise(function(e){return t.onnext=e})):void 0===t.buffer||t.buffer.full?r=new Promise(function(e){return t.pushes.push({resolve:e,value:s})}):(t.buffer.add(s),r=Promise.resolve(void 0));var i=!0,n={},a=r.catch(function(t){if(i)throw t});return n.then=function(t,e){return i=!1,Promise.prototype.then.call(r,t,e)},n.catch=function(t){return i=!1,Promise.prototype.catch.call(r,t)},n.finally=r.finally.bind(r),t.pending=s.then(function(){return a}).catch(function(e){t.err=e,so(t)}),n}.bind(null,t),r=function(t){var e=eo.bind(null,t),r=new Promise(function(e){return t.onstop=e});return e.then=r.then.bind(r),e.catch=r.catch.bind(r),e.finally=r.finally.bind(r),e}(t);t.execution=new Promise(function(s){return s(t.executor(e,r))}),t.execution.catch(function(){return eo(t)})}}var no=new WeakMap,ao=function(){function t(t,e){no.set(this,{executor:t,buffer:e,err:void 0,state:Ha,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Ka,onstop:Ka})}return t.prototype.next=function(t){Va(t);var e=no.get(this);if(void 0===e)throw new Error("WeakMap error");if(e.nexts.length>=Za)throw new qa("No more than "+Za+" pending calls to next are allowed on a single repeater.");if(e.state<=Ha&&io(e),e.onnext(t),void 0!==e.buffer&&!e.buffer.empty){var r=to(e,e.buffer.remove());if(e.pushes.length){var s=e.pushes.shift();e.buffer.add(s.value),e.onnext=s.resolve}return r}if(e.pushes.length){var i=e.pushes.shift();return e.onnext=i.resolve,to(e,i.value)}return e.state>=Qa?(ro(e),to(e,$a(e))):new Promise(function(r){return e.nexts.push({resolve:r,value:t})})},t.prototype.return=function(t){Va(t);var e=no.get(this);if(void 0===e)throw new Error("WeakMap error");return ro(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),to(e,$a(e))},t.prototype.throw=function(t){var e=no.get(this);if(void 0===e)throw new Error("WeakMap error");return e.state<=Ha||e.state>=Qa||void 0!==e.buffer&&!e.buffer.empty?(ro(e),null==e.err&&(e.err=t),to(e,$a(e))):this.next(Promise.reject(t))},t.prototype[Symbol.asyncIterator]=function(){return this},t.race=lo,t.merge=ho,t.zip=uo,t.latest=co,t}();function oo(t,e){var r,s,i=[],n=function(t){null!=t&&"function"==typeof t[Symbol.asyncIterator]?i.push(t[Symbol.asyncIterator]()):null!=t&&"function"==typeof t[Symbol.iterator]?i.push(t[Symbol.iterator]()):i.push(function(){return za(this,arguments,function(){return ja(this,function(r){switch(r.label){case 0:return e.yieldValues?[4,Ja(t)]:[3,3];case 1:return[4,r.sent()];case 2:r.sent(),r.label=3;case 3:return e.returnValues?[4,Ja(t)]:[3,5];case 4:return[2,r.sent()];case 5:return[2]}})})}())};try{for(var a=Ua(t),o=a.next();!o.done;o=a.next()){n(o.value)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return i}function lo(t){var e=this,r=oo(t,{returnValues:!0});return new ao(function(t,s){return Ga(e,void 0,void 0,function(){var e,i,n,a,o,l;return ja(this,function(h){switch(h.label){case 0:if(!r.length)return s(),[2];i=!1,s.then(function(){e(),i=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),a=void 0,o=0,l=function(){var i,l,h,u,c,d;return ja(this,function(p){switch(p.label){case 0:i=o;try{for(c=void 0,l=Ua(r),h=l.next();!h.done;h=l.next())u=h.value,Promise.resolve(u.next()).then(function(t){t.done?(s(),void 0===n&&(n=t)):o===i&&(o++,e(t))},function(t){return s(t)})}catch(t){c={error:t}}finally{try{h&&!h.done&&(d=l.return)&&d.call(l)}finally{if(c)throw c.error}}return[4,new Promise(function(t){return e=t})];case 1:return void 0===(a=p.sent())?[3,3]:[4,t(a.value)];case 2:p.sent(),p.label=3;case 3:return[2]}})},h.label=2;case 2:return i?[3,4]:[5,l()];case 3:return h.sent(),[3,2];case 4:return[2,n&&n.value];case 5:return s(),[4,Promise.race(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function ho(t){var e=this,r=oo(t,{yieldValues:!0});return new ao(function(t,s){return Ga(e,void 0,void 0,function(){var e,i,n,a=this;return ja(this,function(o){switch(o.label){case 0:if(!r.length)return s(),[2];e=[],i=!1,s.then(function(){var t,r;i=!0;try{for(var s=Ua(e),n=s.next();!n.done;n=s.next()){(0,n.value)()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,Promise.all(r.map(function(r,o){return Ga(a,void 0,void 0,function(){var a;return ja(this,function(l){switch(l.label){case 0:l.trys.push([0,,6,9]),l.label=1;case 1:return i?[3,5]:(Promise.resolve(r.next()).then(function(t){return e[o](t)},function(t){return s(t)}),[4,new Promise(function(t){e[o]=t})]);case 2:return void 0===(a=l.sent())?[3,4]:a.done?(n=a,[2]):[4,t(a.value)];case 3:l.sent(),l.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return r.return?[4,r.return()]:[3,8];case 7:l.sent(),l.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return o.sent(),[2,n&&n.value];case 3:return s(),[7];case 4:return[2]}})})})}function uo(t){var e=this,r=oo(t,{returnValues:!0});return new ao(function(t,s){return Ga(e,void 0,void 0,function(){var e,i,n,a;return ja(this,function(o){switch(o.label){case 0:if(!r.length)return s(),[2,[]];i=!1,s.then(function(){e(),i=!0}),o.label=1;case 1:o.trys.push([1,,6,8]),o.label=2;case 2:return i?[3,5]:(Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return s(t)}),[4,new Promise(function(t){return e=t})]);case 3:return void 0===(n=o.sent())?[2]:(a=n.map(function(t){return t.value}),n.some(function(t){return t.done})?[2,a]:[4,t(a)]);case 4:return o.sent(),[3,2];case 5:return[3,8];case 6:return s(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 7:return o.sent(),[7];case 8:return[2]}})})})}function co(t){var e=this,r=oo(t,{yieldValues:!0,returnValues:!0});return new ao(function(t,s){return Ga(e,void 0,void 0,function(){var e,i,n,a,o,l=this;return ja(this,function(h){switch(h.label){case 0:if(!r.length)return s(),[2,[]];i=[],n=!1,s.then(function(){var t,r;e();try{for(var s=Ua(i),a=s.next();!a.done;a=s.next()){(0,a.value)()}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}n=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return s(t)}),[4,new Promise(function(t){return e=t})];case 2:return void 0===(a=h.sent())?[2]:(o=a.map(function(t){return t.value}),a.every(function(t){return t.done})?[2,o]:[4,t(o.slice())]);case 3:return h.sent(),[4,Promise.all(r.map(function(e,r){return Ga(l,void 0,void 0,function(){var l;return ja(this,function(h){switch(h.label){case 0:if(a[r].done)return[2,a[r].value];h.label=1;case 1:return n?[3,4]:(Promise.resolve(e.next()).then(function(t){return i[r](t)},function(t){return s(t)}),[4,new Promise(function(t){return i[r]=t})]);case 2:return void 0===(l=h.sent())?[2,a[r].value]:l.done?[2,l.value]:(o[r]=l.value,[4,t(o.slice())]);case 3:return h.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return s(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function po(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var fo=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._extraRequestThreshold=262144},(e=[{key:"extraRequestThreshold",value:function(){return this._extraRequestThreshold}},{key:"setExtraRequestThreshold",value:function(t){if(t<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}}])&&po(t.prototype,e),r&&po(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();fo.global=new fo;const mo=fo;function yo(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var go;!function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error"}(go||(go={}));var vo=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},r=[{key:"debug",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[go.Debug].concat(e))}},{key:"info",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[go.Info].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[go.Warn].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[go.Error].concat(e))}},{key:"log",value:function(t){if(!(this.logLevel>t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];switch(t){case go.Debug:var i;(i=console).debug.apply(i,r);break;case go.Info:var n;(n=console).info.apply(n,r);break;case go.Warn:var a;(a=console).warn.apply(a,r);break;case go.Error:var o;(o=console).error.apply(o,r)}}}}],(e=null)&&yo(t.prototype,e),r&&yo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();vo.logLevel=go.Warn;const bo=vo;function So(t){"@babel/helpers - typeof";return(So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _o(){_o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,s){var i=e&&e.prototype instanceof c?e:c,n=Object.create(i.prototype),a=new w(s||[]);return n._invoke=function(t,e,r){var s="suspendedStart";return function(i,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw n;return M()}for(r.method=i,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var l=h(t,e,r);if("normal"===l.type){if(s=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,i,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==e&&r.call(y,i)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var s;this._invoke=function(i,n){function a(){return new e(function(s,a){!function s(i,n,a,o){var l=h(t[i],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==So(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return s("throw",t,a,o)})}o(l.arg)}(i,n,s,a)})}return s=s?s.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var s=h(r,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,u;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function e(){for(;++s<t.length;)if(r.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,s,i,n){void 0===n&&(n=Promise);var a=new b(l(e,r,s,i),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,i,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var s=e.pop();if(s in t)return r.value=s,r.done=!1,r}return r.done=!0,r}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(r,s){return a.type="throw",a.arg=t,e.next=r,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if("throw"===s.type){var i=s.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function xo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var s,i,n=[],a=!0,o=!1;try{for(r=r.call(t);!(a=(s=r.next()).done)&&(n.push(s.value),!e||n.length!==e);a=!0);}catch(t){o=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return wo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function Ao(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mo(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Co(t){var e,r;function s(e,r){try{var n=t[e](r),a=n.value,o=a instanceof Eo;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return s(l,r);r=t[l](r).value}i(n.done?"return":"normal",r)},function(t){s("throw",t)})}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?s(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise(function(n,a){var o={key:t,arg:i,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,s(t,i))})},"function"!=typeof t.return&&(this.return=void 0)}function Eo(t,e){this.v=t,this.k=e}Co.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Co.prototype.next=function(t){return this._invoke("next",t)},Co.prototype.throw=function(t){return this._invoke("throw",t)},Co.prototype.return=function(t){return this._invoke("return",t)};var To=40;function Oo(t,e){e=Math.min(Math.max(+e,2),65535);var r=t,s=r;do{s+=r=Math.ceil(r/e)}while(1!==r);return s*To}function Po(t,e){if(e<2)throw new Error("Node size must be at least 2");if(0===t)throw new Error("Number of items must be greater than 0");var r=t,s=r,i=[r];do{s+=r=Math.ceil(r/e),i.push(r)}while(1!==r);var n=[];r=s;for(var a=0,o=i;a<o.length;a++){var l=o[a];n.push(r-l),r-=l}for(var h=[],u=0;u<i.length;u++)h.push([n[u],n[u]+i[u]]);return h}function Lo(t,e,r,s){return Io.apply(this,arguments)}function Io(){var t;return t=_o().mark(function t(e,r,s,i){var n,a,o,l,h,u,c,d,p,f;return _o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=function(){return t=function t(e,r){Ao(this,t),this._level=r,this.nodes=e},(e=[{key:"level",value:function(){return this._level}},{key:"startNodeIdx",value:function(){return this.nodes[0]}},{key:"endNodeIdx",value:function(){return this.nodes[1]}},{key:"extendEndNodeIdx",value:function(t){console.assert(t>this.nodes[1]),this.nodes[1]=t}},{key:"toString",value:function(){return"[NodeRange level: ".concat(this._level,", nodes: ").concat(this.nodes[0],"-").concat(this.nodes[1],"]")}}])&&Mo(t.prototype,e),r&&Mo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}(),a=s.minX,o=s.minY,l=s.maxX,h=s.maxY,bo.info("tree items: ".concat(e,", nodeSize: ").concat(r)),u=Po(e,r),c=u[0][0],void 0,m=u.length-1,d=new n([0,1],m),p=[d],bo.debug("starting stream search with queue: ".concat(p,", numItems: ").concat(e,", nodeSize: ").concat(r,", levelBounds: ").concat(u)),f=_o().mark(function t(){var s,d,f,m,y,g,v,b,S;return _o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=p.shift(),bo.debug("popped node: ".concat(s,", queueLength: ").concat(p.length)),d=s.startNodeIdx(),f=d>=c,m=function(){var t=xo(u[s.level()],2)[1],e=Math.min(s.endNodeIdx()+r,t);return f&&e<t?e+1:e}(),y=m-d,t.next=8,new Eo(i(d*To,y*To),0);case 8:g=t.sent,v=new DataView(g),b=_o().mark(function t(r){var i,u,m,y,g,b,S,_,x,w;return _o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=(i=r-d)*To,!(l<v.getFloat64(u+0,!0))){t.next=4;break}return t.abrupt("return",0);case 4:if(!(h<v.getFloat64(u+8,!0))){t.next=6;break}return t.abrupt("return",0);case 6:if(!(a>v.getFloat64(u+16,!0))){t.next=8;break}return t.abrupt("return",0);case 8:if(!(o>v.getFloat64(u+24,!0))){t.next=10;break}return t.abrupt("return",0);case 10:if(m=v.getBigUint64(u+32,!0),!f){t.next=18;break}return y=m,g=function(){if(r<e-1){var t=(i+1)*To;return v.getBigUint64(t+32,!0)-y}return null}(),b=r-c,t.next=17,[Number(y),b,Number(g)];case 17:return t.abrupt("return",0);case 18:if(S=m,_=mo.global.extraRequestThreshold()/To,!(void 0!==(x=p[p.length-1])&&x.level()==s.level()-1&&S<x.endNodeIdx()+_)){t.next=25;break}return bo.debug('Merging "nodeRange" request into existing range: '.concat(x,", newEndNodeIdx: ").concat(x.endNodeIdx()," -> ").concat(S)),x.extendEndNodeIdx(Number(S)),t.abrupt("return",0);case 25:void 0,void 0,A=s.level()-1,M=[Number(S),Number(S)+1],w=new n(M,A),void 0!==x&&x.level()==w.level()?bo.info("Same level, but too far away. Pushing new request for nodeIdx: ".concat(S," rather than merging with distant ").concat(x)):bo.info("Pushing new level for ".concat(w," onto queue with nearestNodeRange: ").concat(x," since there's not already a range for this level.")),p.push(w);case 28:case"end":return t.stop()}var A,M},t)}),S=d;case 12:if(!(S<m)){t.next=20;break}return t.delegateYield(b(S),"t0",14);case 14:if(0!==t.t0){t.next=17;break}return t.abrupt("continue",17);case 17:S++,t.next=12;break;case 20:case"end":return t.stop()}},t)});case 9:if(0==p.length){t.next=13;break}return t.delegateYield(f(),"t0",11);case 11:t.next=9;break;case 13:case"end":return t.stop()}var m},t)}),(Io=function(){return new Co(t.apply(this,arguments))}).apply(this,arguments)}var No=new Uint8Array([102,103,98,3,102,103,98,0]),ko=4;function Ro(t){"@babel/helpers - typeof";return(Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Do(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Bo(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var s=0,i=function(){};return{s:i,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){o=!0,n=t},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw n}}}}function Fo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var s,i,n=[],a=!0,o=!1;try{for(r=r.call(t);!(a=(s=r.next()).done)&&(n.push(s.value),!e||n.length!==e);a=!0);}catch(t){o=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}return n}(t,e)||Bo(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bo(t,e){if(t){if("string"==typeof t)return Go(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Go(t,e):void 0}}function Go(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function jo(){jo=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,s){var i=e&&e.prototype instanceof c?e:c,n=Object.create(i.prototype),a=new w(s||[]);return n._invoke=function(t,e,r){var s="suspendedStart";return function(i,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw n;return M()}for(r.method=i,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var l=h(t,e,r);if("normal"===l.type){if(s=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,i,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==e&&r.call(y,i)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var s;this._invoke=function(i,n){function a(){return new e(function(s,a){!function s(i,n,a,o){var l=h(t[i],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==Ro(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return s("throw",t,a,o)})}o(l.arg)}(i,n,s,a)})}return s=s?s.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var s=h(r,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,u;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function e(){for(;++s<t.length;)if(r.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,s,i,n){void 0===n&&(n=Promise);var a=new b(l(e,r,s,i),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,i,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var s=e.pop();if(s in t)return r.value=s,r.done=!1,r}return r.done=!0,r}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(r,s){return a.type="throw",a.arg=t,e.next=r,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if("throw"===s.type){var i=s.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function Uo(t,e,r,s,i,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(s,i)}function Jo(t){return function(){var e=this,r=arguments;return new Promise(function(s,i){var n=t.apply(e,r);function a(t){Uo(n,s,i,a,o,"next",t)}function o(t){Uo(n,s,i,a,o,"throw",t)}a(void 0)})}}function zo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qo(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Vo(t,e,r){return e&&qo(t.prototype,e),r&&qo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ho(t){return function(){return new Wo(t.apply(this,arguments))}}function Wo(t){var e,r;function s(e,r){try{var n=t[e](r),a=n.value,o=a instanceof Xo;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return s(l,r);r=t[l](r).value}i(n.done?"return":"normal",r)},function(t){s("throw",t)})}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?s(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise(function(n,a){var o={key:t,arg:i,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,s(t,i))})},"function"!=typeof t.return&&(this.return=void 0)}function Qo(t){return new Xo(t,0)}function Yo(t){var e={},r=!1;function s(e,s){return r=!0,{done:!1,value:new Xo(s=new Promise(function(r){r(t[e](s))}),1)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(t){return r?(r=!1,t):s("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(r)throw r=!1,t;return s("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return r?(r=!1,t):s("return",t)}),e}function Xo(t,e){this.v=t,this.k=e}function Zo(t){var e,r,s,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,s=Symbol.iterator);i--;){if(r&&null!=(e=t[r]))return e.call(t);if(s&&null!=(e=t[s]))return new Ko(e.call(t));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Ko(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(Ko=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new Ko(t)}Wo.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Wo.prototype.next=function(t){return this._invoke("next",t)},Wo.prototype.throw=function(t){return this._invoke("throw",t)},Wo.prototype.return=function(t){return this._invoke("return",t)};var $o=function(){function t(e,r,s,i,n){zo(this,t),this.headerClient=e,this.header=r,this.headerLength=s,this.indexLength=i,this.nocache=n}return Vo(t,[{key:"selectBbox",value:function(t){var e=this;return Ho(jo().mark(function r(){var s,i,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S;return jo().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:s=e.lengthBeforeTree(),i=e.headerClient,n=function(){var t=Jo(jo().mark(function t(e,r){var n;return jo().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,t.abrupt("return",i.getRange(s+e,r,n,"index"));case 2:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}(),a=[],o=[],l=!1,h=!1,r.prev=7,c=Zo(Lo(e.header.featuresCount,e.header.indexNodeSize,t,n));case 9:return r.next=11,Qo(c.next());case 11:if(!(l=!(d=r.sent).done)){r.next=26;break}if(p=d.value,f=Fo(p,2),m=f[0],y=Fo(p,3),(g=y[2])||(bo.info("final feature"),g=4),0!=o.length){r.next=19;break}return o.push([m,g]),r.abrupt("continue",23);case 19:v=o[o.length-1],(b=m-(v[0]+v[1]))>mo.global.extraRequestThreshold()&&(bo.info("Pushing new feature batch, since gap ".concat(b," was too large")),a.push(o),o=[]),o.push([m,g]);case 23:l=!1,r.next=9;break;case 26:r.next=32;break;case 28:r.prev=28,r.t0=r.catch(7),h=!0,u=r.t0;case 32:if(r.prev=32,r.prev=33,!l||null==c.return){r.next=37;break}return r.next=37,Qo(c.return());case 37:if(r.prev=37,!h){r.next=40;break}throw u;case 40:return r.finish(37);case 41:return r.finish(32);case 42:return e.headerClient.logUsage("header+index"),o.length>0&&a.push(o),S=a.flatMap(function(t){return e.readFeatureBatch(t,e.nocache)}),r.delegateYield(Yo(Zo(ao.merge(S))),"t1",46);case 46:case"end":return r.stop()}},r,null,[[7,28,32,42],[33,,37,41]])}))()}},{key:"lengthBeforeTree",value:function(){return No.length+ko+this.headerLength}},{key:"lengthBeforeFeatures",value:function(){return this.lengthBeforeTree()+this.indexLength}},{key:"buildFeatureClient",value:function(t){return new tl(this.headerClient.httpClient,t)}},{key:"readFeatureBatch",value:function(t,e){var r=this;return Ho(jo().mark(function s(){var i,n,a,o,l,h,u,c,d,p,f,m;return jo().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=Fo(t[0],1),n=i[0],a=Fo(t[t.length-1],2),o=a[0],l=a[1],h=o+l-n,u=r.buildFeatureClient(e),c=h,d=Do(t),s.prev=8,d.s();case 10:if((p=d.n()).done){s.next=19;break}return f=Fo(p.value,1),m=f[0],s.next=14,Qo(r.readFeature(u,m,c));case 14:return s.next=16,s.sent;case 16:c=0;case 17:s.next=10;break;case 19:s.next=24;break;case 21:s.prev=21,s.t0=s.catch(8),d.e(s.t0);case 24:return s.prev=24,d.f(),s.finish(24);case 27:u.logUsage("feature");case 28:case"end":return s.stop()}},s,null,[[8,21,24,27]])}))()}},{key:"readFeature",value:function(){var t=Jo(jo().mark(function t(e,r,s){var i,n,a,o,l,h,u;return jo().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=r+this.lengthBeforeFeatures(),t.next=3,e.getRange(i,4,s,"feature length");case 3:return a=t.sent,n=new DataView(a).getUint32(0,!0),t.next=7,e.getRange(i+4,n,s,"feature data");case 7:return o=t.sent,l=new Uint8Array(o),(h=new Uint8Array(n+ko)).set(l,ko),(u=new ga(h)).setPosition(ko),t.abrupt("return",Ea.getRootAsFeature(u));case 14:case"end":return t.stop()}},t,this)}));return function(e,r,s){return t.apply(this,arguments)}}()}],[{key:"open",value:function(){var e=Jo(jo().mark(function e(r,s){var i,n,a,o,l,h,u,c,d,p,f;return jo().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=2024,n=new tl(r,s),a=function(){var t,e=0;for(t=0;t<3;t++){e+=Math.pow(16,t)*To}return e}(),o=i+a,bo.debug("fetching header. minReqLength: ".concat(o," (assumedHeaderLength: ").concat(i,", assumedIndexLength: ").concat(a,")")),e.t0=Uint8Array,e.next=8,n.getRange(0,8,o,"header");case 8:if(e.t1=e.sent,(l=new e.t0(e.t1)).subarray(0,3).every(function(t,e){return No[e]===t})){e.next=13;break}throw bo.error("bytes: ".concat(l," != ").concat(No)),new Error("Not a FlatGeobuf file");case 13:return bo.debug("magic bytes look good"),e.next=16,n.getRange(8,4,o,"header");case 16:if(u=e.sent,!((h=new DataView(u).getUint32(0,!0))>10485760||h<8)){e.next=21;break}throw new Error("Invalid header size");case 21:return bo.debug("headerLength: ".concat(h)),e.next=24,n.getRange(12,h,o,"header");case 24:return c=e.sent,d=new ga(new Uint8Array(c)),p=Fa(d),f=Oo(p.featuresCount,p.indexNodeSize),bo.debug("completed: opening http reader"),e.abrupt("return",new t(n,p,h,f,s));case 30:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()}])}(),tl=function(){return Vo(function t(e,r){if(zo(this,t),this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,"string"==typeof e)this.httpClient=new el(e,r);else{if(!(e instanceof el))throw new Error("Unknown source ");this.httpClient=e}},[{key:"getRange",value:function(){var t=Jo(jo().mark(function t(e,r,s,i){var n,a,o;return jo().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.bytesEverUsed+=r,n=e-this.head,a=n+r,!(n>=0&&a<=this.buffer.byteLength)){t.next=5;break}return t.abrupt("return",this.buffer.slice(n,a));case 5:return o=Math.max(r,s),this.bytesEverFetched+=o,bo.debug("requesting for new Range: ".concat(e,"-").concat(e+o-1)),t.next=10,this.httpClient.getRange(e,o,i);case 10:return this.buffer=t.sent,this.head=e,t.abrupt("return",this.buffer.slice(0,r));case 13:case"end":return t.stop()}},t,this)}));return function(e,r,s,i){return t.apply(this,arguments)}}()},{key:"logUsage",value:function(t){var e=t.split(" ")[0],r=this.bytesEverUsed,s=this.bytesEverFetched,i=(100*r/s).toFixed(2);bo.info("".concat(e," bytes used/requested: ").concat(r," / ").concat(s," = ").concat(i,"%"))}}])}(),el=function(){return Vo(function t(e,r){zo(this,t),this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e,this.nocache=r},[{key:"getRange",value:function(){var t=Jo(jo().mark(function t(e,r,s){var i,n,a;return jo().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.requestsEverMade+=1,this.bytesEverRequested+=r,i="bytes=".concat(e,"-").concat(e+r-1),bo.info("request: #".concat(this.requestsEverMade,", purpose: ").concat(s,"), bytes: (this_request: ").concat(r,", ever: ").concat(this.bytesEverRequested,"), Range: ").concat(i)),n={Range:i},this.nocache&&(n["Cache-Control"]="no-cache, no-store"),t.next=8,fetch(this.url,{headers:n});case 8:return a=t.sent,t.abrupt("return",a.arrayBuffer());case 10:case"end":return t.stop()}},t,this)}));return function(e,r,s){return t.apply(this,arguments)}}()}])}();function rl(t){"@babel/helpers - typeof";return(rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sl(){sl=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,s){var i=e&&e.prototype instanceof c?e:c,n=Object.create(i.prototype),a=new w(s||[]);return n._invoke=function(t,e,r){var s="suspendedStart";return function(i,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw n;return M()}for(r.method=i,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var l=h(t,e,r);if("normal"===l.type){if(s=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,i,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==e&&r.call(y,i)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var s;this._invoke=function(i,n){function a(){return new e(function(s,a){!function s(i,n,a,o){var l=h(t[i],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==rl(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return s("throw",t,a,o)})}o(l.arg)}(i,n,s,a)})}return s=s?s.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var s=h(r,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,u;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function e(){for(;++s<t.length;)if(r.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,s,i,n){void 0===n&&(n=Promise);var a=new b(l(e,r,s,i),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,i,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var s=e.pop();if(s in t)return r.value=s,r.done=!1,r}return r.done=!0,r}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(r,s){return a.type="throw",a.arg=t,e.next=r,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if("throw"===s.type){var i=s.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function il(t,e,r,s,i,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(s,i)}function nl(t){return function(){var e=this,r=arguments;return new Promise(function(s,i){var n=t.apply(e,r);function a(t){il(n,s,i,a,o,"next",t)}function o(t){il(n,s,i,a,o,"throw",t)}a(void 0)})}}function al(t){var e,r,s,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,s=Symbol.iterator);i--;){if(r&&null!=(e=t[r]))return e.call(t);if(s&&null!=(e=t[s]))return new ol(e.call(t));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function ol(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(ol=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new ol(t)}function ll(t){return new cl(t,0)}function hl(t){return function(){return new ul(t.apply(this,arguments))}}function ul(t){var e,r;function s(e,r){try{var n=t[e](r),a=n.value,o=a instanceof cl;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return s(l,r);r=t[l](r).value}i(n.done?"return":"normal",r)},function(t){s("throw",t)})}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?s(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise(function(n,a){var o={key:t,arg:i,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,s(t,i))})},"function"!=typeof t.return&&(this.return=void 0)}function cl(t,e){this.v=t,this.k=e}function dl(){return(dl=hl(sl().mark(function t(e,r,s){var i,n,a,o,l,h,u,c,d,p;return sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i="function"==typeof(f=e).slice?f:new Ia("function"==typeof f.read?f:f.getReader()),n=function(){var t=nl(sl().mark(function t(e){return sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.slice(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),t.t0=Uint8Array,t.next=5,ll(n(8,"magic bytes"));case 5:if(t.t1=t.sent,(a=new t.t0(t.t1)).subarray(0,3).every(function(t,e){return No[e]===t})){t.next=9;break}throw new Error("Not a FlatGeobuf file");case 9:return t.t2=Uint8Array,t.next=12,ll(n(4,"header length"));case 12:return t.t3=t.sent,a=new t.t2(t.t3),o=new ga(a),l=o.readUint32(0),t.t4=Uint8Array,t.next=19,ll(n(l,"header data"));case 19:if(t.t5=t.sent,a=new t.t4(t.t5),o=new ga(a),h=Fa(o),s&&s(h),u=h.indexNodeSize,c=h.featuresCount,!(u>0)){t.next=29;break}return d=Oo(c,u),t.next=29,ll(n(d,"entire index, w/o rect"));case 29:return t.next=31,ll(fl(n,h,r));case 31:if(!(p=t.sent)){t.next=36;break}return t.next=34,p;case 34:t.next=29;break;case 36:case"end":return t.stop()}var f},t)}))).apply(this,arguments)}function pl(){return(pl=hl(function(t,e,r,s){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return sl().mark(function n(){var a,o,l,h,u,c,d;return sl().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,ll($o.open(t,i));case 2:a=n.sent,bo.debug("opened reader"),s&&s(a.header),o=!1,l=!1,n.prev=7,u=al(a.selectBbox(e));case 9:return n.next=11,ll(u.next());case 11:if(!(o=!(c=n.sent).done)){n.next=18;break}return d=c.value,n.next=15,r(d,a.header);case 15:o=!1,n.next=9;break;case 18:n.next=24;break;case 20:n.prev=20,n.t0=n.catch(7),l=!0,h=n.t0;case 24:if(n.prev=24,n.prev=25,!o||null==u.return){n.next=29;break}return n.next=29,ll(u.return());case 29:if(n.prev=29,!l){n.next=32;break}throw h;case 32:return n.finish(29);case 33:return n.finish(24);case 34:case"end":return n.stop()}},n,null,[[7,20,24,34],[25,,29,33]])})()})).apply(this,arguments)}function fl(t,e,r){return ml.apply(this,arguments)}function ml(){return(ml=nl(sl().mark(function t(e,r,s){var i,n,a,o,l;return sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,e(4,"feature length");case 3:if(t.t1=t.sent,0!==(i=new t.t0(t.t1)).byteLength){t.next=7;break}return t.abrupt("return");case 7:return n=new ga(i),a=n.readUint32(0),t.t2=Uint8Array,t.next=12,e(a,"feature data");case 12:return t.t3=t.sent,i=new t.t2(t.t3),(o=new Uint8Array(a+4)).set(i,4),(n=new ga(o)).setPosition(ko),l=Ea.getRootAsFeature(n),t.abrupt("return",s(l,r));case 20:case"end":return t.stop()}},t)}))).apply(this,arguments)}function yl(t,e){return{type:"FeatureCollection",features:function(t,e,r){if(!t.subarray(0,3).every(function(t,e){return No[e]===t}))throw new Error("Not a FlatGeobuf file");var s=new ga(t),i=s.readUint32(No.length);s.setPosition(No.length+ko);var n=Fa(s);r&&r(n);var a=No.length+ko+i,o=n.indexNodeSize,l=n.featuresCount;o>0&&(a+=Oo(l,o));for(var h=[];a<s.capacity();){var u=s.readUint32(a);s.setPosition(a+ko);var c=Ea.getRootAsFeature(s);h.push(e(c,n)),a+=ko+u}return h}(t,Pa,e)}}function gl(t,e){return function(t,e,r){return dl.apply(this,arguments)}(t,Pa,e)}function vl(t,e,r){return function(t,e,r,s){return pl.apply(this,arguments)}(t,e,Pa,r,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}function bl(t,e,r){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t instanceof Uint8Array?yl(t,r):t instanceof ReadableStream?gl(t,r):vl(t,e,r,s)}ul.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},ul.prototype.next=function(t){return this._invoke("next",t)},ul.prototype.throw=function(t){return this._invoke("throw",t)},ul.prototype.return=function(t){return this._invoke("return",t)};var Sl=r(519),_l=r.n(Sl);function xl(t){"@babel/helpers - typeof";return(xl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wl(){wl=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,s){var i=e&&e.prototype instanceof c?e:c,n=Object.create(i.prototype),a=new w(s||[]);return n._invoke=function(t,e,r){var s="suspendedStart";return function(i,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw n;return M()}for(r.method=i,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var l=h(t,e,r);if("normal"===l.type){if(s=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,i,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==e&&r.call(y,i)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var s;this._invoke=function(i,n){function a(){return new e(function(s,a){!function s(i,n,a,o){var l=h(t[i],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==xl(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return s("throw",t,a,o)})}o(l.arg)}(i,n,s,a)})}return s=s?s.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var s=h(r,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,u;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function e(){for(;++s<t.length;)if(r.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,s,i,n){void 0===n&&(n=Promise);var a=new b(l(e,r,s,i),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,i,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var s=e.pop();if(s in t)return r.value=s,r.done=!1,r}return r.done=!0,r}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(r,s){return a.type="throw",a.arg=t,e.next=r,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if("throw"===s.type){var i=s.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function Al(t,e,r,s,i,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(s,i)}function Ml(t){return function(){var e=this,r=arguments;return new Promise(function(s,i){var n=t.apply(e,r);function a(t){Al(n,s,i,a,o,"next",t)}function o(t){Al(n,s,i,a,o,"throw",t)}a(void 0)})}}function Cl(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function El(t){var e,r,s,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,s=Symbol.iterator);i--;){if(r&&null!=(e=t[r]))return e.call(t);if(s&&null!=(e=t[s]))return new Tl(e.call(t));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Tl(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(Tl=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new Tl(t)}var Ol={1:"circle",2:"line",3:"fill",5:"line",4:"circle",6:"fill",MultiPolygon:"fill",Point:"circle",MultiLineString:"line",MultiPoint:"circle",LineString:"line",Polygon:"fill"},Pl=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.layerID?e.layerID:v.createUniqueID("FGBLayer_"),this.layerId=this.id+"outer",this.sourceId=this.layerId,this.options=e,this.strategy=e.strategy||"bbox",this.url=e.url,this.layerType="",this.extent=e.extent,this.init()},(e=[{key:"init",value:function(){"bbox"===this.strategy&&(this.loadedExtentsRtree_=new(_l()))}},{key:"iterateFeatures",value:function(){var t=Ml(wl().mark(function t(e){var r,s,i,n,a,o,l;return wl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r={type:"FeatureCollection",features:[]},s=!1,i=!1,t.prev=3,a=El(e);case 5:return t.next=7,a.next();case 7:if(!(s=!(o=t.sent).done)){t.next=15;break}l=o.value,this.options.featureLoader&&"function"==typeof this.options.featureLoader&&(l=this.options.featureLoader(l)),this.layerType||(this.layerType=Ol[l.geometry.type]),r.features.push(l);case 12:s=!1,t.next=5;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),i=!0,n=t.t0;case 21:if(t.prev=21,t.prev=22,!s||null==a.return){t.next=26;break}return t.next=26,a.return();case 26:if(t.prev=26,!i){t.next=29;break}throw n;case 29:return t.finish(26);case 30:return t.finish(21);case 31:return t.abrupt("return",r);case 32:case"end":return t.stop()}},t,this,[[3,17,21,31],[22,,26,30]])}));return function(e){return t.apply(this,arguments)}}()},{key:"_loadData",value:function(){var t=Ml(wl().mark(function t(e){var r,s,i=this;return wl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},e.length){t.next=7;break}return t.next=4,this._getStream(this.url);case 4:r=t.sent,t.next=9;break;case 7:s.value={extent:e.slice()},this.loadedExtentsRtree_.insert(s);case 9:return t.next=11,bl(r&&r.body||this.url,s,function(t){i.layerType=Ol[t.geometryType]});case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_getStream",value:function(){var t=Ml(wl().mark(function t(e){return wl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Jt.get(e,{},{withoutFormatSuffix:!0}).then(function(t){return t});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"_containsExtent",value:function(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}},{key:"_getInExtent",value:function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.loadedExtentsRtree_.search(e).map(function(t){return t.value})}},{key:"_forEachInExtent",value:function(t,e){return this._forEach(this._getInExtent(t),e)}},{key:"_forEach",value:function(t,e){for(var r,s=0,i=t.length;s<i;s++)if(r=e(t[s]))return r;return r}}])&&Cl(t.prototype,e),r&&Cl(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function Ll(t){"@babel/helpers - typeof";return(Ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Il(){Il=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,s){var i=e&&e.prototype instanceof c?e:c,n=Object.create(i.prototype),a=new w(s||[]);return n._invoke=function(t,e,r){var s="suspendedStart";return function(i,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw n;return M()}for(r.method=i,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var l=h(t,e,r);if("normal"===l.type){if(s=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,i,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==e&&r.call(y,i)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var s;this._invoke=function(i,n){function a(){return new e(function(s,a){!function s(i,n,a,o){var l=h(t[i],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==Ll(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return s("throw",t,a,o)})}o(l.arg)}(i,n,s,a)})}return s=s?s.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var s=h(r,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,u;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function e(){for(;++s<t.length;)if(r.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,s,i,n){void 0===n&&(n=Promise);var a=new b(l(e,r,s,i),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,i,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var s=e.pop();if(s in t)return r.value=s,r.done=!1,r}return r.done=!0,r}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(r,s){return a.type="throw",a.arg=t,e.next=r,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if("throw"===s.type){var i=s.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function Nl(t,e,r,s,i,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(s,i)}function kl(t){return function(){var e=this,r=arguments;return new Promise(function(s,i){var n=t.apply(e,r);function a(t){Nl(n,s,i,a,o,"next",t)}function o(t){Nl(n,s,i,a,o,"throw",t)}a(void 0)})}}function Rl(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var Dl={circle:{"circle-radius":6,"circle-color":"#3fb1e3","circle-opacity":1,"circle-blur":0,"circle-translate":[0,0],"circle-stroke-width":0,"circle-stroke-color":"#000","circle-stroke-opacity":1},line:{"line-opacity":1,"line-color":"#3fb1e3","line-width":3,"line-blur":1},fill:{"fill-opacity":.8,"fill-color":"#3fb1e3","fill-translate":[0,0],"fill-antialias":!0,"fill-outline-color":"#3fb1e3"}},Fl=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.layerID?e.layerID:v.createUniqueID("FGBLayer_"),this.layerId=this.id+"outer",this.sourceId=this.layerId,this.options=e,this.strategy=e.strategy||"bbox",this.url=e.url,this.layerType="",this.type="custom",this.renderingMode="3d",this.overlay=!0,this.extent=e.extent,this._updateFeaturesFn=this._updateFeatures.bind(this)},(e=[{key:"onAdd",value:function(t){this.map=t;var e=[];if("bbox"===this.strategy){var r=this.map.getBounds().toArray();e=[r[0][0],r[0][1],r[1][0],r[1][1]],this.map.on("moveend",this._updateFeaturesFn)}if(this.extent){var s=function(t,e){const r=[];return function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(t,e)&&(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]),r}(this.extent,e);e=s&&s.length?s:this.extent}this.renderer=new Pl(this.options),this._handleFeatures(e)}},{key:"render",value:function(){}},{key:"onRemove",value:function(){this.map.off("moveend",this._updateFeaturesFn)}},{key:"moveLayer",value:function(t,e){this.map.moveLayer(t,e)}},{key:"setVisibility",value:function(t){var e=t?"visible":"none";this.map.setLayoutProperty(this.layerId,"visibility",e)}},{key:"_handleFeatures",value:function(){var t=kl(Il().mark(function t(e){var r,s,i;return Il().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.renderer._loadData(e);case 2:return r=t.sent,t.next=5,this.renderer.iterateFeatures(r);case 5:s=t.sent,this.map.getSource(this.sourceId)?this.map.getSource(this.sourceId).setData(s):this.map.addSource(this.sourceId,{type:"geojson",data:s}),this.map.getLayer(this.layerId)||(this.layerType=this.renderer.layerType,i=Object.assign({id:this.layerId,type:this.layerType,source:this.sourceId,paint:Object.assign(Dl[this.layerType],this.options.paint)||{},layout:this.options.layout||{}}),this.map.addLayer(i));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(){var t=kl(Il().mark(function t(){var e,r,s,i,n=this;return Il().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.map.getBounds().toArray(),r=[e[0][0],e[0][1],e[1][0],e[1][1]],this.renderer._forEachInExtent(r,function(t){return n.renderer._containsExtent(t.extent,r)})){t.next=11;break}return t.next=6,this.renderer._loadData(r);case 6:return s=t.sent,t.next=9,this.renderer.iterateFeatures(s);case 9:i=t.sent,this.map.getSource(this.sourceId).setData(i);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}])&&Rl(t.prototype,e),r&&Rl(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();const Bl=class{constructor(t){this.map=t}addLayer(t,e,r){t.paint&&Object.assign(e.paint||{},t.paint),t.layout&&Object.assign(e.layout||{},t.layout),this.map.addLayerBySymbolBak({...t,...e},r)}};const Gl=class{constructor(t){this.map=t,this.singleSymbol=new Bl(t),this.layerIds={}}addLayer(t,e,r){e.forEach(e=>{const s=v.createUniqueID(`${t.id}_compositeLayer_`);this.singleSymbol.addLayer({...t,id:s},e,r),this.addLayerId(t.id,s)})}addLayerId(t,e){this.layerIds[t]||(this.layerIds[t]=[]),!this.layerIds[t].includes(e)&&this.layerIds[t].push(e)}removeLayerId(t){delete this.layerIds[t]}getLayerIds(t){return this.layerIds[t]}getLayerId(t){for(const e in this.layerIds)if(this.layerIds[e].find(e=>e===t))return e}};const jl=class{constructor(){this.symbols={},this.images={}}addSymbol(t,e){e.layout&&delete e.layout.visibility,this.symbols[t]=e}getSymbol(t){return this.symbols[t]&&JSON.parse(JSON.stringify(this.symbols[t]))}removeSymbol(t){delete this.symbols[t]}addImageInfo(t,e){this.images[t]=e}getImageInfo(t){return this.images[t]}},Ul={circle:"circle",symbol:"symbol",line:"line",fill:"fill"},Jl=[{prefix:"line-",type:Ul.line},{prefix:"fill-",type:Ul.fill},{prefix:"circle-",type:Ul.circle}];function zl(t){return t&&t.length>0}function ql(t){const e=function(t){const{paint:e={},layout:r={}}=t,s=Object.keys(e).concat(Object.keys(r));let i;for(const t of Jl){const e=s.some(e=>e.startsWith(t.prefix));if(e){i=t.type;break}}return i||Ul.symbol}(t);return{[Ul.symbol]:{type:"layout",name:"icon-image"},[Ul.line]:{type:"paint",name:"line-pattern"},[Ul.fill]:{type:"paint",name:"fill-pattern"}}[e]}const Vl=["array","boolean","collator","format","literal","number","object","string","to-boolean","to-color","to-number","to-string","typeof","feature-state","geometry-type","id","line-progress","properties","at","get","has","length","!","!=","<","<=","==",">",">=","all","any","case","match","coalesce","interpolate","interpolate-hcl","interpolate-lab","step","let","var","concat","downcase","is-supported-script","resolved-locale","upcase","rgb","rgba","-","*","/","%","^","+","abs","acos","asin","atan","ceil","cos","e","floor","ln","ln2","log10","log2","max","min","pi","round","sin","sqrt","tan","zoom","heatmap-density"];function Hl(t){if(t&&t.length>0){const[e]=t;return"string"==typeof e&&Vl.includes(e)}return!1}function Wl(t){return Object.keys(t).every(e=>!Hl(t[e]))}function Ql(t){return(zl(t)?t:[t]).every(t=>Wl(t.paint||{})&&Wl(t.layout||{}))}const Yl=t=>["icon-color","icon-opacity","icon-translate","line-opacity","line-blur","line-translate","line-color","line-width","line-offset","line-dasharray","line-pattern","fill-color","fill-opacity","fill-pattern","fill-outline-color","text-color","text-halo-blur","text-halo-color","text-halo-width","text-opacity","text-translate","text-translate-anchor","circle-blur","circle-color","circle-opacity","circle-translate","circle-radius","circle-stroke-color","circle-stroke-opacity","circle-stroke-width"].includes(t);const Xl=class{constructor(t){this.map=t,this.symbolManager=new jl,this.singleSymbolRender=new Bl(t),this.compositeSymbolRender=new Gl(t),this._layerSymbols={}}_update(t){return this.map=t,this}addLayer(t,e){if("string"==typeof t.symbol){const r=t.symbol;if(r){const s=this.getSymbol(r);if(!s)return this.map.fire("error",{error:new Error(`Symbol "${r}" could not be loaded. Please make sure you have added the symbol with map.addSymbol().`)});this.setSymbolTolayer(t.id,r),this.getSymbolRender(s).addLayer(t,s,e)}}else Hl(t.symbol)&&(this.setSymbolTolayer(t.id,t.symbol),this.addExpressionLayer(t,e))}setSymbol(t,e){const r=this.map.getStyle().layers,s=r.findIndex(e=>e.id===t);if(-1===s)return this.map.fire("error",{error:new Error(`Cannot set symbol "${e}" to non-existing layer "${t}".`)});this.map.removeLayer(t);const i=r[s+1]&&r[s+1].id,n=i&&this.map.style.getLayer(i),a=n&&n.id||i&&this.getFirstLayerId(i),o=r[s];this.addLayer({...o,paint:{},layout:{visibility:o.layout&&o.layout.visibility||"visible"},symbol:e},a)}getMatchLayers(t){const e=[],r=["all"];t.filter&&r.push(t.filter);const s=[],i=t.symbol.slice(2);return i.forEach((n,a)=>{a%2==1?(e.push({...t,filter:[...r,["==",t.symbol[1][1],i[a-1]]],symbol:n}),s.push(["!=",t.symbol[1][1],i[a-1]])):a===i.length-1&&e.unshift({...t,filter:[...r,...s],symbol:n})}),e}getCaseLayers(t){const e=[],r=["all"];t.filter&&r.push(t.filter);const s=[],i=t.symbol.slice(1);return i.forEach((n,a)=>{a%2==1?(e.push({...t,filter:[...r,i[a-1]],symbol:n}),s.push(["!",i[a-1]])):a===i.length-1&&e.unshift({...t,filter:[...r,...s],symbol:n})}),e}addExpressionLayer(t,e){const r={match:this.getMatchLayers,case:this.getCaseLayers}[t.symbol[0]],s=r&&r(t);if(!s)return this.map.fire("error",{error:new Error("This expressions not supported")});s.forEach(r=>{r.id=v.createUniqueID(`${t.id}_compositeLayer_`),this.compositeSymbolRender.addLayerId(t.id,r.id),this.addLayer(r,e)})}getSymbolRender(t){return zl(t)?this.compositeSymbolRender:this.singleSymbolRender}addSymbolImageToMap(t,e){const{type:r,name:s}=ql(t),i=t[r]&&t[r][s];i&&!this.map.hasImage(i)&&(this.map.addImage(i,e),this.symbolManager.addImageInfo(i,e))}addSymbol(t,e){return this.getSymbol(t)?this.map.fire("error",{error:new Error("An symbol with this name already exists.")}):Ql(e)?void this.symbolManager.addSymbol(t,e):this.map.fire("error",{error:new Error("Symbol is not supported expressions.")})}setSymbolTolayer(t,e){this._layerSymbols[t]=e}getLayerSymbol(t){return this._layerSymbols[t]}hasSymbol(){return Object.keys(this._layerSymbols).length>0}removeSymbol(t){this.symbolManager.removeSymbol(t)}getSymbol(t){return this.symbolManager.getSymbol(t)}getLayerIds(t){return this.compositeSymbolRender.getLayerIds(t)||[]}getLayerId(t){return this.compositeSymbolRender.getLayerId(t)}removeLayerId(t){return this.compositeSymbolRender.removeLayerId(t)}getLayer(t){const e=this.map.getLayerBySymbolBak(t),r=this.getLayerSymbol(t);if(e)return r?{...e,symbol:r}:e;{const e=this.getLayerIds(t);if(e[0]){const s=this.map.getLayerBySymbolBak(e[0]);return s&&{...s,symbol:r,id:t}}}}removeLayer(t){const e=this.getLayerIds(t);e.length>0?(e.forEach(t=>this.map.style.removeLayer(t)),this.removeLayerId(t)):this.map.style.removeLayer(t)}getStyle(){const t=this.map.style.serialize();return this.hasSymbol()&&(t.layers=t.layers.reduce((t,e)=>{const r=this.getLayerId(e.id);return r?!t.find(t=>t.id===r)&&t.push({...e,symbol:this.getLayerSymbol(r),id:r}):this.getLayerSymbol(e.id)?t.push({...e,symbol:this.getLayerSymbol(e.id)}):t.push(e),t},[])),t}getFirstLayerId(t){return this.getLayerIds(t)[0]}moveLayer(t,e){const r=this.getLayerIds(t),s=e&&this.map.style.getLayer(e),i=s&&s.id||e&&this.getFirstLayerId(e);r.length>0?r.forEach(t=>this.map.style.moveLayer(t,i)):this.map.style.moveLayer(t,i)}setFilter(t,e,r){if(Hl(this.getLayerSymbol(t))){const s=this.getFirstLayerId(t);this.map.style.setFilter(s,e,r);const i=this.getLayerSymbol(t);return void this.setSymbol(t,i)}const s=this.getLayerIds(t);s.length>0?s.forEach(t=>this.map.style.setFilter(t,e,r)):this.map.style.setFilter(t,e,r)}getFilter(t){const e=this.getFirstLayerId(t);if(this.map.style.getLayer(e))return this.map.style.getFilter(e)}setLayerZoomRange(t,e,r){const s=this.getLayerIds(t);s.length>0?s.forEach(t=>this.map.style.setLayerZoomRange(t,e,r)):this.map.style.setLayerZoomRange(t,e,r)}setPaintProperty(t,e,r,s){const i=this.getLayerIds(t);i.length>0?i.forEach(t=>this.map.style.setPaintProperty(t,e,r,s)):this.map.style.setPaintProperty(t,e,r,s)}getPaintProperty(t,e){const r=this.getFirstLayerId(t);return this.map.style.getPaintProperty(r,e)}setLayoutProperty(t,e,r,s){const i=this.getLayerIds(t);i.length>0?i.forEach(t=>this.map.style.setLayoutProperty(t,e,r,s)):this.map.style.setLayoutProperty(t,e,r,s)}getLayoutProperty(t,e){const r=this.getFirstLayerId(t);return this.map.style.getLayoutProperty(r,e)}updateLayerSymbol(t){Object.keys(this._layerSymbols).forEach(e=>{const r=this._layerSymbols[e];r.includes(t)&&this.setSymbol(e,r)})}updateSymbol(t,e){return this.getSymbol(t)?Ql(e)?(this.symbolManager.addSymbol(t,e),void this.updateLayerSymbol(t)):this.map.fire("error",{error:new Error("Symbol is not supported expressions.")}):this.map.fire("error",{error:new Error(`Symbol "${t}" could not be loaded. Please make sure you have added the symbol with map.addSymbol().`)})}setSymbolProperty(t,e,r,s){const i=this.getSymbol(t);if(!i)return this.map.fire("error",{error:new Error(`Symbol "${t}" could not be loaded. Please make sure you have added the symbol with map.addSymbol().`)});if(Hl(s))return this.map.fire("error",{error:new Error("Symbol value is not supported expressions.")});const n=Yl(r)?"paint":"layout";if(i.length>0){const t=i[e];if(!t)return this.map.fire("error",{error:new Error(`symbol[${e}] does not exist.`)});t[n]||(t[n]={}),Object.assign(t[n],{[r]:s})}else i[n]||(i[n]={}),Object.assign(i[n],{[r]:s});this.symbolManager.addSymbol(t,i),this.updateLayerSymbol(t)}getSymbolProperty(t,e,r){const s=this.getSymbol(t);if(!s)return void this.map.fire("error",{error:new Error(`Symbol "${t}" could not be loaded. Please make sure you have added the symbol with map.addSymbol().`)});const i=Yl(r)?"paint":"layout";return s.length>0?s[e]&&s[e][i]&&s[e][i][r]:s[i]&&s[i][r]}};const Zl=function(){const t=t=>(e().Map.prototype.symbolHandler||(e().Map.prototype.symbolHandler=new Xl(t)),e().Map.prototype.symbolHandler._update(t));function r(e,r){return async function(t,e){let r=`${e.basePath}/${t}/${t}`;const s=await Jt.get(`${r}.json`).then(t=>t.ok?t.json():null).catch(()=>null);if(!s)return null;const i=s.paint||{},n=s.layout||{};return{value:s,image:(i["fill-pattern"]||i["line-pattern"]||n["icon-image"])&&await new Promise(t=>{const e=new Image;e.src=`${r}.png`,e.onload=(r=>{t(r?e:null)}),e.onerror=(()=>{t(null)})})}}(e,r).then(e=>{if(!e)return null;const{value:s,image:i}=e;return i&&t(r).addSymbolImageToMap(s,i),s})}void 0===e().Map.prototype.addLayerBySymbolBak&&(e().Map.prototype.addLayerBySymbolBak=e().Map.prototype.addLayer,e().Map.prototype.addLayer=function(e,r){const s=t(this);if(!(s.getLayerIds(e.id).length>0))return e.symbol?(s.addLayer(e,r),this):(this.addLayerBySymbolBak(e,r),this);this.fire("error",{error:new Error("A layer with this id already exists.")})}),void 0===e().Map.prototype.getLayerBySymbolBak&&(e().Map.prototype.getLayerBySymbolBak=e().Map.prototype.getLayer,e().Map.prototype.getLayer=function(e){return t(this).getLayer(e)}),void 0===e().Map.prototype.moveLayerBySymbolBak&&(e().Map.prototype.moveLayerBySymbolBak=e().Map.prototype.moveLayer,e().Map.prototype.moveLayer=function(e,r){return!this.style.getLayer(e)||r&&!this.style.getLayer(r)?(t(this).moveLayer(e,r),this._update(!0)):this.moveLayerBySymbolBak(e,r)}),void 0===e().Map.prototype.removeLayerBySymbolBak&&(e().Map.prototype.removeLayerBySymbolBak=e().Map.prototype.removeLayer,e().Map.prototype.removeLayer=function(e){return this.style.getLayer(e)?this.removeLayerBySymbolBak(e):t(this).removeLayer(e)}),void 0===e().Map.prototype.setLayoutPropertyBySymbolBak&&(e().Map.prototype.setLayoutPropertyBySymbolBak=e().Map.prototype.setLayoutProperty,e().Map.prototype.setLayoutProperty=function(e,r,s,i){return this.overlayLayersManager[e]||this.style.getLayer(e)?this.setLayoutPropertyBySymbolBak(e,r,s,i):(t(this).setLayoutProperty(e,r,s,i),this._update(!0))}),e().Map.prototype.setSymbol=function(e,r){t(this).setSymbol(e,r)},e().Map.prototype.setStyleBak||(e().Map.prototype.setStyleBak=e().Map.prototype.setStyle,e().Map.prototype.setStyle=function(t,e){return this.setStyleBak(t,e),this.style&&this.style.once("style.load",()=>{t.layers.filter(t=>t.symbol).forEach(t=>{this.setSymbol(t.id,t.symbol)})}),this}),e().Map.prototype.loadSymbol=async function(t,e){if("string"==typeof t){const s=await r(t,this);let i=null;s||(i=`Symbol ${t} is not exists`),e(i,s)}else if(v.isArray(t)){const s=t.map(t=>r(t,this)),i=await Promise.all(s);let n=null;const a=t.filter((t,e)=>!i[e]);a.length>0&&(n=`Symbol ${a.join(",")} is not exists`),e(n,i)}else e({message:"Symbol id must be a string or string[]."})},e().Map.prototype.addSymbol=function(e,r){t(this).addSymbol(e,r)},e().Map.prototype.getSymbol=function(e){return t(this).getSymbol(e)},e().Map.prototype.hasSymbol=function(t){return t?!!this.getSymbol(t):(this.fire("error",{error:new Error("Missing required symbol id")}),!1)},e().Map.prototype.removeSymbol=function(e){t(this).removeSymbol(e)},e().Map.prototype.updateSymbol=function(e,r){t(this).updateSymbol(e,r)},e().Map.prototype.setSymbolProperty=function(e,r,s,i){t(this).setSymbolProperty(e,r,s,i)},e().Map.prototype.getSymbolProperty=function(e,r,s){return t(this).getSymbolProperty(e,r,s)},e().Map.prototype.getStyle=function(){if(this.style)return t(this).getStyle()},e().Map.prototype.setFilter=function(e,r,s){return this.style.getLayer(e)?(this.style.setFilter(e,r,s),this._update(!0)):(t(this).setFilter(e,r,s),this._update(!0))},e().Map.prototype.getFilter=function(e){return this.style.getLayer(e)?this.style.getFilter(e):t(this).getFilter(e)},e().Map.prototype.setLayerZoomRange=function(e,r,s){return this.style.getLayer(e)?(this.style.setLayerZoomRange(e,r,s),this._update(!0)):(t(this).setLayerZoomRange(e,r,s),this._update(!0))},e().Map.prototype.setPaintProperty=function(e,r,s,i){return this.style.getLayer(e)?(this.style.setPaintProperty(e,r,s,i),this._update(!0)):(t(this).setPaintProperty(e,r,s,i),this._update(!0))},e().Map.prototype.getPaintProperty=function(e,r){return this.style.getLayer(e)?this.style.getPaintProperty(e,r):t(this).getPaintProperty(e,r)},e().Map.prototype.getLayoutProperty=function(e,r){return this.style.getLayer(e)?this.style.getLayoutProperty(e,r):t(this).getLayoutProperty(e,r)},void 0===e().Map.prototype.onBak&&(e().Map.prototype.onBak=e().Map.prototype.on,e().Map.prototype.on=function(e,r,s){return void 0===s||this.style.getLayer(r)?this.onBak(e,r,s):(t(this).getLayerIds(r).forEach(t=>this.onBak(e,t,s)),this)}),void 0===e().Map.prototype.onceBak&&(e().Map.prototype.onceBak=e().Map.prototype.once,e().Map.prototype.once=function(e,r,s){return void 0===s||this.style.getLayer(r)?this.onceBak(e,r,s):(t(this).getLayerIds(r).forEach(t=>this.onceBak(e,t,s)),this)}),void 0===e().Map.prototype.offBak&&(e().Map.prototype.offBak=e().Map.prototype.off,e().Map.prototype.off=function(e,r,s){return void 0===s||this.style.getLayer(r)?this.offBak(e,r,s):(t(this).getLayerIds(r).forEach(t=>this.offBak(e,t,s)),this)})};class Kl{constructor(t,e,r){this.MapService=t,this.url=e,this.options=r,this.CLASS_NAME="SuperMap.InitMapServiceBase"}createMapService(){const t=this.MapService,e=this.url,r=this.options;return new t(e,{proxy:r.proxy,withCredentials:r.withCredentials,crossOrigin:r.crossOrigin,headers:r.headers,projection:r.projection})}getMapInfo(t){return new Promise((e,r)=>{this.createMapService().getMapInfo(s=>{t(s,e,r)})})}getWKT(){return new Promise((t,e)=>{this.createMapService().getWKT(r=>{try{const s=r.result.data;t(s)}catch(t){e(t)}})})}}function $l({scale:t,dpi:e,coordUnit:r},s){const i=function(t,e=22,r=512){var s=[];const i=Math.abs(t.left-t.right)/r;for(let t=0;t<e;t++)s.push(i/Math.pow(2,t));return s.sort(function(t,e){return e-t})}(s);return function(t,e){let r,s=0;for(let i=0;i<e.length;i++)0===i&&(r=Math.abs(t-e[i])),r>Math.abs(t-e[i])&&(r=Math.abs(t-e[i]),s=i);return s}(In(t,e,r),i)}var th=1,eh=2,rh=3,sh=4,ih=5,nh=6378137,ah=6356752.314,oh=.0066943799901413165,lh=484813681109536e-20,hh=Math.PI/2,uh=.16666666666666666,ch=.04722222222222222,dh=.022156084656084655,ph=1e-10,fh=.017453292519943295,mh=57.29577951308232,yh=Math.PI/4,gh=2*Math.PI,vh=3.14159265359,bh={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const Sh={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var _h=/[\s_\-\/\(\)]/g;function xh(t,e){if(t[e])return t[e];for(var r,s=Object.keys(t),i=e.toLowerCase().replace(_h,""),n=-1;++n<s.length;)if((r=s[n]).toLowerCase().replace(_h,"")===i)return t[r]}function wh(t){var e,r,s,i={},n=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t},{}),a={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t)},lat_0:function(t){i.lat0=t*fh},lat_1:function(t){i.lat1=t*fh},lat_2:function(t){i.lat2=t*fh},lat_ts:function(t){i.lat_ts=t*fh},lon_0:function(t){i.long0=t*fh},lon_1:function(t){i.long1=t*fh},lon_2:function(t){i.long2=t*fh},alpha:function(t){i.alpha=parseFloat(t)*fh},gamma:function(t){i.rectified_grid_angle=parseFloat(t)},lonc:function(t){i.longc=t*fh},x_0:function(t){i.x0=parseFloat(t)},y_0:function(t){i.y0=parseFloat(t)},k_0:function(t){i.k0=parseFloat(t)},k:function(t){i.k0=parseFloat(t)},a:function(t){i.a=parseFloat(t)},b:function(t){i.b=parseFloat(t)},r_a:function(){i.R_A=!0},zone:function(t){i.zone=parseInt(t,10)},south:function(){i.utmSouth=!0},towgs84:function(t){i.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){i.to_meter=parseFloat(t)},units:function(t){i.units=t;var e=xh(Sh,t);e&&(i.to_meter=e.to_meter)},from_greenwich:function(t){i.from_greenwich=t*fh},pm:function(t){var e=xh(bh,t);i.from_greenwich=(e||parseFloat(t))*fh},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(i.axis=t)},approx:function(){i.approx=!0}};for(e in n)r=n[e],e in a?"function"==typeof(s=a[e])?s(r):i[s]=r:i[e]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}const Ah=function(t){return new Lh(t).output()};var Mh=1,Ch=/\s/,Eh=/[A-Za-z]/,Th=/[A-Za-z84_]/,Oh=/[,\]]/,Ph=/[\d\.E\-\+]/;function Lh(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Mh}function Ih(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var s=e?{}:t,i=r.reduce(function(t,e){return Nh(e,t),t},s);e&&(t[e]=i)}function Nh(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void Nh(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var s;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&Nh(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&Nh(t[3],e[r]));case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":return t[0]=["name",t[0]],void Ih(e,r,t);case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":return t[0]=["name",t[0]],Ih(e,r,t),void(e[r].type=r);default:for(s=-1;++s<t.length;)if(!Array.isArray(t[s]))return Nh(t,e[r]);return Ih(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}Lh.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Ch.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Mh:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},Lh.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(Oh.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Lh.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Mh)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Mh,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Lh.prototype.number=function(t){if(!Ph.test(t)){if(Oh.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},Lh.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},Lh.prototype.keyword=function(t){if(Th.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Mh)}if(!Oh.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},Lh.prototype.neutral=function(t){if(Eh.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Ph.test(t))return this.word=t,void(this.state=3);if(!Oh.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},Lh.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var kh=.017453292519943295,Rh=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Dh(t){return t*kh}function Fh(t){if(t.AUTHORITY){var e=Object.keys(t.AUTHORITY)[0];e&&e in t.AUTHORITY&&(t.title=e+":"+t.AUTHORITY[e])}if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var r="",s=0,i=t.AXIS.length;s<i;++s){var n=[t.AXIS[s][0].toLowerCase(),t.AXIS[s][1].toLowerCase()];-1!==n[0].indexOf("north")||("y"===n[0]||"lat"===n[0])&&"north"===n[1]?r+="n":-1!==n[0].indexOf("south")||("y"===n[0]||"lat"===n[0])&&"south"===n[1]?r+="s":-1!==n[0].indexOf("east")||("x"===n[0]||"lon"===n[0])&&"east"===n[1]?r+="e":-1===n[0].indexOf("west")&&("x"!==n[0]&&"lon"!==n[0]||"west"!==n[1])||(r+="w")}2===r.length&&(r+="u"),3===r.length&&(t.axis=r)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(a.DATUM?t.datumCode=a.DATUM.name.toLowerCase():t.datumCode=a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_1949"===t.datumCode&&(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"belge_1972"===t.datumCode&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Dh],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Dh],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Dh],["lat0","latitude_of_origin",Dh],["lat0","standard_parallel_1",Dh],["lat1","standard_parallel_1",Dh],["lat2","standard_parallel_2",Dh],["azimuth","Azimuth"],["alpha","azimuth",Dh],["srsCode","name"]].forEach(function(e){return r=t,i=(s=e)[0],n=s[1],void(!(i in r)&&n in r&&(r[i]=r[n],3===s.length&&(r[i]=s[2](r[i]))));var r,s,i,n}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName?!t.lat_ts&&t.lat0&&"Polar_Stereographic"===t.projName&&(t.lat_ts=t.lat0,t.lat0=Dh(t.lat0>0?90:-90)):(t.lat0=Dh(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function Bh(t){var e=Ah(t),r=e[0],s={};return Nh(e,s),function t(e){for(var r=Object.keys(e),s=0,i=r.length;s<i;++s){var n=r[s];-1!==Rh.indexOf(n)&&Fh(e[n]),"object"==typeof e[n]&&t(e[n])}}(s),s[r]}function Gh(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?Gh[t]=wh(arguments[1]):Gh[t]=Bh(arguments[1]):Gh[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?Gh.apply(e,t):Gh(t)});if("string"==typeof t){if(t in Gh)return Gh[t]}else"EPSG"in t?Gh["EPSG:"+t.EPSG]=t:"ESRI"in t?Gh["ESRI:"+t.ESRI]=t:"IAU2000"in t?Gh["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(Gh);const jh=Gh;var Uh=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var Jh=["3857","900913","3785","102113"];const zh=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in jh}(t))return jh[t];if(function(t){return Uh.some(function(e){return t.indexOf(e)>-1})}(t)){var e=Bh(t);if(function(t){var e=xh(t,"authority");if(e){var r=xh(e,"epsg");return r&&Jh.indexOf(r)>-1}}(e))return jh["EPSG:3857"];var r=function(t){var e=xh(t,"extension");if(e)return xh(e,"proj4")}(e);return r?wh(r):e}return function(t){return"+"===t[0]}(t)?wh(t):void 0};function qh(t,e){var r,s;if(t=t||{},!e)return t;for(s in e)void 0!==(r=e[s])&&(t[s]=r);return t}function Vh(t,e,r){var s=t*e;return r/Math.sqrt(1-s*s)}function Hh(t){return t<0?-1:1}function Wh(t){return Math.abs(t)<=vh?t:t-Hh(t)*gh}function Qh(t,e,r){var s=t*r,i=.5*t;return s=Math.pow((1-s)/(1+s),i),Math.tan(.5*(hh-e))/s}function Yh(t,e){for(var r,s,i=.5*t,n=hh-2*Math.atan(e),a=0;a<=15;a++)if(r=t*Math.sin(n),n+=s=hh-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-n,Math.abs(s)<=1e-10)return n;return-9999}function Xh(t){return t}var Zh=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Vh(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,s=t.x,i=t.y;if(i*mh>90&&i*mh<-90&&s*mh>180&&s*mh<-180)return null;if(Math.abs(Math.abs(i)-hh)<=ph)return null;if(this.sphere)e=this.x0+this.a*this.k0*Wh(s-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(yh+.5*i));else{var n=Math.sin(i),a=Qh(this.e,i,n);e=this.x0+this.a*this.k0*Wh(s-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,s=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=hh-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var n=Math.exp(-i/(this.a*this.k0));if(-9999===(r=Yh(this.e,n)))return null}return e=Wh(this.long0+s/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Xh,inverse:Xh,names:["longlat","identity"]}],Kh={},$h=[];function tu(t,e){var r=$h.length;return t.names?($h[r]=t,t.names.forEach(function(t){Kh[t.toLowerCase()]=r}),this):(console.log(e),!0)}const eu={start:function(){Zh.forEach(tu)},add:tu,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==Kh[e]&&$h[Kh[e]]?$h[Kh[e]]:void 0}};var ru={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},su=ru.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ru.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var iu={};iu.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},iu.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},iu.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},iu.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},iu.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},iu.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},iu.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},iu.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},iu.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},iu.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},iu.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},iu.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},iu.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},iu.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},iu.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},iu.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},iu.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};const nu=function(t,e,r,s,i,n,a){var o={};return o.datum_type=void 0===t||"none"===t?ih:sh,e&&(o.datum_params=e.map(parseFloat),0===o.datum_params[0]&&0===o.datum_params[1]&&0===o.datum_params[2]||(o.datum_type=th),o.datum_params.length>3&&(0===o.datum_params[3]&&0===o.datum_params[4]&&0===o.datum_params[5]&&0===o.datum_params[6]||(o.datum_type=eh,o.datum_params[3]*=lh,o.datum_params[4]*=lh,o.datum_params[5]*=lh,o.datum_params[6]=o.datum_params[6]/1e6+1))),a&&(o.datum_type=rh,o.grids=a),o.a=r,o.b=s,o.es=i,o.ep2=n,o};var au={};function ou(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:au[t]||null,isNull:!1}}function lu(t){return t/3600*Math.PI/180}function hu(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function uu(t){return t.map(function(t){return[lu(t.longitudeShift),lu(t.latitudeShift)]})}function cu(t,e,r){return{name:hu(t,e+8,e+16).trim(),parent:hu(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function du(t,e,r,s){for(var i=e+176,n=[],a=0;a<r.gridNodeCount;a++){var o={latitudeShift:t.getFloat32(i+16*a,s),longitudeShift:t.getFloat32(i+16*a+4,s),latitudeAccuracy:t.getFloat32(i+16*a+8,s),longitudeAccuracy:t.getFloat32(i+16*a+12,s)};n.push(o)}return n}function pu(t,e){if(!(this instanceof pu))return new pu(t);e=e||function(t){if(t)throw t};var r=zh(t);if("object"==typeof r){var s=pu.projections.get(r.projName);if(s){if(r.datumCode&&"none"!==r.datumCode){var i=xh(iu,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var n,a,o,l,h,u,c,d=function(t,e,r,s,i){if(!t){var n=xh(ru,s);n||(n=su),t=n.a,e=n.b,r=n.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<ph)&&(i=!0,e=t),{a:t,b:e,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),p=(n=d.a,a=d.b,d.rf,o=r.R_A,u=((l=n*n)-(h=a*a))/l,c=0,o?(l=(n*=1-u*(uh+u*(ch+u*dh)))*n,u=0):c=Math.sqrt(u),{es:u,e:c,ep2:(l-h)/h}),f=function(t){return void 0===t?null:t.split(",").map(ou)}(r.nadgrids),m=r.datum||nu(r.datumCode,r.datum_params,d.a,d.b,p.es,p.ep2,f);qh(this,r),qh(this,s),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=p.es,this.e=p.e,this.ep2=p.ep2,this.datum=m,this.init(),e(null,this)}else e(t)}else e(t)}pu.projections=eu,pu.projections.start();const fu=pu;function mu(t,e,r){var s,i,n,a,o=t.x,l=t.y,h=t.z?t.z:0;if(l<-hh&&l>-1.001*hh)l=-hh;else if(l>hh&&l<1.001*hh)l=hh;else{if(l<-hh)return{x:-1/0,y:-1/0,z:t.z};if(l>hh)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),n=i*i,{x:((s=r/Math.sqrt(1-e*n))+h)*a*Math.cos(o),y:(s+h)*a*Math.sin(o),z:(s*(1-e)+h)*i}}function yu(t,e,r,s){var i,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b=t.x,S=t.y,_=t.z?t.z:0;if(i=Math.sqrt(b*b+S*S),n=Math.sqrt(b*b+S*S+_*_),i/r<1e-12){if(g=0,n/r<1e-12)return hh,v=-s,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(S,b);a=_/n,c=(o=i/n)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),d=a*l,y=0;do{y++,h=e*(u=r/Math.sqrt(1-e*d*d))/(u+(v=i*c+_*d-u*(1-e*d*d))),m=(f=a*(l=1/Math.sqrt(1-h*(2-h)*o*o)))*c-(p=o*(1-h)*l)*d,c=p,d=f}while(m*m>1e-24&&y<30);return{x:g,y:Math.atan(f/Math.abs(p)),z:v}}function gu(t){return t===th||t===eh}function vu(t,e,r){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===th?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==eh||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return r;if(t.datum_type===ih||e.datum_type===ih)return r;var s=t.a,i=t.es;if(t.datum_type===rh){if(0!==bu(t,!1,r))return;s=nh,i=oh}var n=e.a,a=e.b,o=e.es;if(e.datum_type===rh&&(n=nh,a=ah,o=oh),i===o&&s===n&&!gu(t.datum_type)&&!gu(e.datum_type))return r;if((r=mu(r,i,s),gu(t.datum_type)&&(r=function(t,e,r){if(e===th)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===eh){var s=r[0],i=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6];return{x:h*(t.x-l*t.y+o*t.z)+s,y:h*(l*t.x+t.y-a*t.z)+i,z:h*(-o*t.x+a*t.y+t.z)+n}}}(r,t.datum_type,t.datum_params)),gu(e.datum_type)&&(r=function(t,e,r){if(e===th)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===eh){var s=r[0],i=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6],u=(t.x-s)/h,c=(t.y-i)/h,d=(t.z-n)/h;return{x:u+l*c-o*d,y:-l*u+c+a*d,z:o*u-a*c+d}}}(r,e.datum_type,e.datum_params)),r=yu(r,o,n,a),e.datum_type===rh)&&0!==bu(e,!0,r))return;return r}function bu(t,e,r){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var s={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},n=[],a=0;a<t.grids.length;a++){var o=t.grids[a];if(n.push(o.name),o.isNull){i=s;break}if(o.mandatory,null!==o.grid){var l=o.grid.subgrids[0],h=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,u=l.ll[0]-h,c=l.ll[1]-h,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+h,p=l.ll[1]+(l.lim[1]-1)*l.del[1]+h;if(!(c>s.y||u>s.x||p<s.y||d<s.x||(i=Su(s,e,l),isNaN(i.x))))break}else if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*mh+" "+s.y*mh+" tried: '"+n+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function Su(t,e,r){var s={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return s;var i={x:t.x,y:t.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=Wh(i.x-Math.PI)+Math.PI;var n=_u(i,r);if(e){if(isNaN(n.x))return s;n.x=i.x-n.x,n.y=i.y-n.y;var a,o,l=9;do{if(o=_u(n,r),isNaN(o.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:i.x-(o.x+n.x),y:i.y-(o.y+n.y)},n.x+=a.x,n.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=Wh(n.x+r.ll[0]),s.y=n.y+r.ll[1]}else isNaN(n.x)||(s.x=t.x+n.x,s.y=t.y+n.y);return s}function _u(t,e){var r,s={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(s.x),n=Math.floor(s.y),a=s.x-1*i,o=s.y-1*n,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return l;if(n<0||n>=e.lim[1])return l;r=n*e.lim[0]+i;var h=e.cvs[r][0],u=e.cvs[r][1];r++;var c=e.cvs[r][0],d=e.cvs[r][1];r+=e.lim[0];var p=e.cvs[r][0],f=e.cvs[r][1];r--;var m=e.cvs[r][0],y=e.cvs[r][1],g=a*o,v=a*(1-o),b=(1-a)*(1-o),S=(1-a)*o;return l.x=b*h+v*c+S*m+g*p,l.y=b*u+v*d+S*y+g*f,l}function xu(t,e,r){var s,i,n,a=r.x,o=r.y,l=r.z||0,h={};for(n=0;n<3;n++)if(!e||2!==n||void 0!==r.z)switch(0===n?(s=a,i=-1!=="ew".indexOf(t.axis[n])?"x":"y"):1===n?(s=o,i=-1!=="ns".indexOf(t.axis[n])?"y":"x"):(s=l,i="z"),t.axis[n]){case"e":h[i]=s;break;case"w":h[i]=-s;break;case"n":h[i]=s;break;case"s":h[i]=-s;break;case"u":void 0!==r[i]&&(h.z=s);break;case"d":void 0!==r[i]&&(h.z=-s);break;default:return null}return h}function wu(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function Au(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Mu(t,e,r,s){var i,n=void 0!==(r=Array.isArray(r)?wu(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(t){Au(t.x),Au(t.y)}(r),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===th||t.datum.datum_type===eh||t.datum.datum_type===rh)&&"WGS84"!==e.datumCode||(e.datum.datum_type===th||e.datum.datum_type===eh||e.datum.datum_type===rh)&&"WGS84"!==t.datumCode}(t,e)&&(r=Mu(t,i=new fu("WGS84"),r,s),t=i),s&&"enu"!==t.axis&&(r=xu(t,!1,r)),"longlat"===t.projName)r={x:r.x*fh,y:r.y*fh,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=vu(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*mh,y:r.y*mh,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),s&&"enu"!==e.axis?xu(e,!0,r):(n||delete r.z,r)}var Cu=fu("WGS84");function Eu(t,e,r,s){var i,n,a;return Array.isArray(r)?(i=Mu(t,e,r,s)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(n=Mu(t,e,r,s),2===(a=Object.keys(r)).length?n:(a.forEach(function(s){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===s||"y"===s||"z"===s)return}else if("x"===s||"y"===s)return;n[s]=r[s]}),n))}function Tu(t){return t instanceof fu?t:t.oProj?t.oProj:fu(t)}const Ou=function(t,e,r){t=Tu(t);var s,i=!1;return void 0===e?(e=t,t=Cu,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=Cu,i=!0),e=Tu(e),r?Eu(t,e,r):(s={forward:function(r,s){return Eu(t,e,r,s)},inverse:function(r,s){return Eu(e,t,r,s)}},i&&(s.oProj=e),s)};var Pu=6,Lu="AJSAJS",Iu="AFAFAF",Nu=65,ku=73,Ru=79,Du=86,Fu=90;const Bu={forward:Gu,inverse:function(t){var e=zu(Vu(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:ju};function Gu(t,e){return e=e||5,function(t,e){var r="00000"+t.easting,s="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(p=t.easting,f=t.northing,m=t.zoneNumber,y=qu(m),g=Math.floor(p/1e5),v=Math.floor(f/1e5)%20,i=g,n=v,a=y,o=a-1,l=Lu.charCodeAt(o),h=Iu.charCodeAt(o),u=l+i-1,c=h+n,d=!1,u>Fu&&(u=u-Fu+Nu-1,d=!0),(u===ku||l<ku&&u>ku||(u>ku||l<ku)&&d)&&u++,(u===Ru||l<Ru&&u>Ru||(u>Ru||l<Ru)&&d)&&++u===ku&&u++,u>Fu&&(u=u-Fu+Nu-1),c>Du?(c=c-Du+Nu-1,d=!0):d=!1,(c===ku||h<ku&&c>ku||(c>ku||h<ku)&&d)&&c++,(c===Ru||h<Ru&&c>Ru||(c>Ru||h<Ru)&&d)&&++c===ku&&c++,c>Du&&(c=c-Du+Nu-1),String.fromCharCode(u)+String.fromCharCode(c))+r.substr(r.length-5,e)+s.substr(s.length-5,e);var i,n,a,o,l,h,u,c,d;var p,f,m,y,g,v}(function(t){var e,r,s,i,n,a,o,l=t.lat,h=t.lon,u=6378137,c=Uu(l),d=Uu(h);o=Math.floor((h+180)/6)+1,180===h&&(o=60);l>=56&&l<64&&h>=3&&h<12&&(o=32);l>=72&&l<84&&(h>=0&&h<9?o=31:h>=9&&h<21?o=33:h>=21&&h<33?o=35:h>=33&&h<42&&(o=37));a=Uu(6*(o-1)-180+3),.006739496752268451,e=u/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),r=Math.tan(c)*Math.tan(c),s=.006739496752268451*Math.cos(c)*Math.cos(c),i=Math.cos(c)*(d-a),n=u*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c));var p=.9996*e*(i+(1-r+s)*i*i*i/6+(5-18*r+r*r+72*s-.39089081163157013)*i*i*i*i*i/120)+5e5,f=.9996*(n+e*Math.tan(c)*(i*i/2+(5-r+9*s+4*s*s)*i*i*i*i/24+(61-58*r+r*r+600*s-2.2240339282485886)*i*i*i*i*i*i/720));l<0&&(f+=1e7);return{northing:Math.round(f),easting:Math.round(p),zoneNumber:o,zoneLetter:function(t){var e="Z";84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C");return e}(l)}}({lat:t[1],lon:t[0]}),e)}function ju(t){var e=zu(Vu(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Uu(t){return t*(Math.PI/180)}function Ju(t){return t/Math.PI*180}function zu(t){var e=t.northing,r=t.easting,s=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var n,a,o,l,h,u,c,d,p=6378137,f=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=r-5e5,y=e;s<"N"&&(y-=1e7),u=6*(i-1)-180+3,d=(c=y/.9996/6367449.145945056)+(3*f/2-27*f*f*f/32)*Math.sin(2*c)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*c)+151*f*f*f/96*Math.sin(6*c),n=p/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),o=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*p/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),h=m/(.9996*n);var g=d-n*Math.tan(d)/l*(h*h/2-(5+3*a+10*o-4*o*o-.06065547077041606)*h*h*h*h/24+(61+90*a+298*o+45*a*a-1.6983531815716497-3*o*o)*h*h*h*h*h*h/720);g=Ju(g);var v,b=(h-(1+2*a+o)*h*h*h/6+(5-2*o+28*a-3*o*o+.05391597401814761+24*a*a)*h*h*h*h*h/120)/Math.cos(d);if(b=u+Ju(b),t.accuracy){var S=zu({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});v={top:S.lat,right:S.lon,bottom:g,left:b}}else v={lat:g,lon:b};return v}function qu(t){var e=t%Pu;return 0===e&&(e=Pu),e}function Vu(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,s=null,i="",n=0;!/[A-Z]/.test(e=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,n++}var a=parseInt(i,10);if(0===n||n+3>r)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(n++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;s=t.substring(n,n+=2);for(var l=qu(a),h=function(t,e){var r=Lu.charCodeAt(e-1),s=1e5,i=!1;for(;r!==t.charCodeAt(0);){if(++r===ku&&r++,r===Ru&&r++,r>Fu){if(i)throw"Bad character: "+t;r=Nu,i=!0}s+=1e5}return s}(s.charAt(0),l),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var r=Iu.charCodeAt(e-1),s=0,i=!1;for(;r!==t.charCodeAt(0);){if(++r===ku&&r++,r===Ru&&r++,r>Du){if(i)throw"Bad character: "+t;r=Nu,i=!0}s+=1e5}return s}(s.charAt(1),l);u<Hu(o);)u+=2e6;var c=r-n;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,p,f,m=c/2,y=0,g=0;return m>0&&(d=1e5/Math.pow(10,m),p=t.substring(n,n+m),y=parseFloat(p)*d,f=t.substring(n+m),g=parseFloat(f)*d),{easting:y+h,northing:g+u,zoneLetter:o,zoneNumber:a,accuracy:d}}function Hu(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Wu(t,e,r){if(!(this instanceof Wu))return new Wu(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var s=t.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Wu.fromMGRS=function(t){return new Wu(ju(t))},Wu.prototype.toMGRS=function(t){return Gu([this.x,this.y],t)};const Qu=Wu;var Yu=1,Xu=.25,Zu=.046875,Ku=.01953125,$u=.01068115234375,tc=.75,ec=.46875,rc=.013020833333333334,sc=.007120768229166667,ic=.3645833333333333,nc=.005696614583333333,ac=.3076171875;function oc(t){var e=[];e[0]=Yu-t*(Xu+t*(Zu+t*(Ku+t*$u))),e[1]=t*(tc-t*(Zu+t*(Ku+t*$u)));var r=t*t;return e[2]=r*(ec-t*(rc+t*sc)),r*=t,e[3]=r*(ic-t*nc),e[4]=r*t*ac,e}function lc(t,e,r,s){return r*=e,e*=e,s[0]*t-r*(s[1]+e*(s[2]+e*(s[3]+e*s[4])))}var hc=20;function uc(t,e,r){for(var s=1/(1-e),i=t,n=hc;n;--n){var a=Math.sin(i),o=1-e*a*a;if(i-=o=(lc(i,a,Math.cos(i),r)-t)*(o*Math.sqrt(o))*s,Math.abs(o)<ph)return i}return i}const cc={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=oc(this.es),this.ml0=lc(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,s,i=t.x,n=t.y,a=Wh(i-this.long0),o=Math.sin(n),l=Math.cos(n);if(this.es){var h=l*a,u=Math.pow(h,2),c=this.ep2*Math.pow(l,2),d=Math.pow(c,2),p=Math.abs(l)>ph?Math.tan(n):0,f=Math.pow(p,2),m=Math.pow(f,2);e=1-this.es*Math.pow(o,2),h/=Math.sqrt(e);var y=lc(n,o,l,this.en);r=this.a*(this.k0*h*(1+u/6*(1-f+c+u/20*(5-18*f+m+14*c-58*f*c+u/42*(61+179*m-m*f-479*f)))))+this.x0,s=this.a*(this.k0*(y-this.ml0+o*a*h/2*(1+u/12*(5-f+9*c+4*d+u/30*(61+m-58*f+270*c-330*f*c+u/56*(1385+543*m-m*f-3111*f))))))+this.y0}else{var g=l*Math.sin(a);if(Math.abs(Math.abs(g)-1)<ph)return 93;if(r=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,s=l*Math.cos(a)/Math.sqrt(1-Math.pow(g,2)),(g=Math.abs(s))>=1){if(g-1>ph)return 93;s=0}else s=Math.acos(s);n<0&&(s=-s),s=this.a*this.k0*(s-this.lat0)+this.y0}return t.x=r,t.y=s,t},inverse:function(t){var e,r,s,i,n=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(r=uc(e=this.ml0+a/this.k0,this.es,this.en),Math.abs(r)<hh){var o=Math.sin(r),l=Math.cos(r),h=Math.abs(l)>ph?Math.tan(r):0,u=this.ep2*Math.pow(l,2),c=Math.pow(u,2),d=Math.pow(h,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2);var f=n*Math.sqrt(e)/this.k0,m=Math.pow(f,2);s=r-(e*=h)*m/(1-this.es)*.5*(1-m/12*(5+3*d-9*u*d+u-4*c-m/30*(61+90*d-252*u*d+45*p+46*u-m/56*(1385+3633*d+4095*p+1574*p*d)))),i=Wh(this.long0+f*(1-m/6*(1+2*d+u-m/20*(5+28*d+24*p+8*u*d+6*u-m/42*(61+662*d+1320*p+720*p*d))))/l)}else s=hh*Hh(a),i=0;else{var y=Math.exp(n/this.k0),g=.5*(y-1/y),v=this.lat0+a/this.k0,b=Math.cos(v);e=Math.sqrt((1-Math.pow(b,2))/(1+Math.pow(g,2))),s=Math.asin(e),a<0&&(s=-s),i=0===g&&0===b?0:Wh(Math.atan2(g,b)+this.long0)}return t.x=i,t.y=s,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function dc(t){var e=Math.exp(t);return e=(e-1/e)/2}function pc(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),s=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(s,2))}function fc(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(pc(1,e)+1))),t<0?-e:e}function mc(t,e){for(var r,s=2*Math.cos(2*e),i=t.length-1,n=t[i],a=0;--i>=0;)r=s*n-a+t[i],a=n,n=r;return e+r*Math.sin(2*e)}function yc(t,e,r){for(var s,i,n=Math.sin(e),a=Math.cos(e),o=dc(r),l=function(t){var e=Math.exp(t);return e=(e+1/e)/2}(r),h=2*a*l,u=-2*n*o,c=t.length-1,d=t[c],p=0,f=0,m=0;--c>=0;)s=f,i=p,d=h*(f=d)-s-u*(p=m)+t[c],m=u*f-i+h*p;return[(h=n*l)*d-(u=a*o)*m,h*m+u*d]}const gc={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(cc.init.apply(this),this.forward=cc.forward,this.inverse=cc.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var s=mc(this.cbg,this.lat0);this.Zb=-this.Qn*(s+function(t,e){for(var r,s=2*Math.cos(e),i=t.length-1,n=t[i],a=0;--i>=0;)r=s*n-a+t[i],a=n,n=r;return Math.sin(e)*r}(this.gtu,2*s))},forward:function(t){var e=Wh(t.x-this.long0),r=t.y;r=mc(this.cbg,r);var s=Math.sin(r),i=Math.cos(r),n=Math.sin(e),a=Math.cos(e);r=Math.atan2(s,a*i),e=Math.atan2(n*i,pc(s,i*a)),e=fc(Math.tan(e));var o,l,h=yc(this.gtu,2*r,2*e);return r+=h[0],e+=h[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(o=1/0,l=1/0),t.x=o,t.y=l,t},inverse:function(t){var e,r,s=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,s/=this.Qn,Math.abs(s)<=2.623395162778){var n=yc(this.utg,2*i,2*s);i+=n[0],s+=n[1],s=Math.atan(dc(s));var a=Math.sin(i),o=Math.cos(i),l=Math.sin(s),h=Math.cos(s);i=Math.atan2(a*h,pc(l,h*o)),e=Wh((s=Math.atan2(l,h*o))+this.long0),r=mc(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};const vc={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(Wh(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*fh,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,gc.init.apply(this),this.forward=gc.forward,this.inverse=gc.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function bc(t,e){return Math.pow((1-t)/(1+t),e)}var Sc=20;const _c={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+yh)/(Math.pow(Math.tan(.5*this.lat0+yh),this.C)*bc(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+yh),this.C)*bc(this.e*Math.sin(r),this.ratexp))-hh,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,s=Math.pow(Math.tan(.5*r+yh)/this.K,1/this.C),i=Sc;i>0&&(r=2*Math.atan(s*bc(this.e*Math.sin(t.y),-.5*this.e))-hh,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]};const xc={init:function(){_c.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,s,i;return t.x=Wh(t.x-this.long0),_c.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),s=Math.cos(t.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*s),t.x=i*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*s),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,s,i,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(n,this.R2);e=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/n),s=Math.atan2(t.x*e,n*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,s=0;return t.x=s,t.y=i,_c.inverse.apply(this,[t]),t.x=Wh(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};const wc={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ph&&(this.k0=.5*(1+Hh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ph&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ph&&(this.k0=.5*this.cons*Vh(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Qh(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Vh(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-hh,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,s,i,n,a,o=t.x,l=t.y,h=Math.sin(l),u=Math.cos(l),c=Wh(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=ph&&Math.abs(l+this.lat0)<=ph?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*h+this.coslat0*u*Math.cos(c)),t.x=this.a*e*u*Math.sin(c)+this.x0,t.y=this.a*e*(this.coslat0*h-this.sinlat0*u*Math.cos(c))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,h,this.e))-hh,i=Math.cos(r),s=Math.sin(r),Math.abs(this.coslat0)<=ph?(n=Qh(this.e,l*this.con,this.con*h),a=2*this.a*this.k0*n/this.cons,t.x=this.x0+a*Math.sin(o-this.long0),t.y=this.y0-this.con*a*Math.cos(o-this.long0),t):(Math.abs(this.sinlat0)<ph?(e=2*this.a*this.k0/(1+i*Math.cos(c)),t.y=e*s):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*i*Math.cos(c))),t.y=e*(this.cosX0*s-this.sinX0*i*Math.cos(c))+this.y0),t.x=e*i*Math.sin(c)+this.x0,t))},inverse:function(t){var e,r,s,i,n;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=ph?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),e=Math.abs(this.coslat0)<ph?this.lat0>0?Wh(this.long0+Math.atan2(t.x,-1*t.y)):Wh(this.long0+Math.atan2(t.x,t.y)):Wh(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=ph){if(a<=ph)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,s=a*this.cons/(2*this.a*this.k0),r=this.con*Yh(this.e,s),e=this.con*Wh(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=ph?n=this.X0:(n=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/a),e=Wh(this.long0+Math.atan2(t.x*Math.sin(i),a*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),r=-1*Yh(this.e,Math.tan(.5*(hh+n)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(hh+t))*Math.pow((1-e)/(1+e),.5*r)}};const Ac={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,s=1/this.rf,i=2*s-Math.pow(s,2),n=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+n*e)/(1-n*e));this.K=a-this.alpha*o+this.alpha*n/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),s=-this.alpha*(e+r)+this.K,i=2*(Math.atan(Math.exp(s))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(n))),o=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,s=e/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(s)),a=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(i))),o=this.lambda0+a/this.alpha,l=0,h=n,u=-1e3,c=0;Math.abs(h-u)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),u=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=o,t.y=h,t},names:["somerc"]};var Mc=1e-7;const Cc={init:function(){var t,e,r,s,i,n,a,o,l,h,u,c,d,p=0,f=0,m=0,y=0,g=0,v=0,b=0;this.no_off=(d="object"==typeof(c=this).PROJECTION?Object.keys(c.PROJECTION)[0]:c.PROJECTION,"no_uoff"in c||"no_off"in c||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)),this.no_rot="no_rot"in this;var S=!1;"alpha"in this&&(S=!0);var _=!1;if("rectified_grid_angle"in this&&(_=!0),S&&(b=this.alpha),_&&(p=this.rectified_grid_angle*fh),S||_)f=this.longc;else if(m=this.long1,g=this.lat1,y=this.long2,v=this.lat2,Math.abs(g-v)<=Mc||(t=Math.abs(g))<=Mc||Math.abs(t-hh)<=Mc||Math.abs(Math.abs(this.lat0)-hh)<=Mc||Math.abs(Math.abs(v)-hh)<=Mc)throw new Error;var x=1-this.es;e=Math.sqrt(x),Math.abs(this.lat0)>ph?(o=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*o*o,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/x),this.A=this.B*this.k0*e/t,(i=(s=this.B*e/(r*Math.sqrt(t)))*s-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=s,this.E*=Math.pow(Qh(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=s=i=1),S||_?(S?(u=Math.asin(Math.sin(b)/s),_||(p=b)):(u=p,b=Math.asin(s*Math.sin(u))),this.lam0=f-Math.asin(.5*(i-1/i)*Math.tan(u))/this.B):(n=Math.pow(Qh(this.e,g,Math.sin(g)),this.B),a=Math.pow(Qh(this.e,v,Math.sin(v)),this.B),i=this.E/n,l=(a-n)/(a+n),h=((h=this.E*this.E)-a*n)/(h+a*n),(t=m-y)<-Math.pi?y-=gh:t>Math.pi&&(y+=gh),this.lam0=Wh(.5*(m+y)-Math.atan(h*Math.tan(.5*this.B*(m-y))/l)/this.B),u=Math.atan(2*Math.sin(this.B*Wh(m-this.lam0))/(i-1/i)),p=b=Math.asin(s*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(b))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(yh-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(yh+i))},forward:function(t){var e,r,s,i,n,a,o,l,h={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-hh)>ph){if(e=.5*((n=this.E/Math.pow(Qh(this.e,t.y,Math.sin(t.y)),this.B))-(a=1/n)),r=.5*(n+a),i=Math.sin(this.B*t.x),s=(e*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(s)-1)<ph)throw new Error;l=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*t.x),o=Math.abs(a)<Mc?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,a)}else l=t.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*t.y;return this.no_rot?(h.x=o,h.y=l):(o-=this.u_0,h.x=l*this.cosrot+o*this.sinrot,h.y=o*this.cosrot-l*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(t){var e,r,s,i,n,a,o,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((s=Math.exp(-this.BrA*r))-1/s),n=.5*(s+1/s),o=((a=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/n,Math.abs(Math.abs(o)-1)<ph)l.x=0,l.y=o<0?-hh:hh;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Yh(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(i*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};const Ec={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ph)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),s=Vh(this.e,e,r),i=Qh(this.e,this.lat1,e),n=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Vh(this.e,n,a),l=Qh(this.e,this.lat2,n),h=Qh(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ph?this.ns=Math.log(s/o)/Math.log(i/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=s/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=ph&&(r=Hh(r)*(hh-2*ph));var s,i,n=Math.abs(Math.abs(r)-hh);if(n>ph)s=Qh(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(s,this.ns);else{if((n=r*this.ns)<=0)return null;i=0}var a=this.ns*Wh(e-this.long0);return t.x=this.k0*(i*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,t},inverse:function(t){var e,r,s,i,n,a=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),r=1):(e=-Math.sqrt(a*a+o*o),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*a,r*o)),0!==e||this.ns>0){if(r=1/this.ns,s=Math.pow(e/(this.a*this.f0),r),-9999===(i=Yh(this.e,s)))return null}else i=-hh;return n=Wh(l/this.ns+this.long0),t.x=n,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};const Tc={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,s,i,n,a,o,l=t.x,h=t.y,u=Wh(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),s=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),n=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(i)),a=this.n*n,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=o*Math.cos(a)/1,t.x=o*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,s,i,n,a,o,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),s=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(i)),r=Math.asin(Math.cos(s)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,a=e,o=0;var h=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(o=1),a=t.y,h+=1}while(0===o&&h<15);return h>=15?null:t},names:["Krovak","krovak"]};function Oc(t,e,r,s,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-s*Math.sin(6*i)}function Pc(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Lc(t){return.375*t*(1+.25*t*(1+.46875*t))}function Ic(t){return.05859375*t*t*(1+.75*t)}function Nc(t){return t*t*t*(35/3072)}function kc(t,e,r){var s=e*r;return t/Math.sqrt(1-s*s)}function Rc(t){return Math.abs(t)<hh?t:t-Hh(t)*Math.PI}function Dc(t,e,r,s,i){var n,a;n=t/e;for(var o=0;o<15;o++)if(n+=a=(t-(e*n-r*Math.sin(2*n)+s*Math.sin(4*n)-i*Math.sin(6*n)))/(e-2*r*Math.cos(2*n)+4*s*Math.cos(4*n)-6*i*Math.cos(6*n)),Math.abs(a)<=1e-10)return n;return NaN}const Fc={init:function(){this.sphere||(this.e0=Pc(this.es),this.e1=Lc(this.es),this.e2=Ic(this.es),this.e3=Nc(this.es),this.ml0=this.a*Oc(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,s=t.x,i=t.y;if(s=Wh(s-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(s)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(s))-this.lat0);else{var n=Math.sin(i),a=Math.cos(i),o=kc(this.a,this.e,n),l=Math.tan(i)*Math.tan(i),h=s*Math.cos(i),u=h*h,c=this.es*a*a/(1-this.es);e=o*h*(1-u*l*(1/6-(8-l+8*c)*u/120)),r=this.a*Oc(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+o*n/a*u*(.5+(5-l+6*c)*u/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,s=t.x/this.a,i=t.y/this.a;if(this.sphere){var n=i+this.lat0;e=Math.asin(Math.sin(n)*Math.cos(s)),r=Math.atan2(Math.tan(s),Math.cos(n))}else{var a=Dc(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-hh)<=ph)return t.x=this.long0,t.y=hh,i<0&&(t.y*=-1),t;var o=kc(this.a,this.e,Math.sin(a)),l=o*o*o/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(a),2),u=s*this.a/o,c=u*u;e=a-o*Math.tan(a)/l*u*u*(.5-(1+3*h)*u*u/24),r=u*(1-c*(h/3+(1+3*h)*h*c/15))/Math.cos(a)}return t.x=Wh(r+this.long0),t.y=Rc(e),t},names:["Cassini","Cassini_Soldner","cass"]};function Bc(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var Gc=.3333333333333333,jc=.17222222222222222,Uc=.10257936507936508,Jc=.06388888888888888,zc=.0664021164021164,qc=.016415012942191543;const Vc={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-hh)<ph?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<ph?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Bc(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=t*Gc,e=t*t,r[0]+=e*jc,r[1]=e*Jc,e*=t,r[0]+=e*Uc,r[1]+=e*zc,r[2]=e*qc,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Bc(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,s,i,n,a,o,l,h,u,c=t.x,d=t.y;if(c=Wh(c-this.long0),this.sphere){if(n=Math.sin(d),u=Math.cos(d),s=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+u*s:1+this.sinph0*n+this.cosph0*u*s)<=ph)return null;e=(r=Math.sqrt(2/r))*u*Math.sin(c),r*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*u*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(d+this.lat0)<ph)return null;r=yh-.5*d,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(c),r*=s}}else{switch(o=0,l=0,h=0,s=Math.cos(c),i=Math.sin(c),n=Math.sin(d),a=Bc(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*s;break;case this.EQUIT:h=1+l*s;break;case this.N_POLE:h=hh+d,a=this.qp-a;break;case this.S_POLE:h=d-hh,a=this.qp+a}if(Math.abs(h)<ph)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),r=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*o-this.sinb1*l*s):(h=Math.sqrt(2/(1+l*s)))*o*this.ymf,e=this.xmf*h*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(h=Math.sqrt(a))*i,r=s*(this.mode===this.S_POLE?h:-h)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,s,i,n,a,o,l,h,u,c=t.x/this.a,d=t.y/this.a;if(this.sphere){var p,f=0,m=0;if((r=.5*(p=Math.sqrt(c*c+d*d)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),f=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(p)<=ph?0:Math.asin(d*m/p),c*=m,d=f*p;break;case this.OBLIQ:r=Math.abs(p)<=ph?this.lat0:Math.asin(f*this.sinph0+d*m*this.cosph0/p),c*=m*this.cosph0,d=(f-Math.sin(r)*this.sinph0)*p;break;case this.N_POLE:d=-d,r=hh-r;break;case this.S_POLE:r-=hh}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,d):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,d*=this.dd,(a=Math.sqrt(c*c+d*d))<ph)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*a/this.rq),s=Math.cos(i),c*=i=Math.sin(i),this.mode===this.OBLIQ?(o=s*this.sinb1+d*i*this.cosb1/a,n=this.qp*o,d=a*this.cosb1*s-d*this.sinb1*i):(o=d*i/a,n=this.qp*o,d=a*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(n=c*c+d*d))return t.x=this.long0,t.y=this.lat0,t;o=1-n/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(c,d),l=Math.asin(o),h=this.apa,u=l+l,r=l+h[0]*Math.sin(u)+h[1]*Math.sin(u+u)+h[2]*Math.sin(u+u+u)}return t.x=Wh(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Hc(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const Wc={init:function(){Math.abs(this.lat1+this.lat2)<ph||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Vh(this.e3,this.sin_po,this.cos_po),this.qs1=Bc(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Vh(this.e3,this.sin_po,this.cos_po),this.qs2=Bc(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Bc(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>ph?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var s=Bc(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,n=this.ns0*Wh(e-this.long0),a=i*Math.sin(n)+this.x0,o=this.rh-i*Math.cos(n)+this.y0;return t.x=a,t.y=o,t},inverse:function(t){var e,r,s,i,n,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),s=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),s=-1),i=0,0!==e&&(i=Math.atan2(s*t.x,s*t.y)),s=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-s*s)/(2*this.ns0)):(r=(this.c-s*s)/this.ns0,a=this.phi1z(this.e3,r)),n=Wh(i/this.ns0+this.long0),t.x=n,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,s,i,n,a,o=Hc(.5*e);if(t<ph)return o;for(var l=t*t,h=1;h<=25;h++)if(r=Math.sin(o),s=Math.cos(o),o+=a=.5*(n=1-(i=t*r)*i)*n/s*(e/(1-l)-r/n+.5/t*Math.log((1-i)/(1+i))),Math.abs(a)<=1e-7)return o;return null}};const Qc={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,s,i,n,a,o,l=t.x,h=t.y;return s=Wh(l-this.long0),e=Math.sin(h),r=Math.cos(h),i=Math.cos(s),(n=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(n)<=ph?(a=this.x0+1*this.a*r*Math.sin(s)/n,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/n):(a=this.x0+this.infinity_dist*r*Math.sin(s),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=o,t},inverse:function(t){var e,r,s,i,n,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),a=Hc((s=Math.cos(i))*this.sin_p14+t.y*r*this.cos_p14/e),n=Math.atan2(t.x*r,e*this.cos_p14*s-t.y*this.sin_p14*r),n=Wh(this.long0+n)):(a=this.phic0,n=0),t.x=n,t.y=a,t},names:["gnom"]};const Yc={init:function(){this.sphere||(this.k0=Vh(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,s=t.x,i=t.y,n=Wh(s-this.long0);if(this.sphere)e=this.x0+this.a*n*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=Bc(this.e,Math.sin(i));e=this.x0+this.a*this.k0*n,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=Wh(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*hh:hh;for(var s,i,n,a,o=Math.asin(.5*e),l=0;l<30;l++)if(i=Math.sin(o),n=Math.cos(o),a=t*i,o+=s=Math.pow(1-a*a,2)/(2*n)*(e/(1-t*t)-i/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(s)<=1e-10)return o;return NaN}(this.e,2*t.y*this.k0/this.a),e=Wh(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]};const Xc={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,s=Wh(e-this.long0),i=Rc(r-this.lat0);return t.x=this.x0+this.a*s*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,r=t.y;return t.x=Wh(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Rc(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var Zc=20;const Kc={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Pc(this.es),this.e1=Lc(this.es),this.e2=Ic(this.es),this.e3=Nc(this.es),this.ml0=this.a*Oc(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,s,i=t.x,n=t.y,a=Wh(i-this.long0);if(s=a*Math.sin(n),this.sphere)Math.abs(n)<=ph?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(s)/Math.tan(n),r=this.a*(Rc(n-this.lat0)+(1-Math.cos(s))/Math.tan(n)));else if(Math.abs(n)<=ph)e=this.a*a,r=-1*this.ml0;else{var o=kc(this.a,this.e,Math.sin(n))/Math.tan(n);e=o*Math.sin(s),r=this.a*Oc(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+o*(1-Math.cos(s))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,s,i,n,a,o,l,h;if(s=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=ph)e=Wh(s/this.a+this.long0),r=0;else{var u;for(a=this.lat0+i/this.a,o=s*s/this.a/this.a+a*a,l=a,n=Zc;n;--n)if(l+=h=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+o)*u)/((l-a)/u-1),Math.abs(h)<=ph){r=l;break}e=Wh(this.long0+Math.asin(s*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=ph)r=0,e=Wh(this.long0+s/this.a);else{var c,d,p,f,m;for(a=(this.ml0+i)/this.a,o=s*s/this.a/this.a+a*a,l=a,n=Zc;n;--n)if(m=this.e*Math.sin(l),c=Math.sqrt(1-m*m)*Math.tan(l),d=this.a*Oc(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=h=(a*(c*(f=d/this.a)+1)-f-.5*c*(f*f+o))/(this.es*Math.sin(2*l)*(f*f+o-2*a*f)/(4*c)+(a-f)*(c*p-2/Math.sin(2*l))-p),Math.abs(h)<=ph){r=l;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=Wh(this.long0+Math.asin(s*c/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]};const $c={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,s=t.y-this.lat0,i=r-this.long0,n=s/lh*1e-5,a=i,o=1,l=0;for(e=1;e<=10;e++)o*=n,l+=this.A[e]*o;var h,u=l,c=a,d=1,p=0,f=0,m=0;for(e=1;e<=6;e++)h=p*u+d*c,d=d*u-p*c,p=h,f=f+this.B_re[e]*d-this.B_im[e]*p,m=m+this.B_im[e]*d+this.B_re[e]*p;return t.x=m*this.a+this.x0,t.y=f*this.a+this.y0,t},inverse:function(t){var e,r,s=t.x,i=t.y,n=s-this.x0,a=(i-this.y0)/this.a,o=n/this.a,l=1,h=0,u=0,c=0;for(e=1;e<=6;e++)r=h*a+l*o,l=l*a-h*o,h=r,u=u+this.C_re[e]*l-this.C_im[e]*h,c=c+this.C_im[e]*l+this.C_re[e]*h;for(var d=0;d<this.iterations;d++){var p,f=u,m=c,y=a,g=o;for(e=2;e<=6;e++)p=m*u+f*c,f=f*u-m*c,m=p,y+=(e-1)*(this.B_re[e]*f-this.B_im[e]*m),g+=(e-1)*(this.B_im[e]*f+this.B_re[e]*m);f=1,m=0;var v=this.B_re[1],b=this.B_im[1];for(e=2;e<=6;e++)p=m*u+f*c,f=f*u-m*c,m=p,v+=e*(this.B_re[e]*f-this.B_im[e]*m),b+=e*(this.B_im[e]*f+this.B_re[e]*m);var S=v*v+b*b;u=(y*v+g*b)/S,c=(g*v-y*b)/S}var _=u,x=c,w=1,A=0;for(e=1;e<=9;e++)w*=_,A+=this.D[e]*w;var M=this.lat0+A*lh*1e5,C=this.long0+x;return t.x=C,t.y=M,t},names:["New_Zealand_Map_Grid","nzmg"]};const td={init:function(){},forward:function(t){var e=t.x,r=t.y,s=Wh(e-this.long0),i=this.x0+this.a*s,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=i,t.y=n,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=Wh(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]};var ed=20;const rd={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=oc(this.es)},forward:function(t){var e,r,s=t.x,i=t.y;if(s=Wh(s-this.long0),this.sphere){if(this.m)for(var n=this.n*Math.sin(i),a=ed;a;--a){var o=(this.m*i+Math.sin(i)-n)/(this.m+Math.cos(i));if(i-=o,Math.abs(o)<ph)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*s*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),h=Math.cos(i);r=this.a*lc(i,l,h,this.en),e=this.a*s*h/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,s;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=Hc((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Hc(Math.sin(e)/this.n)),r=Wh(r+this.long0),e=Rc(e)):(e=uc(t.y/this.a,this.es,this.en),(s=Math.abs(e))<hh?(s=Math.sin(e),r=Wh(this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)))):s-ph<hh&&(r=this.long0)),t.x=r,t.y=e,t},names:["Sinusoidal","sinu"]};const sd={init:function(){},forward:function(t){for(var e=t.x,r=t.y,s=Wh(e-this.long0),i=r,n=Math.PI*Math.sin(r);;){var a=-(i+Math.sin(i)-n)/(1+Math.cos(i));if(i+=a,Math.abs(a)<ph)break}i/=2,Math.PI/2-Math.abs(r)<ph&&(s=0);var o=.900316316158*this.a*s*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return t.x=o,t.y=l,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var s=Wh(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=s,t.y=i,t},names:["Mollweide","moll"]};const id={init:function(){Math.abs(this.lat1+this.lat2)<ph||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Pc(this.es),this.e1=Lc(this.es),this.e2=Ic(this.es),this.e3=Nc(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Vh(this.e,this.sinphi,this.cosphi),this.ml1=Oc(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ph?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Vh(this.e,this.sinphi,this.cosphi),this.ml2=Oc(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Oc(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,s=t.y;if(this.sphere)e=this.a*(this.g-s);else{var i=Oc(this.e0,this.e1,this.e2,this.e3,s);e=this.a*(this.g-i)}var n=this.ns*Wh(r-this.long0),a=this.x0+e*Math.sin(n),o=this.y0+this.rh-e*Math.cos(n);return t.x=a,t.y=o,t},inverse:function(t){var e,r,s,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;return 0!==r&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=Wh(this.long0+n/this.ns),s=Rc(this.g-r/this.a),t.x=i,t.y=s,t):(s=Dc(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=Wh(this.long0+n/this.ns),t.x=i,t.y=s,t)},names:["Equidistant_Conic","eqdc"]};const nd={init:function(){this.R=this.a},forward:function(t){var e,r,s=t.x,i=t.y,n=Wh(s-this.long0);Math.abs(i)<=ph&&(e=this.x0+this.R*n,r=this.y0);var a=Hc(2*Math.abs(i/Math.PI));(Math.abs(n)<=ph||Math.abs(Math.abs(i)-hh)<=ph)&&(e=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/n-n/Math.PI),l=o*o,h=Math.sin(a),u=Math.cos(a),c=u/(h+u-1),d=c*c,p=c*(2/h-1),f=p*p,m=Math.PI*this.R*(o*(c-f)+Math.sqrt(l*(c-f)*(c-f)-(f+l)*(d-f)))/(f+l);n<0&&(m=-m),e=this.x0+m;var y=l+c;return m=Math.PI*this.R*(p*y-o*Math.sqrt((f+l)*(l+1)-y*y))/(f+l),r=i>=0?this.y0+m:this.y0-m,t.x=e,t.y=r,t},inverse:function(t){var e,r,s,i,n,a,o,l,h,u,c,d;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,n=(s=t.x/c)*s+(i=t.y/c)*i,c=3*(i*i/(l=-2*(a=-Math.abs(i)*(1+n))+1+2*i*i+n*n)+(2*(o=a-2*i*i+s*s)*o*o/l/l/l-9*a*o/l/l)/27)/(h=(a-o*o/3/l)/l)/(u=2*Math.sqrt(-h/3)),Math.abs(c)>1&&(c=c>=0?1:-1),d=Math.acos(c)/3,r=t.y>=0?(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:-(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(s)<ph?this.long0:Wh(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(s*s-i*i)+n*n))/2/s),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};const ad={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,s,i,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_,x,w=t.x,A=t.y,M=Math.sin(t.y),C=Math.cos(t.y),E=Wh(w-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=ph?(t.x=this.x0+this.a*(hh-A)*Math.sin(E),t.y=this.y0-this.a*(hh-A)*Math.cos(E),t):Math.abs(this.sin_p12+1)<=ph?(t.x=this.x0+this.a*(hh+A)*Math.sin(E),t.y=this.y0+this.a*(hh+A)*Math.cos(E),t):(v=this.sin_p12*M+this.cos_p12*C*Math.cos(E),g=(y=Math.acos(v))?y/Math.sin(y):1,t.x=this.x0+this.a*g*C*Math.sin(E),t.y=this.y0+this.a*g*(this.cos_p12*M-this.sin_p12*C*Math.cos(E)),t):(e=Pc(this.es),r=Lc(this.es),s=Ic(this.es),i=Nc(this.es),Math.abs(this.sin_p12-1)<=ph?(n=this.a*Oc(e,r,s,i,hh),a=this.a*Oc(e,r,s,i,A),t.x=this.x0+(n-a)*Math.sin(E),t.y=this.y0-(n-a)*Math.cos(E),t):Math.abs(this.sin_p12+1)<=ph?(n=this.a*Oc(e,r,s,i,hh),a=this.a*Oc(e,r,s,i,A),t.x=this.x0+(n+a)*Math.sin(E),t.y=this.y0+(n+a)*Math.cos(E),t):(o=M/C,l=kc(this.a,this.e,this.sin_p12),h=kc(this.a,this.e,M),u=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(h*C)),b=0===(c=Math.atan2(Math.sin(E),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(E)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(c)-Math.PI)<=ph?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(E)*Math.cos(u)/Math.sin(c)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),y=l*b*(1-(S=b*b)*(m=(p=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es))*p)*(1-m)/6+(_=S*b)/8*(f=d*p)*(1-2*m)+(x=_*b)/120*(m*(4-7*m)-3*d*d*(1-7*m))-x*b/48*f),t.x=this.x0+y*Math.sin(c),t.y=this.y0+y*Math.cos(c),t))},inverse:function(t){var e,r,s,i,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_,x,w;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*hh*this.a)return;return r=e/this.a,s=Math.sin(r),i=Math.cos(r),n=this.long0,Math.abs(e)<=ph?a=this.lat0:(a=Hc(i*this.sin_p12+t.y*s*this.cos_p12/e),o=Math.abs(this.lat0)-hh,n=Math.abs(o)<=ph?this.lat0>=0?Wh(this.long0+Math.atan2(t.x,-t.y)):Wh(this.long0-Math.atan2(-t.x,t.y)):Wh(this.long0+Math.atan2(t.x*s,e*this.cos_p12*i-t.y*this.sin_p12*s))),t.x=n,t.y=a,t}return l=Pc(this.es),h=Lc(this.es),u=Ic(this.es),c=Nc(this.es),Math.abs(this.sin_p12-1)<=ph?(a=Dc(((d=this.a*Oc(l,h,u,c,hh))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,l,h,u,c),n=Wh(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=a,t):Math.abs(this.sin_p12+1)<=ph?(d=this.a*Oc(l,h,u,c,hh),a=Dc(((e=Math.sqrt(t.x*t.x+t.y*t.y))-d)/this.a,l,h,u,c),n=Wh(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),p=kc(this.a,this.e,this.sin_p12),y=Math.cos(m),v=-(g=this.e*this.cos_p12*y)*g/(1-this.es),b=3*this.es*(1-v)*this.sin_p12*this.cos_p12*y/(1-this.es),x=1-v*(_=(S=e/p)-v*(1+v)*Math.pow(S,3)/6-b*(1+3*v)*Math.pow(S,4)/24)*_/2-S*_*_*_/6,f=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*y),n=Wh(this.long0+Math.asin(Math.sin(m)*Math.sin(_)/Math.cos(f))),w=Math.sin(f),a=Math.atan2((w-this.es*x*this.sin_p12)*Math.tan(f),w*(1-this.es)),t.x=n,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]};const od={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,s,i,n,a,o,l=t.x,h=t.y;return s=Wh(l-this.long0),e=Math.sin(h),r=Math.cos(h),i=Math.cos(s),((n=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(n)<=ph)&&(a=1*this.a*r*Math.sin(s),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=o,t},inverse:function(t){var e,r,s,i,n,a,o;return t.x-=this.x0,t.y-=this.y0,r=Hc((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),s=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=ph?(o=this.lat0,t.x=a,t.y=o,t):(o=Hc(i*this.sin_p14+t.y*s*this.cos_p14/e),n=Math.abs(this.lat0)-hh,Math.abs(n)<=ph?(a=this.lat0>=0?Wh(this.long0+Math.atan2(t.x,-t.y)):Wh(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=o,t):(a=Wh(this.long0+Math.atan2(t.x*s,e*this.cos_p14*i-t.y*this.sin_p14*s)),t.x=a,t.y=o,t))},names:["ortho"]};var ld={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},hd={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ud(t,e,r,s){var i;return t<ph?(s.value=hd.AREA_0,i=0):(i=Math.atan2(e,r),Math.abs(i)<=yh?s.value=hd.AREA_0:i>yh&&i<=hh+yh?(s.value=hd.AREA_1,i-=hh):i>hh+yh||i<=-(hh+yh)?(s.value=hd.AREA_2,i=i>=0?i-vh:i+vh):(s.value=hd.AREA_3,i+=hh)),i}function cd(t,e){var r=t+e;return r<-vh?r+=gh:r>+vh&&(r-=gh),r}const dd={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=hh-yh/2?this.face=ld.TOP:this.lat0<=-(hh-yh/2)?this.face=ld.BOTTOM:Math.abs(this.long0)<=yh?this.face=ld.FRONT:Math.abs(this.long0)<=hh+yh?this.face=this.long0>0?ld.RIGHT:ld.LEFT:this.face=ld.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,s,i,n,a,o={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,this.face===ld.TOP)i=hh-e,r>=yh&&r<=hh+yh?(l.value=hd.AREA_0,s=r-hh):r>hh+yh||r<=-(hh+yh)?(l.value=hd.AREA_1,s=r>0?r-vh:r+vh):r>-(hh+yh)&&r<=-yh?(l.value=hd.AREA_2,s=r+hh):(l.value=hd.AREA_3,s=r);else if(this.face===ld.BOTTOM)i=hh+e,r>=yh&&r<=hh+yh?(l.value=hd.AREA_0,s=-r+hh):r<yh&&r>=-yh?(l.value=hd.AREA_1,s=-r):r<-yh&&r>=-(hh+yh)?(l.value=hd.AREA_2,s=-r-hh):(l.value=hd.AREA_3,s=r>0?-r+vh:-r-vh);else{var h,u,c,d,p,f;this.face===ld.RIGHT?r=cd(r,+hh):this.face===ld.BACK?r=cd(r,+vh):this.face===ld.LEFT&&(r=cd(r,-hh)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(r),h=p*Math.cos(r),u=p*f,c=d,this.face===ld.FRONT?s=ud(i=Math.acos(h),c,u,l):this.face===ld.RIGHT?s=ud(i=Math.acos(u),c,-h,l):this.face===ld.BACK?s=ud(i=Math.acos(-h),c,-u,l):this.face===ld.LEFT?s=ud(i=Math.acos(-u),c,h,l):(i=s=0,l.value=hd.AREA_0)}return a=Math.atan(12/vh*(s+Math.acos(Math.sin(s)*Math.cos(yh))-hh)),n=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===hd.AREA_1?a+=hh:l.value===hd.AREA_2?a+=vh:l.value===hd.AREA_3&&(a+=1.5*vh),o.x=n*Math.cos(a),o.y=n*Math.sin(a),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,r,s,i,n,a,o,l,h,u,c,d,p={lam:0,phi:0},f={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?f.value=hd.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(f.value=hd.AREA_1,e-=hh):t.x<0&&-t.x>=Math.abs(t.y)?(f.value=hd.AREA_2,e=e<0?e+vh:e-vh):(f.value=hd.AREA_3,e+=hh),h=vh/12*Math.tan(e),n=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(n),(o=1-(s=Math.cos(e))*s*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?o=-1:o>1&&(o=1),this.face===ld.TOP)l=Math.acos(o),p.phi=hh-l,f.value===hd.AREA_0?p.lam=a+hh:f.value===hd.AREA_1?p.lam=a<0?a+vh:a-vh:f.value===hd.AREA_2?p.lam=a-hh:p.lam=a;else if(this.face===ld.BOTTOM)l=Math.acos(o),p.phi=l-hh,f.value===hd.AREA_0?p.lam=-a+hh:f.value===hd.AREA_1?p.lam=-a:f.value===hd.AREA_2?p.lam=-a-hh:p.lam=a<0?-a-vh:-a+vh;else{var m,y,g;h=(m=o)*m,y=(h+=(g=h>=1?0:Math.sqrt(1-h)*Math.sin(a))*g)>=1?0:Math.sqrt(1-h),f.value===hd.AREA_1?(h=y,y=-g,g=h):f.value===hd.AREA_2?(y=-y,g=-g):f.value===hd.AREA_3&&(h=y,y=g,g=-h),this.face===ld.RIGHT?(h=m,m=-y,y=h):this.face===ld.BACK?(m=-m,y=-y):this.face===ld.LEFT&&(h=m,m=y,y=-h),p.phi=Math.acos(-g)-hh,p.lam=Math.atan2(y,m),this.face===ld.RIGHT?p.lam=cd(p.lam,-hh):this.face===ld.BACK?p.lam=cd(p.lam,-vh):this.face===ld.LEFT&&(p.lam=cd(p.lam,+hh))}return 0!==this.es&&(u=p.phi<0?1:0,c=Math.tan(p.phi),d=this.b/Math.sqrt(c*c+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),u&&(p.phi=-p.phi)),p.lam+=this.long0,t.x=p.lam,t.y=p.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var pd=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],fd=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],md=.8487,yd=1.3523,gd=mh/5,vd=1/gd,bd=18,Sd=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},_d=function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])};const xd={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=Wh(t.x-this.long0),r=Math.abs(t.y),s=Math.floor(r*gd);s<0?s=0:s>=bd&&(s=bd-1),r=mh*(r-vd*s);var i={x:Sd(pd[s],r)*e,y:Sd(fd[s],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*md+this.x0,i.y=i.y*this.a*yd+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*md),y:Math.abs(t.y-this.y0)/(this.a*yd)};if(e.y>=1)e.x/=pd[bd][0],e.y=t.y<0?-hh:hh;else{var r=Math.floor(e.y*bd);for(r<0?r=0:r>=bd&&(r=bd-1);;)if(fd[r][0]>e.y)--r;else{if(!(fd[r+1][0]<=e.y))break;++r}var s=fd[r],i=5*(e.y-s[0])/(fd[r+1][0]-s[0]);i=function(t,e,r,s){for(var i=e;s;--s){var n=t(i);if(i-=n,Math.abs(n)<r)break}return i}(function(t){return(Sd(s,t)-e.y)/_d(s,t)},i,ph,100),e.x/=Sd(pd[r],i),e.y=(5*r+i)*fh,t.y<0&&(e.y=-e.y)}return e.x=Wh(e.x+this.long0),e},names:["Robinson","robin"]};const wd={init:function(){this.name="geocent"},forward:function(t){return mu(t,this.es,this.a)},inverse:function(t){return yu(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var Ad={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Md={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const Cd={init:function(){if(Object.keys(Md).forEach(function(t){if(void 0===this[t])this[t]=Md[t].def;else{if(Md[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Md[t].num&&(this[t]=parseFloat(this[t]))}Md[t].degrees&&(this[t]=this[t]*fh)}.bind(this)),Math.abs(Math.abs(this.lat0)-hh)<ph?this.mode=this.lat0<0?Ad.S_POLE:Ad.N_POLE:Math.abs(this.lat0)<ph?this.mode=Ad.EQUIT:(this.mode=Ad.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,r,s,i,n=Math.sin(t.y),a=Math.cos(t.y),o=Math.cos(t.x);switch(this.mode){case Ad.OBLIQ:r=this.sinph0*n+this.cosph0*a*o;break;case Ad.EQUIT:r=a*o;break;case Ad.S_POLE:r=-n;break;case Ad.N_POLE:r=n}switch(e=(r=this.pn1/(this.p-r))*a*Math.sin(t.x),this.mode){case Ad.OBLIQ:r*=this.cosph0*n-this.sinph0*a*o;break;case Ad.EQUIT:r*=n;break;case Ad.N_POLE:r*=-a*o;break;case Ad.S_POLE:r*=a*o}return i=1/((s=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-r*this.sg)*this.cw*i,r=s*i,t.x=e*this.a,t.y=r*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,r,s,i={x:t.x,y:t.y};s=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*s,r=this.pn1*t.y*this.cw*s,t.x=e*this.cg+r*this.sg,t.y=r*this.cg-e*this.sg;var n=pc(t.x,t.y);if(Math.abs(n)<ph)i.x=0,i.y=t.y;else{var a,o;switch(o=1-n*n*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/n+n/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Ad.OBLIQ:i.y=Math.asin(a*this.sinph0+t.y*o*this.cosph0/n),t.y=(a-this.sinph0*Math.sin(i.y))*n,t.x*=o*this.cosph0;break;case Ad.EQUIT:i.y=Math.asin(t.y*o/n),t.y=a*n,t.x*=o;break;case Ad.N_POLE:i.y=Math.asin(a),t.y=-t.y;break;case Ad.S_POLE:i.y=-Math.asin(a)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]};const Ed={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,r,s,i,n=t.x,a=t.y;if(n-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var o=this.radius_p/pc(this.radius_p*Math.cos(a),Math.sin(a));if(r=o*Math.cos(n)*Math.cos(a),s=o*Math.sin(n)*Math.cos(a),i=o*Math.sin(a),(this.radius_g-r)*r-s*s-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/pc(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(s/e),t.y=this.radius_g_1*Math.atan(i/pc(s,e)))}else"sphere"===this.shape&&(e=Math.cos(a),r=Math.cos(n)*e,s=Math.sin(n)*e,i=Math.sin(a),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/pc(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(s/e),t.y=this.radius_g_1*Math.atan(i/pc(s,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,r,s,i,n=-1,a=0,o=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*pc(1,o)):(a=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*pc(1,a));var l=o/this.radius_p;if(e=a*a+l*l+n*n,(s=(r=2*this.radius_g*n)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(s))/(2*e),n=this.radius_g+i*n,a*=i,o*=i,t.x=Math.atan2(a,n),t.y=Math.atan(o*Math.cos(t.x)/n),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+o*o)):(a=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),e=a*a+o*o+n*n,(s=(r=2*this.radius_g*n)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(s))/(2*e),n=this.radius_g+i*n,a*=i,o*=i,t.x=Math.atan2(a,n),t.y=Math.atan(o*Math.cos(t.x)/n)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};Ou.defaultDatum="WGS84",Ou.Proj=fu,Ou.WGS84=new Ou.Proj("WGS84"),Ou.Point=Qu,Ou.toPoint=wu,Ou.defs=jh,Ou.nadgrid=function(t,e){var r=new DataView(e),s=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),i=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:hu(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(r,s);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var n={header:i,subgrids:function(t,e,r){for(var s=[],i=0;i<e.nSubgrids;i++){var n=cu(t,176,r),a=du(t,176,n,r),o=Math.round(1+(n.upperLongitude-n.lowerLongitude)/n.longitudeInterval),l=Math.round(1+(n.upperLatitude-n.lowerLatitude)/n.latitudeInterval);s.push({ll:[lu(n.lowerLongitude),lu(n.lowerLatitude)],del:[lu(n.longitudeInterval),lu(n.latitudeInterval)],lim:[o,l],count:n.gridNodeCount,cvs:uu(a)})}return s}(r,i,s)};return au[t]=n,n},Ou.transform=Mu,Ou.mgrs=Bu,Ou.version="__VERSION__",function(t){t.Proj.projections.add(cc),t.Proj.projections.add(gc),t.Proj.projections.add(vc),t.Proj.projections.add(xc),t.Proj.projections.add(wc),t.Proj.projections.add(Ac),t.Proj.projections.add(Cc),t.Proj.projections.add(Ec),t.Proj.projections.add(Tc),t.Proj.projections.add(Fc),t.Proj.projections.add(Vc),t.Proj.projections.add(Wc),t.Proj.projections.add(Qc),t.Proj.projections.add(Yc),t.Proj.projections.add(Xc),t.Proj.projections.add(Kc),t.Proj.projections.add($c),t.Proj.projections.add(td),t.Proj.projections.add(rd),t.Proj.projections.add(sd),t.Proj.projections.add(id),t.Proj.projections.add(nd),t.Proj.projections.add(ad),t.Proj.projections.add(od),t.Proj.projections.add(dd),t.Proj.projections.add(xd),t.Proj.projections.add(wd),t.Proj.projections.add(Cd),t.Proj.projections.add(Ed)}(Ou);const Td=Ou;var Od=window.SuperMap=window.SuperMap||{};Od.Components=window.SuperMap.Components||{};class Pd extends d{constructor(t,e,r,s){super(t,e,r,s),this.x=t,this.y=e,this.width=r,this.height=s,this.CLASS_NAME="SuperMap.Geometry.Rectangle",this.geometryType="Rectangle"}calculateBounds(){this.bounds=new x(this.x,this.y,this.x+this.width,this.y+this.height)}getArea(){return this.width*this.height}}var Ld={toISOString:function(){if("toISOString"in Date.prototype)return function(t){return t.toISOString()};{function t(t,e){for(var r=t+"";r.length<e;)r="0"+r;return r}return function(e){return isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1,2)+"-"+t(e.getUTCDate(),2)+"T"+t(e.getUTCHours(),2)+":"+t(e.getUTCMinutes(),2)+":"+t(e.getUTCSeconds(),2)+"."+t(e.getUTCMilliseconds(),3)+"Z"}}}(),parse:function(t){var e,r=t.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/);if(r&&(r[1]||r[7])){var s=parseInt(r[1],10)||0,i=parseInt(r[2],10)-1||0,n=parseInt(r[3],10)||1;e=new Date(Date.UTC(s,i,n));var a=r[7];if(a){var o=parseInt(r[4],10),l=parseInt(r[5],10),h=parseFloat(r[6]),u=0|h,c=Math.round(1e3*(h-u));if(e.setUTCHours(o,l,u,c),"Z"!==a){var d=-1e3*(60*parseInt(a,10)*60+60*(parseInt(r[8],10)||0));e=new Date(e.getTime()+d)}}}else e=new Date("invalid");return e}};class Id{constructor(t){var e=this;t=t||{},this.speed=t.speed&&t.speed>=0?t.speed:1,this.frequency=t.speed&&t.frequency>=0?t.frequency:1e3,this.startTime=t.startTime&&null!=t.startTime?t.startTime:0,this.endTime=t.endTime&&null!=t.endTime&&t.endTime>=e.startTime?t.endTime:+new Date,this.repeat=void 0===t.repeat||t.repeat,this.reverse=void 0!==t.reverse&&t.reverse,this.currentTime=null,this.oldTime=null,this.running=!1,this.EVENT_TYPES=["start","pause","stop"],e.events=new qt(this,null,this.EVENT_TYPES),e.speed=Number(e.speed),e.frequency=Number(e.frequency),e.startTime=Number(e.startTime),e.endTime=Number(e.endTime),e.startTime=Date.parse(new Date(e.startTime)),e.endTime=Date.parse(new Date(e.endTime)),e.currentTime=e.startTime,this.CLASS_NAME="SuperMap.TimeControlBase"}updateOptions(t){var e=this;(t=t||{}).speed&&t.speed>=0&&(e.speed=t.speed,e.speed=Number(e.speed)),t.speed&&t.frequency>=0&&(e.frequency=t.frequency,e.frequency=Number(e.frequency)),t.startTime&&null!=t.startTime&&(e.startTime=t.startTime,e.startTime=Date.parse(new Date(e.startTime))),t.endTime&&null!=t.endTime&&t.endTime>=e.startTime&&(e.endTime=t.endTime,e.endTime=Date.parse(new Date(e.endTime))),null!=t.repeat&&(e.repeat=t.repeat),null!=t.reverse&&(e.reverse=t.reverse)}start(){var t=this;t.running||(t.running=!0,t.tick(),t.events.triggerEvent("start",t.currentTime))}pause(){this.running=!1,this.events.triggerEvent("pause",this.currentTime)}stop(){var t=this;t.currentTime=t.startTime,t.running&&(t.running=!1),t.events.triggerEvent("stop",t.currentTime)}toggle(){this.running?this.pause():this.start()}setSpeed(t){return t>=0&&(this.speed=t,!0)}getSpeed(){return this.speed}setFrequency(t){return t>=0&&(this.frequency=t,!0)}getFrequency(){return this.frequency}setStartTime(t){var e=this;return!((t=Date.parse(new Date(t)))>e.endTime)&&(e.startTime=t,e.currentTime<e.startTime&&(e.currentTime=e.startTime,e.tick()),!0)}getStartTime(){return this.startTime}setEndTime(t){var e=this;return e.endTime=Date.parse(new Date(e.endTime)),!(t<e.startTime)&&(e.endTime=t,e.currentTime>=e.endTime&&(e.currentTime=e.startTime,e.tick()),!0)}getEndTime(){return this.endTime}setCurrentTime(t){var e=this;return e.currentTime=Date.parse(new Date(e.currentTime)),t>=e.startTime&&t<=e.endTime&&(e.currentTime=t,e.startTime=e.currentTime,e.tick(),!0)}getCurrentTime(){return this.currentTime}setRepeat(t){this.repeat=t}getRepeat(){return this.repeat}setReverse(t){this.reverse=t}getReverse(){return this.reverse}getRunning(){return this.running}destroy(){var t=this;t.speed=null,t.frequency=null,t.startTime=null,t.endTime=null,t.currentTime=null,t.repeat=null,t.running=!1,t.reverse=null}tick(){}}class Nd{constructor(t,e){if(t){var r=t.substr(t.length-1,1);this.serviceUrl="/"===r?t.substr(0,t.length-2):t}this.options=e||{},this.CLASS_NAME="SuperMap.iManagerServiceBase"}request(t,e,r,s){(s=s||{headers:{Accept:"*/*","Content-Type":"application/json"}}).crossOrigin=this.options.crossOrigin,s.headers=this.options.headers;var i=Ht.imanagerToken;return i&&(s.headers||(s.headers={}),s.headers["X-Auth-Token"]=i),r&&(r=JSON.stringify(r)),Jt.commit(t,e,r,s).then(function(t){return t.json()})}}class kd{constructor(t){t=t||{},this.nodeSpec="SMALL",this.nodeCount=1,this.nodeName="",this.password="",this.description="",this.physicalMachineName="",this.ips=[],this.userName="",v.extend(this,t)}}class Rd{constructor(t,e){e=e||{},this.serviceUrl=t,this.CLASS_NAME="SuperMap.iPortalServiceBase",this.withCredentials=e.withCredentials||!1,this.crossOrigin=e.crossOrigin,this.headers=e.headers}request(t,e,r,s={headers:this.headers,crossOrigin:this.crossOrigin,withCredentials:this.withCredentials}){return e=Ht.appendCredential(e),Jt.commit(t,e,r,s).then(function(t){return t.json()})}}class Dd{constructor(t){t=t||{},this.resourceType="",this.pageSize=12,this.currentPage=1,this.orderBy="UPDATETIME",this.orderType="DESC",this.searchType="PUBLIC",this.tags=[],this.dirIds=[],this.resourceSubTypes=[],this.aggregationTypes=[],this.text="",this.groupIds=[],this.departmentIds=[],v.extend(this,t)}}class Fd{constructor(t){t=t||{},this.content=[],this.total=0,this.currentPage=1,this.pageSize=12,this.aggregations=null,v.extend(this,t)}}class Bd extends Rd{constructor(t,e){super(t),e=e||{},this.authorizeSetting=[],this.bounds="",this.bounds4326="",this.checkStatus="",this.createTime=0,this.description=null,this.dirId=null,this.epsgCode=0,this.heatLevel=0,this.id=0,this.name="",this.personalDirId=null,this.resourceId=0,this.resourceSubType=null,this.resourceType=null,this.serviceRootUrlId=null,this.tags=null,this.thumbnail=null,this.updateTime=0,this.userName="",this.sourceJSON={},v.extend(this,e),this.resourceUrl=t+"/web/"+this.resourceType.replace("_","").toLowerCase()+"s/"+this.resourceId,this.withCredentials&&(this.resourceUrl=t+"/web/mycontent/"+this.resourceType.replace("_","").toLowerCase()+"s/"+this.resourceId)}load(){var t=this;return t.request("GET",t.resourceUrl+".json").then(function(e){if(e.error)return e;t.sourceJSON=e})}update(){var t=this.resourceType.replace("_","").toLowerCase();"data"===t&&(this.resourceUrl=this.resourceUrl+"/attributes.json");var e=JSON.stringify(this.sourceJSON);if("service"===t){var r={authorizeSetting:this.sourceJSON.authorizeSetting,metadata:this.sourceJSON.metadata,tags:this.sourceJSON.tags,thumbnail:this.sourceJSON.thumbnail,tokenRefreshUrl:this.sourceJSON.tokenRefreshUrl};e=JSON.stringify(r)}return this.request("PUT",this.resourceUrl,e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}class Gd{constructor(t){t=t||{},this.ids=[],this.entities=[],this.resourceType="",v.extend(this,t)}}class jd{constructor(t){t=t||{},this.rootUrl="",this.tags=[],this.entities=[],v.extend(this,t)}}class Ud{constructor(t){t=t||{},this.type="",this.tags=[],this.entities=[],this.metadata={},this.addedMapNames=[],this.addedSceneNames=[],v.extend(this,t)}}class Jd{constructor(t){t=t||{},this.fileName="",this.type="",this.tags=[],this.dataMetaInfo={},v.extend(this,t)}}class zd{constructor(t){t=t||{},this.xField="",this.yField="",this.fileEncoding="UTF-8",this.xIndex=1,this.yIndex=1,this.fieldTypes=[],this.separator="",this.firstRowIsHead=!0,this.url="",this.dataStoreInfo={},v.extend(this,t)}}class qd{constructor(t){t=t||{},this.type="",this.url="",this.connectionInfo={},v.extend(this,t)}}class Vd{constructor(t){t=t||{},this.dataBase="",this.server="",v.extend(this,t)}}class Hd{constructor(t){this.aggName=null,this.aggFieldName=null,this.CLASS_NAME="SuperMap.AggregationParameter",v.extend(this,t)}destroy(){this.aggName=null,this.aggFieldName=null,this.aggType=null}}class Wd extends Hd{constructor(t){super(),this.subAggs=null,this.aggType=null,this.CLASS_NAME="SuperMap.BucketAggParameter",v.extend(this,t)}destroy(){this.subAggs&&(this.subAggs=null)}}class Qd{constructor(){this.CLASS_NAME="LabelMatrixCell"}}class Yd{constructor(t){this.maxWeight=null,this.nodeID=null,this.resourceValue=null,this.type=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.SupplyCenter"}destroy(){this.maxWeight=null,this.nodeID=null,this.resourceValue=null,this.type=null}static fromJson(t){if(t)return new Yd({maxWeight:t.maxWeight,nodeID:t.nodeID,resourceValue:t.resourceValue,type:t.type})}}class Xd{constructor(t){this.flowEnabled=!1,this.leaderLineDisplayed=!1,this.leaderLineStyle=new B,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeFlow"}destroy(){var t=this;t.flowEnabled=null,t.leaderLineDisplayed=null,t.leaderLineStyle&&(t.leaderLineStyle.destroy(),t.leaderLineStyle=null)}static fromObj(t){if(t){var e=new Xd;return v.copy(e,t),e.leaderLineStyle=B.fromJson(t.leaderLineStyle),e}}}class Zd{constructor(t){this.caption=null,this.color=new F,this.end=0,this.start=0,this.visible=!0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridRangeItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.color&&(t.color.destroy(),t.color=null),t.visible=null}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).color&&t.color.toServerJSONObject&&(t.color=t.color.toServerJSONObject()),t}static fromObj(t){if(t){var e=new Zd;return v.copy(e,t),e.color=F.fromJson(t.color),e}}}class Kd extends Ne{constructor(t){super("GRIDRANGE",t),this.items=null,this.rangeMode=$.EQUALINTERVAL,this.rangeParameter=0,this.colorGradientType=tt.YELLOW_RED,this.reverseColor=!1,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridRange"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.reverseColor=null,t.rangeMode=null,t.rangeParameter=null,t.colorGradientType=null}static fromObj(t){if(t){var e=new Kd;v.copy(e,t);var r=t.items,s=r?r.length:0;e.items=[];for(var i=0;i<s;i++)e.items.push(Zd.fromObj(r[i]));return e}}}class $d{constructor(t){this.caption=null,this.color=new F,this.unique=null,this.visible=!0,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridUniqueItem"}destroy(){var t=this;t.caption=null,t.unique=null,t.color&&(t.color.destroy(),t.color=null),t.visible=null}toServerJSONObject(){var t={};return(t=v.copyAttributes(t,this)).color&&t.color.toServerJSONObject&&(t.color=t.color.toServerJSONObject()),t}static fromObj(t){var e=new $d;return v.copy(e,t),e.color=F.fromJson(t.color),e}}class tp extends Ne{constructor(t){super("GRIDUNIQUE",t),this.defaultcolor=new F,this.items=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridUnique"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.defaultcolor&&(t.defaultcolor.destroy(),t.defaultcolor=null)}toServerJSONObject(){var t={};if((t=v.copyAttributes(t,this)).defaultcolor&&t.defaultcolor.toServerJSONObject&&(t.defaultcolor=t.defaultcolor.toServerJSONObject()),t.items){for(var e=[],r=t.items.length,s=0;s<r;s++)e.push(t.items[s].toServerJSONObject());t.items=e}return t}static fromObj(t){var e=new tp,r=t.items,s=r?r.length:0;v.extend(e,t),e.items=[],e.defaultcolor=F.fromJson(t.defaultcolor);for(var i=0;i<s;i++)e.items.push($d.fromObj(r[i]));return e}}class ep{constructor(t){this.caption=null,this.unique=null,this.offsetX=0,this.offsetY=0,this.visible=!0,this.style=new ke,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelUniqueItem"}destroy(){var t=this;t.unique=null,t.caption=null,t.offsetX=null,t.offsetY=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}static fromObj(t){if(t){var e=new ep;return v.copy(e,t),e}}}class rp{constructor(t){t=t||{},this.lineID=null,this.lineName=null,this.lineAliasName=null,this.startStopIndex=null,this.startStopName=null,this.startStopAliasName=null,this.endStopIndex=null,this.endStopName=null,this.endStopAliasName=null,v.extend(this,t),this.CLASS_NAME="SuperMap.TransferLine"}destroy(){v.reset(this)}static fromJson(t){if(t)return new rp({lineID:t.lineID,lineName:t.lineName,lineAliasName:t.lineAliasName,startStopIndex:t.startStopIndex,startStopName:t.startStopName,startStopAliasName:t.startStopAliasName,endStopIndex:t.endStopIndex,endStopName:t.endStopName,endStopAliasName:t.endStopAliasName})}}class sp{constructor(t){t=t||{},this.type=null,v.extend(this,t),this.CLASS_NAME="SuperMap.RasterFunctionParameter"}destroy(){this.type=null}}class ip{constructor(t){this.name=null,this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobCustomItems",v.extend(this,t)}destroy(){this.name=null,this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={name:this.name};return this.title&&(t.title=this.title),this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),v.toJSON(t)}}class np{constructor(t){this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobImage",v.extend(this,t)}destroy(){this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={};return this.picAsUrl&&(t.picAsUrl=this.picAsUrl),this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),v.toJSON(t)}}class ap{constructor(t){this.name=null,this.layerType=null,this.url=null,this.CLASS_NAME="SuperMap.WebPrintingJobLayers",v.extend(this,t)}destroy(){this.name=null,this.layerType=null,this.url=null}}class op{constructor(t){this.title=null,this.picAsUrl=null,this.picAsBase64=null,this.layers=null,this.customItems=null,this.CLASS_NAME="SuperMap.WebPrintingJobLegendOptions",v.extend(this,t)}destroy(){this.title=null,this.picAsUrl=null,this.picAsBase64=null,this.layers instanceof ap&&(this.layers.destroy(),this.layers=null),this.customItems instanceof ip&&(this.customItems.destroy(),this.customItems=null)}toJSON(){var t={title:this.title||""};return this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64?t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,""):this.customItems&&(t.customItems=this.customItems),v.toJSON(t)}}class lp{constructor(t){this.center=null,this.scale=null,this.layerNames=null,this.image=null,this.layers=null,this.CLASS_NAME="SuperMap.WebPrintingJobLittleMapOptions",v.extend(this,t)}destroy(){this.center=null,this.scale=null,this.layerNames=null,this.image instanceof np&&(this.image.destroy(),this.image=null),this.layers instanceof ap&&(this.layers.destroy(),this.layers=null)}toJSON(){var t={scale:this.scale,center:this.center};return this.layerNames?t.layerNames=this.layerNames:this.layers&&(t.layers=this.layers),this.image&&(t.image=this.image),v.toJSON(t)}}class hp{constructor(t){this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobNorthArrowOptions",v.extend(this,t)}destroy(){this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={};return this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),v.toJSON(t)}}class up{constructor(t){this.scaleText=null,this.orientation=null,this.type=null,this.intervals=null,this.unit=null,this.CLASS_NAME="SuperMap.WebPrintingJobScaleBarOptions",v.extend(this,t)}destroy(){this.scaleText=null,this.orientation=null,this.type=null,this.intervals=null,this.unit=null}toJSON(){var t={scaleText:this.scaleText||"",type:this.type||"BAR",intervals:this.intervals||"",unit:this.unit||"METER"};return this.orientation&&(t.orientation=this.orientation),v.toJSON(t)}}class cp{constructor(t){this.type=null,this.url=null,this.token=null,this.value=null,this.CLASS_NAME="SuperMap.WebPrintingJobContent",v.extend(this,t)}destroy(){this.type="WEBMAP",this.url=null,this.token=null,this.value=null}toJSON(){var t={type:this.type};return this.token&&(t.token=this.token),this.url?t.url=this.url:this.value&&(t.value=this.value),v.toJSON(t)}}class dp{constructor(t){this.templateName=null,this.title=null,this.subTitle=null,this.author=null,this.copyright=null,this.summaryText=null,this.time=null,this.scaleBarOptions=null,this.northArrowOptions=null,this.littleMapOptions=null,this.legendOptions=null,this.CLASS_NAME="SuperMap.WebPrintingJobLayoutOptions",v.extend(this,t)}destroy(){this.templateName=null,this.title=null,this.subTitle=null,this.author=null,this.copyright=null,this.summaryText=null,this.time=null,this.scaleBarOptions instanceof up&&(this.scaleBarOptions.destroy(),this.scaleBarOptions=null),this.northArrowOptions instanceof hp&&(this.northArrowOptions.destroy(),this.northArrowOptions=null),this.littleMapOptions instanceof lp&&(this.littleMapOptions.destroy(),this.littleMapOptions=null),this.legendOptions instanceof op&&(this.legendOptions.destroy(),this.legendOptions=null)}}class pp{constructor(t){this.format=null,this.dpi=96,this.scale=null,this.rotation=null,this.center=null,this.CLASS_NAME="SuperMap.WebPrintingJobExportOptions",v.extend(this,t)}destroy(){this.format=null,this.dpi=null,this.scale=null,this.rotation=null,this.center=null,this.outputSize=null}toJSON(){var t={format:this.format||"PDF",dpi:this.dpi,scale:this.scale,center:this.center};return this.rotation&&(t.rotation=this.rotation),this.outputSize&&(t.outputSize=this.outputSize),v.toJSON(t)}}class fp{constructor(t){this.include=void 0,this.exclude=void 0,this.CLASS_NAME="SuperMap.FieldsFilter",v.extend(this,t)}destroy(){this.include=void 0,this.exclude=void 0}static constructFromObject(t,e){return t&&(e=e||new fp,t.hasOwnProperty("include")&&(e.include=t.include),t.hasOwnProperty("exclude")&&(e.exclude=t.exclude)),e}}class mp{constructor(t){this.field=void 0,this.direction=mp.Direction.ASC,this.CLASS_NAME="SuperMap.Sortby",v.extend(this,t)}destroy(){this.field=void 0,this.direction="ASC"}static constructFromObject(t,e){return t&&(e=e||new mp,t.hasOwnProperty("field")&&(e.field=t.field),t.hasOwnProperty("direction")&&(e.direction=t.direction)),e}}mp.Direction={ASC:"ASC",DESC:"DESC"};class yp{constructor(t){this.bbox=void 0,this.collections=void 0,this.ids=void 0,this.limit=void 0,this.fields=void 0,this.query=void 0,this.sortby=void 0,this.CLASS_NAME="SuperMap.ImageSearchParameter",v.extend(this,t)}destroy(){var t=this;t.bbox=void 0,t.collections=void 0,t.ids=void 0,t.limit=void 0,t.fields=void 0,t.query=void 0,t.sortby=void 0}static constructFromObject(t,e){return t&&(e=e||new yp,t.hasOwnProperty("bbox")&&(e.bbox=t.bbox),t.hasOwnProperty("collections")&&(e.collections=t.collections),t.hasOwnProperty("ids")&&(e.ids=t.ids),t.hasOwnProperty("limit")&&(e.limit=t.limit),t.hasOwnProperty("fields")&&(e.fields=fp.constructFromObject&&fp.constructFromObject(t.fields,{})||t.fields),t.hasOwnProperty("query")&&(e.query=t.query),t.hasOwnProperty("sortby")&&(e.sortby=t.sortby,t.sortby&&(e.sortby=t.sortby.map(t=>mp.constructFromObject&&mp.constructFromObject(t,{})||t)))),e}}class gp{constructor(t){this.stretchType=void 0,this.stdevCoefficient=void 0,this.gaussianCoefficient=void 0,this.useMedianValue=void 0,this.minPercent=void 0,this.maxPercent=void 0,this.CLASS_NAME="SuperMap.ImageStretchOption",v.extend(this,t)}destroy(){var t=this;t.stretchType=void 0,t.stdevCoefficient=void 0,t.gaussianCoefficient=void 0,t.useMedianValue=void 0,t.minPercent=void 0,t.maxPercent=void 0}static constructFromObject(t,e){return t&&(e=e||new gp,t.hasOwnProperty("stretchType")&&(e.stretchType=t.stretchType),t.hasOwnProperty("stdevCoefficient")&&(e.stdevCoefficient=t.stdevCoefficient),t.hasOwnProperty("gaussianCoefficient")&&(e.gaussianCoefficient=t.gaussianCoefficient),t.hasOwnProperty("useMedianValue")&&(e.useMedianValue=t.useMedianValue),t.hasOwnProperty("minPercent")&&(e.minPercent=t.minPercent),t.hasOwnProperty("maxPercent")&&(e.maxPercent=t.maxPercent)),e}}gp.StretchType={NONE:"NONE",GAUSSIAN:"GAUSSIAN",PERCENTCLIP:"PERCENTCLIP",MINIMUMMAXIMUM:"MINIMUMMAXIMUM",STANDARDDEVIATION:"STANDARDDEVIATION"};class vp{constructor(t){this.displayMode=void 0,this.displayBands=void 0,this.stretchOption=void 0,this.interpolationMode=void 0,this.colorScheme=void 0,this.colorTable=void 0,this.brightness=void 0,this.contrast=void 0,this.noData=void 0,this.noDataColor=void 0,this.noDataTransparent=void 0,this.backgroundValue=void 0,this.backgroundColor=void 0,this.backgroundTransparent=void 0,this.gridFunctions=void 0,this.CLASS_NAME="SuperMap.ImageRenderingRule",v.extend(this,t)}destroy(){var t=this;t.displayMode=void 0,t.displayBands=void 0,t.stretchOption=void 0,t.interpolationMode=void 0,t.colorScheme=void 0,t.colorTable=void 0,t.brightness=void 0,t.contrast=void 0,t.noData=void 0,t.noDataColor=void 0,t.noDataTransparent=void 0,t.backgroundValue=void 0,t.backgroundColor=void 0,t.backgroundTransparent=void 0,t.gridFuncOptions=void 0}static constructFromObject(t,e){return t&&(e=e||new vp,t.hasOwnProperty("displayMode")&&(e.displayMode=t.displayMode),t.hasOwnProperty("displayBands")&&(e.displayBands=t.displayBands),t.hasOwnProperty("stretchOption")&&(e.stretchOption=gp.constructFromObject&&gp.constructFromObject(t.stretchOption,{})||t.stretchOption),t.hasOwnProperty("interpolationMode")&&(e.interpolationMode=t.interpolationMode),t.hasOwnProperty("colorScheme")&&(e.colorScheme=t.colorScheme),t.hasOwnProperty("colorTable")&&(e.colorTable=t.colorTable),t.hasOwnProperty("brightness")&&(e.brightness=t.brightness),t.hasOwnProperty("contrast")&&(e.contrast=t.contrast),t.hasOwnProperty("noData")&&(e.noData=t.noData),t.hasOwnProperty("noDataColor")&&(e.noDataColor=t.noDataColor),t.hasOwnProperty("backgroundValue")&&(e.backgroundValue=t.backgroundValue),t.hasOwnProperty("noDataTransparent")&&(e.noDataTransparent=t.noDataTransparent),t.hasOwnProperty("backgroundColor")&&(e.backgroundColor=t.backgroundColor),t.hasOwnProperty("backgroundTransparent")&&(e.backgroundTransparent=t.backgroundTransparent),t.hasOwnProperty("gridFunctions")&&(e.gridFunctions=t.gridFunctions)),e}}vp.DisplayMode={COMPOSITE:"COMPOSITE",STRETCHED:"Stretched"},vp.InterpolationMode={NEARESTNEIGHBOR:"NEARESTNEIGHBOR",HIGHQUALITYBILINEAR:"HIGHQUALITYBILINEAR",DEFAULT:"DEFAULT"};class bp{constructor(t){this.girdFuncName="GFHillShade",this.Azimuth=315,this.Altitude=45,this.ZFactor=1,this.CLASS_NAME="SuperMap.ImageGFHillShade",v.extend(this,t)}destroy(){this.girdFuncName="GFHillShade",this.Azimuth=315,this.Altitude=45,this.ZFactor=1}static constructFromObject(t,e){return t&&(e=e||new bp,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Azimuth")&&(e.Azimuth=t.Azimuth),t.hasOwnProperty("Altitude")&&(e.Altitude=t.Altitude),t.hasOwnProperty("ZFactor")&&(e.ZFactor=t.ZFactor)),e}}class Sp{constructor(t){this.girdFuncName="GFAspect",this.Azimuth=void 0,this.CLASS_NAME="SuperMap.ImageGFAspect",v.extend(this,t)}destroy(){this.girdFuncName="GFAspect",this.Azimuth=void 0}static constructFromObject(t,e){return t&&(e=e||new Sp,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Azimuth")&&(e.Azimuth=t.Azimuth)),e}}class _p{constructor(t){this.girdFuncName="GFOrtho",this.CLASS_NAME="SuperMap.ImageGFOrtho",v.extend(this,t)}destroy(){this.girdFuncName="GFOrtho"}static constructFromObject(t,e){return t&&(e=e||new _p,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName)),e}}class xp{constructor(t){this.girdFuncName="GFSlope",this.Altitude=45,this.ZFactor=1,this.CLASS_NAME="SuperMap.ImageGFSlope",v.extend(this,t)}destroy(){this.girdFuncName="GFSlope",this.Altitude=45,this.ZFactor=1}static constructFromObject(t,e){return t&&(e=e||new xp,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Altitude")&&(e.Altitude=t.Altitude),t.hasOwnProperty("ZFactor")&&(e.ZFactor=t.ZFactor)),e}}class wp{constructor(t){t=t||{},v.extend(this,t),this.CLASS_NAME="SuperMap.OnlineServiceBase"}request(t,e,r,s={}){return e=Ht.appendCredential(e),s.crossOrigin=this.options.crossOrigin,s.headers=this.options.headers,Jt.commit(t,e,r,s).then(function(t){return t.json()})}}class Ap extends wp{constructor(t,e){super(t),e=e||{},this.MD5=null,this.type=null,this.userName=null,this.fileName=null,this.size=null,this.serviceStatus=null,this.serviceId=null,this.id=null,this.lastModfiedTime=null,this.status=null,this.storageId=null,this.publishInfo=null,this.authorizeSetting=null,this.nickname=null,this.tags=[],this.description=null,this.dataItemServices=null,this.coordType=null,this.dataCheckResult=null,this.dataMetaInfo=null,this.thumbnail=null,v.extend(this,e),this.id&&(this.serviceUrl=t+"/"+this.id),this.CLASS_NAME="SuperMap.OnlineData"}load(){if(this.serviceUrl){var t=this;return t.request("GET",this.serviceUrl).then(function(e){v.extend(t,e)})}}getPublishedServices(){return this.dataItemServices}getAuthorizeSetting(){return this.authorizeSetting}}class Mp{constructor(){this.BUILTIN_OBJECT={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1},this._ctx=null,this._canvas=null,this._pixelCtx=null,this._width=null,this._height=null,this._offsetX=0,this._offsetY=0,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Util"}clone(t){var e=this.BUILTIN_OBJECT;if("object"==typeof t&&null!==t){var r=t;if(t instanceof Array){r=[];for(var s=0,i=t.length;s<i;s++)r[s]=this.clone(t[s])}else if(!e[Object.prototype.toString.call(t)])for(var n in r={},t)t.hasOwnProperty(n)&&(r[n]=this.clone(t[n]));return r}return t}mergeItem(t,e,r,s){var i=this.BUILTIN_OBJECT;e.hasOwnProperty(r)&&("object"!=typeof t[r]||i[Object.prototype.toString.call(t[r])]?!s&&r in t||(t[r]=e[r]):this.merge(t[r],e[r],s))}merge(t,e,r){for(var s in e)this.mergeItem(t,e,s,r);return t}getContext(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx}getPixelContext(){return this._pixelCtx||(this._canvas=document.createElement("canvas"),this._width=this._canvas.width,this._height=this._canvas.height,this._pixelCtx=this._canvas.getContext("2d")),this._pixelCtx}adjustCanvasSize(t,e){var r,s=this._canvas,i=this._pixelCtx,n=this._width,a=this._height,o=this._offsetX,l=this._offsetY;t+o>n&&(n=t+o+100,s.width=n,r=!0),e+l>a&&(a=e+l+100,s.height=a,r=!0),t<-o&&(n+=o=100*Math.ceil(-t/100),s.width=n,r=!0),e<-l&&(a+=l=100*Math.ceil(-e/100),s.height=a,r=!0),r&&i.translate(o,l)}getPixelOffset(){return{x:this._offsetX,y:this._offsetY}}indexOf(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,s=t.length;r<s;r++)if(t[r]===e)return r;return-1}inherits(t,e){var r=t.prototype;function s(){}for(var i in s.prototype=e.prototype,t.prototype=new s,r)t.prototype[i]=r[i];t.constructor=t}}class Cp{constructor(){this.util=new Mp,this._ctx=null,this.palette=["#ff9277"," #dddd00"," #ffc877"," #bbe3ff"," #d5ffbb","#bbbbff"," #ddb000"," #b0dd00"," #e2bbff"," #ffbbe3","#ff7777"," #ff9900"," #83dd00"," #77e3ff"," #778fff","#c877ff"," #ff77ab"," #ff6600"," #aa8800"," #77c7ff","#ad77ff"," #ff77ff"," #dd0083"," #777700"," #00aa00","#0088aa"," #8400dd"," #aa0088"," #dd0000"," #772e00"],this._palette=this.palette,this.highlightColor="rgba(0,0,255,1)",this._highlightColor=this.highlightColor,this.colorRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,this._nameColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"},this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Color"}customPalette(t){this.palette=t}resetPalette(){this.palette=this._palette}getColor(t,e){return t|=0,(e=e||this.palette)[t%e.length]}customHighlight(t){this.highlightColor=t}resetHighlight(){this.highlightColor=this._highlightColor}getHighlightColor(){return this.highlightColor}getRadialGradient(t,e,r,s,i,n,a){var o=this.util;this._ctx||(this._ctx=o.getContext());for(var l=this._ctx.createRadialGradient(t,e,r,s,i,n),h=0,u=a.length;h<u;h++)l.addColorStop(a[h][0],a[h][1]);return l.__nonRecursion=!0,l}getLinearGradient(t,e,r,s,i){var n=this.util;this._ctx||(this._ctx=n.getContext());for(var a=this._ctx.createLinearGradient(t,e,r,s),o=0,l=i.length;o<l;o++)a.addColorStop(i[o][0],i[o][1]);return a.__nonRecursion=!0,a}getStepColors(t,e,r){t=this.toRGBA(t),e=this.toRGBA(e),t=this.getData(t);for(var s=[],i=((e=this.getData(e))[0]-t[0])/r,n=(e[1]-t[1])/r,a=(e[2]-t[2])/r,o=(e[3]-t[3])/r,l=0,h=t[0],u=t[1],c=t[2],d=t[3];l<r;l++)s[l]=this.toColor([this.adjust(Math.floor(h),[0,255]),this.adjust(Math.floor(u),[0,255]),this.adjust(Math.floor(c),[0,255]),d.toFixed(4)-0],"rgba"),h+=i,u+=n,c+=a,d+=o;return h=e[0],u=e[1],c=e[2],d=e[3],s[l]=this.toColor([h,u,c,d],"rgba"),s}getGradientColors(t,e){var r=[],s=t.length;if(void 0===e&&(e=20),1===s)r=this.getStepColors(t[0],t[0],e);else if(s>1)for(var i=0,n=s-1;i<n;i++){var a=this.getStepColors(t[i],t[i+1],e);i<n-1&&a.pop(),r=r.concat(a)}return r}toColor(t,e){if(e=e||"rgb",t&&(3===t.length||4===t.length)){if(t=this.map(t,function(t){return t>1?Math.ceil(t):t}),e.indexOf("hex")>-1)return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1);if(e.indexOf("hs")>-1){var r=this.map(t.slice(1,3),function(t){return t+"%"});t[1]=r[0],t[2]=r[1]}return e.indexOf("a")>-1?(3===t.length&&t.push(1),t[3]=this.adjust(t[3],[0,1]),e+"("+t.slice(0,4).join(",")+")"):e+"("+t.slice(0,3).join(",")+")"}}toArray(t){(t=this.trim(t)).indexOf("rgba")<0&&(t=this.toRGBA(t));var e=[],r=0;return t.replace(/[\d.]+/g,function(t){r<3?t|=0:t=+t,e[r++]=t}),e}convert(t,e){if(!this.isCalculableColor(t))return t;var r=this.getData(t),s=r[3];return void 0===s&&(s=1),t.indexOf("hsb")>-1?r=this._HSV_2_RGB(r):t.indexOf("hsl")>-1&&(r=this._HSL_2_RGB(r)),e.indexOf("hsb")>-1||e.indexOf("hsv")>-1?r=this._RGB_2_HSB(r):e.indexOf("hsl")>-1&&(r=this._RGB_2_HSL(r)),r[3]=s,this.toColor(r,e)}toRGBA(t){return this.convert(t,"rgba")}toRGB(t){return this.convert(t,"rgb")}toHex(t){return this.convert(t,"hex")}toHSVA(t){return this.convert(t,"hsva")}toHSV(t){return this.convert(t,"hsv")}toHSBA(t){return this.convert(t,"hsba")}toHSB(t){return this.convert(t,"hsb")}toHSLA(t){return this.convert(t,"hsla")}toHSL(t){return this.convert(t,"hsl")}toName(t){for(var e in this._nameColors)if(this.toHex(this._nameColors[e])===this.toHex(t))return e;return null}trim(t){return String(t).replace(/\s+/g,"")}normalize(t){if(this._nameColors[t]&&(t=this._nameColors[t]),t=(t=this.trim(t)).replace(/hsv/i,"hsb"),/^#[\da-f]{3}$/i.test(t)){var e=(3840&(t=parseInt(t.slice(1),16)))<<8,r=(240&t)<<4,s=15&t;t="#"+((1<<24)+(e<<4)+e+(r<<4)+r+(s<<4)+s).toString(16).slice(1)}return t}lift(t,e){if(!this.isCalculableColor(t))return t;var r=e>0?1:-1;void 0===e&&(e=0),e=Math.abs(e)>1?1:Math.abs(e),t=this.toRGB(t);for(var s=this.getData(t),i=0;i<3;i++)s[i]=1===r?s[i]*(1-e)|0:(255-s[i])*e+s[i]|0;return"rgb("+s.join(",")+")"}reverse(t){if(!this.isCalculableColor(t))return t;var e=this.getData(this.toRGBA(t));return e=this.map(e,function(t){return 255-t}),this.toColor(e,"rgb")}mix(t,e,r){if(!this.isCalculableColor(t)||!this.isCalculableColor(e))return t;void 0===r&&(r=.5);for(var s=2*(r=1-this.adjust(r,[0,1]))-1,i=this.getData(this.toRGBA(t)),n=this.getData(this.toRGBA(e)),a=i[3]-n[3],o=((s*a==-1?s:(s+a)/(1+s*a))+1)/2,l=1-o,h=[],u=0;u<3;u++)h[u]=i[u]*o+n[u]*l;var c=i[3]*r+n[3]*(1-r);return c=Math.max(0,Math.min(1,c)),1===i[3]&&1===n[3]?this.toColor(h,"rgb"):(h[3]=c,this.toColor(h,"rgba"))}random(){return"#"+Math.random().toString(16).slice(2,8)}getData(t){var e,r,s=(t=this.normalize(t)).match(this.colorRegExp);if(null===s)throw new Error("The color format error");var i,n=[];if(s[2])i=[(e=s[2].replace("#","").split(""))[0]+e[1],e[2]+e[3],e[4]+e[5]],n=this.map(i,function(t){return Cp.prototype.adjust.call(this,parseInt(t,16),[0,255])});else if(s[4]){var a=s[4].split(",");r=a[3],i=a.slice(0,3),n=this.map(i,function(t){return t=Math.floor(t.indexOf("%")>0?2.55*parseInt(t,0):t),Cp.prototype.adjust.call(this,t,[0,255])}),void 0!==r&&n.push(this.adjust(parseFloat(r),[0,1]))}else if(s[5]||s[6]){var o=(s[5]||s[6]).split(","),l=parseInt(o[0],0)/360,h=o[1],u=o[2];r=o[3],(n=this.map([h,u],function(t){return Cp.prototype.adjust.call(this,parseFloat(t)/100,[0,1])})).unshift(l),void 0!==r&&n.push(this.adjust(parseFloat(r),[0,1]))}return n}alpha(t,e){if(!this.isCalculableColor(t))return t;null===e&&(e=1);var r=this.getData(this.toRGBA(t));return r[3]=this.adjust(Number(e).toFixed(4),[0,1]),this.toColor(r,"rgba")}map(t,e){if("function"!=typeof e)throw new TypeError;for(var r=t?t.length:0,s=0;s<r;s++)t[s]=e(t[s]);return t}adjust(t,e){return t<=e[0]?t=e[0]:t>=e[1]&&(t=e[1]),t}isCalculableColor(t){return t instanceof Array||"string"==typeof t}_HSV_2_RGB(t){var e,r,s,i=t[0],n=t[1],a=t[2];if(0===n)e=255*a,r=255*a,s=255*a;else{var o=6*i;6===o&&(o=0);var l=0|o,h=a*(1-n),u=a*(1-n*(o-l)),c=a*(1-n*(1-(o-l))),d=0,p=0,f=0;0===l?(d=a,p=c,f=h):1===l?(d=u,p=a,f=h):2===l?(d=h,p=a,f=c):3===l?(d=h,p=u,f=a):4===l?(d=c,p=h,f=a):(d=a,p=h,f=u),e=255*d,r=255*p,s=255*f}return[e,r,s]}_HSL_2_RGB(t){var e,r,s,i=t[0],n=t[1],a=t[2];if(0===n)e=255*a,r=255*a,s=255*a;else{var o,l=2*a-(o=a<.5?a*(1+n):a+n-n*a);e=255*this._HUE_2_RGB(l,o,i+1/3),r=255*this._HUE_2_RGB(l,o,i),s=255*this._HUE_2_RGB(l,o,i-1/3)}return[e,r,s]}_HUE_2_RGB(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+6*(e-t)*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}_RGB_2_HSB(t){var e,r,s=t[0]/255,i=t[1]/255,n=t[2]/255,a=Math.min(s,i,n),o=Math.max(s,i,n),l=o-a,h=o;if(0===l)e=0,r=0;else{r=l/o;var u=((o-s)/6+l/2)/l,c=((o-i)/6+l/2)/l,d=((o-n)/6+l/2)/l;s===o?e=d-c:i===o?e=1/3+u-d:n===o&&(e=2/3+c-u),e<0&&(e+=1),e>1&&(e-=1)}return[e*=360,r*=100,h*=100]}_RGB_2_HSL(t){var e,r,s=t[0]/255,i=t[1]/255,n=t[2]/255,a=Math.min(s,i,n),o=Math.max(s,i,n),l=o-a,h=(o+a)/2;if(0===l)e=0,r=0;else{r=h<.5?l/(o+a):l/(2-o-a);var u=((o-s)/6+l/2)/l,c=((o-i)/6+l/2)/l,d=((o-n)/6+l/2)/l;s===o?e=d-c:i===o?e=1/3+u-d:n===o&&(e=2/3+c-u),e<0&&(e+=1),e>1&&(e-=1)}return[e*=360,r*=100,h*=100]}}var Ep=new Cp;var Tp=r(388),Op=r.n(Tp);class Pp{constructor(t){this.env=null,this.parser=null,this.ruleSet=null,this.cartoStr="",this.shaders=null,"string"==typeof t&&(this.cartoStr=t,this.env={frames:[],errors:[],error:function(t){this.errors.push(t)}},this.parser=this.getParser(this.env),this.parse(t),this.shaders=this.toShaders())}getParser(t){var e,r,s,i,n,a,o,l,h,u=this;function c(){i=o[s],n=r,l=r}function d(){o[s]=i,l=r=n}function p(){r>l&&(o[s]=o[s].slice(r-l),l=r)}function f(t){var i,n,a,u;if(t instanceof Function)return t.call(h.parsers);if("string"==typeof t)i=e.charAt(r)===t?t:null,n=1,p();else{if(p(),!(i=t.exec(o[s])))return null;n=i[0].length}if(i){var c=r+=n;for(u=r+o[s].length-n;r<u&&(32===(a=e.charCodeAt(r))||10===a||9===a);)r++;return o[s]=o[s].slice(n+(r-c)),l=r,0===o[s].length&&s<o.length-1&&s++,"string"==typeof i?i:1===i.length?i[0]:i}}function m(r){var s,i={index:a,filename:t.filename,message:"Parse error.",line:0,column:-1};for(var n in i)0===r[n]&&(r[n]=i[n]);s=r.filename&&u.env.inputs&&u.env.inputs[r.filename]?u.env.inputs[r.filename]:e,r.line=(s.slice(0,r.index).match(/\n/g)||"").length+1;for(var o=r.index;o>=0&&"\n"!==s.charAt(o);o--)r.column++;return new Error([r.filename,r.line,r.column,r.message].join(";"))}return this.env=t=t||{},this.env.filename=this.env.filename||null,this.env.inputs=this.env.inputs||{},h={parse:function(i){var n,h=null;if(r=s=l=a=0,o=[],e=i.replace(/\r\n/g,"\n"),t.filename&&(u.env.inputs[t.filename]=e),o=function(t){for(var r,s,i,n,a=0,o=/(?:@\{[\w-]+\}|[^"'`\{\}\/\(\)\\])+/g,l=/\/\*(?:[^*]|\*+[^\/*])*\*+\/|\/\/.*/g,u=/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'|`((?:[^`]|\\.)*)`/g,c=0,d=t[0],p=0;p<e.length;)if(o.lastIndex=p,(r=o.exec(e))&&r.index===p&&(p+=r[0].length,d.push(r[0])),i=e.charAt(p),l.lastIndex=u.lastIndex=p,(r=u.exec(e))&&r.index===p)p+=r[0].length,d.push(r[0]);else if(s||"/"!==i||"/"!==(n=e.charAt(p+1))&&"*"!==n||!(r=l.exec(e))||r.index!==p){switch(i){case"{":if(!s){c++,d.push(i);break}case"}":if(!s){c--,d.push(i),t[++a]=d=[];break}case"(":if(!s){s=!0,d.push(i);break}case")":if(s){s=!1,d.push(i);break}default:d.push(i)}p++}else p+=r[0].length,d.push(r[0]);return 0!==c&&(h={index:p-1,type:"Parse",message:c>0?"missing closing `}`":"missing opening `{`"}),t.map(function(t){return t.join("")})}([[]]),h)throw m(h);var c=function(t,e){var r=t.specificity,s=e.specificity;return r[0]!=s[0]?s[0]-r[0]:r[1]!=s[1]?s[1]-r[1]:r[2]!=s[2]?s[2]-r[2]:s[3]-r[3]};return(n=new Pp.Tree.Ruleset([],f(this.parsers.primary))).root=!0,n.toList=function(t){t.error=function(e){t.errors||(t.errors=new Error("")),t.errors.message?t.errors.message+="\n"+m(e).message:t.errors.message=m(e).message},t.frames=t.frames||[];var e=this.flatten([],[],t);return e.sort(c),e},n},parsers:{primary:function(){for(var t,e=[];(t=f(this.rule)||f(this.ruleset)||f(this.comment))||f(/^[\s\n]+/)||(t=f(this.invalid));)t&&e.push(t);return e},invalid:function(){var t=f(/^[^;\n]*[;\n]/);if(t)return new Pp.Tree.Invalid(t,n)},comment:function(){var t;if("/"===e.charAt(r))return"/"===e.charAt(r+1)?new Pp.Tree.Comment(f(/^\/\/.*/),!0):(t=f(/^\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/))?new Pp.Tree.Comment(t):void 0},entities:{quoted:function(){if('"'===e.charAt(r)||"'"===e.charAt(r)){var t=f(/^"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/);return t?new Pp.Tree.Quoted(t[1]||t[2]):void 0}},field:function(){if(f("[")){var t=f(/(^[^\]]+)/);if(f("]"))return t?new Pp.Tree.Field(t[1]):void 0}},comparison:function(){var t=f(/^=~|=|!=|<=|>=|<|>/);if(t)return t},keyword:function(){var t=f(/^[A-Za-z\u4e00-\u9fa5-]+[A-Za-z-0-9\u4e00-\u9fa5_]*/);if(t)return new Pp.Tree.Keyword(t)},call:function(){var t,e;if(t=/^([\w\-]+|%)\(/.exec(o[s])){if("url"===(t=t[1]))return null;r+=t.length;if(f("("),e=f(this.entities.arguments),f(")"))return t?new Pp.Tree.Call(t,e,r):void 0}},arguments:function(){for(var t,e=[];t=f(this.expression);){e.push(t);if(!f(","))break}return e},literal:function(){return f(this.entities.dimension)||f(this.entities.keywordcolor)||f(this.entities.hexcolor)||f(this.entities.quoted)},url:function(){var t;if("u"===e.charAt(r)&&f(/^url\(/)){t=f(this.entities.quoted)||f(this.entities.variable)||f(/^[\-\w%@_match\/.&=:;#+?~]+/)||"";return f(")")?new Pp.Tree.URL(void 0!==t.value||t instanceof Pp.Tree.Variable?t:new Pp.Tree.Quoted(t)):new Pp.Tree.Invalid(t,n,"Missing closing ) in URL.")}},variable:function(){var s,i=r;if("@"===e.charAt(r)&&(s=f(/^@[\w-]+/)))return new Pp.Tree.Variable(s,i,t.filename)},hexcolor:function(){var t;if("#"===e.charAt(r)&&(t=f(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/)))return new Pp.Tree.Color(t[1])},keywordcolor:function(){var t=o[s].match(/^[a-z]+/);if(t&&t[0]in Pp.Tree.Reference.data.colors)return new Pp.Tree.Color(Pp.Tree.Reference.data.colors[f(/^[a-z]+/)])},dimension:function(){var t=e.charCodeAt(r);if(!(t>57||t<45||47===t)){var s=f(/^(-?\d*\.?\d+(?:[eE][-+]?\d+)?)(\%|\w+)?/);return s?new Pp.Tree.Dimension(s[1],s[2],n):void 0}}},variable:function(){var t;if("@"===e.charAt(r)&&(t=f(/^(@[\w-]+)\s*:/)))return t[1]},entity:function(){var t=f(this.entities.call)||f(this.entities.literal),e=f(this.entities.field)||f(this.entities.variable),r=f(this.entities.url)||f(this.entities.keyword);return t||e||r},end:function(){var t;return f(";")||("string"==typeof(t="}")?e.charAt(r)===t:!!t.test(o[s]))},element:function(){var t=f(/^(?:[.#][\w\u4e00-\u9fa5\-]+|\*|Map)/);if(t)return new Pp.Tree.Element(t)},attachment:function(){var t=f(/^::([\w\-]+(?:\/[\w\-]+)*)/);if(t)return t[1]},selector:function(){for(var t,s,i,a,o,l=[],h=new Pp.Tree.Filterset,u=[],c=0,d=0;(i=f(this.element))||(o=f(this.zoom))||(a=f(this.filter))||(t=f(this.attachment));){if(c++,i)l.push(i);else if(o)u.push(o),d++;else if(a){var p=h.add(a);if(p)throw m({message:p,index:r-1});d++}else{if(s)throw m({message:"Encountered second attachment name.",index:r-1});s=t}var y=e.charAt(r);if("{"===y||"}"===y||";"===y||","===y)break}if(c)return new Pp.Tree.Selector(h,u,l,s,d,n)},filter:function(){c();var e,r,s;if(f("[")&&(e=f(/^[a-zA-Z0-9\-_]+/)||f(this.entities.quoted)||f(this.entities.variable)||f(this.entities.keyword)||f(this.entities.field))&&(e instanceof Pp.Tree.Quoted&&(e=new Pp.Tree.Field(e.toString())),(r=f(this.entities.comparison))&&(s=f(this.entities.quoted)||f(this.entities.variable)||f(this.entities.dimension)||f(this.entities.keyword)||f(this.entities.field)))){if(!f("]"))throw m({message:"Missing closing ] of filter.",index:n-1});return e.is||(e=new Pp.Tree.Field(e)),new Pp.Tree.Filter(e,r,s,n,t.filename)}},zoom:function(){c();var t,e;if(f(/^\[\s*zoom/g)&&(t=f(this.entities.comparison))&&(e=f(this.entities.variable)||f(this.entities.dimension))&&f("]"))return new Pp.Tree.Zoom(t,e,n);d()},block:function(){var t;if(f("{")&&(t=f(this.primary))&&f("}"))return t},ruleset:function(){var t,e,r=[];for(c();t=f(this.selector);){for(r.push(t);f(this.comment););if(!f(","))break;for(;f(this.comment););}if(t)for(;f(this.comment););if(r.length>0&&(e=f(this.block))){if(1===r.length&&r[0].elements.length&&"Map"===r[0].elements[0].value){var s=new Pp.Tree.Ruleset(r,e);return s.isMap=!0,s}return new Pp.Tree.Ruleset(r,e)}d()},rule:function(){var s,i,o=e.charAt(r);if(c(),"."!==o&&"#"!==o&&(s=f(this.variable)||f(this.property))){if((i=f(this.value))&&f(this.end))return new Pp.Tree.Rule(s,i,n,t.filename);a=r,d()}},font:function(){for(var t,e=[],r=[];t=f(this.entity);)r.push(t);if(e.push(new Pp.Tree.Expression(r)),f(","))for(;(t=f(this.expression))&&(e.push(t),f(",")););return new Pp.Tree.Value(e)},value:function(){for(var t,e=[];(t=f(this.expression))&&(e.push(t),f(",")););return e.length>1?new Pp.Tree.Value(e.map(function(t){return t.value[0]})):1===e.length?new Pp.Tree.Value(e):void 0},sub:function(){var t;if(f("(")&&(t=f(this.expression))&&f(")"))return t},multiplication:function(){var t,e,r,s;if(t=f(this.operand)){for(;(r=f("/")||f("*")||f("%"))&&(e=f(this.operand));)s=new Pp.Tree.Operation(r,[s||t,e],n);return s||t}},addition:function(){var t,s,i,a;if(t=f(this.multiplication)){for(;(i=f(/^[-+]\s+/)||" "!=e.charAt(r-1)&&(f("+")||f("-")))&&(s=f(this.multiplication));)a=new Pp.Tree.Operation(i,[a||t,s],n);return a||t}},operand:function(){return f(this.sub)||f(this.entity)},expression:function(){for(var t,e=[];t=f(this.addition)||f(this.entity);)e.push(t);if(e.length>0)return new Pp.Tree.Expression(e)},property:function(){var t=f(/^(([a-z][-a-z_0-9]*\/)?\*?-?[-a-z_0-9]+)\s*:/);if(t)return t[1]}}}}parse(t){var e=this.parser;return this.ruleSet=e.parse(t)}toShaders(){if(this.ruleSet){var t=this.ruleSet;if(t){var e=t.toList(this.env);e.reverse();var r={},s=[];this._toShaders(r,s,e);for(var i=[],n={},a=0,o=e.length;a<o;++a){var l=e[a],h=l.attachment,u=r[s[a]],c=[];if(!n[h]){var d=0;for(var p in u)if("zoom"!==p&&"frames"!==p&&"attachment"!==p&&"elements"!=p)if("layer-index"===p){var f=(u[p].join("\n"),null);Object.defineProperty(c,"layerIndex",{configurable:!0,enumerable:!1,value:f})}else c[d++]=function(t,e){if(!Array.isArray(t))return t;var r=t.join("\n"),s='attributes["FEATUREID"]&&attributes["FEATUREID"]',i=r.indexOf(s);if(i>=0){if(!e.featureFilter){var n=i+s.length,a=r.indexOf(")",n+1),o="featureId&&(featureId"+r.substring(n,a)+")";Object.defineProperty(e,"featureFilter",{configurable:!0,enumerable:!1,value:function(t){return!!o}})}return{property:p,getValue:Function("attributes","zoom","seftFilter","var _value = null; var isExcute=typeof seftFilter=='function'?sefgFilter():seftFilter;if(isExcute){"+r+";} return _value; ")}}return{property:p,getValue:Function("attributes","zoom","var _value = null;"+r+"; return _value; ")}}(u[p],c);Object.defineProperty(c,"attachment",{configurable:!0,enumerable:!1,value:h}),Object.defineProperty(c,"elements",{configurable:!0,enumerable:!1,value:l.elements}),i.push(c),n[s[a]]=!0}Object.defineProperty(c,"zoom",{configurable:!0,enumerable:!1,value:l.zoom})}return i}}return null}_toShaders(t,e,r){for(let s=0,i=r.length;s<i;++s){let i=r[s],n=[];for(let t=0,e=i.elements.length;t<e;t++)n.push(i.elements[t]);let a=i.filters.filters,o=[];for(let t in a)o.push(a[t].id);let l=n.join("/")+"::"+i.attachment+"_"+o.join("_");e.push(l);let h=t[l]=t[l]||{};h.zoom=Pp.Tree.Zoom.all;let u=i.toJS(this.env);for(let t in u)(h[t]=h[t]||[]).push(u[t].join("\n"))}}getShaders(){return this.shaders}destroy(){this.cartoStr=null,this.env=null,this.ruleSet=null,this.parser=null,this.shaders=null}}var Lp={version:"2.1.1",style:{"filter-mode":{type:["all","first"],doc:"Control the processing behavior of Rule filters within a Style. If 'all' is used then all Rules are processed sequentially independent of whether any previous filters matched. If 'first' is used then it means processing ends after the first match (a positive filter evaluation) and no further Rules in the Style are processed ('first' is usually the default for CSS implementations on top of Mapnik to simplify translation from CSS to Mapnik XML)","default-value":"all","default-meaning":"All Rules in a Style are processed whether they have filters or not and whether or not the filter conditions evaluate to true."},"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},layer:{name:{"default-value":"",type:"string",required:!0,"default-meaning":"No layer name has been provided",doc:"The name of a layer. Can be anything you wish and is not strictly validated, but ideally unique  in the map"},srs:{"default-value":"",type:"string","default-meaning":"No srs value is provided and the value will be inherited from the Map's srs",doc:"The spatial reference system definition for the layer, aka the projection. Can either be a proj4 literal string like '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs' or, if the proper proj4 epsg/nad/etc identifier files are installed, a string that uses an id like: '+init=epsg:4326'"},status:{"default-value":!0,type:"boolean","default-meaning":"This layer will be marked as active and available for processing",doc:"A property that can be set to false to disable this layer from being processed"},minzoom:{"default-value":"0",type:"float","default-meaning":"The layer will be visible at the minimum possible scale",doc:"The minimum scale denominator that this layer will be visible at. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},maxzoom:{"default-value":"1.79769e+308",type:"float","default-meaning":"The layer will be visible at the maximum possible scale",doc:"The maximum scale denominator that this layer will be visible at. The default is the numeric limit of the C++ double type, which may vary slightly by system, but is likely a massive number like 1.79769e+308 and ensures that this layer will always be visible unless the value is reduced. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},queryable:{"default-value":!1,type:"boolean","default-meaning":"The layer will not be available for the direct querying of data values",doc:"This property was added for GetFeatureInfo/WMS compatibility and is rarely used. It is off by default meaning that in a WMS context the layer will not be able to be queried unless the property is explicitly set to true"},"clear-label-cache":{"default-value":!1,type:"boolean","default-meaning":"The renderer's collision detector cache (used for avoiding duplicate labels and overlapping markers) will not be cleared immediately before processing this layer",doc:"This property, by default off, can be enabled to allow a user to clear the collision detector cache before a given layer is processed. This may be desirable to ensure that a given layers data shows up on the map even if it normally would not because of collisions with previously rendered labels or markers"},"group-by":{"default-value":"",type:"string","default-meaning":"No special layer grouping will be used during rendering",doc:"https://github.com/mapnik/mapnik/wiki/Grouped-rendering"},"buffer-size":{"default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:"Extra tolerance around the Layer extent (in pixels) used to when querying and (potentially) clipping the layer data during rendering"},"maximum-extent":{"default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query this specific layer data during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Layer."}},symbolizers:{"*":{"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},map:{"background-color":{css:"background-color","default-value":"none","default-meaning":"transparent",type:"color",doc:"Map Background color"},"background-image":{css:"background-image",type:"uri","default-value":"","default-meaning":"transparent",doc:"An image that is repeated below all features on a map as a background.",description:"Map Background image"},srs:{css:"srs",type:"string","default-value":"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","default-meaning":"The proj4 literal of EPSG:4326 is assumed to be the Map's spatial reference and all data from layers within this map will be plotted using this coordinate system. If any layers do not declare an srs value then they will be assumed to be in the same srs as the Map and not transformations will be needed to plot them in the Map's coordinate space",doc:"Map spatial reference (proj4 string)"},"buffer-size":{css:"buffer-size","default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:'Extra tolerance around the map (in pixels) used to ensure labels crossing tile boundaries are equally rendered in each tile (e.g. cut in each tile). Not intended to be used in combination with "avoid-edges".'},"maximum-extent":{css:"","default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query all layers during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Map."},base:{css:"base","default-value":"","default-meaning":"This base path defaults to an empty string meaning that any relative paths to files referenced in styles or layers will be interpreted relative to the application process.",type:"string",doc:"Any relative paths used to reference files will be understood as relative to this directory path if the map is loaded from an in memory object rather than from the filesystem. If the map is loaded from the filesystem and this option is not provided it will be set to the directory of the stylesheet."},"paths-from-xml":{css:"","default-value":!0,"default-meaning":"Paths read from XML will be interpreted from the location of the XML",type:"boolean",doc:"value to control whether paths in the XML will be interpreted from the location of the XML or from the working directory of the program that calls load_map()"},"minimum-version":{css:"","default-value":"none","default-meaning":"Mapnik version will not be detected and no error will be thrown about compatibility",type:"string",doc:"The minumum Mapnik version (e.g. 0.7.2) needed to use certain functionality in the stylesheet"},"font-directory":{css:"font-directory",type:"uri","default-value":"none","default-meaning":"No map-specific fonts will be registered",doc:"Path to a directory which holds fonts which should be registered when the Map is loaded (in addition to any fonts that may be automatically registered)."}},polygon:{fill:{css:"polygon-fill",type:"color","default-value":"rgba(128,128,128,1)","default-meaning":"gray and fully opaque (alpha = 1), same as rgb(128,128,128)",doc:"Fill color to assign to a polygon"},"fill-opacity":{css:"polygon-opacity",type:"float",doc:"The opacity of the polygon","default-value":1,"default-meaning":"opaque"},gamma:{css:"polygon-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon edges"},"gamma-method":{css:"polygon-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},clip:{css:"polygon-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},line:{stroke:{css:"line-color","default-value":"rgba(0,0,0,1)",type:"color","default-meaning":"black and fully opaque (alpha = 1), same as rgb(0,0,0)",doc:"The color of a drawn line"},"stroke-width":{css:"line-width","default-value":1,type:"float",doc:"The width of a line in pixels"},"stroke-opacity":{css:"line-opacity","default-value":1,type:"float","default-meaning":"opaque",doc:"The opacity of a line"},"stroke-linejoin":{css:"line-join","default-value":"miter",type:["miter","round","bevel"],doc:"The behavior of lines when joining"},"stroke-linecap":{css:"line-cap","default-value":"butt",type:["butt","round","square"],doc:"The display of line endings"},"stroke-gamma":{css:"line-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of stroke line"},"stroke-gamma-method":{css:"line-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},"stroke-dasharray":{css:"line-dasharray",type:"numbers",doc:"A pair of length values [a,b], where (a) is the dash length and (b) is the gap length respectively. More than two values are supported for more complex patterns.","default-value":"none","default-meaning":"solid line"},"stroke-dashoffset":{css:"line-dash-offset",type:"numbers",doc:"valid parameter but not currently used in renderers (only exists for experimental svg support in Mapnik which is not yet enabled)","default-value":"none","default-meaning":"solid line"},"stroke-miterlimit":{css:"line-miterlimit",type:"float",doc:"The limit on the ratio of the miter length to the stroke-width. Used to automatically convert miter joins to bevel joins for sharp angles to avoid the miter extending beyond the thickness of the stroking path. Normally will not need to be set, but a larger value can sometimes help avoid jaggy artifacts.","default-value":4,"default-meaning":"Will auto-convert miters to bevel line joins when theta is less than 29 degrees as per the SVG spec: 'miterLength / stroke-width = 1 / sin ( theta / 2 )'"},clip:{css:"line-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},offset:{css:"line-offset",type:"float","default-value":0,"default-meaning":"no offset",doc:"Offsets a line a number of pixels parallel to its actual path. Postive values move the line left, negative values move it right (relative to the directionality of the line)."},rasterizer:{css:"line-rasterizer",type:["full","fast"],"default-value":"full",doc:"Exposes an alternate AGG rendering method that sacrifices some accuracy for speed."},"geometry-transform":{css:"line-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},markers:{file:{css:"marker-file",doc:"An SVG file that this marker shows at each placement. If no file is given, the marker will show an ellipse.","default-value":"","default-meaning":"An ellipse or circle, if width equals height",type:"uri"},opacity:{css:"marker-opacity",doc:"The overall opacity of the marker, if set, overrides both the opacity of both the fill and stroke","default-value":1,"default-meaning":"The stroke-opacity and fill-opacity will be used",type:"float"},"fill-opacity":{css:"marker-fill-opacity",doc:"The fill opacity of the marker","default-value":1,"default-meaning":"opaque",type:"float"},stroke:{css:"marker-line-color",doc:"The color of the stroke around a marker shape.","default-value":"black",type:"color"},"stroke-width":{css:"marker-line-width",doc:"The width of the stroke around a marker shape, in pixels. This is positioned on the boundary, so high values can cover the area itself.",type:"float"},"stroke-opacity":{css:"marker-line-opacity","default-value":1,"default-meaning":"opaque",doc:"The opacity of a line",type:"float"},placement:{css:"marker-placement",type:["point","line","interior"],"default-value":"point","default-meaning":"Place markers at the center point (centroid) of the geometry",doc:"Attempt to place markers on a point, in the center of a polygon, or if markers-placement:line, then multiple times along a line. 'interior' placement can be used to ensure that points placed on polygons are forced to be inside the polygon interior"},"multi-policy":{css:"marker-multi-policy",type:["each","whole","largest"],"default-value":"each","default-meaning":"If a feature contains multiple geometries and the placement type is either point or interior then a marker will be rendered for each",doc:"A special setting to allow the user to control rendering behavior for 'multi-geometries' (when a feature contains multiple geometries). This setting does not apply to markers placed along lines. The 'each' policy is default and means all geometries will get a marker. The 'whole' policy means that the aggregate centroid between all geometries will be used. The 'largest' policy means that only the largest (by bounding box areas) feature will get a rendered marker (this is how text labeling behaves by default)."},"marker-type":{css:"marker-type",type:["arrow","ellipse"],"default-value":"ellipse",doc:"The default marker-type. If a SVG file is not given as the marker-file parameter, the renderer provides either an arrow or an ellipse (a circle if height is equal to width)"},width:{css:"marker-width","default-value":10,doc:"The width of the marker, if using one of the default types.",type:"expression"},height:{css:"marker-height","default-value":10,doc:"The height of the marker, if using one of the default types.",type:"expression"},fill:{css:"marker-fill","default-value":"blue",doc:"The color of the area of the marker.",type:"color"},"allow-overlap":{css:"marker-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping markers are shown or hidden.","default-meaning":"Do not allow makers to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"marker-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},spacing:{css:"marker-spacing",doc:"Space between repeated labels","default-value":100,type:"float"},"max-error":{css:"marker-max-error",type:"float","default-value":.2,doc:"The maximum difference between actual marker placement and the marker-spacing parameter. Setting a high value can allow the renderer to try to resolve placement conflicts with other symbolizers."},transform:{css:"marker-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},clip:{css:"marker-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"marker-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"marker-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"marker-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},shield:{name:{css:"shield-name",type:"expression",serialization:"content",doc:'Value to use for a shield"s text label. Data columns are specified using brackets like [column_name]'},file:{css:"shield-file",required:!0,type:"uri","default-value":"none",doc:"Image file to render behind the shield text"},"face-name":{css:"shield-face-name",type:"string",validate:"font",doc:"Font name and style to use for the shield text","default-value":"",required:!0},"unlock-image":{css:"shield-unlock-image",type:"boolean",doc:"This parameter should be set to true if you are trying to position text beside rather than on top of the shield image","default-value":!1,"default-meaning":"text alignment relative to the shield image uses the center of the image as the anchor for text positioning."},size:{css:"shield-size",type:"float",doc:"The size of the shield text in pixels"},fill:{css:"shield-fill",type:"color",doc:"The color of the shield text"},placement:{css:"shield-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"How this shield should be placed. Point placement attempts to place it on top of points, line places along lines multiple times per feature, vertex places on the vertexes of polygons, and interior attempts to place inside of polygons."},"avoid-edges":{css:"shield-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.",type:"boolean","default-value":!1},"allow-overlap":{css:"shield-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping shields are shown or hidden.","default-meaning":"Do not allow shields to overlap with other map elements already placed."},"minimum-distance":{css:"shield-min-distance",type:"float","default-value":0,doc:"Minimum distance to the next shield symbol, not necessarily the same shield."},spacing:{css:"shield-spacing",type:"float","default-value":0,doc:"The spacing between repeated occurrences of the same shield on a line"},"minimum-padding":{css:"shield-min-padding","default-value":0,doc:"Determines the minimum amount of padding that a shield gets relative to other shields",type:"float"},"wrap-width":{css:"shield-wrap-width",type:"unsigned","default-value":0,doc:"Length of a chunk of text in characters before wrapping text"},"wrap-before":{css:"shield-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"shield-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long names."},"halo-fill":{css:"shield-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"shield-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},"character-spacing":{css:"shield-character-spacing",type:"unsigned","default-value":0,doc:"Horizontal spacing between characters (in pixels). Currently works for point placement only, not line placement."},"line-spacing":{css:"shield-line-spacing",doc:"Vertical spacing between lines of multiline labels (in pixels)",type:"unsigned"},dx:{css:"shield-text-dx",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"shield-text-dy",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"shield-dx":{css:"shield-dx",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},"shield-dy":{css:"shield-dy",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},opacity:{css:"shield-opacity",type:"float",doc:"(Default 1.0) - opacity of the image used for the shield","default-value":1},"text-opacity":{css:"shield-text-opacity",type:"float",doc:"(Default 1.0) - opacity of the text placed on top of the shield","default-value":1},"horizontal-alignment":{css:"shield-horizontal-alignment",type:["left","middle","right","auto"],doc:"The shield's horizontal alignment from its centerpoint","default-value":"auto"},"vertical-alignment":{css:"shield-vertical-alignment",type:["top","middle","bottom","auto"],doc:"The shield's vertical alignment from its centerpoint","default-value":"middle"},"text-transform":{css:"shield-text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"justify-alignment":{css:"shield-justify-alignment",type:["left","center","right","auto"],doc:"Define how text in a shield's label is justified","default-value":"auto"},clip:{css:"shield-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"shield-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"line-pattern":{file:{css:"line-pattern-file",type:"uri","default-value":"none",required:!0,doc:"An image file to be repeated and warped along a line"},clip:{css:"line-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"line-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"polygon-pattern":{file:{css:"polygon-pattern-file",type:"uri","default-value":"none",required:!0,doc:"Image to use as a repeated pattern fill within a polygon"},alignment:{css:"polygon-pattern-alignment",type:["local","global"],"default-value":"local",doc:"Specify whether to align pattern fills to the layer or to the map."},gamma:{css:"polygon-pattern-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon pattern edges"},opacity:{css:"polygon-pattern-opacity",type:"float",doc:"(Default 1.0) - Apply an opacity level to the image used for the pattern","default-value":1,"default-meaning":"The image is rendered without modifications"},clip:{css:"polygon-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},raster:{opacity:{css:"raster-opacity","default-value":1,"default-meaning":"opaque",type:"float",doc:"The opacity of the raster symbolizer on top of other symbolizers."},"filter-factor":{css:"raster-filter-factor","default-value":-1,"default-meaning":"Allow the datasource to choose appropriate downscaling.",type:"float",doc:"This is used by the Raster or Gdal datasources to pre-downscale images using overviews. Higher numbers can sometimes cause much better scaled image output, at the cost of speed."},scaling:{css:"raster-scaling",type:["near","fast","bilinear","bilinear8","bicubic","spline16","spline36","hanning","hamming","hermite","kaiser","quadric","catrom","gaussian","bessel","mitchell","sinc","lanczos","blackman"],"default-value":"near",doc:"The scaling algorithm used to making different resolution versions of this raster layer. Bilinear is a good compromise between speed and accuracy, while lanczos gives the highest quality."},"mesh-size":{css:"raster-mesh-size","default-value":16,"default-meaning":"Reprojection mesh will be 1/16 of the resolution of the source image",type:"unsigned",doc:"A reduced resolution mesh is used for raster reprojection, and the total image size is divided by the mesh-size to determine the quality of that mesh. Values for mesh-size larger than the default will result in faster reprojection but might lead to distortion."},"comp-op":{css:"raster-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},point:{file:{css:"point-file",type:"uri",required:!1,"default-value":"none",doc:"Image file to represent a point"},"allow-overlap":{css:"point-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping points are shown or hidden.","default-meaning":"Do not allow points to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"point-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},opacity:{css:"point-opacity",type:"float","default-value":1,"default-meaning":"Fully opaque",doc:"A value from 0 to 1 to control the opacity of the point"},placement:{css:"point-placement",type:["centroid","interior"],doc:"How this point should be placed. Centroid calculates the geometric center of a polygon, which can be outside of it, while interior always places inside of a polygon.","default-value":"centroid"},transform:{css:"point-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},"comp-op":{css:"point-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},text:{name:{css:"text-name",type:"expression",required:!0,"default-value":"",serialization:"content",doc:"Value to use for a text label. Data columns are specified using brackets like [column_name]"},"face-name":{css:"text-face-name",type:"string",validate:"font",doc:"Font name and style to render a label in",required:!0},size:{css:"text-size",type:"float","default-value":10,doc:"Text size in pixels"},"text-ratio":{css:"text-ratio",doc:"Define the amount of text (of the total) present on successive lines when wrapping occurs","default-value":0,type:"unsigned"},"wrap-width":{css:"text-wrap-width",doc:"Length of a chunk of text in characters before wrapping text","default-value":0,type:"unsigned"},"wrap-before":{css:"text-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"text-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long text."},spacing:{css:"text-spacing",type:"unsigned",doc:"Distance between repeated text labels on a line (aka. label-spacing)"},"character-spacing":{css:"text-character-spacing",type:"float","default-value":0,doc:"Horizontal spacing adjustment between characters in pixels"},"line-spacing":{css:"text-line-spacing","default-value":0,type:"unsigned",doc:"Vertical spacing adjustment between lines in pixels"},"label-position-tolerance":{css:"text-label-position-tolerance","default-value":0,type:"unsigned",doc:"Allows the label to be displaced from its ideal position by a number of pixels (only works with placement:line)"},"max-char-angle-delta":{css:"text-max-char-angle-delta",type:"float","default-value":"22.5",doc:"The maximum angle change, in degrees, allowed between adjacent characters in a label. This value internally is converted to radians to the default is 22.5*math.pi/180.0. The higher the value the fewer labels will be placed around around sharp corners."},fill:{css:"text-fill",doc:"Specifies the color for the text","default-value":"#000000",type:"color"},opacity:{css:"text-opacity",doc:"A number from 0 to 1 specifying the opacity for the text","default-value":1,"default-meaning":"Fully opaque",type:"float"},"halo-fill":{css:"text-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"text-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},dx:{css:"text-dx",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"text-dy",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"vertical-alignment":{css:"text-vertical-alignment",type:["top","middle","bottom","auto"],doc:"Position of label relative to point position.","default-value":"auto","default-meaning":'Default affected by value of dy; "bottom" for dy>0, "top" for dy<0.'},"avoid-edges":{css:"text-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.","default-value":!1,type:"boolean"},"minimum-distance":{css:"text-min-distance",doc:"Minimum permitted distance to the next text symbolizer.",type:"float"},"minimum-padding":{css:"text-min-padding",doc:"Determines the minimum amount of padding that a text symbolizer gets relative to other text",type:"float"},"minimum-path-length":{css:"text-min-path-length",type:"float","default-value":0,"default-meaning":"place labels on all paths",doc:"Place labels only on paths longer than this value."},"allow-overlap":{css:"text-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping text is shown or hidden.","default-meaning":"Do not allow text to overlap with other text - overlapping markers will not be shown."},orientation:{css:"text-orientation",type:"expression",doc:"Rotate the text."},placement:{css:"text-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"Control the style of placement of a point versus the geometry it is attached to."},"placement-type":{css:"text-placement-type",doc:'Re-position and/or re-size text to avoid overlaps. "simple" for basic algorithm (using text-placements string,) "dummy" to turn this feature off.',type:["dummy","simple"],"default-value":"dummy"},placements:{css:"text-placements",type:"string","default-value":"",doc:'If "placement-type" is set to "simple", use this "POSITIONS,[SIZES]" string. An example is `text-placements: "E,NE,SE,W,NW,SW";` '},"text-transform":{css:"text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"horizontal-alignment":{css:"text-horizontal-alignment",type:["left","middle","right","auto"],doc:"The text's horizontal alignment from its centerpoint","default-value":"auto"},"justify-alignment":{css:"text-align",type:["left","right","center","auto"],doc:"Define how text is justified","default-value":"auto","default-meaning":"Auto alignment means that text will be centered by default except when using the `placement-type` parameter - in that case either right or left justification will be used automatically depending on where the text could be fit given the `text-placements` directives"},clip:{css:"text-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"text-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},building:{fill:{css:"building-fill","default-value":"#FFFFFF",doc:"The color of the buildings walls.",type:"color"},"fill-opacity":{css:"building-fill-opacity",type:"float",doc:"The opacity of the building as a whole, including all walls.","default-value":1},height:{css:"building-height",doc:"The height of the building in pixels.",type:"expression","default-value":"0"}}},colors:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50],transparent:[0,0,0,0]},filter:{value:["true","false","null","point","linestring","polygon","collection"]}};Pp.mapnik_reference={version:{latest:Lp,"2.1.1":Lp}},Pp.Tree={},Pp.Tree.operate=function(t,e,r){switch(t){case"+":return e+r;case"-":return e-r;case"*":return e*r;case"%":return e%r;case"/":return e/r}},Pp.Tree.functions={rgb:function(t,e,r){return this.rgba(t,e,r,1)},rgba:function(t,e,r,s){var i=this,n=[t,e,r].map(function(t){return i.number(t)});return s=i.number(s),n.some(isNaN)||isNaN(s)?null:new Pp.Tree.Color(n,s)},stop:function(t){var e,r;return arguments.length>1&&(e=arguments[1]),arguments.length>2&&(r=arguments[2]),{is:"tag",val:t,color:e,mode:r,toString:s=>'\n\t<stop value="'+t.ev(s)+'"'+(e?' color="'+e.ev(s)+'" ':"")+(r?' mode="'+r.ev(s)+'" ':"")+"/>"}},hsl:function(t,e,r){return this.hsla(t,e,r,1)},hsla:function(t,e,r,s){if([t=this.number(t)%360/360,e=this.number(e),r=this.number(r),s=this.number(s)].some(isNaN))return null;var i=r<=.5?r*(e+1):r+e-r*e,n=2*r-i;return this.rgba(255*a(t+1/3),255*a(t),255*a(t-1/3),s);function a(t){return 6*(t=t<0?t+1:t>1?t-1:t)<1?n+(i-n)*t*6:2*t<1?i:3*t<2?n+(i-n)*(2/3-t)*6:n}},hue:function(t){return"toHSL"in t?new Pp.Tree.Dimension(Math.round(t.toHSL().h)):null},saturation:function(t){return"toHSL"in t?new Pp.Tree.Dimension(Math.round(100*t.toHSL().s),"%"):null},lightness:function(t){return"toHSL"in t?new Pp.Tree.Dimension(Math.round(100*t.toHSL().l),"%"):null},alpha:function(t){return"toHSL"in t?new Pp.Tree.Dimension(t.toHSL().a):null},saturate:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.s+=e.value/100,r.s=this.clamp(r.s),this.hsla_simple(r)},desaturate:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.s-=e.value/100,r.s=this.clamp(r.s),this.hsla_simple(r)},lighten:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.l+=e.value/100,r.l=this.clamp(r.l),this.hsla_simple(r)},darken:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.l-=e.value/100,r.l=this.clamp(r.l),this.hsla_simple(r)},fadein:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.a+=e.value/100,r.a=this.clamp(r.a),this.hsla_simple(r)},fadeout:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.a-=e.value/100,r.a=this.clamp(r.a),this.hsla_simple(r)},spin:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL(),s=(r.h+e.value)%360;return r.h=s<0?360+s:s,this.hsla_simple(r)},replace:function(t,e,r){return"field"===t.is?t.toString+".replace("+e.toString()+", "+r.toString()+")":t.replace(e,r)},mix:function(t,e,r){var s=r.value/100,i=2*s-1,n=t.toHSL().a-e.toHSL().a,a=((i*n==-1?i:(i+n)/(1+i*n))+1)/2,o=1-a,l=[t.rgb[0]*a+e.rgb[0]*o,t.rgb[1]*a+e.rgb[1]*o,t.rgb[2]*a+e.rgb[2]*o],h=t.alpha*s+e.alpha*(1-s);return new Pp.Tree.Color(l,h)},greyscale:function(t){return this.desaturate(t,new Pp.Tree.Dimension(100))},"%":function(t){for(var e=Array.prototype.slice.call(arguments,1),r=t.value,s=0;s<e.length;s++)r=r.replace(/%s/,e[s].value).replace(/%[da]/,e[s].toString());return r=r.replace(/%%/g,"%"),new Pp.Tree.Quoted(r)},hsla_simple:function(t){return this.hsla(t.h,t.s,t.l,t.a)},number:function(t){return t instanceof Pp.Tree.Dimension?parseFloat("%"===t.unit?t.value/100:t.value):"number"==typeof t?t:NaN},clamp:function(t){return Math.min(1,Math.max(0,t))}},Pp.Tree.Call=class{constructor(t,e,r){this.is="call",this.name=t,this.args=e,this.index=r}ev(t){for(var e=this.args.map(function(e){return e.ev(t)}),r=0;r<e.length;r++)if("undefined"===e[r].is)return{is:"undefined",value:"undefined"};if(this.name in Pp.Tree.functions){if(Pp.Tree.functions[this.name].length<=e.length){var s=Pp.Tree.functions[this.name].apply(Pp.Tree.functions,e);return null===s?(t.error({message:"incorrect arguments given to "+this.name+"()",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):s}return t.error({message:"incorrect number of arguments for "+this.name+"(). "+Pp.Tree.functions[this.name].length+" expected.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}var i=Pp.Tree.Reference.mapnikFunctions[this.name];if(void 0===i){var n=Op()(Pp.Tree.Reference.mapnikFunctions),a=this.name,o=n.map(function(t){return[t[0],Pp.Tree.Reference.editDistance(a,t[0]),t[1]]}).sort(function(t,e){return t[1]-e[1]});return t.error({message:"unknown function "+this.name+"(), did you mean "+o[0][0]+"("+o[0][2]+")",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}return i!==e.length&&-1!==i?(t.error({message:"function "+this.name+"() takes "+i+" arguments and was given "+e.length,index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):(this.args=e,this)}toString(t,e){return this.args.length?this.name+"("+this.args.join(",")+")":this.name}},Pp.Tree.Color=class{constructor(t,e){this.is="color",Array.isArray(t)?this.rgb=t.slice(0,3):6==t.length?this.rgb=t.match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=t.split("").map(function(t){return parseInt(t+t,16)}),"number"==typeof e?this.alpha=e:4===t.length?this.alpha=t[3]:this.alpha=1}ev(){return this}toString(){return"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")"}operate(t,e,r){var s=[];r instanceof Pp.Tree.Color||(r=r.toColor());for(var i=0;i<3;i++)s[i]=Pp.Tree.operate(e,this.rgb[i],r.rgb[i]);return new Pp.Tree.Color(s)}toHSL(){var t,e,r=this.rgb[0]/255,s=this.rgb[1]/255,i=this.rgb[2]/255,n=this.alpha,a=Math.max(r,s,i),o=Math.min(r,s,i),l=(a+o)/2,h=a-o;if(a===o)t=e=0;else{switch(e=l>.5?h/(2-a-o):h/(a+o),a){case r:t=(s-i)/h+(s<i?6:0);break;case s:t=(i-r)/h+2;break;case i:t=(r-s)/h+4}t/=6}return{h:360*t,s:e,l,a:n}}},Pp.Tree.Comment=class{constructor(t,e){this.value=t,this.silent=!!e}toString(t){return"\x3c!--"+this.value+"--\x3e"}ev(){return this}},Pp.Tree.Definition=class{constructor(t,e){this.elements=t.elements,this.rules=e,this.ruleIndex={};for(var r=0;r<this.rules.length;r++)"zoom"in this.rules[r]&&(this.rules[r]=this.rules[r].clone()),this.rules[r].zoom=t.zoom,this.ruleIndex[this.rules[r].updateID()]=!0;this.filters=t.filters,this.zoom=t.zoom,this.attachment=t.attachment||"__default__",this.specificity=t.specificity()}toString(){for(var t=this.filters.toString(),e=0;e<this.rules.length;e++)t+="\n    "+this.rules[e];return t}toJS(t){var e={},r=this.zoom,s=this.filters.toJS(t),i=[r];function n(r){if(r instanceof Pp.Tree.Rule)e[r.name]=e[r.name]||[],s?e[r.name].push("if("+s+"){"+r.value.toJS(t)+"}"):e[r.name].push(r.value.toJS(t));else if(r instanceof Pp.Tree.Ruleset){var i=r.toJS(t);for(var n in i)for(var a in e[n]=e[n]||[],i[n])e[n].push(i[n][a])}}for(var a in s&&i.push(s),s=i.join(" && "),this.rules)n(this.rules[a]);return e}},Pp.Tree.Dimension=class{constructor(t,e,r){this.is="float",this.physical_units=["m","cm","in","mm","pt","pc"],this.screen_units=["px","%"],this.all_units=["m","cm","in","mm","pt","pc","px","%"],this.densities={m:.0254,mm:25.4,cm:2.54,pt:72,pc:6},this.value=parseFloat(t),this.unit=e||null,this.index=r}ev(t){if(this.unit&&this.all_units.indexOf(this.unit)<0)return t.error({message:"Invalid unit: '"+this.unit+"'",index:this.index}),{is:"undefined",value:"undefined"};if(this.unit&&this.physical_units.indexOf(this.unit)>=0){if(!t.ppi)return t.error({message:"ppi is not set, so metric units can't be used",index:this.index}),{is:"undefined",value:"undefined"};this.value=this.value/this.densities[this.unit]*t.ppi,this.unit="px"}return this}toColor(){return new Pp.Tree.Color([this.value,this.value,this.value])}round(){return this.value=Math.round(this.value),this}toString(){return this.value.toString()}operate(t,e,r){return"%"===this.unit&&"%"!==r.unit?(t.error({message:"If two operands differ, the first must not be %",index:this.index}),{is:"undefined",value:"undefined"}):"%"!==this.unit&&"%"===r.unit?"*"===e||"/"===e||"%"===e?(t.error({message:"Percent values can only be added or subtracted from other values",index:this.index}),{is:"undefined",value:"undefined"}):new Pp.Tree.Dimension(Pp.Tree.operate(e,this.value,this.value*r.value*.01),this.unit):new Pp.Tree.Dimension(Pp.Tree.operate(e,this.value,r.value),this.unit||r.unit)}},Pp.Tree.Element=class{constructor(t){this.value=t.trim(),"#"===this.value[0]&&(this.type="id",this.clean=this.value.replace(/^#/,"")),"."===this.value[0]&&(this.type="class",this.clean=this.value.replace(/^\./,"")),-1!==this.value.indexOf("*")&&(this.type="wildcard")}specificity(){return["id"===this.type?1:0,"class"===this.type?1:0]}toString(){return this.value}},Pp.Tree.Expression=class{constructor(t){this.is="expression",this.value=t}ev(t){return this.value.length>1?new Pp.Tree.Expression(this.value.map(function(e){return e.ev(t)})):this.value[0].ev(t)}toString(t){return this.value.map(function(e){return e.toString(t)}).join(" ")}},Pp.Tree.Field=class{constructor(t){this.is="field",this.value=t||""}toString(){return'["'+this.value.toUpperCase()+'"]'}ev(){return this}},Pp.Tree.Filter=class{constructor(t,e,r,s,i){this.ops={"<":[" &lt; ","numeric"],">":[" &gt; ","numeric"],"=":[" = ","both"],"!=":[" != ","both"],"<=":[" &lt;= ","numeric"],">=":[" &gt;= ","numeric"],"=~":[".match(","string",")"]},this.key=t,this.op=e,this.val=r,this.index=s,this.filename=i,this.id=this.key+this.op+this.val}ev(t){return this.key=this.key.ev(t),this.val=this.val.ev(t),this}toString(){return"["+this.id+"]"}},Pp.Tree.Filterset=class{constructor(){this.filters={}}toJS(t){function e(t){var e=t.op;"="===e&&(e="==");var r=t.val;void 0!==t._val&&(r=t._val.toString(!0)),t.key&&"scale"===t.key.value?r=+r:"string"!=typeof r&&"object"!=typeof r||(r="'"+r+"'");var s="attributes";return s+"&&"+s+t.key+"&&"+s+t.key+" "+e+r}var r=[];for(var s in this.filters)r.push(e(this.filters[s]));return r.join(" && ")}toString(){var t=[];for(var e in this.filters)t.push(this.filters[e].id);return t.sort().join("\t")}ev(t){for(var e in this.filters)this.filters[e].ev(t);return this}clone(){var t=new Pp.Tree.Filterset;for(var e in this.filters)t.filters[e]=this.filters[e];return t}cloneWith(t){var e=[];for(var r in t.filters){var s=this.addable(t.filters[r]);if(!1===s)return!1;!0===s&&e.push(t.filters[r])}if(!e.length)return null;var i=new Pp.Tree.Filterset;for(r in this.filters)i.filters[r]=this.filters[r];for(;r=e.shift();)i.add(r);return i}addable(t){var e=t.key.toString(),r=t.val.toString();switch(r.match(/^[0-9]+(\.[0-9]*)?_match/)&&(r=parseFloat(r)),t.op){case"=":return void 0!==this.filters[e+"="]?this.filters[e+"="].val.toString()==r&&null:void 0===this.filters[e+"!="+r]&&(!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)&&!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r))));case"=~":return!0;case"!=":return void 0!==this.filters[e+"="]?this.filters[e+"="].val!==r&&null:void 0!==this.filters[e+"!="+r]?null:void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)||null;case">":return e+"="in this.filters?!(this.filters[e+"="].val<=r)&&null:!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<=r)&&(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)||null));case">=":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val<r)&&null:!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)&&(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>=r)||null));case"<":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val>=r)&&null:!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>=r)&&(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)||null));case"<=":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val>r)&&null:!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)&&(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<=r)||null))}}conflict(t){var e=t.key.toString(),r=t.val.toString();return isNaN(parseFloat(r))||(r=parseFloat(r)),("="===t.op&&void 0!==this.filters[e+"="]&&r!=this.filters[e+"="].val.toString()||"!="===t.op&&void 0!==this.filters[e+"="]&&r==this.filters[e+"="].val.toString()||"="===t.op&&void 0!==this.filters[e+"!="]&&r===this.filters[e+"!="].val.toString())&&t.toString()+" added to "+this.toString()+" produces an invalid filter"}add(t,e){var r,s=t.key.toString(),i=t.op,n=this.conflict(t);if(n)return n;if("="===i){for(var a in this.filters)this.filters[a].key===s&&delete this.filters[a];this.filters[s+"="]=t}else if("!="===i)this.filters[s+"!="+t.val]=t;else if("=~"===i)this.filters[s+"=~"+t.val]=t;else if(">"===i){for(var o in this.filters)this.filters[o].key===s&&this.filters[o].val<=t.val&&delete this.filters[o];this.filters[s+">"]=t}else if(">="===i){for(var l in this.filters)r=+this.filters[l].val.toString(),this.filters[l].key===s&&r<t.val&&delete this.filters[l];void 0!==this.filters[s+"!="+t.val]?(delete this.filters[s+"!="+t.val],t.op=">",this.filters[s+">"]=t):this.filters[s+">="]=t}else if("<"===i){for(var h in this.filters)r=+this.filters[h].val.toString(),this.filters[h].key===s&&r>=t.val&&delete this.filters[h];this.filters[s+"<"]=t}else if("<="===i){for(var u in this.filters)r=+this.filters[u].val.toString(),this.filters[u].key===s&&r>t.val&&delete this.filters[u];void 0!==this.filters[s+"!="+t.val]?(delete this.filters[s+"!="+t.val],t.op="<",this.filters[s+"<"]=t):this.filters[s+"<="]=t}}},Pp.Tree.Fontset=class{constructor(t,e){this.fonts=e,this.name="fontset-"+t.effects.length}},Pp.Tree.Invalid=class{constructor(t,e,r){this.is="invalid",this.chunk=t,this.index=e,this.type="syntax",this.message=r||"Invalid code: "+this.chunk}ev(t){return t.error({chunk:this.chunk,index:this.index,type:"syntax",message:this.message||"Invalid code: "+this.chunk}),{is:"undefined"}}},Pp.Tree.Keyword=class{ev(){return this}constructor(t){this.value=t;var e={transparent:"color",true:"boolean",false:"boolean"};this.is=e[t]?e[t]:"keyword"}toString(){return this.value}},Pp.Tree.Literal=class{constructor(t){this.value=t||"",this.is="field"}toString(){return this.value}ev(){return this}},Pp.Tree.Operation=class{constructor(t,e,r){this.is="operation",this.op=t.trim(),this.operands=e,this.index=r}ev(t){var e,r=this.operands[0].ev(t),s=this.operands[1].ev(t);return"undefined"===r.is||"undefined"===s.is?{is:"undefined",value:"undefined"}:(r instanceof Pp.Tree.Dimension&&s instanceof Pp.Tree.Color&&("*"===this.op||"+"===this.op?(e=s,s=r,r=e):t.error({name:"OperationError",message:"Can't substract or divide a color from a number",index:this.index})),r instanceof Pp.Tree.Quoted&&s instanceof Pp.Tree.Quoted&&"+"!==this.op?(t.error({message:"Can't subtract, divide, or multiply strings.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):r instanceof Pp.Tree.Field||s instanceof Pp.Tree.Field||r instanceof Pp.Tree.Literal||s instanceof Pp.Tree.Literal?"color"===r.is||"color"===s.is?(t.error({message:"Can't subtract, divide, or multiply colors in expressions.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):new Pp.Tree.Literal(r.ev(t).toString(!0)+this.op+s.ev(t).toString(!0)):void 0===r.operate?(t.error({message:"Cannot do math with type "+r.is+".",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):r.operate(t,this.op,s))}},Pp.Tree.Quoted=class{constructor(t){this.is="string",this.value=t||""}toString(t){var e=this.value.replace(/&/g,"&amp;"),r=e.replace(/\'/g,"\\'").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/\>/g,"&gt;");return!0===t?"'"+r+"'":e}ev(){return this}operate(t,e,r){return new Pp.Tree.Quoted(Pp.Tree.operate(e,this.toString(),r.toString(this.contains_field)))}},Pp.Tree.Reference={_validateValue:{font:function(t,e){return!t.validation_data||!t.validation_data.fonts||-1!=t.validation_data.fonts.indexOf(e)}},setData:function(t){this.data=t,this.selector_cache=function(t){var e={};for(var r in t.symbolizers)for(var s in t.symbolizers[r])t.symbolizers[r][s].hasOwnProperty("css")&&(e[t.symbolizers[r][s].css]=[t.symbolizers[r][s],r,s]);return e}(t),this.mapnikFunctions=function(t){var e={};for(var r in t.symbolizers)for(var s in t.symbolizers[r])if("functions"===t.symbolizers[r][s].type)for(var i=0;i<t.symbolizers[r][s].functions.length;i++){var n=t.symbolizers[r][s].functions[i];e[n[0]]=n[1]}return e}(t),this.required_cache=function(t){var e={};for(var r in t.symbolizers)for(var s in e[r]=[],t.symbolizers[r])t.symbolizers[r][s].required&&e[r].push(t.symbolizers[r][s].css);return e}(t)},setVersion:function(t){return!!Pp.mapnik_reference.version.hasOwnProperty(t)&&(this.setData(Pp.mapnik_reference.version[t]),!0)},selectorData:function(t,e){if(this.selector_cache&&this.selector_cache[t])return this.selector_cache[t][e]},validSelector:function(t){return!!this.selector_cache[t]},selectorName:function(t){return this.selectorData(t,2)},selector:function(t){return this.selectorData(t,0)},symbolizer:function(t){return this.selectorData(t,1)},requiredProperties:function(t,e){var r=this.required_cache[t];for(var s in r)if(!(r[s]in e))return"Property "+r[s]+" required for defining "+t+" styles."},isFont:function(t){return"font"===this.selector(t).validate},editDistance:function(t,e){if(0===t.length)return e.length;if(0===e.length)return t.length;for(var r=[],s=0;s<=e.length;s++)r[s]=[s];for(var i=0;i<=t.length;i++)r[0][i]=i;for(s=1;s<=e.length;s++)for(i=1;i<=t.length;i++)e.charAt(s-1)===t.charAt(i-1)?r[s][i]=r[s-1][i-1]:r[s][i]=Math.min(r[s-1][i-1]+1,Math.min(r[s][i-1]+1,r[s-1][i]+1));return r[e.length][t.length]},validValue:function(t,e,r){var s;if(this.selector(e)){if("keyword"===r.value[0].is)return function(t,e){return"object"==typeof this.selector(e).type?-1!==this.selector(e).type.indexOf(t.value[0].value):"string"===this.selector(e).type}(r,e);if("undefined"===r.value[0].is)return!0;if("numbers"===this.selector(e).type){for(s in r.value)if("float"!==r.value[s].is)return!1;return!0}if("tags"===this.selector(e).type){if(!r.value)return!1;if(!r.value[0].value)return"tag"===r.value[0].is;for(s=0;s<r.value[0].value.length;s++)if("tag"!==r.value[0].value[s].is)return!1;return!0}if("functions"==this.selector(e).type)return function(t,e){if("string"===t.value[0].is)return!0;for(var r in t.value)for(var s in t.value[r].value){if("call"!==t.value[r].value[s].is)return!1;var i=find(this.selector(e).functions,function(e){return e[0]===t.value[r].value[s].name});if(!(i&&-1===i[1]||i&&i[1]===t.value[r].value[s].args.length))return!1}return!0}(r,e);if("expression"===this.selector(e).type)return!0;if("unsigned"===this.selector(e).type)return"float"===r.value[0].is&&(r.value[0].round(),!0);if(this.selector(e).validate){for(s=0;s<r.value.length;s++)if(this.selector(e).type===r.value[s].is&&this._validateValue[this.selector(e).validate](t,r.value[s].value))return!0;return!1}return this.selector(e).type===r.value[0].is}return!1}},Pp.Tree.Reference.setVersion("latest"),Pp.Tree.Rule=class{constructor(t,e,r,s){this.is="rule";var i=t.split("/");this.name=i.pop(),this.instance=i.length?i[0]:"__default__",this.value=e instanceof Pp.Tree.Value?e:new Pp.Tree.Value([e]),this.index=r,this.symbolizer=Pp.Tree.Reference.symbolizer(this.name),this.filename=s,this.variable="@"===t.charAt(0)}clone(){var t=Object.create(Pp.Tree.Rule.prototype);return t.name=this.name,t.value=this.value,t.index=this.index,t.instance=this.instance,t.symbolizer=this.symbolizer,t.filename=this.filename,t.variable=this.variable,t}updateID(){return this.id=this.zoom+"#"+this.instance+"#"+this.name}toString(){return"["+Pp.Tree.Zoom.toString(this.zoom)+"] "+this.name+": "+this.value}ev(t){return new Pp.Tree.Rule(this.name,this.value.ev(t),this.index,this.filename)}},Pp.Tree.Ruleset=class{constructor(t,e){this.is="ruleset",this.selectors=t,this.rules=e,this._lookups={}}ev(t){var e,r,s=new Pp.Tree.Ruleset(this.selectors,this.rules.slice(0));for(s.root=this.root,t.frames.unshift(s),e=0;e<s.rules.length;e++)r=s.rules[e],s.rules[e]=r.ev?r.ev(t):r;return t.frames.shift(),s}match(t){return!t||0===t.length}variables(){return this._variables?this._variables:this._variables=this.rules.reduce(function(t,e){return e instanceof Pp.Tree.Rule&&!0===e.variable&&(t[e.name]=e),t},{})}variable(t){return this.variables()[t]}rulesets(){return this._rulesets?this._rulesets:this._rulesets=this.rules.filter(function(t){return t instanceof Pp.Tree.Ruleset})}find(t,e){e=e||this;var r=[],s=t.toString();return s in this._lookups?this._lookups[s]:(this.rulesets().forEach(function(s){if(s!==e)for(var i=0;i<s.selectors.length;i++)if(t.match(s.selectors[i])){t.elements.length>1?Array.prototype.push.apply(r,s.find(new Pp.Tree.Selector(null,null,t.elements.slice(1)),e)):r.push(s);break}}),this._lookups[s]=r)}evZooms(t){for(var e=0;e<this.selectors.length;e++){for(var r=Pp.Tree.Zoom.all,s=0;s<this.selectors[e].zoom.length;s++)r=this.selectors[e].zoom[s].ev(t).zoom;this.selectors[e].zoom=r}}flatten(t,e,r){var s,i,n=[];for(0===this.selectors.length&&(r.frames=r.frames.concat(this.rules)),this.evZooms(r),s=0;s<this.selectors.length;s++){var a=this.selectors[s];if(a.filters)if(e.length)for(i=0;i<e.length;i++){var o=e[i],l=o.filters.cloneWith(a.filters);if(null===l){if(o.zoom===a.zoom&&o.attachment===a.attachment&&o.elements.join()===a.elements.join()){n.push(o);continue}l=o.filters}else if(!l)continue;var h=Object.create(Pp.Tree.Selector.prototype);h.filters=l,h.zoom=a.zoom,h.elements=o.elements.concat(a.elements),o.attachment&&a.attachment?h.attachment=o.attachment+"/"+a.attachment:h.attachment=a.attachment||o.attachment,h.conditions=o.conditions+a.conditions,h.index=a.index,n.push(h)}else n.push(a)}var u=[];for(s=0;s<this.rules.length;s++){var c=this.rules[s];c instanceof Pp.Tree.Ruleset?c.flatten(t,n,r):c instanceof Pp.Tree.Rule?u.push(c):c instanceof Pp.Tree.Invalid&&r.error(c)}var d=!!u.length&&u[0].index;for(s=0;s<n.length;s++)!1!==d&&(n[s].index=d),t.push(new Pp.Tree.Definition(n[s],u.slice()));return t}},Pp.Tree.Selector=class{constructor(t,e,r,s,i,n){this.elements=r||[],this.attachment=s,this.filters=t||{},this.zoom=void 0!==e?e:Pp.Tree.Zoom.all,this.conditions=i,this.index=n}specificity(){return this.elements.reduce(function(t,e){var r=e.specificity();return t[0]+=r[0],t[1]+=r[1],t},[0,0,this.conditions,this.index])}},Pp.Tree.URL=class{constructor(t,e){this.is="uri",this.value=t,this.paths=e}toString(){return this.value.toString()}ev(t){return new Pp.Tree.URL(this.value.ev(t),this.paths)}},Pp.Tree.Value=class{constructor(t){this.is="value",this.value=t}ev(t){return 1===this.value.length?this.value[0].ev(t):new Pp.Tree.Value(this.value.map(function(e){return e.ev(t)}))}toJS(t){var e=this.ev(t),r=e.toString();return"color"===e.is||"uri"===e.is||"string"===e.is||"keyword"===e.is?r="'"+r+"'":"field"===e.is?r=r.replace(/\[(.*)\]/g,"attributes['_match1']"):e.value&&"object"==typeof e.value&&(r="["+r+"]"),"_value = "+r+";"}toString(t,e,r,s){return this.value.map(function(e){return e.toString(t,s)}).join(r||", ")}clone(){var t=Object.create(Pp.Tree.Value.prototype);return Array.isArray(t)?t.value=this.value.slice():t.value=this.value,t.is=this.is,t}},Pp.Tree.Variable=class{constructor(t,e,r){this.is="variable",this.name=t,this.index=e,this.filename=r}toString(){return this.name}ev(t){if(this._css)return this._css;var e=t.frames.filter(function(t){return t.name===this.name}.bind(this));return e.length?e[0].value.ev(t):(t.error({message:"variable "+this.name+" is undefined",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"})}},Pp.Tree.Zoom=class{constructor(t,e,r){this.op=t,this.value=e,this.index=r}setZoom(t){return this.zoom=t,this}ev(t){var e=parseInt(this.value.ev(t).toString(),10);switch((e>Pp.Tree.Zoom.maxZoom||e<0)&&t.error({message:"Only zoom levels between 0 and "+Pp.Tree.Zoom.maxZoom+" supported.",index:this.index}),this.op){case"=":return this.zoom="zoom && zoom === "+e,this;case">":this.zoom="zoom && zoom > "+e;break;case">=":this.zoom="zoom && zoom >= "+e;break;case"<":this.zoom="zoom && zoom < "+e;break;case"<=":this.zoom="zoom && zoom <= "+e}return this}toString(){for(var t="",e=0;e<=Pp.Tree.Zoom.maxZoom;e++)t+=this.zoom&1<<e?"X":".";return t}},Pp.Tree.Zoom.all=23,Pp.Tree.Zoom.maxZoom=22,Pp.Tree.Zoom.ranges={0:1e9,1:5e8,2:2e8,3:1e8,4:5e7,5:25e6,6:125e5,7:65e5,8:3e6,9:15e5,10:75e4,11:4e5,12:2e5,13:1e5,14:5e4,15:25e3,16:12500,17:5e3,18:2500,19:1500,20:750,21:500,22:250,23:100};class Ip{constructor(){this.refOriginalPosition=[0,0],this.refDataID=null,this.isHoverByRefDataID=!1,this.refDataHoverGroup=null,this.dataInfo=null,this.clickable=!0,this.hoverable=!0,this.style=null,this.highlightStyle={},this.CLASS_NAME="SuperMap.Feature.ShapeParameters"}destroy(){this.refOriginalPosition=null,this.refDataID=null,this.isHoverByRefDataID=null,this.refDataHoverGroup=null,this.dataInfo=null,this.clickable=null,this.hoverable=null,this.style=null,this.highlightStyle=null}}class Np extends Ip{constructor(t,e){super(t,e),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=6,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Point"}destroy(){this.x=null,this.y=null,this.r=null,super.destroy()}}class kp extends Ip{constructor(t){super(t),this.pointList=t,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Line"}destroy(){this.pointList=null,super.destroy()}}class Rp extends Ip{constructor(t){super(t),this.pointList=t,this.holePolygonPointLists=null,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Polygon"}destroy(){this.pointList=null,this.holePolygonPointLists=null,super.destroy()}}class Dp extends Ip{constructor(t,e,r,s){super(t,e,r,s),this.x=isNaN(t)?0:t,this.y=isNaN(t)?0:e,this.width=isNaN(r)?0:r,this.height=isNaN(s)?0:s,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Rectangle"}destroy(){this.x=null,this.y=null,this.width=null,this.height=null,super.destroy()}}class Fp extends Ip{constructor(t,e,r,s,i,n,a){super(t,e,r,s,i,n,a),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=isNaN(r)?0:r,this.startAngle=isNaN(s)?0:s,this.endAngle=isNaN(i)?0:i,this.r0=isNaN(n)?0:n,this.clockWise=a,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Sector"}destroy(){this.x=null,this.y=null,this.r=null,this.startAngle=null,this.endAngle=null,this.r0=null,this.clockWise=null,super.destroy()}}class Bp extends Ip{constructor(t,e,r){super(t,e,r),this.x=t,this.y=e,this.text=r,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Label"}destroy(){this.x=null,this.y=null,this.text=null,super.destroy()}}class Gp extends Ip{constructor(t,e,r,s,i,n,a,o,l){super(t,e,r,s,i,n,a,o,l),this.x=t,this.y=e,this.image=r,this.width=s,this.height=i,this.sx=n,this.sy=a,this.sWidth=o,this.sHeight=l,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Image"}destroy(){this.x=null,this.y=null,this.image=null,this.width=null,this.height=null,this.sx=null,this.sy=null,this.sWidth=null,this.sHeight=null,super.destroy()}}class jp extends Ip{constructor(t,e,r){super(t,e,r),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=isNaN(r)?0:r,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Circle"}destroy(){this.x=null,this.y=null,this.r=null,super.destroy()}}class Up{constructor(){this._handlers={},this.CLASS_NAME="SuperMap.LevelRenderer.Eventful"}destroy(){this._handlers=null}one(t,e,r){var s=this._handlers;return e&&t?(s[t]||(s[t]=[]),s[t].push({h:e,one:!0,ctx:r||this}),this):this}bind(t,e,r){var s=this._handlers;return e&&t?(s[t]||(s[t]=[]),s[t].push({h:e,one:!1,ctx:r||this}),this):this}unbind(t,e){var r=this._handlers;if(!t)return this._handlers={},this;if(e){if(r[t]){for(var s=[],i=0,n=r[t].length;i<n;i++)r[t][i].h!=e&&s.push(r[t][i]);r[t]=s}r[t]&&0===r[t].length&&delete r[t]}else delete r[t];return this}dispatch(t){if(this._handlers[t]){var e=arguments,r=e.length;r>3&&(e=Array.prototype.slice.call(e,1));for(var s=this._handlers[t],i=s.length,n=0;n<i;){switch(r){case 1:s[n].h.call(s[n].ctx);break;case 2:s[n].h.call(s[n].ctx,e[1]);break;case 3:s[n].h.call(s[n].ctx,e[1],e[2]);break;default:s[n].h.apply(s[n].ctx,e)}s[n].one?(s.splice(n,1),i--):n++}}return this}dispatchWithContext(t){if(this._handlers[t]){var e=arguments,r=e.length;r>4&&(e=Array.prototype.slice.call(e,1,e.length-1));for(var s=e[e.length-1],i=this._handlers[t],n=i.length,a=0;a<n;){switch(r){case 1:i[a].h.call(s);break;case 2:i[a].h.call(s,e[1]);break;case 3:i[a].h.call(s,e[1],e[2]);break;default:i[a].h.apply(s,e)}i[a].one?(i.splice(a,1),n--):a++}}return this}}class Jp{constructor(){this.ArrayCtor="undefined"==typeof Float32Array?Array:Float32Array,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Vector"}create(t,e){var r=new(0,this.ArrayCtor)(2);return r[0]=t||0,r[1]=e||0,r}copy(t,e){return t[0]=e[0],t[1]=e[1],t}set(t,e,r){return t[0]=e,t[1]=r,t}add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t}sub(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}len(t){return Math.sqrt(this.lenSquare(t))}lenSquare(t){return t[0]*t[0]+t[1]*t[1]}mul(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}div(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}dot(t,e){return t[0]*e[0]+t[1]*e[1]}scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}normalize(t,e){var r=this.len(e);return 0===r?(t[0]=0,t[1]=0):(t[0]=e[0]/r,t[1]=e[1]/r),t}distance(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}distanceSquare(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}lerp(t,e,r,s){return t[0]=e[0]+s*(r[0]-e[0]),t[1]=e[1]+s*(r[1]-e[1]),t}applyTransform(t,e,r){var s=e[0],i=e[1];return t[0]=r[0]*s+r[2]*i+r[4],t[1]=r[1]*s+r[3]*i+r[5],t}min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}length(t){return this.len(t)}lengthSquare(t){return this.lenSquare(t)}dist(t,e){return this.distance(t,e)}distSquare(t,e){return this.distanceSquare(t,e)}}class zp{constructor(){this.vector=new Jp,this.EPSILON=1e-4,this.THREE_SQRT=Math.sqrt(3),this.ONE_THIRD=1/3,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Curve"}isAroundZero(t){return t>-this.EPSILON&&t<this.EPSILON}isNotAroundZero(t){return t>this.EPSILON||t<-this.EPSILON}cubicAt(t,e,r,s,i){var n=1-i;return n*n*(n*t+3*i*e)+i*i*(i*s+3*n*r)}cubicDerivativeAt(t,e,r,s,i){var n=1-i;return 3*(((e-t)*n+2*(r-e)*i)*n+(s-r)*i*i)}cubicRootAt(t,e,r,s,i,n){var a=s+3*(e-r)-t,o=3*(r-2*e+t),l=3*(e-t),h=t-i,u=o*o-3*a*l,c=o*l-9*a*h,d=l*l-3*o*h,p=0;if(this.isAroundZero(u)&&this.isAroundZero(c))if(this.isAroundZero(o))n[0]=0;else{let t=-l/o;t>=0&&t<=1&&(n[p++]=t)}else{var f=c*c-4*u*d;if(this.isAroundZero(f)){var m=c/u;let t=-o/a+m,e=-m/2;t>=0&&t<=1&&(n[p++]=t),e>=0&&e<=1&&(n[p++]=e)}else if(f>0){let t=Math.sqrt(f),e=u*o+1.5*a*(-c+t),r=u*o+1.5*a*(-c-t),s=(-o-((e=e<0?-Math.pow(-e,this.ONE_THIRD):Math.pow(e,this.ONE_THIRD))+(r=r<0?-Math.pow(-r,this.ONE_THIRD):Math.pow(r,this.ONE_THIRD))))/(3*a);s>=0&&s<=1&&(n[p++]=s)}else{var y=(2*u*o-3*a*c)/(2*Math.sqrt(u*u*u)),g=Math.acos(y)/3,v=Math.sqrt(u),b=Math.cos(g);let t=(-o-2*v*b)/(3*a),e=(-o+v*(b+this.THREE_SQRT*Math.sin(g)))/(3*a),r=(-o+v*(b-this.THREE_SQRT*Math.sin(g)))/(3*a);t>=0&&t<=1&&(n[p++]=t),e>=0&&e<=1&&(n[p++]=e),r>=0&&r<=1&&(n[p++]=r)}}return p}cubicExtrema(t,e,r,s,i){var n=6*r-12*e+6*t,a=9*e+3*s-3*t-9*r,o=3*e-3*t,l=0;if(this.isAroundZero(a)){if(this.isNotAroundZero(n)){let t=-o/n;t>=0&&t<=1&&(i[l++]=t)}}else{var h=n*n-4*a*o;if(this.isAroundZero(h))i[0]=-n/(2*a);else if(h>0){let t=Math.sqrt(h),e=(-n+t)/(2*a),r=(-n-t)/(2*a);e>=0&&e<=1&&(i[l++]=e),r>=0&&r<=1&&(i[l++]=r)}}return l}cubicSubdivide(t,e,r,s,i,n){var a=(e-t)*i+t,o=(r-e)*i+e,l=(s-r)*i+r,h=(o-a)*i+a,u=(l-o)*i+o,c=(u-h)*i+h;n[0]=t,n[1]=a,n[2]=h,n[3]=c,n[4]=c,n[5]=u,n[6]=l,n[7]=s}cubicProjectPoint(t,e,r,s,i,n,a,o,l,h,u){var c,d=this.vector.create(),p=this.vector.create(),f=this.vector.create(),m=.005,y=1/0;d[0]=l,d[1]=h;for(let l=0;l<1;l+=.05){p[0]=this.cubicAt(t,r,i,a,l),p[1]=this.cubicAt(e,s,n,o,l);let h=this.vector.distSquare(d,p);h<y&&(c=l,y=h)}y=1/0;for(let l=0;l<32&&!(m<this.EPSILON);l++){let l=c-m,h=c+m;p[0]=this.cubicAt(t,r,i,a,l),p[1]=this.cubicAt(e,s,n,o,l);let u=this.vector.distSquare(p,d);if(l>=0&&u<y)c=l,y=u;else{f[0]=this.cubicAt(t,r,i,a,h),f[1]=this.cubicAt(e,s,n,o,h);let l=this.vector.distSquare(f,d);h<=1&&l<y?(c=h,y=l):m*=.5}}return u&&(u[0]=this.cubicAt(t,r,i,a,c),u[1]=this.cubicAt(e,s,n,o,c)),Math.sqrt(y)}quadraticAt(t,e,r,s){var i=1-s;return i*(i*t+2*s*e)+s*s*r}quadraticDerivativeAt(t,e,r,s){return 2*((1-s)*(e-t)+s*(r-e))}quadraticRootAt(t,e,r,s,i){var n=t-2*e+r,a=2*(e-t),o=t-s,l=0;if(this.isAroundZero(n)){if(this.isNotAroundZero(a)){var h=-o/a;h>=0&&h<=1&&(i[l++]=h)}}else{var u=a*a-4*n*o;if(this.isAroundZero(u)){let t=-a/(2*n);t>=0&&t<=1&&(i[l++]=t)}else if(u>0){let t=Math.sqrt(u),e=(-a+t)/(2*n),r=(-a-t)/(2*n);e>=0&&e<=1&&(i[l++]=e),r>=0&&r<=1&&(i[l++]=r)}}return l}quadraticExtremum(t,e,r){var s=t+r-2*e;return 0===s?.5:(t-e)/s}quadraticProjectPoint(t,e,r,s,i,n,a,o,l){var h,u=this.vector.create(),c=this.vector.create(),d=this.vector.create(),p=.005,f=1/0;u[0]=a,u[1]=o;for(let a=0;a<1;a+=.05){c[0]=this.quadraticAt(t,r,i,a),c[1]=this.quadraticAt(e,s,n,a);let o=this.vector.distSquare(u,c);o<f&&(h=a,f=o)}f=1/0;for(let a=0;a<32&&!(p<this.EPSILON);a++){let a=h-p,o=h+p;c[0]=this.quadraticAt(t,r,i,a),c[1]=this.quadraticAt(e,s,n,a);let l=this.vector.distSquare(c,u);if(a>=0&&l<f)h=a,f=l;else{d[0]=this.quadraticAt(t,r,i,o),d[1]=this.quadraticAt(e,s,n,o);let a=this.vector.distSquare(d,u);o<=1&&a<f?(h=o,f=a):p*=.5}}return l&&(l[0]=this.quadraticAt(t,r,i,h),l[1]=this.quadraticAt(e,s,n,h)),Math.sqrt(f)}}class qp{}qp.EVENT={RESIZE:"resize",CLICK:"click",DBLCLICK:"dblclick",MOUSEWHEEL:"mousewheel",MOUSEMOVE:"mousemove",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",GLOBALOUT:"globalout",DRAGSTART:"dragstart",DRAGEND:"dragend",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",touchClickDelay:300},qp.catchBrushException=!1,qp.debugMode=0;class Vp{static SUtil_smoothBezier(t,e,r,s,i){i&&2===i.length||(i=[0,0]);var n,a,o=i,l=[],h=[],u=[],c=[],d=!!s;if(d){n=[1/0,1/0],a=[-1/0,-1/0];let e=t.length;for(let r=0;r<e;r++)Vp.Util_vector.min(n,n,[t[r][0]+o[0],t[r][1]+o[1]]),Vp.Util_vector.max(a,a,[t[r][0]+o[0],t[r][1]+o[1]]);Vp.Util_vector.min(n,n,s[0]),Vp.Util_vector.max(a,a,s[1])}let p=t.length;for(let s=0;s<p;s++){let i,f,m=[t[s][0]+o[0],t[s][1]+o[1]];if(r)i=[t[s?s-1:p-1][0]+o[0],t[s?s-1:p-1][1]+o[1]],f=[t[(s+1)%p][0]+o[0],t[(s+1)%p][1]+o[1]];else{if(0===s||s===p-1){l.push([t[s][0]+o[0],t[s][1]+o[1]]);continue}i=[t[s-1][0]+o[0],t[s-1][1]+o[1]],f=[t[s+1][0]+o[0],t[s+1][1]+o[1]]}Vp.Util_vector.sub(h,f,i),Vp.Util_vector.scale(h,h,e);let y=Vp.Util_vector.distance(m,i),g=Vp.Util_vector.distance(m,f),v=y+g;0!==v&&(y/=v,g/=v),Vp.Util_vector.scale(u,h,-y),Vp.Util_vector.scale(c,h,g);let b=Vp.Util_vector.add([],m,u),S=Vp.Util_vector.add([],m,c);d&&(Vp.Util_vector.max(b,b,n),Vp.Util_vector.min(b,b,a),Vp.Util_vector.max(S,S,n),Vp.Util_vector.min(S,S,a)),l.push(b),l.push(S)}return r&&l.push(l.shift()),l}static SUtil_smoothSpline(t,e,r,s){s&&2===s.length||(s=[0,0]);var i=s,n=t.length,a=[],o=0;for(let e=1;e<n;e++)o+=Vp.Util_vector.distance([t[e-1][0]+i[0],t[e-1][1]+i[1]],[t[e][0]+i[0],t[e][1]+i[1]]);var l=o/5;l=l<n?n:l;for(let r=0;r<l;r++){let s,o,u,c=r/(l-1)*(e?n:n-1),d=Math.floor(c),p=c-d,f=[t[d%n][0]+i[0],t[d%n][1]+i[1]];e?(s=[t[(d-1+n)%n][0]+i[0],t[(d-1+n)%n][1]+i[1]],o=[t[(d+1)%n][0]+i[0],t[(d+1)%n][1]+i[1]],u=[t[(d+2)%n][0]+i[0],t[(d+2)%n][1]+i[1]]):(s=[t[0===d?d:d-1][0]+i[0],t[0===d?d:d-1][1]+i[1]],o=[t[d>n-2?n-1:d+1][0]+i[0],t[d>n-2?n-1:d+1][1]+i[1]],u=[t[d>n-3?n-1:d+2][0]+i[0],t[d>n-3?n-1:d+2][1]+i[1]]);let m=p*p,y=p*m;a.push([h(s[0],f[0],o[0],u[0],p,m,y),h(s[1],f[1],o[1],u[1],p,m,y)])}return a;function h(t,e,r,s,i,n,a){var o=.5*(r-t),l=.5*(s-e);return(2*(e-r)+o+l)*a+(-3*(e-r)-2*o-l)*n+o*i+e}}static SUtil_dashedLineTo(t,e,r,s,i,n,a){var o=[5,5];if(n="number"!=typeof n?5:n,t.setLineDash)return o[0]=n,o[1]=n,a&&a instanceof Array?t.setLineDash(a):t.setLineDash(o),t.moveTo(e,r),void t.lineTo(s,i);var l=s-e,h=i-r,u=Math.floor(Math.sqrt(l*l+h*h)/n);l/=u,h/=u;for(var c=!0,d=0;d<u;++d)c?t.moveTo(e,r):t.lineTo(e,r),c=!c,e+=l,r+=h;t.lineTo(s,i)}}Vp.Util_area=new class{constructor(){this.util=new Mp,this.curve=new zp,this._ctx=null,this._textWidthCache={},this._textHeightCache={},this._textWidthCacheCounter=0,this._textHeightCacheCounter=0,this.TEXT_CACHE_MAX=5e3,this.PI2=2*Math.PI,this.roots=[-1,-1,-1],this.extrema=[-1,-1],this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Area"}normalizeRadian(t){return(t%=this.PI2)<0&&(t+=this.PI2),t}isInside(t,e,r,s){if(!e||!t)return!1;var i=t.type;this._ctx=this._ctx||this.util.getContext();var n=this._mathMethod(t,e,r,s);if(void 0!==n)return n;if(t.buildPath&&this._ctx.isPointInPath)return this._buildPathMethod(t,this._ctx,e,r,s);switch(i){case"ellipse":case"smicellipse":return!0;case"trochoid":var a="out"==e.location?e.r1+e.r2+e.d:e.r1-e.r2+e.d;return this.isInsideCircle(e,r,s,a);case"rose":return this.isInsideCircle(e,r,s,e.maxr);default:return!1}}_mathMethod(t,e,r,s){switch(t.type){case"bezier-curve":return void 0===e.cpX2?this.isInsideQuadraticStroke(e.xStart,e.yStart,e.cpX1,e.cpY1,e.xEnd,e.yEnd,e.lineWidth,r,s):this.isInsideCubicStroke(e.xStart,e.yStart,e.cpX1,e.cpY1,e.cpX2,e.cpY2,e.xEnd,e.yEnd,e.lineWidth,r,s);case"line":return this.isInsideLine(e.xStart,e.yStart,e.xEnd,e.yEnd,e.lineWidth,r,s);case"broken-line":return this.isInsideBrokenLine(e.pointList,e.lineWidth,r,s);case"smicbroken-line":{let i=r,n=s;return t.refOriginalPosition&&(i=r-t.refOriginalPosition[0],n=s-t.refOriginalPosition[1]),this.isInsideBrokenLine(e.pointList,e.lineWidth,i,n)}case"ring":return this.isInsideRing(e.x,e.y,e.r0,e.r,r,s);case"smicring":{let i=e.x,n=e.y;return t.refOriginalPosition&&(i=e.x+t.refOriginalPosition[0],n=e.y+t.refOriginalPosition[1]),this.isInsideRing(i,n,e.r0,e.r,r,s)}case"circle":return this.isInsideCircle(e.x,e.y,e.r,r,s);case"smicpoint":{let i=r,n=s;return t.refOriginalPosition&&(i=r-t.refOriginalPosition[0],n=s-t.refOriginalPosition[1]),this.isInsideCircle(e.x,e.y,e.r,i,n)}case"sector":{let t=e.startAngle*Math.PI/180,i=e.endAngle*Math.PI/180;return e.clockWise||(t=-t,i=-i),this.isInsideSector(e.x,e.y,e.r0,e.r,t,i,!e.clockWise,r,s)}case"smicsector":{let i=e.startAngle*Math.PI/180,n=e.endAngle*Math.PI/180;e.clockWise||(i=-i,n=-n);let a=e.x,o=e.y;return t.refOriginalPosition&&(a=e.x+t.refOriginalPosition[0],o=e.y+t.refOriginalPosition[1]),this.isInsideSector(a,o,e.r0,e.r,i,n,!e.clockWise,r,s)}case"path":return this.isInsidePath(e.pathArray,Math.max(e.lineWidth,5),e.brushType,r,s);case"polygon":case"star":case"smicstar":case"isogon":case"smicisogon":return this.isInsidePolygon(e.pointList,r,s);case"smicpolygon":{let u=r,c=s;if(t.refOriginalPosition&&(u=r-t.refOriginalPosition[0],c=s-t.refOriginalPosition[1]),t.holePolygonPointLists&&t.holePolygonPointLists.length>0){for(var i=this.isInsidePolygon(e.pointList,u,c),n=t.holePolygonPointLists,a=!1,o=0,l=n.length;o<l;o++){var h=n[o];!0===this.isInsidePolygon(h,u,c)&&(a=!0)}return!0===i&&!1===a}return this.isInsidePolygon(e.pointList,u,c)}case"text":var u=e.__rect||t.getRect(e);return this.isInsideRect(u.x,u.y,u.width,u.height,r,s);case"smictext":var c=t.getTextBackground(e);return this.isInsidePolygon(c,r,s);case"rectangle":case"image":return this.isInsideRect(e.x,e.y,e.width,e.height,r,s);case"smicimage":{let i=e.x,n=e.y;return t.refOriginalPosition&&(i=e.x+t.refOriginalPosition[0],n=e.y+t.refOriginalPosition[1]),this.isInsideRect(i,n,e.width,e.height,r,s)}}}_buildPathMethod(t,e,r,s,i){return e.beginPath(),t.buildPath(e,r),e.closePath(),e.isPointInPath(s,i)}isOutside(t,e,r,s){return!this.isInside(t,e,r,s)}isInsideLine(t,e,r,s,i,n,a){if(0===i)return!1;var o=Math.max(i,5),l=0;if(a>e+o&&a>s+o||a<e-o&&a<s-o||n>t+o&&n>r+o||n<t-o&&n<r-o)return!1;if(t===r)return Math.abs(n-t)<=o/2;var h=(l=(e-s)/(t-r))*n-a+(t*s-r*e)/(t-r);return h*h/(l*l+1)<=o/2*o/2}isInsideCubicStroke(t,e,r,s,i,n,a,o,l,h,u){if(0===l)return!1;var c=Math.max(l,5);return!(u>e+c&&u>s+c&&u>n+c&&u>o+c||u<e-c&&u<s-c&&u<n-c&&u<o-c||h>t+c&&h>r+c&&h>i+c&&h>a+c||h<t-c&&h<r-c&&h<i-c&&h<a-c)&&this.curve.cubicProjectPoint(t,e,r,s,i,n,a,o,h,u,null)<=c/2}isInsideQuadraticStroke(t,e,r,s,i,n,a,o,l){if(0===a)return!1;var h=Math.max(a,5);return!(l>e+h&&l>s+h&&l>n+h||l<e-h&&l<s-h&&l<n-h||o>t+h&&o>r+h&&o>i+h||o<t-h&&o<r-h&&o<i-h)&&this.curve.quadraticProjectPoint(t,e,r,s,i,n,o,l,null)<=h/2}isInsideArcStroke(t,e,r,s,i,n,a,o,l){var h=this.PI2;if(0===a)return!1;var u=Math.max(a,5);o-=t,l-=e;var c=Math.sqrt(o*o+l*l);if(c-u>r||c+u<r)return!1;if(Math.abs(s-i)>=h)return!0;if(n){var d=s;s=this.normalizeRadian(i),i=this.normalizeRadian(d)}else s=this.normalizeRadian(s),i=this.normalizeRadian(i);s>i&&(i+=h);var p=Math.atan2(l,o);return p<0&&(p+=h),p>=s&&p<=i||p+h>=s&&p+h<=i}isInsideBrokenLine(t,e,r,s){for(var i=Math.max(e,10),n=0,a=t.length-1;n<a;n++){var o=t[n][0],l=t[n][1],h=t[n+1][0],u=t[n+1][1];if(this.isInsideLine(o,l,h,u,i,r,s))return!0}return!1}isInsideRing(t,e,r,s,i,n){var a=(i-t)*(i-t)+(n-e)*(n-e);return a<s*s&&a>r*r}isInsideRect(t,e,r,s,i,n){return i>=t&&i<=t+r&&n>=e&&n<=e+s}isInsideCircle(t,e,r,s,i){return(s-t)*(s-t)+(i-e)*(i-e)<r*r}isInsideSector(t,e,r,s,i,n,a,o,l){return this.isInsideArcStroke(t,e,(r+s)/2,i,n,a,s-r,o,l)}isInsidePolygon(t,e,r){for(var s=t.length,i=0,n=0,a=s-1;n<s;n++){var o=t[a][0],l=t[a][1],h=t[n][0],u=t[n][1];i+=this.windingLine(o,l,h,u,e,r),a=n}return 0!==i}windingLine(t,e,r,s,i,n){return n>e&&n>s||n<e&&n<s?0:s==e?0:(n-e)/(s-e)*(r-t)+t>i?s<e?1:-1:0}swapExtrema(){var t=this.extrema[0];this.extrema[0]=this.extrema[1],this.extrema[1]=t}windingCubic(t,e,r,s,i,n,a,o,l,h){var u=this.curve,c=this.roots,d=this.extrema;if(h>e&&h>s&&h>n&&h>o||h<e&&h<s&&h<n&&h<o)return 0;var p=u.cubicRootAt(e,s,n,o,h,c);if(0===p)return 0;for(var f,m,y=0,g=-1,v=0;v<p;v++){var b=c[v];u.cubicAt(t,r,i,a,b)<l||(g<0&&(g=u.cubicExtrema(e,s,n,o,d),d[1]<d[0]&&g>1&&this.swapExtrema(),f=u.cubicAt(e,s,n,o,d[0]),g>1&&(m=u.cubicAt(e,s,n,o,d[1]))),2==g?b<d[0]?y+=f<e?1:-1:b<d[1]?y+=m<f?1:-1:y+=o<m?1:-1:b<d[0]?y+=f<e?1:-1:y+=o<f?1:-1)}return y}windingQuadratic(t,e,r,s,i,n,a,o){var l=this.curve,h=this.roots;if(o>e&&o>s&&o>n||o<e&&o<s&&o<n)return 0;var u=l.quadraticRootAt(e,s,n,o,h);if(0===u)return 0;var c=l.quadraticExtremum(e,s,n);if(c>=0&&c<=1){var d=0,p=l.quadraticAt(e,s,n,c);for(let s=0;s<u;s++)l.quadraticAt(t,r,i,h[s])>a||(h[s]<c?d+=p<e?1:-1:d+=n<p?1:-1);return d}return l.quadraticAt(t,r,i,h[0])>a?0:n<e?1:-1}windingArc(t,e,r,s,i,n,a,o){var l=this.roots,h=this.PI2;if((o-=e)>r||o<-r)return 0;let u=Math.sqrt(r*r-o*o);if(l[0]=-u,l[1]=u,Math.abs(s-i)>=h){s=0,i=h;var c=n?1:-1;return a>=l[0]+t&&a<=l[1]+t?c:0}if(n){let t=s;s=this.normalizeRadian(i),i=this.normalizeRadian(t)}else s=this.normalizeRadian(s),i=this.normalizeRadian(i);s>i&&(i+=h);var d=0;for(let e=0;e<2;e++){var p=l[e];if(p+t>a){let t=Math.atan2(o,p),e=n?1:-1;t<0&&(t=h+t),(t>=s&&t<=i||t+h>=s&&t+h<=i)&&(t>Math.PI/2&&t<1.5*Math.PI&&(e=-e),d+=e)}}return d}isInsidePath(t,e,r,s,i){for(var n=0,a=0,o=0,l=0,h=0,u=!0,c=!0,d="stroke"===(r=r||"fill")||"both"===r,p="fill"===r||"both"===r,f=0;f<t.length;f++){var m=t[f],y=m.points;if(u||"M"===m.command){if(f>0&&(p&&(n+=this.windingLine(a,o,l,h,s,i)),0!==n))return!0;l=y[y.length-2],h=y[y.length-1],u=!1,c&&"A"!==m.command&&(c=!1,a=l,o=h)}switch(m.command){case"M":a=y[0],o=y[1];break;case"L":if(d&&this.isInsideLine(a,o,y[0],y[1],e,s,i))return!0;p&&(n+=this.windingLine(a,o,y[0],y[1],s,i)),a=y[0],o=y[1];break;case"C":if(d&&this.isInsideCubicStroke(a,o,y[0],y[1],y[2],y[3],y[4],y[5],e,s,i))return!0;p&&(n+=this.windingCubic(a,o,y[0],y[1],y[2],y[3],y[4],y[5],s,i)),a=y[4],o=y[5];break;case"Q":if(d&&this.isInsideQuadraticStroke(a,o,y[0],y[1],y[2],y[3],e,s,i))return!0;p&&(n+=this.windingQuadratic(a,o,y[0],y[1],y[2],y[3],s,i)),a=y[2],o=y[3];break;case"A":var g=y[0],v=y[1],b=y[2],S=y[3],_=y[4],x=y[5],w=Math.cos(_)*b+g,A=Math.sin(_)*S+v;c?(c=!1,l=w,h=A):n+=this.windingLine(a,o,w,A);var M=(s-g)*S/b+g;if(d&&this.isInsideArcStroke(g,v,S,_,_+x,1-y[7],e,M,i))return!0;p&&(n+=this.windingArc(g,v,S,_,_+x,1-y[7],M,i)),a=Math.cos(_+x)*b+g,o=Math.sin(_+x)*S+v;break;case"z":if(d&&this.isInsideLine(a,o,l,h,e,s,i))return!0;u=!0}}return p&&(n+=this.windingLine(a,o,l,h,s,i)),0!==n}getTextWidth(t,e){var r=t+":"+e;if(this._textWidthCache[r])return this._textWidthCache[r];this._ctx=this._ctx||this.util.getContext(),this._ctx.save(),e&&(this._ctx.font=e);for(var s=0,i=0,n=(t=(t+"").split("\n")).length;i<n;i++)s=Math.max(this._ctx.measureText(t[i]).width,s);return this._ctx.restore(),this._textWidthCache[r]=s,++this._textWidthCacheCounter>this.TEXT_CACHE_MAX&&(this._textWidthCacheCounter=0,this._textWidthCache={}),s}getTextHeight(t,e){var r=t+":"+e;if(this._textHeightCache[r])return this._textHeightCache[r];this._ctx=this._ctx||this.util.getContext(),this._ctx.save(),e&&(this._ctx.font=e),t=(t+"").split("\n");var s=(this._ctx.measureText("ZH").width+2)*t.length;return this._ctx.restore(),this._textHeightCache[r]=s,++this._textHeightCacheCounter>this.TEXT_CACHE_MAX&&(this._textHeightCacheCounter=0,this._textHeightCache={}),s}},Vp.Util_color=new Cp,Vp.Util_computeBoundingBox=new class{constructor(){3===arguments.length&&this.computeBoundingBox(arguments),this.CLASS_NAME="SuperMap.LevelRenderer.Tool.ComputeBoundingBox"}computeBoundingBox(t,e,r){if(0!==t.length){for(var s=t[0][0],i=t[0][0],n=t[0][1],a=t[0][1],o=1;o<t.length;o++){var l=t[o];l[0]<s&&(s=l[0]),l[0]>i&&(i=l[0]),l[1]<n&&(n=l[1]),l[1]>a&&(a=l[1])}e[0]=s,e[1]=n,r[0]=i,r[1]=a}}cubeBezier(t,e,r,s,i,n){var a=new zp,o=[];a.cubicExtrema(t[0],e[0],r[0],s[0],o);for(let i=0;i<o.length;i++)o[i]=a.cubicAt(t[0],e[0],r[0],s[0],o[i]);var l=[];a.cubicExtrema(t[1],e[1],r[1],s[1],l);for(let i=0;i<l.length;i++)l[i]=a.cubicAt(t[1],e[1],r[1],s[1],l[i]);o.push(t[0],s[0]),l.push(t[1],s[1]);var h=Math.min.apply(null,o),u=Math.max.apply(null,o),c=Math.min.apply(null,l),d=Math.max.apply(null,l);i[0]=h,i[1]=c,n[0]=u,n[1]=d}quadraticBezier(t,e,r,s,i){var n=new zp,a=n.quadraticExtremum(t[0],e[0],r[0]),o=n.quadraticExtremum(t[1],e[1],r[1]),l=1-(a=Math.max(Math.min(a,1),0)),h=1-(o=Math.max(Math.min(o,1),0)),u=l*l*t[0]+2*l*a*e[0]+a*a*r[0],c=l*l*t[1]+2*l*a*e[1]+a*a*r[1],d=h*h*t[0]+2*h*o*e[0]+o*o*r[0],p=h*h*t[1]+2*h*o*e[1]+o*o*r[1];s[0]=Math.min(t[0],r[0],u,d),s[1]=Math.min(t[1],r[1],c,p),i[0]=Math.max(t[0],r[0],u,d),i[1]=Math.max(t[1],r[1],c,p)}arc(t,e,r,s,i,n,a,o){var l=new Jp,h=l.create(),u=l.create(),c=l.create();if(h[0]=Math.cos(s)*r+t,h[1]=Math.sin(s)*r+e,u[0]=Math.cos(i)*r+t,u[1]=Math.sin(i)*r+e,l.min(a,h,u),l.max(o,h,u),(s%=2*Math.PI)<0&&(s+=2*Math.PI),(i%=2*Math.PI)<0&&(i+=2*Math.PI),s>i&&!n?i+=2*Math.PI:s<i&&n&&(s+=2*Math.PI),n){var d=i;i=s,s=d}for(var p=0;p<i;p+=Math.PI/2)p>s&&(c[0]=Math.cos(p)*r+t,c[1]=Math.sin(p)*r+e,l.min(a,c,a),l.max(o,c,o))}},Vp.Util_curve=new zp,Vp.Util_env=new class{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Env";var t,e,r,s,i,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_=this;return t=navigator.userAgent,e=_.os={},r=_.browser={},s=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),i=t.match(/(Android);?[\s\/]+([\d.]+)?/),n=t.match(/(iPad).*OS\s([\d_]+)/),a=t.match(/(iPod)(.*OS\s([\d_]+))?/),o=!n&&t.match(/(iPhone\sOS)\s([\d_]+)/),l=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),h=l&&t.match(/TouchPad/),u=t.match(/Kindle\/([\d.]+)/),c=t.match(/Silk\/([\d._]+)/),d=t.match(/(BlackBerry).*Version\/([\d.]+)/),p=t.match(/(BB10).*Version\/([\d.]+)/),f=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),m=t.match(/PlayBook/),y=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),g=t.match(/Firefox\/([\d.]+)/),v=t.match(/MSIE ([\d.]+)/),b=s&&t.match(/Mobile\//)&&!y,S=t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)&&!y,(r.webkit=!!s)&&(r.version=s[1]),i&&(e.android=!0,e.version=i[2]),o&&!a&&(e.ios=e.iphone=!0,e.version=o[2].replace(/_/g,".")),n&&(e.ios=e.ipad=!0,e.version=n[2].replace(/_/g,".")),a&&(e.ios=e.ipod=!0,e.version=a[3]?a[3].replace(/_/g,"."):null),l&&(e.webos=!0,e.version=l[2]),h&&(e.touchpad=!0),d&&(e.blackberry=!0,e.version=d[2]),p&&(e.bb10=!0,e.version=p[2]),f&&(e.rimtabletos=!0,e.version=f[2]),m&&(r.playbook=!0),u&&(e.kindle=!0,e.version=u[1]),c&&(r.silk=!0,r.version=c[1]),!c&&e.android&&t.match(/Kindle Fire/)&&(r.silk=!0),y&&(r.chrome=!0,r.version=y[1]),g&&(r.firefox=!0,r.version=g[1]),v&&(r.ie=!0,r.version=v[1]),b&&(t.match(/Safari/)||e.ios)&&(r.safari=!0),S&&(r.webview=!0),v&&(r.ie=!0,r.version=v[1]),e.tablet=!!(n||m||i&&!t.match(/Mobile/)||g&&t.match(/Tablet/)||v&&!t.match(/Phone/)&&t.match(/Touch/)),e.phone=!(e.tablet||e.ipod||!(i||o||l||d||p||y&&t.match(/Android/)||y&&t.match(/CriOS\/([\d.]+)/)||g&&t.match(/Mobile/)||v&&t.match(/Touch/))),{browser:r,os:e,canvasSupported:!!document.createElement("canvas").getContext}}destory(){return!0}},Vp.Util_event=new class{constructor(){this.stop="function"==typeof window.addEventListener?function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}:function(t){t.returnValue=!1,t.cancelBubble=!0},this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Event"}getX(t){return void 0!==t.zrenderX&&t.zrenderX||void 0!==t.offsetX&&t.offsetX||void 0!==t.layerX&&t.layerX||void 0!==t.clientX&&t.clientX}getY(t){return void 0!==t.zrenderY&&t.zrenderY||void 0!==t.offsetY&&t.offsetY||void 0!==t.layerY&&t.layerY||void 0!==t.clientY&&t.clientY}getDelta(t){return void 0!==t.zrenderDelta&&t.zrenderDelta||void 0!==t.wheelDelta&&t.wheelDelta||void 0!==t.detail&&-t.detail}},Vp.Util_http=new class{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Http"}get(t,e,r){if("object"==typeof t){var s=t;t=s.url,e=s.onsuccess,r=s.onerror}var i=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<300||304===i.status?e&&e(i.responseText):r&&r(),i.onreadystatechange=new Function,i=null)},i.send(null)}},Vp.Util_log=new class{constructor(){return this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Log",function(){if(0!=+qp.debugMode)if(1==+qp.debugMode)for(let t in arguments)throw new Error(arguments[t]);else if(+qp.debugMode>1)for(let t in arguments)console.log(arguments[t])}}destory(){return!0}},Vp.Util_math=new class{constructor(){this._radians=window.Math.PI/180,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Math"}sin(t,e){return window.Math.sin(e?t*this._radians:t)}cos(t,e){return window.Math.cos(e?t*this._radians:t)}degreeToRadian(t){return t*this._radians}radianToDegree(t){return t/this._radians}},Vp.Util_matrix=new class{constructor(){this.ArrayCtor="undefined"==typeof Float32Array?Array:Float32Array,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Matrix"}create(){var t=new(0,this.ArrayCtor)(6);return this.identity(t),t}identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}mul(t,e,r){return t[0]=e[0]*r[0]+e[2]*r[1],t[1]=e[1]*r[0]+e[3]*r[1],t[2]=e[0]*r[2]+e[2]*r[3],t[3]=e[1]*r[2]+e[3]*r[3],t[4]=e[0]*r[4]+e[2]*r[5]+e[4],t[5]=e[1]*r[4]+e[3]*r[5]+e[5],t}translate(t,e,r){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+r[0],t[5]=e[5]+r[1],t}rotate(t,e,r){var s=e[0],i=e[2],n=e[4],a=e[1],o=e[3],l=e[5],h=Math.sin(r),u=Math.cos(r);return t[0]=s*u+a*h,t[1]=-s*h+a*u,t[2]=i*u+o*h,t[3]=-i*h+u*o,t[4]=u*n+h*l,t[5]=u*l-h*n,t}scale(t,e,r){var s=r[0],i=r[1];return t[0]=e[0]*s,t[1]=e[1]*i,t[2]=e[2]*s,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*i,t}invert(t,e){var r=e[0],s=e[2],i=e[4],n=e[1],a=e[3],o=e[5],l=r*a-n*s;return l?(l=1/l,t[0]=a*l,t[1]=-n*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*o-a*i)*l,t[5]=(n*i-r*o)*l,t):null}mulVector(t,e,r){var s=e[0],i=e[2],n=e[4],a=e[1],o=e[3],l=e[5];return t[0]=r[0]*s+r[1]*i+n,t[1]=r[0]*a+r[1]*o+l,t}},Vp.Util=new Mp,Vp.Util_vector=new Jp;class Hp{constructor(){var t;this.position=[0,0],this.rotation=[0,0,0],this.scale=[1,1,0,0],this.needLocalTransform=!1,this.needTransform=!1,this.CLASS_NAME="SuperMap.LevelRenderer.Transformable",this.lookAt=(t=Vp.Util_vector.create(),function(e){this.transform||(this.transform=Vp.Util_matrix.create());var r=this.transform;function s(t){return t>-5e-5&&t<5e-5}Vp.Util_vector.sub(t,e,this.position),s(t[0])&&s(t[1])||(Vp.Util_vector.normalize(t,t),r[2]=t[0]*this.scale[1],r[3]=t[1]*this.scale[1],r[0]=t[1]*this.scale[0],r[1]=-t[0]*this.scale[0],r[4]=this.position[0],r[5]=this.position[1],this.decomposeTransform())})}destroy(){this.position=null,this.rotation=null,this.scale=null,this.needLocalTransform=null,this.needTransform=null}updateNeedTransform(){function t(t){return t>5e-5||t<-5e-5}this.needLocalTransform=t(this.rotation[0])||t(this.position[0])||t(this.position[1])||t(this.scale[0]-1)||t(this.scale[1]-1)}updateTransform(){if(this.updateNeedTransform(),this.parent?this.needTransform=this.needLocalTransform||this.parent.needTransform:this.needTransform=this.needLocalTransform,this.needTransform){var t=[0,0],e=this.transform||Vp.Util_matrix.create();if(Vp.Util_matrix.identity(e),this.needLocalTransform){if(r(this.scale[0])||r(this.scale[1])){t[0]=-this.scale[2]||0,t[1]=-this.scale[3]||0;let s=r(t[0])||r(t[1]);s&&Vp.Util_matrix.translate(e,e,t),Vp.Util_matrix.scale(e,e,this.scale),s&&(t[0]=-t[0],t[1]=-t[1],Vp.Util_matrix.translate(e,e,t))}if(this.rotation instanceof Array){if(0!==this.rotation[0]){t[0]=-this.rotation[1]||0,t[1]=-this.rotation[2]||0;let s=r(t[0])||r(t[1]);s&&Vp.Util_matrix.translate(e,e,t),Vp.Util_matrix.rotate(e,e,this.rotation[0]),s&&(t[0]=-t[0],t[1]=-t[1],Vp.Util_matrix.translate(e,e,t))}}else 0!=+this.rotation&&Vp.Util_matrix.rotate(e,e,this.rotation);(r(this.position[0])||r(this.position[1]))&&Vp.Util_matrix.translate(e,e,this.position)}this.transform=e,this.parent&&this.parent.needTransform&&(this.needLocalTransform?Vp.Util_matrix.mul(this.transform,this.parent.transform,this.transform):Vp.Util_matrix.copy(this.transform,this.parent.transform))}function r(t){return t>5e-5||t<-5e-5}}setTransform(t){if(this.needTransform){var e=this.transform;t.transform(e[0],e[1],e[2],e[3],e[4],e[5])}}decomposeTransform(){if(this.transform){var t=this.transform,e=t[0]*t[0]+t[1]*t[1],r=this.position,s=this.scale,i=this.rotation;a(e-1)&&(e=Math.sqrt(e));var n=t[2]*t[2]+t[3]*t[3];a(n-1)&&(n=Math.sqrt(n)),r[0]=t[4],r[1]=t[5],s[0]=e,s[1]=n,s[2]=s[3]=0,i[0]=Math.atan2(-t[1]/n,t[0]/e),i[1]=i[2]=0}function a(t){return t>5e-5||t<-5e-5}}}class Wp extends(o(Up,Hp)){constructor(t){var e;super(t),t=t||{},this.id=null,this.style={},this.highlightStyle=null,this.parent=null,this.__dirty=!0,this.__clipShapes=[],this.invisible=!1,this.ignore=!1,this.zlevel=0,this.draggable=!1,this.clickable=!1,this.hoverable=!0,this.z=0,this.refOriginalPosition=[0,0],this.refDataID=null,this.isHoverByRefDataID=!1,this.refDataHoverGroup=null,this.dataInfo=null,v.extend(this,t),this.id=this.id||v.createUniqueID("smShape_"),this.CLASS_NAME="SuperMap.LevelRenderer.Shape",this.getTansform=(e=[],function(t,r){var s=[t,r];return this.needTransform&&this.transform&&(Vp.Util_matrix.invert(e,this.transform),Vp.Util_matrix.mulVector(s,e,[t,r,1]),t==s[0]&&r==s[1]&&this.updateNeedTransform()),s})}destroy(){this.id=null,this.style=null,this.highlightStyle=null,this.parent=null,this.__dirty=null,this.__clipShapes=null,this.invisible=null,this.ignore=null,this.zlevel=null,this.draggable=null,this.clickable=null,this.hoverable=null,this.z=null,this.refOriginalPosition=null,this.refDataID=null,this.refDataHoverGroup=null,this.isHoverByRefDataID=null,this.dataInfo=null,super.destroy()}brush(t,e){var r=this.beforeBrush(t,e);switch(t.beginPath(),this.buildPath(t,r),r.brushType){case"both":this.setCtxGlobalAlpha(t,"fill",r),t.fill(),r.lineWidth>0&&(this.setCtxGlobalAlpha(t,"stroke",r),t.stroke()),this.setCtxGlobalAlpha(t,"reset",r);break;case"stroke":this.setCtxGlobalAlpha(t,"stroke",r),r.lineWidth>0&&t.stroke(),this.setCtxGlobalAlpha(t,"reset",r);break;default:this.setCtxGlobalAlpha(t,"fill",r),t.fill(),this.setCtxGlobalAlpha(t,"reset",r)}this.drawText(t,r,this.style),this.afterBrush(t)}beforeBrush(t,e){var r=this.style;return this.brushTypeOnly&&(r.brushType=this.brushTypeOnly),e&&(r=this.getHighlightStyle(r,this.highlightStyle||{},this.brushTypeOnly)),"stroke"==this.brushTypeOnly&&(r.strokeColor=r.strokeColor||r.color),t.save(),this.doClip(t),this.setContext(t,r),this.setTransform(t),r}afterBrush(t){t.restore()}setContext(t,e){for(var r=[["color","fillStyle"],["strokeColor","strokeStyle"],["opacity","globalAlpha"],["lineCap","lineCap"],["lineJoin","lineJoin"],["miterLimit","miterLimit"],["lineWidth","lineWidth"],["shadowBlur","shadowBlur"],["shadowColor","shadowColor"],["shadowOffsetX","shadowOffsetX"],["shadowOffsetY","shadowOffsetY"]],s=0,i=r.length;s<i;s++){var n=e[r[s][0]],a=r[s][1];void 0!==n&&(t[a]=n)}}doClip(t){var e=Vp.Util_matrix.create();if(this.__clipShapes)for(var r=0;r<this.__clipShapes.length;r++){var s=this.__clipShapes[r];if(s.needTransform){let r=s.transform;Vp.Util_matrix.invert(e,r),t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}if(t.beginPath(),s.buildPath(t,s.style),t.clip(),s.needTransform){let r=e;t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}}}getHighlightStyle(t,e,r){var s={};for(let e in t)s[e]=t[e];var i=Vp.Util_color.getHighlightColor();"stroke"!=t.brushType?(s.strokeColor=i,s.lineWidth=t.lineWidth||1,s.brushType="both"):"stroke"!=r?(s.strokeColor=i,s.lineWidth=t.lineWidth||1):s.strokeColor=e.strokeColor||Vp.Util_color.mix(t.strokeColor,Vp.Util_color.toRGB(i));for(let t in e)void 0!==e[t]&&(s[t]=e[t]);return s}getHighlightZoom(){return"text"!=this.type?6:2}drift(t,e){this.position[0]+=t,this.position[1]+=e}buildPath(t,e){Vp.Util_log("buildPath not implemented in "+this.type)}getRect(t){Vp.Util_log("getRect not implemented in "+this.type)}isCover(t,e){var r=this.getTansform(t,e);t=r[0],e=r[1];var s=this.style.__rect;return s||(s=this.style.__rect=this.getRect(this.style)),t>=s.x&&t<=s.x+s.width&&e>=s.y&&e<=s.y+s.height&&Vp.Util_area.isInside(this,this.style,t,e)}drawText(t,e,r){if(void 0!==e.text&&!1!==e.text){var s=e.textColor||e.color||e.strokeColor;t.fillStyle=s;var i,n,a,o,l=10,h=e.textPosition||this.textPosition||"top",u=[];switch(u=this.refOriginalPosition&&2===this.refOriginalPosition.length?this.refOriginalPosition:[0,0],h){case"inside":case"top":case"bottom":case"left":case"right":if(this.getRect){var c=(r||e).__rect||this.getRect(r||e);switch(h){case"inside":a=c.x+c.width/2,o=c.y+c.height/2,i="center",n="middle","stroke"!=e.brushType&&s==e.color&&(t.fillStyle="#fff");break;case"left":a=c.x-l,o=c.y+c.height/2,i="end",n="middle";break;case"right":a=c.x+c.width+l,o=c.y+c.height/2,i="start",n="middle";break;case"top":a=c.x+c.width/2,o=c.y-l,i="center",n="bottom";break;case"bottom":a=c.x+c.width/2,o=c.y+c.height+l,i="center",n="top"}}break;case"start":case"end":var d=0,p=0,f=0,m=0;if(void 0!==e.pointList){var y=e.pointList;if(y.length<2)return;var g=y.length;switch(h){case"start":d=y[0][0]+u[0],p=y[1][0]+u[0],f=y[0][1]+u[1],m=y[1][1]+u[1];break;case"end":d=y[g-2][0]+u[0],p=y[g-1][0]+u[0],f=y[g-2][1]+u[1],m=y[g-1][1]+u[1]}}else d=e.xStart+u[0]||0,p=e.xEnd+u[0]||0,f=e.yStart+u[1]||0,m=e.yEnd+u[1]||0;switch(h){case"start":i=d<p?"end":"start",n=f<m?"bottom":"top",a=d,o=f;break;case"end":i=d<p?"start":"end",n=f<m?"top":"bottom",a=p,o=m}l-=4,d&&p&&d!=p?a-="end"==i?l:-l:i="center",f!=m?o-="bottom"==n?l:-l:n="middle";break;case"specific":a=e.textX||0,o=e.textY||0,i="start",n="middle"}e.labelXOffset&&!isNaN(e.labelXOffset)&&(a+=e.labelXOffset),e.labelYOffset&&!isNaN(e.labelYOffset)&&(o+=e.labelYOffset),null!=a&&null!=o&&Wp._fillText(t,e.text,a,o,e.textFont,e.textAlign||i,e.textBaseline||n)}}modSelf(){this.__dirty=!0,this.style&&(this.style.__rect=null),this.highlightStyle&&(this.highlightStyle.__rect=null)}isSilent(){return!(this.hoverable||this.draggable||this.clickable||this.onmousemove||this.onmouseover||this.onmouseout||this.onmousedown||this.onmouseup||this.onclick||this.ondragenter||this.ondragover||this.ondragleave||this.ondrop)}setCtxGlobalAlpha(t,e,r){t.globalAlpha="fill"===e?void 0===r.fillOpacity?void 0===r.opacity?1:r.opacity:r.fillOpacity:"stroke"===e?void 0===r.strokeOpacity?void 0===r.opacity?1:r.opacity:r.strokeOpacity:void 0===r.opacity?1:r.opacity}static _fillText(t,e,r,s,i,n,a){i&&(t.font=i),t.textAlign=n,t.textBaseline=a;var o=Wp._getTextRect(e,r,s,i,n,a);e=(e+"").split("\n");var l=Vp.Util_area.getTextHeight("ZH",i);switch(a){case"top":s=o.y;break;case"bottom":s=o.y+l;break;default:s=o.y+l/2}for(var h=0,u=e.length;h<u;h++)t.fillText(e[h],r,s),s+=l}static _getTextRect(t,e,r,s,i,n){var a=Vp.Util_area.getTextWidth(t,s),o=Vp.Util_area.getTextHeight("ZH",s);switch(t=(t+"").split("\n"),i){case"end":case"right":e-=a;break;case"center":e-=a/2}switch(n){case"top":break;case"bottom":r-=o*t.length;break;default:r-=o*t.length/2}return{x:e,y:r,width:a,height:o*t.length}}}class Qp extends Wp{constructor(t){super(t),this.type="smicpoint",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicPoint"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;t.arc(e.x+r[0],e.y+r[1],e.r,0,2*Math.PI,!0)}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition;return t.__rect?t.__rect:(e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(t.x+r[0]-t.r-e/2),y:Math.round(t.y+r[1]-t.r-e/2),width:2*t.r+e,height:2*t.r+e},t.__rect)}}class Yp extends Wp{constructor(t){super(t),this.type="smictext",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicText"}destroy(){this.type=null,super.destroy()}brush(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,s=this.style;if(e&&(s=this.getHighlightStyle(s,this.highlightStyle||{})),void 0!==s.text&&!1!==s.text){t.save(),this.doClip(t),this.setContext(t,s),this.setTransform(t),s.textFont&&(t.font=s.textFont),t.textAlign=s.textAlign||"start",t.textBaseline=s.textBaseline||"middle";var i,n=(s.text+"").split("\n"),a=Vp.Util_area.getTextHeight("ZH",s.textFont),o=this.getRectNoRotation(s),l=s.x+r[0];i="top"==s.textBaseline?o.y:"bottom"==s.textBaseline?o.y+a:o.y+a/2;for(var h=s.x+r[0],u=s.y+r[1],c=0,d=n.length;c<d;c++){switch(s.labelRect&&(t.fillRect(o.x-2,o.y,o.width+4,o.height),t.fillStyle=s.strokeColor,t.strokeRect(o.x-2,o.y,o.width+4,o.height),t.fillStyle=s.textColor),s.brushType){case"stroke":this.setCtxGlobalAlpha(t,"stroke",s),s.textRotation&&0!==s.textRotation?(t.save(),t.translate(h,u),t.rotate(s.textRotation*Math.PI/180),"top"==s.textBaseline?s.maxWidth?t.strokeText(n[c],0,a*c,s.maxWidth):t.strokeText(n[c],0,a*c):"bottom"==s.textBaseline?s.maxWidth?t.strokeText(n[c],0,a*(c+1)-o.height,s.maxWidth):t.strokeText(n[c],0,a*(c+1)-o.height):s.maxWidth?t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2,s.maxWidth):t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2),t.restore()):s.maxWidth?t.strokeText(n[c],l,i,s.maxWidth):t.strokeText(n[c],l,i),this.setCtxGlobalAlpha(t,"reset",s);break;case"both":s.textRotation&&0!==s.textRotation?(t.save(),t.translate(h,u),t.rotate(s.textRotation*Math.PI/180),"top"==s.textBaseline?s.maxWidth?(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*c,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*c,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s)):(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*c),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*c),this.setCtxGlobalAlpha(t,"reset",s)):"bottom"==s.textBaseline?s.maxWidth?(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*(c+1)-o.height,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*(c+1)-o.height,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s)):(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*(c+1)-o.height),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*(c+1)-o.height),this.setCtxGlobalAlpha(t,"reset",s)):s.maxWidth?(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*(c+1)-o.height/2-a/2,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s)):(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],0,a*(c+1)-o.height/2-a/2),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2),this.setCtxGlobalAlpha(t,"reset",s)),t.restore()):s.maxWidth?(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],l,i,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],l,i,s.maxWidth),this.setCtxGlobalAlpha(t,"reset",s)):(this.setCtxGlobalAlpha(t,"fill",s),t.fillText(n[c],l,i),this.setCtxGlobalAlpha(t,"reset",s),this.setCtxGlobalAlpha(t,"stroke",s),t.strokeText(n[c],l,i),this.setCtxGlobalAlpha(t,"reset",s));break;default:this.setCtxGlobalAlpha(t,"fill",s),s.textRotation&&0!==s.textRotation?(t.save(),t.translate(h,u),t.rotate(s.textRotation*Math.PI/180),"top"==s.textBaseline?s.maxWidth?t.fillText(n[c],0,a*c,s.maxWidth):t.fillText(n[c],0,a*c):"bottom"==s.textBaseline?s.maxWidth?t.fillText(n[c],0,a*(c+1)-o.height,s.maxWidth):t.fillText(n[c],0,a*(c+1)-o.height):s.maxWidth?t.fillText(n[c],0,a*(c+1)-o.height/2-a/2,s.maxWidth):t.fillText(n[c],0,a*(c+1)-o.height/2-a/2),t.restore()):s.maxWidth?t.fillText(n[c],l,i,s.maxWidth):t.fillText(n[c],l,i),this.setCtxGlobalAlpha(t,"reset",s)}i+=a}t.restore()}}getRect(t){if(t.__rect)return t.__rect;for(var e,r,s,i,n=this.getTextBackground(t,!0),a=0,o=n.length;a<o;a++){var l=n[a];0==a?(e=l[0],s=l[0],r=l[1],i=l[1]):(l[0]<e&&(e=l[0]),l[0]>s&&(s=l[0]),l[1]<r&&(r=l[1]),l[1]>i&&(i=l[1]))}return t.__rect={x:e,y:r,width:s-e,height:i-r},t.__rect}getRectNoRotation(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition,s=Vp.Util_area.getTextHeight("ZH",t.textFont),i=Vp.Util_area.getTextWidth(t.text,t.textFont),n=Vp.Util_area.getTextHeight(t.text,t.textFont),a=t.x+r[0];"end"==t.textAlign||"right"==t.textAlign?a-=i:"center"==t.textAlign&&(a-=i/2),e="top"==t.textBaseline?t.y+r[1]:"bottom"==t.textBaseline?t.y+r[1]-n:t.y+r[1]-n/2;var o,l=!1;if(t.maxWidth){var h=parseInt(t.maxWidth);h<i&&(o=i,l=!0,i=h),a=t.x+r[0],"end"==t.textAlign||"right"==t.textAlign?a-=i:"center"==t.textAlign&&(a-=i/2)}t.textFont&&(t.textFont.toLowerCase().indexOf("italic")>-1&&(i+=!0===l?s/3*(i/o):s/3));return{x:a,y:e,width:i,height:n}}getTextBackground(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;if(!e&&t.__textBackground)return t.__textBackground;var s=this.getRectNoRotation(t),i=t.x+r[0],n=t.y+r[1],a=[];if(t.textRotation&&0!==t.textRotation){let e=t.textRotation,r=this.getRotatedLocation(s.x,s.y,i,n,e),o=this.getRotatedLocation(s.x+s.width,s.y,i,n,e),l=this.getRotatedLocation(s.x+s.width,s.y+s.height,i,n,e),h=this.getRotatedLocation(s.x,s.y+s.height,i,n,e);a.push(r),a.push(o),a.push(l),a.push(h)}else{let t=[s.x,s.y],e=[s.x+s.width,s.y],r=[s.x+s.width,s.y+s.height],i=[s.x,s.y+s.height];a.push(t),a.push(e),a.push(r),a.push(i)}return t.__textBackground=a,t.__textBackground}getRotatedLocation(t,e,r,s,i){var n,a,o=new Array;return e=-e,s=-s,i=-i,n=(t-r)*Math.cos(i/180*Math.PI)-(e-s)*Math.sin(i/180*Math.PI)+r,a=(t-r)*Math.sin(i/180*Math.PI)+(e-s)*Math.cos(i/180*Math.PI)+s,o[0]=n,o[1]=-a,o}}class Xp extends Wp{constructor(t){super(t),this.type="smiccircle",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicCircle"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,s=e.x+r[0],i=e.y+r[1];return t.moveTo(s+e.r,i),t.arc(s,i,e.r,0,2*Math.PI,!0),!0}getRect(t){if(t.__rect)return t.__rect;this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition,s=t.x+r[0],i=t.y+r[1],n=t.r;return e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(s-n-e/2),y:Math.round(i-n-e/2),width:2*n+e,height:2*n+e},t.__rect}}class Zp extends Wp{constructor(t){super(t),this.type="smicpolygon",this.holePolygonPointLists=null,this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicPolygon"}destroy(){this.type=null,this.holePolygonPointLists=null,super.destroy()}brush(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.style;e&&(r=this.getHighlightStyle(r,this.highlightStyle||{})),t.save(),this.setContext(t,r),this.setTransform(t);var s=!1;"fill"!=r.brushType&&"both"!=r.brushType&&void 0!==r.brushType||(t.beginPath(),"dashed"==r.lineType||"dotted"==r.lineType||"dot"==r.lineType||"dash"==r.lineType||"dashdot"==r.lineType||"longdash"==r.lineType||"longdashdot"==r.lineType?this.buildPath(t,{lineType:"solid",lineWidth:r.lineWidth,pointList:r.pointList}):(this.buildPath(t,r),s=!0),t.closePath(),this.setCtxGlobalAlpha(t,"fill",r),t.fill(),this.setCtxGlobalAlpha(t,"reset",r)),r.lineWidth>0&&("stroke"==r.brushType||"both"==r.brushType)&&(s||(t.beginPath(),this.buildPath(t,r)),this.setCtxGlobalAlpha(t,"stroke",r),t.stroke(),this.setCtxGlobalAlpha(t,"reset",r)),this.drawText(t,r,this.style);var i=v.cloneObject(r);if(i.pointList&&this.holePolygonPointLists&&this.holePolygonPointLists.length>0)for(var n=this.holePolygonPointLists,a=n.length,o=0;o<a;o++){var l=n[o];i.pointList=l,t.globalCompositeOperation="destination-out",s=!1,"fill"!=i.brushType&&"both"!=i.brushType&&void 0!==i.brushType||(t.beginPath(),"dashed"==i.lineType||"dotted"==i.lineType||"dot"==i.lineType||"dash"==i.lineType||"dashdot"==i.lineType||"longdash"==i.lineType||"longdashdot"==i.lineType?this.buildPath(t,{lineType:"solid",lineWidth:i.lineWidth,pointList:i.pointList}):(this.buildPath(t,i),s=!0),t.closePath(),this.setCtxGlobalAlpha(t,"fill",i),t.fill(),this.setCtxGlobalAlpha(t,"reset",i)),i.lineWidth>0&&("stroke"==i.brushType||"both"==i.brushType)?(s||(t.beginPath(),this.buildPath(t,i)),t.globalCompositeOperation="source-over",this.setCtxGlobalAlpha(t,"stroke",i),t.stroke(),this.setCtxGlobalAlpha(t,"reset",i)):t.globalCompositeOperation="source-over"}t.restore()}buildPath(t,e){e.showShadow&&(t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY),this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,s=e.pointList;if(!(s.length<2))if(e.smooth&&"spline"!==e.smooth){var i,n,a,o=Vp.SUtil_smoothBezier(s,e.smooth,!0,e.smoothConstraint,r);t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(var l=s.length,h=0;h<l;h++)i=o[2*h],n=o[2*h+1],a=[s[(h+1)%l][0]+r[0],s[(h+1)%l][1]+r[1]],t.bezierCurveTo(i[0],i[1],n[0],n[1],a[0],a[1])}else if("spline"===e.smooth&&(s=Vp.SUtil_smoothSpline(s,!0,null,r)),e.lineType&&"solid"!=e.lineType){if("dashed"===e.lineType||"dotted"===e.lineType||"dot"===e.lineType||"dash"===e.lineType||"longdash"===e.lineType){let i=e._dashLength||(e.lineWidth||1)*("dashed"==e.lineType?5:1);e._dashLength=i;let n=e.lineWidth||1,a=n,o=n;"dashed"===e.lineType&&(a*=5,o*=5,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"dotted"===e.lineType&&e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n),"dot"===e.lineType&&(o*=4,e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n)),"dash"===e.lineType&&(a*=4,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"longdash"===e.lineType&&(a*=8,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=1;e<s.length;e++)Vp.SUtil_dashedLineTo(t,s[e-1][0]+r[0],s[e-1][1]+r[1],s[e][0]+r[0],s[e][1]+r[1],n,[a,o]);Vp.SUtil_dashedLineTo(t,s[s.length-1][0]+r[0],s[s.length-1][1]+r[1],s[0][0]+r[0],s[0][1]+r[1],n,[a,o])}else if("dashdot"===e.lineType||"longdashdot"===e.lineType){let i=e._dashLength||(e.lineWidth||1)*("dashed"==e.lineType?5:1);e._dashLength=i;let n=e.lineWidth||1,a=n,o=n,l=n,h=n;"dashdot"===e.lineType&&(a*=4,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),"longdashdot"===e.lineType&&(a*=8,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=1;e<s.length;e++)Vp.SUtil_dashedLineTo(t,s[e-1][0]+r[0],s[e-1][1]+r[1],s[e][0]+r[0],s[e][1]+r[1],n,[a,o,l,h]);Vp.SUtil_dashedLineTo(t,s[s.length-1][0]+r[0],s[s.length-1][1]+r[1],s[0][0]+r[0],s[0][1]+r[1],n,[a,o,l,h])}}else{t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=1;e<s.length;e++)t.lineTo(s[e][0]+r[0],s[e][1]+r[1]);t.lineTo(s[0][0]+r[0],s[0][1]+r[1])}}getRect(t,e){var r;if(e?r=e:(this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),r=this.refOriginalPosition),t.__rect)return t.__rect;for(var s,i=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MAX_VALUE,o=Number.MIN_VALUE,l=t.pointList,h=0,u=l.length;h<u;h++)l[h][0]+r[0]<i&&(i=l[h][0]+r[0]),l[h][0]+r[0]>n&&(n=l[h][0]+r[0]),l[h][1]+r[1]<a&&(a=l[h][1]+r[1]),l[h][1]+r[1]>o&&(o=l[h][1]+r[1]);return s="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(i-s/2),y:Math.round(a-s/2),width:n-i+s,height:o-a+s},t.__rect}}class Kp extends Wp{constructor(t){super(t),this.brushTypeOnly="stroke",this.textPosition="end",this.type="smicbroken-line",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicBrokenLine"}destroy(){this.brushTypeOnly=null,this.textPosition=null,this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,s=e.pointList;if(!(s.length<2)){var i=Math.min(e.pointList.length,Math.round(e.pointListLength||e.pointList.length));if(e.smooth&&"spline"!==e.smooth){var n,a,o,l=Vp.SUtil_smoothBezier(s,e.smooth,!1,e.smoothConstraint,r);t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=0;e<i-1;e++)n=l[2*e],a=l[2*e+1],o=[s[e+1][0]+r[0],s[e+1][1]+r[1]],t.bezierCurveTo(n[0],n[1],a[0],a[1],o[0],o[1])}else if("spline"===e.smooth&&(i=(s=Vp.SUtil_smoothSpline(s,null,null,r)).length),e.lineType&&"solid"!==e.lineType){if("dashed"===e.lineType||"dotted"===e.lineType||"dot"===e.lineType||"dash"===e.lineType||"longdash"===e.lineType){let n=e.lineWidth||1,a=n,o=n;"dashed"===e.lineType&&(a*=5,o*=5,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"dotted"===e.lineType&&e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n),"dot"===e.lineType&&(o*=4,e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n)),"dash"===e.lineType&&(a*=4,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"longdash"===e.lineType&&(a*=8,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(var h=1;h<i;h++)Vp.SUtil_dashedLineTo(t,s[h-1][0]+r[0],s[h-1][1]+r[1],s[h][0]+r[0],s[h][1]+r[1],n,[a,o])}else if("dashdot"===e.lineType||"longdashdot"===e.lineType){let n=e.lineWidth||1,a=n,o=n,l=n,h=n;"dashdot"===e.lineType&&(a*=4,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),"longdashdot"===e.lineType&&(a*=8,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),n=(e.lineWidth||1)*("dashed"===e.lineType?5:1),t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=1;e<i;e++)Vp.SUtil_dashedLineTo(t,s[e-1][0]+r[0],s[e-1][1]+r[1],s[e][0]+r[0],s[e][1]+r[1],n,[a,o,l,h])}}else{t.moveTo(s[0][0]+r[0],s[0][1]+r[1]);for(let e=1;e<i;e++)t.lineTo(s[e][0]+r[0],s[e][1]+r[1])}}}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition;return Zp.prototype.getRect.apply(this,[t,e])}}class $p extends Wp{constructor(t){super(t),this.type="smicimage",this._imageCache={},this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicImage"}destroy(){this.type=null,this._imageCache=null,super.destroy()}brush(t,e,r){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var s=this.refOriginalPosition,i=this.style||{};e&&(i=this.getHighlightStyle(i,this.highlightStyle||{}));var n=i.image,a=this;if("string"==typeof n){var o=n;this._imageCache[o]?n=this._imageCache[o]:((n=new Image).onload=function(){n.onload=null,clearTimeout($p._refreshTimeout),$p._needsRefresh.push(a),$p._refreshTimeout=setTimeout(function(){r&&r($p._needsRefresh),$p._needsRefresh=[]},10)},n.src=o,this._imageCache[o]=n)}if(n){if("IMG"==n.nodeName.toUpperCase())if(window.ActiveXObject){if("complete"!=n.readyState)return}else if(!n.complete)return;var l=i.width||n.width,h=i.height||n.height,u=i.x+s[0],c=i.y+s[1];if(!n.width||!n.height)return;if(t.save(),this.doClip(t),this.setContext(t,i),this.setTransform(t),i.sWidth&&i.sHeight){let e=i.sx+s[0]||0,r=i.sy+s[1]||0;t.drawImage(n,e,r,i.sWidth,i.sHeight,u,c,l,h)}else if(i.sx&&i.sy){let e=i.sx+s[0],r=i.sy+s[1];var d=l-e,p=h-r;t.drawImage(n,e,r,d,p,u,c,l,h)}else t.drawImage(n,u,c,l,h);i.width||(i.width=l),i.height||(i.height=h),this.style.width||(this.style.width=l),this.style.height||(this.style.height=h),this.drawText(t,i,this.style),t.restore()}}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition;return{x:t.x+e[0],y:t.y+e[1],width:t.width,height:t.height}}clearCache(){this._imageCache={}}}$p._needsRefresh=[],$p._refreshTimeout=null;class tf extends Wp{constructor(t){super(t),this.type="smicrectangle",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicRectangle"}destroy(){this.type=null,super.destroy()}_buildRadiusPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r,s,i,n,a,o=this.refOriginalPosition,l=e.x+o[0],h=e.y+o[1],u=e.width,c=e.height,d=e.radius;"number"==typeof d?r=s=i=n=d:d instanceof Array?1===d.length?r=s=i=n=d[0]:2===d.length?(r=i=d[0],s=n=d[1]):3===d.length?(r=d[0],s=n=d[1],i=d[2]):(r=d[0],s=d[1],i=d[2],n=d[3]):r=s=i=n=0,r+s>u&&(r*=u/(a=r+s),s*=u/a),i+n>u&&(i*=u/(a=i+n),n*=u/a),s+i>c&&(s*=c/(a=s+i),i*=c/a),r+n>c&&(r*=c/(a=r+n),n*=c/a),t.moveTo(l+r,h),t.lineTo(l+u-s,h),0!==s&&t.quadraticCurveTo(l+u,h,l+u,h+s),t.lineTo(l+u,h+c-i),0!==i&&t.quadraticCurveTo(l+u,h+c,l+u-i,h+c),t.lineTo(l+n,h+c),0!==n&&t.quadraticCurveTo(l,h+c,l,h+c-n),t.lineTo(l,h+r),0!==r&&t.quadraticCurveTo(l,h,l+r,h)}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;e.radius?this._buildRadiusPath(t,e):(t.moveTo(e.x+r[0],e.y+r[1]),t.lineTo(e.x+r[0]+e.width,e.y+r[1]),t.lineTo(e.x+r[0]+e.width,e.y+r[1]+e.height),t.lineTo(e.x+r[0],e.y+r[1]+e.height),t.lineTo(e.x+r[0],e.y+r[1])),t.closePath()}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition;return t.__rect?t.__rect:(e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(t.x+r[0]-e/2),y:Math.round(t.y+r[1]-e/2),width:t.width+e,height:t.height+e},t.__rect)}}class ef extends Wp{constructor(t){super(t),this.type="smicsector",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicSector"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,s=e.x+r[0],i=e.y+r[1],n=e.r0||0,a=e.r,o=e.startAngle,l=e.endAngle,h=e.clockWise||!1;o=Vp.Util_math.degreeToRadian(o),l=Vp.Util_math.degreeToRadian(l),h||(o=-o,l=-l);var u=Vp.Util_math.cos(o),c=Vp.Util_math.sin(o);t.moveTo(u*n+s,c*n+i),t.lineTo(u*a+s,c*a+i),t.arc(s,i,a,o,l,!h),t.lineTo(Vp.Util_math.cos(l)*n+s,Vp.Util_math.sin(l)*n+i),0!==n&&t.arc(s,i,n,l,o,h),t.closePath()}getRect(t){if(t.__rect)return t.__rect;this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition,r=Vp.Util_vector.create(),s=Vp.Util_vector.create(),i=Vp.Util_vector.create(),n=Vp.Util_vector.create(),a=t.x+e[0],o=t.y+e[1],l=t.r0||0,h=t.r,u=Vp.Util_math.degreeToRadian(t.startAngle),c=Vp.Util_math.degreeToRadian(t.endAngle),d=t.clockWise;return d||(u=-u,c=-c),l>1?Vp.Util_computeBoundingBox.arc(a,o,l,u,c,!d,r,i):(r[0]=i[0]=a,r[1]=i[1]=o),Vp.Util_computeBoundingBox.arc(a,o,h,u,c,!d,s,n),Vp.Util_vector.min(r,r,s),Vp.Util_vector.max(i,i,n),t.__rect={x:r[0],y:r[1],width:i[0]-r[0],height:i[1]-r[1]},t.__rect}}class rf{constructor(t){this.shapeParameters=t,this.CLASS_NAME="SuperMap.Feature.ShapeFactory"}destroy(){this.shapeParameters=null}createShape(t){if(t&&(this.shapeParameters=t),!this.shapeParameters)return null;var e=this.shapeParameters;if(e instanceof Np){let t=new Object;t.x=e.x,t.y=e.y,t.r=e.r,t=v.copyAttributesWithClip(t,e.style,["x","y"]);let r=new Qp;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","style","highlightStyle"]),r}if(e instanceof kp){if(!e.pointList)return null;let t=new Object;t.pointList=e.pointList,t=v.copyAttributesWithClip(t,e.style,["pointList"]);let r=new Kp;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["pointList","style","highlightStyle"]),r}if(e instanceof Rp){if(!e.pointList)return null;let t=new Object;t.pointList=e.pointList,t=v.copyAttributesWithClip(t,e.style,["pointList"]);let r=new Zp;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["pointList","style","highlightStyle"]),r}if(e instanceof Dp){if(!e.x&&!e.y&!e.width&!e.height)return null;let t=new Object;t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t=v.copyAttributesWithClip(t,e.style,["x","y","width","height"]);let r=new tf;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","width","height","style","highlightStyle"]),r}if(e instanceof Fp){let t=new Object;t.x=e.x,t.y=e.y,t.r=e.r,t.startAngle=e.startAngle,t.endAngle=e.endAngle,e.r0&&(t.r0=e.r0),e.clockWise&&(t.clockWise=e.clockWise),t=v.copyAttributesWithClip(t,e.style,["x","y","r","startAngle","endAngle","r0","endAngle"]);let r=new ef;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","r","startAngle","endAngle","r0","endAngle","style","highlightStyle"]),r}if(e instanceof Bp){let t=new Object;t.x=e.x,t.y=e.y,t.text=e.text,t=v.copyAttributesWithClip(t,e.style,["x","y","text"]);let r=new Yp;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","text","style","highlightStyle"]),r}if(e instanceof Gp){let t=new Object;t.x=e.x,t.y=e.y,e.image&&(t.image=e.image),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.sx&&(t.sx=e.sx),e.sy&&(t.sy=e.sy),e.sWidth&&(t.sWidth=e.sWidth),e.sHeight&&(t.sHeight=e.sHeight),t=v.copyAttributesWithClip(t,e.style,["x","y","image","width","height","sx","sy","sWidth","sHeight"]);let r=new $p;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","image","width","height","style","highlightStyle"]),r}if(e instanceof jp){let t=new Object;t.x=e.x,t.r=e.r,t.y=e.y,t=v.copyAttributesWithClip(t,e.style,["x","y","r"]);let r=new Xp;return r.style=rf.transformStyle(t),r.highlightStyle=rf.transformStyle(e.highlightStyle),v.copyAttributesWithClip(r,e,["x","y","r","style","highlightStyle","lineWidth","text","textPosition"]),r}return null}static transformStyle(t){var e={},r=["normal","normal","normal","12","arial,sans-serif"],s=[!0,!1];for(var i in t)switch(i){case"fill":s[0]=t[i];break;case"fillColor":e.color=t[i];break;case"stroke":s[1]=t[i];break;case"strokeWidth":e.lineWidth=t[i];break;case"strokeLinecap":e.lineCap=t[i];break;case"strokeLineJoin":e.lineJoin=t[i];break;case"strokeDashstyle":e.lineType=t[i];break;case"pointRadius":e.r=t[i];break;case"label":e.text=t[i];break;case"labelRect":e.labelRect=t[i];break;case"fontColor":e.textColor=t[i];break;case"fontStyle":r[0]=t[i];break;case"fontVariant":r[1]=t[i];break;case"fontWeight":r[2]=t[i];break;case"fontSize":var n="";t[i]&&t[i].toString().indexOf("px")<0&&(n="px"),r[3]=t[i]+n;break;case"fontFamily":r[4]=t[i];break;case"fontOpacity":e.opacity=t[i];break;case"labelPosition":e.textPosition=t[i];break;case"labelAlign":e.textAlign=t[i];break;case"labelBaseline":e.textBaseline=t[i];break;case"labelRotation":e.textRotation=t[i];break;default:e[i]=t[i]}return e.textFont=r.join(" "),!0===s[0]&&!1===s[1]?e.brushType="fill":!1===s[0]&&!0===s[1]?e.brushType="stroke":!0===s[0]&&!0===s[1]?e.brushType="both":e.brushType="fill",null==e.lineWidth&&(e.lineWidth=1),e}static Background(t,e,r){var s=r||{},i=new Dp(e[0],e[3],Math.abs(e[2]-e[0]),Math.abs(e[3]-e[1]));return i.style={fillColor:"#f3f3f3"},s.backgroundStyle&&v.copyAttributesWithClip(i.style,s.backgroundStyle),s.backgroundRadius&&(i.style.radius=s.backgroundRadius),i.clickable=!1,i.hoverable=!1,t.createShape(i)}static GraphAxis(t,e,r,s){var i=e,n=r||{},a=[],o=[],l=!!n.useXReferenceLine&&n.useXReferenceLine,h=n.axisYTick&&!isNaN(n.axisYTick)?n.axisYTick:0,u=[],c=[];if(0==h){if(c.push([i[0],i[3]-5]),c.push([i[0],i[1]]),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){let t=parseInt(n.axis3DParameter),e=[i[0]-t,i[1]+t];n.axisUseArrow?(u.push([e[0]+1.5,e[1]-7.5]),u.push([e[0]-1,e[1]+1]),u.push([e[0]+7.5,e[1]-1.5]),c.push([e[0],e[1]])):c.push([e[0],e[1]]),c.push([i[0],i[1]])}c.push([i[2]+5,i[1]])}else{var d=Math.abs(i[1]-i[3])/h,p=i[3];c.push([i[0],p-5]);for(var f=0;f<h;f++){if(c.push([i[0],p]),c.push([i[0]-5,p]),c.push([i[0],p]),l){var m=new kp([[i[0],p],[i[2],p]]);m.style={strokeColor:"#cfcfcf",strokeLinecap:"butt",strokeLineJoin:"round",strokeWidth:1},m.clickable=!1,m.hoverable=!1,n.xReferenceLineStyle&&v.copyAttributesWithClip(m.style,n.xReferenceLineStyle),a.push(t.createShape(m))}p+=d}if(c.push([i[0],i[1]]),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){let t=parseInt(n.axis3DParameter),e=[i[0]-t,i[1]+t];n.axisUseArrow?(u.push([e[0]+1.5,e[1]-7.5]),u.push([e[0]-1,e[1]+1]),u.push([e[0]+7.5,e[1]-1.5]),c.push([e[0],e[1]])):c.push([e[0],e[1]]),c.push([i[0],i[1]])}c.push([i[2]+5,i[1]])}if(n.axisUseArrow){var y=[[i[2]+5,i[1]+4],[i[2]+13,i[1]],[i[2]+5,i[1]-4]],g=[[i[0]-4,i[3]-5],[i[0],i[3]-13],[i[0]+4,i[3]-5]],b=new Rp(y);b.style={fillColor:"#008acd"},v.copyAttributesWithClip(b.style,n.axisStyle),o.push(t.createShape(b));var S=new Rp(g);if(S.style={fillColor:"#008acd"},v.copyAttributesWithClip(S.style,n.axisStyle),o.push(t.createShape(S)),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){var _=new Rp(u);_.style={fillColor:"#008acd"},v.copyAttributesWithClip(_.style,n.axisStyle),o.push(t.createShape(_))}}var x=new kp(c);x.style={strokeLinecap:"butt",strokeLineJoin:"round",strokeColor:"#008acd",strokeWidth:1},n.axisStyle&&v.copyAttributesWithClip(x.style,n.axisStyle),x.clickable=!1,x.hoverable=!1;var w=[t.createShape(x)],A=[];if(n.axisYLabels&&n.axisYLabels.length&&n.axisYLabels.length>0){var M=n.axisYLabels;let e=M.length;var C=[0,0];if(n.axisYLabelsOffset&&n.axisYLabelsOffset.length&&(C=n.axisYLabelsOffset),1==e){let e=new Bp(i[0]-5+C[0],i[3]+C[1],M[0]);e.style={labelAlign:"right"},n.axisYLabelsStyle&&v.copyAttributesWithClip(e.style,n.axisYLabelsStyle),e.clickable=!1,e.hoverable=!1,A.push(t.createShape(e))}else for(var E=i[3],T=Math.abs(i[1]-i[3])/(e-1),O=0;O<e;O++){let e=new Bp(i[0]-5+C[0],E+C[1],M[O]);e.style={labelAlign:"right"},n.axisYLabelsStyle&&v.copyAttributesWithClip(e.style,n.axisYLabelsStyle),e.clickable=!1,e.hoverable=!1,A.push(t.createShape(e)),E+=T}}var P=[];if(n.axisXLabels&&n.axisXLabels.length&&n.axisXLabels.length>0){let e=n.axisXLabels,r=e.length,a=[0,0];if(n.axisXLabelsOffset&&n.axisXLabelsOffset.length&&(a=n.axisXLabelsOffset),s&&s.xPositions&&s.xPositions.length&&s.xPositions.length==r){let o=s.xPositions;for(let s=0;s<r;s++){let r=new Bp(o[s]+a[0],i[1]+a[1],e[s]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&v.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,P.push(t.createShape(r))}}else if(1==r){let r=new Bp(i[0]-5+a[0],i[1]+a[0],e[0]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&v.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,P.push(t.createShape(r))}else{let s=i[0],o=Math.abs(i[2]-i[0])/(r-1);for(let l=0;l<r;l++){let r=new Bp(s+a[0],i[1]+a[1],e[l]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&v.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,P.push(t.createShape(r)),s+=o}}}return a.concat(w).concat(A).concat(P).concat(o)}static ShapeStyleTool(t,e,r,s,i,n){var a=t||{};if(e&&v.copyAttributesWithClip(a,e),r&&r.length&&void 0!==i&&!isNaN(i)&&i>=0&&r[i]&&v.copyAttributesWithClip(a,r[i]),s&&s.length&&void 0!==n)for(var o=s,l=o.length,h=parseFloat(n),u=0;u<l;u++)if(o[u].start<=h&&h<o[u].end){v.copyAttributesWithClip(a,o[u].style);break}return a}}class sf{constructor(t,e){t&&e&&e.map&&e.renderer&&(this.id=v.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=null,this.location=[],this.data=t,this.shapes=[],this.layer=e,this.CLASS_NAME="SuperMap.Feature.Theme")}destroy(){this.data=null,this.id=null,this.lonlat=null,this.location=null,this.shapes=null,this.layer=null}getLocalXY(t){var e=this.layer.map.getResolution(),r=this.layer.map.getExtent();if(t instanceof w||t instanceof Zn){return[t.x/e+-r.left/e,r.top/e-t.y/e]}if(t instanceof _){return[t.lon/e+-r.left/e,r.top/e-t.lat/e]}return null}}class nf extends sf{constructor(t,e,r,s,i,n){super(t,e,r,s,i,n),this.shapeFactory=new rf,this.shapeParameters=null,this.RelativeCoordinate=!1,this.setting=null,this.origonPoint=null,this.chartBox=null,this.chartBounds=null,this.width=null,this.height=null,this.XOffset=0,this.YOffset=0,this.DVBParameter=null,this.dataViewBox=null,this.DVBCodomain=null,this.DVBCenterPoint=null,this.DVBUnitValue=null,this.DVBOrigonPoint=null,this.DVBWidth=null,this.DVBHeight=null,this.origonPointOffset=null,this.fields=r||[],this.dataValues=null,this.lonlat=i||this.data.geometry.getBounds().getCenterLonLat(),s&&s.width&&s.height&&s.codomain&&(this.setting=s),this.CLASS_NAME="SuperMap.Feature.Theme.Graph"}destroy(){this.shapeFactory=null,this.shapeParameters=null,this.width=null,this.height=null,this.origonPoint=null,this.chartBox=null,this.dataViewBox=null,this.chartBounds=null,this.DVBParameter=null,this.DVBOrigonPoint=null,this.DVBCenterPoint=null,this.DVBWidth=null,this.DVBHeight=null,this.DVBCodomain=null,this.DVBUnitValue=null,this.origonPointOffset=null,this.XOffset=null,this.YOffset=null,this.fields=null,this.dataValues=null,this.setting=null,super.destroy()}initBaseParameter(){if(!this.setting)return!1;var t=this.setting;if(!(t.width&&t.height&&t.codomain))return!1;var e=void 0===t.decimalNumber||isNaN(t.decimalNumber)?-1:t.decimalNumber,r=sf.getDataValues(this.data,this.fields,e);this.dataValues=r||[],this.width=parseFloat(t.width),this.height=parseFloat(t.height),this.DVBCodomain=t.codomain,this.XOffset=t.XOffset?t.XOffset:0,this.YOffset=t.YOffset?t.YOffset:0,this.origonPoint=[],this.chartBox=[],this.dataViewBox=[],this.DVBParameter=t.dataViewBoxParameter?t.dataViewBoxParameter:[0,0,0,0],this.DVBOrigonPoint=[],this.DVBCenterPoint=[],this.origonPointOffset=[],this.resetLocation();var s=this.width,i=this.height,n=this.location;this.origonPoint=[n[0]-s/2,n[1]-i/2];var a=this.origonPoint;this.chartBox=[a[0],a[1]+i,a[0]+s,a[1]];var o=this.chartBox,l=this.DVBParameter;this.dataViewBox=[o[0]+l[0],o[1]-l[1],o[2]-l[2],o[3]+l[3]];var h=this.dataViewBox;return!(h[0]>=h[2]||h[1]<=h[3])&&(this.DVBOrigonPoint=[h[0],h[3]],this.DVBWidth=Math.abs(h[2]-h[0]),this.DVBHeight=Math.abs(h[1]-h[3]),this.DVBCenterPoint=[this.DVBOrigonPoint[0]+this.DVBWidth/2,this.DVBOrigonPoint[1]+this.DVBHeight/2],this.origonPointOffset=[this.DVBOrigonPoint[0]-a[0],this.DVBOrigonPoint[1]-a[1]],!0)}resetLocation(t){t&&(this.lonlat=t);var e=this.getLocalXY(this.lonlat);e[0]+=this.XOffset,e[1]+=this.YOffset,this.location=e;var r=this.width,s=this.height,i=this.location;return this.chartBounds=new x(i[0]-r/2,i[1]+s/2,i[0]+r/2,i[1]-s/2),this.resetLinearGradient(),i}resetLinearGradient(){}shapesConvertToRelativeCoordinate(){for(var t=this.shapes,e=this.location,r=0,s=t.length;r<s;r++){t[r].refOriginalPosition=e;var i=t[r].style;for(var n in i)switch(n){case"pointList":for(var a=i[n],o=0,l=a.length;o<l;o++)a[o][0]-=e[0],a[o][1]-=e[1];break;case"x":i[n]-=e[0];break;case"y":i[n]-=e[1]}}this.RelativeCoordinate=!0}assembleShapes(){}getLocalXY(t){return this.layer.getLocalXY(t)}}sf.getDataValues=function(t,e,r){if(!t.attributes)return!1;for(var s=[],i=t.attributes,n=0;n<e.length;n++)for(var a in i)if(a===e[n])try{!isNaN(r)&&r>=0?s.push(parseFloat(i[a].toString()).toFixed(r)):s.push(parseFloat(i[a].toString()))}catch(t){throw new Error("not a number")}return s.length===e.length&&s};class af extends nf{constructor(t,e,r,s,i,n){super(t,e,r,s,i,n),this.setting=null,s&&s.codomain&&(this.setting=s,this.DVBCodomain=this.setting.codomain),this.CLASS_NAME="SuperMap.Feature.Theme.RankSymbol"}destroy(){this.setting=null,super.destroy()}initBaseParameter(){if(!this.setting)return!1;var t=this.setting;t.XOffset&&(this.XOffset=t.XOffset),t.YOffset&&(this.YOffset=t.YOffset),this.XOffset=t.XOffset?t.XOffset:0,this.YOffset=t.YOffset?t.YOffset:0,this.origonPoint=[],this.chartBox=[],this.dataViewBox=[],this.DVBParameter=t.dataViewBoxParameter?t.dataViewBoxParameter:[0,0,0,0],this.DVBOrigonPoint=[],this.DVBCenterPoint=[],this.origonPointOffset=[],this.resetLocation();var e=this.width,r=this.height,s=this.location;this.origonPoint=[s[0]-e/2,s[1]-r/2];var i=this.origonPoint;this.chartBox=[i[0],i[1]+r,i[0]+e,i[1]];var n=this.chartBox,a=this.DVBParameter;this.dataViewBox=[n[0]+a[0],n[1]-a[1],n[2]-a[2],n[3]+a[3]];var o=this.dataViewBox;return!(o[0]>=o[2]||o[1]<=o[3])&&(this.DVBOrigonPoint=[o[0],o[3]],this.DVBWidth=Math.abs(o[2]-o[0]),this.DVBHeight=Math.abs(o[1]-o[3]),this.DVBCenterPoint=[this.DVBOrigonPoint[0]+this.DVBWidth/2,this.DVBOrigonPoint[1]+this.DVBHeight/2],this.origonPointOffset=[this.DVBOrigonPoint[0]-i[0],this.DVBOrigonPoint[1]-i[1]],!0)}}class of extends(o(Up,Hp)){constructor(t){super(t),t=t||{},this.id=null,this.type="group",this.clipShape=null,this._children=[],this._storage=null,this.__dirty=!0,this.ignore=!1,v.extend(this,t),this.id=this.id||v.createUniqueID("smShapeGroup_"),this.CLASS_NAME="SuperMap.LevelRenderer.Group"}destroy(){this.id=null,this.type=null,this.clipShape=null,this._children=null,this._storage=null,this.__dirty=null,this.ignore=null,super.destroy()}children(){return this._children.slice()}childAt(t){return this._children[t]}addChild(t){t!=this&&t.parent!=this&&(t.parent&&t.parent.removeChild(t),this._children.push(t),t.parent=this,this._storage&&this._storage!==t._storage&&(this._storage.addToMap(t),t instanceof of&&t.addChildrenToStorage(this._storage)))}removeChild(t){var e=v.indexOf(this._children,t);this._children.splice(e,1),t.parent=null,this._storage&&(this._storage.delFromMap(t.id),t instanceof of&&t.delChildrenFromStorage(this._storage))}eachChild(t,e){for(var r=!!e,s=0;s<this._children.length;s++){var i=this._children[s];r?t.call(e,i):t(i)}}traverse(t,e){for(var r=!!e,s=0;s<this._children.length;s++){var i=this._children[s];r?t.call(e,i):t(i),"group"===i.type&&i.traverse(t,e)}}addChildrenToStorage(t){for(var e=0;e<this._children.length;e++){var r=this._children[e];t.addToMap(r),"group"===r.type&&r.addChildrenToStorage(t)}}delChildrenFromStorage(t){for(var e=0;e<this._children.length;e++){var r=this._children[e];t.delFromMap(r.id),"group"===r.type&&r.delChildrenFromStorage(t)}}modSelf(){this.__dirty=!0}}class lf{constructor(){this._elements={},this._hoverElements=[],this._roots=[],this._shapeList=[],this._shapeListOffset=0,this.CLASS_NAME="SuperMap.LevelRenderer.Storage"}destroy(){this.dispose(),this._shapeList=null,this._shapeListOffset=null}iterShape(t,e){if(!e){e={hover:!1,normal:"down",update:!1}}if(e.hover)for(var r=0,s=this._hoverElements.length;r<s;r++){var i=this._hoverElements[r];if(i.updateTransform(),t(i))return this}switch(e.update&&this.updateShapeList(),e.normal){case"down":{let e=this._shapeList.length;for(;e--;)if(t(this._shapeList[e]))return this;break}default:for(let e=0,r=this._shapeList.length;e<r;e++)if(t(this._shapeList[e]))return this}return this}getHoverShapes(t){var e=[],r=this._hoverElements.length;for(let t=0;t<r;t++){e.push(this._hoverElements[t]);var s=this._hoverElements[t].hoverConnect;if(s)for(var i,n=0,a=(s=s instanceof Array?s:[s]).length;n<a;n++)(i=s[n].id?s[n]:this.get(s[n]))&&e.push(i)}if(e.sort(lf.shapeCompareFunc),t)for(let t=0,r=e.length;t<r;t++)e[t].updateTransform();return e}getShapeList(t){return t&&this.updateShapeList(),this._shapeList}updateShapeList(){this._shapeListOffset=0;var t=this._roots.length;for(let e=0;e<t;e++){let t=this._roots[e];this._updateAndAddShape(t)}this._shapeList.length=this._shapeListOffset;var e=this._shapeList.length;for(let t=0;t<e;t++)this._shapeList[t].__renderidx=t;this._shapeList.sort(lf.shapeCompareFunc)}_updateAndAddShape(t,e){if(!t.ignore)if(t.updateTransform(),"group"==t.type){t.clipShape&&(t.clipShape.parent=t,t.clipShape.updateTransform(),e?(e=e.slice()).push(t.clipShape):e=[t.clipShape]);for(var r=0;r<t._children.length;r++){var s=t._children[r];s.__dirty=t.__dirty||s.__dirty,this._updateAndAddShape(s,e)}t.__dirty=!1}else t.__clipShapes=e,this._shapeList[this._shapeListOffset++]=t}mod(t,e){var r=this._elements[t];if(r&&(r.modSelf(),e))if(e.parent||e._storage||e.__startClip){var s={};for(var i in e)"parent"!=i&&"_storage"!=i&&"__startClip"!=i&&e.hasOwnProperty(i)&&(s[i]=e[i]);(new Mp).merge(r,s,!0)}else(new Mp).merge(r,e,!0);return this}drift(t,e,r){var s=this._elements[t];return s&&(s.needTransform=!0,"horizontal"===s.draggable?r=0:"vertical"===s.draggable&&(e=0),(!s.ondrift||s.ondrift&&!s.ondrift(e,r))&&s.drift(e,r)),this}addHover(t){return t.updateNeedTransform(),this._hoverElements.push(t),this}delHover(){return this._hoverElements=[],this}hasHoverShape(){return this._hoverElements.length>0}addRoot(t){t instanceof of&&t.addChildrenToStorage(this),this.addToMap(t),this._roots.push(t)}delRoot(t){if(void 0===t){for(var e=0;e<this._roots.length;e++){var r=this._roots[e];r instanceof of&&r.delChildrenFromStorage(this)}return this._elements={},this._hoverElements=[],void(this._roots=[])}if(t instanceof Array){var s=t.length;for(let e=0;e<s;e++)this.delRoot(t[e])}else{var i;i="string"==typeof t?this._elements[t]:t;var n=(new Mp).indexOf(this._roots,i);n>=0&&(this.delFromMap(i.id),this._roots.splice(n,1),i instanceof of&&i.delChildrenFromStorage(this))}}addToMap(t){return t instanceof of&&(t._storage=this),t.modSelf(),this._elements[t.id]=t,this}get(t){return this._elements[t]}delFromMap(t){var e=this._elements[t];return e&&(delete this._elements[t],e instanceof of&&(e._storage=null)),this}dispose(){this._elements=null,this._roots=null,this._hoverElements=null}static shapeCompareFunc(t,e){return t.zlevel==e.zlevel?t.z==e.z?t.__renderidx-e.__renderidx:t.z-e.z:t.zlevel-e.zlevel}}class hf{constructor(t,e){this.root=t,this.storage=e,this._domRoot=null,this._layers={},this._zlevelList=[],this._layerConfig={},this._bgDom=null,this.shapeToImage=null,hf.devicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.CLASS_NAME="SuperMap.LevelRenderer.Painter",this.root.innerHTML="",this._width=this._getWidth(),this._height=this._getHeight();var r=document.createElement("div");this._domRoot=r,r.style.position="relative",r.style.overflow="hidden",r.style.width=this._width+"px",r.style.height=this._height+"px",this.root.appendChild(r),this.shapeToImage=this._createShapeToImageProcessor(),this._bgDom=hf.createDom(v.createUniqueID("SuperMap.Theme_background_"),"div",this),r.appendChild(this._bgDom),this._bgDom.onselectstart=n,this._bgDom.style["-webkit-user-select"]="none",this._bgDom.style["user-select"]="none",this._bgDom.style["-webkit-touch-callout"]="none";var s=new uf(v.createUniqueID("_highLightLayer_"),this);this._layers.hover=s,r.appendChild(s.dom),s.initContext(),s.dom.onselectstart=n,s.dom.style["-webkit-user-select"]="none",s.dom.style["user-select"]="none",s.dom.style["-webkit-touch-callout"]="none";var i=this;function n(){return!1}this.updatePainter=function(t,e){i.refreshShapes(t,e)}}destroy(){this.dispose(),this._zlevelList=null,this._layerConfig=null,this._bgDom=null,this.shapeToImage=null}render(t){return this.refresh(t,!0),this}refresh(t,e){var r=this.storage.getShapeList(!0);return this._paintList(r,e),"function"==typeof t&&t(),this}_paintList(t,e){var r,s,i;for(var n in void 0===e&&(e=!1),this._updateLayerStatus(t),this._layers)"hover"!==n&&(this._layers[n].unusedCount++,this._layers[n].updateTransform());for(var a=[],o=0,l=t.length;o<l;o++){var h=t[o];if(s!==h.zlevel&&(r&&r.needTransform&&i.restore(),i=(r=this.getLayer(h.zlevel)).ctx,s=h.zlevel,r.unusedCount=0,(r.dirty||e)&&r.clear(),r.needTransform&&(i.save(),r.setTransform(i))),i&&h.__startClip){var u=h.__startClip;if(i.save(),u.needTransform){let t=u.transform;Vp.Util_matrix.invert(a,t),i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}if(i.beginPath(),u.buildPath(i,u.style),i.clip(),u.needTransform){let t=a;i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}}if((r&&r.dirty||e)&&!h.invisible&&(!h.onbrush||h.onbrush&&!h.onbrush(i,!1)))if(qp.catchBrushException)try{h.brush(i,!1,this.updatePainter)}catch(t){Vp.Util_log(t,"brush error of "+h.type,h)}else h.brush(i,!1,this.updatePainter);i&&h.__stopClip&&i.restore(),h.__dirty=!1}i&&r&&r.needTransform&&i.restore();for(let t in this._layers)if("hover"!==t){var c=this._layers[t];c.dirty=!1,1==c.unusedCount&&c.clear()}}getLayer(t){var e=this._layers[t];if(!e){var r=this._zlevelList.length,s=null,i=-1;if(r>0&&t>this._zlevelList[0]){for(i=0;i<r-1&&!(this._zlevelList[i]<t&&this._zlevelList[i+1]>t);i++);s=this._layers[this._zlevelList[i]]}this._zlevelList.splice(i+1,0,t),e=new uf(v.createUniqueID("_levelLayer_"+t),this);var n=s?s.dom:this._bgDom;n.nextSibling?n.parentNode.insertBefore(e.dom,n.nextSibling):n.parentNode.appendChild(e.dom),e.initContext(),this._layers[t]=e,this._layerConfig[t]&&(new Mp).merge(e,this._layerConfig[t],!0),e.updateTransform()}return e}getLayers(){return this._layers}_updateLayerStatus(t){var e=this._layers,r={};for(let t in e)"hover"!==t&&(r[t]=e[t].elCount,e[t].elCount=0);for(let r=0;r<t.length;r++){var s=t[r],i=e[s.zlevel];if(i){if(i.elCount++,i.dirty)continue;i.dirty=s.__dirty}}for(let t in e)"hover"!==t&&r[t]!==e[t].elCount&&(e[t].dirty=!0)}refreshShapes(t,e){for(var r=0,s=t.length;r<s;r++){var i=t[r];this.storage.mod(i.id)}return this.refresh(e),this}clear(){for(var t in this._layers)"hover"!=t&&this._layers[t].clear();return this}modLayer(t,e){if(e){this._layerConfig[t]?(new Mp).merge(this._layerConfig[t],e,!0):this._layerConfig[t]=e;var r=this._layers[t];r&&(new Mp).merge(r,this._layerConfig[t],!0)}}delLayer(t){var e=this._layers[t];e&&(this.modLayer(t,{position:e.position,rotation:e.rotation,scale:e.scale}),e.dom.parentNode.removeChild(e.dom),delete this._layers[t],this._zlevelList.splice((new Mp).indexOf(this._zlevelList,t),1))}refreshHover(){this.clearHover();for(var t=this.storage.getHoverShapes(!0),e=0,r=t.length;e<r;e++)this._brushHover(t[e]);return this.storage.delHover(),this}clearHover(){var t=this._layers.hover;return t&&t.clear(),this}resize(){var t=this._domRoot;t.style.display="none";var e=this._getWidth(),r=this._getHeight();if(t.style.display="",this._width!=e||r!=this._height){for(var s in this._width=e,this._height=r,t.style.width=e+"px",t.style.height=r+"px",this._layers)this._layers[s].resize(e,r);this.refresh(null,!0)}return this}clearLayer(t){var e=this._layers[t];e&&e.clear()}dispose(){this.root.innerHTML="",this.root=null,this.storage=null,this._domRoot=null,this._layers=null}getDomHover(){return this._layers.hover.dom}toDataURL(t,e,r){var s=hf.createDom(v.createUniqueID("SuperMap.Theme.image_"),"canvas",this);this._bgDom.appendChild(s);var i=s.getContext("2d");1!=hf.devicePixelRatio&&i.scale(hf.devicePixelRatio,hf.devicePixelRatio),i.fillStyle=e||"#fff",i.rect(0,0,this._width*hf.devicePixelRatio,this._height*hf.devicePixelRatio),i.fill();var n=this;this.storage.iterShape(function(t){if(!t.invisible&&(!t.onbrush||t.onbrush&&!t.onbrush(i,!1)))if(qp.catchBrushException)try{t.brush(i,!1,n.updatePainter)}catch(e){Vp.Util_log(e,"brush error of "+t.type,t)}else t.brush(i,!1,n.updatePainter)},{normal:"up",update:!0});var a=s.toDataURL(t,r);return i=null,this._bgDom.removeChild(s),a}getWidth(){return this._width}getHeight(){return this._height}_getWidth(){var t=this.root,e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientWidth||parseInt(e.width,10))-parseInt(e.paddingLeft,10)-parseInt(e.paddingRight,10)).toFixed(0)-0}_getHeight(){var t=this.root,e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientHeight||parseInt(e.height,10))-parseInt(e.paddingTop,10)-parseInt(e.paddingBottom,10)).toFixed(0)-0}_brushHover(t){var e=this._layers.hover.ctx;if(!t.onbrush||t.onbrush&&!t.onbrush(e,!0)){var r=this.getLayer(t.zlevel);if(r.needTransform&&(e.save(),r.setTransform(e)),qp.catchBrushException)try{t.brush(e,!0,this.updatePainter)}catch(e){Vp.Util_log(e,"hoverBrush error of "+t.type,t)}else t.brush(e,!0,this.updatePainter);r.needTransform&&e.restore()}}_shapeToImage(t,e,r,s,i){var n=document.createElement("canvas"),a=n.getContext("2d"),o=i||window.devicePixelRatio||1;n.style.width=r+"px",n.style.height=s+"px",n.setAttribute("width",r*o),n.setAttribute("height",s*o),a.clearRect(0,0,r*o,s*o);var l={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[0,0,0],e.rotation=0,e.scale=[1,1],e&&e.brush(a,!1);var h=new $p({id:t,style:{x:0,y:0,image:n}});return null!=l.position&&(h.position=e.position=l.position),null!=l.rotation&&(h.rotation=e.rotation=l.rotation),null!=l.scale&&(h.scale=e.scale=l.scale),h}_createShapeToImageProcessor(){var t=this;return function(e,r,s,i){return t._shapeToImage(e,r,s,i,hf.devicePixelRatio)}}updateHoverLayer(t){if(!(t instanceof Array))return this;this.clearHover(),this.storage.delHover();for(var e=0;e<t.length;e++)this.storage.addHover(t[e]),this._brushHover(t[e])}static createDom(t,e,r){var s=document.createElement(e),i=r._width,n=r._height;return s.style.position="absolute",s.style.left=0,s.style.top=0,s.style.width=i+"px",s.style.height=n+"px",s.setAttribute("width",i*hf.devicePixelRatio),s.setAttribute("height",n*hf.devicePixelRatio),s.setAttribute("id",t),s}}class uf extends Hp{constructor(t,e){super(t,e),this.dom=null,this.domBack=null,this.ctxBack=null,this.painter=e,this.unusedCount=0,this.config=null,this.dirty=!0,this.elCount=0,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.zoomable=!1,this.panable=!1,this.maxZoom=1/0,this.minZoom=0,this.ctx=null,this.dom=hf.createDom(v.createUniqueID("SuperMap.Theme"+t),"canvas",e),this.dom.onselectstart=function(){return!1},this.dom.style["-webkit-user-select"]="none",this.dom.style["user-select"]="none",this.dom.style["-webkit-touch-callout"]="none",this.CLASS_NAME="SuperMap.LevelRenderer.Painter.Layer"}destroy(){this.dom=null,this.domBack=null,this.ctxBack=null,this.painter=null,this.unusedCount=null,this.config=null,this.dirty=null,this.elCount=null,this.clearColor=null,this.motionBlur=null,this.lastFrameAlpha=null,this.zoomable=null,this.panable=null,this.maxZoom=null,this.minZoom=null,this.ctx=null,Hp.destroy.apply(this,arguments)}initContext(){this.ctx=this.dom.getContext("2d"),1!=hf.devicePixelRatio&&this.ctx.scale(hf.devicePixelRatio,hf.devicePixelRatio)}createBackBuffer(){this.domBack=hf.createDom(v.createUniqueID("SuperMap.Theme.back-"+this.id),"canvas",this.painter),this.ctxBack=this.domBack.getContext("2d"),1!=hf.devicePixelRatio&&this.ctxBack.scale(hf.devicePixelRatio,hf.devicePixelRatio)}resize(t,e){this.dom.style.width=t+"px",this.dom.style.height=e+"px",this.dom.setAttribute("width",t*hf.devicePixelRatio),this.dom.setAttribute("height",e*hf.devicePixelRatio),1!=hf.devicePixelRatio&&this.ctx.scale(hf.devicePixelRatio,hf.devicePixelRatio),this.domBack&&(this.domBack.setAttribute("width",t*hf.devicePixelRatio),this.domBack.setAttribute("height",e*hf.devicePixelRatio),1!=hf.devicePixelRatio&&this.ctxBack.scale(hf.devicePixelRatio,hf.devicePixelRatio))}clear(){var t=this.dom,e=this.ctx,r=t.width,s=t.height,i=this.clearColor,n=this.motionBlur,a=this.lastFrameAlpha;if(n&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(t,0,0,r/hf.devicePixelRatio,s/hf.devicePixelRatio)),i?(e.save(),e.fillStyle=this.config.clearColor,e.fillRect(0,0,r/hf.devicePixelRatio,s/hf.devicePixelRatio),e.restore()):e.clearRect(0,0,r/hf.devicePixelRatio,s/hf.devicePixelRatio),n){var o=this.domBack;e.save(),e.globalAlpha=a,e.drawImage(o,0,0,r/hf.devicePixelRatio,s/hf.devicePixelRatio),e.restore()}}}class cf extends Up{constructor(t,e,r){var s,i;super(t,e,r),this.root=t,this.storage=e,this.painter=r,this._lastX=0,this._lastY=0,this._mouseX=0,this._mouseY=0,this._findHover=null,this._domHover=null,this._findHover=(s=function(t,e,r){var s=this;if(s._draggingTarget&&s._draggingTarget.id==t.id||t.isSilent())return!1;var i=s._event;if(t.isCover(e,r)){if(t.hoverable)if(t.isHoverByRefDataID&&!0===t.isHoverByRefDataID){if(t.refDataID){var n=t.refDataID,a=null;t.refDataHoverGroup&&(a=t.refDataHoverGroup);for(var o=s.storage._shapeList,l=0,h=o.length;l<h;l++){var u=o[l];u.refDataID&&n===u.refDataID&&(a?u.refDataHoverGroup&&a===u.refDataHoverGroup&&s.storage.addHover(u):s.storage.addHover(u))}}}else s.storage.addHover(t);for(var c=t.parent;c;){if(c.clipShape&&!c.clipShape.isCover(s._mouseX,s._mouseY))return!1;c=c.parent}return s._lastHover!=t&&(s._processOutShape(i),s._processDragLeave(i),s._lastHover=t,s._processDragEnter(i)),s._processOverShape(i),s._processDragOver(i),s._hasfound=1,!0}return!1},i=this,function(t,e,r){return s.call(i,t,e,r)}),this._domHover=r.getDomHover(),this.CLASS_NAME="SuperMap.LevelRenderer.Handler";var n={resize:function(t){t=t||window.event,this._lastHover=null,this._isMouseDown=0,this.dispatch(qp.EVENT.RESIZE,t)},click:function(t){t=this._zrenderEventFixed(t);var e=this._lastHover;(e&&e.clickable||!e)&&this._clickThreshold<10&&this._dispatchAgency(e,qp.EVENT.CLICK,t),this._mousemoveHandler(t)},dblclick:function(t){t=t||window.event,t=this._zrenderEventFixed(t);var e=this._lastHover;(e&&e.clickable||!e)&&this._clickThreshold<5&&this._dispatchAgency(e,qp.EVENT.DBLCLICK,t),this._mousemoveHandler(t)},mousewheel:function(t){var e=((t=this._zrenderEventFixed(t)).wheelDelta||-t.detail)>0?1.1:1/1.1,r=this.painter.getLayers(),s=!1;for(var i in r)if("hover"!==i){var n=r[i],a=n.position;if(n.zoomable){n.__zoom=n.__zoom||1;var o=n.__zoom;o*=e,e=(o=Math.max(Math.min(n.maxZoom,o),n.minZoom))/n.__zoom,n.__zoom=o,a[0]-=(this._mouseX-a[0])*(e-1),a[1]-=(this._mouseY-a[1])*(e-1),n.scale[0]*=e,n.scale[1]*=e,n.dirty=!0,s=!0}}s&&this.painter.refresh(),this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEWHEEL,t),this._mousemoveHandler(t)},mousemove:function(t){this._clickThreshold++,t=this._zrenderEventFixed(t),this._lastX=this._mouseX,this._lastY=this._mouseY,this._mouseX=Vp.Util_event.getX(t),this._mouseY=Vp.Util_event.getY(t);var e=this._mouseX-this._lastX,r=this._mouseY-this._lastY;this._processDragStart(t),this._hasfound=0,this._event=t,this._iterateAndFindHover(),this._hasfound||((!this._draggingTarget||this._lastHover&&this._lastHover!=this._draggingTarget)&&(this._processOutShape(t),this._processDragLeave(t)),this._lastHover=null,this.storage.delHover(),this.painter.clearHover());var s="";if(this._draggingTarget)this.storage.drift(this._draggingTarget.id,e,r),this._draggingTarget.modSelf(),this.storage.addHover(this._draggingTarget);else if(this._isMouseDown){var i=this.painter.getLayers(),n=!1;for(var a in i)if("hover"!==a){var o=i[a];o.panable&&(s="move",o.position[0]+=e,o.position[1]+=r,n=!0,o.dirty=!0)}n&&this.painter.refresh()}this._draggingTarget||this._hasfound&&this._lastHover.draggable?s="move":this._hasfound&&this._lastHover.clickable&&(s="pointer"),this.root.style.cursor=s,this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEMOVE,t),(this._draggingTarget||this._hasfound||this.storage.hasHoverShape())&&this.painter.refreshHover()},mouseout:function(t){var e=(t=this._zrenderEventFixed(t)).toElement||t.relatedTarget;if(e!=this.root)for(;e&&9!=e.nodeType;){if(e==this.root)return void this._mousemoveHandler(t);e=e.parentNode}t.zrenderX=this._lastX,t.zrenderY=this._lastY,this.root.style.cursor="",this._isMouseDown=0,this._processOutShape(t),this._processDrop(t),this._processDragEnd(t),this.painter.refreshHover(),this.dispatch(qp.EVENT.GLOBALOUT,t)},mousedown:function(t){if(this._clickThreshold=0,2==this._lastDownButton)return this._lastDownButton=t.button,void(this._mouseDownTarget=null);this._lastMouseDownMoment=new Date,t=this._zrenderEventFixed(t),this._isMouseDown=1,this._mouseDownTarget=this._lastHover,this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEDOWN,t),this._lastDownButton=t.button},mouseup:function(t){t=this._zrenderEventFixed(t),this.root.style.cursor="",this._isMouseDown=0,this._mouseDownTarget=null,this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEUP,t),this._processDrop(t),this._processDragEnd(t)},touchstart:function(t){t=this._zrenderEventFixed(t,!0),this._lastTouchMoment=new Date,this._mobildFindFixed(t),this._mousedownHandler(t)},touchmove:function(t){t=this._zrenderEventFixed(t,!0),this._mousemoveHandler(t),this._isDragging&&Vp.Util_event.stop(t)},touchend:function(t){t=this._zrenderEventFixed(t,!0),this._mouseupHandler(t);var e=new Date;e-this._lastTouchMoment<qp.EVENT.touchClickDelay&&(this._mobildFindFixed(t),this._clickHandler(t),e-this._lastClickMoment<qp.EVENT.touchClickDelay/2&&(this._dblclickHandler(t),this._lastHover&&this._lastHover.clickable&&Vp.Util_event.stop(t)),this._lastClickMoment=e),this.painter.clearHover()}};function a(t,e){return function(r){return t.call(e,r)}}!function(t){var e=["resize","click","dblclick","mousewheel","mousemove","mouseout","mouseup","mousedown","touchstart","touchend","touchmove"],r=e.length;for(;r--;){var s=e[r];t["_"+s+"Handler"]=a(n[s],t)}}(this),window.addEventListener?(window.addEventListener("resize",this._resizeHandler),Vp.Util_env.os.tablet||Vp.Util_env.os.phone?(t.addEventListener("touchstart",this._touchstartHandler),t.addEventListener("touchmove",this._touchmoveHandler),t.addEventListener("touchend",this._touchendHandler)):(t.addEventListener("click",this._clickHandler),t.addEventListener("dblclick",this._dblclickHandler),t.addEventListener("mousewheel",this._mousewheelHandler),t.addEventListener("mousemove",this._mousemoveHandler),t.addEventListener("mousedown",this._mousedownHandler),t.addEventListener("mouseup",this._mouseupHandler)),t.addEventListener("DOMMouseScroll",this._mousewheelHandler),t.addEventListener("mouseout",this._mouseoutHandler)):(window.attachEvent("onresize",this._resizeHandler),t.attachEvent("onclick",this._clickHandler),t.ondblclick=this._dblclickHandler,t.attachEvent("onmousewheel",this._mousewheelHandler),t.attachEvent("onmousemove",this._mousemoveHandler),t.attachEvent("onmouseout",this._mouseoutHandler),t.attachEvent("onmousedown",this._mousedownHandler),t.attachEvent("onmouseup",this._mouseupHandler))}destroy(){this.dispose(),this._lastX=null,this._lastY=null,this._mouseX=null,this._mouseY=null,this._findHover=null,Up.prototype.destroy.apply(this,arguments)}on(t,e){return this.bind(t,e),this}un(t,e){return this.unbind(t,e),this}trigger(t,e){var r=qp.EVENT;switch(t){case r.RESIZE:case r.CLICK:case r.DBLCLICK:case r.MOUSEWHEEL:case r.MOUSEMOVE:case r.MOUSEDOWN:case r.MOUSEUP:case r.MOUSEOUT:this["_"+t+"Handler"](e)}}dispose(){var t=this.root;window.removeEventListener?(window.removeEventListener("resize",this._resizeHandler),Vp.Util_env.os.tablet||Vp.Util_env.os.phone?(t.removeEventListener("touchstart",this._touchstartHandler),t.removeEventListener("touchmove",this._touchmoveHandler),t.removeEventListener("touchend",this._touchendHandler)):(t.removeEventListener("click",this._clickHandler),t.removeEventListener("dblclick",this._dblclickHandler),t.removeEventListener("mousewheel",this._mousewheelHandler),t.removeEventListener("mousemove",this._mousemoveHandler),t.removeEventListener("mousedown",this._mousedownHandler),t.removeEventListener("mouseup",this._mouseupHandler)),t.removeEventListener("DOMMouseScroll",this._mousewheelHandler),t.removeEventListener("mouseout",this._mouseoutHandler)):(window.detachEvent("onresize",this._resizeHandler),t.detachEvent("onclick",this._clickHandler),t.detachEvent("dblclick",this._dblclickHandler),t.detachEvent("onmousewheel",this._mousewheelHandler),t.detachEvent("onmousemove",this._mousemoveHandler),t.detachEvent("onmouseout",this._mouseoutHandler),t.detachEvent("onmousedown",this._mousedownHandler),t.detachEvent("onmouseup",this._mouseupHandler)),this.root=null,this._domHover=null,this.storage=null,this.painter=null,this.un()}_processDragStart(t){var e=this._lastHover;if(this._isMouseDown&&e&&e.draggable&&!this._draggingTarget&&this._mouseDownTarget==e){if(e.dragEnableTime&&new Date-this._lastMouseDownMoment<e.dragEnableTime)return;var r=e;this._draggingTarget=r,this._isDragging=1,r.invisible=!0,this.storage.mod(r.id),this._dispatchAgency(r,qp.EVENT.DRAGSTART,t),this.painter.refresh()}}_processDragEnter(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,qp.EVENT.DRAGENTER,t,this._draggingTarget)}_processDragOver(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,qp.EVENT.DRAGOVER,t,this._draggingTarget)}_processDragLeave(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,qp.EVENT.DRAGLEAVE,t,this._draggingTarget)}_processDrop(t){this._draggingTarget&&(this._draggingTarget.invisible=!1,this.storage.mod(this._draggingTarget.id),this.painter.refresh(),this._dispatchAgency(this._lastHover,qp.EVENT.DROP,t,this._draggingTarget))}_processDragEnd(t){this._draggingTarget&&(this._dispatchAgency(this._draggingTarget,qp.EVENT.DRAGEND,t),this._lastHover=null),this._isDragging=0,this._draggingTarget=null}_processOverShape(t){this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEOVER,t)}_processOutShape(t){this._dispatchAgency(this._lastHover,qp.EVENT.MOUSEOUT,t)}_dispatchAgency(t,e,r,s){var i="on"+e,n={type:e,event:r,target:t,cancelBubble:!1},a=t;for(s&&(n.dragged=s);a&&(a[i]&&(n.cancelBubble=a[i](n)),a.dispatch(e,n),a=a.parent,!n.cancelBubble););t?n.cancelBubble||this.dispatch(e,n):s||this.dispatch(e,{type:e,event:r})}_iterateAndFindHover(){for(var t,e=Vp.Util_matrix.create(),r=this.storage.getShapeList(),s=[0,0],i=r.length-1;i>=0;i--){var n=r[i];if(void 0!==n.zlevel&&(t=this.painter.getLayer(n.zlevel,t),s[0]=this._mouseX,s[1]=this._mouseY,t.needTransform&&(Vp.Util_matrix.invert(e,t.transform),Vp.Util_vector.applyTransform(s,s,e))),this._findHover(n,s[0],s[1]))break}}_mobildFindFixed(t){var e=[{x:10},{x:-20},{x:10,y:10},{y:-20}];this._lastHover=null,this._mouseX=t.zrenderX,this._mouseY=t.zrenderY,this._event=t,this._iterateAndFindHover();for(var r=0;!this._lastHover&&r<e.length;r++){var s=e[r];s.x&&(this._mouseX+=s.x),s.y&&(this._mouseX+=s.y),this._iterateAndFindHover()}this._lastHover&&(t.zrenderX=this._mouseX,t.zrenderY=this._mouseY)}_zrenderEventFixed(t,e){if(t.zrenderFixed)return t;if(e){var r="touchend"!=t.type?t.targetTouches[0]:t.changedTouches[0];if(r){var s=this.root.getBoundingClientRect();t.zrenderX=r.clientX-s.left,t.zrenderY=r.clientY-s.top}}else{var i=(t=t||window.event).toElement||t.relatedTarget||t.srcElement||t.target;i&&i!=this._domHover&&(t.zrenderX=(void 0!==t.offsetX?t.offsetX:t.layerX)+i.offsetLeft,t.zrenderY=(void 0!==t.offsetY?t.offsetY:t.layerY)+i.offsetTop)}return t.zrenderFixed=1,t}getLastHoverOne(){return this._lastHover?this._lastHover:null}}class df{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Animation.easing"}destroy(){}Linear(t){return t}QuadraticIn(t){return t*t}QuadraticOut(t){return t*(2-t)}QuadraticInOut(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}CubicIn(t){return t*t*t}CubicOut(t){return--t*t*t+1}CubicInOut(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}QuarticIn(t){return t*t*t*t}QuarticOut(t){return 1- --t*t*t*t}QuarticInOut(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}QuinticIn(t){return t*t*t*t*t}QuinticOut(t){return--t*t*t*t*t+1}QuinticInOut(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}SinusoidalIn(t){return 1-Math.cos(t*Math.PI/2)}SinusoidalOut(t){return Math.sin(t*Math.PI/2)}SinusoidalInOut(t){return.5*(1-Math.cos(Math.PI*t))}ExponentialIn(t){return 0===t?0:Math.pow(1024,t-1)}ExponentialOut(t){return 1===t?1:1-Math.pow(2,-10*t)}ExponentialInOut(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}CircularIn(t){return 1-Math.sqrt(1-t*t)}CircularOut(t){return Math.sqrt(1- --t*t)}CircularInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}ElasticIn(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))}ElasticOut(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)}ElasticInOut(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}BackIn(t){var e=1.70158;return t*t*((e+1)*t-e)}BackOut(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}BackInOut(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}BounceIn(t){return 1-this.BounceOut(1-t)}BounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}BounceInOut(t){return t<.5?.5*this.BounceIn(2*t):.5*this.BounceOut(2*t-1)+.5}}class pf{constructor(t){this._targetPool=t.target||{},this._targetPool instanceof Array||(this._targetPool=[this._targetPool]),this._life=t.life||1e3,this._delay=t.delay||0,this._startTime=(new Date).getTime()+this._delay,this._endTime=this._startTime+1e3*this._life,this.loop=void 0!==t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"Linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart,this.CLASS_NAME="SuperMap.LevelRenderer.Animation.Clip"}destroy(){}step(t){var e=new df,r=(t-this._startTime)/this._life;if(!(r<0)){r=Math.min(r,1);var s="string"==typeof this.easing?e[this.easing]:this.easing,i="function"==typeof s?s(r):r;return this.fire("frame",i),1==r?this.loop?(this.restart(),"restart"):(this._needsRemove=!0,"destroy"):null}}restart(){var t=((new Date).getTime()-this._startTime)%this._life;this._startTime=(new Date).getTime()-t+this.gap}fire(t,e){for(var r=0,s=this._targetPool.length;r<s;r++)this["on"+t]&&this["on"+t](this._targetPool[r],e)}}class ff extends Up{constructor(t){super(t),t=t||{},this.stage={},this.onframe=function(){},this._clips=[],this._running=!1,this._time=0,v.extend(this,t),this.CLASS_NAME="SuperMap.LevelRenderer.Animation"}add(t){this._clips.push(t)}remove(t){var e=(new Mp).indexOf(this._clips,t);e>=0&&this._clips.splice(e,1)}_update(){var t=(new Date).getTime(),e=t-this._time,r=this._clips,s=r.length,i=[],n=[];for(let e=0;e<s;e++){var a=r[e],o=a.step(t);o&&(i.push(o),n.push(a))}this.stage.update&&this.stage.update();for(let t=0;t<s;)r[t]._needsRemove?(r[t]=r[s-1],r.pop(),s--):t++;s=i.length;for(let t=0;t<s;t++)n[t].fire(i[t]);this._time=t,this.onframe(e),this.dispatch("frame",e)}start(){var t=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},e=this;this._running=!0,this._time=(new Date).getTime(),t(function r(){e._running&&(e._update(),t(r))})}stop(){this._running=!1}clear(){this._clips=[]}animate(t,e){var r=new mf(t,(e=e||{}).loop,e.getter,e.setter);return r.animation=this,r}static _interpolateNumber(t,e,r){return(e-t)*r+t}static _interpolateArray(t,e,r,s,i){var n=t.length;if(1==i)for(let i=0;i<n;i++)s[i]=ff._interpolateNumber(t[i],e[i],r);else{var a=t[0].length;for(let i=0;i<n;i++)for(let n=0;n<a;n++)s[i][n]=ff._interpolateNumber(t[i][n],e[i][n],r)}}static _isArrayLike(t){switch(typeof t){case"undefined":case"string":return!1}return void 0!==t.length}static _catmullRomInterpolateArray(t,e,r,s,i,n,a,o,l){var h=t.length;if(1==l)for(let l=0;l<h;l++)o[l]=ff._catmullRomInterpolate(t[l],e[l],r[l],s[l],i,n,a);else{var u=t[0].length;for(let l=0;l<h;l++)for(var c=0;c<u;c++)o[l][c]=ff._catmullRomInterpolate(t[l][c],e[l][c],r[l][c],s[l][c],i,n,a)}}static _catmullRomInterpolate(t,e,r,s,i,n,a){var o=.5*(r-t),l=.5*(s-e);return(2*(e-r)+o+l)*a+(-3*(e-r)-2*o-l)*n+o*i+e}static _cloneValue(t){var e=Array.prototype.slice;if(ff._isArrayLike(t)){var r=t.length;if(ff._isArrayLike(t[0])){for(var s=[],i=0;i<r;i++)s.push(e.call(t[i]));return s}return e.call(t)}return t}static rgba2String(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}}class mf{constructor(t,e,r,s){this._tracks={},this._target=t,this._loop=e||!1,this._getter=r||function(t,e){return t[e]},this._setter=s||function(t,e,r){t[e]=r},this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[],this.CLASS_NAME="SuperMap.LevelRenderer.Animation.Animator"}when(t,e){for(var r in e)this._tracks[r]||(this._tracks[r]=[],0!==t&&this._tracks[r].push({time:0,value:ff._cloneValue(this._getter(this._target,r))})),this._tracks[r].push({time:parseInt(t,10),value:e[r]});return this}during(t){return this._onframeList.push(t),this}start(t){var e=this,r=this._setter,s=this._getter,i=e._onframeList.length,n="spline"===t,a=function(){if(e._clipCount--,0===e._clipCount){e._tracks={};for(var t=e._doneList.length,r=0;r<t;r++)e._doneList[r].call(e)}},o=function(o,l){var h=o.length;if(h){var u=o[0].value,c=ff._isArrayLike(u),d=!1,p=c&&ff._isArrayLike(u[0])?2:1;o.sort(function(t,e){return t.time-e.time});var f=o[h-1].time,m=[],y=[];for(let t=0;t<h;t++){m.push(o[t].time/f);var g=o[t].value;"string"==typeof g&&(0===(g=Vp.Util_color.toArray(g)).length&&(g[0]=g[1]=g[2]=0,g[3]=1),d=!0),y.push(g)}var v,b,S,_,x,w,A,M=0,C=0;if(d)var E=[0,0,0,0];var T=new pf({target:e._target,life:f,loop:e._loop,delay:e._delay,onframe:function(t,a){if(a<C){for(v=Math.min(M+1,h-1),b=v;b>=0&&!(m[b]<=a);b--);b=Math.min(b,h-2)}else{for(b=M;b<h&&!(m[b]>a);b++);b=Math.min(b-1,h-2)}M=b,C=a;var o=m[b+1]-m[b];if(0!==o){if(S=(a-m[b])/o,n)if(x=y[b],_=y[0===b?b:b-1],w=y[b>h-2?h-1:b+1],A=y[b>h-3?h-1:b+2],c)ff._catmullRomInterpolateArray(_,x,w,A,S,S*S,S*S*S,s(t,l),p);else{let e;e=d?ff.rgba2String(E):ff._catmullRomInterpolate(_,x,w,A,S,S*S,S*S*S),r(t,l,e)}else if(c)ff._interpolateArray(y[b],y[b+1],S,s(t,l),p);else{let e;d?(ff._interpolateArray(y[b],y[b+1],S,E,1),e=ff.rgba2String(E)):e=ff._interpolateNumber(y[b],y[b+1],S),r(t,l,e)}for(b=0;b<i;b++)e._onframeList[b](t,a)}},ondestroy:a});t&&"spline"!==t&&(T.easing=t),e._clipList.push(T),e._clipCount++,e.animation.add(T)}};for(var l in this._tracks)o(this._tracks[l],l);return this}stop(){for(var t=0;t<this._clipList.length;t++){var e=this._clipList[t];this.animation.remove(e)}this._clipList=[]}delay(t){return this._delay=t,this}done(t){return t&&this._doneList.push(t),this}}class yf{constructor(t,e){this.id=t,this.storage=new lf,this.painter=new hf(e,this.storage),this.handler=new cf(e,this.storage,this.painter),this.animatingElements=[],this.animation=new ff({stage:{update:yf.getFrameCallback(this)}}),this._needsRefreshNextFrame=!1,this.animation.start(),this.CLASS_NAME="SuperMap.LevelRenderer.Render"}destroy(){this.id=null,this.storage=null,this.painter=null,this.handler=null,this.animatingElements=null,this.animation=null,this._needsRefreshNextFrame=null}getId(){return this.id}addShape(t){return this.storage.addRoot(t),this}addGroup(t){return this.storage.addRoot(t),this}delShape(t){return this.storage.delRoot(t),this}delGroup(t){return this.storage.delRoot(t),this}modShape(t,e){return this.storage.mod(t,e),this}modGroup(t,e){return this.storage.mod(t,e),this}modLayer(t,e){return this.painter.modLayer(t,e),this}addHoverShape(t){return this.storage.addHover(t),this}render(t){return this.painter.render(t),this._needsRefreshNextFrame=!1,this}refresh(t){return this.painter.refresh(t),this._needsRefreshNextFrame=!1,this}refreshNextFrame(){return this._needsRefreshNextFrame=!0,this}refreshHover(t){return this.painter.refreshHover(t),this}refreshShapes(t,e){return this.painter.refreshShapes(t,e),this}resize(){return this.painter.resize(),this}animate(t,e,r){if("string"==typeof t&&(t=this.storage.get(t)),t){var s;if(e){for(var i=e.split("."),n=t,a=0,o=i.length;a<o;a++)n&&(n=n[i[a]]);n&&(s=n)}else s=t;if(!s)return void Vp.Util_log('Property "'+e+'" is not existed in element '+t.id);var l=this.animatingElements;return void 0===t.__aniCount&&(t.__aniCount=0),0===t.__aniCount&&l.push(t),t.__aniCount++,this.animation.animate(s,{loop:r}).done(function(){if(t.__aniCount--,0===t.__aniCount){var e=(new Mp).indexOf(l,t);l.splice(e,1)}})}Vp.Util_log("Element not existed")}clearAnimation(){this.animation.clear()}getWidth(){return this.painter.getWidth()}getHeight(){return this.painter.getHeight()}toDataURL(t,e,r){return this.painter.toDataURL(t,e,r)}shapeToImage(t,e,r){var s=v.createUniqueID("SuperMap.LevelRenderer.ToImage_");return this.painter.shapeToImage(s,t,e,r)}on(t,e){return this.handler.on(t,e),this}un(t,e){return this.handler.un(t,e),this}trigger(t,e){return this.handler.trigger(t,e),this.handler.dispatch(t,e),this}clear(){return this.storage.delRoot(),this.painter.clear(),this}dispose(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=null,this.animatingElements=null,this.storage=null,this.painter=null,this.handler=null}updateHoverShapes(t){return this.painter.updateHoverLayer(t),this}getAllShapes(){return this.storage._shapeList}clearAll(){return this.clear(),this.painter.clearHover(),this}getHoverOne(){return this.handler.getLastHoverOne()}static getFrameCallback(t){return function(){var e=t.animatingElements;if(e instanceof Array){for(var r=0,s=e.length;r<s;r++)t.storage.mod(e[r].id);(e.length||t._needsRefreshNextFrame)&&t.refresh()}}}}class gf{constructor(){gf._instances={},gf.Tool={},this.version="2.0.4",this.CLASS_NAME="SuperMap.LevelRenderer"}destroy(){this.dispose(),this.version=null}init(t){var e=new yf(v.createUniqueID("LRenderer_"),t);return gf._instances[e.id]=e,e}dispose(t){if(t)t.dispose(),this.delInstance(t.id);else{for(var e in gf._instances)gf._instances[e].dispose();gf._instances={}}return this}getInstance(t){return gf._instances[t]}delInstance(t){return delete gf._instances[t],this}}const vf="EXCEL",bf="CSV",Sf="GEOJSON",_f="JSON";class xf{constructor(){this._initView()}_initView(){const t=document.createElement("div");t.hidden=!0,t.setAttribute("class","component-messageboxcontainer component-border-bottom-orange");const e=document.createElement("div");e.setAttribute("class","icon"),this.icon=document.createElement("span"),this.icon.setAttribute("class","supermapol-icons-message-warning"),e.appendChild(this.icon),t.appendChild(e);const r=document.createElement("div");r.setAttribute("class","component-messagebox"),r.innerHTML="",t.appendChild(r),this.messageBox=r;const s=document.createElement("div");s.setAttribute("class","component-messagebox__cancelbtncontainer");const i=document.createElement("button");i.setAttribute("class","component-messagebox__cancelBtn"),i.innerHTML="x",i.onclick=this.closeView.bind(this),s.appendChild(i),t.appendChild(s),this.messageBoxContainer=t,document.body.appendChild(this.messageBoxContainer)}closeView(){this.messageBoxContainer.hidden=!0}showView(t,e="warring"){"success"===e?(this.icon.setAttribute("class","supermapol-icons-message-success"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-green")):"failure"===e?(this.icon.setAttribute("class","supermapol-icons-message-failure"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-red")):"warring"===e&&(this.icon.setAttribute("class","supermapol-icons-message-warning"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-orange")),this.messageBox.innerHTML=t,this.messageBoxContainer.hidden=!1}}const wf=function(){try{return echarts}catch(t){return{}}}();let Af={"en-US":{title_dataFlowService:"Data Flow Service",title_distributedAnalysis:"Distributed Analysis",title_clientComputing:"Client Computing",title_dataServiceQuery:"Data Service Query",title_searchCity:"Search city",title_searchLayer:" Search layer",text_input_value_inputDataFlowUrl:"Please enter the data stream service address such as: ws://{serviceRoot}/{dataFlowName}/dataflow/subscribe",text_displayFeaturesInfo:"Display feature information",text_subscribe:"subscribe",text_cancelSubscribe:"unsubscribe",text_densityAnalysis:"Density Analysis",text_CalculateTheValuePerUnitArea:"Calculate the value per unit area within the neighborhood shape",text_option_selectDataset:"Please select a dataset",text_label_dataset:"Dataset",text_option_simplePointDensityAnalysis:"Simple point density analysis",text_option_nuclearDensityAnalysis:"Nuclear density analysis",text_label_analyticalMethod:"Analytical method",text_option_quadrilateral:"Quadrilateral",text_option_hexagon:"hexagon",text_label_meshType:"Mesh type",text_option_notSet:"Not set",text_label_weightField:"Weight field",text_label_gridSizeInMeters:"Grid size",text_label_searchRadius:"Search radius",text_label_queryRange:"Scope of analysis",text_label_areaUnit:"Area unit",text_option_equidistantSegmentation:"Equidistant segmentation",text_option_logarithm:"Logarithm",text_option_equalCountingSegment:"Equal counting segment",text_option_squareRootSegmentation:"Square root segmentation",text_label_thematicMapSegmentationMode:"Thematic map segmentation mode",text_label_thematicMapSegmentationParameters:"Thematic map segmentation parameters",text_option_greenOrangePurpleGradient:"Green orange purple gradient",text_option_greenOrangeRedGradient:"Green orange red gradient",text_option_rainbowGradient:"Rainbow gradient",text_option_spectralGradient:"Spectral gradient",text_option_terrainGradient:"Terrain gradient",text_label_thematicMapColorGradientMode:"Thematic map color gradient mode",text_label_resultLayerName:"Result layer name",text_chooseFile:"Open File",text_isoline:"Isoline",text_extractDiscreteValue:"Extract discrete value generation curve",text_buffer:"Buffer",text_specifyTheDistance:"Specify the distance to create the surrounding area",text_label_analysisLayer:"Analysis layer",text_label_extractField:"Extract field",text_label_extractedValue:"Extracted value",text_label_distanceAttenuation:"Distance attenuation",text_label_gridSize:"gridSize",text_label_bufferRadius:"Buffer radius",text_label_defaultkilometers:"Default 10 kilometers",text_label_kilometer:"kilometer",text_label_unit:"unit",text_retainOriginal:"Retain original object field",text_mergeBuffer:"Merge buffer",text_label_color:"Color",text_label_buffer:"[Buffer]",text_label_isolines:"[Isolines]",text_label_queryRangeTips:"The default is the full range of input data. Example: -74.050, 40.650, -73.850, 40.850",text_label_queryModel:"Query mode",text_label_IDArrayOfFeatures:"ID array of features",text_label_maxFeatures:"The maximum number of features that can be returned",text_label_bufferDistance:"Buffer distance",text_label_queryRange1:"Query range",text_label_spatialQueryMode:"Spatial query mode",text_label_featureFilter:"Feature filter",text_label_geometricObject:"Geometric object",text_label_queryMode:"Query mode",text_label_searchTips:"Search for city locations or layer features",text_label_chooseSearchLayers:"Select a query layer",text_loadSearchCriteria:"Load search criteria",text_saveSearchCriteria:"Save search criteria",btn_analyze:"Analyze",btn_analyzing:"Analyzing",btn_emptyTheAnalysisLayer:"Empty the analysis layer",btn_cancelAnalysis:"Cancel",btn_query:"Query",btn_querying:"Querying",btn_emptyTheRresultLayer:"Clear all result layers","msg_dataReturnedIsEmpty.":"The request is successful and the data returned by the query is empty.",msg_dataFlowServiceHasBeenSubscribed:"The data stream service has been subscribed to.",msg_inputDataFlowUrlFirst:"Please enter the data stream service address first.",msg_datasetOrMethodUnsupport:"This dataset does not support this analysis type. Please reselect the dataset.",msg_selectDataset:"Please select a data set!",msg_setTheWeightField:"Please set the weight field!",msg_theFieldNotSupportAnalysis:"The field you currently select does not support analysis!",msg_resultIsEmpty:"The result of the analysis is empty!",msg_openFileFail:"Failed to open file!",msg_fileTypeUnsupported:"File format is not supported!",msg_fileSizeExceeded:"File size exceeded! The file size should not exceed 10M!",msg_dataInWrongGeoJSONFormat:"Wrong data format! Non standard GEOJSON format data!",msg_dataInWrongFormat:"Wrong data format! Non standard EXCEL, CSV or GEOJSON format data!",msg_searchKeywords:"Search keywords cannot be empty. Please enter your search criteria.",msg_searchGeocodeField:"Did not match the address matching service data!",msg_cityGeocodeField:"The address matching service of the current city is not configured.",msg_getFeatureField:"No related vector features found!",msg_dataflowservicesubscribed:"The data stream service has been subscribed to.",msg_subscribesucceeded:"The data stream service subscription was successful.",msg_crsunsupport:"Does not support the coordinate system of the current map",msg_tilematrixsetunsupport:"Incoming TileMatrixSet is not supported",msg_jsonResolveFiled:"JSON format parsing failureï¼",msg_requestContentFiled:"Failed to request data through iportal!",msg_getdatafailed:"Failed to get data!"},"zh-CN":{title_dataFlowService:"æ°æ®æµæå¡",title_distributedAnalysis:"åå¸å¼åæ",title_clientComputing:"å®¢æ·ç«¯è®¡ç®",title_dataServiceQuery:"æ°æ®æå¡æ¥è¯¢",title_searchCity:"æç´¢åå¸",title_searchLayer:"æç´¢å¾å±",text_input_value_inputDataFlowUrl:"è¯·è¾å¥æ°æ®æµæå¡å°åå¦:ws://{serviceRoot}/{dataFlowName}/dataflow/subscribe",text_displayFeaturesInfo:"æ¾ç¤ºè¦ç´ ä¿¡æ¯",text_subscribe:"è®¢é",text_cancelSubscribe:"åæ¶è®¢é",text_densityAnalysis:"å¯åº¦åæ",text_CalculateTheValuePerUnitArea:"è®¡ç®ç¹æå®é»åå½¢ç¶åçæ¯åä½é¢ç§¯éå¼",text_option_selectDataset:"è¯·éæ©æ°æ®é",text_label_dataset:"æ°æ®é",text_option_simplePointDensityAnalysis:"ç®åç¹å¯åº¦åæ",text_option_nuclearDensityAnalysis:"æ ¸å¯åº¦åæ",text_label_analyticalMethod:"åææ¹æ³",text_option_quadrilateral:"åè¾¹å½¢",text_option_hexagon:"å­è¾¹å½¢",text_label_meshType:"ç½æ ¼é¢ç±»å",text_option_notSet:"æªè®¾ç½®",text_label_weightField:"æéå­æ®µ",text_label_gridSizeInMeters:"ç½æ ¼å¤§å°",text_label_searchRadius:"æç´¢åå¾",text_label_queryRange:"åæèå´",text_label_areaUnit:"é¢ç§¯åä½",text_option_equidistantSegmentation:"ç­è·ç¦»åæ®µ",text_option_logarithm:"å¯¹æ°",text_option_equalCountingSegment:"ç­è®¡æ°åæ®µ",text_option_squareRootSegmentation:"å¹³æ¹æ ¹åæ®µ",text_label_thematicMapSegmentationMode:"ä¸é¢å¾åæ®µæ¨¡å¼",text_label_thematicMapSegmentationParameters:"ä¸é¢å¾åæ®µåæ°",text_option_greenOrangePurpleGradient:"ç»¿æ©ç´«æ¸å",text_option_greenOrangeRedGradient:"ç»¿æ©çº¢æ¸å",text_option_rainbowGradient:"å½©è¹æ¸å",text_option_spectralGradient:"åè°±æ¸å",text_option_terrainGradient:"å°å½¢æ¸å",text_label_thematicMapColorGradientMode:"ä¸é¢å¾é¢è²æ¸åæ¨¡å¼",text_label_resultLayerName:"ç»æå¾å±åç§°",text_chooseFile:"éæ©æä»¶",text_isoline:"ç­å¼çº¿",text_extractDiscreteValue:"æåç¦»æ£å¼çææ²çº¿",text_buffer:"ç¼å²åº",text_specifyTheDistance:"æå®è·ç¦»åå»ºå¨è¾¹åºå",text_label_analysisLayer:"åæå¾å±",text_label_extractField:"æåå­æ®µ",text_label_extractedValue:"æåå¼",text_label_distanceAttenuation:"è·ç¦»è¡°å",text_label_gridSize:"æ æ ¼å¤§å°",text_label_bufferRadius:"ç¼å²åå¾",text_label_defaultkilometers:"é»è®¤10åç±³",text_option_kilometer:"åç±³",text_label_unit:"åä½",text_retainOriginal:"ä¿çåå¯¹è±¡å­æ®µå±æ§",text_mergeBuffer:"åå¹¶ç¼å²åº",text_label_color:"é¢è²",text_label_buffer:"[ç¼å²åº]",text_label_isolines:"[ç­å¼çº¿]",text_label_queryRangeTips:"é»è®¤ä¸ºè¾å¥æ°æ®çå¨å¹èå´ãèä¾ï¼-74.050,40.650,-73.850,40.850",text_label_IDArrayOfFeatures:"è¦ç´  ID æ°ç»",text_label_maxFeatures:"æå¤å¯è¿åçè¦ç´ æ°é",text_label_bufferDistance:"ç¼å²åºè·ç¦»",text_label_queryRange1:"æ¥è¯¢èå´",text_label_spatialQueryMode:"ç©ºé´æ¥è¯¢æ¨¡å¼",text_label_featureFilter:"è¦ç´ è¿æ»¤å¨",text_label_geometricObject:"å ä½å¯¹è±¡",text_label_queryMode:"æ¥è¯¢æ¨¡å¼",text_label_searchTips:"æç´¢åå¸å°ç¹æå¾å±è¦ç´ ",text_label_chooseSearchLayers:"éæ©æ¥è¯¢å¾å±",text_loadSearchCriteria:"å è½½æç´¢æ¡ä»¶",text_saveSearchCriteria:"ä¿å­æç´¢æ¡ä»¶",btn_analyze:"åæ",btn_analyzing:"åæä¸­",btn_emptyTheAnalysisLayer:"æ¸ç©ºåæå¾å±",btn_cancelAnalysis:"åæ¶",btn_query:"æ¥è¯¢",btn_querying:"æ¥è¯¢ä¸­",btn_emptyTheRresultLayer:"æ¸é¤ææç»æå¾å±",msg_dataFlowServiceHasBeenSubscribed:"å·²è®¢éè¯¥æ°æ®æµæå¡ã",msg_inputDataFlowUrlFirst:"è¯·åè¾å¥æ°æ®æµæå¡å°åã",msg_datasetOrMethodUnsupport:"è¯¥æ°æ®éä¸æ¯ææ¬åæç±»åï¼è¯·éæ°éæ©æ°æ®é",msg_selectDataset:"è¯·éæ©æ°æ®éï¼",msg_setTheWeightField:"è¯·è®¾ç½®æéå­æ®µï¼",msg_theFieldNotSupportAnalysis:"æ¨å½åéæ©çå­æ®µä¸æ¯æåæï¼",msg_resultIsEmpty:"åæçç»æä¸ºç©ºï¼",msg_dataReturnedIsEmpty:"è¯·æ±æåï¼æ¥è¯¢è¿åçæ°æ®ä¸ºç©ºã",msg_openFileFail:"æå¼æä»¶å¤±è´¥ï¼",msg_fileTypeUnsupported:"ä¸æ¯æè¯¥æä»¶æ ¼å¼ï¼",msg_fileSizeExceeded:"æä»¶å¤§å°è¶éï¼æä»¶å¤§å°ä¸å¾è¶è¿ 10Mï¼",msg_dataInWrongGeoJSONFormat:"æ°æ®æ ¼å¼éè¯¯ï¼éæ åç GEOJSON æ ¼å¼æ°æ®ï¼",msg_dataInWrongFormat:"æ°æ®æ ¼å¼éè¯¯ï¼éæ åç EXCEL, CSV æ GEOJSON æ ¼å¼æ°æ®ï¼",msg_searchKeywords:"æç´¢å³é®å­ä¸è½ä¸ºç©ºï¼è¯·è¾å¥æç´¢æ¡ä»¶ã",msg_searchGeocodeField:"æªå¹éå°å°åå¹éæå¡æ°æ®ï¼",msg_cityGeocodeField:"æªéç½®å½ååå¸çå°åå¹éæå¡ã",msg_getFeatureField:"æªæ¥æ¾å°ç¸å³ç¢éè¦ç´ ï¼",msg_dataflowservicesubscribed:"å·²è®¢éè¯¥æ°æ®æµæå¡ã",msg_subscribesucceeded:"æ°æ®æµæå¡è®¢éæåã",msg_crsunsupport:"ä¸æ¯æå½åå°å¾çåæ ç³»",msg_tilematrixsetunsupport:"ä¸æ¯æä¼ å¥çTileMatrixSet",msg_jsonResolveFiled:"jsonæ ¼å¼è§£æå¤±è´¥ï¼",msg_requestContentFiled:"éè¿iportalè¯·æ±æ°æ®å¤±è´¥ï¼",msg_getdatafailed:"è·åæ°æ®å¤±è´¥ï¼"},code:null,defaultCode:"en-US",getCode:function(){return Af.code||Af.setCode(),Af.code},setCode:function(){var t=this.getLanguageFromCookie();t||(t=Af.defaultCode,t="Netscape"===navigator.appName?navigator.language:navigator.browserLanguage),0===t.indexOf("zh")&&(t="zh-CN"),0===t.indexOf("en")&&(t="en-US"),Af.code=t},getLanguageFromCookie(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){for(var r=t[e];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf("language="))return r.substring("language=".length,r.length)}return""},i18n:function(t){var e=Af[Af.getCode()],r=e&&e[t];return r||(r=t),r}};const Mf=function(){try{return XLSX}catch(t){return{}}}();let Cf={rABS:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsBinaryString,rABF:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsArrayBuffer,rAT:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsText,readFile(t,e,r,s,i){_f===t||Sf===t?this.readTextFile(e,r,s,i):vf!==t&&bf!==t||this.readXLSXFile(e,r,s,i)},readTextFile(t,e,r,s){let i=new FileReader;i.onloadend=function(t){e&&e.call(s,t.target.result)},i.onerror=function(t){r&&r.call(s,t)},this.rAT?i.readAsText(t.file,"utf-8"):i.readAsBinaryString(t.file)},readXLSXFile(t,e,r,s){let i=new FileReader;i.onloadend=function(t){let i=new Uint8Array(t.target.result),n=Mf.read(i,{type:"array"});try{if(n&&n.SheetNames&&n.SheetNames.length>0){let t=n.SheetNames[0],r=Mf.utils.sheet_to_csv(n.Sheets[t]);e&&e.call(s,r)}}catch(t){r&&r.call(s,t)}},i.onerror=function(t){r&&r.call(s,t)},this.rABF&&i.readAsArrayBuffer(t.file)},processDataToGeoJson(t,e,r,s,i){let n=null;if("EXCEL"===t||"CSV"===t)n=this.processExcelDataToGeoJson(e),r&&r.call(i,n);else if("JSON"===t||"GEOJSON"===t){let t=e;"string"==typeof t&&(t=JSON.parse(t)),"ISERVER"===t.type?n=t.data.recordsets[0].features:"FeatureCollection"===t.type?n=t:s&&s.call(i,Af.i18n("msg_dataInWrongGeoJSONFormat")),r&&r.call(i,n)}else s&&s.call(i,Af.i18n("msg_dataInWrongFormat"))},processExcelDataToGeoJson(t){let e=this.string2Csv(t),r=e.colTitles,s=-1,i=-1;for(let t=0,e=r.length;t<e;t++)this.isXField(r[t])&&(s=t),this.isYField(r[t])&&(i=t);let n=[];for(let t=0,r=e.rows.length;t<r;t++){let r=e.rows[t],a=Number(r[s]),o=Number(r[i]),l={};for(let r in e.colTitles){l[e.colTitles[r]]=e.rows[t][r]}let h={type:"Feature",geometry:{type:"Point",coordinates:[a,o]},properties:l};n.push(h)}return n},isXField(t){var e=t.toLowerCase();return"x"===e||"smx"===e||"jd"===e||"ç»åº¦"===e||"ä¸ç»"===e||"longitude"===e||"lot"===e||"lon"===e||"lng"===e||"xåæ "===e},isYField(t){var e=t.toLowerCase();return"y"===e||"smy"===e||"wd"===e||"çº¬åº¦"===e||"åçº¬"===e||"latitude"===e||"lat"===e||"yåæ "===e},string2Csv(t,e){let r=t.split("\n"),s={};s.colTitles=e?[]:r[0].split(","),s.rows=[];for(let t=e?0:1;t<r.length;t++)r[t]&&s.rows.push(r[t].split(","));return s}};class Ef{constructor(t){this.datasets=t,this.EVENT_TYPES=["getdatafailed"],this.events=new qt(this,null,this.EVENT_TYPES)}getDatasetInfo(t){let e=this.datasets.url,r=this;Jt.get(e).then(function(t){return t.json()}).then(function(e){if(e.datasetInfo){let s=e.datasetInfo;r.datasetsInfo={dataSourceName:s.dataSourceName,datasetName:s.name,mapName:e.name},t({result:r.datasetsInfo})}}).catch(function(t){console.log(t),r._fireFailedEvent(t)})}getDataFeatures(t,e){let r,s,i,n=t.result,a={name:n.datasetName+"@"+n.dataSourceName};Object.assign(a,this.datasets.queryInfo),r=new de(a),s=new ye({queryParameter:r,datasetNames:[n.dataSourceName+":"+n.datasetName],fromIndex:0,toIndex:1e5}),(i=new ge(n.dataUrl)).processAsync(s,e)}getLayerFeatures(t,e){let r,s,i,n=t.result,a={name:n.mapName};Object.assign(a,this.datasets.queryInfo),r=new de(a),s=new Bs({queryParams:[r],expectCount:1e5}),(i=new Gs(n.dataUrl)).processAsync(s,e)}getDataInfoByIptl(t){this.getServiceInfo(this.datasets.url,t)}getServiceInfo(t,e){let r=this;Jt.get(t,null,{withCredentials:this.datasets.withCredentials}).then(t=>t.json()).then(s=>{if(!1!==s.succeed)if(s.dataItemServices&&s.dataItemServices.length>0){let i;s.dataItemServices.forEach(s=>{if("RESTDATA"===s.serviceType&&"PUBLISHED"===s.serviceStatus)i=s;else{if("RESTMAP"!==s.serviceType||"PUBLISHED"!==s.serviceStatus)return void r.getDatafromContent(t,e);i=s}}),i&&r.getDatafromRest(i.serviceType,i.address,e)}else r.getDatafromContent(t,e);else r._fireFailedEvent(s)}).catch(t=>{console.log(t),r._fireFailedEvent(t)})}getDatafromContent(t,e){let r={result:{}},s=this;t+="/content.json?pageSize=9999999&currentPage=1",Jt.get(t,null,{withCredentials:this.datasets.withCredentials}).then(t=>t.json()).then(t=>{if(!1!==t.succeed){if(t.type){if("JSON"===t.type||"GEOJSON"===t.type){if(t.content=JSON.parse(t.content.trim()),!t.content.features)return void console.log(Af.i18n("msg_jsonResolveFiled"));let e=this._formatGeoJSON(t.content);r.result.features={type:t.content.type,features:e}}else if("EXCEL"===t.type||"CSV"===t.type){let e=this._excelData2Feature(t.content);r.result.features={type:"FeatureCollection",features:e}}e(r,"content")}}else s._fireFailedEvent(t)},this).catch(t=>{console.log(t),s._fireFailedEvent(t)})}getDatafromRest(t,e,r){let s=this,i=this.datasets.withCredentials;if("RESTDATA"===t){let t,n,a=`${e}/data/datasources`;Jt.get(a,null,{withCredentials:i}).then(t=>t.json()).then(o=>{t=o.datasourceNames[0],a=`${e}/data/datasources/${t}/datasets`,Jt.get(a,null,{withCredentials:i}).then(t=>t.json()).then(i=>(n=i.datasetNames[0],s.getDatafromRestData(`${e}/data`,[t+":"+n],r),[t+":"+n])).catch(function(t){s._fireFailedEvent(t)})}).catch(function(t){s._fireFailedEvent(t)})}else{let t,n,a,o=`${e}/maps`;Jt.get(o,null,{withCredentials:i}).then(t=>t.json()).then(l=>{t=l[0].name,a=l[0].path,o=o=`${e}/maps/${t}/layers`,Jt.get(o,null,{withCredentials:i}).then(t=>t.json()).then(t=>(n=t[0].subLayers.layers[0].caption,s.getDatafromRestMap(n,a,r),n)).catch(function(t){s._fireFailedEvent(t)})}).catch(function(t){s._fireFailedEvent(t)})}}getDatafromRestData(t,e,r){let s=this;this.datasets.queryInfo.attributeFilter=this.datasets.queryInfo.attributeFilter||"SmID>0",this._getFeatureBySQL(t,e,this.datasets.queryInfo,t=>{r(t,"RESTDATA")},t=>{console.log(t),s._fireFailedEvent(t)})}getDatafromRestMap(t,e,r){let s=this;this.datasets.queryInfo.attributeFilter=this.datasets.queryInfo.attributeFilter||"smid=1",this._queryFeatureBySQL(e,t,this.datasets.queryInfo,null,null,t=>{r(t,"RESTMAP")},t=>{console.log(t),s._fireFailedEvent(t)})}_getFeatureBySQL(t,e,r,s,i){let n,a,o,l={name:e.join().replace(":","@")};Object.assign(l,r),n=new de(l),o=new ye({queryParameter:n,datasetNames:e,fromIndex:0,toIndex:1e5,returnContent:!0}),(a=new ge(t)).processAsync(o,function(t){"processCompleted"===t.type?s&&s(t):i&&i(t)})}_queryFeatureBySQL(t,e,r,s,i,n,a,o,l,h){var u,c,d={name:e};Object.assign(d,r),u=new de(d),s&&(u.fields=s);var p={queryParams:[u]};h&&(p.queryOption=q.ATTRIBUTE),o&&(p.startRecord=o),l&&(p.expectCount=l),i&&(p.prjCoordSys={epsgCode:i}),c=new Bs(p),this._queryBySQL(t,c,t=>{"processCompleted"===t.type?n(t):a(t)})}_queryBySQL(t,e,r,s){new Gs(t,{format:this._processFormat(s)}).processAsync(e,r)}_processFormat(t){return t||U.GEOJSON}_formatGeoJSON(t){let e=t.features;return e.forEach((t,e)=>{t.properties.index=e}),e}_excelData2Feature(t){let e=t.colTitles,r=-1,s=-1;for(let t=0,i=e.length;t<i;t++)Cf.isXField(e[t])&&(r=t),Cf.isYField(e[t])&&(s=t);let i=[];for(let e=0,n=t.rows.length;e<n;e++){let n=t.rows[e],a=Number(n[r]),o=Number(n[s]),l={};for(let r in t.colTitles){l[t.colTitles[r]]=t.rows[e][r]}l.index=e+"";let h={type:"Feature",geometry:{type:"Point",coordinates:[a,o]},properties:l};i.push(h)}return i}_fireFailedEvent(t){let e=t?{error:t,message:Af.i18n("msg_getdatafailed")}:{message:Af.i18n("msg_getdatafailed")};this.events.triggerEvent("getdatafailed",e)}}class Tf{constructor(t){this.datasets=t.datasets,this.xField=[],this.yField=[],this.grid={top:"50px",bottom:"50px",left:"50px",right:"60px"},this.chartType=t.type||"bar",this._initXYField(t.chartOptions),this.EVENT_TYPES=["getdatafailed"],this.events=new qt(this,null,this.EVENT_TYPES)}_initXYField(t){let e=this;t&&t.length>0&&t.forEach(function(t){t.xAxis&&e.xField.push({field:t.xAxis.field,name:t.xAxis.name}),t.yAxis&&e.yField.push({field:t.yAxis.field,name:t.yAxis.name})})}getDatasetInfo(t){this.createChart=t,this.datasets&&this._checkUrl(this.datasets.url)&&(this.chartModel=new Ef(this.datasets),"iServer"===this.datasets.type?this.chartModel.getDatasetInfo(this._getDatasetInfoSuccess.bind(this)):"iPortal"===this.datasets.type&&this.chartModel.getDataInfoByIptl(this._getDataInfoSuccess.bind(this)),this.chartModel.events.on({getdatafailed:t=>{this.events.triggerEvent("getdatafailed",t)}}))}_getDatasetInfoSuccess(t){let e=this.datasets.url,r=e.indexOf("rest");if(r>0){let s=e.indexOf("/",r+5),i=e.substring(r+5,s),n=e.substring(0,r+4)+"/data";if("maps"===i){let i=e.indexOf("/",s+1),a=e.substring(s+1,i);n=e.substring(0,r+4)+"/maps/"+a,t.result.dataUrl=n,this._getLayerFeatures(t)}else"data"===i&&(t.result.dataUrl=n,this._getDataFeatures(t))}}_getDataInfoSuccess(t,e){let r=this;"RESTMAP"===e?r._getChartDatasFromLayer(t):r._getChartDatas(t)}_getDataFeatures(t){this.chartModel.getDataFeatures(t,this._getChartDatas.bind(this))}_getLayerFeatures(t){this.chartModel.getLayerFeatures(t,this._getChartDatasFromLayer.bind(this))}_getChartDatas(t){if(t){this.features=t.result.features;let e=this.features.features,r={};if(e.length){let t=e[0],s=[],i=[];for(let e in t.properties)s.push(e),i.push(this._getDataType(t.properties[e]));r={features:e,fieldCaptions:s,fieldTypes:i,fieldValues:[]};for(let t in i){let s=[];for(let i in e){let n=e[i],a=r.fieldCaptions[t],o=n.properties[a];s.push(o)}r.fieldValues.push(s)}this.createChart(r)}}}_getChartDatasFromLayer(t){if(t.result.recordsets){let e=t.result.recordsets[0],r=e.features.features;this.features=e.features;let s={};if(r.length){s={features:e.features,fieldCaptions:e.fieldCaptions,fieldTypes:e.fieldTypes,fieldValues:[]};for(let t in s.fieldCaptions){let e=[];for(let i in r){let n=r[i],a=s.fieldCaptions[t],o=n.properties[a];e.push(o)}s.fieldValues.push(e)}this.createChart(s)}}}_createChartOptions(t){return this.calculatedData=this._createChartDatas(t),this.updateChartOptions(this.chartType)}changeType(t){if(t!==this.chartType)return this.chartType=t,this.updateChartOptions(this.chartType)}updateData(t,e,r){this.updateChart=r,this.xField=[],this.yField=[],this._initXYField(e),t.type=t.type||"iServer",t.withCredentials=t.withCredentials||!1,this.datasets=t,this.getDatasetInfo(this._updateDataSuccess.bind(this))}_updateDataSuccess(t){let e=this._createChartOptions(t);this.updateChart(e)}updateChartOptions(t,e){if(this.calculatedData){let r=this.grid,s=this._createChartSeries(this.calculatedData,t),i=[];for(let t in this.calculatedData.XData)i.push({value:this.calculatedData.XData[t].fieldsData});let n={type:"category",name:this.xField[0].name||"X",data:i,nameTextStyle:{color:"#fff",fontSize:14},splitLine:{show:!1},axisLine:{lineStyle:{color:"#eee"}}},a={type:"value",name:this.yFieldName||"Y",data:{},nameTextStyle:{color:"#fff",fontSize:14},splitLine:{show:!1},axisLine:{lineStyle:{color:"#eee"}}},o={formatter:"{b0}: {c0}"},l="#404a59";return e&&(e.grid&&(r=e.grid),e.tooltip&&(o=e.tooltip),e.backgroundColor&&(l=e.backgroundColor)),{backgroundColor:l,grid:r,series:s,xAxis:n,yAxis:a,tooltip:o}}}_createChartDatas(t){let e=0,r=[],s=t.fieldCaptions,i=this;s.forEach(function(t,r){i.xField[0]&&t===i.xField[0].field&&(e=r)}),this.yFieldName="",this.yField.forEach(function(t,e){0!==e&&(i.yFieldName=i.yFieldName+","),i.yFieldName=i.yFieldName+t.name,s.forEach(function(e,s){e===t.field&&r.push(s)})});let n=this._getAttrData(t,e),a=[];if(r.length>0)r.forEach(function(e){let r=[];for(let s in t.fieldValues[e])r.push({value:t.fieldValues[e][s]});a.push(r)});else{let t=[],e=[],r=n.length;for(let s=0;s<r;s++){let r=!1;for(let i=0,a=e.length;i<a;i++)if(n[s].fieldsData===e[i].fieldsData){t[i].value++,e[i].recordIndexs.push(s),r=!0;break}r||n[s].fieldsData&&(e.push({fieldsData:n[s].fieldsData,recordIndexs:[s]}),t.push({value:1}))}n=e,a=[t]}return{XData:n,YData:a}}_getAttrData(t,e){0===e&&(this.xField=[{field:t.fieldCaptions[e],name:t.fieldCaptions[e]}]);let r=[];for(let s=0,i=t.fieldValues[e].length;s<i;s++){let i=t.fieldValues[e][s];r.push({recordIndexs:s,fieldsData:i})}return r}_createChartSeries(t,e){let r=[];return t.YData.forEach(function(t){let s=0,i=[];for(let e of t)s=e.value,i.push({value:s});let n={type:e,data:i,name:"y"};r.push(n)}),r}_isDate(t){return/((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))/gi.test(t)}_isNumber(t){let e=Number(t);return 0===e||!isNaN(e)}_getDataType(t){if(null!==t&&void 0!==t&&""!==t){if(this._isDate(t))return"DATE";if(this._isNumber(t))return"NUMBER"}return"STRING"}_checkUrl(t){let e;return e=!(""===t||!this._isMatchUrl(t))&&(!/^http[s]?:\/\/localhost/.test(t)&&!/^http[s]?:\/\/127.0.0.1/.test(t))}_isMatchUrl(t){return new RegExp("(https?|http|file|ftp)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]").test(t)}getStyle(){return{grid:this.grid,tooltip:this.tooltip,backgroundColor:this.backgroundColor}}getFeatures(){return this.features}setStyle(t){return this.updateChartOptions(this.chartType,t)}}class Of{constructor(t){t=t||{},this.id=t.id?t.id:null,this.rootContainer=null}getElement(){return this.id&&(this.rootContainer.id=this.id),this.rootContainer}_initView(){}showView(){this.rootContainer.hidden=!1}closeView(){this.rootContainer.hidden=!0}}class Pf extends Of{constructor(t){super(t=t||{}),t.title=t.title?t.title:"",this._initView(t.title)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-popcontainer");const r=document.createElement("div");r.setAttribute("class","component-popcontainer__header");const s=document.createElement("label");s.setAttribute("class","component-popcontainer__header__title"),s.innerHTML=t,r.appendChild(s);const i=document.createElement("span");i.setAttribute("class","supermapol-icons-clear component-popcontainer__header__close"),i.onclick=this.closeView.bind(this),e.appendChild(i),e.appendChild(r);const n=document.createElement("div");n.setAttribute("class","component-popcontainer__content"),this.content=n,e.appendChild(n),this.rootContainer=e}appendContent(t){this.content.appendChild(t)}}class Lf extends Of{constructor(t){super(t),this._initView()}_initView(){const t=document.createElement("div");t.setAttribute("class","component-tabpage");const e=document.createElement("ul");this.header=e;const r=document.createElement("div");r.setAttribute("class","component-tabpage__content"),this.content=r,t.appendChild(e),t.appendChild(r),this.rootContainer=t}setTabs(t){this.removeAllTabs(),this.appendTabs(t)}appendTabs(t){for(let e=0;e<t.length;e++){let r=document.createElement("span");r.index=e,r.appendChild(document.createTextNode(t[e].title)),r.onclick=this._changeTabsPage.bind(this);let s=t[e].content;s.index=e,s.hidden=!0,this.header.appendChild(r),this.content.appendChild(s)}this.header.firstChild.setAttribute("class","on"),this.content.firstChild.hidden=!1}removeTab(t){this.header.removeChild(this.header.children[t]),this.content.removeChild(this.content.children[t])}removeAllTabs(){for(let t=this.header.children.length;t>0;t--)this.header.removeChild(this.header.children[t]),this.content.removeChild(this.content.children[t])}_changeTabsPage(t){const e=t.target.index;for(let t=0;t<this.header.children.length;t++)this.header.children[t].setAttribute("class",""),this.content.children[t].hidden=!0,t===e&&(this.header.children[t].setAttribute("class","on"),this.content.children[t].hidden=!1)}}Od.Lang=Af,Od.i18n=Od.Lang.i18n,Od.Util={...Od.Util,...v},Od.Browser=m,Od.INCHES_PER_UNIT=b,Od.METERS_PER_INCH=S,Od.DOTS_PER_INCH=96,Od.IS_GECKO=g,Od.setCORS=function(t){Ft=t},Od.isCORS=jt,Od.setRequestTimeout=function(t){return Bt=t},Od.getRequestTimeout=Ut,Od.FetchRequest=Jt,Od.inherit=function(t,e){var r,s,i,n=function(){};for(n.prototype=e.prototype,t.prototype=new n,r=2,s=arguments.length;r<s;r++)"function"==typeof(i=arguments[r])&&(i=i.prototype),v.extend(t.prototype,i)},Od.mixin=o,Od.String=l,Od.Number=h,Od.Function=u,Od.Array=c,Od.Date=Ld,Od.Event=zt,Od.Bounds=x,Od.Credential=Vt,Od.Events=qt,Od.Feature=P,Od.Geometry=d,Od.Geometry3D=class extends Tt{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry3D",this.position=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.scaleX=null,this.scaleY=null,this.scaleZ=null,v.extend(this,t)}destroy(){this.position=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.scaleX=null,this.scaleY=null,this.scaleZ=null}},Od.Pixel=a,Od.Size=n,Od.Feature.Vector=I,Od.Geometry.Collection=A,Od.Geometry.Curve=C,Od.Geometry.GeoText=Zn,Od.Geometry.LinearRing=T,Od.Geometry.LineString=E,Od.Geometry.MultiLineString=R,Od.Geometry.MultiPoint=M,Od.Geometry.MultiPolygon=D,Od.Geometry.Point=w,Od.Geometry.Polygon=O,Od.Geometry.Rectangle=Pd,Od.Components.Chart=class{constructor(t,e){this.domID=t,this.chartType=e.type||"bar",e.datasets.type=e.datasets.type||"iServer",e.datasets.withCredentials=e.datasets.withCredentials||!1,this.viewModel=new Tf(e),this._fillDataToView()}onAdd(t){this.addChart=t}_fillDataToView(){let t=new xf;this.viewModel.getDatasetInfo(this._createChart.bind(this)),this.viewModel.events.on({getdatafailed:e=>{t.showView(e.message)}})}getStyle(){return this.viewModel.getStyle()}getFeatures(){return this.viewModel.getFeatures()}setStyle(t){let e=this.viewModel.setStyle(t);this._updateChart(e)}changeType(t){if(this.chartType!==t){this.chartType=t;let e=this.viewModel.changeType(t);this._updateChart(e)}}updateData(t,e){let r=this;this.viewModel.updateData(t,e,function(t){r._updateChart(t),r.addChart&&r.addChart()})}_createChart(t){this.echart=wf.init(document.getElementById(this.domID),null,{renderer:"canvas"});let e=this.viewModel._createChartOptions(t);this.echart.setOption(e),this.addChart&&this.addChart()}_updateChart(t){this.echart&&(this.echart.clear(),this.echart.setOption(t))}},Od.Components.ChartViewModel=Tf,Od.Components.MessageBox=xf,Od.Components.AttributesPopContainer=class extends Pf{constructor(t){t.title=t.title?t.title:"å±æ§",super(t),this.rootContainer.firstChild.hidden=!0,t.attributes=t.attributes?t.attributes:[],this._createAttributesTable(t.attributes)}_createAttributesTable(t){const e=document.createElement("table");e.setAttribute("class","component-popcontainer__content__table");const r=document.createElement("tbody");let s=!0;for(let e in t){const i=document.createElement("tr");s&&i.setAttribute("class","component-popcontainer__content__td--color");const n=document.createElement("td"),a=document.createElement("Span");a.innerHTML=e,n.appendChild(a);const o=document.createElement("td");o.innerHTML=t[e],i.appendChild(n),i.appendChild(o),r.appendChild(i),s=!s}e.appendChild(r),this.appendContent(e)}},Od.Components.CityTabsPage=class extends Lf{constructor(t){super(t),this.rootContainer.classList.add("component-citytabpage--noneBoxShadow"),this.config=t.config,v.isArray(this.config)?(this.header.hidden=!0,this._createCityItem("åå¸",this.config),this.content.style.border="none"):(this._createTabs(),this.header.onclick=(t=>{for(let t=0;t<this.header.children.length;t++)this.header.children[t].setAttribute("class","");t.target.setAttribute("class","on"),this._createCityContent(t.target.innerHTML)}))}_createTabs(){if(v.isArray(this.config))for(let t=0;t<this.config.length;t++){let e="";for(const r in this.config[t])e+=r;let r=document.createElement("li");r.innerHTML=e,this.header.appendChild(r)}else for(const t in this.config){let e=document.createElement("li");e.innerHTML=t,this.header.appendChild(e)}this.header.firstChild.setAttribute("class","on"),this._createCityContent(this.header.firstChild.innerHTML)}_createCityContent(t){for(let t=this.content.children.length;t>0;t--)this.content.removeChild(this.content.children[t-1]);const e=this.config[t];for(let t in e)this._createCityItem(t,e[t])}_createCityItem(t,e){const r=document.createElement("div"),s=document.createElement("div");s.setAttribute("class","component-citytabpag__py-key"),s.innerHTML=t,r.appendChild(s);const i=document.createElement("div");i.setAttribute("class","component-citytabpag__content");for(let t=0;t<e.length;t++){let r=document.createElement("span");r.innerHTML=e[t],i.appendChild(r)}"HOT"===t&&(i.style.width="428px"),r.appendChild(i),this.content.appendChild(r)}},Od.Components.CommonContainer=class extends Of{constructor(t){super(t);let e=t.title?t.title:"";this._initView(e)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-container");const r=document.createElement("div");r.setAttribute("class","component-title");const s=document.createElement("div");s.innerHTML=t,r.appendChild(s),e.appendChild(r);const i=document.createElement("div");return i.setAttribute("class","component-content"),e.appendChild(i),this.content=i,this.rootContainer=e,e}getContentElement(){return this.content}appendContent(t){this.content.appendChild(t)}},Od.Components.DropDownBox=class extends Of{constructor(t){super(t),this._initView(t)}_initView(t){let e=document.createElement("div");e.className="component-dropdownbox--container";let r=document.createElement("div");r.setAttribute("tabindex","1"),r.className="component-dropdownbox",e.appendChild(r);let s=document.createElement("div");r.appendChild(s),this._createDropDownOption(t[0],s);let i=document.createElement("div");i.className="component-dropdownbox__triangle-btn",r.appendChild(i);let n=document.createElement("div");n.className="component-triangle-down-img",i.appendChild(n);let a={parentEle:r,dropDownContent:["component-dropdownbox__content component-dropdownbox__content--chart","dropDownContent"],scrollareaContent:"component-selecttool__scrollarea__content",optionsArr:t,triangleBtn:n,dropDownTopContainer:s};this._createDropDownBox(a),this.rootContainer=e}_createDropDownBox(t){let e=t.parentEle,r=t.dropDownTopContainer,s=document.createElement("div");s.className=t.dropDownContent[0],e.appendChild(s);let i=document.createElement("div");i.className=t.scrollareaContent,s.appendChild(i);let n=t.optionsArr;for(let t=0;t<n.length;t++)this._createDropDownOption(n[t],i);let a=t.triangleBtn;this._dropDownClickEvent(e,s,a),this._eleOnblur(e,s,a);let o=i.children;for(let t=0;t<o.length;t++)o[t].onclick=function(){r.innerHTML=o[t].outerHTML}}_createDropDownOption(t,e){let r=document.createElement("div");r.className="component-dropdownbox__item";let s=t;s.dataValue&&r.setAttribute("data-value",s.dataValue),e.appendChild(r);let i=document.createElement("div");i.className="component-dropdownbox__item__img",r.appendChild(i);let n=document.createElement("div");s.icon.className&&(n.className=s.icon.className),s.icon.background&&(n.style.background=s.icon.background),i.appendChild(n);let a=document.createElement("div");a.className="component-dropdownbox__item__title",a.title=s.title,a.innerHTML=s.title,r.appendChild(a);let o=document.createElement("div");o.className="component-dropdownbox__item__remark",o.title=s.remark,o.innerHTML=s.remark,r.appendChild(o)}_dropDownClickEvent(t,e,r){t.onclick=function(t){"block"===e.style.display?(e.style.display="none",r.className="component-triangle-down-img"):(e.style.display="block",r.className="triangle-up-img"),t.preventDefault(),t.stopPropagation()},t.onmousedown=function(t){t.target!==this&&(this.focus(),t.preventDefault(),t.stopPropagation())}}_eleOnblur(t,e,r){t.onblur=function(){e.style.display="none",r.className="component-triangle-down-img"}}_createElement(t,e,r){let s=document.createElement(t||"div");return e&&(s.className=e),r&&r.appendChild(s),s}},Od.Components.IndexTabsPageContainer=Lf,Od.Components.NavTabsPage=class extends Of{constructor(t){super(t),this.navTabsTitle=null,this.navTabsContent=null,t.tabs=t.tabs?t.tabs:[],this._initView(t.tabs)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-navtabspage");const r=document.createElement("span");r.setAttribute("class","supermapol-icons-close"),r.onclick=this.closeView.bind(this),e.appendChild(r);const s=document.createElement("div");this.navTabsTitle=s,s.setAttribute("class","component-navtabspage__title"),e.appendChild(s);const i=document.createElement("div");this.navTabsContent=i,i.setAttribute("class","component-navtabspage__content"),e.appendChild(i),t.length>0&&this.appendTabs(t),this.rootContainer=e}setTabs(t){this.removeAllTabs(),this.appendTabs(t)}appendTabs(t){for(let e=0;e<t.length;e++){let r=document.createElement("span");r.index=e,r.appendChild(document.createTextNode(t[e].title)),r.onclick=this._changeTabsPage.bind(this);let s=t[e].content;s.index=e,s.hidden=!0,this.navTabsTitle.appendChild(r),this.navTabsContent.appendChild(s)}this.navTabsTitle.firstChild.setAttribute("class","component-navtabspage__tabs--select"),this.navTabsContent.firstChild.hidden=!1}removeTab(t){this.navTabsTitle.removeChild(this.navTabsTitle.children[t]),this.navTabsContent.removeChild(this.navTabsContent.children[t])}removeAllTabs(){for(let t=this.navTabsTitle.children.length;t>0;t--)this.navTabsTitle.removeChild(this.navTabsTitle.children[t]),this.navTabsContent.removeChild(this.navTabsContent.children[t])}_changeTabsPage(t){const e=t.target.index;for(let t=0;t<this.navTabsTitle.children.length;t++)this.navTabsTitle.children[t].setAttribute("class",""),this.navTabsContent.children[t].hidden=!0,t===e&&(this.navTabsTitle.children[t].setAttribute("class","component-navtabspage__tabs--select"),this.navTabsContent.children[t].hidden=!1)}},Od.Components.PaginationContainer=class extends Of{constructor(t){super(t=t||{}),this.currentPage=0,this.pageNumberLis=[],this.currentPageNumberLis=[],this.linkageEvent=null,t.contents=t.contents?t.contents:null,t.pageCounts=t.pageCounts?t.pageCounts:0,this._initView(t.contents,t.pageCounts)}setLinkageEvent(t){this.linkageEvent=t}_initView(t,e){const r=document.createElement("div");r.setAttribute("class","component-pagination");const s=document.createElement("div");s.setAttribute("class","component-pagination__content"),r.appendChild(s),this.content=s;const i=document.createElement("ul");i.setAttribute("class","component-pagination__link"),i.onclick=this._changePageEvent.bind(this),r.appendChild(i),this._createLink(i),this.link=i,t&&this.setContent(t),0!==e&&this.setPageLink(e),this.rootContainer=r}setContent(t){this.clearContent(),this.appendContent(t)}appendContent(t){this.content.appendChild(t)}clearContent(){for(let t=this.content.children.length-1;t>=0;t--)this.content.removeChild(this.content.children[t])}setPageLink(t){this.pageNumberLis=[],this.currentPageNumberLis=[],this.clearPageLink(),this._createPageLi(t),this._appendPageLink()}_createPageLi(t){for(let e=0;e<t;e++){const t=document.createElement("li");t.innerHTML=e+1,this.pageNumberLis.push(t)}if(this.pageNumberLis[0].setAttribute("class","active"),this.currentPage=1,t<5)this.currentPageNumberLis=this.pageNumberLis;else for(let t=0;t<5;t++)this.currentPageNumberLis.push(this.pageNumberLis[t])}_appendPageLink(){for(let t=0;t<this.currentPageNumberLis.length;t++)this.link.insertBefore(this.currentPageNumberLis[t],this.link.childNodes[this.link.children.length-2]);for(let t=0;t<this.currentPageNumberLis.length;t++)this.currentPageNumberLis[t].setAttribute("class",""),Number(this.currentPageNumberLis[t].innerHTML)===this.currentPage&&this.currentPageNumberLis[t].setAttribute("class","active");this._changeDisableState(),this.linkageEvent&&this.linkageEvent(this.currentPage)}clearPageLink(){for(let t=this.link.children.length-3;t>1;t--)this.link.removeChild(this.link.children[t])}_createLink(t){for(let e=0;e<4;e++){const r=document.createElement("li");r.setAttribute("class","disable");const s=document.createElement("span");r.appendChild(s),0===e?(s.id="first",s.setAttribute("class","supermapol-icons-first")):1===e?(s.id="prev",s.setAttribute("class","supermapol-icons-prev")):2===e?(s.id="next",s.setAttribute("class","supermapol-icons-next")):3===e&&(s.id="last",s.setAttribute("class","supermapol-icons-last")),t.appendChild(r)}}_changePageEvent(t){const e=t.target;if("disable"===e.parentElement.classList[0])return;let r;if(e.id)r=e.id;else{if(!Number(e.innerHTML))return;r=Number(e.innerHTML)}this._prePageNum(r),this.clearPageLink(),this._appendPageLink()}_changeDisableState(){this.link.children[0].setAttribute("class",""),this.link.children[1].setAttribute("class",""),this.link.children[this.link.children.length-1].setAttribute("class",""),this.link.children[this.link.children.length-2].setAttribute("class",""),1===this.currentPage&&(this.link.children[0].setAttribute("class","disable"),this.link.children[1].setAttribute("class","disable")),this.currentPage===this.pageNumberLis.length&&(this.link.children[this.link.children.length-1].setAttribute("class","disable"),this.link.children[this.link.children.length-2].setAttribute("class","disable"))}_prePageNum(t){const e=[];if(this.currentPage="first"===t?1:"last"===t?this.pageNumberLis.length:"prev"===t?this.currentPage-1:"next"===t?this.currentPage+1:t,this.pageNumberLis.length<=5)for(let t=0;t<this.pageNumberLis.length;t++)e.push(this.pageNumberLis[t]);else if(this.currentPage<=3)for(let t=0;t<5;t++)e.push(this.pageNumberLis[t]);else if(this.currentPage>=this.pageNumberLis.length-3)for(let t=this.pageNumberLis.length-5;t<this.pageNumberLis.length;t++)e.push(this.pageNumberLis[t]);else for(let t=this.currentPage-3;t<=this.currentPage+1;t++)e.push(this.pageNumberLis[t]);e.length>0&&(this.currentPageNumberLis=e)}},Od.Components.PopContainer=Pf,Od.Components.Select=class extends Of{constructor(t){super(t),this._initView(t)}_initView(t){let e=this._createElement("div","component-selecttool");t.labelName&&(this._createElement("label","component-selecttool__lable--describe",e).innerHTML=t.labelName);let r=this._createElement("div","component-selecttool--chart",e);r.setAttribute("tabindex","1");let s=this._createElement("div","component-selecttool__name",r);s.title=t.optionsArr[0],s.innerHTML=t.optionsArr[0];let i=this._createElement("div","component-selecttool__trianglebtn--chart",r),n=this._createElement("div","component-triangle-down-img",i),a=this._createElement("div","component-selecttool__content",r),o=this._createElement("div","component-selecttool__content--chart",a),l=this._createElement("div","component-selecttool__scrollarea__content",o);l.setAttribute("tabindex","1"),this.createOptions(l,t.optionsArr),this.optionClickEvent(l,s,t.optionsClickCb),this._selectClickEvent(r,a,n),this.rootContainer=e}createOptions(t,e){for(let r in e){let s=this._createElement("div","component-selecttool__option",t);s.title=e[r],s.innerHTML=e[r]}}_selectClickEvent(t,e,r){t.onclick=function(t){"block"===e.style.display?(e.style.display="none",r.className="component-triangle-down-img"):(e.style.display="block",r.className="triangle-up-img"),t.preventDefault(),t.stopPropagation()},t.onmousedown=function(t){t.target!==this&&(this.focus(),t.preventDefault(),t.stopPropagation())},t.onblur=function(){e.style.display="none",r.className="component-triangle-down-img"}}_createElement(t,e,r){let s=document.createElement(t||"div");return e&&(s.className=e),r&&r.appendChild(s),s}optionClickEvent(t,e,r){for(let s=0;s<t.children.length;s++){let i=t.children[s];i.onclick=function(){e.innerHTML=i.innerHTML,e.title=i.title,i.getAttribute("data-value")&&e.setAttribute("data-value",i.getAttribute("data-value")),r&&r(i)}}}},Od.Components.TemplateBase=Of,Od.Components.FileReaderUtil=Cf,Od.TimeControlBase=Id,Od.TimeFlowControl=class extends Id{constructor(t,e){super(e);var r=this;r.callback=t,Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,s=function(){},i=function(){return r.apply(this instanceof s&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,i.prototype=new s,i}),r.update=r.update.bind(r),r.oldTime=r.currentTime,r.CLASS_NAME="SuperMap.TimeFlowControl"}updateOptions(t){t=t||{},super.updateOptions(t)}start(){var t=this;t.running||(t.running=!0,t.reverse?t.currentTime===t.startTime&&(t.oldTime=t.endTime,t.currentTime=t.oldTime):t.oldTime===t.endTime&&(t.currentTime=t.startTime,t.oldTime=t.currentTime),t.tick())}stop(){super.stop();var t=this;t.oldTime=t.currentTime,t.running&&(t.running=!1),t.intervalId&&window.clearTimeout(t.intervalId)}destroy(){super.destroy(),this.oldTime=null,this.callback=null}tick(){var t=this;t.intervalId&&window.clearInterval(t.intervalId),t.intervalId=null,t.update(),t.intervalId=window.setInterval(t.update,t.frequency)}update(){var t=this;if(t.running)if(t.callback&&t.callback(t.currentTime),t.reverse){if(t.currentTime===t.startTime){if(!t.repeat)return t.running=!1,null;t.oldTime=t.endTime,t.currentTime=t.oldTime}else t.currentTime=t.oldTime,t.oldTime-=t.speed;t.oldTime<=t.startTime&&(t.oldTime=t.startTime)}else{if(t.currentTime===t.endTime){if(!t.repeat)return t.running=!1,t.stop(),null;t.stop(),t.currentTime=t.startTime,t.oldTime=t.currentTime,t.start()}else t.oldTime=t.currentTime,t.currentTime+=t.speed;t.currentTime>=t.endTime&&(t.currentTime=t.endTime)}}},Od.Format=Od.Format||N,Od.Format.GeoJSON=Ot,Od.Format.JSON=k,Od.Format.WKT=class extends N{constructor(t){super(t),this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},this.CLASS_NAME="SuperMap.Format.WKT",this.extract={point:function(t){return t.x+" "+t.y},multipoint(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push("("+this.extract.point.apply(this,[t.components[r]])+")");return e.join(",")},linestring(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e.join(",")},multilinestring(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push("("+this.extract.linestring.apply(this,[t.components[r]])+")");return e.join(",")},polygon(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push("("+this.extract.linestring.apply(this,[t.components[r]])+")");return e.join(",")},multipolygon(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push("("+this.extract.polygon.apply(this,[t.components[r]])+")");return e.join(",")},collection(t){for(var e=[],r=0,s=t.components.length;r<s;++r)e.push(this.extractGeometry.apply(this,[t.components[r]]));return e.join(",")}},this.parse={point:function(t){var e=l.trim(t).split(this.regExes.spaces);return new I(new w(e[0],e[1]))},multipoint:function(t){for(var e,r=l.trim(t).split(","),s=[],i=0,n=r.length;i<n;++i)e=r[i].replace(this.regExes.trimParens,"$1"),s.push(this.parse.point.apply(this,[e]).geometry);return new I(new M(s))},linestring:function(t){for(var e=l.trim(t).split(","),r=[],s=0,i=e.length;s<i;++s)r.push(this.parse.point.apply(this,[e[s]]).geometry);return new I(new E(r))},multilinestring:function(t){for(var e,r=l.trim(t).split(this.regExes.parenComma),s=[],i=0,n=r.length;i<n;++i)e=r[i].replace(this.regExes.trimParens,"$1"),s.push(this.parse.linestring.apply(this,[e]).geometry);return new I(new R(s))},polygon:function(t){for(var e,r,s,i=l.trim(t).split(this.regExes.parenComma),n=[],a=0,o=i.length;a<o;++a)e=i[a].replace(this.regExes.trimParens,"$1"),r=this.parse.linestring.apply(this,[e]).geometry,s=new T(r.components),n.push(s);return new I(new O(n))},multipolygon:function(t){for(var e,r=l.trim(t).split(this.regExes.doubleParenComma),s=[],i=0,n=r.length;i<n;++i)e=r[i].replace(this.regExes.trimParens,"$1"),s.push(this.parse.polygon.apply(this,[e]).geometry);return new I(new D(s))},geometrycollection:function(t){t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var e=l.trim(t).split("|"),r=[],s=0,i=e.length;s<i;++s)r.push(this.read(e[s]));return r}}}read(t){var e,r,s;t=t.replace(/[\n\r]/g," ");var i=this.regExes.typeStr.exec(t);return i&&(r=i[1].toLowerCase(),s=i[2],this.parse[r]&&(e=this.parse[r].apply(this,[s]))),e}write(t){var e,r,s;t.constructor===Array?(e=t,s=!0):(e=[t],s=!1);var i=[];s&&i.push("GEOMETRYCOLLECTION(");for(var n=0,a=e.length;n<a;++n)s&&n>0&&i.push(","),r=e[n].geometry,i.push(this.extractGeometry(r));return s&&i.push(")"),i.join("")}extractGeometry(t){var e=t.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[e]?("collection"===e?"GEOMETRYCOLLECTION":e.toUpperCase())+"("+this.extract[e].apply(this,[t])+")":null}},Od.iManager=class extends Nd{constructor(t){super(t)}load(){return this.request("GET",this.serviceUrl+"/web/api/service.json")}createIServer(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/server.json",new kd(t))}createIPortal(t){return this.request("POST",this.serviceUrl+"/icloud/web/nodes/portal.json",new kd(t))}iServerList(){return this.request("GET",this.serviceUrl+"/cloud/web/nodes/server.json")}iPortalList(){return this.request("GET",this.serviceUrl+"/icloud/web/nodes/portal.json")}startNodes(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/started.json",t)}stopNodes(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/stopped.json",t)}},Od.iManagerCreateNodeParam=kd,Od.iManagerServiceBase=Nd,Od.iPortal=class extends Rd{constructor(t,e){super(t,e),this.iportalUrl=t,e=e||{},this.withCredentials=e.withCredentials||!1}load(){return Jt.get(this.iportalUrl+"/web")}queryResources(t){if(!(t instanceof Dd))return new Promise(function(t){t("queryParams is not instanceof iPortalQueryParam !")});var e=this,r=this.iportalUrl+"/gateway/catalog/resource/search.json";return t.t=(new Date).getTime(),this.request("GET",r,t).then(function(t){var r=[];(t.content||[]).forEach(function(t){r.push(new Bd(e.iportalUrl,t))});let s=new Fd;return s.content=r,s.total=t.total,s.currentPage=t.currentPage,s.pageSize=t.pageSize,s.aggregations=t.aggregations,s})}updateResourcesShareSetting(t){if(!(t instanceof Gd))return new Promise(function(t){t("shareParams is not instanceof iPortalShareParam !")});var e=t.resourceType.replace("_","").toLowerCase()+"s";"datas"===e&&(e="mycontent/"+e);var r={ids:t.ids,entities:t.entities},s=this.iportalUrl+"/web/"+e+"/sharesetting.json";return this.request("PUT",s,JSON.stringify(r)).then(function(t){return t})}},Od.iPortalAddDataParam=Jd,Od.iPortalAddResourceParam=jd,Od.iPortalDataConnectionInfoParam=Vd,Od.iPortalDataMetaInfoParam=zd,Od.iPortalDataStoreInfoParam=qd,Od.iPortalQueryParam=Dd,Od.iPortalQueryResult=Fd,Od.iPortalRegisterServiceParam=Ud,Od.iPortalResource=Bd,Od.iPortalServiceBase=Rd,Od.iPortalShareEntity=class{constructor(t){t=t||{},this.permissionType="",this.entityType="",this.entityName="GUEST",this.entityId=null,v.extend(this,t)}},Od.iPortalShareParam=Gd,Od.iPortalUser=class extends Rd{constructor(t){super(t),this.iportalUrl=t}deleteResources(t){var e=t.resourceType.replace("_","").toLowerCase(),r=this.iportalUrl+"/web/"+e+"s.json?ids="+encodeURI(JSON.stringify(t.ids));return"data"===e?(r=this.iportalUrl+"/web/mycontent/datas/delete.json",this.request("POST",r,JSON.stringify(t.ids))):this.request("DELETE",r)}addMap(t){if(!(t instanceof jd))return this.getErrMsgPromise("addMapParams is not instanceof IPortalAddResourceParam !");let e={rootUrl:t.rootUrl,tags:t.tags,authorizeSetting:t.entities},r=this.iportalUrl+"/web/maps/batchaddmaps.json";return this.request("POST",r,JSON.stringify(e)).then(function(t){return t})}addScene(t){if(!(t instanceof jd))return this.getErrMsgPromise("addSceneParams is not instanceof IPortalAddResourceParam !");let e={rootUrl:t.rootUrl,tags:t.tags,authorizeSetting:t.entities},r=this.iportalUrl+"/web/scenes/batchaddscenes.json";return this.request("POST",r,JSON.stringify(e)).then(function(t){return t})}registerService(t){if(!(t instanceof Ud))return this.getErrMsgPromise("registerParams is not instanceof IPortalRegisterServiceParam !");let e={type:t.type,tags:t.tags,authorizeSetting:t.entities,metadata:t.metadata,addedMapNames:t.addedMapNames,addedSceneNames:t.addedSceneNames},r=this.iportalUrl+"/web/services.json";return this.request("POST",r,JSON.stringify(e)).then(t=>t)}getErrMsgPromise(t){return new Promise(e=>{e(t)})}uploadDataRequest(t,e){var r=this.iportalUrl+"/web/mycontent/datas/"+t+"/upload.json";return this.request("POST",r,e)}addData(t,e){if(!(t instanceof Jd))return this.getErrMsgPromise("params is not instanceof iPortalAddDataParam !");var r,s=this.iportalUrl+"/web/mycontent/datas.json",i={fileName:t.fileName,tags:t.tags,type:t.type},n=t.type.toLowerCase();if("excel"===n||"csv"===n){if(!(t.dataMetaInfo instanceof zd))return this.getErrMsgPromise("params.dataMetaInfo is not instanceof iPortalDataMetaInfoParam !");r={xField:t.dataMetaInfo.xField,yField:t.dataMetaInfo.yField},"csv"===n&&(r.fileEncoding=t.dataMetaInfo.fileEncoding),i.coordType="WGS84",i.dataMetaInfo=r}else if("hdfs"===n||"hbase"===n){if(!(t.dataMetaInfo instanceof zd))return this.getErrMsgPromise("params.dataMetaInfo is not instanceof iPortalDataMetaInfoParam !");if(!(t.dataMetaInfo.dataStoreInfo instanceof qd))return this.getErrMsgPromise("params.dataMetaInfo.dataStoreInfo is not instanceof iPortalDataStoreInfoParam !");var a={type:t.dataMetaInfo.dataStoreInfo.type};switch(n){case"hdfs":a.url=t.dataMetaInfo.dataStoreInfo.url,r={url:t.dataMetaInfo.url,dataStoreInfo:a};break;case"hbase":if(!(t.dataMetaInfo.dataStoreInfo.connectionInfo instanceof Vd))return this.getErrMsgPromise("params.dataMetaInfo.dataStoreInfo.connectionInfo is not instanceof iPortalDataConnectionInfoParam !");a.connectionInfo={dataBase:t.dataMetaInfo.dataStoreInfo.connectionInfo.dataBase,server:t.dataMetaInfo.dataStoreInfo.connectionInfo.server,engineType:"HBASE"},a.datastoreType="SPATIAL",r={dataStoreInfo:a}}i.dataMetaInfo=r}return this.request("POST",s,JSON.stringify(i)).then(t=>"hdfs"===n||"hbase"===n?t:t.childID?this.uploadDataRequest(t.childID,e):t.customResult)}publishOrUnpublish(t,e){if(!t.dataId||!t.serviceType)return this.getErrMsgPromise("option.dataID and option.serviceType are Required!");var r=t.dataId,s=t.dataServiceId,i=t.serviceType,n=this.iportalUrl+"/web/mycontent/datas/"+r+"/publishstatus.json?serviceType="+i;return s&&(n+="&dataServiceId="+s),this.request("PUT",n,JSON.stringify(e)).then(t=>e?(s||(s=t.customResult),s):t)}getDataPublishedStatus(t,e){var r=this.iportalUrl+"/web/mycontent/datas/"+t+"/publishstatus.json?dataServiceId="+e+"&forPublish=true";return this.request("GET",r)}unPublishDataService(t){return this.publishOrUnpublish(t,!1)}publishDataService(t){return this.publishOrUnpublish(t,!0)}},Od.AddressMatchService=Xt,Od.AggregationParameter=Hd,Od.AreaSolarRadiationParameters=qs,Od.AreaSolarRadiationService=Vs,Od.BucketAggParameter=Wd,Od.BufferAnalystParameters=Qs,Od.BufferAnalystService=Ks,Od.BufferDistance=Hs,Od.BuffersAnalystJobsParameter=Cs,Od.BuffersAnalystJobsService=Es,Od.BufferSetting=Ws,Od.BurstPipelineAnalystParameters=wr,Od.BurstPipelineAnalystService=Ar,Od.ChartFeatureInfoSpecsService=ee,Od.ChartQueryFilterParameter=Kt,Od.ChartQueryParameters=$t,Od.ChartQueryService=te,Od.ClipParameter=class{constructor(t){this.clipDatasetName=null,this.clipDatasourceName=null,this.clipRegion=null,this.isClipInRegion=!0,this.isExactClip=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ClipParameter"}destroy(){var t=this;t.clipDatasetName=null,t.clipDatasourceName=null,t.clipRegion=null,t.isClipInRegion=null,t.isExactClip=null}toJSON(){return v.toJSON({isClipInRegion:this.isClipInRegion,clipDatasetName:this.clipDatasetName,clipDatasourceName:this.clipDatasourceName,isExactClip:this.isExactClip,clipRegion:Tt.fromGeometry(this.clipRegion)})}},Od.ColorDictionary=ar,Od.CommonServiceBase=Wt,Od.ComputeWeightMatrixParameters=Er,Od.ComputeWeightMatrixService=Tr,Od.CreateDatasetParameters=ne,Od.DataFlowService=se,Od.DataReturnOption=Ys,Od.DatasetBufferAnalystParameters=Xs,Od.DatasetInfo=sr,Od.DatasetOverlayAnalystParameters=mi,Od.DatasetService=ie,Od.DatasetSurfaceAnalystParameters=Ai,Od.DatasetThiessenAnalystParameters=Ri,Od.DatasourceConnectionInfo=cs,Od.DatasourceService=le,Od.DensityAnalystService=ti,Od.DensityKernelAnalystParameters=$s,Od.EditFeaturesParameters=he,Od.EditFeaturesService=ue,Od.FacilityAnalyst3DParameters=Kr,Od.FacilityAnalystSinks3DParameters=$r,Od.FacilityAnalystSinks3DService=ts,Od.FacilityAnalystSources3DParameters=es,Od.FacilityAnalystSources3DService=rs,Od.FacilityAnalystStreamParameters=Or,Od.FacilityAnalystStreamService=Pr,Od.FacilityAnalystTracedown3DParameters=ns,Od.FacilityAnalystTracedown3DService=as,Od.FacilityAnalystTraceup3DParameters=ss,Od.FacilityAnalystTraceup3DService=is,Od.FacilityAnalystUpstream3DParameters=os,Od.FacilityAnalystUpstream3DService=ls,Od.FieldParameters=Ce,Od.FieldsFilter=fp,Od.FieldStatisticService=Te,Od.FieldStatisticsParameters=Ee,Od.FilterParameter=de,Od.FindClosestFacilitiesParameters=Rr,Od.FindClosestFacilitiesService=Dr,Od.FindLocationParameters=Fr,Od.FindLocationService=Br,Od.FindMTSPPathsParameters=Gr,Od.FindMTSPPathsService=jr,Od.FindPathParameters=Ur,Od.FindPathService=Jr,Od.FindServiceAreasParameters=zr,Od.FindServiceAreasService=qr,Od.FindTSPPathsParameters=Vr,Od.FindTSPPathsService=Hr,Od.GenerateSpatialDataParameters=ei,Od.GenerateSpatialDataService=ri,Od.GeoCodingParameter=Qt,Od.GeoDecodingParameter=Yt,Od.GeoHashGridAggParameter=class extends Wd{constructor(t){super(),this.precision=5,v.extend(this,t),this.aggType=wt.GEOHASH_GRID,this.CLASS_NAME="SuperMap.GeoHashGridAggParameter"}destroy(){super.destroy(),this.aggType=null,this.precision=null}static toJsonParameters(t){var e={aggName:t.aggName,aggFieldName:t.aggFieldName,aggType:t.aggType,precision:t.precision};return v.toJson(e)}},Od.GeometryBatchAnalystService=zi,Od.GeometryBufferAnalystParameters=Zs,Od.GeometryOverlayAnalystParameters=yi,Od.GeometrySurfaceAnalystParameters=Mi,Od.GeometryThiessenAnalystParameters=Di,Od.GeoprocessingService=Ie,Od.GeoRelationAnalystParameters=si,Od.GeoRelationAnalystService=ii,Od.GetFeaturesByBoundsParameters=ve,Od.GetFeaturesByBoundsService=be,Od.GetFeaturesByBufferParameters=Se,Od.GetFeaturesByBufferService=_e,Od.GetFeaturesByGeometryParameters=xe,Od.GetFeaturesByGeometryService=we,Od.GetFeaturesByIDsParameters=fe,Od.GetFeaturesByIDsService=me,Od.GetFeaturesBySQLParameters=ye,Od.GetFeaturesBySQLService=ge,Od.GetFeaturesParametersBase=pe,Od.GetFeaturesServiceBase=ce,Od.GetFieldsService=Me,Od.GetGridCellInfosParameters=Pe,Od.GetGridCellInfosService=Le,Od.GetLayersInfoService=ur,Od.Grid=or,Od.HillshadeParameter=class extends sp{constructor(t){super(t),this.altitude=45,this.azimuth=315,this.zFactor=1,this.type=Mt.HILLSHADE,v.extend(this,t),this.CLASS_NAME="SuperMap.HillshadeParameter"}destroy(){super.destroy(),this.altitude=null,this.azimuth=null,this.zFactor=null}toJSON(){return{altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,type:this.type}}},Od.Image=lr,Od.ImageCollectionService=rn,Od.ImageGFAspect=Sp,Od.ImageGFHillShade=bp,Od.ImageGFOrtho=_p,Od.ImageGFSlope=xp,Od.ImageRenderingRule=vp,Od.ImageSearchParameter=yp,Od.ImageService=en,Od.ImageStretchOption=gp,Od.InterpolationAnalystParameters=ni,Od.InterpolationAnalystService=ci,Od.InterpolationDensityAnalystParameters=oi,Od.InterpolationIDWAnalystParameters=li,Od.InterpolationKrigingAnalystParameters=ui,Od.InterpolationRBFAnalystParameters=ai,Od.JoinItem=rr,Od.KernelDensityJobParameter=fs,Od.KernelDensityJobsService=ms,Od.LabelImageCell=class extends Qd{constructor(t){super(t),this.height=0,this.pathField=null,this.rotation=0,this.width=0,this.sizeFixed=!1,this.type="IMAGE",t&&v.extend(this,t),this.CLASS_NAME="SuperMap.LabelImageCell"}destroy(){var t=this;t.height=null,t.pathField=null,t.rotation=null,t.width=null,t.sizeFixed=null}},Od.LabelMatrixCell=Qd,Od.LabelMixedTextStyle=Be,Od.LabelSymbolCell=class extends Qd{constructor(t){super(t),this.style=new B,this.symbolIDField=null,this.type="SYMBOL",t&&v.extend(this,t),this.CLASS_NAME="SuperMap.LabelSymbolCell"}destroy(){this.style&&(this.style.destroy(),this.style=null),this.symbolIDField=null}},Od.LabelThemeCell=class extends Qd{constructor(t){super(t),this.themeLabel=new Je,this.type="THEME",t&&v.extend(this,t),this.CLASS_NAME=" SuperMap.LabelThemeCell"}destroy(){this.themeLabel&&(this.themeLabel.destroy(),this.themeLabel=null)}},Od.LayerStatus=class{constructor(t){this.layerName=null,this.isVisible=null,this.displayFilter=null,this.fieldValuesDisplayFilter=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.LayerStatus"}destroy(){this.layerName=null,this.isVisible=null,this.displayFilter=null}toJSON(){var t="{";t+='"type":"UGC",';var e=[];return this.layerName&&(e.push('"name":"'+this.layerName+'"'),e.push('"visible":'+this.isVisible)),this.displayFilter&&e.push('"displayFilter":"'+this.displayFilter+'"'),(this.minScale||0==this.minScale)&&e.push('"minScale":'+this.minScale),(this.maxScale||0==this.maxScale)&&e.push('"maxScale":'+this.maxScale),this.fieldValuesDisplayFilter&&e.push('"fieldValuesDisplayFilter":'+v.toJSON(this.fieldValuesDisplayFilter)),t+=e,t+="}"}},Od.LinkItem=class{constructor(t){this.datasourceConnectionInfo=null,this.foreignKeys=null,this.foreignTable=null,this.linkFields=null,this.linkFilter=null,this.name=null,this.primaryKeys=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.LinkItem"}destroy(){var t=this;t.datasourceConnectionInfo instanceof cs&&(t.datasourceConnectionInfo.destroy(),t.datasourceConnectionInfo=null),t.foreignKeys=null,t.foreignTable=null,t.linkFields=null,t.linkFilter=null,t.name=null,t.primaryKeys=null}},Od.MappingParameters=ps,Od.MapService=gr,Od.MathExpressionAnalysisParameters=di,Od.MathExpressionAnalysisService=pi,Od.MeasureParameters=Sr,Od.MeasureService=_r,Od.MetricsAggParameter=class extends Hd{constructor(t){super(),this.aggType=At.AVG,v.extend(this,t),this.CLASS_NAME="SuperMap.MetricsAggParameter"}destroy(){super.destroy(),this.aggType=null}},Od.NDVIParameter=class extends sp{constructor(t){super(t),this.redIndex=0,this.nirIndex=1,this.colorMap="0:ffffe5ff;0.1:f7fcb9ff;0.2:d9f0a3ff;0.3:addd8eff;0.4:78c679ff;0.5:41ab5dff;0.6:238443ff;0.7:006837ff;1:004529ff",this.type=Mt.NDVI,v.extend(this,t),this.CLASS_NAME="SuperMap.NDVIParameter"}destroy(){super.destroy(),this.redIndex=null,this.nirIndex=null,this.colorMap=null}toJSON(){return{redIndex:this.redIndex,nirIndex:this.nirIndex,colorMap:this.colorMap,type:this.type}}},Od.NetworkAnalystServiceBase=xr,Od.OutputSetting=ds,Od.OverlapDisplayedOptions=class{constructor(t){t=t||{},this.allowPointOverlap=!0,this.allowPointWithTextDisplay=!0,this.allowTextOverlap=!1,this.allowTextAndPointOverlap=!0,this.allowThemeGraduatedSymbolOverlap=!1,this.allowThemeGraphOverlap=!1,this.horizontalOverlappedSpaceSize=0,this.verticalOverlappedSpaceSize=0,v.extend(this,t),this.ugcLayer=new tr(t),this.CLASS_NAME="SuperMap.OverlapDisplayedOptions"}destroy(){v.reset(this)}fromJson(t){this.ugcLayer.fromJson.apply(this,[t])}toServerJSONObject(){return this.ugcLayer.toServerJSONObject.apply(this,arguments)}toString(){var t=this.ugcLayer.toServerJSONObject.apply(this,arguments),e="{";for(var r in t)t.hasOwnProperty(r)&&(e+="'"+r+"':"+t[r]+",");return e=e.substr(0,e.length-1),e+="}"}},Od.OverlayAnalystParameters=fi,Od.OverlayAnalystService=gi,Od.OverlayGeoJobParameter=xs,Od.OverlayGeoJobsService=ws,Od.PointWithMeasure=G,Od.ProcessingServiceBase=us,Od.QueryByBoundsParameters=ks,Od.QueryByBoundsService=Rs,Od.QueryByDistanceParameters=Ds,Od.QueryByDistanceService=Fs,Od.QueryByGeometryParameters=js,Od.QueryByGeometryService=Us,Od.QueryBySQLParameters=Bs,Od.QueryBySQLService=Gs,Od.DatasetMinDistanceAnalystParameters=Gi,Od.MinDistanceAnalystService=Ui,Od.TerrainCutFillCalculationParameters=Oi,Od.TerrainCutFillCalculationService=Pi,Od.terrainAnalystSetting=class{constructor(t){this.bounds=null,this.boundsType=Ct.MAX,this.cellSize=null,this.cellSizeType=Et.UNION,v.extend(this,t),this.CLASS_NAME="SuperMap.terrainAnalystSetting"}destroy(){this.bounds=null,this.boundsType=null,this.cellSize=null,this.cellSizeType=null}},Od.TerrainAspectCalculationParameters=Li,Od.TerrainAspectCalculationService=Ii,Od.TerrainSlopeCalculationParameters=Ni,Od.TerrainSlopeCalculationService=ki,Od.GeometryMinDistanceAnalystParameters=ji,Od.ConvexHullAnalystParameters=class{constructor(t){this.model=null,this.resultSetting=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ConvexHullAnalystParameters"}destroy(){this.model=null,this.resultSetting=null}},Od.ConvexHullAnalystService=Ji,Od.TraceAnalystParameters=Lr,Od.TraceAnalystService=Ir,Od.ConnectedEdgesAnalystParameters=Nr,Od.ConnectedEdgesAnalystService=kr,Od.GetLayersLegendInfoParameters=class{constructor(t){this.bbox=null,this.layers=null,this.transparent=null,this.mapScale=null,this.returnVisibleOnly=null,this.width=null,this.height=null,v.extend(this,t),this.CLASS_NAME="SuperMap.GetLayersLegendInfoParameters"}destroy(){var t=this;t.bbox=null,t.layers=null,t.transparent=null,t.mapScale=null,t.returnVisibleOnly=null,t.width=null,t.height=null}},Od.GetLayersLegendInfoService=cr,Od.QueryParameters=Zt,Od.QueryService=Js,Od.RasterFunctionParameter=sp,Od.Route=j,Od.RouteCalculateMeasureParameters=vi,Od.RouteCalculateMeasureService=bi,Od.RouteLocatorParameters=Si,Od.RouteLocatorService=_i,Od.ServerColor=F,Od.ServerFeature=Kn,Od.ServerGeometry=Tt,Od.ServerStyle=B,Od.ServerTextStyle=ke,Od.ServerTheme=nr,Od.SetDatasourceParameters=oe,Od.SetLayerInfoParameters=class{constructor(t){t=t||{},this.resourceID=null,this.tempLayerName=null,this.layerInfo=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SetLayerInfoParameters"}destroy(){this.resourceID=null,this.tempLayerName=null,this.layerInfo=null}},Od.SetLayerInfoService=dr,Od.SetLayersInfoParameters=class{constructor(t){t=t||{},this.isTempLayers=null,this.resourceID=null,this.layersInfo=null,v.extend(this,t),this.CLASS_NAME="SuperMap.SetLayersInfoParameters"}destroy(){this.isTempLayers=null,this.resourceID=null,this.layersInfo=null}},Od.SetLayersInfoService=pr,Od.SetLayerStatusParameters=fr,Od.SetLayerStatusService=mr,Od.SingleObjectQueryJobsParameter=ys,Od.SingleObjectQueryJobsService=gs,Od.Sortby=mp,Od.SpatialAnalystBase=zs,Od.StopQueryParameters=Wi,Od.StopQueryService=Qi,Od.SummaryAttributesJobsParameter=Ps,Od.SummaryAttributesJobsService=Ls,Od.SummaryMeshJobParameter=vs,Od.SummaryMeshJobsService=bs,Od.SummaryRegionJobParameter=As,Od.SummaryRegionJobsService=Ms,Od.SupplyCenter=Yd,Od.SurfaceAnalystParameters=wi,Od.SurfaceAnalystParametersSetting=xi,Od.SurfaceAnalystService=Ci,Od.TerrainCurvatureCalculationParameters=Ei,Od.TerrainCurvatureCalculationService=Ti,Od.Theme=Ne,Od.ThemeDotDensity=Ye,Od.ThemeFlow=Xd,Od.ThemeGraduatedSymbol=Ze,Od.ThemeGraduatedSymbolStyle=Xe,Od.ThemeGraph=Qe,Od.ThemeGraphAxes=qe,Od.ThemeGraphItem=We,Od.ThemeGraphSize=Ve,Od.ThemeGraphText=He,Od.ThemeGridRange=Kd,Od.ThemeGridRangeItem=Zd,Od.ThemeGridUnique=tp,Od.ThemeGridUniqueItem=$d,Od.ThemeLabel=Je,Od.ThemeLabelAlongLine=je,Od.ThemeLabelBackground=Ue,Od.ThemeLabelItem=Re,Od.ThemeLabelText=Ge,Od.ThemeLabelUniqueItem=ep,Od.ThemeMemoryData=class{constructor(t,e){this.srcData=t,this.targetData=e,this.CLASS_NAME="SuperMap.ThemeMemoryData"}destroy(){this.srcData=null,this.targetData=null}toJSON(){if(this.srcData&&this.targetData){for(var t="",e=Math.min(this.srcData.length,this.targetData.length),r=0;r<e;r++)t+="'"+this.srcData[r]+"':'"+this.targetData[r]+"',";return r>0&&(t=t.substring(0,t.length-1)),"{"+t+"}"}return null}},Od.ThemeOffset=Fe,Od.ThemeParameters=Vi,Od.ThemeRange=$e,Od.ThemeRangeItem=Ke,Od.ThemeService=Hi,Od.ThemeUnique=ze,Od.ThemeUniqueItem=De,Od.ThiessenAnalystParameters=hi,Od.ThiessenAnalystService=Fi,Od.TilesetsService=vr,Od.TopologyValidatorJobsParameter=Ts,Od.TopologyValidatorJobsService=Os,Od.TransferLine=rp,Od.TransferPathParameters=Yi,Od.TransferPathService=Xi,Od.TransferSolutionParameters=Zi,Od.TransferSolutionService=Ki,Od.TransportationAnalystParameter=Cr,Od.TransportationAnalystResultSetting=Mr,Od.UGCLayer=tr,Od.UGCMapLayer=er,Od.UGCSubLayer=ir,Od.UpdateDatasetParameters=ae,Od.UpdateEdgeWeightParameters=Wr,Od.UpdateEdgeWeightService=Qr,Od.UpdateTurnNodeWeightParameters=Yr,Od.UpdateTurnNodeWeightService=Xr,Od.Vector=hr,Od.VectorClipJobsParameter=Ss,Od.VectorClipJobsService=_s,Od.WebPrintingJobContent=cp,Od.WebPrintingJobCustomItems=ip,Od.WebPrintingJobExportOptions=pp,Od.WebPrintingJobImage=np,Od.WebPrintingJobLayers=ap,Od.WebPrintingJobLayoutOptions=dp,Od.WebPrintingJobLegendOptions=op,Od.WebPrintingJobLittleMapOptions=lp,Od.WebPrintingJobNorthArrowOptions=hp,Od.WebPrintingJobParameters=class{constructor(t){t&&(this.content=null,this.layoutOptions=null,this.exportOptions=null,v.extend(this,t),this.CLASS_NAME="SuperMap.WebPrintingJobParameters")}destroy(){this.content instanceof cp&&(this.content.destroy(),this.content=null),this.layoutOptions instanceof dp&&(this.layoutOptions.destroy(),this.layoutOptions=null),this.exportOptions instanceof pp&&(this.exportOptions.destroy(),this.exportOptions=null)}},Od.WebPrintingJobScaleBarOptions=up,Od.WebPrintingService=tn,Od.Online=class{constructor(){this.rootUrl="https://www.supermapol.com",this.webUrl=this.rootUrl+"/web";var t=this.webUrl+"/mycontent";this.mDatasUrl=t+"/datas",this.CLASS_NAME="SuperMap.Online"}load(){return Jt.get(this.rootUrl).then(function(t){return t})}login(){Ht.loginOnline(this.rootUrl,!0)}queryDatas(t){var e=this,r=e.mDatasUrl;return t&&(t=t.toJSON()),Jt.get(r,t).then(function(t){if(t&&t.content&&!(t.content.length<1)){for(var r=[],s=t.content,i=s.length,n=0;n<i;n++){var a=s[n],o=new Ap(e.mDatasUrl,a);r.push(o)}return r}})}},Od.OnlineData=Ap,Od.OnlineQueryDatasParameter=class{constructor(t){t=t||{},this.userNames=null,this.types=null,this.fileName=null,this.serviceStatuses=null,this.serviceId=null,this.ids=null,this.keywords=null,this.orderBy=null,this.tags=null,this.filterFields=null,v.extend(this,t),this.CLASS_NAME="SuperMap.OnlineQueryDatasParameter"}toJSON(){var t=this,e={types:t.types,fileName:t.fileName,serviceStatuses:t.serviceStatuses,serviceId:t.serviceId,ids:t.ids,keywords:t.keywords,orderBy:t.orderBy,tags:t.tags,filterFields:t.filterFields};for(var r in e)null==e[r]&&delete e[r];return e}},Od.ServiceStatus={DOES_NOT_INVOLVE:"DOES_NOT_INVOLVE",PUBLISH_FAILED:"PUBLISH_FAILED",PUBLISHED:"PUBLISHED",PUBLISHING:"PUBLISHING",UNPUBLISHED:"UNPUBLISHED",UNPUBLISHED_FAILED:"UNPUBLISHED_FAILED"},Od.DataItemType={GEOJSON:"GEOJSON",UGCV5_MVT:"UGCV5_MVT",JSON:"JSON",AUDIO:"AUDIO",COLOR:"COLOR",COLORSCHEME:"COLORSCHEME",CSV:"CSV",EXCEL:"EXCEL",FILLSYMBOL:"FILLSYMBOL",IMAGE:"IMAGE",LAYERTEMPLATE:"LAYERTEMPLATE",LAYOUTTEMPLATE:"LAYOUTTEMPLATE",LINESYMBOL:"LINESYMBOL",MAPTEMPLATE:"MAPTEMPLATE",MARKERSYMBOL:"MARKERSYMBOL",MBTILES:"MBTILES",PHOTOS:"PHOTOS",SHP:"SHP",SMTILES:"SMTILES",SVTILES:"SVTILES",THEMETEMPLATE:"THEMETEMPLATE",TPK:"TPK",UDB:"UDB",UGCV5:"UGCV5",UNKNOWN:"UNKNOWN",VIDEO:"VIDEO",WORKENVIRONMENT:"WORKENVIRONMENT",WORKSPACE:"WORKSPACE"},Od.DataItemOrderBy={FILENAME:"FILENAME",ID:"ID",LASTMODIFIEDTIME:"LASTMODIFIEDTIME",NICKNAME:"NICKNAME",SERVICESTATUS:"SERVICESTATUS",SIZE:"SIZE",STATUS:"STATUS",TYPE:"TYPE",UPDATETIME:"UPDATETIME",USERNAME:"USERNAME"},Od.FilterField={LINKPAGE:"LINKPAGE",MAPTITLE:"MAPTITLE",NICKNAME:"NICKNAME",RESTITLE:"RESTITLE",USERNAME:"USERNAME"},Od.OnlineServiceBase=wp,Od.Feature=Od.Feature||{},Od.Feature.Theme=sf,Od.Feature.Theme.Bar=class extends nf{constructor(t,e,r,s,i){super(t,e,r,s,i),this.CLASS_NAME="SuperMap.Feature.Theme.Bar"}destroy(){super.destroy()}assembleShapes(){var t={showShadow:!0,shadowBlur:8,shadowColor:"rgba(100,100,100,0.8)",shadowOffsetX:2,shadowOffsetY:2},e=this.setting;if(e.barLinearGradient||(e.barLinearGradient=[["#00FF00","#00CD00"],["#00CCFF","#5E87A2"],["#00FF66","#669985"],["#CCFF00","#94A25E"],["#FF9900","#A2945E"]]),e.dataViewBoxParameter||(void 0===e.useAxis||e.useAxis?e.dataViewBoxParameter=[45,15,15,15]:e.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var s=this.dataViewBox,i=this.dataValues;if(!(i.length<1)){for(let t=0,e=i.length;t<e;t++)if(i[t]<r[0]||i[t]>r[1])return;var n=this.calculateXShapeInfo();if(n){var a=n.xPositions,o=n.width;(void 0===e.useBackground||e.useBackground)&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,e)),(void 0===e.useAxis||e.useAxis)&&(this.shapes=this.shapes.concat(rf.GraphAxis(this.shapeFactory,s,e,n)));for(var l=0;l<i.length;l++){var h=s[1]-(i[l]-r[0])/this.DVBUnitValue,u=[[a[l]-o/2,s[1]-1],[a[l]+o/2,s[1]-1],[a[l]+o/2,h],[a[l]-o/2,h]],c=new Rp(u);if(void 0===e.showShadow||e.showShadow){if(e.barShadowStyle){var d=e.barShadowStyle;d.shadowBlur&&(t.shadowBlur=d.shadowBlur),d.shadowColor&&(t.shadowColor=d.shadowColor),d.shadowOffsetX&&(t.shadowOffsetX=d.shadowOffsetX),d.shadowOffsetY&&(t.shadowOffsetY=d.shadowOffsetY)}c.style={},v.copyAttributesWithClip(c.style,t)}c.refDataID=this.data.id,c.dataInfo={field:this.fields[l],value:i[l]},void 0!==e.barHoverAble&&(c.hoverable=e.barHoverAble),void 0!==e.barClickAble&&(c.clickable=e.barClickAble),this.shapes.push(this.shapeFactory.createShape(c))}this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,s=this.dataValues.length;if(s<1)return null;var i=[],n=0,a=this.DVBWidth;if(r.xShapeBlank&&r.xShapeBlank.length&&3==r.xShapeBlank.length){var o=a-((t=r.xShapeBlank)[0]+t[2]+(s-1)*t[1]);if(o<=s)return null;n=o/s}else t=[n=a/(2*s+1),n,n];for(var l=0,h=0;h<s;h++)0==h?l=t[0]+n/2:l+=n+t[1],i.push(e[0]+l);return{xPositions:i,width:n}}resetLinearGradient(){if(this.RelativeCoordinate)for(var t=this.shapes.length,e=this.setting.barLinearGradient,r=-1,s=0;s<t;s++){var i=this.shapes[s];if("SuperMap.LevelRenderer.Shape.SmicPolygon"===i.CLASS_NAME){var n=i.style,a=this.location[0]+n.pointList[0][0],o=this.location[0]+n.pointList[1][0];++r>=e.length&&(r%=e.length);var l=e[r][0],h=e[r][1],u=(new Cp).getLinearGradient(a,0,o,0,[[0,l],[1,h]]);i.style.color=u}}}},Od.Feature.Theme.Bar3D=class extends nf{constructor(t,e,r,s,i){super(t,e,r,s,i),this.CLASS_NAME="SuperMap.Feature.Theme.Bar3D"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,25,20,20]:t.dataViewBoxParameter=[5,5,5,5]),t.axisUseArrow=void 0===t.axisUseArrow||t.axisUseArrow,t.axisXLabelsOffset=void 0!==t.axisXLabelsOffset?t.axisXLabelsOffset:[-10,10],this.initBaseParameter()){var e=this.DVBCodomain;this.DVBUnitValue=(e[1]-e[0])/this.DVBHeight;var r=this.dataViewBox,s=this.dataValues;if(!(s.length<1)){for(let t=0,r=s.length;t<r;t++)if(s[t]<e[0]||s[t]>e[1])return;var i=this.calculateXShapeInfo();if(i){var n=i.xPositions,a=i.width;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,t)),(!t.axis3DParameter||isNaN(t.axis3DParameter)||t.axis3DParameter<15)&&(t.axis3DParameter=20),(void 0===t.useAxis||t.useAxis)&&(this.shapes=this.shapes.concat(rf.GraphAxis(this.shapeFactory,r,t,i)));var o=t.bar3DParameter&&!isNaN(t.bar3DParameter)?t.bar3DParameter:10;for(let i=0;i<s.length;i++){var l=r[1]-(s[i]-e[0])/this.DVBUnitValue,h=n[i]-a/2,u=n[i]+a/2,c=[[h,l],[u,l],[u-o,l+o],[h-o,l+o]],d=[[u,l],[u-o,l+o],[u-o,r[1]+o],[u,r[1]]],p=[[h-o,r[1]+o],[u-o,r[1]+o],[u-o,l+o],[h-o,l+o]];o<=0&&(p=[[h,r[1]],[u,r[1]],[u,l],[h,l]]);var f=new Rp(c),m=new Rp(d),y=new Rp(p);t.barSideStyle=t.barSideStyle?t.barSideStyle:t.barFaceStyle,t.barSideStyleByFields=t.barSideStyleByFields?t.barSideStyleByFields:t.barFaceStyleByFields,t.barSideStyleByCodomain=t.barSideStyleByCodomain?t.barSideStyleByCodomain:t.barFaceStyleByCodomain,t.barTopStyle=t.barTopStyle?t.barTopStyle:t.barFaceStyle,t.barTopStyleByFields=t.barTopStyleByFields?t.barTopStyleByFields:t.barFaceStyleByFields,t.barTopStyleByCodomain=t.barTopStyleByCodomain?t.barTopStyleByCodomain:t.barFaceStyleByCodomain,y.style=rf.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barFaceStyle,t.barFaceStyleByFields,t.barFaceStyleByCodomain,i,s[i]),m.style=rf.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barSideStyle,t.barSideStyleByFields,t.barSideStyleByCodomain,i,s[i]),f.style=rf.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barTopStyle,t.barTopStyleByFields,t.barTopStyleByCodomain,i,s[i]),t.barSideHoverStyle=t.barSideHoverStyle?t.barSideHoverStyle:t.barFaceHoverStyle,t.barTopHoverStyle=t.barTopHoverStyle?t.barTopHoverStyle:t.barFaceHoverStyle,y.highlightStyle=rf.ShapeStyleTool({stroke:!0},t.barFaceHoverStyle),m.highlightStyle=rf.ShapeStyleTool({stroke:!0},t.barSideHoverStyle),f.highlightStyle=rf.ShapeStyleTool({stroke:!0},t.barTopHoverStyle),f.refDataID=m.refDataID=y.refDataID=this.data.id,f.isHoverByRefDataID=m.isHoverByRefDataID=y.isHoverByRefDataID=!0,f.refDataHoverGroup=m.refDataHoverGroup=y.refDataHoverGroup=v.createUniqueID("lr_shg"),f.dataInfo=m.dataInfo=y.dataInfo={field:this.fields[i],value:s[i]},void 0!==t.barHoverAble&&(f.hoverable=m.hoverable=y.hoverable=t.barHoverAble),void 0!==t.barClickAble&&(f.clickable=m.clickable=y.clickable=t.barClickAble),this.shapes.push(this.shapeFactory.createShape(m)),this.shapes.push(this.shapeFactory.createShape(f)),this.shapes.push(this.shapeFactory.createShape(y))}this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,s=this.dataValues.length;if(s<1)return null;var i=[],n=0,a=this.DVBWidth;if(r.xShapeBlank&&r.xShapeBlank.length&&3==r.xShapeBlank.length){var o=a-((t=r.xShapeBlank)[0]+t[2]+(s-1)*t[1]);if(o<=s)return null;n=o/s}else t=[n=a/(2*s+1),n,n];for(var l=0,h=0;h<s;h++)0==h?l=t[0]+n/2:l+=n+t[1],i.push(e[0]+l);return{xPositions:i,width:n}}},Od.Feature.Theme.Circle=class extends af{constructor(t,e,r,s,i){super(t,e,r,s,i),this.CLASS_NAME="SuperMap.Feature.Theme.Circle"}destroy(){super.destroy()}assembleShapes(){if(!this.setting)return!1;var t=this.setting;if(!t.codomain)return!1;var e=void 0===t.decimalNumber||isNaN(t.decimalNumber)?-1:t.decimalNumber,r=sf.getDataValues(this.data,this.fields,e);this.dataValues=r||[];var s=this.dataValues;t.maxR||(t.maxR=100),t.minR||(t.minR=0);var i=this.DVBCodomain;i&&i[1]-i[0]>0?this.DVBUnitValue=t.maxR/(i[1]-i[0]):this.DVBUnitValue=t.maxR;var n=this.DVBUnitValue,a=s[0]*n+t.minR;if(this.width=2*a,this.height=2*a,this.initBaseParameter()&&(!i||!(s[0]<i[0]||s[0]>i[1]))){var o=this.DVBCenterPoint,l=new jp(o[0],o[1],a);l.style=rf.ShapeStyleTool(null,t.circleStyle,null,null,0),void 0!==t.fillColor?l.style.fillColor=t.fillColor:l.style.fillColor="#ff9277",l.highlightStyle=rf.ShapeStyleTool(null,t.circleHoverStyle),void 0!==t.circleHoverAble&&(l.hoverable=t.circleHoverAble),void 0!==t.circleClickAble&&(l.clickable=t.circleClickAble),l.refDataID=this.data.id,l.dataInfo={field:this.fields[0],r:a,value:s[0]},this.shapes.push(this.shapeFactory.createShape(l)),this.shapesConvertToRelativeCoordinate()}}},Od.Feature.Theme.Graph=nf,Od.Feature.Theme.Line=class extends nf{constructor(t,e,r,s,i,n){super(t,e,r,s,i,n),this.CLASS_NAME="SuperMap.Feature.Theme.Line"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,15,15,15]:t.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var e=this.dataViewBox,r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var s=this.DVBUnitValue,i=this.dataValues;if(!(i.length<1)){var n=this.calculateXShapeInfo();if(n){var a,o,l=n.xPositions;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,t)),this.shapes=this.shapes.concat(rf.GraphAxis(this.shapeFactory,e,t,n));for(var h=[],u=[],c=0,d=i.length;c<d;c++){if(i[c]<r[0]||i[c]>r[1])return null;a=l[c],o=e[1]-(i[c]-r[0])/s;var p=new Np(a,o);p.style=rf.ShapeStyleTool({fillColor:"#ee9900"},t.pointStyle,t.pointStyleByFields,t.pointStyleByCodomain,c,i[c]),p.highlightStyle=rf.ShapeStyleTool(null,t.pointHoverStyle),void 0!==t.pointHoverAble&&(p.hoverable=t.pointHoverAble),void 0!==t.pointClickAble&&(p.clickable=t.pointClickAble),p.refDataID=this.data.id,p.dataInfo={field:this.fields[c],value:i[c]},u.push(this.shapeFactory.createShape(p));var f=[a,o];h.push(f)}var m=new kp(h);m.style=rf.ShapeStyleTool({strokeColor:"#ee9900"},t.lineStyle),m.clickable=!1,m.hoverable=!1;var y=this.shapeFactory.createShape(m);this.shapes.push(y),this.shapes=this.shapes.concat(u),this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,s=this.dataValues.length;if(s<1)return null;var i=[],n=this.DVBWidth,a=0;if(r.xShapeBlank&&r.xShapeBlank.length&&2==r.xShapeBlank.length){var o=n-((t=r.xShapeBlank)[0]+t[1]);if(o<=s)return null;a=o/(s-1)}else t=[a=n/(s+1),a,a];for(var l=0,h=0;h<s;h++)0==h?l=t[0]:l+=a,i.push(e[0]+l);return{xPositions:i,width:0}}},Od.Feature.Theme.Pie=class extends nf{constructor(t,e,r,s,i){super(t,e,r,s,i),this.CLASS_NAME="SuperMap.Feature.Theme.Pie"}destroy(){super.destroy()}assembleShapes(){var t=this.setting,e=[{fillColor:"#ff9277"},{fillColor:"#dddd00"},{fillColor:"#ffc877"},{fillColor:"#bbe3ff"},{fillColor:"#d5ffbb"},{fillColor:"#bbbbff"},{fillColor:"#ddb000"},{fillColor:"#b0dd00"},{fillColor:"#e2bbff"},{fillColor:"#ffbbe3"},{fillColor:"#ff7777"},{fillColor:"#ff9900"},{fillColor:"#83dd00"},{fillColor:"#77e3ff"},{fillColor:"#778fff"},{fillColor:"#c877ff"},{fillColor:"#ff77ab"},{fillColor:"#ff6600"},{fillColor:"#aa8800"},{fillColor:"#77c7ff"},{fillColor:"#ad77ff"},{fillColor:"#ff77ff"},{fillColor:"#dd0083"},{fillColor:"#777700"},{fillColor:"#00aa00"},{fillColor:"#0088aa"},{fillColor:"#8400dd"},{fillColor:"#aa0088"},{fillColor:"#dd0000"},{fillColor:"#772e00"}];if(this.initBaseParameter()){t.useBackground&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,t));var r=this.dataValues;if(!(r.length<1)){var s=this.DVBCodomain;for(let t=0;t<r.length;t++)if(r[t]<s[0]||r[t]>s[1])return;var i=0;for(let t=0;t<r.length;t++)i+=Math.abs(r[t]);this.DVBUnitValue=360/i;for(var n=this.DVBUnitValue,a=this.DVBCenterPoint,o=0,l=0,h=o,u=this.DVBHeight<this.DVBWidth?this.DVBHeight/2:this.DVBWidth/2,c=0;c<r.length;c++){var d=Math.abs(r[c]);(l=0===c?o+d*n:c===d.length-1?h:o+d*n)-o>=360&&(l=359.9999999);var p=new Fp(a[0],a[1],u,o,l);if(void 0===t.sectorStyleByFields){var f=c%e.length;p.style=rf.ShapeStyleTool(null,t.sectorStyle,e,null,f)}else p.style=rf.ShapeStyleTool(null,t.sectorStyle,t.sectorStyleByFields,t.sectorStyleByCodomain,c,r[c]);p.highlightStyle=rf.ShapeStyleTool(null,t.sectorHoverStyle),void 0!==t.sectorHoverAble&&(p.hoverable=t.sectorHoverAble),void 0!==t.sectorClickAble&&(p.clickable=t.sectorClickAble),p.refDataID=this.data.id,p.dataInfo={field:this.fields[c],value:r[c]},this.shapes.push(this.shapeFactory.createShape(p)),o=l}this.shapesConvertToRelativeCoordinate()}}}},Od.Feature.Theme.Point=class extends nf{constructor(t,e,r,s,i,n){super(t,e,r,s,i,n),this.CLASS_NAME="SuperMap.Feature.Theme.Point"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,15,15,15]:t.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var e=this.dataViewBox,r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var s=this.DVBUnitValue,i=this.dataValues,n=this.calculateXShapeInfo();if(n){var a,o,l=n.xPositions;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,t)),this.shapes=this.shapes.concat(rf.GraphAxis(this.shapeFactory,e,t,n));for(var h=0,u=i.length;h<u;h++){if(i[h]<r[0]||i[h]>r[1])return null;a=l[h],o=e[1]-(i[h]-r[0])/s;var c=new Np(a,o);c.style=rf.ShapeStyleTool({fillColor:"#ee9900"},t.pointStyle,t.pointStyleByFields,t.pointStyleByCodomain,h,i[h]),c.highlightStyle=rf.ShapeStyleTool(null,t.pointHoverStyle),void 0!==t.pointHoverAble&&(c.hoverable=t.pointHoverAble),void 0!==t.pointClickAble&&(c.clickable=t.pointClickAble),c.refDataID=this.data.id,c.dataInfo={field:this.fields[h],value:i[h]},this.shapes.push(this.shapeFactory.createShape(c))}this.shapesConvertToRelativeCoordinate()}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,s=this.dataValues.length;if(s<1)return null;var i=[],n=this.DVBWidth,a=0;if(r.xShapeBlank&&r.xShapeBlank.length&&2==r.xShapeBlank.length){var o=n-((t=r.xShapeBlank)[0]+t[1]);if(o<=s)return null;a=o/(s-1)}else t=[a=n/(s+1),a,a];for(var l=0,h=0;h<s;h++)0==h?l=t[0]:l+=a,i.push(e[0]+l);return{xPositions:i,width:0}}},Od.Feature.Theme.RankSymbol=af,Od.Feature.Theme.Ring=class extends nf{constructor(t,e,r,s,i){super(t,e,r,s,i),this.CLASS_NAME="SuperMap.Feature.Theme.Ring"}destroy(){super.destroy()}assembleShapes(){if(this.initBaseParameter()){var t=[{fillColor:"#ff9277"},{fillColor:"#dddd00"},{fillColor:"#ffc877"},{fillColor:"#bbe3ff"},{fillColor:"#d5ffbb"},{fillColor:"#bbbbff"},{fillColor:"#ddb000"},{fillColor:"#b0dd00"},{fillColor:"#e2bbff"},{fillColor:"#ffbbe3"},{fillColor:"#ff7777"},{fillColor:"#ff9900"},{fillColor:"#83dd00"},{fillColor:"#77e3ff"},{fillColor:"#778fff"},{fillColor:"#c877ff"},{fillColor:"#ff77ab"},{fillColor:"#ff6600"},{fillColor:"#aa8800"},{fillColor:"#77c7ff"},{fillColor:"#ad77ff"},{fillColor:"#ff77ff"},{fillColor:"#dd0083"},{fillColor:"#777700"},{fillColor:"#00aa00"},{fillColor:"#0088aa"},{fillColor:"#8400dd"},{fillColor:"#aa0088"},{fillColor:"#dd0000"},{fillColor:"#772e00"}],e=this.setting;e.useBackground&&this.shapes.push(rf.Background(this.shapeFactory,this.chartBox,e));var r=this.dataValues;if(!(r.length<1)){var s=this.DVBCodomain;for(let t=0;t<r.length;t++)if(r[t]<s[0]||r[t]>s[1])return;var i=0;for(let t=0;t<r.length;t++)i+=Math.abs(r[t]);this.DVBUnitValue=360/i;for(var n=this.DVBUnitValue,a=this.DVBCenterPoint,o=0,l=0,h=o,u=this.DVBHeight<this.DVBWidth?this.DVBHeight/2:this.DVBWidth/2,c=e.innerRingRadius>=0&&e.innerRingRadius<u,d=void 0!==e.innerRingRadius&&!isNaN(e.innerRingRadius)&&c?e.innerRingRadius:0,p=0;p<r.length;p++){var f=Math.abs(r[p]);l=0===p?o+f*n:p===f.length-1?h:o+f*n;var m=new Fp(a[0],a[1],u,o,l,d);if(void 0===e.sectorStyleByFields){var y=p%t.length;m.style=rf.ShapeStyleTool(null,e.sectorStyle,t,null,y)}else m.style=rf.ShapeStyleTool(null,e.sectorStyle,e.sectorStyleByFields,e.sectorStyleByCodomain,p,r[p]);m.highlightStyle=rf.ShapeStyleTool(null,e.sectorHoverStyle),void 0!==e.sectorHoverAble&&(m.hoverable=e.sectorHoverAble),void 0!==e.sectorClickAble&&(m.clickable=e.sectorClickAble),m.refDataID=this.data.id,m.dataInfo={field:this.fields[p],value:r[p]},this.shapes.push(this.shapeFactory.createShape(m)),o=l}this.shapesConvertToRelativeCoordinate()}}}},Od.Feature.Theme.ThemeVector=class extends sf{constructor(t,e,r,s,i){if(super(t,e),t.geometry&&t.geometry instanceof d){this.dataBounds=t.geometry.getBounds(),this.nodesClipPixel=2,this.isHoverAble=!0,this.isMultiHover=!0,this.isClickAble=!0,this.highlightStyle=null,this.shapeOptions={},this.style=r||{},this.CLASS_NAME="SuperMap.Feature.Theme.Vector",this.style=r||{},s&&v.copyAttributesWithClip(this,s,["shapeOptions","dataBounds"]),i&&v.copyAttributesWithClip(this.shapeOptions,i);var n=t.geometry;this.lonlat=this.dataBounds.getCenterLonLat(),this.location=this.getLocalXY(this.lonlat),n instanceof T?this.lineToTF(n):n instanceof E?this.lineToTF(n):n instanceof C||(n instanceof M?this.multiPointToTF(n):n instanceof R?this.multiLineStringToTF(n):n instanceof D?this.multiPolygonToTF(n):n instanceof O?this.polygonToTF(n):n instanceof A||(n instanceof w?this.pointToTF(n):n instanceof Pd?this.rectangleToTF(n):n instanceof Zn&&this.geoTextToTF(n)))}}destroy(){this.style=null,this.dataBounds=null,this.nodesClipPixel=null,this.isHoverAble=null,this.isMultiHover=null,this.isClickAble=null,this.highlightStyle=null,this.shapeOptions=null,super.destroy()}lineToTF(t){for(var e=t.components,r=[],s=[],i=this.location,n=[],a=this.nodesClipPixel,o=0;o<e.length;o++){var l=e[o];if(s=[],r=this.getLocalXY(l),s[0]=r[0]-i[0],s[1]=r[1]-i[1],n.length>0){var h=n[n.length-1];if(Math.abs(h[0]-s[0])<=a&&Math.abs(h[1]-s[1])<=a)continue}n.push(s)}if(n.length<2)return null;var u=new Object;(u=v.copyAttributesWithClip(u,this.style,["pointList"])).pointList=n;var c=new Kp({style:u,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(c.highlightStyle=this.highlightStyle),c.refOriginalPosition=this.location,c.refDataID=this.data.id,c.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&v.copyAttributesWithClip(c,this.shapeOptions),this.shapes.push(c)}multiPointToTF(t){for(var e=t.components,r=[],s=[],i=this.location,n=[],a=this.nodesClipPixel,o=0;o<e.length;o++){var l=e[o];if(s=[],r=this.getLocalXY(l),s[0]=r[0]-i[0],s[1]=r[1]-i[1],n.length>0){var h=n[n.length-1];if(Math.abs(h[0]-s[0])<=a&&Math.abs(h[1]-s[1])<=a)continue}n.push(s);var u=new Object;u.r=6,(u=v.copyAttributesWithClip(u,this.style)).x=s[0],u.y=s[1];var c=new Qp({style:u,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(c.highlightStyle=this.highlightStyle),c.refOriginalPosition=i,c.refDataID=this.data.id,c.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&v.copyAttributesWithClip(c,this.shapeOptions),this.shapes.push(c)}}multiLineStringToTF(t){for(var e=t.components,r=0;r<e.length;r++){var s=e[r];this.lineToTF(s)}}multiPolygonToTF(t){for(var e=t.components,r=0;r<e.length;r++){var s=e[r];this.polygonToTF(s)}}pointToTF(t){var e=this.location,r=this.getLocalXY(t),s=new Object;s.r=6,(s=v.copyAttributesWithClip(s,this.style)).x=r[0]-e[0],s.y=r[1]-e[1];var i=new Qp({style:s,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(i.highlightStyle=this.highlightStyle),i.refOriginalPosition=e,i.refDataID=this.data.id,i.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&v.copyAttributesWithClip(i,this.shapeOptions),this.shapes.push(i)}polygonToTF(t){for(var e=t.components,r=[],s=[],i=this.location,n=[],a=[],o=[],l=this.nodesClipPixel,h=0;h<e.length;h++){var u=e[h].components;if(0===h){n=[];for(var c=0;c<u.length;c++){if(s=[],r=this.getLocalXY(u[c]),s[0]=r[0]-i[0],s[1]=r[1]-i[1],n.length>0){var d=n[n.length-1];if(Math.abs(d[0]-s[0])<=l&&Math.abs(d[1]-s[1])<=l)continue}n.push(s)}}else{a=[];for(var p=0;p<u.length;p++){if(s=[],r=this.getLocalXY(u[p]),s[0]=r[0]-i[0],s[1]=r[1]-i[1],a.length>0){var f=a[a.length-1];if(Math.abs(f[0]-s[0])<=l&&Math.abs(f[1]-s[1])<=l)continue}a.push(s)}}a.length<2||o.push(a)}if(!(n.length<2)){var m={};(m=v.copyAttributesWithClip(m,this.style,["pointList"])).pointList=n;var y=new Zp({style:m,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(y.highlightStyle=this.highlightStyle),y.refOriginalPosition=this.location,y.refDataID=this.data.id,y.isHoverByRefDataID=this.isMultiHover,o.length>0&&(y.holePolygonPointLists=o),this.shapeOptions&&v.copyAttributesWithClip(y,this.shapeOptions),this.shapes.push(y)}}rectangleToTF(t){var e=this.location,r=new _(t.x,t.y),s=this.layer.map.getResolution(),i=this.getLocalXY(r),n=new Object;n.r=6,(n=v.copyAttributesWithClip(n,this.style)).x=i[0]-e[0],n.y=i[1]-e[1]-2*t.width/s,n.width=t.width/s,n.height=t.height/s;var a=new tf({style:n,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(a.highlightStyle=this.highlightStyle),a.refOriginalPosition=e,a.refDataID=this.data.id,a.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&v.copyAttributesWithClip(a,this.shapeOptions),this.shapes.push(a)}geoTextToTF(t){var e=this.location,r=this.getLocalXY(t),s=new Object;s.r=6,(s=v.copyAttributesWithClip(s,this.style,["x","y","text"])).x=r[0]-e[0],s.y=r[1]-e[1],s.text=t.text;var i=new Yp({style:s,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(i.highlightStyle=this.highlightStyle),i.refOriginalPosition=e,i.refDataID=this.data.id,i.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&v.copyAttributesWithClip(i,this.shapeOptions),this.shapes.push(i)}updateAndAddShapes(){var t=this.getLocalXY(this.lonlat);this.location=t;for(var e=this.layer.renderer,r=0,s=this.shapes.length;r<s;r++){var i=this.shapes[r];i.refOriginalPosition=t,e.addShape(i)}}getShapesCount(){return this.shapes.length}getLocalXY(t){return this.layer.getLocalXY(t)}},Od.Feature.ShapeParameters=Ip,Od.Feature.ShapeParameters.Circle=jp,Od.Feature.ShapeParameters.Image=Gp,Od.Feature.ShapeParameters.Label=Bp,Od.Feature.ShapeParameters.Line=kp,Od.Feature.ShapeParameters.Point=Np,Od.Feature.ShapeParameters.Polygon=Rp,Od.Feature.ShapeParameters.Rectangle=Dp,Od.Feature.ShapeParameters.Sector=Fp,Od.Feature.ShapeFactory=rf,Od.LevelRenderer=gf,Od.KeyServiceParameter=class{constructor(t){this.name=null,this.serviceIds=null,this.clientType=yt.SERVER,this.limitation=null,v.extend(this,t),this.CLASS_NAME="SuperMap.KeyServiceParameter"}toJSON(){return{name:this.name,serviceIds:this.serviceIds,clientType:this.clientType,limitation:this.limitation}}},Od.SecurityManager=Ht,Od.ServerInfo=class{constructor(t,e){this.type=t,this.server=null,this.tokenServiceUrl=null,this.keyServiceUrl=null,v.extend(this,e),this.CLASS_NAME="SuperMap.ServerInfo",this.type=this.type||J.ISERVER,this.server||console.error("server url require is not  undefined");var r="/services/security/tokens";this.type===J.ISERVER&&this.server.indexOf("iserver")<0&&(r="/iserver"+r),this.tokenServiceUrl||(this.tokenServiceUrl=v.urlPathAppend(this.server,r)),this.keyServiceUrl||(this.type===J.IPORTAL?this.keyServiceUrl=v.urlPathAppend(this.server,"/web/mycontent/keys/register"):this.type===J.ONLINE&&(this.keyServiceUrl=v.urlPathAppend(this.server,"/web/mycontent/keys")))}},Od.TokenServiceParameter=class{constructor(t){this.userName=null,this.password=null,this.clientType=yt.NONE,this.ip=null,this.referer=null,this.expiration=60,v.extend(this,t),this.CLASS_NAME="SuperMap.TokenServiceParameter"}toJSON(){return{userName:this.userName,password:this.password,clientType:this.clientType,ip:this.ip,referer:this.referer,expiration:this.expiration}}},Od.ThemeStyle=class{constructor(t){t=t||{},this.fill=!0,this.fillColor="#000000",this.fillOpacity=1,this.stroke=!1,this.strokeColor="#000000",this.strokeOpacity=1,this.strokeWidth=1,this.strokeLinecap="butt",this.strokeLineJoin="miter",this.strokeDashstyle="solid",this.pointRadius=6,this.shadowBlur=0,this.shadowColor="#000000",this.shadowOffsetX=0,this.shadowOffsetY=0,this.label="",this.labelRect=!1,this.fontColor="",this.fontSize=12,this.fontStyle="normal",this.fontVariant="normal",this.fontWeight="normal",this.fontFamily="arial,sans-serif",this.labelPosition="top",this.labelAlign="center",this.labelBaseline="middle",this.labelXOffset=0,this.labelYOffset=0,v.extend(this,t)}},Od.CartoCSS=Pp,Od.ElasticSearch=class{constructor(t,e,r){if(!e||"function"!=typeof e&&"object"!=typeof e||"function"!=typeof e.Client)throw Error("Please enter the global variable of @elastic/elasticsearch@5.6.22 or elasticsearch@16.7.3 for the second parameter!");r=r||{},this.url=t;try{this.client=new e.Client({host:this.url})}catch(t){this.client=new e.Client({node:{url:new URL(this.url)}})}this.change=null,this.openGeoFence=!1,this.outOfGeoFence=null,this.geoFence=null,this.EVENT_TYPES=["change","error","outOfGeoFence"],this.events=new qt(this,null,this.EVENT_TYPES),this.eventListeners=null,v.extend(this,r),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}setGeoFence(t){this.geoFence=t}bulk(t,e){return this.client.bulk(t,this._handleCallback(e))}clearScroll(t,e){return this.client.clearScroll(t,this._handleCallback(e))}count(t,e){return this.client.count(t,this._handleCallback(e))}create(t,e){return this.client.create(t,this._handleCallback(e))}delete(t,e){return this.client.delete(t,this._handleCallback(e))}deleteByQuery(t,e){return this.client.deleteByQuery(t,this._handleCallback(e))}deleteScript(t,e){return this.client.deleteScript(t,this._handleCallback(e))}deleteTemplate(t,e){return this.client.deleteTemplate(t,this._handleCallback(e))}exists(t,e){return this.client.exists(t,this._handleCallback(e))}existsSource(t,e){return this.client.existsSource(t,this._handleCallback(e))}explain(t,e){return this.client.explain(t,this._handleCallback(e))}fieldCaps(t,e){return this.client.fieldCaps(t,this._handleCallback(e))}get(t,e){return this.client.get(t,this._handleCallback(e))}getScript(t,e){return this.client.getScript(t,this._handleCallback(e))}getSource(t,e){return this.client.getSource(t,this._handleCallback(e))}getTemplate(t,e){return this.client.getTemplate(t,this._handleCallback(e))}index(t,e){return this.client.index(t,this._handleCallback(e))}info(t,e){return this.client.info(t,this._handleCallback(e))}mget(t,e){return this.client.mget(t,this._handleCallback(e))}msearch(t,e){let r=this;return r.client.msearch(t).then(function(t){return t=t.body||t,r._update(t.responses,e),t},function(t){return e(t),r.events.triggerEvent("error",{error:t}),t})}msearchTemplate(t,e){return this.client.msearchTemplate(t,this._handleCallback(e))}mtermvectors(t,e){return this.client.mtermvectors(t,this._handleCallback(e))}ping(t,e){return this.client.ping(t,this._handleCallback(e))}putScript(t,e){return this.client.putScript(t,this._handleCallback(e))}putTemplate(t,e){return this.client.putTemplate(t,this._handleCallback(e))}reindex(t,e){return this.client.reindex(t,this._handleCallback(e))}reindexRessrottle(t,e){return this.client.reindexRessrottle(t,this._handleCallback(e))}renderSearchTemplate(t,e){return this.client.renderSearchTemplate(t,this._handleCallback(e))}scroll(t,e){return this.client.scroll(t,this._handleCallback(e))}search(t,e){let r=this;return r.client.search(t).then(function(t){return t=t.body||t,r._update(t,e),t},function(t){return e&&e(t),r.events.triggerEvent("error",{error:t}),t})}searchShards(t,e){return this.client.searchShards(t,this._handleCallback(e))}searchTemplate(t,e){return this.client.searchTemplate(t,this._handleCallback(e))}suggest(t,e){return this.client.suggest(t,this._handleCallback(e))}termvectors(t,e){return this.client.termvectors(t,this._handleCallback(e))}update(t,e){return this.client.update(t,this._handleCallback(e))}updateByQuery(t,e){return this.client.updateByQuery(t,this._handleCallback(e))}_handleCallback(t){return function(){let e=Array.from(arguments);const r=e.shift();let s=e.shift();const i=s&&s.body;if(i){const{statusCode:t,headers:r}=s;e=[t,r],s=i}t.call(this,r,s,...e)}}_update(t,e){let r=this;t&&(r.data=t,r.openGeoFence&&r.geoFence&&r._validateDatas(t),r.events.triggerEvent("change",{data:r.data}),r.change?r.change&&r.change(t):e&&e(void 0,{responses:t}))}_validateDatas(t){if(t){t instanceof Array||(t=[t]);var e,r=t.length;for(e=0;e<r;e++)this._validateData(t[e])}}_validateData(t){let e=this;t.hits.hits.map(function(r){let s=r._source,i=e._getMeterPerMapUnit(e.geoFence.unit),n=e.geoFence.center[0]*i,a=e.geoFence.center[1]*i,o=s.x*i,l=s.y*i;return e._distance(o,l,n,a)>e.geoFence.radius&&(e.outOfGeoFence&&e.outOfGeoFence(t),e.events.triggerEvent("outOfGeoFence",{data:t})),r})}_distance(t,e,r,s){return Math.sqrt((t-r)*(t-r)+(e-s)*(e-s))}_getMeterPerMapUnit(t){let e;return"meter"===t?e=1:"degree"===t&&(e=2*Math.PI*6378137/360),e}},Od.ArrayStatistic=class{static newInstance(){return this.geostatsInstance||(this.geostatsInstance=new window.geostats),this.geostatsInstance}static getInstance(t){let e=this.newInstance();return e.setSerie(t),e}static getArrayStatistic(t,e){return t.length?"Sum"===e||"æ±å"===e?this.getSum(t):"Maximum"===e||"æå¤§å¼"===e?this.getMax(t):"Minimum"===e||"æå°å¼"===e?this.getMin(t):"Average"===e||"å¹³åå¼"===e?this.getMean(t):"Median"===e||"ä¸­ä½æ°"===e?this.getMedian(t):"times"===e||"è®¡æ°"===e?this.getTimes(t):void 0:0}static getArraySegments(t,e,r){return"offset"===e?this.getEqInterval(t,r):"jenks"===e?this.getJenks(t,r):"square"===e?this.getMin(t)>=0&&this.getSqrtInterval(t,r):"logarithm"===e?this.getMin(t)>0&&this.getGeometricProgression(t,r):void 0}static getSum(t){return this.getInstance(t).sum()}static getMax(t){return this.getInstance(t).max()}static getMin(t){return this.getInstance(t).min()}static getMean(t){return this.getInstance(t).mean()}static getMedian(t){return this.getInstance(t).median()}static getTimes(t){return t.length}static getEqInterval(t,e){return this.getInstance(t).getClassEqInterval(e)}static getJenks(t,e){return this.getInstance(t).getClassJenks(e)}static getSqrtInterval(t,e){return t=t.map(function(t){return Math.sqrt(t)}),this.getInstance(t).getClassEqInterval(e).map(function(t){return t*t})}static getGeometricProgression(t,e){return this.getInstance(t).getClassGeometricProgression(e)}},Od.ColorsPickerUtil=class{static createCanvas(t,e){var r=document.createElement("canvas");return r.height=t,r.width=e,r.getContext("2d")}static getLinearGradient(t,e,r,s,i){this._ctx||(this._ctx=this.getContext());for(var n=this._ctx.createLinearGradient(t,e,r,s),a=i.length,o=1/(a-1),l=0,h=0;h<a;h++)n.addColorStop(l,i[h]),l+=o;return n.__nonRecursion=!0,n}static getContext(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx}static getStepColors(t,e,r){t=Ep.toRGBA(t),e=Ep.toRGBA(e),t=Ep.getData(t);for(var s=[],i=((e=Ep.getData(e))[0]-t[0])/r,n=(e[1]-t[1])/r,a=(e[2]-t[2])/r,o=(e[3]-t[3])/r,l=0,h=t[0],u=t[1],c=t[2],d=t[3];l<r;l++)s[l]=Ep.toColor([Ep.adjust(Math.floor(h),[0,255]),Ep.adjust(Math.floor(u),[0,255]),Ep.adjust(Math.floor(c),[0,255]),d.toFixed(4)-0],"hex"),h+=i,u+=n,c+=a,d+=o;return h=e[0],u=e[1],c=e[2],d=e[3],s[l]=Ep.toColor([h,u,c,d],"hex"),s}static getGradientColors(t,e,r){var s,i,n,a=[],o=t.length;if(void 0!==e){if(o>=e)if("RANGE"===r)for(i=0;i<e;i++)a.push(t[i]);else for(i=0;i<e;i++){let e=Math.floor(i/2);if(i%2==0)a.push(t[e]);else{let r=t.length-1-e;a.push(t[r])}}else{for(s=Math.ceil(e/(o-1)),i=0,n=o-1;i<n;i++){var l=this.getStepColors(t[i],t[i+1],s);i<n-1&&l.pop(),a=a.concat(l)}for(var h=a.length-e,u=0;u<h;u++)a.splice(2,1)}return a}}},Od.DataFormat=U,Od.ServerType=J,Od.GeometryType=z,Od.QueryOption=q,Od.JoinType={INNERJOIN:"INNERJOIN",LEFTJOIN:"LEFTJOIN"},Od.SpatialQueryMode=V,Od.SpatialRelationType={CONTAIN:"CONTAIN",INTERSECT:"INTERSECT",WITHIN:"WITHIN"},Od.MeasureMode=H,Od.Unit=W,Od.BufferRadiusUnit=Q,Od.EngineType={IMAGEPLUGINS:"IMAGEPLUGINS",OGC:"OGC",ORACLEPLUS:"ORACLEPLUS",SDBPLUS:"SDBPLUS",SQLPLUS:"SQLPLUS",UDB:"UDB"},Od.ThemeGraphTextFormat=Y,Od.ThemeGraphType=X,Od.GraphAxesTextDisplayMode=Z,Od.GraduatedMode=K,Od.RangeMode=$,Od.ThemeType={DOTDENSITY:"DOTDENSITY",GRADUATEDSYMBOL:"GRADUATEDSYMBOL",GRAPH:"GRAPH",LABEL:"LABEL",RANGE:"RANGE",UNIQUE:"UNIQUE"},Od.ColorGradientType=tt,Od.TextAlignment=et,Od.FillGradientMode={NONE:"NONE",LINEAR:"LINEAR",RADIAL:"RADIAL",CONICAL:"CONICAL",SQUARE:"SQUARE"},Od.AlongLineDirection=rt,Od.LabelBackShape=st,Od.LabelOverLengthMode=it,Od.DirectionType={EAST:"EAST",NONE:"NONE",NORTH:"NORTH",SOURTH:"SOURTH",WEST:"WEST"},Od.OverlayOperationType=at,Od.OutputType=ot,Od.SideType={LEFT:"LEFT",MIDDLE:"MIDDLE",NONE:"NONE",RIGHT:"RIGHT"},Od.SupplyCenterType={FIXEDCENTER:"FIXEDCENTER",NULL:"NULL",OPTIONALCENTER:"OPTIONALCENTER"},Od.TurnType={AHEAD:"AHEAD",BACK:"BACK",END:"END",LEFT:"LEFT",NONE:"NONE",RIGHT:"RIGHT"},Od.BufferEndType=nt,Od.SmoothMethod=lt,Od.SurfaceAnalystMethod=ht,Od.DataReturnMode=ut,Od.EditType=ct,Od.TransferTactic=dt,Od.TransferPreference=pt,Od.GridType={CROSS:"CROSS",GRID:"GRID",POINT:"POINT"},Od.ColorSpaceType={CMYK:"CMYK",RGB:"RGB"},Od.LayerType={UGC:"UGC",WMS:"WMS",WFS:"WFS",CUSTOM:"CUSTOM"},Od.UGCLayerType={THEME:"THEME",VECTOR:"VECTOR",GRID:"GRID",IMAGE:"IMAGE"},Od.StatisticMode={AVERAGE:"AVERAGE",MAX:"MAX",MIN:"MIN",STDDEVIATION:"STDDEVIATION",SUM:"SUM",VARIANCE:"VARIANCE"},Od.PixelFormat={BIT16:"BIT16",BIT32:"BIT32",BIT64:"BIT64",SINGLE:"SINGLE",DOUBLE:"DOUBLE",UBIT1:"UBIT1",UBIT4:"UBIT4",UBIT8:"UBIT8",UBIT24:"UBIT24",UBIT32:"UBIT32"},Od.SearchMode={KDTREE_FIXED_COUNT:"KDTREE_FIXED_COUNT",KDTREE_FIXED_RADIUS:"KDTREE_FIXED_RADIUS",NONE:"NONE",QUADTREE:"QUADTREE"},Od.InterpolationAlgorithmType={KRIGING:"KRIGING",SimpleKriging:"SimpleKriging",UniversalKriging:"UniversalKriging"},Od.VariogramMode=ft,Od.Exponent=mt,Od.ClientType=yt,Od.ChartType={BAR:"Bar",BAR3D:"Bar3D",CIRCLE:"Circle",PIE:"Pie",POINT:"Point",LINE:"Line",RING:"Ring"},Od.ClipAnalystMode=gt,Od.AnalystAreaUnit=vt,Od.AnalystSizeUnit=bt,Od.StatisticAnalystMode=St,Od.SummaryType=_t,Od.TopologyValidatorRule=xt,Od.BucketAggType=wt,Od.MetricsAggType=At,Od.GetFeatureMode={BOUNDS:"BOUNDS",BUFFER:"BUFFER",ID:"ID",SPATIAL:"SPATIAL",SQL:"SQL"},Od.RasterFunctionType=Mt,Od.ResourceType={MAP:"MAP",SERVICE:"SERVICE",SCENE:"SCENE",DATA:"DATA",INSIGHTS_WORKSPACE:"INSIGHTS_WORKSPACE",MAP_DASHBOARD:"MAP_DASHBOARD"},Od.OrderBy={UPDATETIME:"UPDATETIME",HEATLEVEL:"HEATLEVEL",RELEVANCE:"RELEVANCE"},Od.OrderType={ASC:"ASC",DESC:"DESC"},Od.SearchType={PUBLIC:"PUBLIC",MY_RES:"MY_RES",MYGROUP_RES:"MYGROUP_RES",MYDEPARTMENT_RES:"MYDEPARTMENT_RES",SHARETOME_RES:"SHARETOME_RES"},Od.AggregationTypes={TAG:"TAG",TYPE:"TYPE"},Od.PermissionType={SEARCH:"SEARCH",READ:"READ",READWRITE:"READWRITE",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD"},Od.EntityType={DEPARTMENT:"DEPARTMENT",GROUP:"GROUP",IPORTALGROUP:"IPORTALGROUP",ROLE:"ROLE",USER:"USER"},Od.WebExportFormatType={PNG:"PNG",PDF:"PDF"},Od.WebScaleOrientationType={HORIZONTALLABELSBELOW:"HORIZONTALLABELSBELOW",HORIZONTALLABELSABOVE:"HORIZONTALLABELSABOVE",VERTICALLABELSLEFT:"VERTICALLABELSLEFT",VERTICALLABELSRIGHT:"VERTICALLABELSRIGHT"},Od.WebScaleType={LINE:"LINE",BAR:"BAR",BAR_SUB:"BAR_SUB"},Od.WebScaleUnit={METER:"METER",FOOT:"FOOT",DEGREES:"DEGREES"},Od.KnowledgeGraph=Mn,Od.BoundsType=Ct,Od.CellSizeType=Et,e().supermap={...Od,...e().supermap},e().supermap.Graphic=class{constructor(t,e,r){this.lngLat=It.isArray(t)?{lng:t[0],lat:t[1]}:t,this.style=It.extend({},e),this.attributes=r}getId(){return this.id}setId(t){this.id=t}getLngLat(){return this.lngLat}setLngLat(t){this.lngLat=It.isArray(t)?{lng:t[0],lat:t[1]}:t}setStyle(t){this.style=It.extend(this.style,t)}getStyle(){return this.style}setAttributes(t){this.attributes=It.extend({},this.attributes,t)}getAttributes(){return this.attributes}},e().supermap.Transform=Dn,e().supermap.AddressMatchService=class extends Nt{constructor(t,e){super(t,e),this._addressMatchService=new Xt(t,e)}code(t,e){return this._addressMatchService.code(v.urlPathAppend(this.url,"geocoding"),t,e)}decode(t,e){return this._addressMatchService.decode(v.urlPathAppend(this.url,"geodecoding"),t,e)}},e().supermap.ChartService=class extends Nt{constructor(t,e){super(t,e),this._chartService=new re(t,e)}queryChart(t,e,r){return this._chartService.queryChart(t,e,r)}getChartFeatureInfo(t){return this._chartService.getChartFeatureInfo(t)}_processFormat(t){return t||U.GEOJSON}},e().supermap.DataFlowService=class extends Nt{constructor(t,e){(e=e||{}).projection&&(e.prjCoordSys=e.projection),super(t,e),this.dataFlow=new se(t,e),this.dataFlow.events.on({broadcastSocketConnected:this._defaultEvent,broadcastSocketError:this._defaultEvent,broadcastFailed:this._defaultEvent,broadcastSucceeded:this._defaultEvent,subscribeSocketConnected:this._defaultEvent,subscribeSocketError:this._defaultEvent,messageSucceeded:this._defaultEvent,setFilterParamSucceeded:this._defaultEvent,scope:this});var r=this;r.on("subscribeSocketConnected",function(t){r.fire("subscribesucceeded",t)})}initBroadcast(){return this.dataFlow.initBroadcast(),this}broadcast(t){this.dataFlow.broadcast(t)}initSubscribe(){return this.dataFlow.initSubscribe(),this}setExcludeField(t){return this.dataFlow.setExcludeField(t),this.options.excludeField=t,this}setGeometry(t){return this.dataFlow.setGeometry(t),this.options.geometry=t,this}unSubscribe(){this.dataFlow.unSubscribe()}unBroadcast(){this.dataFlow.unBroadcast()}_defaultEvent(t){this.fire(t.eventType||t.type,t)}},e().supermap.DatasetService=class extends Nt{constructor(t,e){super(t,e),this._datasetService=new ie(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})}getDatasets(t,e){if(t)return this._datasetService.getDatasetsService(t,e)}getDataset(t,e,r){if(t&&e)return this._datasetService.getDatasetService(t,e,r)}setDataset(t,e){if(t instanceof ne||t instanceof ae){if(t instanceof ne)var r={datasetType:t.datasetType,datasetName:t.datasetName,datasourceName:t.datasourceName};else t instanceof ae&&(r={datasetName:t.datasetName,datasourceName:t.datasourceName,isFileCache:t.isFileCache,description:t.description,prjCoordSys:t.prjCoordSys,charset:t.charset});return this._datasetService.setDatasetService(r,e)}}deleteDataset(t,e,r){return this._datasetService.deleteDatasetService(t,e,r)}},e().supermap.DatasourceService=class extends Nt{constructor(t,e){super(t,e),this._datasourceService=new le(this.url,{proxy:this.proxy,withCredentials:this.withCredentials,crossOrigin:this.crossOrigin,headers:this.headers})}getDatasources(t){return this._datasourceService.getDatasourcesService(t)}getDatasource(t,e){if(t)return this._datasourceService.getDatasourceService(t,e)}setDatasource(t,e){if(!(t instanceof oe))return;const r={description:t.description,coordUnit:t.coordUnit,distanceUnit:t.distanceUnit,datasourceName:t.datasourceName};return this._datasourceService.setDatasourceService(r,e)}},e().supermap.FeatureService=class extends Nt{constructor(t,e){super(t,e),this._featureService=new Ae(t,e)}getFeaturesByIDs(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByIDs(t,e,r)}getFeaturesByBounds(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByBounds(t,e,r)}getFeaturesByBuffer(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByBuffer(t,e,r)}getFeaturesBySQL(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesBySQL(t,e,r)}getFeaturesByGeometry(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByGeometry(t,e,r)}editFeatures(t,e){if(!t||!t.dataSourceName||!t.dataSetName)return;let r=this,s=r.url,i=t.dataSourceName,n=t.dataSetName;return s=v.urlPathAppend(s,"datasources/"+i+"/datasets/"+n),new ue(s,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(r._processParams(t),e)}getMetadata(t,e){return this._featureService.getMetadata(t,e)}_processParams(t){if(!t)return{};let r=this;if(t.returnContent=null==t.returnContent||t.returnContent,t.fromIndex=t.fromIndex?t.fromIndex:0,t.toIndex=0===t.toIndex?0:t.toIndex?t.toIndex:-1,t.bounds&&(t.bounds=It.toSuperMapBounds(t.bounds)),t.editType&&(t.editType=t.editType.toLowerCase()),t.geometry&&(t.geometry instanceof e().LngLatBounds?(t.geometry=It.toSuperMapPolygon(t.geometry),t.geometry.SRID=4326):t.geometry instanceof e().Point?t.geometry=new w(t.geometry.x,t.geometry.y):t.geometry instanceof e().LngLat?(t.geometry=new w(t.geometry.lng,t.geometry.lat),t.geometry.SRID=4326):t.geometry instanceof d||(t.geometry=It.toSuperMapGeometry(t.geometry))),t.features){let e=[];It.isArray(t.features)?t.features.map(function(t){return e.push(r._createServerFeature(t)),e}):e.push(r._createServerFeature(t.features)),t.features=e}return t}_createServerFeature(t){let e={},r=[],s=[],i=t.properties;for(let t in i)r.push(t),s.push(i[t]);return e.fieldNames=r,e.fieldValues=s,t.id&&(e.id=t.id),e.geometry=It.toSuperMapGeometry(t),e}},e().supermap.FieldService=class extends Nt{constructor(t,e){super(t,e),this._fieldService=new Oe(t,e)}getFields(t,e){return this._fieldService.getFields(t,e)}getFieldStatisticsInfo(t,e){return this._fieldService.getFieldStatisticsInfo(t,e)}},e().supermap.GeoprocessingService=class extends Nt{constructor(t,e){super(t,e),this.headers={},this.crossOrigin=!0,this.withCredentials=!0,this.proxy=!0,this._geoprocessingJobsService=new Ie(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})}getTools(t){return this._geoprocessingJobsService.getTools(t)}getTool(t,e){return this._geoprocessingJobsService.getTool(t,e)}execute(t,e,r,s){return this._geoprocessingJobsService.execute(t,e,r,s)}submitJob(t,e,r,s){return this._geoprocessingJobsService.submitJob(t,e,r,s)}waitForJobCompletion(t,e,r,s){return this._geoprocessingJobsService.waitForJobCompletion(t,e,r,s)}getJobInfo(t,e,r){return this._geoprocessingJobsService.getJobInfo(t,e,r)}cancelJob(t,e,r){return this._geoprocessingJobsService.cancelJob(t,e,r)}getJobs(t,e){return this._geoprocessingJobsService.getJobs(t,e)}getResults(t,e,r,s){return this._geoprocessingJobsService.getResults(t,e,r,s)}},e().supermap.GridCellInfosService=class extends Nt{constructor(t,e){super(t,e),this._gridCellQueryService=new Le(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})}getGridCellInfos(t,e){return t?this._gridCellQueryService.processAsync(t,e):null}},e().supermap.ImageCollectionService=class extends Nt{constructor(t,e){super(t,e),this._imageCollectionService=new rn(this.url,{collectionId:this.options.collectionId,proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})}getLegend(t,e){return this._imageCollectionService.getLegend(t,e)}getStatistics(t){return this._imageCollectionService.getStatistics(t)}getTileInfo(t){return this._imageCollectionService.getTileInfo(t)}deleteItemByID(t,e){return this._imageCollectionService.deleteItemByID(t,e)}getItemByID(t,e){return this._imageCollectionService.getItemByID(t,e)}},e().supermap.ImageService=class extends Nt{constructor(t,e){super(t,e),this._imageService=new en(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})}getCollections(t){return this._imageService.getCollections(t)}getCollectionByID(t,e){return this._imageService.getCollectionByID(t,e)}search(t,e){return this._imageService.search(t,e)}},e().supermap.LayerInfoService=class extends Nt{constructor(t,e){super(t,e),this._layerInfoService=new yr(t,e)}getLayersInfo(t){return this._layerInfoService.getLayersInfo(t)}getLayersLegendInfo(t,e){return this._layerInfoService.getLayersLegendInfo(t,e)}setLayerInfo(t,e){return this._layerInfoService.setLayerInfo(t,e)}setLayersInfo(t,e){return this._layerInfoService.setLayersInfo(t,e)}setLayerStatus(t,e){return this._layerInfoService.setLayerStatus(t,e)}},e().supermap.MapService=br,e().supermap.MeasureService=class extends Nt{constructor(t,e){super(t,e)}measureDistance(t,e){return this.measure(t,"DISTANCE",e)}measureArea(t,e){return this.measure(t,"AREA",e)}measure(t,e,r){var s=this;return new _r(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,measureMode:e}).processAsync(s._processParam(t),r)}_processParam(t){return!t||t.geometry instanceof d||(t.geometry=It.toSuperMapGeometry(t.geometry)),t}},e().supermap.NetworkAnalyst3DService=class extends Nt{constructor(t,e){super(t,e),this._networkAnalyst3DService=new hs(t,e)}sinksFacilityAnalyst(t,e){return this._networkAnalyst3DService.sinksFacilityAnalyst(t,e)}sourcesFacilityAnalyst(t,e){return this._networkAnalyst3DService.sourcesFacilityAnalyst(t,e)}traceUpFacilityAnalyst(t,e){return this._networkAnalyst3DService.traceUpFacilityAnalyst(t,e)}traceDownFacilityAnalyst(t,e){return this._networkAnalyst3DService.traceDownFacilityAnalyst(t,e)}upstreamFacilityAnalyst(t,e){return this._networkAnalyst3DService.upstreamFacilityAnalyst(t,e)}},e().supermap.NetworkAnalystService=class extends Nt{constructor(t,e){super(t,e),this._networkAnalystService=new Zr(t,e)}burstPipelineAnalyst(t,e){return t=this._processParams(t),this._networkAnalystService.burstPipelineAnalyst(t,e)}computeWeightMatrix(t,e){return t=this._processParams(t),this._networkAnalystService.computeWeightMatrix(t,e)}findClosestFacilities(t,e,r){return t=this._processParams(t),this._networkAnalystService.findClosestFacilities(t,e,r)}traceAnalyst(t,e,r){return t=this._processParams(t),this._networkAnalystService.traceAnalyst(t,e,r)}connectedEdgesAnalyst(t,e,r){return t=this._processParams(t),this._networkAnalystService.connectedEdgesAnalyst(t,e,r)}streamFacilityAnalyst(t,e,r){return t=this._processParams(t),this._networkAnalystService.streamFacilityAnalyst(t,e,r)}findLocation(t,e,r){return t=this._processParams(t),this._networkAnalystService.findLocation(t,e,r)}findPath(t,e,r){return t=this._processParams(t),this._networkAnalystService.findPath(t,e,r)}findTSPPaths(t,e,r){return t=this._processParams(t),this._networkAnalystService.findTSPPaths(t,e,r)}findMTSPPaths(t,e,r){return t=this._processParams(t),this._networkAnalystService.findMTSPPaths(t,e,r)}findServiceAreas(t,e,r){return t=this._processParams(t),this._networkAnalystService.findServiceAreas(t,e,r)}updateEdgeWeight(t,e){return this._networkAnalystService.updateEdgeWeight(t,e)}updateTurnNodeWeight(t,e){return this._networkAnalystService.updateTurnNodeWeight(t,e)}_processParams(t){if(!t)return{};var r=this;if(t.centers&&It.isArray(t.centers)&&t.centers.map(function(e,s){return t.centers[s]=r._toPointObject(e),t.centers[s]}),t.nodes&&It.isArray(t.nodes)&&t.nodes.map(function(e,s){return t.nodes[s]=r._toPointObject(e),t.nodes[s]}),t.event&&(t.event=r._toPointObject(t.event)),t.facilities&&It.isArray(t.facilities)&&t.facilities.map(function(e,s){return t.facilities[s]=r._toPointObject(e),t.facilities[s]}),t.parameter&&t.parameter.barrierPoints){var s=t.parameter.barrierPoints;It.isArray(s)?s.map(function(e,s){return t.parameter[s]=r._toPointObject(e),t.parameter.barrierPoints[s]}):t.parameter.barrierPoints=[s instanceof e().LngLat?{x:s.lng,y:s.lat}:s]}return t}_toPointObject(t){return It.isArray(t)?{x:t[0],y:t[1]}:t instanceof e().LngLat?{x:t.lng,y:t.lat}:t instanceof e().Point?{x:t.x,y:t.y}:t}_processFormat(t){return t||U.GEOJSON}},e().supermap.ProcessingService=class extends Nt{constructor(t,e){super(t,e),this._processingService=new Is(t,e)}getKernelDensityJobs(t,e){return this._processingService.getKernelDensityJobs(t,e)}getKernelDensityJob(t,e,r){return this._processingService.getKernelDensityJob(t,e,r)}addKernelDensityJob(t,e,r,s){return t=this._processParams(t),this._processingService.addKernelDensityJob(t,e,r,s)}getKernelDensityJobState(t){return this._processingService.getKernelDensityJobState(t)}getSummaryMeshJobs(t,e){return this._processingService.getSummaryMeshJobs(t,e)}getSummaryMeshJob(t,e,r){return this._processingService.getSummaryMeshJob(t,e,r)}addSummaryMeshJob(t,e,r,s){return t=this._processParams(t),this._processingService.addSummaryMeshJob(t,e,r,s)}getSummaryMeshJobState(t){return this._processingService.getSummaryMeshJobState(t)}getQueryJobs(t,e){return this._processingService.getQueryJobs(t,e)}getQueryJob(t,e,r){return this._processingService.getQueryJob(t,e,r)}addQueryJob(t,e,r,s){return t=this._processParams(t),this._processingService.addQueryJob(t,e,r,s)}getQueryJobState(t){return this._processingService.getQueryJobState(t)}getSummaryRegionJobs(t,e){return this._processingService.getSummaryRegionJobs(t,e)}getSummaryRegionJob(t,e,r){return this._processingService.getSummaryRegionJob(t,e,r)}addSummaryRegionJob(t,e,r,s){return t=this._processParams(t),this._processingService.addSummaryRegionJob(t,e,r,s)}getSummaryRegionJobState(t){return this._processingService.getSummaryRegionJobState(t)}getVectorClipJobs(t,e){return this._processingService.getVectorClipJobs(t,e)}getVectorClipJob(t,e,r){return this._processingService.getVectorClipJob(t,e,r)}addVectorClipJob(t,e,r,s){return t=this._processParams(t),this._processingService.addVectorClipJob(t,e,r,s)}getVectorClipJobState(t){return this._processingService.getVectorClipJobState(t)}getOverlayGeoJobs(t,e){return this._processingService.getOverlayGeoJobs(t,e)}getOverlayGeoJob(t,e,r){return this._processingService.getOverlayGeoJob(t,e,r)}addOverlayGeoJob(t,e,r,s){return t=this._processParams(t),this._processingService.addOverlayGeoJob(t,e,r,s)}getoverlayGeoJobState(t){return this._processingService.getoverlayGeoJobState(t)}getBuffersJobs(t,e){return this._processingService.getBuffersJobs(t,e)}getBuffersJob(t,e,r){return this._processingService.getBuffersJob(t,e,r)}addBuffersJob(t,e,r,s){return t=this._processParams(t),this._processingService.addBuffersJob(t,e,r,s)}getBuffersJobState(t){return this._processingService.getBuffersJobState(t)}getTopologyValidatorJobs(t,e){return this._processingService.getTopologyValidatorJobs(t,e)}getTopologyValidatorJob(t,e,r){return this._processingService.getTopologyValidatorJob(t,e,r)}addTopologyValidatorJob(t,e,r,s){return t=this._processParams(t),this._processingService.addTopologyValidatorJob(t,e,r,s)}getTopologyValidatorJobState(t){return this._processingService.getTopologyValidatorJobState(t)}getSummaryAttributesJobs(t,e){return this._processingService.getSummaryAttributesJobs(t,e)}getSummaryAttributesJob(t,e,r){return this._processingService.getSummaryAttributesJob(t,e,r)}addSummaryAttributesJob(t,e,r,s){return t=this._processParams(t),this._processingService.addSummaryAttributesJob(t,e,r,s)}getSummaryAttributesJobState(t){return this._processingService.getSummaryAttributesJobState(t)}_processFormat(t){return t||U.GEOJSON}_processParams(t){return t?(t.bounds&&(t.bounds=It.toSuperMapBounds(t.bounds)),t.query&&(t.query=It.toSuperMapBounds(t.query)),t.geometryQuery&&(t.geometryQuery=It.toProcessingParam(t.geometryQuery)),t.geometryClip&&(t.geometryClip=It.toProcessingParam(t.geometryClip)),t):{}}},e().supermap.QueryService=class extends Nt{constructor(t,e){super(t,e),this._queryService=new Js(t,e)}queryByBounds(t,e,r){return t=this._processParams(t),this._queryService.queryByBounds(t,e,r)}queryByDistance(t,e,r){return t=this._processParams(t),this._queryService.queryByDistance(t,e,r)}queryBySQL(t,e,r){return t=this._processParams(t),this._queryService.queryBySQL(t,e,r)}queryByGeometry(t,e,r){return t=this._processParams(t),this._queryService.queryByGeometry(t,e,r)}_processParams(t){return t?(t.returnContent=null==t.returnContent||t.returnContent,t.queryParams&&!It.isArray(t.queryParams)&&(t.queryParams=[t.queryParams]),t.bounds&&(t.bounds instanceof Array&&(t.bounds=new x(t.bounds[0],t.bounds[1],t.bounds[2],t.bounds[3])),t.bounds instanceof e().LngLatBounds&&(t.bounds=new x(t.bounds.getSouthWest().lng,t.bounds.getSouthWest().lat,t.bounds.getNorthEast().lng,t.bounds.getNorthEast().lat))),t.geometry&&(t.geometry instanceof e().LngLat&&(t.geometry=new w(t.geometry.lng,t.geometry.lat)),t.geometry instanceof e().Point&&(t.geometry=new w(t.geometry.x,t.geometry.y)),t.geometry instanceof e().LngLatBounds&&(t.geometry=It.toSuperMapPolygon(t.geometry)),t.geometry instanceof d||(t.geometry=It.toSuperMapGeometry(t.geometry))),t):{}}},e().supermap.ServiceBase=Nt,e().supermap.SpatialAnalystService=class extends Nt{constructor(t,e){super(t,e),this._spatialAnalystService=new qi(t,e)}getAreaSolarRadiationResult(t,e,r){return this._spatialAnalystService.getAreaSolarRadiationResult(t,e,r)}bufferAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.bufferAnalysis(t,e,r)}densityAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.densityAnalysis(t,e,r)}generateSpatialData(t,e,r){return this._spatialAnalystService.generateSpatialData(t,e,r)}geoRelationAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.geoRelationAnalysis(t,e,r)}interpolationAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.interpolationAnalysis(t,e,r)}mathExpressionAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.mathExpressionAnalysis(t,e,r)}overlayAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.overlayAnalysis(t,e,r)}routeCalculateMeasure(t,e,r){return t=this._processParams(t),this._spatialAnalystService.routeCalculateMeasure(t,e,r)}routeLocate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.routeLocate(t,e,r)}surfaceAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.surfaceAnalysis(t,e,r)}terrainCurvatureCalculate(t,e,r){return this._spatialAnalystService.terrainCurvatureCalculate(t,e,r)}terrainCutFillCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainCutFillCalculate(t,e,r)}terrainAspectCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainAspectCalculate(t,e,r)}terrainSlopeCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainSlopeCalculate(t,e,r)}thiessenAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.thiessenAnalysis(t,e,r)}minDistanceAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.minDistanceAnalysis(t,e,r)}convexHullAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.convexHullAnalysis(t,e,r)}geometrybatchAnalysis(t,e,r){for(var s=0;s<t.length;s++)t[s].param=this._processParams(t[s].param);return this._spatialAnalystService.geometrybatchAnalysis(t,e,r)}_processParams(t){if(!t)return{};if(t.bounds&&(t.bounds=It.toSuperMapBounds(t.bounds)),t.inputPoints)for(var e=0;e<t.inputPoints.length;e++){var r=t.inputPoints[e];It.isArray(r)&&(t.inputPoints[e]={x:r[0],y:r[1],tag:r[2]})}if(t.points)for(let e=0;e<t.points.length;e++){var s=t.points[e];t.points[e]=It.toSuperMapPoint(s)}if(t.point&&(t.point=It.toSuperMapPoint(t.point)),t.extractRegion&&(t.extractRegion=It.toSuperMapGeometry(t.extractRegion)),t.extractParameter&&t.extractParameter.clipRegion&&(t.extractParameter.clipRegion=It.toSuperMapGeometry(t.extractParameter.clipRegion)),t.clipParam&&t.clipParam.clipRegion&&(t.clipParam.clipRegion=It.toSuperMapGeometry(t.clipParam.clipRegion)),t.clipRegion&&(t.clipRegion=It.toSuperMapGeometry(t.clipRegion)),t.sourceRoute&&t.sourceRoute){var i={type:"LINEM"};i.parts=[t.sourceRoute.geometry.coordinates.length],i.points=[];for(let e=0;e<t.sourceRoute.geometry.coordinates.length;e++){var n=t.sourceRoute.geometry.coordinates[e];i.points=i.points.concat({x:n[0],y:n[1],measure:n[2]})}t.sourceRoute=i}if(t.operateRegions&&It.isArray(t.operateRegions)&&t.operateRegions.map(function(e,r){return t.operateRegions[r]=It.toSuperMapGeometry(e),t.operateRegions[r]}),t.sourceGeometry){var a=null;t.sourceGeometrySRID&&(a=t.sourceGeometrySRID),t.sourceGeometry=It.toSuperMapGeometry(t.sourceGeometry),a&&(t.sourceGeometry.SRID=a),delete t.sourceGeometry.sourceGeometrySRID}if(t.operateGeometry&&(t.operateGeometry=It.toSuperMapGeometry(t.operateGeometry)),t.sourceGeometries){for(var o=[],l=0;l<t.sourceGeometries.length;l++)o.push(It.toSuperMapGeometry(t.sourceGeometries[l]));t.sourceGeometries=o}if(t.operateGeometries){for(var h=[],u=0;u<t.operateGeometries.length;u++)h.push(It.toSuperMapGeometry(t.operateGeometries[u]));t.operateGeometries=h}if(t.inputGeometries){for(var c=[],d=0;d<t.inputGeometries.length;d++)c.push(It.toSuperMapGeometry(t.inputGeometries[d]));t.inputGeometries=c}return t.sourceRoute&&t.sourceRoute.components&&It.isArray(t.sourceRoute.components)&&t.sourceRoute.components.map(function(e,r){return t.sourceRoute.components[r]=It.toSuperMapGeometry(e),t.sourceRoute.components[r]}),t}_processFormat(t){return t||U.GEOJSON}},e().supermap.ThemeService=class extends Nt{constructor(t,e){super(t,e),this._commonThemeService=new Hi(t,e)}getThemeInfo(t,e){return this._commonThemeService.processAsync(t,e)}},e().supermap.TrafficTransferAnalystService=class extends Nt{constructor(t,e){super(t,e),this._trafficTransferAnalystServiceBase=new $i(t,e)}queryStop(t,e){return this._trafficTransferAnalystServiceBase.queryStop(t,e)}analysisTransferPath(t,e){return this._trafficTransferAnalystServiceBase.analysisTransferPath(t,e)}analysisTransferSolution(t,e){return this._trafficTransferAnalystServiceBase.analysisTransferSolution(t,e)}_processParams(t){return t?(t.transferLines&&!It.isArray(t.transferLines)&&(t.transferLines=[t.transferLines]),t.points&&It.isArray(t.points)&&t.points.map(function(r,s){return t.points[s]=r instanceof e().LngLat?{x:r.lng,y:r.lat}:r,t.points[s]}),t):{}}},e().supermap.WebPrintingJobService=class extends Nt{constructor(t,e){super(t,e),this._webPrintingService=new tn(t,e)}createWebPrintingJob(t,e){if(t)return this._webPrintingService.createWebPrintingJob(this._processParams(t),e)}getPrintingJob(t,e){return this._webPrintingService.getPrintingJob(t,e)}getPrintingJobResult(t,e){return this._webPrintingService.getPrintingJobResult(t,e)}getLayoutTemplates(t){return this._webPrintingService.getLayoutTemplates(t)}_processParams(t){return t.layoutOptions&&t.layoutOptions.littleMapOptions&&(t.layoutOptions.littleMapOptions.center=this._toPointObject(t.layoutOptions.littleMapOptions.center)),t.exportOptions&&(t.exportOptions.center=this._toPointObject(t.exportOptions.center)),t}_toPointObject(t){return It.isArray(t)?{x:t[0],y:t[1]}:t instanceof w||t instanceof e().Point?{x:t.x,y:t.y}:t instanceof e().LngLat?{x:t.lng,y:t.lat}:t}},e().supermap.KnowledgeGraphService=nn,e().supermap.CommonUtil=v,e().supermap.Util=It,e().supermap.LogoControl=i,e().supermap.Logo=i,e().supermap.GraphMap=class extends e().Evented{constructor(t,e){super(t,e),this.graph=null,this.EVENT_TYPES=["loaded"];const r=t.split("/").pop();this.url=t.replace(`/graphmaps/${r}`,""),this.createGraphMap(r,e)}async createGraphMap(t,e){this.knowledgeGraphService=this.createKnowledgeGraphService(this.url,e);const r=await this.knowledgeGraphService.getGraphMapData(t),s=Mn.dataFromGraphMap(r.data,r.graphMap);this.graph=new Mn(e&&e.config),this.graph.on("afterlayout",()=>{this.fire(this.EVENT_TYPES[0])}),this.graph.setData(s),this.graph.handleNodeStatus(function(t){const{expand:e,collapse:r,hidden:s}=t.dataContent;return{expand:e&&JSON.parse(e),collapse:r&&JSON.parse(r),hidden:s&&JSON.parse(s)}}(r.graphMap))}createKnowledgeGraphService(t,e){return new nn(t,e)}},e().supermap.MapvLayer=class{constructor(t,e){this.id=e.layerID?e.layerID:v.createUniqueID("mapvLayer_"),delete e.layerID,this.options=e,this.dataSet=t,this.type="custom",this.isPitching=!1,this.pitchStartEvent=this._pitchStart.bind(this),this.pitchEndEvent=this._pitchEnd.bind(this),this.renderingMode="3d",this.context=this.options.context||"2d",this.overlay=!0}onAdd(t){this.map=t,this.mapContainer=t.getCanvasContainer(),this.renderer=new Tn(t,this.dataSet,this.options,{transferCoordinate:this._transferCoordinate,getCenterPixel:this._getCenterPixel,getResolution:this._getResolution,validZoom:this._validZoom.bind(this)},{id:this.id,targetElement:this.mapContainer,mapElement:this.map.getCanvas()}),this.mapContainer.style.perspective=this.map.transform.cameraToCenterDistance+"px",this._bindEvent()}onRemove(){this.renderer.destroy(),this._unbindEvent()}render(){this.map.isZooming()||this.map.isRotating()||this.isPitching?this.renderer.visible()&&this.renderer.hide():(!this.renderer.visible()&&this.renderer.show(),this.renderer.draw())}hide(){return this.renderer&&this.renderer.hide(),this}show(){return this.renderer&&this.renderer.show(),this}_validZoom(){return!(this.options.minZoom&&this.map.getZoom()<this.options.minZoom||this.options.maxZoom&&this.map.getZoom()>this.options.maxZoom)}_transferCoordinate(){let t=this.map;var r=t.getBounds(),s=r.getEast()-r.getWest(),i=r.getNorth()-r.getSouth(),n=s/this.map.getCanvas().getBoundingClientRect().width,a=i/this.map.getCanvas().getBoundingClientRect().height,o=t.getCenter(),l=t.project(o),h=this;return function(r){if(t.transform.rotationMatrix||"2d"===h.context){var s=t.project(new(e().LngLat)(r[0],r[1]));return[s.x,s.y]}var i=[(r[0]-o.lng)/n,(o.lat-r[1])/a];return[i[0]+l.x,i[1]+l.y]}}_getResolution(){var t=this.map.getBounds(),e=(t.getEast()-t.getWest())/this.map.getCanvas().getBoundingClientRect().width;return On("DEGREE")*e}_getCenterPixel(){return this.map.project(new(e().LngLat)(0,0))}getTopLeft(){var t,e=this.map;return e&&(t=e.getBounds().getNorthWest()),t}addData(t,e){this.renderer.addData(t,e)}update(t){this.renderer.update(t)}getData(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet}removeData(t){this.renderer&&this.renderer.removeData(t)}clearData(){this.renderer.clearData()}_bindEvent(){var t=this.map;t.on("pitchstart",this.pitchStartEvent),t.on("pitchend",this.pitchEndEvent),this.options.methods&&(this.options.methods.click&&t.on("click",this.renderer.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.renderer.mousemoveEvent))}_unbindEvent(){let t=this.map;t.off("pitchstart",this.pitchStartEvent),t.off("pitchend",this.pitchEndEvent),this.options.methods&&(this.options.methods.click&&t.off("click",this.renderer.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.renderer.mousemoveEvent))}setVisibility(t){t!==this.visibility&&(this.visibility=t,t?this.show():this.hide())}setZIndex(t){this.renderer.setZIndex(t)}_pitchStart(){this.isPitching=!0}_pitchEnd(){this.isPitching=!1}},e().supermap.ThreeLayer=class extends e().Evented{constructor(t,e,r){super(),this.id=t,this.options=r,this.type="custom",this.renderingMode="3d",this.overlay=!0;let s=r&&r.threeOptions;this.renderer=new Yn(this,e,s)}toThreeShape(t){return this.renderer.toThreeShape(t)}toThreeMesh(t,e,r,s){return this.renderer.toThreeMesh(t,e,r,s)}addObject(t,e){this.renderer&&this.renderer.addObject(t,e)}getScene(){return this.renderer.scene}getCamera(){return this.renderer.camera}getThreeRenderer(){return this.renderer.context}clearMesh(){return this.renderer.clearMesh(),this}clearAll(t){return this.renderer.clearAll(t),this}setPosition(t,e){return this.renderer.setPosition(t,e)}lngLatToPosition(t){return this.renderer.lngLatToPosition(t)}distanceToThreeVector3(t,e,r){let s=this._map,i=r||s.getCenter();return this.renderer.distanceToThreeVector3(t,e,i)}removeDuplicatedCoordinates(t){return this.renderer.removeDuplicatedCoordinates(t)}getCoordinatesCenter(t){return this.renderer.getCoordinatesCenter(t)}onAdd(t){var e=this;return e._map=t,e.renderer.setMap(t),e.renderer.render(),e.on("render",function(){this.context&&this.context.render(this.scene,this.camera)}.bind(e.renderer)),this}addTo(t){return t.addLayer(this),this}render(){this._update()}getCanvasContainer(){return this.renderer.getCanvasContainer()}getCanvas(){return this.renderer.getCanvas()}remove(){this.renderer.remove(),this._map=null}draw(){return this}renderScene(){return this.renderer.renderScene(),this.fire("renderscene"),this}_resize(){this.renderer.resize()}_update(){return this.renderScene(),this.fire("render"),this}},e().supermap.DeckglLayer=class extends Xn{constructor(t,e){super(t,e),this.type="custom",this.renderingMode="3d",this.overlay=!0}onAdd(t){if(this.map=t,this.canvas)return this.mapContainer=this.map.getCanvasContainer(),this;this._isEPSG3857()?(this.coordinateSystem=3,this.isGeographicCoordinateSystem=!0):(this.coordinateSystem=1,this.isGeographicCoordinateSystem=!1),this._initContainer(this.map.getCanvasContainer(),this.map.getCanvas()),this._createLayerByLayerTypeID();var e=this._getState();let r={};for(let t in e)r[t]=e[t];r.layers=[this.layer],r.canvas=this.canvas,this.deckGL=new window.DeckGL.experimental.DeckGLJS(r),this._draw()}onRemove(){this.map.getCanvasContainer().removeChild(this.canvas),this.clear()}getMapInfo(){let t=this.map.getCenter();return{center:t,zoom:this.map.getZoom(),maxZoom:this.map.getMaxZoom(),pitch:this.map.getPitch(),bearing:this.map.getBearing(),longitude:t.lng,latitude:t.lat}}render(){this._draw()}_isEPSG3857(){return this.map.getCRS&&this.map.getCRS()!==e().CRS.EPSG3857}},e().supermap.HeatMapLayer=class extends e().Evented{constructor(t,e){super();var r=e||{};this.options=r,this.name=t,this.id=r.id?r.id:v.createUniqueID("HeatMapLayer_"),this.loadWhileAnimating=void 0===r.loadWhileAnimating||r.loadWhileAnimating,this.features={},this.EVENT_TYPES=["featuresadded","featuresremoved","featuresdrawcompleted"],this.type="custom",this.renderingMode="3d",this.overlay=!0}onAdd(t){this.map=t;const e=this.map.getCanvasContainer(),r=this.map.getCanvas();this.renderer=new $n({id:this.id,...this.options,convertLatlonToPixel:this._convertLatlonToPixel.bind(this),targetElement:e,mapElement:r}),this.features.features&&this.features.features.length&&(this.renderer.setExtent(this.map.getBounds()),this.renderer.addFeatures(this.features))}onRemove(){this.removeAllFeatures(),this.renderer.removeFromMap(),this.features={},this.renderer=null}render(){this.refresh()}addFeatures(t){this.renderer?this.renderer.addFeatures(t):this.features=t,this.fire(this.EVENT_TYPES[0],{features:t,succeed:!0})}refresh(){this.map&&(this.renderer.setExtent(this.map.getBounds()),this.renderer.refresh())}setOpacity(t){t!==this.opacity&&(this.renderer.setOpacity(t),null!==this.map&&this.fire("changelayer",{layer:this,property:"opacity"}))}updateHeatPoints(t){this.renderer.updateHeatPoints(t)}getPixelXY(t){return this.renderer.getPixelXY(t)}removeFeatures(t){const e=this.renderer.removeFeatures(t);if(!e)return;const{heatPointsFailedRemoved:r,succeed:s}=e;this.fire(this.EVENT_TYPES[1],{features:r,succeed:s})}removeAllFeatures(){this.renderer.removeAllFeatures()}moveTo(t,e){var r=document.getElementById(this.renderer.rootCanvas.id);if(e=void 0===e||e){var s=document.getElementById(t);r&&s&&s.parentNode.insertBefore(r,s)}else{var i=document.getElementById(t);if(r){if(i.nextSibling)return void i.parentNode.insertBefore(r,i.nextSibling);i.parentNode.appendChild(r)}}}setVisibility(t){this.renderer.setVisibility(t)}_convertLatlonToPixel(t){return this.map.project(new(e().LngLat)(t.lon,t.lat))}},e().supermap.GraphicLayer=class{constructor(t,e){this.options=e,this.id=t||v.createUniqueID("graphicLayer_"),this.type="custom",this.renderingMode="3d",this.overlay=!0}addTo(t){return this.onAdd(t),this}onAdd(t){this.map=t,this.renderer=new ea(this.id,this.options,{getMapState:this.getMapState.bind(this)},{targetElement:this.map.getCanvasContainer(),mapElement:this.map.getCanvas()})}render(){this.renderer.draw()}setStyle(t){this.renderer&&this.renderer.setStyle(t)}setGraphics(t){this.renderer&&this.renderer.setGraphics(t)}addGraphics(t){this.renderer&&this.renderer.addGraphics(t)}getGraphicBy(t,e){return this.renderer&&this.renderer.getGraphicBy(t,e)}getGraphicById(t){return this.getGraphicBy("id",t)}getGraphicsByAttribute(t,e){return this.renderer&&this.renderer.getGraphicsByAttribute(t,e)}removeGraphics(t=null){this.renderer&&this.renderer.removeGraphics(t)}clear(){this.renderer&&this.renderer.clear()}remove(){this.renderer&&this.renderer.remove()}onRemove(){this.remove(),this.clear()}moveTo(t,e){this.renderer.moveTo(t,e)}setVisibility(t){this.renderer.setVisibility(t)}getState(){return this.renderer.getState()}getMapState(){let t={},r=this.map.getCenter(),s={longitude:r.lng,latitude:r.lat,zoom:this.map.getZoom(),maxZoom:this.map.getMaxZoom(),pitch:this.map.getPitch(),bearing:this.map.getBearing()};for(let e in s)t[e]=s[e];return this.map.getCRS&&this.map.getCRS()!==e().CRS.EPSG3857&&(t.coordinateSystem=this.coordinateSystem,t.isGeographicCoordinateSystem=this.isGeographicCoordinateSystem),t}},e().supermap.GraticuleLayer=class{constructor(t){this.id=t&&t.layerID?t.layerID:v.createUniqueID("graticuleLayer_"),this.sourceId=this.id+"_line",(t=t||{}).strokeStyle=Object.assign({},oa,t.strokeStyle||{}),t.lngLabelStyle=Object.assign({},aa,t.lngLabelStyle||{}),t.latLabelStyle=Object.assign({},aa,t.latLabelStyle||{}),this.options=Object.assign({},la,t),this.type="custom",this.renderingMode="3d",this.overlay=!0,this.styleDataEevent=this._setLayerTop.bind(this)}onAdd(t){this.map=t,this.renderer=new na(this.map,this.options,{getMapStateByKey:this.getMapStateByKey,getDefaultExtent:this.getDefaultExtent,updateGraticuleLayer:this.updateGraticuleLayer.bind(this),setVisibility:this.setVisibility.bind(this)},{mapElement:this.map.getCanvas(),targetElement:this.map.getCanvasContainer(),id:this.id}),this.addGraticuleLayer(),this.resizeEvent=this.renderer._resizeCallback.bind(this.renderer),this.zoomendEvent=this.setVisibility.bind(this),this._bindEvent()}render(){this.renderer.draw()}getMapStateByKey(t,e){return"getBearing"===t?this.map.getBearing():"getBounds"===t?this.map.getBounds():"project"===t?this.map.project(e):"unproject"===t?this.map.unproject(e):void 0}onRemove(){this.renderer.onRemove(),this._unbindEvent()}setVisibility(t){const e=this.map&&this.map.getZoom();this.options.visible="boolean"==typeof t?t:this.options.visible,this.visible="boolean"==typeof t?t:this.options.visible&&e>=this.options.minZoom&&e<=this.options.maxZoom,this.renderer&&(this.renderer.visible=this.visible),this.map.getLayer(this.sourceId)&&this.map.setLayoutProperty(this.sourceId,"visibility",this.visible?"visible":"none"),this.renderer&&this.renderer._drawLabel()}setMinZoom(t){this.options.minZoom=t,this.setVisibility()}setMaxZoom(t){this.options.maxZoom=t,this.setVisibility()}setShowLabel(t){this.options.showLabel=t,this.renderer._drawLabel()}setExtent(t){this.options.extent=this.getDefaultExtent(t,this.map),this.updateGraticuleLayer(),this.renderer._drawLabel()}setStrokeStyle(t){if(!this.map||!this.map.getLayer(this.sourceId))return;this.options.strokeStyle=t;const{layout:e,paint:r}=this.renderer._transformStrokeStyle(t);for(let t in e)this.map.setLayoutProperty(this.sourceId,t,e[t]);for(let t in r)this.map.setPaintProperty(this.sourceId,t,r[t])}setLngLabelStyle(t){this.options.lngLabelStyle=t,this.renderer._drawLabel()}setLatLabelStyle(t){this.options.latLabelStyle=t,this.renderer._drawLabel()}setIntervals(t){this.renderer&&this.renderer.setIntervals(t)}getDefaultExtent(t,r=this.map){const s=r.getCRS&&r.getCRS()||{};let{lngLatExtent:i}=s;if(i||(i=[-180,-85.05119,180,85.05119]),!t||0===t.length)return i;const{_sw:n,_ne:a}=e().LngLatBounds.convert(t);return t=[n.lng,n.lat,a.lng,a.lat],t=[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]}addGraticuleLayer(){if(!this.map.getSource(this.sourceId)){const t={type:"geojson",data:{type:"FeatureCollection",features:this.renderer.features}};this.map.addSource(this.sourceId,t)}if(!this.map.getLayer(this.sourceId)){const t=Object.assign({id:this.sourceId,type:"line",source:this.sourceId},this.renderer._transformStrokeStyle());this.map.addLayer(t)}}updateGraticuleLayer(t=this.features){if(this.map.getSource(this.sourceId)){const e={type:"FeatureCollection",features:t};this.map.getSource(this.sourceId).setData(e)}this.addGraticuleLayer()}_bindEvent(){this.map.on("styledata",this.styleDataEevent),this.map.on("resize",this.resizeEvent),this.map.on("zoomend",this.zoomendEvent)}_unbindEvent(){this.map.off("styledata",this.styleDataEevent),this.map.off("resize",this.resizeEvent),this.map.off("zoomend",this.zoomendEvent)}_setLayerTop(){const t=this.map;if(!t)return;const e=t.getStyle&&t.getStyle().layers;e&&e.length&&e.findIndex(t=>t.id===this.sourceId)!==e.length-1&&t.getLayer(this.sourceId)&&(t.removeLayer(this.sourceId),this.addGraticuleLayer())}_getLatPoints(t,e,r,s){return this.renderer._getLatPoints(t,e,r,s)}},e().supermap.FGBLayer=Fl,e().supermap.initMap=function(t,r={}){const s=new Kl(br,t,r);return s.getMapInfo(async(i,n,a)=>{try{if("processCompleted"===i.type){const{dynamicProjection:o,prjCoordSys:{epsgCode:l,type:h}}=i.result;if("PCS_NON_EARTH"===h)return void a(new Error("maplibre-gl cannot support plane coordinate system."));if(3857!==l&&!o)return void a(new Error(`The EPSG code ${l} is not yet supported`));const u=await async function(t,e,r){if(r.type&&!["raster","vector-tile"].includes(r.type))return Promise.reject(new Error('type must be "raster" or "vector-tile".'));const s=r.type||"raster",i=r.mapOptions||{},{center:n,bounds:a,scale:o,dpi:l,coordUnit:h}=e,u=n?Td("EPSG:3857","EPSG:4326",[n.x,n.y]):[0,0];let c="vector-tile"===s?v.urlAppend(v.urlPathAppend(t,"tileFeature/vectorstyles.json"),"type=MapBox_GL&styleonly=true&tileURLTemplate=ZXY"):t,d={};if("raster"===s){const t=256;d.tileSize=t;const e=!1!==i.transparent;c=v.urlAppend(v.urlPathAppend(c,"zxyTileImage.png"),`z={z}&x={x}&y={y}&width=${t}&height=${t}&transparent=${e}`)}const p=$l({scale:o,dpi:l,coordUnit:h},a);return{container:"map",center:u,zoom:p,style:"raster"===s?{version:8,sources:{"smaples-source":{type:"raster",tiles:[c],...d}},layers:[{id:"sample-layer",type:"raster",source:"smaples-source",minzoom:0,maxzoom:22}]}:c,...i}}(t,i.result,{...r,initMapService:s});return void n({map:new(e().Map)(u)})}a(new Error("Fetch mapService is failed."))}catch(t){a(t)}})},e().supermap.WebSymbol=class{constructor(){this.defaultBasePath="./resources/symbols"}init(t){e().Map.prototype.basePath=t&&t.basePath||this.defaultBasePath,Zl()}}})()})();