/*!
 * 
 *          iclient-leaflet
 *          CopyrightÂ© 2000 - 2023 SuperMap Software Co.Ltd
 *          license: Apache-2.0
 *          version: v11.1.1
 *
 */(()=>{var t={550:t=>{"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,s=r*this.x+e*this.y;return this.x=i,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),s=e.x+r*(this.x-e.x)-i*(this.y-e.y),n=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},929:(t,e,r)=>{t.exports.VectorTile=r(779),r(24),r(701)},779:(t,e,r)=>{"use strict";var i=r(701);function s(t,e,r){if(3===t){var s=new i(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}t.exports=function(t,e){this.layers=t.readFields(s,{},e)}},24:(t,e,r)=>{"use strict";var i=r(550);function s(t,e,r,i,s){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=s,t.readFields(n,this,e)}function n(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[i]=s}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function a(t){for(var e,r,i=0,s=0,n=t.length,a=n-1;s<n;a=s++)e=t[s],i+=((r=t[a]).x-e.x)*(e.y+r.y);return i}t.exports=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,s=1,n=0,a=0,o=0,l=[];t.pos<r;){if(n<=0){var h=t.readVarint();s=7&h,n=h>>3}if(n--,1===s||2===s)a+=t.readSVarint(),o+=t.readSVarint(),1===s&&(e&&l.push(e),e=[]),e.push(new i(a,o));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&l.push(e),l},s.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,s=0,n=0,a=1/0,o=-1/0,l=1/0,h=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)s+=t.readSVarint(),n+=t.readSVarint(),s<a&&(a=s),s>o&&(o=s),n<l&&(l=n),n>h&&(h=n);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,o,h]},s.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),l=this.extent*t,h=this.extent*e,u=this.loadGeometry(),c=s.types[this.type];function d(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+h)/o;t[e]=[360*(r.x+l)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(i=0;i<u.length;i++)p[i]=u[i][0];d(u=p);break;case 2:for(i=0;i<u.length;i++)d(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,s=[],n=0;n<e;n++){var o=a(t[n]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&s.push(r),r=[t[n]]):r.push(t[n]))}r&&s.push(r);return s}(u),i=0;i<u.length;i++)for(n=0;n<u[i].length;n++)d(u[i][n])}1===u.length?u=u[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f}},701:(t,e,r)=>{"use strict";var i=r(24);function s(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(n,this,e),this.length=this._features.length}function n(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}t.exports=s,s.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,e,this.extent,this._keys,this._values)}},693:function(t){!function(e){"use strict";if(e.__disableNativeFetch||!e.fetch){o.prototype.append=function(t,e){t=n(t),e=a(e);var r=this.map[t];r||(r=[],this.map[t]=r),r.push(e)},o.prototype.delete=function(t){delete this.map[n(t)]},o.prototype.get=function(t){var e=this.map[n(t)];return e?e[0]:null},o.prototype.getAll=function(t){return this.map[n(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(n(t))},o.prototype.set=function(t,e){this.map[n(t)]=[a(e)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(i){t.call(e,i,r,this)},this)},this)};var r={blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e},i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},c.call(d.prototype),c.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var s=[301,302,303,307,308];f.redirect=function(t,e){if(-1===s.indexOf(e))throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},e.Headers=o,e.Request=d,e.Response=f,e.fetch=function(t,e){return new Promise(function(i,s){var n;n=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var a=new XMLHttpRequest;var l=!1;function h(){if(4===a.readyState){var t=1223===a.status?204:a.status;if(t<100||t>599){if(l)return;return l=!0,void s(new TypeError("Network request failed"))}var e={status:t,statusText:a.statusText,headers:function(t){var e=new o;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var r=t.trim().split(":"),i=r.shift().trim(),s=r.join(":").trim();e.append(i,s)}),e}(a),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},r="response"in a?a.response:a.responseText;l||(l=!0,i(new f(r,e)))}}a.onreadystatechange=h,a.onload=h,a.onerror=function(){l||(l=!0,s(new TypeError("Network request failed")))},a.open(n.method,n.url,!0);try{"include"===n.credentials&&("withCredentials"in a?a.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(t){console&&console.warn&&console.warn("set withCredentials error:"+t)}"responseType"in a&&r.blob&&(a.responseType="blob"),n.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===n._bodyInit?null:n._bodyInit)})},e.fetch.polyfill=!0,t.exports&&(t.exports=e.fetch)}function n(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function a(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function h(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function u(t){var e=new FileReader;return e.readAsArrayBuffer(t),h(e)}function c(){return this.bodyUsed=!1,this._initBody=function(t,e){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(r.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t,this._options=e;else if(r.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!r.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText=""},r.blob?(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var t,e,r,i,s,n,a,o=l(this);if(o)return o;if(this._bodyBlob)return t=this._bodyBlob,e=this._options,r=new FileReader,i=e.headers.map["content-type"]?e.headers.map["content-type"].toString():"",s=/charset\=[0-9a-zA-Z\-\_]*;?/,n=t.type.match(s)||i.match(s),a=[t],n&&a.push(n[0].replace(/^charset\=/,"").replace(/;$/,"")),r.readAsText.apply(r,a),h(r);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=l(this);return t||Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t,e){var r,s,n=(e=e||{}).body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=(r=e.method||this.method||"GET",s=r.toUpperCase(),i.indexOf(s)>-1?s:r),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n,e)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),i=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(s))}}),e}function f(t,e){e||(e={}),this._initBody(t,e),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||""}}("undefined"!=typeof self?self:this)},144:function(t,e){var r,i,s;i=[e,t],void 0===(s="function"==typeof(r=function(t,e){"use strict";var r={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function i(t){try{delete window[t]}catch(e){window[t]=void 0}}function s(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}e.exports=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t,a=e.timeout||r.timeout,o=e.jsonpCallback||r.jsonpCallback,l=void 0;return new Promise(function(r,h){var u=e.jsonpCallbackFunction||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),c=o+"_"+u;window[u]=function(t){r({ok:!0,json:function(){return Promise.resolve(t)}}),l&&clearTimeout(l),s(c),i(u)},n+=-1===n.indexOf("?")?"?":"&";var d=document.createElement("script");d.setAttribute("src",""+n+o+"="+u),e.charset&&d.setAttribute("charset",e.charset),d.id=c,document.getElementsByTagName("head")[0].appendChild(d),l=setTimeout(function(){h(new Error("JSONP request to "+t+" timed out")),i(u),s(c),window[u]=function(){i(u)}},a),d.onerror=function(){h(new Error("JSONP request to "+t+" failed")),i(u),s(c),l&&clearTimeout(l)}})}})?r.apply(e,i):r)||(t.exports=s)},645:(t,e)=>{e.read=function(t,e,r,i,s){var n,a,o=8*s-i-1,l=(1<<o)-1,h=l>>1,u=-7,c=r?s-1:0,d=r?-1:1,p=t[e+c];for(c+=d,n=p&(1<<-u)-1,p>>=-u,u+=o;u>0;n=256*n+t[e+c],c+=d,u-=8);for(a=n&(1<<-u)-1,n>>=-u,u+=i;u>0;a=256*a+t[e+c],c+=d,u-=8);if(0===n)n=1-h;else{if(n===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),n-=h}return(p?-1:1)*a*Math.pow(2,n-i)},e.write=function(t,e,r,i,s,n){var a,o,l,h=8*n-s-1,u=(1<<h)-1,c=u>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:n-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(a++,l/=2),a+c>=u?(o=0,a=u):a+c>=1?(o=(e*l-1)*Math.pow(2,s),a+=c):(o=e*Math.pow(2,c-1)*Math.pow(2,s),a=0));s>=8;t[r+p]=255&o,p+=f,o/=256,s-=8);for(a=a<<s|o,h+=s;h>0;t[r+p]=255&a,p+=f,a/=256,h-=8);t[r+p-f]|=128*m}},186:t=>{var e=[],r=[],i="insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).";function s(t,s){if(s=s||{},void 0===t)throw new Error(i);var n,a=!0===s.prepend?"prepend":"append",o=void 0!==s.container?s.container:document.querySelector("head"),l=e.indexOf(o);return-1===l&&(l=e.push(o)-1,r[l]={}),void 0!==r[l]&&void 0!==r[l][a]?n=r[l][a]:(n=r[l][a]=function(){var t=document.createElement("style");return t.setAttribute("type","text/css"),t}(),"prepend"===a?o.insertBefore(n,o.childNodes[0]):o.appendChild(n)),65279===t.charCodeAt(0)&&(t=t.substr(1,t.length)),n.styleSheet?n.styleSheet.cssText+=t:n.textContent+=t,n}t.exports=s,t.exports.insertCss=s},545:(t,e,r)=>{var i=r(820),s="&&",n="||",a="and",o="or",l="=",h="~",u="!"+l,c="!"+h,d=">",p=">=",f="<",m="<=",y="*",g=",",v=".",b="(",S=")",_="where",x={pathway:[],groups:{}},w={},C={},M=console.log;function A(t){var e=E(t,_),r=e[0],i=e[1];x.pathway=E(r,g);for(var a=0,o=x.pathway.length;a<o;a++)x.pathway[a]=E(x.pathway[a],v),x.pathway[a][0]==y&&x.pathway[a].shift(),0===x.pathway[a].length&&x.pathway.splice(a,1);for(var C=-1,M=-1,A=0;A<i.length;){if(i[A]===b)C=A;else if(i[A]===S&&(M=A)>C&&-1!==C){var L="gr_"+(new Date).getTime();x.groups[L]=i.substring(C+1,M),i=i.replace(b+x.groups[L]+S,L),A=-1}A+=1}!function t(e,r){var i=T(r,s),a=T(r,n);if(i!==Number.MAX_VALUE||a!==Number.MAX_VALUE)if(i<a){e.and=e.and||[];var o=E(r,s);e.and.push(o[0]),t(e.and,o[1])}else{e.or=e.or||[];var o=E(r,n);e.or.push(o[0]),t(e.or,o[1])}else x.groups[r]?(r=x.groups[r],t(e,r)):(Array.isArray(e)?e.push(r):e.or=[r],function t(e){for(var r in e)if(e.hasOwnProperty(r))if(Array.isArray(e[r]))t(e[r]);else if("string"==typeof e[r])if(O(e[r],u)){var i=E(e[r],u);e[r]={ne:[i[0],i[1]]}}else if(O(e[r],c)){var i=E(e[r],c);e[r]={nreq:[i[0],i[1]]}}else if(O(e[r],h)){var i=E(e[r],h);e[r]={req:[i[0],i[1]]}}else if(O(e[r],p)){var i=E(e[r],p);e[r]={ge:[i[0],i[1]]}}else if(O(e[r],d)){var i=E(e[r],d);e[r]={gt:[i[0],i[1]]}}else if(O(e[r],m)){var i=E(e[r],m);e[r]={le:[i[0],i[1]]}}else if(O(e[r],f)){var i=E(e[r],f);e[r]={lt:[i[0],i[1]]}}else if(O(e[r],l)){var i=E(e[r],l);e[r]={eq:[i[0],i[1]]}}}(w.or?w.or:w.and))}(w,i)}function T(t,e){var r=t.indexOf(e);return-1===r?Number.MAX_VALUE:r}function E(t,e){return t.split(e).map(function(t){return t.trim()})}function O(t,e){return t.indexOf(e)>-1}function L(t,e){var r=E(e,v),s=t;for(var n in r){if(!s.hasOwnProperty(r[n]))return"";s=s[r[n]]}return s=i.isDate(s)?s.valueOf():i.isDateString(s)?i.parseDateFromString(s):s.toString()}function P(t,e){var r=!1;for(var i in t){if(r=r||(i===a?N:i===o?P:I)(t[i],e),C.trace&&M(x.step,"======((( or",t[i],r),r)return r}return r}function N(t,e){var r=!0;for(var i in t){if(r=r&&(i===a?N:i===o?P:I)(t[i],e),C.trace&&M(x.step,"======((( and",t[i],r),!r)return r}return r}function I(t,e){if(x.step+=1,t.or){var r=P(t.or,e);return C.trace&&M(x.step,"OR",t,r),r}if(t.and){r=N(t.and,e);return C.trace&&M(x.step,"AND",t,r),r}if("object"==typeof t)return t.eq?L(e,t.eq[0])===t.eq[1]:t.ne?L(e,t.ne[0])!==t.ne[1]:t.req?O(L(e,t.req[0]),t.req[1]):t.nreq?!O(L(e,t.nreq[0]),t.nreq[1]):t.gt?L(e,t.gt[0])>t.gt[1]:t.ge?L(e,t.ge[0])>=t.ge[1]:t.lt?L(e,t.lt[0])<t.lt[1]:t.le?L(e,t.le[0])<=t.le[1]:I(t,e)}function F(t,e,r){return x={pathway:[],groups:{},step:0},w={},C=r=r||{trace:!1},A(e),(i=function(t){var e=[];for(var r in t)I(w,t[r])&&e.push(t[r]);return e}(t))&&x.pathway.length>0?i.map(function(t){for(var e={},r=0,i=x.pathway.length;r<i;r++){var s=x.pathway[r].join(v);e[s]=L(t,s)}return e}):i;var i}void 0!==t.exports&&(t.exports=F),"undefined"!=typeof window&&(window.Query=F)},820:t=>{function e(t){return Object.prototype.toString.call(t)}function r(t){return"[object String]"===e(t)}t.exports={getObjectType:e,isDate:function(t){return"[object Date]"===e(t)},isString:r,isDateString:function(t){return r(t)&&!isNaN(Date.parse(t))},parseDateFromString:function(t){return Date.parse(t)},isNumber:function(t){return"number"==typeof t}}},465:(t,e,r)=>{t=r.nmd(t);var i=200,s="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",o="[object Boolean]",l="[object Date]",h="[object Function]",u="[object GeneratorFunction]",c="[object Map]",d="[object Number]",p="[object Object]",f="[object RegExp]",m="[object Set]",y="[object String]",g="[object Symbol]",v="[object ArrayBuffer]",b="[object DataView]",S="[object Float32Array]",_="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",C="[object Int32Array]",M="[object Uint8Array]",A="[object Uint8ClampedArray]",T="[object Uint16Array]",E="[object Uint32Array]",O=/\w*$/,L=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,N={};N[a]=N["[object Array]"]=N[v]=N[b]=N[o]=N[l]=N[S]=N[_]=N[x]=N[w]=N[C]=N[c]=N[d]=N[p]=N[f]=N[m]=N[y]=N[g]=N[M]=N[A]=N[T]=N[E]=!0,N["[object Error]"]=N[h]=N["[object WeakMap]"]=!1;var I="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,F="object"==typeof self&&self&&self.Object===Object&&self,k=I||F||Function("return this")(),D=e&&!e.nodeType&&e,R=D&&t&&!t.nodeType&&t,B=R&&R.exports===D;function G(t,e){return t.set(e[0],e[1]),t}function U(t,e){return t.add(e),t}function j(t,e,r,i){var s=-1,n=t?t.length:0;for(i&&n&&(r=t[++s]);++s<n;)r=e(r,t[s],s,t);return r}function z(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function V(t){var e=-1,r=Array(t.size);return t.forEach(function(t,i){r[++e]=[i,t]}),r}function J(t,e){return function(r){return t(e(r))}}function q(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var H=Array.prototype,W=Function.prototype,Y=Object.prototype,X=k["__core-js_shared__"],Q=function(){var t=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=W.toString,K=Y.hasOwnProperty,$=Y.toString,tt=RegExp("^"+Z.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=B?k.Buffer:void 0,rt=k.Symbol,it=k.Uint8Array,st=J(Object.getPrototypeOf,Object),nt=Object.create,at=Y.propertyIsEnumerable,ot=H.splice,lt=Object.getOwnPropertySymbols,ht=et?et.isBuffer:void 0,ut=J(Object.keys,Object),ct=Dt(k,"DataView"),dt=Dt(k,"Map"),pt=Dt(k,"Promise"),ft=Dt(k,"Set"),mt=Dt(k,"WeakMap"),yt=Dt(Object,"create"),gt=jt(ct),vt=jt(dt),bt=jt(pt),St=jt(ft),_t=jt(mt),xt=rt?rt.prototype:void 0,wt=xt?xt.valueOf:void 0;function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Mt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function At(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Tt(t){this.__data__=new Mt(t)}function Et(t,e){var r=Vt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Jt(t)}(t)&&K.call(t,"callee")&&(!at.call(t,"callee")||$.call(t)==a)}(t)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],i=r.length,s=!!i;for(var n in t)!e&&!K.call(t,n)||s&&("length"==n||Gt(n,i))||r.push(n);return r}function Ot(t,e,r){var i=t[e];K.call(t,e)&&zt(i,r)&&(void 0!==r||e in t)||(t[e]=r)}function Lt(t,e){for(var r=t.length;r--;)if(zt(t[r][0],e))return r;return-1}function Pt(t,e,r,i,s,n,L){var P;if(i&&(P=n?i(t,s,n,L):i(t)),void 0!==P)return P;if(!Wt(t))return t;var I=Vt(t);if(I){if(P=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&K.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!e)return function(t,e){var r=-1,i=t.length;e||(e=Array(i));for(;++r<i;)e[r]=t[r];return e}(t,P)}else{var F=Bt(t),k=F==h||F==u;if(qt(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if(F==p||F==a||k&&!n){if(z(t))return n?t:{};if(P=function(t){return"function"!=typeof t.constructor||Ut(t)?{}:(e=st(t),Wt(e)?nt(e):{});var e}(k?{}:t),!e)return function(t,e){return Ft(t,Rt(t),e)}(t,function(t,e){return t&&Ft(e,Yt(e),t)}(P,t))}else{if(!N[F])return n?t:{};P=function(t,e,r,i){var s=t.constructor;switch(e){case v:return It(t);case o:case l:return new s(+t);case b:return function(t,e){var r=e?It(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,i);case S:case _:case x:case w:case C:case M:case A:case T:case E:return function(t,e){var r=e?It(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,i);case c:return function(t,e,r){return j(e?r(V(t),!0):V(t),G,new t.constructor)}(t,i,r);case d:case y:return new s(t);case f:return(h=new(a=t).constructor(a.source,O.exec(a))).lastIndex=a.lastIndex,h;case m:return function(t,e,r){return j(e?r(q(t),!0):q(t),U,new t.constructor)}(t,i,r);case g:return n=t,wt?Object(wt.call(n)):{}}var n;var a,h}(t,F,Pt,e)}}L||(L=new Tt);var D=L.get(t);if(D)return D;if(L.set(t,P),!I)var R=r?function(t){return function(t,e,r){var i=e(t);return Vt(t)?i:function(t,e){for(var r=-1,i=e.length,s=t.length;++r<i;)t[s+r]=e[r];return t}(i,r(t))}(t,Yt,Rt)}(t):Yt(t);return function(t,e){for(var r=-1,i=t?t.length:0;++r<i&&!1!==e(t[r],r,t););}(R||t,function(s,n){R&&(s=t[n=s]),Ot(P,n,Pt(s,e,r,i,n,t,L))}),P}function Nt(t){return!(!Wt(t)||Q&&Q in t)&&(Ht(t)||z(t)?tt:L).test(jt(t))}function It(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Ft(t,e,r,i){r||(r={});for(var s=-1,n=e.length;++s<n;){var a=e[s],o=i?i(r[a],t[a],a,r,t):void 0;Ot(r,a,void 0===o?t[a]:o)}return r}function kt(t,e){var r,i,s=t.__data__;return("string"==(i=typeof(r=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?s["string"==typeof e?"string":"hash"]:s.map}function Dt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Nt(r)?r:void 0}Ct.prototype.clear=function(){this.__data__=yt?yt(null):{}},Ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Ct.prototype.get=function(t){var e=this.__data__;if(yt){var r=e[t];return r===s?void 0:r}return K.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return yt?void 0!==e[t]:K.call(e,t)},Ct.prototype.set=function(t,e){return this.__data__[t]=yt&&void 0===e?s:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,r=Lt(e,t);return!(r<0||(r==e.length-1?e.pop():ot.call(e,r,1),0))},Mt.prototype.get=function(t){var e=this.__data__,r=Lt(e,t);return r<0?void 0:e[r][1]},Mt.prototype.has=function(t){return Lt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var r=this.__data__,i=Lt(r,t);return i<0?r.push([t,e]):r[i][1]=e,this},At.prototype.clear=function(){this.__data__={hash:new Ct,map:new(dt||Mt),string:new Ct}},At.prototype.delete=function(t){return kt(this,t).delete(t)},At.prototype.get=function(t){return kt(this,t).get(t)},At.prototype.has=function(t){return kt(this,t).has(t)},At.prototype.set=function(t,e){return kt(this,t).set(t,e),this},Tt.prototype.clear=function(){this.__data__=new Mt},Tt.prototype.delete=function(t){return this.__data__.delete(t)},Tt.prototype.get=function(t){return this.__data__.get(t)},Tt.prototype.has=function(t){return this.__data__.has(t)},Tt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Mt){var s=r.__data__;if(!dt||s.length<i-1)return s.push([t,e]),this;r=this.__data__=new At(s)}return r.set(t,e),this};var Rt=lt?J(lt,Object):function(){return[]},Bt=function(t){return $.call(t)};function Gt(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||P.test(t))&&t>-1&&t%1==0&&t<e}function Ut(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Y)}function jt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!=t&&e!=e}(ct&&Bt(new ct(new ArrayBuffer(1)))!=b||dt&&Bt(new dt)!=c||pt&&"[object Promise]"!=Bt(pt.resolve())||ft&&Bt(new ft)!=m||mt&&"[object WeakMap]"!=Bt(new mt))&&(Bt=function(t){var e=$.call(t),r=e==p?t.constructor:void 0,i=r?jt(r):void 0;if(i)switch(i){case gt:return b;case vt:return c;case bt:return"[object Promise]";case St:return m;case _t:return"[object WeakMap]"}return e});var Vt=Array.isArray;function Jt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!Ht(t)}var qt=ht||function(){return!1};function Ht(t){var e=Wt(t)?$.call(t):"";return e==h||e==u}function Wt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Yt(t){return Jt(t)?Et(t):function(t){if(!Ut(t))return ut(t);var e=[];for(var r in Object(t))K.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}t.exports=function(t){return Pt(t,!0,!0)}},52:(t,e,r)=>{var i=9007199254740991,s="[object Arguments]",n="[object Function]",a="[object GeneratorFunction]",o="[object Map]",l="[object Set]",h=/^\[object .+?Constructor\]$/,u=/^(?:0|[1-9]\d*)$/,c="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,d="object"==typeof self&&self&&self.Object===Object&&self,p=c||d||Function("return this")();function f(t,e){return function(t,e){for(var r=-1,i=t?t.length:0,s=Array(i);++r<i;)s[r]=e(t[r],r,t);return s}(e,function(e){return[e,t[e]]})}var m=Function.prototype,y=Object.prototype,g=p["__core-js_shared__"],v=function(){var t=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),b=m.toString,S=y.hasOwnProperty,_=y.toString,x=RegExp("^"+b.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=y.propertyIsEnumerable,C=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),M=B(p,"DataView"),A=B(p,"Map"),T=B(p,"Promise"),E=B(p,"Set"),O=B(p,"WeakMap"),L=j(M),P=j(A),N=j(T),I=j(E),F=j(O);function k(t,e){var r=z(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&V(t)}(t)&&S.call(t,"callee")&&(!w.call(t,"callee")||_.call(t)==s)}(t)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],i=r.length,n=!!i;for(var a in t)!e&&!S.call(t,a)||n&&("length"==a||U(a,i))||r.push(a);return r}function D(t){return!(!q(t)||v&&v in t)&&(J(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?x:h).test(j(t))}function R(t){if(r=(e=t)&&e.constructor,i="function"==typeof r&&r.prototype||y,e!==i)return C(t);var e,r,i,s=[];for(var n in Object(t))S.call(t,n)&&"constructor"!=n&&s.push(n);return s}function B(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return D(r)?r:void 0}var G=function(t){return _.call(t)};function U(t,e){return!!(e=null==e?i:e)&&("number"==typeof t||u.test(t))&&t>-1&&t%1==0&&t<e}function j(t){if(null!=t){try{return b.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(M&&"[object DataView]"!=G(new M(new ArrayBuffer(1)))||A&&G(new A)!=o||T&&"[object Promise]"!=G(T.resolve())||E&&G(new E)!=l||O&&"[object WeakMap]"!=G(new O))&&(G=function(t){var e=_.call(t),r="[object Object]"==e?t.constructor:void 0,i=r?j(r):void 0;if(i)switch(i){case L:return"[object DataView]";case P:return o;case N:return"[object Promise]";case I:return l;case F:return"[object WeakMap]"}return e});var z=Array.isArray;function V(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!J(t)}function J(t){var e=q(t)?_.call(t):"";return e==n||e==a}function q(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var H=function(t){return function(e){var r,i,s,n=G(e);return n==o?(r=e,i=-1,s=Array(r.size),r.forEach(function(t,e){s[++i]=[e,t]}),s):n==l?function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=[t,t]}),r}(e):f(e,t(e))}}(function(t){return V(t)?k(t):R(t)});t.exports=H},618:(t,e,r)=>{t=r.nmd(t);var i=200,s="Expected a function",n="__lodash_hash_undefined__",a=1,o=2,l=1/0,h=9007199254740991,u="[object Arguments]",c="[object Array]",d="[object Boolean]",p="[object Date]",f="[object Error]",m="[object Function]",y="[object GeneratorFunction]",g="[object Map]",v="[object Number]",b="[object Object]",S="[object RegExp]",_="[object Set]",x="[object String]",w="[object Symbol]",C="[object ArrayBuffer]",M="[object DataView]",A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,T=/^\w*$/,E=/^\./,O=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,L=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[u]=I[c]=I[C]=I[d]=I[M]=I[p]=I[f]=I[m]=I[g]=I[v]=I[b]=I[S]=I[_]=I[x]=I["[object WeakMap]"]=!1;var F="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,k="object"==typeof self&&self&&self.Object===Object&&self,D=F||k||Function("return this")(),R=e&&!e.nodeType&&e,B=R&&t&&!t.nodeType&&t,G=B&&B.exports===R&&F.process,U=function(){try{return G&&G.binding("util")}catch(t){}}(),j=U&&U.isTypedArray;function z(t,e){return!!(t?t.length:0)&&function(t,e,r){if(e!=e)return function(t,e,r,i){var s=t.length,n=r+(i?1:-1);for(;i?n--:++n<s;)if(e(t[n],n,t))return n;return-1}(t,q,r);var i=r-1,s=t.length;for(;++i<s;)if(t[i]===e)return i;return-1}(t,e,0)>-1}function V(t,e,r){for(var i=-1,s=t?t.length:0;++i<s;)if(r(e,t[i]))return!0;return!1}function J(t,e){for(var r=-1,i=t?t.length:0;++r<i;)if(e(t[r],r,t))return!0;return!1}function q(t){return t!=t}function H(t,e){return t.has(e)}function W(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function Y(t){var e=-1,r=Array(t.size);return t.forEach(function(t,i){r[++e]=[i,t]}),r}function X(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var Q=Array.prototype,Z=Function.prototype,K=Object.prototype,$=D["__core-js_shared__"],tt=function(){var t=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),et=Z.toString,rt=K.hasOwnProperty,it=K.toString,st=RegExp("^"+et.call(rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=D.Symbol,at=D.Uint8Array,ot=K.propertyIsEnumerable,lt=Q.splice,ht=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),ut=jt(D,"DataView"),ct=jt(D,"Map"),dt=jt(D,"Promise"),pt=jt(D,"Set"),ft=jt(D,"WeakMap"),mt=jt(Object,"create"),yt=Xt(ut),gt=Xt(ct),vt=Xt(dt),bt=Xt(pt),St=Xt(ft),_t=nt?nt.prototype:void 0,xt=_t?_t.valueOf:void 0,wt=_t?_t.toString:void 0;function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Mt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function At(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Tt(t){var e=-1,r=t?t.length:0;for(this.__data__=new At;++e<r;)this.add(t[e])}function Et(t){this.__data__=new Mt(t)}function Ot(t,e){var r=$t(t)||Kt(t)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],i=r.length,s=!!i;for(var n in t)!e&&!rt.call(t,n)||s&&("length"==n||Vt(n,i))||r.push(n);return r}function Lt(t,e){for(var r=t.length;r--;)if(Zt(t[r][0],e))return r;return-1}function Pt(t,e){for(var r=0,i=(e=Jt(e,t)?[e]:Rt(e)).length;null!=t&&r<i;)t=t[Yt(e[r++])];return r&&r==i?t:void 0}function Nt(t,e){return null!=t&&e in Object(t)}function It(t,e,r,i,s){return t===e||(null==t||null==e||!ie(t)&&!se(e)?t!=t&&e!=e:function(t,e,r,i,s,n){var l=$t(t),h=$t(e),m=c,y=c;l||(m=(m=zt(t))==u?b:m);h||(y=(y=zt(e))==u?b:y);var A=m==b&&!W(t),T=y==b&&!W(e),E=m==y;if(E&&!A)return n||(n=new Et),l||ae(t)?Gt(t,e,r,i,s,n):function(t,e,r,i,s,n,l){switch(r){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case C:return!(t.byteLength!=e.byteLength||!i(new at(t),new at(e)));case d:case p:case v:return Zt(+t,+e);case f:return t.name==e.name&&t.message==e.message;case S:case x:return t==e+"";case g:var h=Y;case _:var u=n&o;if(h||(h=X),t.size!=e.size&&!u)return!1;var c=l.get(t);if(c)return c==e;n|=a,l.set(t,e);var m=Gt(h(t),h(e),i,s,n,l);return l.delete(t),m;case w:if(xt)return xt.call(t)==xt.call(e)}return!1}(t,e,m,r,i,s,n);if(!(s&o)){var O=A&&rt.call(t,"__wrapped__"),L=T&&rt.call(e,"__wrapped__");if(O||L){var P=O?t.value():t,N=L?e.value():e;return n||(n=new Et),r(P,N,i,s,n)}}if(!E)return!1;return n||(n=new Et),function(t,e,r,i,s,n){var a=s&o,l=oe(t),h=l.length,u=oe(e).length;if(h!=u&&!a)return!1;for(var c=h;c--;){var d=l[c];if(!(a?d in e:rt.call(e,d)))return!1}var p=n.get(t);if(p&&n.get(e))return p==e;var f=!0;n.set(t,e),n.set(e,t);for(var m=a;++c<h;){d=l[c];var y=t[d],g=e[d];if(i)var v=a?i(g,y,d,e,t,n):i(y,g,d,t,e,n);if(!(void 0===v?y===g||r(y,g,i,s,n):v)){f=!1;break}m||(m="constructor"==d)}if(f&&!m){var b=t.constructor,S=e.constructor;b!=S&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(f=!1)}return n.delete(t),n.delete(e),f}(t,e,r,i,s,n)}(t,e,It,r,i,s))}function Ft(t){return!(!ie(t)||tt&&tt in t)&&(ee(t)||W(t)?st:P).test(Xt(t))}function kt(t){return"function"==typeof t?t:null==t?le:"object"==typeof t?$t(t)?function(t,e){if(Jt(t)&&qt(e))return Ht(Yt(t),e);return function(r){var i=function(t,e,r){var i=null==t?void 0:Pt(t,e);return void 0===i?r:i}(r,t);return void 0===i&&i===e?function(t,e){return null!=t&&function(t,e,r){var i,s=-1,n=(e=Jt(e,t)?[e]:Rt(e)).length;for(;++s<n;){var a=Yt(e[s]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}if(i)return i;return!!(n=t?t.length:0)&&re(n)&&Vt(a,n)&&($t(t)||Kt(t))}(t,e,Nt)}(r,t):It(e,i,void 0,a|o)}}(t[0],t[1]):function(t){var e=function(t){var e=oe(t),r=e.length;for(;r--;){var i=e[r],s=t[i];e[r]=[i,s,qt(s)]}return e}(t);if(1==e.length&&e[0][2])return Ht(e[0][0],e[0][1]);return function(r){return r===t||function(t,e,r,i){var s=r.length,n=s,l=!i;if(null==t)return!n;for(t=Object(t);s--;){var h=r[s];if(l&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++s<n;){var u=(h=r[s])[0],c=t[u],d=h[1];if(l&&h[2]){if(void 0===c&&!(u in t))return!1}else{var p=new Et;if(i)var f=i(c,d,u,t,e,p);if(!(void 0===f?It(d,c,i,a|o,p):f))return!1}}return!0}(r,t,e)}}(t):Jt(e=t)?(r=Yt(e),function(t){return null==t?void 0:t[r]}):function(t){return function(e){return Pt(e,t)}}(e);var e,r}function Dt(t){if(r=(e=t)&&e.constructor,i="function"==typeof r&&r.prototype||K,e!==i)return ht(t);var e,r,i,s=[];for(var n in Object(t))rt.call(t,n)&&"constructor"!=n&&s.push(n);return s}function Rt(t){return $t(t)?t:Wt(t)}Ct.prototype.clear=function(){this.__data__=mt?mt(null):{}},Ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Ct.prototype.get=function(t){var e=this.__data__;if(mt){var r=e[t];return r===n?void 0:r}return rt.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return mt?void 0!==e[t]:rt.call(e,t)},Ct.prototype.set=function(t,e){return this.__data__[t]=mt&&void 0===e?n:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,r=Lt(e,t);return!(r<0||(r==e.length-1?e.pop():lt.call(e,r,1),0))},Mt.prototype.get=function(t){var e=this.__data__,r=Lt(e,t);return r<0?void 0:e[r][1]},Mt.prototype.has=function(t){return Lt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var r=this.__data__,i=Lt(r,t);return i<0?r.push([t,e]):r[i][1]=e,this},At.prototype.clear=function(){this.__data__={hash:new Ct,map:new(ct||Mt),string:new Ct}},At.prototype.delete=function(t){return Ut(this,t).delete(t)},At.prototype.get=function(t){return Ut(this,t).get(t)},At.prototype.has=function(t){return Ut(this,t).has(t)},At.prototype.set=function(t,e){return Ut(this,t).set(t,e),this},Tt.prototype.add=Tt.prototype.push=function(t){return this.__data__.set(t,n),this},Tt.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.clear=function(){this.__data__=new Mt},Et.prototype.delete=function(t){return this.__data__.delete(t)},Et.prototype.get=function(t){return this.__data__.get(t)},Et.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Mt){var s=r.__data__;if(!ct||s.length<i-1)return s.push([t,e]),this;r=this.__data__=new At(s)}return r.set(t,e),this};var Bt=pt&&1/X(new pt([,-0]))[1]==l?function(t){return new pt(t)}:function(){};function Gt(t,e,r,i,s,n){var l=s&o,h=t.length,u=e.length;if(h!=u&&!(l&&u>h))return!1;var c=n.get(t);if(c&&n.get(e))return c==e;var d=-1,p=!0,f=s&a?new Tt:void 0;for(n.set(t,e),n.set(e,t);++d<h;){var m=t[d],y=e[d];if(i)var g=l?i(y,m,d,e,t,n):i(m,y,d,t,e,n);if(void 0!==g){if(g)continue;p=!1;break}if(f){if(!J(e,function(t,e){if(!f.has(e)&&(m===t||r(m,t,i,s,n)))return f.add(e)})){p=!1;break}}else if(m!==y&&!r(m,y,i,s,n)){p=!1;break}}return n.delete(t),n.delete(e),p}function Ut(t,e){var r,i,s=t.__data__;return("string"==(i=typeof(r=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?s["string"==typeof e?"string":"hash"]:s.map}function jt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Ft(r)?r:void 0}var zt=function(t){return it.call(t)};function Vt(t,e){return!!(e=null==e?h:e)&&("number"==typeof t||N.test(t))&&t>-1&&t%1==0&&t<e}function Jt(t,e){if($t(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!ne(t))||(T.test(t)||!A.test(t)||null!=e&&t in Object(e))}function qt(t){return t==t&&!ie(t)}function Ht(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}(ut&&zt(new ut(new ArrayBuffer(1)))!=M||ct&&zt(new ct)!=g||dt&&"[object Promise]"!=zt(dt.resolve())||pt&&zt(new pt)!=_||ft&&"[object WeakMap]"!=zt(new ft))&&(zt=function(t){var e=it.call(t),r=e==b?t.constructor:void 0,i=r?Xt(r):void 0;if(i)switch(i){case yt:return M;case gt:return g;case vt:return"[object Promise]";case bt:return _;case St:return"[object WeakMap]"}return e});var Wt=Qt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ne(t))return wt?wt.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}(e);var r=[];return E.test(t)&&r.push(""),t.replace(O,function(t,e,i,s){r.push(i?s.replace(L,"$1"):e||t)}),r});function Yt(t){if("string"==typeof t||ne(t))return t;var e=t+"";return"0"==e&&1/t==-l?"-0":e}function Xt(t){if(null!=t){try{return et.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Qt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(s);var r=function(){var i=arguments,s=e?e.apply(this,i):i[0],n=r.cache;if(n.has(s))return n.get(s);var a=t.apply(this,i);return r.cache=n.set(s,a),a};return r.cache=new(Qt.Cache||At),r}function Zt(t,e){return t===e||t!=t&&e!=e}function Kt(t){return function(t){return se(t)&&te(t)}(t)&&rt.call(t,"callee")&&(!ot.call(t,"callee")||it.call(t)==u)}Qt.Cache=At;var $t=Array.isArray;function te(t){return null!=t&&re(t.length)&&!ee(t)}function ee(t){var e=ie(t)?it.call(t):"";return e==m||e==y}function re(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=h}function ie(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function se(t){return!!t&&"object"==typeof t}function ne(t){return"symbol"==typeof t||se(t)&&it.call(t)==w}var ae=j?function(t){return function(e){return t(e)}}(j):function(t){return se(t)&&re(t.length)&&!!I[it.call(t)]};function oe(t){return te(t)?Ot(t):Dt(t)}function le(t){return t}t.exports=function(t,e){return t&&t.length?function(t,e,r){var s=-1,n=z,a=t.length,o=!0,l=[],h=l;if(r)o=!1,n=V;else if(a>=i){var u=e?null:Bt(t);if(u)return X(u);o=!1,n=H,h=new Tt}else h=e?[]:l;t:for(;++s<a;){var c=t[s],d=e?e(c):c;if(c=r||0!==c?c:0,o&&d==d){for(var p=h.length;p--;)if(h[p]===d)continue t;e&&h.push(d),l.push(c)}else n(h,d,r)||(h!==l&&h.push(d),l.push(c))}return l}(t,kt(e)):[]}},614:(t,e,r)=>{"use strict";t.exports=s;var i=r(645);function s(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var n="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function a(t){return t.type===s.Bytes?t.readVarint()+t.pos:t.pos+1}function o(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function l(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var s=r.pos-1;s>=t;s--)r.buf[s+i]=r.buf[s]}function h(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function u(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function S(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}s.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),s=i>>3,n=this.pos;this.type=7&i,t(s,e,this),this.pos===n&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=S(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=v(this.buf,this.pos)+4294967296*v(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=v(this.buf,this.pos)+4294967296*S(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,s,n=r.buf;if(s=n[r.pos++],i=(112&s)>>4,s<128)return o(t,i,e);if(s=n[r.pos++],i|=(127&s)<<3,s<128)return o(t,i,e);if(s=n[r.pos++],i|=(127&s)<<10,s<128)return o(t,i,e);if(s=n[r.pos++],i|=(127&s)<<17,s<128)return o(t,i,e);if(s=n[r.pos++],i|=(127&s)<<24,s<128)return o(t,i,e);if(s=n[r.pos++],i|=(1&s)<<31,s<128)return o(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&n?function(t,e,r){return n.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var i="",s=e;for(;s<r;){var n,a,o,l=t[s],h=null,u=l>239?4:l>223?3:l>191?2:1;if(s+u>r)break;1===u?l<128&&(h=l):2===u?128==(192&(n=t[s+1]))&&(h=(31&l)<<6|63&n)<=127&&(h=null):3===u?(n=t[s+1],a=t[s+2],128==(192&n)&&128==(192&a)&&((h=(15&l)<<12|(63&n)<<6|63&a)<=2047||h>=55296&&h<=57343)&&(h=null)):4===u&&(n=t[s+1],a=t[s+2],o=t[s+3],128==(192&n)&&128==(192&a)&&128==(192&o)&&((h=(15&l)<<18|(63&n)<<12|(63&a)<<6|63&o)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,u=1):h>65535&&(h-=65536,i+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),i+=String.fromCharCode(h),s+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==s.Bytes)return t.push(this.readVarint(e));var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==s.Bytes)return t.push(this.readSVarint());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==s.Bytes)return t.push(this.readBoolean());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==s.Bytes)return t.push(this.readFloat());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==s.Bytes)return t.push(this.readDouble());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==s.Bytes)return t.push(this.readFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==s.Bytes)return t.push(this.readSFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==s.Bytes)return t.push(this.readFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==s.Bytes)return t.push(this.readSFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===s.Varint)for(;this.buf[this.pos++]>127;);else if(e===s.Bytes)this.pos=this.readVarint()+this.pos;else if(e===s.Fixed32)this.pos+=4;else{if(e!==s.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,s,n=0;n<e.length;n++){if((i=e.charCodeAt(n))>55295&&i<57344){if(!s){i>56319||n+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):s=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,s=i;continue}i=s-55296<<10|i-56320|65536,s=null}else s&&(t[r++]=239,t[r++]=191,t[r++]=189,s=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&l(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&l(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,s.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writeBytesField:function(t,e){this.writeTag(t,s.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,s.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,s.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,s.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,s.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,s.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,s.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,s.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,s.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,s.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},107:function(t,e,r){!function(){"use strict";function t(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})}function e(t){return new this(function(e,r){if(!t||void 0===t.length)return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var s=i.length;function n(t,r){if(r&&("object"==typeof r||"function"==typeof r)){var a=r.then;if("function"==typeof a)return void a.call(r,function(e){n(t,e)},function(r){i[t]={status:"rejected",reason:r},0==--s&&e(i)})}i[t]={status:"fulfilled",value:r},0==--s&&e(i)}for(var a=0;a<i.length;a++)n(a,i[a])})}var i=setTimeout;function s(t){return Boolean(t&&void 0!==t.length)}function n(){}function a(t){if(!(this instanceof a))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,a._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var i;try{i=r(t._value)}catch(t){return void h(e.promise,t)}l(e.promise,i)}else(1===t._state?l:h)(e.promise,t._value)})):t._deferreds.push(e)}function l(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof a)return t._state=3,t._value=e,void u(t);if("function"==typeof r)return void c((i=r,s=e,function(){i.apply(s,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){h(t,e)}var i,s}function h(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&a._immediateFn(function(){t._handled||a._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;e<r;e++)o(t,t._deferreds[e]);t._deferreds=null}function c(t,e){var r=!1;try{t(function(t){r||(r=!0,l(e,t))},function(t){r||(r=!0,h(e,t))})}catch(t){if(r)return;r=!0,h(e,t)}}a.prototype.catch=function(t){return this.then(null,t)},a.prototype.then=function(t,e){var r=new this.constructor(n);return o(this,new function(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}(t,e,r)),r},a.prototype.finally=t,a.all=function(t){return new a(function(e,r){if(!s(t))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var n=i.length;function a(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var o=s.then;if("function"==typeof o)return void o.call(s,function(e){a(t,e)},r)}i[t]=s,0==--n&&e(i)}catch(t){r(t)}}for(var o=0;o<i.length;o++)a(o,i[o])})},a.allSettled=e,a.resolve=function(t){return t&&"object"==typeof t&&t.constructor===a?t:new a(function(e){e(t)})},a.reject=function(t){return new a(function(e,r){r(t)})},a.race=function(t){return new a(function(e,r){if(!s(t))return r(new TypeError("Promise.race accepts an array"));for(var i=0,n=t.length;i<n;i++)a.resolve(t[i]).then(e,r)})},a._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){i(t,0)},a._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var d=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();"function"!=typeof d.Promise?d.Promise=a:(d.Promise.prototype.finally||(d.Promise.prototype.finally=t),d.Promise.allSettled||(d.Promise.allSettled=e))}()},166:function(t){t.exports=function(){"use strict";function t(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(r,i,s,n,a){!function e(r,i,s,n,a){for(;n>s;){if(n-s>600){var o=n-s+1,l=i-s+1,h=Math.log(o),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(o-u)/o)*(l-o/2<0?-1:1),d=Math.max(s,Math.floor(i-l*u/o+c)),p=Math.min(n,Math.floor(i+(o-l)*u/o+c));e(r,i,d,p,a)}var f=r[i],m=s,y=n;for(t(r,s,i),a(r[n],f)>0&&t(r,s,n);m<y;){for(t(r,m,y),m++,y--;a(r[m],f)<0;)m++;for(;a(r[y],f)>0;)y--}0===a(r[s],f)?t(r,s,y):t(r,++y,n),y<=i&&(s=y+1),i<=y&&(n=y-1)}}(r,i,s||0,n||r.length-1,a||e)}}()},510:(t,e,r)=>{"use strict";t.exports=s,t.exports.default=s;var i=r(166);function s(t,e){if(!(this instanceof s))return new s(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function n(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,r,i,s){s||(s=m(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,a=e;a<r;a++)n=t.children[a],l(s,t.leaf?i(n):n);return s}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,r,s,n){for(var a,o=[e,r];o.length;)(r=o.pop())-(e=o.pop())<=s||(a=e+Math.ceil((r-e)/s/2)*s,i(t,a,e,r,n),o.push(e,a,a,r))}s.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!f(t,e))return r;for(var s,n,a,o,l=[];e;){for(s=0,n=e.children.length;s<n;s++)a=e.children[s],f(t,o=e.leaf?i(a):a)&&(e.leaf?r.push(a):p(t,o)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!f(t,e))return!1;for(var i,s,n,a,o=[];e;){for(i=0,s=e.children.length;i<s;i++)if(n=e.children[i],f(t,a=e.leaf?r(n):n)){if(e.leaf||p(t,a))return!0;o.push(n)}e=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var r,i,s,a,o=this.data,l=this.toBBox(t),h=[],u=[];o||h.length;){if(o||(o=h.pop(),i=h[h.length-1],r=u.pop(),a=!0),o.leaf&&-1!==(s=n(t,o.children,e)))return o.children.splice(s,1),h.push(o),this._condense(h),this;a||o.leaf||!p(o,l)?i?(r++,o=i.children[r],a=!1):o=null:(h.push(o),u.push(r),r=0,i=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var s,n=r-e+1,o=this._maxEntries;if(n<=o)return a(s=m(t.slice(e,r+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,i-1))),(s=m([])).leaf=!1,s.height=i;var l,h,u,c,d=Math.ceil(n/o),p=d*Math.ceil(Math.sqrt(o));for(y(t,e,r,p,this.compareMinX),l=e;l<=r;l+=p)for(y(t,l,u=Math.min(l+p-1,r),d,this.compareMinY),h=l;h<=u;h+=d)c=Math.min(h+d-1,u),s.children.push(this._build(t,h,c,i-1));return a(s,this.toBBox),s},_chooseSubtree:function(t,e,r,i){for(var s,n,a,o,l,h,u,d,p,f;i.push(e),!e.leaf&&i.length-1!==r;){for(u=d=1/0,s=0,n=e.children.length;s<n;s++)l=c(a=e.children[s]),p=t,f=a,(h=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=h,u=l<u?l:u,o=a):h===d&&l<u&&(u=l,o=a);e=o||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,s=r?t:i(t),n=[],a=this._chooseSubtree(s,this.data,e,n);for(a.children.push(t),l(a,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var r=t[e],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var n=this._chooseSplitIndex(r,s,i),o=m(r.children.splice(n,r.children.length-n));o.height=r.height,o.leaf=r.leaf,a(r,this.toBBox),a(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,s,n,a,l,h,u,d,p,f,m,y,g,v;for(h=u=1/0,i=e;i<=r-e;i++)s=o(t,0,i,this.toBBox),n=o(t,i,r,this.toBBox),p=s,f=n,void 0,void 0,void 0,void 0,m=Math.max(p.minX,f.minX),y=Math.max(p.minY,f.minY),g=Math.min(p.maxX,f.maxX),v=Math.min(p.maxY,f.maxY),a=Math.max(0,g-m)*Math.max(0,v-y),l=c(s)+c(n),a<h?(h=a,d=i,u=l<u?l:u):a===h&&l<u&&(u=l,d=i);return d},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:h,s=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,s)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var s,n,a=this.toBBox,h=o(t,0,e,a),u=o(t,r-e,r,a),c=d(h)+d(u);for(s=e;s<r-e;s++)n=t.children[s],l(h,t.leaf?a(n):n),c+=d(h);for(s=r-e-1;s>=e;s--)n=t.children[s],l(u,t.leaf?a(n):n),c+=d(u);return c},_adjustParentBBoxes:function(t,e,r){for(var i=r;i>=0;i--)l(e[i],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}}},e={};function r(i){var s=e[i];if(void 0!==s)return s.exports;var n=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.n=(t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e}),r.d=((t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}),r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=((t,e)=>Object.prototype.hasOwnProperty.call(t,e)),r.nmd=(t=>(t.paths=[],t.children||(t.children=[]),t)),(()=>{"use strict";var t=window.SuperMap=window.SuperMap||{};t.Components=window.SuperMap.Components||{};var e={GEOJSON:"GEOJSON",ISERVER:"ISERVER",FGB:"FGB"},i={ISERVER:"ISERVER",IPORTAL:"IPORTAL",ONLINE:"ONLINE"},s={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",POINTEPS:"POINTEPS",LINEEPS:"LINEEPS",REGIONEPS:"REGIONEPS",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",RECTANGLE:"RECTANGLE",UNKNOWN:"UNKNOWN",GEOCOMPOUND:"GEOCOMPOUND"},n={ATTRIBUTE:"ATTRIBUTE",ATTRIBUTEANDGEOMETRY:"ATTRIBUTEANDGEOMETRY",GEOMETRY:"GEOMETRY"},a={CONTAIN:"CONTAIN",CROSS:"CROSS",DISJOINT:"DISJOINT",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",NONE:"NONE",OVERLAP:"OVERLAP",TOUCH:"TOUCH",WITHIN:"WITHIN"},o={DISTANCE:"DISTANCE",AREA:"AREA"},l={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"},h={CENTIMETER:"CENTIMETER",DECIMETER:"DECIMETER",FOOT:"FOOT",INCH:"INCH",KILOMETER:"KILOMETER",METER:"METER",MILE:"MILE",MILLIMETER:"MILLIMETER",YARD:"YARD"},u={CAPTION:"CAPTION",CAPTION_PERCENT:"CAPTION_PERCENT",CAPTION_VALUE:"CAPTION_VALUE",PERCENT:"PERCENT",VALUE:"VALUE"},c={AREA:"AREA",BAR:"BAR",BAR3D:"BAR3D",LINE:"LINE",PIE:"PIE",PIE3D:"PIE3D",POINT:"POINT",RING:"RING",ROSE:"ROSE",ROSE3D:"ROSE3D",STACK_BAR:"STACK_BAR",STACK_BAR3D:"STACK_BAR3D",STEP:"STEP"},d={ALL:"ALL",NONE:"NONE",YAXES:"YAXES"},p={CONSTANT:"CONSTANT",LOGARITHM:"LOGARITHM",SQUAREROOT:"SQUAREROOT"},f={CUSTOMINTERVAL:"CUSTOMINTERVAL",EQUALINTERVAL:"EQUALINTERVAL",LOGARITHM:"LOGARITHM",QUANTILE:"QUANTILE",SQUAREROOT:"SQUAREROOT",STDDEVIATION:"STDDEVIATION"},m={BLACK_WHITE:"BLACKWHITE",BLUE_BLACK:"BLUEBLACK",BLUE_RED:"BLUERED",BLUE_WHITE:"BLUEWHITE",CYAN_BLACK:"CYANBLACK",CYAN_BLUE:"CYANBLUE",CYAN_GREEN:"CYANGREEN",CYAN_WHITE:"CYANWHITE",GREEN_BLACK:"GREENBLACK",GREEN_BLUE:"GREENBLUE",GREEN_ORANGE_VIOLET:"GREENORANGEVIOLET",GREEN_RED:"GREENRED",GREEN_WHITE:"GREENWHITE",PINK_BLACK:"PINKBLACK",PINK_BLUE:"PINKBLUE",PINK_RED:"PINKRED",PINK_WHITE:"PINKWHITE",RAIN_BOW:"RAINBOW",RED_BLACK:"REDBLACK",RED_WHITE:"REDWHITE",SPECTRUM:"SPECTRUM",TERRAIN:"TERRAIN",YELLOW_BLACK:"YELLOWBLACK",YELLOW_BLUE:"YELLOWBLUE",YELLOW_GREEN:"YELLOWGREEN",YELLOW_RED:"YELLOWRED",YELLOW_WHITE:"YELLOWWHITE"},y={TOPLEFT:"TOPLEFT",TOPCENTER:"TOPCENTER",TOPRIGHT:"TOPRIGHT",BASELINELEFT:"BASELINELEFT",BASELINECENTER:"BASELINECENTER",BASELINERIGHT:"BASELINERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOMCENTER:"BOTTOMCENTER",BOTTOMRIGHT:"BOTTOMRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLECENTER:"MIDDLECENTER",MIDDLERIGHT:"MIDDLERIGHT"},g={NORMAL:"ALONG_LINE_NORMAL",LB_TO_RT:"LEFT_BOTTOM_TO_RIGHT_TOP",LT_TO_RB:"LEFT_TOP_TO_RIGHT_BOTTOM",RB_TO_LT:"RIGHT_BOTTOM_TO_LEFT_TOP",RT_TO_LB:"RIGHT_TOP_TO_LEFT_BOTTOM"},v={DIAMOND:"DIAMOND",ELLIPSE:"ELLIPSE",MARKER:"MARKER",NONE:"NONE",RECT:"RECT",ROUNDRECT:"ROUNDRECT",TRIANGLE:"TRIANGLE"},b={NEWLINE:"NEWLINE",NONE:"NONE",OMIT:"OMIT"},S={FLAT:"FLAT",ROUND:"ROUND"},_={CLIP:"CLIP",ERASE:"ERASE",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",UNION:"UNION",UPDATE:"UPDATE",XOR:"XOR"},x={INDEXEDHDFS:"INDEXEDHDFS",UDB:"UDB",MONGODB:"MONGODB",PG:"PG"},w={BSPLINE:"BSPLINE",POLISH:"POLISH"},C={ISOLINE:"ISOLINE",ISOREGION:"ISOREGION"},M={DATASET_AND_RECORDSET:"DATASET_AND_RECORDSET",DATASET_ONLY:"DATASET_ONLY",RECORDSET_ONLY:"RECORDSET_ONLY"},A={ADD:"add",UPDATE:"update",DELETE:"delete"},T={LESS_TIME:"LESS_TIME",LESS_TRANSFER:"LESS_TRANSFER",LESS_WALK:"LESS_WALK",MIN_DISTANCE:"MIN_DISTANCE"},E={BUS:"BUS",SUBWAY:"SUBWAY",NO_SUBWAY:"NO_SUBWAY",NONE:"NONE"},O={EXPONENTIAL:"EXPONENTIAL",GAUSSIAN:"GAUSSIAN",SPHERICAL:"SPHERICAL"},P={EXP1:"EXP1",EXP2:"EXP2"},N={IP:"IP",REFERER:"Referer",REQUESTIP:"RequestIP",NONE:"NONE",SERVER:"SERVER",WEB:"WEB"},I={CLIP:"clip",INTERSECT:"intersect"},F={SQUAREMETER:"SquareMeter",SQUAREKILOMETER:"SquareKiloMeter",HECTARE:"Hectare",ARE:"Are",ACRE:"Acre",SQUAREFOOT:"SquareFoot",SQUAREYARD:"SquareYard",SQUAREMILE:"SquareMile"},k={METER:"Meter",KILOMETER:"Kilometer",YARD:"Yard",FOOT:"Foot",MILE:"Mile"},D={MAX:"max",MIN:"min",AVERAGE:"average",SUM:"sum",VARIANCE:"variance",STDDEVIATION:"stdDeviation"},R={SUMMARYMESH:"SUMMARYMESH",SUMMARYREGION:"SUMMARYREGION"},B={REGIONNOOVERLAP:"REGIONNOOVERLAP",REGIONNOOVERLAPWITH:"REGIONNOOVERLAPWITH",REGIONCONTAINEDBYREGION:"REGIONCONTAINEDBYREGION",REGIONCOVEREDBYREGION:"REGIONCOVEREDBYREGION",LINENOOVERLAP:"LINENOOVERLAP",LINENOOVERLAPWITH:"LINENOOVERLAPWITH",POINTNOIDENTICAL:"POINTNOIDENTICAL"},G={GEOHASH_GRID:"geohash_grid"},U={AVG:"avg",MAX:"max",MIN:"min",SUM:"sum"},j={NDVI:"NDVI",HILLSHADE:"HILLSHADE"},z={CUSTOM:"CUSTOM",INTERSECTION:"INTERSECTION",UNION:"UNION"},V={CUSTOM:"CUSTOM",MAX:"MAX",MIN:"MIN"};class J{constructor(t,e){this.w=t?parseFloat(t):0,this.h=t?parseFloat(e):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new J(this.w,this.h)}equals(t){var e=!1;return null!=t&&(e=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),e}destroy(){this.w=null,this.h=null}}class q{constructor(t,e,r){this.x=t?parseFloat(t):0,this.y=e?parseFloat(e):0,this.mode=r,this.CLASS_NAME="SuperMap.Pixel"}toString(){return"x="+this.x+",y="+this.y}clone(){return new q(this.x,this.y,this.mode)}equals(t){var e=!1;return null!=t&&(e=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,e){if(null==t||null==e)throw new TypeError("Pixel.add cannot receive null values");return new q(this.x+t,this.y+e)}offset(t){var e=this.clone();return t&&(e=this.add(t.x,t.y)),e}destroy(){this.x=null,this.y=null,this.mode=null}}q.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"};var H=function(...t){class e{constructor(e){for(var r=0;r<t.length;r++)s(this,new t[r](e))}}for(var r=0;r<t.length;r++){var i=t[r];s(e,i),s(e.prototype,i.prototype),s(e.prototype,new i)}return e;function s(t,e){var r=Object.getOwnPropertyNames(e);Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i++){var s=r[i];if("constructor"!==s&&"prototype"!==s&&"name"!==s&&"length"!==s){let r=Object.getOwnPropertyDescriptor(e,s);window.ActiveXObject?Object.defineProperty(t,s,r||{}):Object.defineProperty(t,s,r)}}}},W={startsWith:function(t,e){return 0==t.indexOf(e)},contains:function(t,e){return-1!=t.indexOf(e)},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(t){for(var e=t.split("-"),r=e[0],i=1,s=e.length;i<s;i++){var n=e[i];r+=n.charAt(0).toUpperCase()+n.substring(1)}return r},format:function(t,e,r){e||(e=window);return t.replace(W.tokenRegEx,function(t,i){for(var s,n=i.split(/\.+/),a=0;a<n.length;a++)0==a&&(s=e),s=s[n[a]];return"function"==typeof s&&(s=r?s.apply(null,r):s()),void 0===s?"undefined":s})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(t){return W.numberRegEx.test(t)},numericIf:function(t){return W.isNumeric(t)?parseFloat(t):t}},Y={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(t,e){var r=0;return e>0&&(r=parseFloat(t.toPrecision(e))),r},format:function(t,e,r,i){e=void 0!==e?e:0,r=void 0!==r?r:Y.thousandsSeparator,i=void 0!==i?i:Y.decimalSeparator,null!=e&&(t=parseFloat(t.toFixed(e)));var s=t.toString().split(".");1===s.length&&null==e&&(e=0);var n,a=s[0];if(r)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(a);)a=a.replace(o,"$1"+r+"$2");if(0==e)n=a;else{var l=s.length>1?s[1]:"0";null!=e&&(l+=new Array(e-l.length+1).join("0")),n=a+i+l}return n}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(t){return Y.limitSigDigs(this,t)});var X={bind:function(t,e){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var i=r.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,i)}},bindAsEventListener:function(t,e){return function(r){return t.call(e,r||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Q={filter:function(t,e,r){var i=[];if(Array.prototype.filter)i=t.filter(e,r);else{var s=t.length;if("function"!=typeof e)throw new TypeError;for(var n=0;n<s;n++)if(n in t){var a=t[n];e.call(r,a,n,t)&&i.push(a)}}return i}};class Z{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=rt.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new Z}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){this.getBounds()?this.bounds.extend(t):this.setBounds(t)}getBounds(){return null==this.bounds&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}const K=function(){var t,e="",r="",i="pc",s=navigator.userAgent.toLowerCase();return s.indexOf("msie")>-1||s.indexOf("trident")>-1&&s.indexOf("rv")>-1?(e="msie",t=s.match(/msie ([\d.]+)/)||s.match(/rv:([\d.]+)/)):s.indexOf("chrome")>-1?(e="chrome",t=s.match(/chrome\/([\d.]+)/)):s.indexOf("firefox")>-1?(e="firefox",t=s.match(/firefox\/([\d.]+)/)):s.indexOf("opera")>-1?(e="opera",t=s.match(/version\/([\d.]+)/)):s.indexOf("safari")>-1&&(e="safari",t=s.match(/version\/([\d.]+)/)),r=t?t[1]:"",s.indexOf("ipad")>-1||s.indexOf("ipod")>-1||s.indexOf("iphone")>-1?i="apple":s.indexOf("android")>-1&&(r=(t=s.match(/version\/([\d.]+)/))?t[1]:"",i="android"),{name:e,version:r,device:i}}(),$=function(){var t=!0,e=K;return document.createElement("canvas").getContext?("firefox"===e.name&&parseFloat(e.version)<5&&(t=!1),"safari"===e.name&&parseFloat(e.version)<4&&(t=!1),"opera"===e.name&&parseFloat(e.version)<10&&(t=!1),"msie"===e.name&&parseFloat(e.version)<9&&(t=!1)):t=!1,t}(),tt=function(){var t=navigator.userAgent.toLowerCase();return-1===t.indexOf("webkit")&&-1!==t.indexOf("gecko")}(),et=96,rt={assign(t){for(var e=0;e<Object.getOwnPropertyNames(arguments).length;e++){var r=Object.getOwnPropertyNames(arguments)[e];if("caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r){var i=arguments[r];if(i)for(var s=0;s<Object.getOwnPropertyNames(i).length;s++){var n=Object.getOwnPropertyNames(i)[s];"caller"!=r&&"callee"!=r&&"length"!=r&&"arguments"!=r&&(t[n]=i[n])}}}return t},extend:function(t,e){if(t=t||{},e){for(var r in e){var i=e[r];void 0!==i&&(t[r]=i)}!("function"==typeof window.Event&&e instanceof window.Event)&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},copy:function(t,e){var r;if(t=t||{},e)for(var i in t)void 0!==(r=e[i])&&(t[i]=r)},reset:function(t){for(var e in t=t||{})if(t.hasOwnProperty(e)){if("object"==typeof t[e]&&t[e]instanceof Array){for(var r in t[e])t[e][r].destroy&&t[e][r].destroy();t[e].length=0}else"object"==typeof t[e]&&t[e]instanceof Object&&t[e].destroy&&t[e].destroy();t[e]=null}},getElement:function(){for(var t=[],e=0,r=arguments.length;e<r;e++){var i=arguments[e];if("string"==typeof i&&(i=document.getElementById(i)),1===arguments.length)return i;t.push(i)}return t},isElement:function(t){return!(!t||1!==t.nodeType)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},removeItem:function(t,e){for(var r=t.length-1;r>=0;r--)t[r]===e&&t.splice(r,1);return t},indexOf:function(t,e){if(null==t)return-1;if("function"==typeof t.indexOf)return t.indexOf(e);for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},modifyDOMElement:function(t,e,r,i,s,n,a,o){e&&(t.id=e),r&&(t.style.left=r.x+"px",t.style.top=r.y+"px"),i&&(t.style.width=i.w+"px",t.style.height=i.h+"px"),s&&(t.style.position=s),n&&(t.style.border=n),a&&(t.style.overflow=a),parseFloat(o)>=0&&parseFloat(o)<1?(t.style.filter="alpha(opacity="+100*o+")",t.style.opacity=o):1===parseFloat(o)&&(t.style.filter="",t.style.opacity="")},applyDefaults:function(t,e){t=t||{};var r="function"==typeof window.Event&&e instanceof window.Event;for(var i in e)(void 0===t[i]||!r&&e.hasOwnProperty&&e.hasOwnProperty(i)&&!t.hasOwnProperty(i))&&(t[i]=e[i]);return!r&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},getParameterString:function(t){var e=[];for(var r in t){var i,s=t[r];if(null!=s&&"function"!=typeof s)i=Array.isArray(s)||"[object Object]"===s.toString()?encodeURIComponent(JSON.stringify(s)):encodeURIComponent(s),e.push(encodeURIComponent(r)+"="+i)}return e.join("&")},urlAppend:function(t,e){var r=t;if(e){0===e.indexOf("?")&&(e=e.substring(1));var i=(t+" ").split(/[?&]/);r+=" "===i.pop()?e:i.length?"&"+e:"?"+e}return r},urlPathAppend:function(t,e){let r=t;if(!e)return r;0===e.indexOf("/")&&(e=e.substring(1));const i=t.split("?");return i[0].indexOf("/",i[0].length-1)<0&&(i[0]+="/"),r=`${i[0]}${e}${i.length>1?`?${i[1]}`:""}`},DEFAULT_PRECISION:14,toFloat:function(t,e){return null==e&&(e=rt.DEFAULT_PRECISION),"number"!=typeof t&&(t=parseFloat(t)),0===e?t:parseFloat(t.toPrecision(e))},rad:function(t){return t*Math.PI/180},getParameters:function(t){t=null===t||void 0===t?window.location.href:t;var e="";if(W.contains(t,"?")){var r=t.indexOf("?")+1,i=W.contains(t,"#")?t.indexOf("#"):t.length;e=t.substring(r,i)}for(var s={},n=e.split(/[&;]/),a=0,o=n.length;a<o;++a){var l=n[a].split("=");if(l[0]){var h=l[0];try{h=decodeURIComponent(h)}catch(t){h=unescape(h)}var u=(l[1]||"").replace(/\+/g," ");try{u=decodeURIComponent(u)}catch(t){u=unescape(u)}1==(u=u.split(",")).length&&(u=u[0]),s[h]=u}}return s},lastSeqID:0,createUniqueID:function(t){return null==t&&(t="id_"),rt.lastSeqID+=1,t+rt.lastSeqID},normalizeScale:function(t){return t>1?1/t:t},getResolutionFromScale:function(t,e){var r;t&&(null==e&&(e="degrees"),r=1/(rt.normalizeScale(t)*it[e]*et));return r},getScaleFromResolution:function(t,e){return null==e&&(e="degrees"),t*it[e]*et},getBrowser:function(){return K},isSupportCanvas:$,supportCanvas:function(){return rt.isSupportCanvas},isInTheSameDomain:function(t){if(!t)return!0;var e=t.indexOf("//"),r=document.location.toString(),i=r.indexOf("//");if(-1===e)return!0;var s,n=s=t.substring(0,e),a=r.substring(i+2);i=a.indexOf("/");var o=a.indexOf(":"),l=a.substring(0,i),h=document.location.protocol;if(-1!==o||(l+=":"+("http:"===h.toLowerCase()?80:443)),h.toLowerCase()!==n.toLowerCase())return!1;var u=(n=t.substring(e+2)).indexOf(":");e=n.indexOf("/");var c,d=n.substring(0,e);return-1!==u?c=n.substring(0,u):(c=n.substring(0,e),d+=":"+("http:"===s.toLowerCase()?80:443)),c===document.domain&&d===l},calculateDpi:function(t,e,r,i,s){if(t&&e&&r){var n,a=t.getWidth(),o=t.getHeight(),l=e.w,h=e.h;if(s=s||6378137,"degree"===(i=i||"degrees").toLowerCase()||"degrees"===i.toLowerCase()||"dd"===i.toLowerCase()){let t=a/l,e=o/h;n=254/(t>e?t:e)/r/(2*Math.PI*s/360)/1e4}else{n=254/(a/l)/r/1e4}return n}},toJSON:function(t){var e=t;if(null==e)return null;switch(e.constructor){case String:return e=(e=(e=(e=(e=(e=(e='"'+e.replace(/(["\\])/g,"\\$1")+'"').replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace("<","&lt;")).replace(">","&gt;")).replace(/%/g,"%25")).replace(/&/g,"%26");case Array:for(var r="",i=0,s=e.length;i<s;i++)r+=rt.toJSON(e[i]),i!==e.length-1&&(r+=",");return"["+r+"]";case Number:return isFinite(e)?String(e):null;case Boolean:return String(e);case Date:return"{'__type':\"System.DateTime\",'Year':"+e.getFullYear()+",'Month':"+(e.getMonth()+1)+",'Day':"+e.getDate()+",'Hour':"+e.getHours()+",'Minute':"+e.getMinutes()+",'Second':"+e.getSeconds()+",'Millisecond':"+e.getMilliseconds()+",'TimezoneOffset':"+e.getTimezoneOffset()+"}";default:if(null!=e.toJSON&&"function"==typeof e.toJSON)return e.toJSON();if("object"==typeof e){if(e.length){let t=[];for(let r=0,i=e.length;r<i;r++)t.push(rt.toJSON(e[r]));return"["+t.join(",")+"]"}let t=[];for(let r in e)"function"!=typeof e[r]&&"CLASS_NAME"!==r&&"parent"!==r&&t.push("'"+r+"':"+rt.toJSON(e[r]));return t.length>0?"{"+t.join(",")+"}":"{}"}return e.toString()}},getResolutionFromScaleDpi:function(t,e,r,i){return i=i||6378137,r=r||"",t>0&&e>0?(t=rt.normalizeScale(t),"degree"===r.toLowerCase()||"degrees"===r.toLowerCase()||"dd"===r.toLowerCase()?254/e/t/(2*Math.PI*i/360)/1e4:254/e/t/1e4):-1},getScaleFromResolutionDpi:function(t,e,r,i){return i=i||6378137,r=r||"",t>0&&e>0?"degree"===r.toLowerCase()||"degrees"===r.toLowerCase()||"dd"===r.toLowerCase()?254/e/t/(2*Math.PI*i/360)/1e4:254/e/t/1e4:-1},transformResult:function(t){return t.responseText&&"string"==typeof t.responseText&&(t=JSON.parse(t.responseText)),t},copyAttributes:function(t,e){if(t=t||{},e)for(var r in e){var i=e[r];void 0!==i&&"CLASS_NAME"!==r&&"function"!=typeof i&&(t[r]=i)}return t},copyAttributesWithClip:function(t,e,r){if(t=t||{},e)for(var i in e){var s=!1;if(r&&r.length)for(var n=0,a=r.length;n<a;n++)if(i===r[n]){s=!0;break}if(!0!==s){var o=e[i];void 0!==o&&"CLASS_NAME"!==i&&"function"!=typeof o&&(t[i]=o)}}return t},cloneObject:function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date){let e=new Date;return e.setTime(t.getTime()),e}if(t instanceof Array){return t.slice(0)}if(t instanceof Object){let r={};for(var e in t)t.hasOwnProperty(e)&&(r[e]=rt.cloneObject(t[e]));return r}throw new Error("Unable to copy obj! Its type isn't supported.")},lineIntersection:function(t,e,r,i){var s,n,a=null,o=(i.x-r.x)*(t.y-r.y)-(i.y-r.y)*(t.x-r.x),l=(e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x),h=(i.y-r.y)*(e.x-t.x)-(i.x-r.x)*(e.y-t.y);if(0!=h)n=l/h,a=(s=o/h)>=0&&n<=1&&s<=1&&n>=0?new Z.Point(t.x+s*(e.x-t.x),t.y+s*(e.y-t.y)):"No Intersection";else if(0==o&&0==l){var u=Math.max(t.y,e.y),c=Math.min(t.y,e.y),d=Math.max(t.x,e.x),p=Math.min(t.x,e.x);a=(r.y>=c&&r.y<=u||i.y>=c&&i.y<=u)&&r.x>=p&&r.x<=d||i.x>=p&&i.x<=d?"Coincident":"Parallel"}else a="Parallel";return a},getTextBounds:function(t,e,r){document.body.appendChild(r),r.style.width="auto",r.style.height="auto",t.fontSize&&(r.style.fontSize=t.fontSize),t.fontFamily&&(r.style.fontFamily=t.fontFamily),t.fontWeight&&(r.style.fontWeight=t.fontWeight),r.style.position="relative",r.style.visibility="hidden",r.style.display="inline-block",r.innerHTML=e;var i=r.clientWidth,s=r.clientHeight;return document.body.removeChild(r),{textWidth:i,textHeight:s}},convertPath:function(t,e){return e?t.replace(/\{([\w-\.]+)\}/g,(t,r)=>{var i;return i=e.hasOwnProperty(r)?function(t){if(void 0==t||null==t)return"";if(t instanceof Date)return t.toJSON();if(function(t){if("string"!=typeof t&&"object"!=typeof t)return!1;try{const e=t.toString();return"[object Object]"===e||"[object Array]"===e}catch(t){return!1}}(t))return JSON.stringify(t);return t.toString()}(e[r]):t,encodeURIComponent(i)}):t}},it={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};it.in=it.inches,it.degrees=it.dd,it.nmi=1852*it.m;const st=.0254000508001016;rt.extend(it,{Inch:it.inches,Meter:39.37,Foot:12,IFoot:11.999976,ClarkeFoot:11.999868327581488,SearsFoot:11.999955194477684,GoldCoastFoot:11.999964589846002,IInch:.9999979999999999,MicroInch:999998e-9,Mil:9.99998e-7,Centimeter:.3937,Kilometer:39370,Yard:36,SearsYard:35.99986558343306,IndianYard:35.99987015540864,IndianYd37:35.999740205100004,IndianYd62:35.999880755999996,IndianYd75:35.999868945,IndianFoot:11.9999567087,IndianFt37:11.9999134017,IndianFt62:11.999960252000001,IndianFt75:11.999956315,Mile:63360,IYard:35.999928,IMile:63359.87328,NautM:72913.24,"Lat-66":4367838.370169282,"Lat-83":4367954.152606599,Decimeter:3.9370000000000003,Millimeter:.03937,Dekameter:393.7,Decameter:393.7,Hectometer:3937,GermanMeter:39.370535294205006,CaGrid:39.359685060000004,ClarkeChain:791.991309620512,GunterChain:792.0000000000001,BenoitChain:791.9977268035781,SearsChain:791.9970428354235,ClarkeLink:7.91991309620512,GunterLink:7.920000000000001,BenoitLink:7.919977268035781,SearsLink:7.919970428354236,Rod:198.00000000000014,IntnlChain:791.998416,IntnlLink:7.91998416,Perch:198.00000000000014,Pole:198.00000000000014,Furlong:7919.999999999997,Rood:148.75036777426,CapeFoot:11.999868185255002,Brealey:14763.75,ModAmFt:12.000458400000001,Fathom:71.999856,"NautM-UK":72959.85408,"50kilometers":1968500,"150kilometers":5905500}),rt.extend(it,{mm:it.Meter/1e3,cm:it.Meter/100,dm:100*it.Meter,km:1e3*it.Meter,kmi:it.nmi,fath:it.Fathom,ch:it.IntnlChain,link:it.IntnlLink,"us-in":it.inches,"us-ft":it.Foot,"us-yd":it.Yard,"us-ch":it.GunterChain,"us-mi":it.Mile,"ind-yd":it.IndianYd37,"ind-ft":it.IndianFt37,"ind-ch":791.9942845122}),it.degree=it.dd,it.meter=it.m,it.foot=it.ft,it.inch=it.inches,it.mile=it.mi,it.kilometer=it.km,it.yard=it.yd;class nt{constructor(t,e){rt.isArray(t)&&(e=t[1],t=t[0]),this.lon=t?rt.toFloat(t):0,this.lat=e?rt.toFloat(e):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new nt(this.lon,this.lat)}add(t,e){if(null==t||null==e)throw new TypeError("LonLat.add cannot receive null values");return new nt(this.lon+rt.toFloat(t),this.lat+rt.toFloat(e))}equals(t){var e=!1;return null!=t&&(e=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),e}wrapDateLine(t){var e=this.clone();if(t){for(;e.lon<t.left;)e.lon+=t.getWidth();for(;e.lon>t.right;)e.lon-=t.getWidth()}return e}destroy(){this.lon=null,this.lat=null}static fromString(t){var e=t.split(",");return new nt(e[0],e[1])}static fromArray(t){var e=rt.isArray(t),r=e&&t[0],i=e&&t[1];return new nt(r,i)}}class at{constructor(t,e,r,i){rt.isArray(t)&&(i=t[3],r=t[2],e=t[1],t=t[0]),this.left=null!=t?rt.toFloat(t):this.left,this.bottom=null!=e?rt.toFloat(e):this.bottom,this.right=null!=r?rt.toFloat(r):this.right,this.top=null!=i?rt.toFloat(i):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new at(this.left,this.bottom,this.right,this.top)}equals(t){var e=!1;return null!=t&&(e=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),e}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return!0===t?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,e){null==t&&(t=6);var r=Math.pow(10,t),i=Math.round(this.left*r)/r,s=Math.round(this.bottom*r)/r,n=Math.round(this.right*r)/r,a=Math.round(this.top*r)/r;return!0===e?s+","+i+","+a+","+n:i+","+s+","+n+","+a}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new J(this.getWidth(),this.getHeight())}getCenterPixel(){return new q((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new nt((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,e){var r,i;t=t||1,null==e&&(e=this.getCenterLonLat()),"SuperMap.LonLat"===e.CLASS_NAME?(r=e.lon,i=e.lat):(r=e.x,i=e.y);var s=(this.left-r)*t+r,n=(this.bottom-i)*t+i,a=(this.right-r)*t+r,o=(this.top-i)*t+i;return new at(s,n,a,o)}add(t,e){if(null==t||null==e)throw new TypeError("Bounds.add cannot receive null values");return new at(this.left+t,this.bottom+e,this.right+t,this.top+e)}extend(t){var e=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":e=new at(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":e=new at(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":e=t}e&&(this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top))}}containsLonLat(t,e){"boolean"==typeof e&&(e={inclusive:e}),e=e||{};var r=this.contains(t.lon,t.lat,e.inclusive),i=e.worldBounds;if(i&&!r){var s=i.getWidth(),n=(i.left+i.right)/2,a=Math.round((t.lon-n)/s);r=this.containsLonLat({lon:t.lon-a*s,lat:t.lat},{inclusive:e.inclusive})}return r}containsPixel(t,e){return this.contains(t.x,t.y,e)}contains(t,e,r){if(null==r&&(r=!0),null==t||null==e)return!1;return r?t>=this.left&&t<=this.right&&e>=this.bottom&&e<=this.top:t>this.left&&t<this.right&&e>this.bottom&&e<this.top}intersectsBounds(t,e){if("boolean"==typeof e&&(e={inclusive:e}),(e=e||{}).worldBounds){var r=this.wrapDateLine(e.worldBounds);t=t.wrapDateLine(e.worldBounds)}else r=this;null==e.inclusive&&(e.inclusive=!0);var i=!1,s=r.left===t.right||r.right===t.left||r.top===t.bottom||r.bottom===t.top;if(e.inclusive||!s){var n=t.bottom>=r.bottom&&t.bottom<=r.top||r.bottom>=t.bottom&&r.bottom<=t.top,a=t.top>=r.bottom&&t.top<=r.top||r.top>t.bottom&&r.top<t.top,o=t.left>=r.left&&t.left<=r.right||r.left>=t.left&&r.left<=t.right,l=t.right>=r.left&&t.right<=r.right||r.right>=t.left&&r.right<=t.right;i=(n||a)&&(o||l)}if(e.worldBounds&&!i){var h=e.worldBounds,u=h.getWidth(),c=!h.containsBounds(r),d=!h.containsBounds(t);c&&!d?(t=t.add(-u,0),i=r.intersectsBounds(t,{inclusive:e.inclusive})):d&&!c&&(r=r.add(-u,0),i=t.intersectsBounds(r,{inclusive:e.inclusive}))}return i}containsBounds(t,e,r){null==e&&(e=!1),null==r&&(r=!0);var i=this.contains(t.left,t.bottom,r),s=this.contains(t.right,t.bottom,r),n=this.contains(t.left,t.top,r),a=this.contains(t.right,t.top,r);return e?i||s||n||a:i&&s&&n&&a}determineQuadrant(t){var e="",r=this.getCenterLonLat();return e+=t.lat<r.lat?"b":"t",e+=t.lon<r.lon?"l":"r"}wrapDateLine(t,e){var r=(e=e||{}).leftTolerance||0,i=e.rightTolerance||0,s=this.clone();if(t){for(var n=t.getWidth();s.left<t.left&&s.right-i<=t.left;)s=s.add(n,0);for(;s.left+r>=t.right&&s.right>t.right;)s=s.add(-n,0);var a=s.left+r;a<t.right&&a>t.left&&s.right-i>t.right&&(s=s.add(-n,0))}return s}toServerJSONObject(){return{rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom}}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,e){var r=t.split(",");return at.fromArray(r,e)}static fromArray(t,e){return!0===e?new at(t[1],t[0],t[3],t[2]):new at(t[0],t[1],t[2],t[3])}static fromSize(t){return new at(0,t.h,t.w,0)}static oppositeQuadrant(t){var e="";return e+="t"===t.charAt(0)?"b":"t",e+="l"===t.charAt(1)?"r":"l"}}class ot extends Z{constructor(t){super(),this.components=[],this.componentTypes=null,null!=t&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){for(var t=new ot,e=0,r=this.components.length;e<r;e++)t.addComponent(this.components[e].clone());return rt.applyDefaults(t,this),t}getComponentsString(){for(var t=[],e=0,r=this.components.length;e<r;e++)t.push(this.components[e].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;var t=new at,e=this.components;if(e)for(var r=0,i=e.length;r<i;r++)t.extend(e[r].getBounds());null!=t.left&&null!=t.bottom&&null!=t.right&&null!=t.top&&this.setBounds(t)}addComponents(t){rt.isArray(t)||(t=[t]);for(var e=0,r=t.length;e<r;e++)this.addComponent(t[e])}addComponent(t,e){var r=!1;if(t&&(null==this.componentTypes||rt.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(null!=e&&e<this.components.length){var i=this.components.slice(0,e),s=this.components.slice(e,this.components.length);i.push(t),this.components=i.concat(s)}else this.components.push(t);t.parent=this,this.clearBounds(),r=!0}return r}removeComponents(t){var e=!1;rt.isArray(t)||(t=[t]);for(var r=t.length-1;r>=0;--r)e=this.removeComponent(t[r])||e;return e}removeComponent(t){return rt.removeItem(this.components,t),this.clearBounds(),!0}getArea(){for(var t=0,e=0,r=this.components.length;e<r;e++)t+=this.components[e].getArea();return t}equals(t){var e=!0;if(t&&t.CLASS_NAME&&this.CLASS_NAME===t.CLASS_NAME)if(rt.isArray(t.components)&&t.components.length===this.components.length){for(var r=0,i=this.components.length;r<i;++r)if(!this.components[r].equals(t.components[r])){e=!1;break}}else e=!1;else e=!1;return e}getVertices(t){for(var e=[],r=0,i=this.components.length;r<i;++r)Array.prototype.push.apply(e,this.components[r].getVertices(t));return e}}class lt extends ot{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,e){this.addComponent(t,e)}removePoint(t){this.removeComponent(t)}}class ht extends lt{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}class ut extends Z{constructor(t,e,r,i){super(t,e,r,i),this.x=parseFloat(t),this.y=parseFloat(e),this.tag=i||0==i?parseFloat(i):null,this.type=r||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return null==t&&(t=new ut(this.x,this.y)),rt.applyDefaults(t,this),t}calculateBounds(){this.bounds=new at(this.x,this.y,this.x,this.y)}equals(t){var e=!1;return null!=t&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}move(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(){return[this]}}class ct extends ht{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){var e=this.components&&this.components.length>2;return e&&super.removeComponent.apply(this,arguments),e}getSortedSegments(){for(var t,e,r=this.components.length-1,i=new Array(r),s=0;s<r;++s)t=this.components[s],e=this.components[s+1],t.x<e.x?i[s]={x1:t.x,y1:t.y,x2:e.x,y2:e.y}:i[s]={x1:e.x,y1:e.y,x2:t.x,y2:t.y};return i.sort(function(t,e){return t.x1-e.x1})}getVertices(t){return!0===t?[this.components[0],this.components[this.components.length-1]]:!1===t?this.components.slice(1,this.components.length-1):this.components.slice()}static calculateCircle(t){if(t.length<3)return t;var e={},r=t[0],i=t[1],s=t[2],n=0,a=0,o=!0,l=0,h=0,u=0,c=[],d=(s.y-r.y)/(s.x-r.x),p=s.y-d*s.x;if(s.x!=r.x&&s.y!=r.y&&i.y==d*i.x+p||s.x==r.x&&i.x==r.x||s.y==r.y&&i.y==r.y||s.x==r.x&&s.y==r.y||s.x==i.x&&s.y==i.y||r.x==i.x&&r.y==i.y)c.push(r),c.push(i),c.push(s);else{var f=(i.x*i.x+i.y*i.y-(r.x*r.x+r.y*r.y))*(2*(s.y-r.y))-(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y))*(2*(i.y-r.y)),m=2*(i.x-r.x)*(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y))-2*(s.x-r.x)*(i.x*i.x+i.y*i.y-(r.x*r.x+r.y*r.y)),y=4*((i.x-r.x)*(s.y-r.y)-(s.x-r.x)*(i.y-r.y));e.x=f/y,e.y=m/y;var g=(2*(n=Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y)))*n-((r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y)))/(2*n*n);g=(g=g>=1?1:g)<=-1?-1:g,u=180*Math.acos(g)/Math.PI,a=(u=s.x==r.x?e.x>r.x&&i.x>r.x||e.x<r.x&&i.x<r.x?360-u:u:e.y>d*e.x+p&&i.y>d*i.x+p||e.y<d*e.x+p&&i.y<d*i.x+p?360-u:u)/72,s.y!=r.y?s.x==r.x?s.y>r.y?i.x<r.x&&(o=!1):i.x>r.x&&(o=!1):s.x<r.x?i.y<d*i.x+p&&(o=!1):i.y>d*i.x+p&&(o=!1):s.x>r.x?i.y>r.y&&(o=!1):i.y<r.y&&(o=!1);var v=(r.y-e.y)/(r.x-e.x),b=v>=0?180*Math.atan(v)/Math.PI:Math.abs(180*Math.atan(v)/Math.PI)+90,S=Math.abs(e.y);r.y==S&&S==s.y&&r.x<s.x&&(b+=180);var _=r.y-e.y;c.push(r);for(var x=1;x<72;x++){l=a*x,h=b,o?_>=0?v>=0?h+=l:h=180-(h-90)+l:h=v>0?h-180+l:90-h+l:_>=0?v>=0?h-=l:h=180-(h-90)-l:h=v>=0?h-180-l:90-h-l,h=h*Math.PI/180;var w=e.x+n*Math.cos(h),C=e.y+n*Math.sin(h);c.push(new ut(w,C))}c.push(s)}return c}static createLineEPS(t){var e=[],r=t.length;if(r<2)return t;for(var i=0;i<r;){if("LTypeArc"==t[i].type){var s=ct.createLineArc(e,i,r,t);e=s[0],i=s[1]}else e.push(t[i]),i++}return e}static createLineArc(t,e,r,i){if(0==e){let s=ct.addPointEPS(i,e,r,"LTypeArc");Array.prototype.push.apply(t,s[0]),e=s[1]+1}else if(e==r-1){var s=[i[e-1],i[e]],n=ct.calculateCircle(s);Array.prototype.push.apply(t,n),e++}else{let s=ct.addPointEPS(i,e,r,"LTypeArc");t.pop(),Array.prototype.push.apply(t,s[0]),e=s[1]+1}return[t,e]}static addPointEPS(t,e,r,i){var s,n=[],a=e+1;return 0==e?Array.prototype.push.apply(n,[t[e],t[e+1]]):e==r-1?Array.prototype.push.apply(n,[t[e-1],t[e]]):Array.prototype.push.apply(n,[t[e-1],t[e],t[e+1]]),"LTypeCurve"==i?s=ct.calculatePointsFBZN(n):"LTypeArc"==i&&(s=ct.calculateCircle(n)),[s,a]}}class dt extends Z{constructor(t,e,r){super(t,e,r),this.x=parseFloat(t),this.y=parseFloat(e),this.text=r.toString(),this.bsInfo={h:null,w:null},this.element=document.createElement("span"),this.CLASS_NAME="SuperMap.Geometry.GeoText",this.geometryType="GeoText"}destroy(){super.destroy(),this.x=null,this.y=null,this.text=null}getCentroid(){return new ut(this.x,this.y)}clone(t){return null==t&&(t=new dt(this.x,this.y,this.text)),rt.applyDefaults(t,this),t}calculateBounds(){this.bounds=new at(this.x,this.y,this.x,this.y)}getLabelPxBoundsByLabel(t,e,r,i){var s,n,a,o,l=rt.cloneObject(t),h=(i.label||this.text).split("\n").length;if(e=parseFloat(e),r=parseFloat(r),h>1&&(r=parseFloat(r)*h),i.labelAlign&&"cm"!==i.labelAlign)switch(i.labelAlign){case"lt":l.x+=e/2,l.y+=r/2;break;case"lm":l.x+=e/2;break;case"lb":l.x+=e/2,l.y-=r/2;break;case"ct":l.y+=r/2;break;case"cb":l.y-=r/2;break;case"rt":l.x-=e/2,l.y+=r/2;break;case"rm":l.x-=e/2;break;case"rb":l.x-=e/2,l.y-=r/2}return this.bsInfo.h=r,this.bsInfo.w=e,s=l.x-parseFloat(e)/2,n=l.y+parseFloat(r)/2,o=l.x+parseFloat(e)/2,a=l.y-parseFloat(r)/2,new at(s,n,o,a)}getLabelPxBoundsByText(t,e){var r,i,s,n,a=this.getLabelPxSize(e),o=rt.cloneObject(t);if(e.labelAlign&&"cm"!==e.labelAlign)switch(e.labelAlign){case"lt":o.x+=a.w/2,o.y+=a.h/2;break;case"lm":o.x+=a.w/2;break;case"lb":o.x+=a.w/2,o.y-=a.h/2;break;case"ct":o.y+=a.h/2;break;case"cb":o.y-=a.h/2;break;case"rt":o.x-=a.w/2,o.y+=a.h/2;break;case"rm":o.x-=a.w/2;break;case"rb":o.x-=a.w/2,o.y-=a.h/2}return this.bsInfo.h=a.h,this.bsInfo.w=a.w,r=o.x-a.w/2,i=o.y+a.h/2,n=e.fontStyle&&"italic"===e.fontStyle?o.x+a.w/2+parseInt(parseFloat(e.fontSize)/2):o.x+a.w/2,s=o.y-a.h/2,new at(r,i,n,s)}getLabelPxSize(t){var e,r,i,s,n=parseFloat(t.strokeWidth);e=t.label||this.text,r=t.fontSize?parseFloat(t.fontSize):parseFloat("12px");var a=e.split("\n"),o=a.length;s=o>1?r*o+o+n+.2*r:r+n+.2*r+1,i=0,this.labelWTmp&&i<this.labelWTmp&&(i=this.labelWTmp);for(var l=0;l<o;l++){var h=this.getTextCount(a[l]),u=this.labelWTmp=rt.getTextBounds(t,a[l],this.element).textWidth+1*h.textC+n;i<u&&(i=u)}var c=new Object;return c.h=s,c.w=i,c}getTextCount(t){for(var e={},r=0,i=0,s=0;s<t.length;s++)t.charCodeAt(s)>255?r++:i++;return e.cnC=r,e.enC=i,e.textC=t.length,e}}class pt extends ct{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,e){var r=!1,i=this.components.pop();null==e&&t.equals(i)||(r=super.addComponent.apply(this,arguments));var s=this.components[0];return super.addComponent.apply(this,[s]),r}removeComponent(t){var e=this.components&&this.components.length>3;if(e){this.components.pop(),super.removeComponent.apply(this,arguments);var r=this.components[0];super.addComponent.apply(this,[r])}return e}getArea(){var t=0;if(this.components&&this.components.length>2){for(var e=0,r=0,i=this.components.length;r<i-1;r++){var s=this.components[r],n=this.components[r+1];e+=(s.x+n.x)*(n.y-s.y)}t=-e/2}return t}getVertices(t){return!0===t?[]:this.components.slice(0,this.components.length-1)}}class ft extends ot{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}class mt extends ot{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}class yt extends ot{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(var e=1,r=this.components.length;e<r;e++)t-=Math.abs(this.components[e].getArea())}return t}}class gt extends Z{constructor(t,e,r,i){super(t,e,r,i),this.x=t,this.y=e,this.width=r,this.height=i,this.CLASS_NAME="SuperMap.Geometry.Rectangle",this.geometryType="Rectangle"}calculateBounds(){this.bounds=new at(this.x,this.y,this.x+this.width,this.y+this.height)}getArea(){return this.width*this.height}}class vt{constructor(t,e){this.value=t||"",this.name=e||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}vt.CREDENTIAL=null;var bt={toISOString:function(){if("toISOString"in Date.prototype)return function(t){return t.toISOString()};{function t(t,e){for(var r=t+"";r.length<e;)r="0"+r;return r}return function(e){return isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1,2)+"-"+t(e.getUTCDate(),2)+"T"+t(e.getUTCHours(),2)+":"+t(e.getUTCMinutes(),2)+":"+t(e.getUTCSeconds(),2)+"."+t(e.getUTCMilliseconds(),3)+"Z"}}}(),parse:function(t){var e,r=t.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/);if(r&&(r[1]||r[7])){var i=parseInt(r[1],10)||0,s=parseInt(r[2],10)-1||0,n=parseInt(r[3],10)||1;e=new Date(Date.UTC(i,s,n));var a=r[7];if(a){var o=parseInt(r[4],10),l=parseInt(r[5],10),h=parseFloat(r[6]),u=0|h,c=Math.round(1e3*(h-u));if(e.setUTCHours(o,l,u,c),"Z"!==a){var d=-1e3*(60*parseInt(a,10)*60+60*(parseInt(r[8],10)||0));e=new Date(e.getTime()+d)}}}else e=new Date("invalid");return e}},St={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(t){return t.target||t.srcElement},isSingleTouch:function(t){return t.touches&&1===t.touches.length},isMultiTouch:function(t){return t.touches&&t.touches.length>1},isLeftClick:function(t){return t.which&&1===t.which||t.button&&1===t.button},isRightClick:function(t){return t.which&&3===t.which||t.button&&2===t.button},stop:function(t,e){e||(t.preventDefault?t.preventDefault():t.returnValue=!1),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},findElement:function(t,e){for(var r=St.element(t);r.parentNode&&(!r.tagName||r.tagName.toUpperCase()!=e.toUpperCase());)r=r.parentNode;return r},observe:function(t,e,r,i){var s=rt.getElement(t);if(i=i||!1,"keypress"===e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.attachEvent)&&(e="keydown"),this.observers||(this.observers={}),!s._eventCacheID){var n="eventCacheID_";s.id&&(n=s.id+"_"+n),s._eventCacheID=rt.createUniqueID(n)}var a=s._eventCacheID;this.observers[a]||(this.observers[a]=[]),this.observers[a].push({element:s,name:e,observer:r,useCapture:i}),s.addEventListener?"mousewheel"===e?s.addEventListener(e,r,{useCapture:i,passive:!1}):s.addEventListener(e,r,i):s.attachEvent&&s.attachEvent("on"+e,r)},stopObservingElement:function(t){var e=rt.getElement(t)._eventCacheID;this._removeElementObservers(St.observers[e])},_removeElementObservers:function(t){if(t)for(var e=t.length-1;e>=0;e--){var r=t[e],i=new Array(r.element,r.name,r.observer,r.useCapture);St.stopObserving.apply(this,i)}},stopObserving:function(t,e,r,i){i=i||!1;var s=rt.getElement(t),n=s._eventCacheID;"keypress"===e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.detachEvent)&&(e="keydown");var a=!1,o=St.observers[n];if(o)for(var l=0;!a&&l<o.length;){var h=o[l];if(h.name===e&&h.observer===r&&h.useCapture===i){o.splice(l,1),0==o.length&&delete St.observers[n],a=!0;break}l++}return a&&(s.removeEventListener?s.removeEventListener(e,r,i):s&&s.detachEvent&&s.detachEvent("on"+e,r)),a},unloadCache:function(){if(St&&St.observers){for(var t in St.observers){var e=St.observers[t];St._removeElementObservers.apply(this,[e])}St.observers=!1}},CLASS_NAME:"SuperMap.Event"};St.observe(window,"resize",St.unloadCache,!1);class _t{constructor(t,e,r,i,s){if(this.BROWSER_EVENTS=["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown","MSPointerDown","MSPointerUp","pointerdown","pointerup","MSGestureStart","MSGestureChange","MSGestureEnd","contextmenu"],this.listeners={},this.object=t,this.element=null,this.eventTypes=[],this.eventHandler=null,this.fallThrough=i,this.includeXY=!1,this.extensions={},this.extensionCount={},this.clearMouseListener=null,rt.extend(this,s),null!=r)for(var n=0,a=r.length;n<a;n++)this.addEventType(r[n]);null!=e&&this.attachToElement(e),this.CLASS_NAME="SuperMap.Events"}destroy(){for(var t in this.extensions)"boolean"!=typeof this.extensions[t]&&this.extensions[t].destroy();this.extensions=null,this.element&&(St.stopObservingElement(this.element),this.element.hasScrollEvent&&St.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.eventTypes=null,this.fallThrough=null,this.eventHandler=null}addEventType(t){this.listeners[t]||(this.eventTypes.push(t),this.listeners[t]=[])}attachToElement(t){this.element?St.stopObservingElement(this.element):(this.eventHandler=X.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=X.bind(this.clearMouseCache,this)),this.element=t;for(var e=0,r=this.BROWSER_EVENTS.length;e<r;e++){var i=this.BROWSER_EVENTS[e];this.addEventType(i),St.observe(t,i,this.eventHandler)}St.observe(t,"dragstart",St.stop)}on(t){for(var e in t)"scope"!==e&&t.hasOwnProperty(e)&&this.register(e,t.scope,t[e])}register(t,e,r,i){if(t in _t&&!this.extensions[t]&&(this.extensions[t]=new _t[t](this)),null!=r&&-1!==rt.indexOf(this.eventTypes,t)){null==e&&(e=this.object);var s=this.listeners[t];s||(s=[],this.listeners[t]=s,this.extensionCount[t]=0);var n={obj:e,func:r};i?(s.splice(this.extensionCount[t],0,n),"object"==typeof i&&i.extension&&this.extensionCount[t]++):s.push(n)}}registerPriority(t,e,r){this.register(t,e,r,!0)}un(t){for(var e in t)"scope"!==e&&t.hasOwnProperty(e)&&this.unregister(e,t.scope,t[e])}unregister(t,e,r){null==e&&(e=this.object);var i=this.listeners[t];if(null!=i)for(var s=0,n=i.length;s<n;s++)if(i[s].obj===e&&i[s].func===r){i.splice(s,1);break}}remove(t){null!=this.listeners[t]&&(this.listeners[t]=[])}triggerEvent(t,e){var r=this.listeners[t];if(r&&0!=r.length){var i;null==e&&(e={}),e.object=this.object,e.element=this.element,e.type||(e.type=t);for(var s=0,n=(r=r.slice()).length;s<n;s++){var a=r[s];if(void 0!=(i=a.func.apply(a.obj,[e]))&&!1===i)break}return this.fallThrough||St.stop(e,!0),i}}handleBrowserEvent(t){var e=t.type,r=this.listeners[e];if(r&&0!=r.length){var i=t.touches;if(i&&i[0]){for(var s,n=0,a=0,o=i.length,l=0;l<o;++l)n+=(s=i[l]).clientX,a+=s.clientY;t.clientX=n/o,t.clientY=a/o}this.includeXY&&(t.xy=this.getMousePosition(t)),this.triggerEvent(e,t)}}clearMouseCache(){this.element.scrolls=null,this.element.lefttop=null;var t=document.body;t&&(0==t.scrollTop&&0==t.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)}getMousePosition(t){if(this.includeXY?this.element.hasScrollEvent||(St.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var e=rt.getViewportElement();this.element.scrolls=[e.scrollLeft,e.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=rt.pagePosition(this.element)),new q(t.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],t.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])}}_t.prototype.BROWSER_EVENTS=["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown","MSPointerDown","MSPointerUp","pointerdown","pointerup","MSGestureStart","MSGestureChange","MSGestureEnd","contextmenu"];class xt{constructor(t,e,r){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=rt.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=null!=r?r:{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}class wt{constructor(t,e,r){this.red=t||0==t?t:255,this.green=e||0,this.blue=r||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){this.red=null,this.green=null,this.blue=null}static fromJson(t){if(t){var e=new wt,r=255;null!==t.red&&(r=Number(t.red)),e.red=r;var i=0;null!==t.green&&(i=Number(t.green)),e.green=i;var s=0;return null!==t.blue&&(s=Number(t.blue)),e.blue=s,e}}}class Ct{constructor(t){this.fillBackColor=new wt(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new wt(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new wt(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){var t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){var t={};return t=rt.copyAttributes(t,this)}static fromJson(t){if(t)return new Ct({fillBackColor:wt.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:wt.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:wt.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}class Mt extends ut{constructor(t){super(t),this.measure=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){var e=!1;if(null!=t){var r=this.x===t.x&&this.y===t.y&&this.measure===t.measure,i=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),s=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);e=r||i&&s}return e}toJson(){var t="{";return null!=this.measure&&void 0!=this.measure&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}"}destroy(){this.measure=null,this.x=null,this.y=null}static fromJson(t){if(t)return new Mt({x:t.x,y:t.y,measure:t.measure})}}class At extends ot{constructor(t,e){super(t,e),this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){var t="{";if(null!=this.id&&void 0!=this.id&&(t+='"id":'+this.id+","),null!=this.center&&void 0!=this.center&&(t+='"center":'+this.center+","),null!=this.style&&void 0!=this.style&&(t+='"style":'+this.style+","),null!=this.length&&void 0!=this.length&&(t+='"length":'+this.length+","),null!=this.maxM&&void 0!=this.maxM&&(t+='"maxM":'+this.maxM+","),null!=this.minM&&void 0!=this.minM&&(t+='"minM":'+this.minM+","),null!=this.type&&void 0!=this.type&&(t+='"type":"'+this.type+'",'),null!=this.parts&&void 0!=this.parts){t+='"parts":['+this.parts[0];for(var e=1;e<this.parts.length;e++)t+=","+this.parts[e];t+="],"}if(null!=this.components&&this.components.length>0){t+='"points":[';for(var r=0,i=this.components.length;r<i;r++)for(var s=0,n=this.components[r].components.length;s<n;s++)t+=this.components[r].components[s].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}"}destroy(){var t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(t){var e=t.parts||[],r=t.points||[],i=e.length,s=[];if(!(i>0))return null;for(var n=0,a=0,o=[];n<i;n++){for(var l=0;l<e[n];l++)o.push(Mt.fromJson(r[a+l]));a+=e[n],o[0].equals(o[e[n]-1])?s.push(new pt(o)):s.push(new ct(o)),o=[]}return new At(s,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}}class Tt{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){var t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){var t=this;switch(t.type.toUpperCase()){case s.POINT:return t.toGeoPoint();case s.LINE:return t.toGeoLine();case s.LINEM:return t.toGeoLinem();case s.REGION:return t.toGeoRegion();case s.POINTEPS:return t.toGeoPoint();case s.LINEEPS:return t.toGeoLineEPS();case s.REGIONEPS:return t.toGeoRegionEPS();case s.GEOCOMPOUND:return t.transformGeoCompound()}}toGeoPoint(){var t=this.parts||[],e=this.points||[],r=t.length;if(r>0){if(1===r)return new ut(e[0].x,e[0].y);var i=[];for(let t=0;t<r;t++)i.push(new ut(e[t].x,e[t].y));return new lt(i)}return null}toGeoLine(){var t=this.parts||[],e=this.points||[],r=t.length;if(r>0){if(1===r){let r=[];for(let i=0;i<t[0];i++)r.push(new ut(e[i].x,e[i].y));return r[0].equals(r[t[0]-1])?new pt(r):new ct(r)}{let i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<t[s];i++)r.push(new ut(e[i].x,e[i].y));i.push(new ct(r)),e.splice(0,t[s])}return new ft(i)}}return null}toGeoLineEPS(){var t,e,r,i,s,n=this.parts||[],a=this.points||[],o=n.length;if(o>0){if(1===o){for(t=0,r=[];t<n[0];t++)r.push(new ut(a[t].x,a[t].y,a[t].type));return r[0].equals(r[n[0]-1])?(s=ct.createLineEPS(r),new pt(s)):(s=ct.createLineEPS(r),new ct(s))}for(t=0,i=[];t<o;t++){for(e=0,r=[];e<n[t];e++)r.push(new ut(a[e].x,a[e].y));s=ct.createLineEPS(r),i.push(new ct(s)),a.splice(0,n[t])}return new ft(i)}return null}toGeoLinem(){return At.fromJson(this)}toGeoRegion(){var t=this.parts||[],e=this.partTopo||[],r=this.points||[],i=t.length;if(i<=0)return null;var s=[],n=[];if(1==i){for(let t=0;t<r.length;t++)n.push(new ut(r[t].x,r[t].y));return s.push(new yt([new pt(n)])),new mt(s)}var a=[],o=[],l=[],h=[],u=[];for(let s=0,a=0;s<i;s++){for(let e=0;e<t[s];e++)n.push(new ut(r[a+e].x,r[a+e].y));a+=t[s];var c=new yt([new pt(n)]);n=[],l.push(c),0===e.length&&h.push(c.getBounds()),u.push(1),o.push(c.getArea())}if(0===e.length){Tt.bubbleSort(o,l,e,h);var d=[];for(let t=1;t<l.length;t++)for(let e=t-1;e>=0;e--)if(d[t]=-1,h[e].containsBounds(h[t])){u[t]=-1*u[e],u[t]<0&&(d[t]=e);break}for(let t=0;t<l.length;t++)u[t]>0?s.push(l[t]):(s[d[t]].components=s[d[t]].components.concat(l[t].components),s.push(""))}else{s=new Array;for(let t=0;t<l.length;t++)if(e[t]&&-1==e[t]?a=a.concat(l[t].components):(a.length>0&&s.length>0&&(s[s.length-1].components=s[s.length-1].components.concat(a),a=[]),s.push(l[t])),t==i-1){var p=s.length;if(p)s[p-1].components=s[p-1].components.concat(a);else for(let t=0,e=a.length;t<e;t++)s.push(new yt(a))}}return new mt(s)}toGeoRegionEPS(){var t=this.parts||[],e=this.partTopo||[],r=this.points||[],i=t.length;if(i<=0)return null;var s,n=[],a=[];if(1==i){for(var o=0;o<r.length;o++)a.push(new ut(r[o].x,r[o].y));return s=ct.createLineEPS(a),n.push(new yt([new pt(s)])),new mt(n)}var l=[],h=[],u=[],c=[],d=[];for(let n=0,o=0;n<i;n++){for(let e=0;e<t[n];e++)a.push(new ut(r[o+e].x,r[o+e].y));o+=t[n],s=ct.createLineEPS(a);var p=new yt([new pt(s)]);a=[],u.push(p),0===e.length&&c.push(p.getBounds()),d.push(1),h.push(p.getArea())}if(0===e.length){Tt.bubbleSort(h,u,e,c);var f=[];for(let t=1;t<u.length;t++)for(let e=t-1;e>=0;e--)if(f[t]=-1,c[e].containsBounds(c[t])){d[t]=-1*d[e],d[t]<0&&(f[t]=e);break}for(let t=0;t<u.length;t++)d[t]>0?n.push(u[t]):(n[f[t]].components=n[f[t]].components.concat(u[t].components),n.push(""))}else{n=new Array;for(let t=0;t<u.length;t++)if(e[t]&&-1==e[t]?l=l.concat(u[t].components):(l.length>0&&n.length>0&&(n[n.length-1].components=n[n.length-1].components.concat(l),l=[]),n.push(u[t])),t==i-1){var m=n.length;if(m)n[m-1].components=n[m-1].components.concat(l);else for(let t=0,e=l.length;t<e;t++)n.push(new yt(l))}}return new mt(n)}transformGeoCompound(){const t=this.geoParts||[],e=t.length;if(e<=0)return null;const r=[];for(let i=0;i<e;i++){const e=t[i];r.push(new Tt(e).toGeometry())}return new ot(r)}static fromJson(t){if(t)return new Tt({id:t.id,style:Ct.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(t){var e=0,r=[],i=[],n=null,a=t.components,o=t.CLASS_NAME,l={epsgCode:t.SRID};if(isNaN(t.id)||(e=t.id),"SuperMap.Geometry.LinearRing"!=o&&"SuperMap.Geometry.LineString"!=o&&(t instanceof lt||t instanceof ft)){let t=a.length;for(let e=0;e<t;e++){const t=a[e].getVertices();let s=t.length;r.push(s);for(let e=0;e<s;e++)i.push(new ut(t[e].x,t[e].y))}n="SuperMap.Geometry.MultiPoint"==o?s.POINT:s.LINE}else if(t instanceof mt){let t=a.length;for(let e=0;e<t;e++){let t=a[e].components,s=t.length;for(let e=0;e<s;e++){const s=t[e].getVertices(),n=s.length+1;r.push(n);for(let t=0;t<n-1;t++)i.push(new ut(s[t].x,s[t].y));i.push(new ut(s[0].x,s[0].y))}}n=s.REGION}else if(t instanceof yt){let t=a.length;for(let e=0;e<t;e++){const t=a[e].getVertices();let s=t.length+1;r.push(s);for(let e=0;e<s-1;e++)i.push(new ut(t[e].x,t[e].y));i.push(new ut(t[0].x,t[0].y))}n=s.REGION}else{const e=t.getVertices();let a=e.length;for(let t=0;t<a;t++)i.push(new ut(e[t].x,e[t].y));t instanceof pt&&(i.push(new ut(e[0].x,e[0].y)),a++),r.push(a),n=t instanceof ut?s.POINT:s.LINE}return new Tt({id:e,style:null,parts:r,points:i,type:n,prjCoordSys:l})}}static IsClockWise(t){var e=t.length;if(e<3)return 0;var r=t[0].y*(t[e-1].x-t[1].x);t.push(t[0]);for(var i=1;i<e;i++)r+=t[i].y*(t[i-1].x-t[i+1].x);return.5*r}static bubbleSort(t,e,r,i){for(var s=0;s<t.length;s++)for(var n=0;n<t.length;n++)if(t[s]>t[n]){var a=t[n];t[n]=t[s],t[s]=a;var o=e[n];if(e[n]=e[s],e[s]=o,r&&r.length>0){var l=r[n];r[n]=r[s],r[s]=l}if(i&&i.length>0){var h=i[n];i[n]=i[s],i[s]=h}}}}const Et={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};class Ot extends xt{constructor(t,e,r){super(null,null,e),this.fid=null,this.geometry=t||null,this.attributes={},e&&(this.attributes=rt.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=r||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",Ot.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new Ot(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===Et.UPDATE)switch(this.state){case Et.UNKNOWN:case Et.DELETE:this.state=t;break;case Et.UPDATE:case Et.INSERT:}else if(t===Et.INSERT)switch(this.state){case Et.UNKNOWN:break;default:this.state=t}else if(t===Et.DELETE)switch(this.state){case Et.INSERT:case Et.DELETE:break;case Et.UNKNOWN:case Et.UPDATE:this.state=t}else t===Et.UNKNOWN&&(this.state=t)}}class Lt{constructor(t){this.data=null,this.keepData=!1,rt.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}class Pt extends Lt{constructor(t){super(t),this.indent="    ",this.space=" ",this.newline="\n",this.level=0,this.pretty=!1,this.nativeJSON=!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(t){if(null==t)return"null";if(t.constructor===Date)return this.serialize.date.apply(this,[t]);if(t.constructor===Array)return this.serialize.array.apply(this,[t]);var e,r,i,s=["{"];this.level+=1;var n=!1;for(e in t)t.hasOwnProperty(e)&&(r=this.write.apply(this,[e,this.pretty]),i=this.write.apply(this,[t[e],this.pretty]),null!=r&&null!=i&&(n&&s.push(","),s.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),i),n=!0));return this.level-=1,s.push(this.writeNewline(),this.writeIndent(),"}"),s.join("")},array:function(t){var e,r=["["];this.level+=1;for(var i=0,s=t.length;i<s;++i)null!=(e=this.write.apply(this,[t[i],this.pretty]))&&(i>0&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),e));return this.level-=1,r.push(this.writeNewline(),this.writeIndent(),"]"),r.join("")},string:function(t){var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(t)?'"'+t.replace(/([\x00-\x1f\\"])/g,function(t,r){var i=e[r];return i||(i=r.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})+'"':'"'+t+'"'},number:function(t){return isFinite(t)?String(t):"null"},boolean:function(t){return String(t)},date:function(t){function e(t){return t<10?"0"+t:t}return'"'+t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+'"'}}}read(t,e){var r;if(this.nativeJSON)try{r=JSON.parse(t,e)}catch(e){return{data:t}}return this.keepData&&(this.data=r),r}write(t,e){this.pretty=!!e;var r=null,i=typeof t;if(this.serialize[i])try{r=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[i].apply(this,[t])}catch(t){}return r}writeIndent(){var t=[];if(this.pretty)for(var e=0;e<this.level;++e)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class Nt extends Pt{constructor(t){super(t),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(t){if(!1===this.ignoreExtraDims&&2!=t.length)throw"Only 2D points are supported: "+t;return new ut(t[0],t[1])},multipoint:function(t){for(var e=[],r=null,i=0,s=t.length;i<s;++i){try{r=this.parseCoords.point.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return new lt(e)},linestring:function(t){for(var e=[],r=null,i=0,s=t.length;i<s;++i){try{r=this.parseCoords.point.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return new ct(e)},multilinestring:function(t){for(var e=[],r=null,i=0,s=t.length;i<s;++i){try{r=this.parseCoords.linestring.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return new ft(e)},polygon:function(t){for(var e,r,i=[],s=0,n=t.length;s<n;++s){try{r=this.parseCoords.linestring.apply(this,[t[s]])}catch(t){throw t}e=new pt(r.components),i.push(e)}return new yt(i)},multipolygon:function(t){for(var e=[],r=null,i=0,s=t.length;i<s;++i){try{r=this.parseCoords.polygon.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return new mt(e)},box:function(t){if(2!=t.length)throw"GeoJSON box coordinates must have 2 elements";return new yt([new pt([new ut(t[0][0],t[0][1]),new ut(t[1][0],t[0][1]),new ut(t[1][0],t[1][1]),new ut(t[0][0],t[1][1]),new ut(t[0][0],t[0][1])])])}},this.extract={feature:function(t){var e=this.extract.geometry.apply(this,[t.geometry]),r={type:"Feature",properties:this.createAttributes(t),geometry:e};return t.geometry&&"TEXT"===t.geometry.type&&(r.properties.texts=t.geometry.texts,r.properties.textStyle=t.geometry.textStyle),t.fid&&(r.id=t.fid),t.ID&&(r.id=t.ID),r},geometry:function(t){if(null==t)return null;!t.parts&&t.points&&(t.parts=[t.points.length]);var e,r=t.hasOwnProperty("geometryType")?t:new Tt(t).toGeometry()||t,i=r.geometryType||r.type;return"LinearRing"===i&&(i="LineString"),"LINEM"===i&&(i="MultiLineString"),e=this.extract[i.toLowerCase()].apply(this,[r]),"Collection"===(i="TEXT"===i?"Point":i)?{type:"GeometryCollection",geometries:e}:{type:i,coordinates:e}},point:function(t){var e=[t.x,t.y];for(var r in t)"x"===r||"y"===r||null===t[r]||isNaN(t[r])||e.push(t[r]);return e},text:function(t){return[t.points[0].x,t.points[0].y]},multipoint:function(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e},linestring:function(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e},multilinestring:function(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.linestring.apply(this,[t.components[r]]));return e},polygon:function(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.linestring.apply(this,[t.components[r]]));return e},multipolygon:function(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.polygon.apply(this,[t.components[r]]));return e},collection:function(t){for(var e=t.components.length,r=new Array(e),i=0;i<e;++i)r[i]=this.extract.geometry.apply(this,[t.components[i]]);return r}}}read(t,e,r){e=e||"FeatureCollection";var i=null,s=null;if(s="string"==typeof t?super.read(t,r):t){if("string"!=typeof s.type);else if(this.isValidType(s,e))switch(e){case"Geometry":try{i=this.parseGeometry(s)}catch(t){}break;case"Feature":try{(i=this.parseFeature(s)).type="Feature"}catch(t){}break;case"FeatureCollection":switch(i=[],s.type){case"Feature":try{i.push(this.parseFeature(s))}catch(t){i=null}break;case"FeatureCollection":for(var n=0,a=s.features.length;n<a;++n)try{i.push(this.parseFeature(s.features[n]))}catch(t){i=null}break;default:try{var o=this.parseGeometry(s);i.push(new Ot(o))}catch(t){i=null}}}}else;return i}write(t,e){return super.write(this.toGeoJSON(t),e)}fromGeoJSON(t,e,r){let i=this.read(t,e,r);return rt.isArray(i)?i.map(t=>this._toiSevrerFeature(t)):this._toiSevrerFeature(i)}toGeoJSON(t){var e={type:null};if(rt.isArray(t)){e.type="FeatureCollection";var r=t.length;e.features=new Array(r);for(var i=0;i<r;++i){var s=t[i];if(n(s)){let t={};t.geometry=s,e.features[i]=this.extract.feature.apply(this,[t])}else e.features[i]=this.extract.feature.apply(this,[s])}}else if(n(t)){let r={};r.geometry=t,e=this.extract.feature.apply(this,[r])}else e=this.extract.feature.apply(this,[t]);function n(t){return t.hasOwnProperty("parts")&&t.hasOwnProperty("points")||t.hasOwnProperty("geoParts")}return e}isValidType(t,e){var r=!1;switch(e){case"Geometry":-1==rt.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)||(r=!0);break;case"FeatureCollection":r=!0;break;default:t.type==e&&(r=!0)}return r}parseFeature(t){var e,r,i,s;i=t.properties?t.properties:{},s=t.geometry&&t.geometry.bbox||t.bbox;try{r=this.parseGeometry(t.geometry)}catch(t){throw t}return e=new Ot(r,i),s&&(e.bounds=at.fromArray(s)),t.id&&(e.geometry.id=t.id,e.fid=t.id),e}parseGeometry(t){if(null==t)return null;var e;if("GeometryCollection"==t.type){if(!rt.isArray(t.geometries))throw"GeometryCollection must have geometries array: "+t;for(var r=t.geometries.length,i=new Array(r),s=0;s<r;++s)i[s]=this.parseGeometry.apply(this,[t.geometries[s]]);e=new ot(i)}else{if(!rt.isArray(t.coordinates))throw"Geometry must have coordinates array: "+t;if(!this.parseCoords[t.type.toLowerCase()])throw"Unsupported geometry type: "+t.type;try{e=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(t){throw t}}return e}createCRSObject(t){var e=t.layer.projection.toString(),r={};if(e.match(/epsg:/i)){var i=parseInt(e.substring(e.indexOf(":")+1));r=4326==i?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+i}}}return r}_toiSevrerFeature(t){const e=t.attributes,r=[],i=[];for(var s in e)r.push(s),i.push(e[s]);const n={fieldNames:r,fieldValues:i,geometry:Tt.fromGeometry(t.geometry)};return n.geometry.id=t.fid,n}createAttributes(t){if(!t)return null;var e={};!function(t,e){if(!t.hasOwnProperty("fieldNames")||!t.hasOwnProperty("fieldValues"))return;var r=t.fieldNames,i=t.fieldValues;for(var s in r)e[r[s]]=i[s]}(t,e);var r=["fieldNames","fieldValues","geometry","stringID","ID"];for(var i in t)r.indexOf(i)>-1||(e[i]=t[i]);return e}}class It{constructor(t){var e=this;t=t||{},this.speed=t.speed&&t.speed>=0?t.speed:1,this.frequency=t.speed&&t.frequency>=0?t.frequency:1e3,this.startTime=t.startTime&&null!=t.startTime?t.startTime:0,this.endTime=t.endTime&&null!=t.endTime&&t.endTime>=e.startTime?t.endTime:+new Date,this.repeat=void 0===t.repeat||t.repeat,this.reverse=void 0!==t.reverse&&t.reverse,this.currentTime=null,this.oldTime=null,this.running=!1,this.EVENT_TYPES=["start","pause","stop"],e.events=new _t(this,null,this.EVENT_TYPES),e.speed=Number(e.speed),e.frequency=Number(e.frequency),e.startTime=Number(e.startTime),e.endTime=Number(e.endTime),e.startTime=Date.parse(new Date(e.startTime)),e.endTime=Date.parse(new Date(e.endTime)),e.currentTime=e.startTime,this.CLASS_NAME="SuperMap.TimeControlBase"}updateOptions(t){var e=this;(t=t||{}).speed&&t.speed>=0&&(e.speed=t.speed,e.speed=Number(e.speed)),t.speed&&t.frequency>=0&&(e.frequency=t.frequency,e.frequency=Number(e.frequency)),t.startTime&&null!=t.startTime&&(e.startTime=t.startTime,e.startTime=Date.parse(new Date(e.startTime))),t.endTime&&null!=t.endTime&&t.endTime>=e.startTime&&(e.endTime=t.endTime,e.endTime=Date.parse(new Date(e.endTime))),null!=t.repeat&&(e.repeat=t.repeat),null!=t.reverse&&(e.reverse=t.reverse)}start(){var t=this;t.running||(t.running=!0,t.tick(),t.events.triggerEvent("start",t.currentTime))}pause(){this.running=!1,this.events.triggerEvent("pause",this.currentTime)}stop(){var t=this;t.currentTime=t.startTime,t.running&&(t.running=!1),t.events.triggerEvent("stop",t.currentTime)}toggle(){this.running?this.pause():this.start()}setSpeed(t){return t>=0&&(this.speed=t,!0)}getSpeed(){return this.speed}setFrequency(t){return t>=0&&(this.frequency=t,!0)}getFrequency(){return this.frequency}setStartTime(t){var e=this;return!((t=Date.parse(new Date(t)))>e.endTime)&&(e.startTime=t,e.currentTime<e.startTime&&(e.currentTime=e.startTime,e.tick()),!0)}getStartTime(){return this.startTime}setEndTime(t){var e=this;return e.endTime=Date.parse(new Date(e.endTime)),!(t<e.startTime)&&(e.endTime=t,e.currentTime>=e.endTime&&(e.currentTime=e.startTime,e.tick()),!0)}getEndTime(){return this.endTime}setCurrentTime(t){var e=this;return e.currentTime=Date.parse(new Date(e.currentTime)),t>=e.startTime&&t<=e.endTime&&(e.currentTime=t,e.startTime=e.currentTime,e.tick(),!0)}getCurrentTime(){return this.currentTime}setRepeat(t){this.repeat=t}getRepeat(){return this.repeat}setReverse(t){this.reverse=t}getReverse(){return this.reverse}getRunning(){return this.running}destroy(){var t=this;t.speed=null,t.frequency=null,t.startTime=null,t.endTime=null,t.currentTime=null,t.repeat=null,t.running=!1,t.reverse=null}tick(){}}r(107),r(693);var Ft=r(144),kt=r.n(Ft);let Dt=window.fetch;var Rt,Bt,Gt={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(t){for(var e in t){this.queryKeys.push(e),"string"!=typeof t[e]&&(t[e]=rt.toJSON(t[e]));var r=encodeURIComponent(t[e]);this.queryValues.push(r)}},issue:function(t){for(var e=this,r=e.getUid(),i=t.url,s=[],n=i,a=0,o=e.queryKeys?e.queryKeys.length:0,l=0;l<o;l++)if(n.length+e.queryKeys[l].length+2>=e.limitLength){if(0==a)return!1;s.push(n),n=i,a=0,l--}else if(n.length+e.queryKeys[l].length+2+e.queryValues[l].length>e.limitLength)for(var h=e.queryValues[l];h.length>0;){var u=e.limitLength-n.length-e.queryKeys[l].length-2;n.indexOf("?")>-1?n+="&":n+="?";var c=h.substring(0,u);"%"===c.substring(u-1,u)?(u-=1,c=h.substring(0,u)):"%"===c.substring(u-2,u-1)&&(u-=2,c=h.substring(0,u)),n+=e.queryKeys[l]+"="+c,h=h.substring(u),c.length>0&&(s.push(n),n=i,a=0)}else a++,n.indexOf("?")>-1?n+="&":n+="?",n+=e.queryKeys[l]+"="+e.queryValues[l];return s.push(n),e.send(s,"SuperMapJSONPCallbacks_"+r,t&&t.proxy)},getUid:function(){return 1e3*(new Date).getTime()+Math.floor(1e17*Math.random())},send:function(t,e,r){var i=t.length;if(i>0)return new Promise(s=>{for(var n=(new Date).getTime(),a=0;a<i;a++){var o=t[a];o.indexOf("?")>-1?o+="&":o+="?",o+="sectionCount="+i,o+="&sectionIndex="+a,o+="&jsonpUserID="+n,r&&(o=decodeURIComponent(o),o=r+encodeURIComponent(o)),kt()(o,{jsonpCallbackFunction:e,timeout:3e4}).then(t=>{s(t.json())})}})},GET:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings(t.params),this.issue(t)},POST:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)},PUT:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)},DELETE:function(t){return this.queryKeys.length=0,this.queryValues.length=0,this.addQueryStrings({requestEntity:t.data}),this.issue(t)}},Ut=function(){return void 0!=Rt?Rt:window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},jt=function(){return Bt||45e3},zt={commit:function(t,e,r,i){switch(t=t?t.toUpperCase():t){case"GET":return this.get(e,r,i);case"POST":return this.post(e,r,i);case"PUT":return this.put(e,r,i);case"DELETE":return this.delete(e,r,i);default:return this.get(e,r,i)}},supportDirectRequest:function(t,e){return!!rt.isInTheSameDomain(t)||(void 0!=e.crossOrigin?e.crossOrigin:Ut()||e.proxy)},get:function(t,e,r){r=r||{};if(t=rt.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){var i={url:t=t.replace(".json",".jsonp"),data:e};return Gt.GET(i)}return this.urlIsLong(t)?this._postSimulatie("GET",t.substring(0,t.indexOf("?")),e,r):this._fetch(t,e,r,"GET")},delete:function(t,e,r){r=r||{};if(t=rt.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var i={url:t+="&_method=DELETE",data:e};return Gt.DELETE(i)}return this.urlIsLong(t)?this._postSimulatie("DELETE",t.substring(0,t.indexOf("?")),e,r):this._fetch(t,e,r,"DELETE")},post:function(t,e,r){if(r=r||{},t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var i={url:rt.urlAppend(t,"_method=POST"),data:e};return Gt.POST(i)}return this._fetch(t,e,r,"POST")},put:function(t,e,r){if(r=r||{},t=this._processUrl(t,r),!this.supportDirectRequest(t,r)){t=t.replace(".json",".jsonp");var i={url:t+="&_method=PUT",data:e};return Gt.PUT(i)}return this._fetch(t,e,r,"PUT")},urlIsLong:function(t){for(var e=0,r=null,i=0,s=t.length;i<s;i++)(r=t.charCodeAt(i))<127?e++:128<=r&&r<=2047?e+=2:2048<=r&&r<=65535&&(e+=3);return!(e<2e3)},_postSimulatie:function(t,e,r,i){return e+=(e.indexOf("?")>-1?"&":"?")+"_method="+t,"string"!=typeof r&&(r=JSON.stringify(r)),this.post(e,r,i)},_processUrl:function(t,e){if(this._isMVTRequest(t))return t;if(-1===t.indexOf(".json")&&!e.withoutFormatSuffix)if(t.indexOf("?")<0)t+=".json";else{var r=t.split("?");2===r.length&&(t=r[0]+".json?"+r[1])}return e&&e.proxy&&("function"==typeof e.proxy?t=e.proxy(t):(t=decodeURIComponent(t),t=e.proxy+encodeURIComponent(t))),t},_fetch:function(t,e,r,i){return(r=r||{}).headers=r.headers||{},r.headers["Content-Type"]||FormData.prototype.isPrototypeOf(e)||(r.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),r.timeout?this._timeout(r.timeout,Dt(t,{method:i,headers:r.headers,body:"PUT"===i||"POST"===i?e:void 0,credentials:this._getWithCredentials(r),mode:"cors",timeout:jt()}).then(function(t){return t})):Dt(t,{method:i,body:"PUT"===i||"POST"===i?e:void 0,headers:r.headers,credentials:this._getWithCredentials(r),mode:"cors",timeout:jt()}).then(function(t){return t})},_getWithCredentials:function(t){return!0===t.withCredentials?"include":!1===t.withCredentials?"omit":"same-origin"},_fetchJsonp:function(t,e){return e=e||{},kt()(t,{method:"GET",timeout:e.timeout}).then(function(t){return t})},_timeout:function(t,e){return new Promise(function(r,i){setTimeout(function(){i(new Error("timeout"))},t),e.then(r,i)})},_getParameterString:function(t){var e=[];for(var r in t){var i,s=t[r];if(null!=s&&"function"!=typeof s)i=Array.isArray(s)||"[object Object]"===s.toString()?encodeURIComponent(JSON.stringify(s)):encodeURIComponent(s),e.push(encodeURIComponent(r)+"="+i)}return e.join("&")},_isMVTRequest:function(t){return t.indexOf(".mvt")>-1||t.indexOf(".pbf")>-1}};class Vt{static generateToken(t,e){var r=this.servers[t];if(r)return zt.post(r.tokenServiceUrl,JSON.stringify(e.toJSON())).then(function(t){return t.text()})}static registerServers(t){this.servers=this.servers||{},rt.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var r=t[e];this.servers[r.server]=r}}static registerToken(t,e){if(this.tokens=this.tokens||{},t&&e){var r=this._getTokenStorageKey(t);this.tokens[r]=e}}static registerKey(t,e){if(this.keys=this.keys||{},t&&!(t.length<1)&&e){t=rt.isArray(t)?t:[t];for(var r=0;r<t.length;r++){var i=this._getUrlRestString(t[0])||t[0];this.keys[i]=e}}}static getServerInfo(t){return this.servers=this.servers||{},this.servers[t]}static getToken(t){if(t){this.tokens=this.tokens||{};var e=this._getTokenStorageKey(t);return this.tokens[e]}}static getKey(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;return this.keys[e]}static loginiServer(t,e,r,i){t=rt.urlPathAppend(t,"services/security/login");var s={username:e&&e.toString(),password:r&&r.toString(),rememberme:i};s=JSON.stringify(s);return zt.post(t,s,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){return t.json()})}static logoutiServer(t){t=rt.urlPathAppend(t,"services/security/logout");return zt.get(t,"",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0}).then(function(){return!0}).catch(function(){return!1})}static loginOnline(t,e){var r=Vt.SSO+"/login?service="+t;this._open(r,e)}static loginiPortal(t,e,r){t=rt.urlPathAppend(t,"web/login");var i={username:e&&e.toString(),password:r&&r.toString()};i=JSON.stringify(i);return zt.post(t,i,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!1}).then(function(t){return t.json()})}static logoutiPortal(t){t=rt.urlPathAppend(t,"services/security/logout");return zt.get(t,"",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0}).then(function(){return!0}).catch(function(){return!1})}static loginManager(t,e){var r=rt.urlPathAppend(t,"/security/tokens"),i=e||{},s={username:i.userName&&i.userName.toString(),password:i.password&&i.password.toString()};s=JSON.stringify(s);var n=this;return zt.post(r,s,{headers:{Accept:"*/*","Content-Type":"application/json; charset=UTF-8"}}).then(function(t){return t.text()}).then(function(t){return n.imanagerToken=t,t})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(t){if(t){var e=this._getTokenStorageKey(t);this.tokens=this.tokens||{},this.tokens[e]&&delete this.tokens[e]}}static destroyKey(t){if(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;this.keys[e]&&delete this.keys[e]}}static appendCredential(t){var e=t,r=this.getToken(t),i=r?new vt(r,"token"):null;return i||(i=(r=this.getKey(t))?new vt(r,"key"):null),i&&(e=rt.urlAppend(e,i.getUrlParameters())),e}static _open(t,e){e=null==e||e;var r=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,i=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,s="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+i+", left="+r+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";e?window.open(t,"login"):window.open(t,"login",s)}static _getTokenStorageKey(t){var e=t.match(/(.*?):\/\/([^\/]+)/i);return e?e[0]:t}static _getUrlRestString(t){if(!t)return t;var e=t.match(/(http|https):\/\/(.*\/rest)/i);return e?e[0]:t}}Vt.INNER_WINDOW_WIDTH=600,Vt.INNER_WINDOW_HEIGHT=600,Vt.SSO="https://sso.supermap.com",Vt.ONLINE="https://www.supermapol.com";class Jt{constructor(t,e){if(t){var r=t.substr(t.length-1,1);this.serviceUrl="/"===r?t.substr(0,t.length-2):t}this.options=e||{},this.CLASS_NAME="SuperMap.iManagerServiceBase"}request(t,e,r,i){(i=i||{headers:{Accept:"*/*","Content-Type":"application/json"}}).crossOrigin=this.options.crossOrigin,i.headers=this.options.headers;var s=Vt.imanagerToken;return s&&(i.headers||(i.headers={}),i.headers["X-Auth-Token"]=s),r&&(r=JSON.stringify(r)),zt.commit(t,e,r,i).then(function(t){return t.json()})}}class qt{constructor(t){t=t||{},this.nodeSpec="SMALL",this.nodeCount=1,this.nodeName="",this.password="",this.description="",this.physicalMachineName="",this.ips=[],this.userName="",rt.extend(this,t)}}class Ht{constructor(t,e){e=e||{},this.serviceUrl=t,this.CLASS_NAME="SuperMap.iPortalServiceBase",this.withCredentials=e.withCredentials||!1,this.crossOrigin=e.crossOrigin,this.headers=e.headers}request(t,e,r,i={headers:this.headers,crossOrigin:this.crossOrigin,withCredentials:this.withCredentials}){return e=Vt.appendCredential(e),zt.commit(t,e,r,i).then(function(t){return t.json()})}}class Wt{constructor(t){t=t||{},this.resourceType="",this.pageSize=12,this.currentPage=1,this.orderBy="UPDATETIME",this.orderType="DESC",this.searchType="PUBLIC",this.tags=[],this.dirIds=[],this.resourceSubTypes=[],this.aggregationTypes=[],this.text="",this.groupIds=[],this.departmentIds=[],rt.extend(this,t)}}class Yt{constructor(t){t=t||{},this.content=[],this.total=0,this.currentPage=1,this.pageSize=12,this.aggregations=null,rt.extend(this,t)}}class Xt extends Ht{constructor(t,e){super(t),e=e||{},this.authorizeSetting=[],this.bounds="",this.bounds4326="",this.checkStatus="",this.createTime=0,this.description=null,this.dirId=null,this.epsgCode=0,this.heatLevel=0,this.id=0,this.name="",this.personalDirId=null,this.resourceId=0,this.resourceSubType=null,this.resourceType=null,this.serviceRootUrlId=null,this.tags=null,this.thumbnail=null,this.updateTime=0,this.userName="",this.sourceJSON={},rt.extend(this,e),this.resourceUrl=t+"/web/"+this.resourceType.replace("_","").toLowerCase()+"s/"+this.resourceId,this.withCredentials&&(this.resourceUrl=t+"/web/mycontent/"+this.resourceType.replace("_","").toLowerCase()+"s/"+this.resourceId)}load(){var t=this;return t.request("GET",t.resourceUrl+".json").then(function(e){if(e.error)return e;t.sourceJSON=e})}update(){var t=this.resourceType.replace("_","").toLowerCase();"data"===t&&(this.resourceUrl=this.resourceUrl+"/attributes.json");var e=JSON.stringify(this.sourceJSON);if("service"===t){var r={authorizeSetting:this.sourceJSON.authorizeSetting,metadata:this.sourceJSON.metadata,tags:this.sourceJSON.tags,thumbnail:this.sourceJSON.thumbnail,tokenRefreshUrl:this.sourceJSON.tokenRefreshUrl};e=JSON.stringify(r)}return this.request("PUT",this.resourceUrl,e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}class Qt{constructor(t){t=t||{},this.ids=[],this.entities=[],this.resourceType="",rt.extend(this,t)}}class Zt{constructor(t){t=t||{},this.rootUrl="",this.tags=[],this.entities=[],rt.extend(this,t)}}class Kt{constructor(t){t=t||{},this.type="",this.tags=[],this.entities=[],this.metadata={},this.addedMapNames=[],this.addedSceneNames=[],rt.extend(this,t)}}class $t{constructor(t){t=t||{},this.fileName="",this.type="",this.tags=[],this.dataMetaInfo={},rt.extend(this,t)}}class te{constructor(t){t=t||{},this.xField="",this.yField="",this.fileEncoding="UTF-8",this.xIndex=1,this.yIndex=1,this.fieldTypes=[],this.separator="",this.firstRowIsHead=!0,this.url="",this.dataStoreInfo={},rt.extend(this,t)}}class ee{constructor(t){t=t||{},this.type="",this.url="",this.connectionInfo={},rt.extend(this,t)}}class re{constructor(t){t=t||{},this.dataBase="",this.server="",rt.extend(this,t)}}class ie{constructor(t,e){let r=this;this.EVENT_TYPES=["processCompleted","processFailed"],this.events=null,this.eventListeners=null,this.url=null,this.urls=null,this.proxy=null,this.index=null,this.length=null,this.totalTimes=null,this.POLLING_TIMES=3,this.isInTheSameDomain=null,this.withCredentials=!1,rt.isArray(t)?(r.urls=t,r.length=t.length,r.totalTimes=r.length,1===r.length?r.url=t[0]:(r.index=parseInt(Math.random()*r.length),r.url=t[r.index])):(r.totalTimes=1,r.url=t),rt.isArray(t)&&!r.isServiceSupportPolling()&&(r.url=t[0],r.totalTimes=1),e=e||{},this.crossOrigin=e.crossOrigin,this.headers=e.headers,rt.extend(this,e),r.isInTheSameDomain=rt.isInTheSameDomain(r.url),r.events=new _t(r,null,r.EVENT_TYPES,!0),r.eventListeners instanceof Object&&r.events.on(r.eventListeners),this.CLASS_NAME="SuperMap.CommonServiceBase"}destroy(){let t=this;rt.isArray(t.urls)&&(t.urls=null,t.index=null,t.length=null,t.totalTimes=null),t.url=null,t.isInTheSameDomain=null,t.EVENT_TYPES=null,t.events&&(t.events.destroy(),t.events=null),t.eventListeners&&(t.eventListeners=null)}request(t){let e=t.scope.format;if("string"==typeof t.success&&(t.scope.format=t.success,e=t.success,t.success=null,t.failure=null),e&&!this.supportDataFormat(e))throw new Error(`${this.CLASS_NAME} is not surport ${e} format!`);let r=this;return t.url=t.url||r.url,this._returnContent(t)&&!t.url.includes("returnContent=true")&&(t.url=rt.urlAppend(t.url,"returnContent=true")),t.proxy=t.proxy||r.proxy,t.withCredentials=void 0!=t.withCredentials?t.withCredentials:r.withCredentials,t.crossOrigin=void 0!=t.crossOrigin?t.crossOrigin:r.crossOrigin,t.headers=t.headers||r.headers,t.isInTheSameDomain=r.isInTheSameDomain,t.withoutFormatSuffix=t.scope.withoutFormatSuffix||!1,t.url=Vt.appendCredential(t.url),r.calculatePollingTimes(),t.scope=r,r.totalTimes>0?(r.totalTimes--,r.ajaxPolling(t)):r._commit(t)}ajaxPolling(t){let e=this,r=t.url,i=/^http:\/\/([a-z]{9}|(\d+\.){3}\d+):\d{0,4}/;return e.index=parseInt(Math.random()*e.length),e.url=e.urls[e.index],r=r.replace(i,i.exec(e.url)[0]),t.url=r,t.isInTheSameDomain=rt.isInTheSameDomain(r),e._commit(t)}calculatePollingTimes(){let t=this;t.times?t.totalTimes>t.POLLING_TIMES?t.times>t.POLLING_TIMES?t.totalTimes=t.POLLING_TIMES:t.totalTimes=t.times:t.times<t.totalTimes&&(t.totalTimes=t.times):t.totalTimes>t.POLLING_TIMES&&(t.totalTimes=t.POLLING_TIMES),t.totalTimes--}isServiceSupportPolling(){return!("SuperMap.REST.ThemeService"===this.CLASS_NAME||"SuperMap.REST.EditFeaturesService"===this.CLASS_NAME)}transformResult(t,e){return{result:t=rt.transformResult(t),options:e}}transformErrorResult(t,e){return{error:(t=rt.transformResult(t)).error||t,options:e}}serviceProcessCompleted(t,e){t=this.transformResult(t).result,this.events.triggerEvent("processCompleted",{result:t,options:e})}serviceProcessFailed(t,e){let r=(t=this.transformErrorResult(t).error).error||t;this.events.triggerEvent("processFailed",{error:r,options:e})}_returnContent(t){return t.scope.format!==e.FGB&&!!t.scope.returnContent}supportDataFormat(t){return this.dataFormat().includes(t)}dataFormat(){return[e.GEOJSON,e.ISERVER]}_commit(t){if("POST"===t.method||"PUT"===t.method||"PATCH"===t.method)if(t.params&&(t.url=rt.urlAppend(t.url,rt.getParameterString(t.params||{}))),"object"==typeof t.data)try{t.params=rt.toJSON(t.data)}catch(t){console.log("ä¸æ¯jsonå¯¹è±¡")}else t.params=t.data;return zt.commit(t.method,t.url,t.params,{headers:t.headers,withoutFormatSuffix:t.withoutFormatSuffix,withCredentials:t.withCredentials,crossOrigin:t.crossOrigin,timeout:t.async?0:null,proxy:t.proxy}).then(function(t){return t.text?t.text():t.json?t.json():t}).then(function(r){let i=r;return"string"==typeof r&&(i=(new Pt).read(r)),(!i||i.error||i.code>=300&&304!==i.code)&&(i=i&&i.error?{error:i.error}:{error:i}),i&&t.scope.format===e.FGB&&(i.newResourceLocation=i.newResourceLocation.replace(".json","")+".fgb"),i}).catch(function(t){return{error:t}}).then(e=>{let r={object:this};if(e.error){const s="processFailed";if(this.events&&this.events.listeners[s]&&this.events.listeners[s].length){var i=t.failure&&(t.scope?X.bind(t.failure,t.scope):t.failure);i?i(e,t):this.serviceProcessFailed(e,t)}else(r={...r,...this.transformErrorResult(e,t)}).type=s,t.failure&&t.failure(r)}else{const i="processCompleted";if(this.events&&this.events.listeners[i]&&this.events.listeners[i].length){var s=t.success&&(t.scope?X.bind(t.success,t.scope):t.success);s?s(e,t):this.serviceProcessCompleted(e,t)}else e.succeed=void 0==e.succeed||e.succeed,(r={...r,...this.transformResult(e,t)}).type=i,t.success&&t.success(r)}return r})}}class se{constructor(t){t.filters&&"string"==typeof t.filters&&(t.filters=t.filters.split(",")),this.address=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,rt.extend(this,t)}destroy(){this.address=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null}}class ne{constructor(t){t.filters&&(t.filters=t.filters.split(",")),this.x=null,this.y=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,this.geoDecodingRadius=null,rt.extend(this,t)}destroy(){this.x=null,this.y=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,this.geoDecodingRadius=null}}class ae extends ie{constructor(t,e){super(t,e),this.options=e||{},this.CLASS_NAME="SuperMap.AddressMatchService"}destroy(){super.destroy()}code(t,e,r){if(e instanceof se)return this.processAsync(t,e,r)}decode(t,e,r){if(e instanceof ne)return this.processAsync(t,e,r)}processAsync(t,e,r){return this.request({method:"GET",url:t,params:e,scope:this,success:r,failure:r})}transformResult(t,e){return t.succeed&&delete t.succeed,{result:t,options:e}}}class oe{constructor(t){this.aggName=null,this.aggFieldName=null,this.CLASS_NAME="SuperMap.AggregationParameter",rt.extend(this,t)}destroy(){this.aggName=null,this.aggFieldName=null,this.aggType=null}}class le extends oe{constructor(t){super(),this.subAggs=null,this.aggType=null,this.CLASS_NAME="SuperMap.BucketAggParameter",rt.extend(this,t)}destroy(){this.subAggs&&(this.subAggs=null)}}class he{constructor(t){this.dataset=null,this.targetDatasourceName=null,this.totalGridName=null,this.diffuseDatasetGridName=null,this.durationDatasetGridName=null,this.directDatasetGridName=null,this.latitude=null,this.timeMode="MULTIDAYS",this.dayStart=null,this.dayEnd=null,this.hourStart=null,this.hourEnd=null,this.transmittance=null,this.hourInterval=null,this.dayInterval=null,this.deleteExistResultDataset=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.AreaSolarRadiationParameters"}destroy(){var t=this;t.dataset=null,t.zFactor=1,t.averageCurvatureName=null,t.profileCurvatureName=null,t.planCurvatureName=null,t.deleteExistResultDataset=!0}static toObject(t,e){var r={};for(var i in t){if("dataset"!==i)"latitude"===i||"timeMode"===i||"dayStart"===i||("dayEnd"===i||"hourStart"===i||"hourEnd"===i)||("transmittance"===i||"hourInterval"===i||"dayInterval"===i)?r[i]=t[i]:e[i]=t[i]}e.parameter=r}}class ue extends ie{constructor(t,r){super(t,r),this.format=r&&r.format||e.GEOJSON,this.CLASS_NAME="SuperMap.SpatialAnalystBase"}destroy(){super.destroy(),this.format=null}transformResult(t,r){var i;if((t=rt.transformResult(t))&&this.format===e.GEOJSON&&"function"==typeof this.toGeoJSONResult)if(rt.isArray(t)){for(var s=0;s<t.length;s++)t[s]=this.toGeoJSONResult(t[s]);i=t}else i=this.toGeoJSONResult(t);return i||(i=t),{result:i,options:r}}toGeoJSONResult(t){if(!t)return null;t.result&&t.result.resultGeometry&&(t=t.result);var e=new Nt;if(t.recordsets)for(var r=0,i=t.recordsets,s=i.length;r<s;r++)i[r].features&&(i[r].features=e.toGeoJSON(i[r].features));else t.recordset&&t.recordset.features&&(t.recordset.features=e.toGeoJSON(t.recordset.features));return t.resultGeometry&&(t.resultGeometry=e.toGeoJSON(t.resultGeometry)),t.regions&&(t.regions=e.toGeoJSON(t.regions)),t}}class ce extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.AreaSolarRadiationService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof he){var r=this,i={};t instanceof he&&(r.url=rt.urlPathAppend(r.url,`datasets/${t.dataset}/solarradiation`)),r.url=rt.urlAppend(r.url,"returnContent=true"),he.toObject(t,i);var s=rt.toJSON(i);return r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}}class de{constructor(t){this.exp=null,this.value=100,rt.extend(this,t),this.CLASS_NAME="SuperMap.BufferDistance"}destroy(){this.exp=null,this.value=null}}class pe{constructor(t){this.endType=S.FLAT,this.leftDistance=new de,this.rightDistance=new de,this.semicircleLineSegment=4,this.radiusUnit=h.METER,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.BufferSetting"}destroy(){let t=this;t.endType=null,t.leftDistance&&(t.leftDistance.destroy(),t.leftDistance=null),t.rightDistance&&(t.rightDistance.destroy(),t.rightDistance=null),t.semicircleLineSegment=null,t.radiusUnit=null}}class fe{constructor(t){this.bufferSetting=new pe,rt.extend(this,t),this.CLASS_NAME="SuperMap.BufferAnalystParameters"}destroy(){this.bufferSetting&&(this.bufferSetting.destroy(),this.bufferSetting=null)}}class me{constructor(t){this.expectCount=1e3,this.dataset=null,this.dataReturnMode=M.RECORDSET_ONLY,this.deleteExistResultDataset=!0,rt.extend(this,t),this.CLASS_NAME="SuperMap.DataReturnOption"}destroy(){this.expectCount=null,this.dataset=null,this.dataReturnMode=null,this.deleteExistResultDataset=null}}class ye{constructor(t){this.attributeFilter=null,this.name=null,this.joinItems=null,this.linkItems=null,this.ids=null,this.orderBy=null,this.groupBy=null,this.fields=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.FilterParameter"}destroy(){var t=this;if(t.attributeFilter=null,t.name=null,t.joinItems){for(let e=0,r=t.joinItems,i=r.length;e<i;e++)r[e].destroy();t.joinItems=null}if(t.linkItems){for(let e=0,r=t.linkItems,i=r.length;e<i;e++)r[e].destroy();t.linkItems=null}t.ids=null,t.orderBy=null,t.groupBy=null,t.fields=null}}class ge extends fe{constructor(t){super(t),this.dataset=null,this.filterQueryParameter=new ye,this.resultSetting=new me,this.isAttributeRetained=!0,this.isUnion=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasetBufferAnalystParameters"}destroy(){super.destroy();var t=this;t.dataset=null,t.filterQueryParameter&&(t.filterQueryParameter.destroy(),t.filterQueryParameter=null),t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.isAttributeRetained=null,t.isUnion=null}static toObject(t,e){for(var r in t)if("bufferSetting"===r)t.bufferSetting.radiusUnit=t.bufferSetting.radiusUnit.toUpperCase(),e.bufferAnalystParameter=t.bufferSetting;else if("resultSetting"===r)e.dataReturnOption=t.resultSetting;else{if("dataset"===r)continue;e[r]=t[r]}}}class ve extends fe{constructor(t){super(t),this.sourceGeometry=null,this.sourceGeometrySRID=null,t&&rt.extend(this,t),this.CLASS_NAME=" SuperMap.GeometryBufferAnalystParameters"}destroy(){super.destroy();this.sourceGeometry&&(this.sourceGeometry.destroy(),this.sourceGeometry=null)}static toObject(t,e){for(var r in t)if("bufferSetting"===r){var i={};for(var s in t.bufferSetting)i[s]=t.bufferSetting[s];e.analystParameter=i}else"sourceGeometry"===r?e.sourceGeometry=Tt.fromGeometry(t.sourceGeometry):e[r]=t[r]}}class be extends ue{constructor(t,e){super(t,e),this.mode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.BufferAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},i=this;t instanceof ge?(i.mode="datasets",i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/buffer"),ge.toObject(t,r)):t instanceof ve&&(i.mode="geometry",i.url=rt.urlPathAppend(i.url,"geometry/buffer"),ve.toObject(t,r));var s=rt.toJSON(r);return this.returnContent=!0,i.request({method:"POST",data:s,scope:i,success:e,failure:e})}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}}class Se{constructor(t){this.alias=null,this.connect=null,this.dataBase=null,this.driver=null,this.engineType=null,this.exclusive=null,this.OpenLinkTable=null,this.password=null,this.readOnly=null,this.server=null,this.user=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasourceConnectionInfo"}destroy(){var t=this;t.alias=null,t.connect=null,t.dataBase=null,t.driver=null,t.engineType=null,t.exclusive=null,t.OpenLinkTable=null,t.password=null,t.readOnly=null,t.server=null,t.user=null}}class _e{constructor(t){this.type=x.UDB,this.datasetName="analystResult",this.datasourceInfo=null,this.outputPath="",rt.extend(this,t),this.CLASS_NAME="SuperMap.OutputSetting"}destroy(){var t=this;t.type=null,t.datasetName=null,t.outputPath=null,t.datasourceInfo instanceof Se&&(t.datasourceInfo.destroy(),t.datasourceInfo=null)}}class xe{constructor(t){this.items=null,this.numericPrecision=1,this.rangeMode=f.EQUALINTERVAL,this.rangeCount="",this.colorGradientType=m.YELLOW_RED,rt.extend(this,t),this.CLASS_NAME="SuperMap.MappingParameters"}destroy(){var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.numericPrecision=null,t.rangeMode=null,t.rangeCount=null,t.colorGradientType=null}}class we{constructor(t){if(this.datasetName="",this.bounds="",this.distance="",this.distanceField="",this.distanceUnit=k.METER,this.dissolveField="",this.output=null,this.mappingParameters=null,!t)return this;rt.extend(this,t),this.CLASS_NAME="SuperMap.BuffersAnalystJobsParameter"}destroy(){this.datasetName=null,this.bounds=null,this.distance=null,this.distanceField=null,this.distanceUnit=null,this.dissolveField=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},"bounds"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Ce extends ie{constructor(t,e){super(t,e=e||{}),this.CLASS_NAME="SuperMap.ProcessingServiceBase"}destroy(){super.destroy()}getJobs(t,e){var r=this;return zt.get(Vt.appendCredential(t),null,{proxy:r.proxy}).then(function(t){return t.json()}).then(function(t){const i={result:t,object:r,type:"processCompleted"};return e(i),i}).catch(function(t){const i={error:t,object:r,type:"processFailed"};return e(i),i})}addJob(t,e,r,i,s,n){var a=this,o=null;e&&e instanceof r&&(o=new Object,r.toObject(e,o));let l=Object.assign({"Content-Type":"application/x-www-form-urlencoded"},a.headers||{});var h={proxy:a.proxy,headers:l,withCredentials:a.withCredentials,crossOrigin:a.crossOrigin,isInTheSameDomain:a.isInTheSameDomain};return zt.post(Vt.appendCredential(t),JSON.stringify(o),h).then(function(t){return t.json()}).then(function(t){return t.succeed?a.transformResult(t,i,s,n):((t=a.transformErrorResult(t)).options=a,t.type="processFailed",s(t),t)}).catch(function(t){return(t=a.transformErrorResult({error:t})).options=a,t.type="processFailed",s(t),t})}transformResult(t,e,r,i){t=rt.transformResult(t),e=e||1e3;var s=this;if(t)return new Promise(n=>{var a=setInterval(function(){zt.get(Vt.appendCredential(t.newResourceLocation),{_t:(new Date).getTime()}).then(function(t){return t.json()}).then(function(t){if(n({object:s,id:t.id,state:t.state}),i({id:t.id,state:t.state,object:s}),"LOST"===t.state.runState||"KILLED"===t.state.runState||"FAILED"===t.state.runState){clearInterval(a);const e={error:t.state.errorMsg,state:t.state.runState,object:s,type:"processFailed"};n(e),r(e)}if("FINISHED"===t.state.runState&&t.setting.serviceInfo){clearInterval(a);const e={result:t,object:s,type:"processCompleted"};n(e),r(e)}}).catch(function(t){clearInterval(a);const e={error:t,object:s,type:"processFailed"};n(e),r(e)})},e)})}}class Me extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/buffers"),this.CLASS_NAME="SuperMap.BuffersAnalystJobsService"}destroy(){super.destroy()}getBuffersJobs(t){return super.getJobs(this.url,t)}getBuffersJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addBuffersJob(t,e,r,i){return super.addJob(this.url,t,we,e,r,i)}}class Ae{constructor(t){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.isUncertainDirectionValid=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.BurstPipelineAnalystParameters"}destroy(){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.isUncertainDirectionValid=null}}class Te extends ie{constructor(t,r){super(t,r),this.format=e.GEOJSON,this.CLASS_NAME="SuperMap.NetworkAnalystServiceBase"}destroy(){super.destroy(),this.format=null}transformResult(t,r){var i;return(t=rt.transformResult(t))&&this.format===e.GEOJSON&&"function"==typeof this.toGeoJSONResult&&(i=this.toGeoJSONResult(t)),i||(i=t),{result:i,options:r}}toGeoJSONResult(t){return null}}class Ee extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.BurstPipelineAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(!(t instanceof Ae))return null;var r;if(this.url=rt.urlPathAppend(this.url,"burstAnalyse"),r={sourceNodeIDs:t.sourceNodeIDs,isUncertainDirectionValid:t.isUncertainDirectionValid},null!==t.edgeID&&null!==t.nodeID)throw new Error("edgeID and nodeID cannot be null at the same time.");if(null===t.edgeID&&null===t.nodeID)throw new Error("edgeID and nodeID cannot be null at the same time.");return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}class Oe extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ChartFeatureInfoSpecsService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t){return this.isTempLayers||rt.urlPathAppend(this.url,"chartFeatureInfoSpecs"),this.request({method:"GET",params:null,scope:this,success:t,failure:t})}}class Le{constructor(t){this.isQueryPoint=null,this.isQueryLine=null,this.isQueryRegion=null,this.attributeFilter=null,this.chartFeatureInfoSpecCode=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.ChartQueryFilterParameter"}destroy(){var t=this;t.isQueryPoint=null,t.isQueryLine=null,t.isQueryRegion=null,t.attributeFilter=null,t.chartFeatureInfoSpecCode=null}toJson(){var t="";return t+='"isQueryPoint":'+this.isQueryPoint+",",t+='"isQueryLine":'+this.isQueryLine+",",t+='"isQueryRegion":'+this.isQueryRegion+",",this.attributeFilter&&(t+='"attributeFilter": "'+this.attributeFilter+'",'),t="{"+(t+='"chartFeatureInfoSpecCode":'+this.chartFeatureInfoSpecCode)+"}"}}class Pe{constructor(t){this.queryMode=null,this.bounds=null,this.chartLayerNames=null,this.chartQueryFilterParameters=null,this.returnContent=!0,this.startRecord=0,this.expectCount=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.ChartQueryParameters"}destroy(){var t=this;t.queryMode=null,t.bounds=null,t.chartLayerNames=null,t.chartQueryFilterParameters=null,t.returnContent=!0,t.startRecord=0,t.expectCount=null}getVariablesJson(){var t="";if(t+='"queryMode":"'+this.queryMode+'",',this.chartLayerNames&&this.chartLayerNames.length){for(var e=[],r=this.chartLayerNames.length,i=0;i<r;i++)e.push('"'+this.chartLayerNames[i]+'"');t+='"chartLayerNames":'+("["+e.join(",")+"]")+","}if("ChartBoundsQuery"===this.queryMode&&this.bounds&&(t+='"bounds":{"leftBottom":{"x":'+this.bounds.left+',"y":'+this.bounds.bottom+'},"rightTop":{"x":'+this.bounds.right+',"y":'+this.bounds.top+"}},"),this.chartQueryFilterParameters&&this.chartQueryFilterParameters.length){for(var s=[],n=this.chartQueryFilterParameters.length,a=0;a<n;a++){var o=this.chartQueryFilterParameters[a];o instanceof Le&&s.push(o.toJson())}var l="["+s.join(",")+"]";l='"chartQueryParams":'+l+",",l+='"startRecord":'+this.startRecord+",",t+='"chartQueryParameters":'+(l="{"+(l+='"expectCount":'+this.expectCount)+"}")}return t="{"+t+"}"}}class Ne{constructor(t){t&&(this.customParams=null,this.prjCoordSys=null,this.expectCount=1e5,this.networkType=s.LINE,this.queryOption=n.ATTRIBUTEANDGEOMETRY,this.queryParams=null,this.startRecord=0,this.holdTime=10,this.returnCustomResult=!1,this.returnFeatureWithFieldCaption=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.QueryParameters")}destroy(){var t=this;if(t.customParams=null,t.expectCount=null,t.networkType=null,t.queryOption=null,t.queryParams){for(var e=0,r=t.queryParams,i=r.length;e<i;e++)r[e].destroy();t.queryParams=null}t.startRecord=null,t.holdTime=null,t.returnCustomResult=null,t.prjCoordSys=null}}class Ie extends ie{constructor(t,r){super(t,r),r=r||{},this.returnContent=null,this.format=e.GEOJSON,rt.extend(this,r);r.format&&(this.format=r.format.toUpperCase()),this.url&&(this.url=rt.urlPathAppend(this.url,"queryResults"),this.CLASS_NAME="SuperMap.ChartQueryService")}destroy(){ie.prototype.destroy.apply(this,arguments),this.returnContent=null,this.format=null}processAsync(t,e){if(t instanceof Pe){var r,i=this;return i.returnContent=t.returnContent,r=t.getVariablesJson(),i.returnContent&&(i.url=rt.urlAppend(i.url,"returnContent=true")),i.request({method:"POST",data:r,scope:i,success:e,failure:e})}}transformResult(t,r){if((t=rt.transformResult(t))&&t.recordsets&&this.format===e.GEOJSON)for(var i=0,s=t.recordsets,n=s.length;i<n;i++)if(s[i].features){var a=new Nt;s[i].features=a.toGeoJSON(s[i].features)}return{result:t,options:r}}getQueryParameters(t){return new Ne({queryMode:t.queryMode,bounds:t.bounds,chartLayerNames:t.chartLayerNames,chartQueryFilterParameters:t.chartQueryFilterParameters,returnContent:t.returnContent})}}class Fe{constructor(t){t=t||{},this.elevation=null,this.color=null,rt.extend(this,t);var e=this.color;e&&(this.color=new wt(e.red,e.green,e.blue)),this.CLASS_NAME="SuperMap.ColorDictionary"}destroy(){rt.reset(this)}toServerJSONObject(){var t={};return t=rt.copyAttributes(t,this)}}class ke{constructor(t){t&&(this.returnEdgeFeatures=!1,this.returnEdgeGeometry=!1,this.returnEdgeIDs=!1,this.returnNodeFeatures=!1,this.returnNodeGeometry=!1,this.returnNodeIDs=!1,this.returnPathGuides=!1,this.returnRoutes=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.TransportationAnalystResultSetting")}destroy(){var t=this;t.returnEdgeFeatures=null,t.returnEdgeGeometry=null,t.returnEdgeIDs=null,t.returnNodeFeatures=null,t.returnNodeGeometry=null,t.returnNodeIDs=null,t.returnPathGuides=null,t.returnRoutes=null}}class De{constructor(t){t&&(this.barrierEdgeIDs=null,this.barrierNodeIDs=null,this.barrierPoints=null,this.weightFieldName=null,this.turnWeightField=null,this.resultSetting=new ke,rt.extend(this,t),this.CLASS_NAME="SuperMap.TransportationAnalystParameter")}destroy(){var t=this;if(t.barrierEdgeIDs=null,t.barrierNodeIDs=null,t.weightFieldName=null,t.turnWeightField=null,t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.barrierPoints&&t.barrierPoints.length)for(var e in t.barrierPoints)t.barrierPoints[e].destroy();t.barrierPoints=null}}class Re{constructor(t){this.isAnalyzeById=!1,this.nodes=null,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.ComputeWeightMatrixParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Be extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ComputeWeightMatrixService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Re){var r,i=this;return i.url=rt.urlPathAppend(i.url,"weightmatrix"),r={parameter:rt.toJSON(t.parameter),nodes:i.getJson(t.isAnalyzeById,t.nodes)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getJson(t,e){var r="[",i=e?e.length:0;if(!1===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+=e[t];return r+="]"}}class Ge extends ie{constructor(t,e){(e=e||{}).EVENT_TYPES=["broadcastSocketConnected","broadcastSocketClosed","broadcastSocketError","broadcastFailed","broadcastSucceeded","subscribeSocketConnected","subscribeSocketClosed","subscribeSocketError","messageSucceeded","setFilterParamSucceeded"],super(t,e),this.geometry=null,this.prjCoordSys=null,this.excludeField=null,rt.extend(this,e),this.CLASS_NAME="SuperMap.DataFlowService"}initBroadcast(){var t=this;return this.broadcastWebSocket=this._connect(rt.urlPathAppend(t.url,"broadcast")),this.broadcastWebSocket.onopen=function(e){t.broadcastWebSocket.isOpen=!0,e.eventType="broadcastSocketConnected",t.events.triggerEvent("broadcastSocketConnected",e)},this.broadcastWebSocket.onclose=function(e){t.broadcastWebSocket&&(t.broadcastWebSocket.isOpen=!1),e.eventType="broadcastSocketClosed",t.events.triggerEvent("broadcastSocketClosed",e)},this.broadcastWebSocket.onerror=function(e){e.eventType="broadcastSocketError",t.events.triggerEvent("broadcastSocketError",e)},this}broadcast(t){this.broadcastWebSocket&&this.broadcastWebSocket.isOpen?(this.broadcastWebSocket.send(JSON.stringify(t)),this.events.triggerEvent("broadcastSucceeded")):this.events.triggerEvent("broadcastFailed")}initSubscribe(){var t=this;return this.subscribeWebSocket=this._connect(rt.urlPathAppend(t.url,"subscribe")),this.subscribeWebSocket.onopen=function(e){t.subscribeWebSocket.send(t._getFilterParams()),e.eventType="subscribeSocketConnected",t.events.triggerEvent("subscribeSocketConnected",e)},this.subscribeWebSocket.onclose=function(e){e.eventType="subscribeWebSocketClosed",t.events.triggerEvent("subscribeWebSocketClosed",e)},this.subscribeWebSocket.onerror=function(e){e.eventType="subscribeSocketError",t.events.triggerEvent("subscribeSocketError",e)},this.subscribeWebSocket.onmessage=function(e){t._onMessage(e)},this}setExcludeField(t){return this.excludeField=t,this.subscribeWebSocket.send(this._getFilterParams()),this}setGeometry(t){return this.geometry=t,this.subscribeWebSocket.send(this._getFilterParams()),this}unSubscribe(){this.subscribeWebSocket&&(this.subscribeWebSocket.close(),this.subscribeWebSocket=null)}unBroadcast(){this.broadcastWebSocket&&(this.broadcastWebSocket.close(),this.broadcastWebSocket=null)}destroy(){ie.prototype.destroy.apply(this,arguments);this.geometry=null,this.prjCoordSys=null,this.excludeField=null,this.unBroadcast(),this.unSubscribe()}_getFilterParams(){var t={filterParam:{prjCoordSys:this.prjCoordSys,excludeField:this.excludeField,geometry:this.geometry}};return rt.toJSON(t)}_onMessage(t){if(t.data&&t.data.indexOf("filterParam")>=0){var e=JSON.parse(t.data);return t.filterParam=e,t.eventType="setFilterParamSucceeded",void this.events.triggerEvent("setFilterParamSucceeded",t)}var r=JSON.parse(t.data);t.featureResult=r,t.eventType="messageSucceeded",this.events.triggerEvent("messageSucceeded",t)}_connect(t){return t=Vt.appendCredential(t),"WebSocket"in window?new WebSocket(t):"MozWebSocket"in window?new(0,window.MozWebSocket)(t):(console.log("no WebSocket"),null)}}class Ue{constructor(t){t=t||{},this.bounds=null,this.dataSourceName=null,this.description=null,this.encodeType=null,this.isReadOnly=null,this.name=null,this.prjCoordSys=null,this.tableName=null,this.type=null,rt.extend(this,t);var e=this.bounds;e&&(this.bounds=new at(e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y)),this.CLASS_NAME="SuperMap.DatasetInfo"}destroy(){rt.reset(this)}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).bounds&&t.bounds.toServerJSONObject&&(t.bounds=t.bounds.toServerJSONObject()),t}}class je{constructor(t){this.operation=_.UNION,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.OverlayAnalystParameters"}destroy(){this.operation=null}}class ze extends je{constructor(t){super(t),this.operateDataset=null,this.operateDatasetFields=[],this.operateDatasetFilter=new ye,this.operateRegions=[],this.sourceDataset=null,this.sourceDatasetFields=[],this.sourceDatasetFilter=new ye,this.tolerance=0,this.resultSetting=new me,rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasetOverlayAnalystParameters"}destroy(){super.destroy();var t=this;if(t.operateDataset=null,t.operateDatasetFields=null,t.operateDatasetFilter&&(t.operateDatasetFilter.destroy(),t.operateDatasetFilter=null),t.operateRegions){for(var e=0,r=t.operateRegions,i=r.length;e<i;e++)r[e].destroy();t.operateRegions=null}t.sourceDataset=null,t.sourceDatasetFields=null,t.sourceDatasetFilter&&(t.sourceDatasetFilter.destroy(),t.sourceDatasetFilter=null),t.tolerance=null,t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null)}static toObject(t,e){for(var r in t)if("sourceDataset"!==r)if("operateRegions"===r){e.operateRegions=[];var i=t.operateRegions;for(var s in i)i.hasOwnProperty(s)&&(e.operateRegions[s]=Tt.fromGeometry(i[s]))}else"resultSetting"===r?e.dataReturnOption=t.resultSetting:e[r]=t[r]}}class Ve{constructor(t){this.clipRegion=null,this.datumValue=0,this.expectedZValues=null,this.interval=0,this.resampleTolerance=0,this.smoothMethod=w.BSPLINE,this.smoothness=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.SurfaceAnalystParametersSetting"}destroy(){var t=this;t.clipRegion&&(t.clipRegion.destroy(),t.clipRegion=null),t.datumValue=null,t.expectedZValues=null,t.interval=null,t.resampleTolerance=null,t.smoothMethod=null,t.smoothness=null}toJSON(){let t="'datumValue':"+rt.toJSON(this.datumValue);if(t+=",'interval':"+rt.toJSON(this.interval),t+=",'resampleTolerance':"+rt.toJSON(this.resampleTolerance),t+=",'smoothMethod':"+rt.toJSON(this.smoothMethod),t+=",'smoothness':"+rt.toJSON(this.smoothness),null!=this.expectedZValues&&(t+=",'expectedZValues':"+rt.toJSON(this.expectedZValues)),null!=this.clipRegion){var e=this.clipRegion;this.clipRegion instanceof Z&&this.clipRegion.components&&(e=Tt.fromGeometry(this.clipRegion)),t+=",'clipRegion':"+rt.toJSON(e)}return"{"+t+"}"}}class Je{constructor(t){this.resolution=0,this.extractParameter=new Ve,this.resultSetting=new me,this.surfaceAnalystMethod=C.ISOLINE,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.SurfaceAnalystParameters"}destroy(){var t=this;t.resolution=null,t.extractParameter&&(t.extractParameter.destroy(),t.extractParameter=null),t.resultSetting&&(t.resultSetting.destroy(),t.resultSetting=null),t.surfaceAnalystMethod=null}}class qe extends Je{constructor(t){super(t),this.dataset=null,this.filterQueryParameter=new ye,this.zValueFieldName=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasetSurfaceAnalystParameters"}destroy(){super.destroy();var t=this;t.dataset=null,t.filterQueryParameter&&(t.filterQueryParameter.destroy(),t.filterQueryParameter=null),t.zValueFieldName=null}static toObject(t,e){for(var r in t)if("filterQueryParameter"===r&&(e.filterQueryParameter=t.filterQueryParameter),"extractParameter"===r)t.extractParameter.clipRegion instanceof Z&&t.extractParameter.clipRegion.components&&(t.extractParameter.clipRegion=Tt.fromGeometry(t.extractParameter.clipRegion)),e.extractParameter=t.extractParameter;else{if("dataset"===r)continue;if("surfaceAnalystMethod"===r)continue;e[r]=t[r]}}}class He{constructor(t){t&&(this.clipRegion=null,this.createResultDataset=!1,this.resultDatasetName=null,this.resultDatasourceName=null,this.returnResultRegion=!0,rt.extend(this,t),this.CLASS_NAME="SuperMap.ThiessenAnalystParameters")}destroy(){var t=this;t.clipRegion&&(t.clipRegion.destroy(),t.clipRegion=null),t.createResultDataset=null,t.resultDatasetName=null,t.resultDatasourceName=null,t.returnResultRegion=null}}class We extends He{constructor(t){super(t),this.filterQueryParameter=null,this.dataset=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasetThiessenAnalystParameters"}destroy(){super.destroy();this.filterQueryParameter&&(this.filterQueryParameter.destroy(),this.filterQueryParameter=null)}static toObject(t,e){for(var r in t)"clipRegion"===r?e.clipRegion=Tt.fromGeometry(t.clipRegion):e[r]=t[r]}}class Ye extends ie{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.DatasourceService"}destroy(){super.destroy()}getDatasourceService(t,e){let r=rt.urlPathAppend(this.url,`datasources/name/${t}`);return this.processAsync(r,"GET",e)}getDatasourcesService(t){let e=rt.urlPathAppend(this.url,"datasources");return this.processAsync(e,"GET",t)}setDatasourceService(t,e){if(!t)return;const r=rt.urlPathAppend(this.url,`datasources/name/${t.datasourceName}`);return this.processAsync(r,"PUT",e,t)}processAsync(t,e,r,i){let s={url:t,method:e,scope:this,success:r,failure:r};return i&&(s.data=rt.toJSON(i)),this.request(s)}}class Xe{constructor(t){this.dataset=null,this.bounds=null,this.fieldName=null,this.resultGridDatasetResolution=null,this.searchRadius=null,this.targetDatasource=null,this.resultGridName=null,this.deleteExistResultDataset=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.DensityKernelAnalystParameters"}destroy(){var t=this;t.dataset=null,t.bounds=null,t.fieldName=null,t.resultGridDatasetResolution=null,t.searchRadius=null,t.targetDatasource=null,t.resultGridName=null,t.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class Qe extends ue{constructor(t,e){super(t,e),this.mode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.DensityAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r=this,i=new Object;t instanceof Xe&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/densityanalyst/kernel"),r.mode="kernel"),Xe.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class Ze{constructor(t){this.dataSourceName=null,this.dataSetName=null,this.features=null,this.editType=A.ADD,this.IDs=null,this.returnContent=!1,this.isUseBatch=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.EditFeaturesParameters"}destroy(){var t=this;t.dataSourceName=null,t.dataSetName=null,t.features=null,t.editType=null,t.IDs=null,t.returnContent=null}static toJsonParameters(t){var e,r,i;if(t.editType===A.DELETE){if(null===t.IDs)return;i={ids:t.IDs}}else if(i=[],t.features){r=t.features.length;for(var s=0;s<r;s++)(e=t.features[s]).geometry=Tt.fromGeometry(e.geometry),i.push(e)}return rt.toJSON(i)}}class Ke extends ie{constructor(t,e){super(t,e),this.returnContent=!1,this.isUseBatch=!1,e&&rt.extend(this,e),this.url=rt.urlPathAppend(this.url,"features"),this.CLASS_NAME="SuperMap.EditFeaturesService"}destroy(){super.destroy();this.returnContent=null,this.isUseBatch=null,this.fromIndex=null,this.toIndex=null}processAsync(t,e){if(t instanceof Ze){var r=this,i="POST",s="",n=t.editType,a=null;if(r.returnContent=t.returnContent,r.isUseBatch=t.isUseBatch,a=Ze.toJsonParameters(t),n===A.DELETE){a=s=rt.toJSON(t.IDs);var o=rt.urlAppend(r.url,rt.getParameterString({ids:s}));zt.urlIsLong(o)?(r.url=rt.urlAppend(r.url,rt.getParameterString({_method:"DELETE"})),i="POST"):(r.url=o,i="DELETE")}else n===A.UPDATE?i="PUT":(r.isUseBatch&&(r.url=rt.urlAppend(r.url,`isUseBatch=${r.isUseBatch}`),r.returnContent=!1),r.returnContent&&(r.url=rt.urlAppend(r.url,"returnContent=true"),i="POST"));return r.request({method:i,data:a,scope:r,success:e,failure:e})}}getMetaData(t,e){var r=t.featureId;return this.url=rt.urlPathAppend(this.url,r+"/metadata"),this.request({method:"GET",data:null,scope:this,success:e,failure:e})}}class $e{constructor(t){this.edgeID=null,this.nodeID=null,this.weightName=null,this.isUncertainDirectionValid=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalyst3DParameters"}destroy(){this.edgeID=null,this.nodeID=null,this.weightName=null,this.isUncertainDirectionValid=null}}class tr extends $e{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystSinks3DParameters"}destroy(){super.destroy()}}class er extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystSinks3DService"}destroy(){ie.prototype.destroy.apply(this,arguments)}processAsync(t,e){if(t instanceof tr){var r;return this.url=rt.urlPathAppend(this.url,"sinks"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class rr extends $e{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystSources3DParameters"}destroy(){super.destroy()}}class ir extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystSources3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof rr){var r;return this.url=rt.urlPathAppend(this.url,"sources"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class sr{constructor(t){this.sourceNodeIDs=null,this.edgeID=null,this.nodeID=null,this.isUncertainDirectionValid=!1,this.queryType=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalystStreamParameters"}destroy(){var t=this;t.edgeID=null,t.nodeID=null,t.weightName=null,t.isUncertainDirectionValid=null,t.type=null}}class nr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystStreamService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof sr){var r,i=this;if(0===t.queryType)i.url=rt.urlPathAppend(i.url,"upstreamcirticalfaclilities");else{if(1!==t.queryType)return;i.url=rt.urlPathAppend(i.url,"downstreamcirticalfaclilities")}if(r={sourceNodeIDs:t.sourceNodeIDs,isUncertainDirectionValid:t.isUncertainDirectionValid},!(null!==t.edgeID&&null!==t.nodeID||null===t.edgeID&&null===t.nodeID))return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}}class ar extends $e{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystTracedown3DParameters"}destroy(){super.destroy()}}class or extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystTracedown3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ar){var r;return this.url=rt.urlPathAppend(this.url,"tracedownresult"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class lr extends $e{constructor(t){super(t),this.CLASS_NAME="SuperMap.FacilityAnalystTraceup3DParameters"}destroy(){super.destroy()}}class hr extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystTraceup3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof lr){var r;return this.url=rt.urlPathAppend(this.url,"traceupresult"),r={edgeID:t.edgeID,nodeID:t.nodeID,weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class ur extends $e{constructor(t){super(t),t=t||{},this.sourceNodeIDs=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.FacilityAnalystUpstream3DParameters"}destroy(){super.destroy(),this.sourceNodeIDs=null}}class cr extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FacilityAnalystUpstream3DService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ur){var r;return this.url=rt.urlPathAppend(this.url,"upstreamcirticalfaclilities"),r={sourceNodeIDs:t.sourceNodeIDs,edgeID:t.edgeID,nodeID:t.nodeID,isUncertainDirectionValid:t.isUncertainDirectionValid},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class dr{constructor(t){this.datasource=null,this.dataset=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.FieldParameters"}destroy(){this.datasource=null,this.dataset=null}}class pr extends dr{constructor(t){super(t),this.fieldName=null,this.statisticMode=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.FieldStatisticsParameters"}destroy(){this.fieldName=null,this.statisticMode=null}}class fr extends ie{constructor(t,e){super(t,e),this.datasource=null,this.dataset=null,this.field=null,this.statisticMode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.FieldStatisticService"}destroy(){super.destroy();this.datasource=null,this.dataset=null,this.field=null,this.statisticMode=null}processAsync(t){var e=this,r="datasources/"+e.datasource+"/datasets/"+e.dataset+"/fields/"+e.field+"/"+e.statisticMode;return e.url=rt.urlPathAppend(e.url,r),e.request({method:"GET",data:null,scope:e,success:t,failure:t})}}class mr{constructor(t){this.event=null,this.expectFacilityCount=1,this.facilities=null,this.fromEvent=!1,this.isAnalyzeById=!1,this.maxWeight=0,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindClosestFacilitiesParameters"}destroy(){var t=this;t.event=null,t.expectFacilityCount=null,t.facilities=null,t.fromEvent=null,t.isAnalyzeById=null,t.maxWeight=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class yr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindClosestFacilitiesService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof mr){var r,i=this;return i.url=rt.urlPathAppend(i.url,"closestfacility"),r={expectFacilityCount:t.expectFacilityCount,fromEvent:t.fromEvent,maxWeight:t.maxWeight,parameter:rt.toJSON(t.parameter),event:rt.toJSON(t.event),facilities:i.getJson(t.isAnalyzeById,t.facilities)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getJson(t,e){var r="[",i=e?e.length:0;if(!1===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.facilityPathList)return t;var e=new Nt;return t.facilityPathList.map(function(t){return t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t}),t}}class gr{constructor(t){this.expectedSupplyCenterCount=null,this.isFromCenter=!1,this.supplyCenters=null,this.turnWeightField=null,this.weightName=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindLocationParameters"}destroy(){var t=this;if(t.expectedSupplyCenterCount=null,t.isFromCenter=null,t.turnWeightField=null,t.weightName=null,t.supplyCenters){for(var e=0,r=t.supplyCenters,i=r.length;e<i;e++)r[e].destroy();t.supplyCenters=null}}}class vr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindLocationService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof gr){var r,i=this;return i.url=rt.urlPathAppend(i.url,"location"),r={isFromCenter:t.isFromCenter,expectedSupplyCenterCount:t.expectedSupplyCenterCount,weightName:t.weightName,turnWeightField:t.turnWeightField,returnEdgeFeature:!0,returnEdgeGeometry:!0,returnNodeFeature:!0,mapParameter:rt.toJSON(t.mapParameter),supplyCenters:i.getCentersJson(t.supplyCenters)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getCentersJson(t){for(var e="[",r=t?t.length:0,i=0;i<r;i++)i>0&&(e+=","),e+=rt.toJSON(t[i]);return e+="]"}toGeoJSONResult(t){if(!t)return null;var e=new Nt;return t.demandResults&&(t.demandResults=e.toGeoJSON(t.demandResults)),t.supplyResults&&(t.supplyResults=e.toGeoJSON(t.supplyResults)),t}}class br{constructor(t){this.centers=null,this.hasLeastTotalCost=!1,this.isAnalyzeById=!1,this.nodes=null,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindMTSPPathsParameters"}destroy(){var t=this;t.centers=null,t.hasLeastTotalCost=null,t.isAnalyzeById=null,t.nodes=null,t.maxWeight=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Sr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindMTSPPathsService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof br){var r,i=this,s=i.getJson(t.isAnalyzeById,t.centers),n=i.getJson(t.isAnalyzeById,t.nodes);return i.url=rt.urlPathAppend(i.url,"mtsppath"),r={centers:s,nodes:n,parameter:rt.toJSON(t.parameter),hasLeastTotalCost:t.hasLeastTotalCost},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getJson(t,e){var r="[",i=e?e.length:0;if(!1===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.pathList)return null;var e=new Nt;return t.pathList.map(function(t){return t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t}),t}}class _r{constructor(t){this.isAnalyzeById=!1,this.hasLeastEdgeCount=null,this.nodes=null,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindPathParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.hasLeastEdgeCount=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class xr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindPathService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof _r){var r,i=this;return i.url=rt.urlPathAppend(i.url,"path"),r={hasLeastEdgeCount:t.hasLeastEdgeCount,parameter:rt.toJSON(t.parameter),nodes:i.getJson(t.isAnalyzeById,t.nodes)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getJson(t,e){var r="[",i=e?e.length:0;if(!1===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.pathList||t.pathList.length<1)return null;var e=new Nt;return t.pathList.forEach(function(t){t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures))}),t}}class wr{constructor(t){this.isAnalyzeById=!1,this.isCenterMutuallyExclusive=!1,this.centers=null,this.isFromCenter=!1,this.weights=null,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindServiceAreasParameters"}destroy(){var t=this;t.isAnalyzeById=null,t.isCenterMutuallyExclusive=null,t.centers=null,t.isFromCenter=null,t.weights=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Cr extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindServiceAreasService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof wr){var r,i=this;return i.url=rt.urlPathAppend(i.url,"servicearea"),r={isFromCenter:t.isFromCenter,isCenterMutuallyExclusive:t.isCenterMutuallyExclusive,parameter:rt.toJSON(t.parameter),centers:i.getJson(t.isAnalyzeById,t.centers),weights:i.getJson(!0,t.weights)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getJson(t,e){var r="[",i=e?e.length:0;if(!1===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+='{"x":'+e[t].x+',"y":'+e[t].y+"}";else if(!0===t)for(let t=0;t<i;t++)t>0&&(r+=","),r+=e[t];return r+="]"}toGeoJSONResult(t){if(!t||!t.serviceAreaList)return t;var e=new Nt;return t.serviceAreaList.map(function(t){return t.serviceRegion&&(t.serviceRegion=e.toGeoJSON(t.serviceRegion)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures)),t.routes&&(t.routes=e.toGeoJSON(t.routes)),t}),t}}class Mr{constructor(t){this.endNodeAssigned=!1,this.isAnalyzeById=!1,this.nodes=null,this.parameter=new De,rt.extend(this,t),this.CLASS_NAME="SuperMap.FindTSPPathsParameters"}destroy(){var t=this;t.endNodeAssigned=null,t.isAnalyzeById=null,t.nodes=null,t.parameter&&(t.parameter.destroy(),t.parameter=null)}}class Ar extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.FindTSPPathsService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Mr){var r,i=this;return i.url=rt.urlPathAppend(i.url,"tsppath"),r={parameter:rt.toJSON(t.parameter),endNodeAssigned:t.endNodeAssigned,nodes:i.getNodesJson(t)},i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}getNodesJson(t){var e,r,i,s,n="";if(!1===t.isAnalyzeById){for(e="[",r=0,i=(s=t.nodes).length;r<i;r++)r>0&&(e+=","),e+='{"x":'+s[r].x+',"y":'+s[r].y+"}";n+=e+="]"}else if(!0===t.isAnalyzeById){let e="[",r=t.nodes,i=r.length;for(let t=0;t<i;t++)t>0&&(e+=","),e+=r[t];n+=e+="]"}return n}toGeoJSONResult(t){if(!t||!t.tspPathList)return null;var e=new Nt;return t.tspPathList.forEach(function(t){t.route&&(t.route=e.toGeoJSON(t.route)),t.pathGuideItems&&(t.pathGuideItems=e.toGeoJSON(t.pathGuideItems)),t.edgeFeatures&&(t.edgeFeatures=e.toGeoJSON(t.edgeFeatures)),t.nodeFeatures&&(t.nodeFeatures=e.toGeoJSON(t.nodeFeatures))}),t}}class Tr{constructor(t){this.routeTable=null,this.routeIDField=null,this.attributeFilter=null,this.eventTable=null,this.eventRouteIDField=null,this.measureField=null,this.measureStartField=null,this.measureEndField=null,this.measureOffsetField=null,this.errorInfoField=null,this.retainedFields=null,this.dataReturnOption=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GenerateSpatialDataParameters"}destroy(){var t=this;t.routeTable&&(t.routeTable=null),t.routeIDField=null,t.attributeFilter=null,t.eventTable=null,t.eventRouteIDField=null,t.measureField=null,t.measureStartField=null,t.measureEndField=null,t.measureOffsetField=null,t.errorInfoField=null,t.dataReturnOption&&(t.dataReturnOption.destroy(),t.dataReturnOption=null)}}class Er extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GenerateSpatialDataService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Tr){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="datasets/"+t.routeTable+"/linearreferencing/generatespatialdata";return this.url=rt.urlPathAppend(this.url,e),this.url=rt.urlAppend(this.url,"returnContent=true"),rt.toJSON(t)}}class Or extends je{constructor(t){super(t),t&&t.operateGeometry&&(this.operateGeometry=t.operateGeometry),t&&t.sourceGeometry&&(this.sourceGeometry=t.sourceGeometry),t&&t.operateGeometries&&(this.operateGeometries=t.operateGeometries),t&&t.sourceGeometries&&(this.sourceGeometries=t.sourceGeometries),t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GeometryOverlayAnalystParameters"}destroy(){super.destroy();var t=this;t.sourceGeometry&&(t.sourceGeometry.destroy(),t.sourceGeometry=null),t.sourceGeometries&&(t.sourceGeometries.destroy(),t.sourceGeometries=null),t.sourceGeometry&&(t.sourceGeometry.destroy(),t.sourceGeometry=null),t.operateGeometries&&(t.operateGeometries.destroy(),t.operateGeometries=null)}static toObject(t,e){for(var r in t)if("sourceGeometry"===r)e.sourceGeometry=Tt.fromGeometry(t.sourceGeometry);else if("sourceGeometries"===r){for(var i=[],s=0;s<t.sourceGeometries.length;s++)i.push(Tt.fromGeometry(t.sourceGeometries[s]));e.sourceGeometries=i}else if("operateGeometry"===r)e.operateGeometry=Tt.fromGeometry(t.operateGeometry);else if("operateGeometries"===r){for(var n=[],a=0;a<t.operateGeometries.length;a++)n.push(Tt.fromGeometry(t.operateGeometries[a]));e.operateGeometries=n}else e[r]=t[r]}}class Lr extends Je{constructor(t){super(t),this.points=null,this.zValues=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GeometrySurfaceAnalystParameters"}destroy(){super.destroy();if(this.points){for(var t=0,e=this.points,r=e.length;t<r;t++)e[t].destroy();this.points=null}this.zValues=null}}class Pr extends He{constructor(t){super(t),this.points=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GeometryThiessenAnalystParameters"}destroy(){super.destroy();if(this.points){for(var t=this.points.length-1;t>=0;t--)this.points[t].destroy();this.points=null}}static toObject(t,e){for(var r in t)"clipRegion"===r?e.clipRegion=Tt.fromGeometry(t.clipRegion):e[r]=t[r]}}class Nr extends ie{constructor(t,e){super(t,e=e||{}),this.CLASS_NAME="SuperMap.GeoprocessingService",this.headers={},this.crossOrigin=!0}getTools(t){return this._processAsync({url:`${this.url}/list`,callback:t})}getTool(t,e){return this._processAsync({url:`${this.url}/${t}`,callback:e})}execute(t,e,r,i){const s={parameter:e=e||null,environment:r=r||null};return this._processAsync({url:`${this.url}/${t}/execute`,executeParamter:s,callback:i})}submitJob(t,e,r,i){e=e||null,r=r||null;const s=JSON.stringify({parameter:e,environments:r});return this._processAsync({url:`${this.url}/${t}/jobs`,method:"POST",callback:i,params:s})}waitForJobCompletion(t,e,r,i){const s=this,n=setInterval(function(){s._processAsync({url:`${s.url}/${e}/jobs/${t}`,callback:function(t){const e=t.result.state.runState;t.options.statusCallback&&t.options.statusCallback(e),-1!==["FINISHED","FAILED","CANCELED"].indexOf(e)&&(clearInterval(n),i(t))}})},r.interval)}getJobInfo(t,e,r){return this._processAsync({url:`${this.url}/${t}/jobs/${e}`,callback:r})}cancelJob(t,e,r){return this._processAsync({url:`${this.url}/${t}/jobs/${e}/cancel`,callback:r})}getJobs(t,e){let r=`${this.url}/jobs`;t&&"string"==typeof t?r=`${this.url}/${t}/jobs`:e=t,this._processAsync({url:r,callback:e})}getResults(t,e,r,i){let s=`${this.url}/${t}/jobs/${e}/results`;return r&&("string"==typeof r?s=`${s}/${r}`:i=r),this._processAsync({url:s,callback:i})}_processAsync({url:t,method:e,callback:r,paramter:i}){return this.request({url:t,method:e||"GET",params:i,headers:{"Content-type":"application/json"},scope:this,success:r,failure:r})}}class Ir{constructor(t){this.dataset=null,this.sourceFilter=null,this.referenceFilter=null,this.spatialRelationType=null,this.isBorderInside=null,this.returnFeature=null,this.returnGeoRelatedOnly=null,this.startRecord=0,this.expectCount=500,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GeoRelationAnalystParameters"}destroy(){var t=this;t.sourceFilter&&t.sourceFilter.destroy(),t.sourceFilter=null,t.referenceFilter&&t.referenceFilter.destroy(),t.referenceFilter=null,t.dataset=null,t.spatialRelationType=null,t.isBorderInside=null,t.returnFeature=null,t.returnGeoRelatedOnly=null,t.startRecord=null,t.expectCount=null}}class Fr extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GeoRelationAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Ir){var r=this;r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/georelation");var i=rt.toJSON(t);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}}class kr extends ie{constructor(t,e){super(t,e),e&&(this.datasource=null,this.dataset=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.DatasetService")}destroy(){super.destroy();this.datasource=null,this.dataset=null}getDatasetsService(t,e){const r=rt.urlPathAppend(this.url,`datasources/name/${t}/datasets`);return this.processAsync(r,"GET",e)}getDatasetService(t,e,r){const i=rt.urlPathAppend(this.url,`datasources/name/${t}/datasets/name/${e}`);return this.processAsync(i,"GET",r)}setDatasetService(t,e){if(!t)return;const r=rt.urlPathAppend(this.url,`datasources/name/${t.datasourceName}/datasets/name/${t.datasetName}`);return delete t.datasourceName,this.processAsync(r,"PUT",e,t)}deleteDatasetService(t,e,r){const i=rt.urlPathAppend(this.url,`datasources/name/${t}/datasets/name/${e}`);return this.processAsync(i,"DELETE",r)}processAsync(t,e,r,i){let s={url:t,method:e,scope:this,success:r,failure:r};return i&&(s.data=rt.toJSON(i)),this.request(s)}}class Dr{constructor(t){this.datasetNames=null,this.targetEpsgCode=null,this.targetPrj=null,this.returnContent=!0,this.fromIndex=0,this.toIndex=19,this.returnCountOnly=!1,this.maxFeatures=null,this.hasGeometry=!0,this.aggregations=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesParametersBase"}destroy(){var t=this;t.datasetNames=null,t.returnContent=null,t.fromIndex=null,t.toIndex=null,t.hasGeometry=null,t.maxFeatures=null,t.targetEpsgCode=null,t.targetPrj=null,t.aggregation&&(t.aggregation=null)}}class Rr extends Dr{constructor(t){super(t),this.getFeatureMode=Rr.getFeatureMode.BOUNDS,this.bounds=null,this.fields=null,this.attributeFilter=null,this.spatialQueryMode=a.CONTAIN,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByBoundsParameters"}destroy(){super.destroy();var t=this;if(t.bounds&&(t.bounds.destroy(),t.bounds=null),t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.attributeFilter=null,t.spatialQueryMode=null,t.getFeatureMode=null}static toJsonParameters(t){var e,r,i;return r={leftBottom:{x:t.bounds.left,y:t.bounds.bottom},rightTop:{x:t.bounds.right,y:t.bounds.top}},i={datasetNames:t.datasetNames,getFeatureMode:Rr.getFeatureMode.BOUNDS,bounds:r,spatialQueryMode:t.spatialQueryMode},t.fields&&((e=new ye).name=t.datasetNames,e.fields=t.fields,i.queryParameter=e),t.attributeFilter&&(i.attributeFilter=t.attributeFilter,i.getFeatureMode=Rr.getFeatureMode.BOUNDS_ATTRIBUTEFILTER),t.maxFeatures&&!isNaN(t.maxFeatures)&&(i.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(i.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(i.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(i.targetPrj=t.targetPrj),t.aggregations&&(i.aggregations=t.aggregations),rt.toJSON(i)}}Rr.getFeatureMode={BOUNDS:"BOUNDS",BOUNDS_ATTRIBUTEFILTER:"BOUNDS_ATTRIBUTEFILTER"};class Br extends ie{constructor(t,r){super(t,r),r=r||{},this.returnContent=!0,this.fromIndex=0,this.toIndex=19,this.hasGeometry=!0,this.maxFeatures=null,this.format=e.GEOJSON,rt.extend(this,r),this.url=rt.urlPathAppend(this.url,"featureResults"),this.CLASS_NAME="SuperMap.GetFeaturesServiceBase"}destroy(){super.destroy();var t=this;t.returnContent=null,t.fromIndex=null,t.toIndex=null,t.maxFeatures=null,t.format=null,t.hasGeometry=null}processAsync(t,e){if(t){var r,i=this,s=!0;return i.returnContent=t.returnContent,i.fromIndex=t.fromIndex,i.toIndex=t.toIndex,i.maxFeatures=t.maxFeatures,i.hasGeometry=t.hasGeometry,i.returnContent&&(s=!1),null!=i.fromIndex&&null!=i.toIndex&&!isNaN(i.fromIndex)&&!isNaN(i.toIndex)&&i.fromIndex>=0&&i.toIndex>=0&&!s&&(i.url=rt.urlAppend(i.url,`fromIndex=${i.fromIndex}&toIndex=${i.toIndex}`)),t.returnCountOnly&&(i.url=rt.urlAppend(i.url,"&returnCountOnly="+t.returnContent)),r=i.getJsonParameters(t),i.request({method:"POST",data:r,scope:i,success:e,failure:e})}}transformResult(t,r){if(t=rt.transformResult(t),this.format===e.GEOJSON&&t.features){var i=new Nt;t.features=i.toGeoJSON(t.features)}return{result:t,options:r}}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}}class Gr extends Br{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByBoundsService"}destroy(){super.destroy()}getJsonParameters(t){return Rr.toJsonParameters(t)}}class Ur extends Dr{constructor(t){super(t),this.bufferDistance=null,this.attributeFilter=null,this.geometry=null,this.fields=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByBufferParameters"}destroy(){super.destroy();var t=this;if(t.bufferDistance=null,t.attributeFilter=null,t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.geometry&&(t.geometry.destroy(),t.geometry=null)}static toJsonParameters(t){var e,r,i;return i=Tt.fromGeometry(t.geometry),r={datasetNames:t.datasetNames,getFeatureMode:"BUFFER",bufferDistance:t.bufferDistance,geometry:i},t.fields&&((e=new ye).name=t.datasetNames,e.fields=t.fields,r.queryParameter=e),t.attributeFilter&&(r.attributeFilter=t.attributeFilter,r.getFeatureMode="BUFFER_ATTRIBUTEFILTER"),t.maxFeatures&&!isNaN(t.maxFeatures)&&(r.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(r.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(r.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(r.targetPrj=t.targetPrj),rt.toJSON(r)}}class jr extends Br{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByBufferService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Ur)return Ur.toJsonParameters(t)}}class zr extends Dr{constructor(t){super(t),this.getFeatureMode="SPATIAL",this.geometry=null,this.fields=null,this.attributeFilter=null,this.spatialQueryMode=a.CONTAIN,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByGeometryParameters"}destroy(){super.destroy();var t=this;if(t.geometry&&(t.geometry.destroy(),t.geometry=null),t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}t.attributeFilter=null,t.spatialQueryMode=null,t.getFeatureMode=null}static toJsonParameters(t){var e,r,i;return r=Tt.fromGeometry(t.geometry),i={datasetNames:t.datasetNames,getFeatureMode:"SPATIAL",geometry:r,spatialQueryMode:t.spatialQueryMode},t.fields&&((e=new ye).name=t.datasetNames,e.fields=t.fields,i.queryParameter=e),t.attributeFilter&&(i.attributeFilter=t.attributeFilter,i.getFeatureMode="SPATIAL_ATTRIBUTEFILTER"),t.maxFeatures&&!isNaN(t.maxFeatures)&&(i.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(i.hasGeometry=t.hasGeometry),t.targetEpsgCode&&(i.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(i.targetPrj=t.targetPrj),t.aggregations&&(i.aggregations=t.aggregations),rt.toJSON(i)}}class Vr extends Br{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByGeometryService"}destroy(){super.destroy()}getJsonParameters(t){return zr.toJsonParameters(t)}}class Jr extends Dr{constructor(t){super(t),this.getFeatureMode="ID",this.IDs=null,this.fields=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesByIDsParameters"}destroy(){super.destroy();var t=this;if(t.IDs=null,t.getFeatureMode=null,t.fields){for(;t.fields.length>0;)t.fields.pop();t.fields=null}}static toJsonParameters(t){var e,r;return e={datasetNames:t.datasetNames,getFeatureMode:"ID",ids:t.IDs},t.fields&&((r=new ye).name=t.datasetNames,r.fields=t.fields,e.queryParameter=r),t.targetEpsgCode&&(e.targetEpsgCode=t.targetEpsgCode),"boolean"==typeof t.hasGeometry&&(e.hasGeometry=t.hasGeometry),!t.targetEpsgCode&&t.targetPrj&&(e.targetPrj=t.targetPrj),t.aggregations&&(e.aggregations=t.aggregations),rt.toJSON(e)}}class qr extends Br{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesByIDsService"}destroy(){super.destroy()}getJsonParameters(t){return Jr.toJsonParameters(t)}}class Hr extends Dr{constructor(t){super(t),this.getFeatureMode="SQL",this.queryParameter=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetFeaturesBySQLParameters"}destroy(){super.destroy();this.getFeatureMode=null,this.queryParameter&&(this.queryParameter.destroy(),this.queryParameter=null)}static toJsonParameters(t){var e={datasetNames:t.datasetNames,getFeatureMode:"SQL",queryParameter:t.queryParameter};return t.maxFeatures&&!isNaN(t.maxFeatures)&&(e.maxFeatures=t.maxFeatures),"boolean"==typeof t.hasGeometry&&(e.hasGeometry=t.hasGeometry),t.aggregations&&(e.aggregations=t.aggregations),t.targetEpsgCode&&(e.targetEpsgCode=t.targetEpsgCode),!t.targetEpsgCode&&t.targetPrj&&(e.targetPrj=t.targetPrj),t.aggregations&&(e.aggregations=t.aggregations),rt.toJSON(e)}}class Wr extends Br{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.GetFeaturesBySQLService"}destroy(){super.destroy()}getJsonParameters(t){return Hr.toJsonParameters(t)}}class Yr extends ie{constructor(t,e){super(t,e),this.datasource=null,this.dataset=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.GetFieldsService"}destroy(){super.destroy();this.datasource=null,this.dataset=null}processAsync(t){var e=this;return e.url=rt.urlPathAppend(e.url,`datasources/${e.datasource}/datasets/${e.dataset}/fields`),e.request({method:"GET",data:null,scope:e,success:t,failure:t})}}class Xr{constructor(t){this.datasetName=null,this.dataSourceName=null,this.X=null,this.Y=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetGridCellInfosParameters"}destroy(){this.datasetName=null,this.dataSourceName=null,this.X=null,this.Y=null}}class Qr extends ie{constructor(t,e){super(t,e),this.datasetName=null,this.dataSourceName=null,this.datasetType=null,this.X=null,this.Y=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.GetGridCellInfosService"}destroy(){super.destroy();var t=this;t.X=null,t.Y=null,t.datasetName=null,t.dataSourceName=null,t.datasetType=null}processAsync(t,e){if(t instanceof Xr){rt.extend(this,t);var r=this;return r.url=rt.urlPathAppend(r.url,`datasources/${r.dataSourceName}/datasets/${r.datasetName}`),r.request({method:"GET",data:null,scope:r,success({result:t}){e&&r.getDatasetInfoCompleted(t,e)},failure:e}).then(({result:t})=>r.getDatasetInfoCompleted(t))}}getDatasetInfoCompleted(t,e){return t=rt.transformResult(t),this.datasetType=t.datasetInfo.type,this.queryGridInfos(e)}queryGridInfos(t){var e=this,r=rt.urlPathAppend(e.url,"GRID"==e.datasetType?"gridValue":"imageValue");return null!=e.X&&null!=e.Y&&(r=rt.urlAppend(r,`x=${e.X}&y=${e.Y}`)),e.request({url:r,method:"GET",data:null,scope:e,success:t,failure:t})}}class Zr{constructor(t,e){if(!t)return this;this.memoryData=null,this.type=t,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.Theme"}destroy(){this.memoryData&&(this.memoryData.destroy(),this.memoryData=null),this.type=null}toServerJSONObject(){}}class Kr{constructor(t){this.align=y.BASELINECENTER,this.backColor=new wt(255,255,255),this.foreColor=new wt(0,0,0),this.backOpaque=!1,this.sizeFixed=!0,this.fontHeight=6,this.fontWidth=0,this.fontWeight=400,this.fontName="Times New Roman",this.bold=!1,this.italic=!1,this.italicAngle=0,this.shadow=!1,this.strikeout=!1,this.outline=!1,this.opaqueRate=0,this.underline=!1,this.rotation=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ServerTextStyle"}destroy(){var t=this;t.align=null,t.backColor&&(t.backColor.destroy(),t.backColor=null),t.foreColor&&(t.foreColor.destroy(),t.foreColor=null),t.backOpaque=null,t.sizeFixed=null,t.fontHeight=null,t.fontWidth=null,t.fontWeight=null,t.fontName=null,t.bold=null,t.italic=null,t.italicAngle=null,t.shadow=null,t.strikeout=null,t.outline=null,t.opaqueRate=null,t.underline=null,t.rotation=null}static fromObj(t){var e=new Kr(t);return rt.copy(e,t),e.backColor=wt.fromJson(t.backColor),e.foreColor=wt.fromJson(t.foreColor),e}}class $r{constructor(t){this.caption=null,this.end=0,this.start=0,this.visible=!0,this.style=new Kr,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}static fromObj(t){if(t){var e=new $r;return rt.copy(e,t),e}}}class ti{constructor(t){this.caption=null,this.style=new Ct,this.unique=null,this.visible=!0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeUniqueItem"}destroy(){var t=this;t.caption=null,t.unique=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){var e=new ti;return rt.copy(e,t),e.style=Ct.fromJson(t.style),e}}class ei{constructor(t){this.offsetFixed=!1,this.offsetX="0.0",this.offsetY="0.0",t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeOffset"}destroy(){this.offsetFixed=null,this.offsetX=null,this.offsetY=null}static fromObj(t){if(t){var e=new ei;return rt.copy(e,t),e}}}class ri{constructor(t){this.defaultStyle=null,this.separator=null,this.separatorEnabled=!1,this.splitIndexes=null,this.styles=new Kr,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.LabelMixedTextStyle"}destroy(){var t=this;if(t.defaultStyle&&(t.defaultStyle.destroy(),t.defaultStyle=null),t.separator=null,t.separatorEnabled=null,t.splitIndexes&&(t.splitIndexes=null),t.styles){for(var e=0,r=t.styles,i=r.length;e<i;e++)r[e].destroy();t.styles=null}}static fromObj(t){if(t){var e=new ri,r=t.styles;if(rt.copy(e,t),e.defaultStyle=new Kr(t.defaultStyle),r){e.styles=[];for(var i=0,s=r.length;i<s;i++)e.styles.push(new Kr(r[i]))}return e}}}class ii{constructor(t){this.maxTextHeight=0,this.maxTextWidth=0,this.minTextHeight=0,this.minTextWidth=0,this.uniformStyle=new Kr,this.uniformMixedStyle=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelText"}destroy(){var t=this;t.maxTextHeight=null,t.maxTextWidth=null,t.minTextHeight=null,t.minTextWidth=null,t.uniformStyle&&(t.uniformStyle.destroy(),t.uniformStyle=null),t.uniformMixedStyle&&(t.uniformMixedStyle.destroy(),t.uniformMixedStyle=null)}static fromObj(t){if(t){var e=new ii;return rt.copy(e,t),e.uniformStyle=Kr.fromObj(t.uniformStyle),e.uniformMixedStyle=ri.fromObj(t.uniformMixedStyle),e}}}class si{constructor(t){this.isAlongLine=!0,this.alongLineDirection=g.LB_TO_RT,this.angleFixed=!1,this.repeatedLabelAvoided=!1,this.repeatIntervalFixed=!1,this.labelRepeatInterval=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelAlongLine"}destroy(){var t=this;t.isAlongLine=null,t.alongLineDirection=null,t.angleFixed=null,t.repeatedLabelAvoided=null,t.repeatIntervalFixed=null,t.labelRepeatInterval=null}static fromObj(t){if(t){var e=new si;return rt.copy(e,t),e}}}class ni{constructor(t){this.labelBackShape=v.NONE,this.backStyle=new Ct,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelBackground"}destroy(){this.labelBackShape=null,this.backStyle&&(this.backStyle.destroy(),this.backStyle=null)}static fromObj(t){if(t){var e=new ni;return e.labelBackShape=t.labelBackShape,e.backStyle=Ct.fromJson(t.backStyle),e}}}class ai extends Zr{constructor(t){super("LABEL",t),this.alongLine=new si,this.background=new ni,this.items=null,this.uniqueItems=null,this.labelExpression=null,this.labelOverLengthMode=b.NONE,this.matrixCells=null,this.maxLabelLength=256,this.numericPrecision=0,this.offset=new ei,this.overlapAvoided=!0,this.rangeExpression=null,this.uniqueExpression=null,this.smallGeometryLabeled=!1,this.text=new ii,this.textSpace=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabel"}destroy(){super.destroy();var t=this;if(t.alongLine=null,t.background&&(t.background.destroy(),t.background=null),t.items){for(var e=0,r=t.items,i=r.length;e<i;e++)r[e].destroy();t.items=null}if(t.uniqueItems){for(var s=0,n=t.uniqueItems,a=n.length;s<a;s++)n[s].destory();t.uniqueItems=null}t.labelExpression=null,t.labelOverLengthMode=null,t.matrixCells=null,t.maxLabelLength=null,t.numericPrecision=null,t.overlapAvoided=null,t.rangeExpression=null,t.uniqueExpression=null,t.offset&&(t.offset.destroy(),t.offset=null),t.overlapAvoided=null,t.smallGeometryLabeled=null,t.text&&(t.text.destroy(),t.text=null),t.textSpace=null}toJSON(){return rt.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,t.memoryData=this.memoryData,this.alongLine&&(t.alongLine=this.alongLine.isAlongLine,t.alongLineDirection=this.alongLine.alongLineDirection,t.angleFixed=this.alongLine.angleFixed,t.isLabelRepeated=this.alongLine.isLabelRepeated,t.labelRepeatInterval=this.alongLine.labelRepeatInterval,t.repeatedLabelAvoided=this.alongLine.repeatedLabelAvoided,t.repeatIntervalFixed=this.alongLine.repeatIntervalFixed),this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),this.text&&(t.maxTextHeight=this.text.maxTextHeight,t.maxTextWidth=this.text.maxTextWidth,t.minTextHeight=this.text.minTextHeight,t.minTextWidth=this.text.minTextWidth,t.uniformStyle=this.text.uniformStyle,t.uniformMixedStyle=this.text.uniformMixedStyle),this.background&&(t.labelBackShape=this.background.labelBackShape,t.backStyle=this.background.backStyle),t.labelOverLengthMode=this.labelOverLengthMode,t.maxLabelLength=this.maxLabelLength,t.smallGeometryLabeled=this.smallGeometryLabeled,t.rangeExpression=this.rangeExpression,t.uniqueExpression=this.uniqueExpression,t.numericPrecision=this.numericPrecision,t.items=this.items,t.uniqueItems=this.uniqueItems,t.labelExpression=this.labelExpression,t.overlapAvoided=this.overlapAvoided,t.matrixCells=this.matrixCells,t.textSpace=this.textSpace,t}static fromObj(t){if(t){var e=new ai,r=t.items,i=t.uniqueItems,s=t.matrixCells;if(t.matrixCells=null,rt.copy(e,t),e.alongLine=si.fromObj(t),e.background=ni.fromObj(t),r){e.items=[];for(var n=0,a=r.length;n<a;n++)e.items.push($r.fromObj(r[n]))}if(i){e.uniqueItems=[];for(let t=0,r=i.length;t<r;t++)e.uniqueItems.push(ti.fromObj(i[t]))}if(s){e.matrixCells=[];for(let t=0,e=s.length;t<e;t++);}return e.offset=ei.fromObj(t),e.text=ii.fromObj(t),e}}}class oi extends Zr{constructor(t){super("UNIQUE",t),this.defaultStyle=new Ct,this.items=null,this.uniqueExpression=null,this.colorGradientType=m.YELLOW_RED,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeUnique"}destroy(){super.destroy();var t=this;if(t.uniqueExpression=null,t.colorGradientType=null,t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.defaultStyle&&(t.defaultStyle.destroy(),t.defaultStyle=null)}toServerJSONObject(){var t={};if((t=rt.copyAttributes(t,this)).defaultStyle&&t.defaultStyle.toServerJSONObject&&(t.defaultStyle=t.defaultStyle.toServerJSONObject()),t.items){for(var e=[],r=t.items.length,i=0;i<r;i++)e.push(t.items[i].toServerJSONObject());t.items=e}return t}static fromObj(t){var e=new oi,r=t.items,i=r?r.length:0;rt.extend(e,t),e.items=[],e.defaultStyle=Ct.fromJson(t.defaultStyle);for(var s=0;s<i;s++)e.items.push(ti.fromObj(r[s]));return e}}class li{constructor(t){this.axesColor=new wt(0,0,0),this.axesDisplayed=!1,this.axesGridDisplayed=!1,this.axesTextDisplayed=!1,this.axesTextStyle=new Kr,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphAxes"}destroy(){var t=this;t.axesColor&&(t.axesColor.destroy(),t.axesColor=null),t.axesDisplayed=null,t.axesGridDisplayed=null,t.axesTextDisplayed=null,t.axesTextStyle&&(t.axesTextStyle.destroy(),t.axesTextStyle=null)}static fromObj(t){if(t){var e=new li;return rt.copy(e,t),e.axesColor=wt.fromJson(t.axesColor),e.axesTextStyle=Kr.fromObj(t.axesTextStyle),e}}}class hi{constructor(t){this.maxGraphSize=0,this.minGraphSize=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphSize"}destroy(){this.maxGraphSize=null,this.minGraphSize=null}static fromObj(t){var e=new hi;return rt.copy(e,t),e}}class ui{constructor(t){this.graphTextDisplayed=!1,this.graphTextFormat=u.CAPTION,this.graphTextStyle=new Kr,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphText"}destroy(){var t=this;t.graphTextDisplayed=null,t.graphTextFormat=null,t.graphTextStyle&&(t.graphTextStyle.destroy(),t.graphTextStyle=null)}static fromObj(t){var e=new ui;return rt.copy(e,t),e.graphTextStyle=Kr.fromObj(t.graphTextStyle),e}}class ci{constructor(t){this.caption=null,this.graphExpression=null,this.memoryDoubleValues=null,this.uniformStyle=new Ct,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraphItem"}destroy(){this.caption=null,this.graphExpression=null,this.memoryDoubleValues=null,this.uniformStyle=null}static fromObj(t){if(t){var e=new ci;return rt.copy(e,t),e.uniformStyle=Ct.fromJson(t.uniformStyle),e}}}class di extends Zr{constructor(t){super("GRAPH",t),this.barWidth=0,this.graduatedMode=p.CONSTANT,this.graphAxes=new li,this.graphSize=new hi,this.graphSizeFixed=!1,this.graphText=new ui,this.graphType=c.AREA,this.graphAxesTextDisplayMode=d.NONE,this.items=null,this.memoryKeys=null,this.negativeDisplayed=!1,this.offset=new ei,this.overlapAvoided=!0,this.roseAngle=0,this.startAngle=0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraph"}destroy(){super.destroy();var t=this;if(t.barWidth=null,t.graduatedMode=null,t.graphAxes&&(t.graphAxes.destroy(),t.graphAxes=null),t.graphSize&&(t.graphSize.destroy(),t.graphSize=null),t.graphSizeFixed=null,t.graphText&&(t.graphText.destroy(),t.graphText=null),t.graphType=null,t.items){for(var e=0,r=t.items,i=r.length;e<i;e++)r[e].destroy();t.items=null}t.memoryKeys=null,t.negativeDisplayed=null,t.offset&&(t.offset.destroy(),t.offset=null),t.overlapAvoided=null,t.roseAngle=null,t.startAngle=null,t.graphAxesTextDisplayMode=null}toJSON(){return rt.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,this.graphText&&(t.graphTextDisplayed=this.graphText.graphTextDisplayed,t.graphTextFormat=this.graphText.graphTextFormat,t.graphTextStyle=this.graphText.graphTextStyle),this.graphAxes&&(t.axesColor=this.graphAxes.axesColor,t.axesDisplayed=this.graphAxes.axesDisplayed,t.axesGridDisplayed=this.graphAxes.axesGridDisplayed,t.axesTextDisplayed=this.graphAxes.axesTextDisplayed,t.axesTextStyle=this.graphAxes.axesTextStyle),this.graphSize&&(t.maxGraphSize=this.graphSize.maxGraphSize,t.minGraphSize=this.graphSize.minGraphSize),this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),t.barWidth=this.barWidth,t.graduatedMode=this.graduatedMode,t.graphSizeFixed=this.graphSizeFixed,t.graphType=this.graphType,t.graphAxesTextDisplayMode=this.graphAxesTextDisplayMode,t.items=this.items,t.memoryKeys=this.memoryKeys,t.negativeDisplayed=this.negativeDisplayed,t.overlapAvoided=this.overlapAvoided,t.roseAngle=this.roseAngle,t.startAngle=this.startAngle,t}static fromObj(t){var e=new di,r=t.items,i=r?r.length:0;rt.copy(e,t),e.items=[],e.graphAxes=li.fromObj(t),e.graphSize=hi.fromObj(t),e.graphText=ui.fromObj(t),e.offset=ei.fromObj(t);for(var s=0;s<i;s++)e.items.push(ci.fromObj(r[s]));return e}}class pi extends Zr{constructor(t){super("DOTDENSITY",t),this.dotExpression=null,this.style=new Ct,this.value=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeDotDensity"}destroy(){var t=this;t.dotExpression=null,t.value=null,t.style&&(t.style.destroy(),t.style=null)}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){if(t){var e=new pi;return rt.copy(e,t),e.style=Ct.fromJson(t.style),e}}}class fi{constructor(t){this.negativeDisplayed=!1,this.negativeStyle=new Ct,this.positiveStyle=new Ct,this.zeroDisplayed=!1,this.zeroStyle=new Ct,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraduatedSymbolStyle"}destroy(){var t=this;t.negativeDisplayed=null,t.negativeStyle=null,t.positiveStyle=null,t.zeroDisplayed=null,t.zeroStyle=null}static fromObj(t){if(t){var e=new fi;return rt.copy(e,t),e.negativeStyle=Ct.fromJson(t.negativeStyle),e.positiveStyle=Ct.fromJson(t.positiveStyle),e.zeroStyle=Ct.fromJson(t.zeroStyle),e}}}class mi extends Zr{constructor(t){super("GRADUATEDSYMBOL",t),this.baseValue=0,this.expression=null,this.graduatedMode=p.CONSTAN,this.offset=new ei,this.style=new fi,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGraduatedSymbol"}destroy(){super.destroy();var t=this;t.expression=null,t.graduatedMode=p.CONSTANT,t.offset&&(t.offset.destroy(),t.offset=null),t.style&&(t.style.destroy(),t.style=null)}toJSON(){return rt.toJSON(this.toServerJSONObject())}toServerJSONObject(){var t={};return t.type=this.type,t.memoryData=this.memoryData,t.baseValue=this.baseValue,t.expression=this.expression,t.graduatedMode=this.graduatedMode,this.offset&&(t.offsetFixed=this.offset.offsetFixed,t.offsetX=this.offset.offsetX,t.offsetY=this.offset.offsetY),this.style&&(t.negativeStyle=this.style.negativeStyle,t.negativeDisplayed=this.style.negativeDisplayed,t.positiveStyle=this.style.positiveStyle,t.zeroDisplayed=this.style.zeroDisplayed,t.zeroStyle=this.style.zeroStyle),t}static fromObj(t){if(t){var e=new mi;return rt.copy(e,t),e.offset=ei.fromObj(t),e.style=fi.fromObj(t),e}}}class yi{constructor(t){this.caption=null,this.end=0,this.start=0,this.style=new Ct,this.visible=!0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeRangeItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}static fromObj(t){if(t){var e=new yi;return rt.copy(e,t),e.style=Ct.fromJson(t.style),e}}}class gi extends Zr{constructor(t){super("RANGE",t),this.precision="1.0E-12",this.items=null,this.rangeExpression=null,this.rangeMode=f.EQUALINTERVAL,this.rangeParameter=0,this.colorGradientType=m.YELLOW_RED,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeRange"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.rangeExpression=null,t.rangeMode=null,t.rangeParameter=null,t.colorGradientType=null}static fromObj(t){if(t){var e=new gi;rt.copy(e,t);var r=t.items,i=r?r.length:0;e.items=[];for(var s=0;s<i;s++)e.items.push(yi.fromObj(r[s]));return e}}}class vi{constructor(t){t=t||{},this.bounds=null,this.caption=null,this.description=null,this.name=null,this.queryable=null,this.subLayers=null,this.type=null,this.visible=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.UGCLayer"}destroy(){rt.reset(this)}fromJson(t){t=t||{},rt.extend(this,t);var e=this.bounds;e&&(this.bounds=new at(e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y))}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).bounds&&t.bounds.toServerJSONObject&&(t.bounds=t.bounds.toServerJSONObject()),t}}class bi extends vi{constructor(t){super(t=t||{}),this.completeLineSymbolDisplayed=null,this.maxScale=null,this.minScale=null,this.minVisibleGeometrySize=null,this.opaqueRate=null,this.symbolScalable=null,this.symbolScale=null,this.overlapDisplayed=null,this.overlapDisplayedOptions=null,this.CLASS_NAME="SuperMap.UGCMapLayer"}destroy(){super.destroy(),rt.reset(this)}fromJson(t){super.fromJson(t)}toServerJSONObject(){return super.toServerJSONObject()}}class Si{constructor(t){this.foreignTableName=null,this.joinFilter=null,this.joinType=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.JoinItem"}destroy(){this.foreignTableName=null,this.joinFilter=null,this.joinType=null}toServerJSONObject(){var t={};return t=rt.copyAttributes(t,this)}}class _i extends bi{constructor(t){super(t=t||{}),this.datasetInfo=null,this.displayFilter=null,this.joinItems=null,this.representationField=null,this.ugcLayerType=null,this.CLASS_NAME="SuperMap.UGCSubLayer"}fromJson(t){if(super.fromJson(t),this.datasetInfo&&(this.datasetInfo=new Ue(this.datasetInfo)),this.joinItems&&this.joinItems.length){for(var e=[],r=0;r<this.joinItems.length;r++)e[r]=new Si(this.joinItems[r]);this.joinItems=e}}destroy(){super.destroy(),rt.reset(this)}toServerJSONObject(){var t=super.toServerJSONObject();if(t.joinItems){for(var e=[],r=0;r<t.joinItems.length;r++)t.joinItems[r].toServerJSONObject&&(e[r]=t.joinItems[r].toServerJSONObject());t.joinItems=e}return t.datasetInfo&&t.datasetInfo.toServerJSONObject&&(t.datasetInfo=t.datasetInfo.toServerJSONObject()),t}}class xi extends _i{constructor(t){super(t=t||{}),this.theme=null,this.themeElementPosition=null,this.CLASS_NAME="SuperMap.ServerTheme"}destroy(){super.destroy(),rt.reset(this)}fromJson(t){super.fromJson(t);var e=this.theme;switch(e&&e.type){case"LABEL":this.theme=ai.fromObj(e);break;case"UNIQUE":this.theme=oi.fromObj(e);break;case"GRAPH":this.theme=di.fromObj(e);break;case"DOTDENSITY":this.theme=pi.fromObj(e);break;case"GRADUATEDSYMBOL":this.theme=mi.fromObj(e);break;case"RANGE":this.theme=gi.fromObj(e)}this.themeElementPosition&&(this.themeElementPosition=new nt(this.themeElementPosition.x,this.themeElementPosition.y))}toServerJSONObject(){var t=super.toServerJSONObject();return t.themeElementPosition&&t.themeElementPosition.toServerJSONObject&&(t.themeElementPosition=t.themeElementPosition.toServerJSONObject()),t.theme&&t.theme.toServerJSONObject&&(t.theme=t.theme.toServerJSONObject()),t}}class wi extends _i{constructor(t){super(t=t||{}),this.colorDictionarys=null,this.brightness=null,this.colorGradientType=null,this.colors=null,this.contrast=null,this.dashStyle=null,this.gridType=null,this.horizontalSpacing=null,this.sizeFixed=null,this.solidStyle=null,this.specialColor=null,this.specialValue=null,this.specialValueTransparent=null,this.verticalSpacing=null,this.CLASS_NAME="SuperMap.Grid"}destroy(){super.destroy(),rt.reset(this)}fromJson(t){if(super.fromJson(t),this.specialColor&&(this.specialColor=new wt(this.specialColor.red,this.specialColor.green,this.specialColor.blue)),this.colors){var e,r=[];for(var i in this.colors)e=this.colors[i],r.push(new wt(e.red,e.green,e.blue));this.colors=r}if(this.dashStyle&&(this.dashStyle=new Ct(this.dashStyle)),this.solidStyle&&(this.solidStyle=new Ct(this.solidStyle)),this.colorDictionary){var s,n=[];for(var a in this.colorDictionary)s=this.colorDictionary[a],n.push(new Fe({elevation:a,color:s}));this.colorDictionarys=n}delete this.colorDictionary}toServerJSONObject(){var t=super.toServerJSONObject();return t.dashStyle&&t.dashStyle.toServerJSONObject&&(t.dashStyle=t.dashStyle.toServerJSONObject()),t.solidStyle&&t.solidStyle.toServerJSONObject&&(t.solidStyle=t.solidStyle.toServerJSONObject()),t}}class Ci extends _i{constructor(t){super(t=t||{}),this.brightness=null,this.colorSpaceType=null,this.contrast=null,this.displayBandIndexes=null,this.transparent=null,this.transparentColor=null,this.transparentColorTolerance=null,this.CLASS_NAME="SuperMap.Image"}destroy(){super.destroy(),rt.reset(this)}fromJson(t){super.fromJson(t),this.transparentColor&&(this.transparentColor=new wt(this.transparentColor.red,this.transparentColor.green,this.transparentColor.blue))}toServerJSONObject(){return super.toServerJSONObject()}}class Mi extends _i{constructor(t){super(t=t||{}),this.style=null,this.CLASS_NAME="SuperMap.Vector"}destroy(){super.destroy(),rt.reset(this)}fromJson(t){super.fromJson(t);var e=this.style;e&&(this.style=new Ct(e))}toServerJSONObject(){var t=super.toServerJSONObject();return t.style&&t.style.toServerJSONObject&&(t.style=t.style.toServerJSONObject()),t}}class Ai extends ie{constructor(t,e){super(t,e),this.isTempLayers=!1,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.GetLayersInfoService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t){var e=this;return e.isTempLayers||(e.url=rt.urlPathAppend(e.url,"layers")),e.request({method:"GET",params:null,scope:e,success:t,failure:t})}transformResult(t,e){var r,i;return i=(r=!!(t=rt.transformResult(t))&&t.length>0?t[0].subLayers.layers:null)?r.length:0,this.handleLayers(i,r),{result:t[0],options:e}}handleLayers(t,e){var r;if(t)for(var i=0;i<t;i++){if(e[i].subLayers&&e[i].subLayers.layers&&e[i].subLayers.layers.length>0)this.handleLayers(e[i].subLayers.layers.length,e[i].subLayers.layers);else switch(e[i].ugcLayerType){case"THEME":(r=new xi).fromJson(e[i]),e[i]=r;break;case"GRID":(r=new wi).fromJson(e[i]),e[i]=r;break;case"IMAGE":(r=new Ci).fromJson(e[i]),e[i]=r;break;case"VECTOR":(r=new Mi).fromJson(e[i]),e[i]=r}}}}class Ti{constructor(t){t&&(this.bounds=null,this.searchRadius=0,this.zValueFieldName=null,this.zValueScale=1,this.resolution=null,this.filterQueryParameter=null,this.outputDatasetName=null,this.outputDatasourceName=null,this.pixelFormat=null,this.dataset=null,this.inputPoints=null,this.InterpolationAnalystType="dataset",this.clipParam=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationAnalystParameters")}destroy(){var t=this;t.bounds=null,t.searchRadius=null,t.zValueFieldName=null,t.zValueScale=null,t.resolution=null,t.filterQueryParameter=null,t.outputDatasetName=null,t.pixelFormat=null}static toObject(t,e){for(var r in t)if("inputPoints"===r&&"geometry"===t.InterpolationAnalystType){for(var i=[],s=0;s<t.inputPoints.length;s++){var n=t.inputPoints[s],a={x:n.x,y:n.y,z:n.tag};i.push(a)}e[r]=i}else e[r]=t[r]}}class Ei extends Ti{constructor(t){super(t),this.smooth=.1,this.tension=40,this.searchMode=null,this.expectedCount=12,this.maxPointCountForInterpolation=200,this.maxPointCountInNode=50,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationRBFAnalystParameters"}destroy(){super.destroy();var t=this;t.smooth=null,t.tension=null,t.searchMode=null,t.expectedCount=null,t.maxPointCountForInterpolation=null,t.maxPointCountInNode=null}static toObject(t,e){for(var r in t)e[r]=t[r]}}class Oi extends Ti{constructor(t){super(t),t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationDensityAnalystParameters"}destroy(){super.destroy()}}class Li extends Ti{constructor(t){super(t),this.power=2,this.searchMode=null,this.expectedCount=12,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationIDWAnalystParameters"}destroy(){super.destroy();this.power=null,this.searchMode=null,this.expectedCount=null}}class Pi extends Ti{constructor(t){super(t),this.type=null,this.mean=null,this.angle=0,this.nugget=0,this.range=0,this.sill=0,this.variogramMode=O.SPHERICAL,this.exponent=P.EXP1,this.searchMode=null,this.expectedCount=12,this.maxPointCountForInterpolation=200,this.maxPointCountInNode=50,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.InterpolationKrigingAnalystParameters"}destroy(){super.destroy();var t=this;t.type=null,t.mean=null,t.angle=null,t.nugget=null,t.range=null,t.sill=null,t.variogramMode=null,t.exponent=null,t.searchMode=null,t.expectedCount=null,t.maxPointCountForInterpolation=null,t.maxPointCountInNode=null}}class Ni extends ue{constructor(t,e){super(t,e),this.mode=null,e&&rt.extend(this,e)}destroy(){super.destroy(),this.mode=null,this.CLASS_NAME="SuperMap.InterpolationAnalystService"}processAsync(t,e){var r={},i=this;t instanceof Oi?(i.mode="Density","geometry"===t.InterpolationAnalystType?i.url=rt.urlPathAppend(i.url,"geometry/interpolation/density"):i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/interpolation/density")):t instanceof Li?(i.mode="IDW","geometry"===t.InterpolationAnalystType?i.url=rt.urlPathAppend(i.url,"geometry/interpolation/idw"):i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/interpolation/idw")):t instanceof Ei?(i.mode="RBF","geometry"===t.InterpolationAnalystType?i.url=rt.urlPathAppend(i.url,"geometry/interpolation/rbf"):i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/interpolation/rbf")):t instanceof Pi&&(i.mode="Kriging","geometry"===t.InterpolationAnalystType?i.url=rt.urlPathAppend(i.url,"geometry/interpolation/kriging"):i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/interpolation/kriging")),Ti.toObject(t,r);var s=rt.toJSON(r);return i.url=rt.urlAppend(i.url,"returnContent=true"),i.request({method:"POST",data:s,scope:i,success:e,failure:e})}}class Ii{constructor(t){t&&(this.datasetName="",this.query="",this.resolution=80,this.method=0,this.meshType=0,this.fields="",this.radius=300,this.meshSizeUnit=k.METER,this.radiusUnit=k.METER,this.areaUnit=F.SQUAREMILE,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.KernelDensityJobParameter")}destroy(){this.datasetName=null,this.query=null,this.resolution=null,this.method=null,this.radius=null,this.meshType=null,this.fields=null,this.meshSizeUnit=null,this.radiusUnit=null,this.areaUnit=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Fi extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/density"),this.CLASS_NAME="SuperMap.KernelDensityJobsService"}destroy(){super.destroy()}getKernelDensityJobs(t){return super.getJobs(this.url,t)}getKernelDensityJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addKernelDensityJob(t,e,r,i){return super.addJob(this.url,t,Ii,e,r,i)}}class ki{constructor(){this.CLASS_NAME="LabelMatrixCell"}}class Di extends ie{constructor(t,e){super(t,e),this.projection=null,this.CLASS_NAME="SuperMap.MapService",e&&rt.extend(this,e);var r=this;if(r.projection){var i=r.projection.split(":");i instanceof Array&&(2===i.length&&(r.url=rt.urlAppend(r.url,`prjCoordSys=${encodeURIComponent(`{"epsgCode":"${i[1]}"}`)}`)),1===i.length&&(r.url=rt.urlAppend(r.url,`prjCoordSys=${encodeURIComponent(`{"epsgCode":"${i[0]}"}`)}`)))}}destroy(){super.destroy()}processAsync(t){return this.request({method:"GET",scope:this,success:t,failure:t})}transformResult(t,e){var r=(t=rt.transformResult(t)).code>=200&&t.code<300||0==t.code||304===t.code,i=t.code&&r;return!t.code||i?{result:t,options:e}:{error:t,options:e}}}class Ri{constructor(t){t&&(this.dataset=null,this.extractRegion=null,this.expression=null,this.isZip=!1,this.ignoreNoValue=!1,this.targetDatasource=null,this.resultGridName=null,this.deleteExistResultDataset=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.MathExpressionAnalysisParameters")}destroy(){var t=this;t.dataset=null,t.bounds=null,t.expression=null,t.isZip=!0,t.ignoreNoValue=!0,t.targetDatasource=null,t.resultGridName=null,t.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)if("dataset"!==r&&(e[r]=t[r]),"extractRegion"===r&&t[r]){for(var i=t[r].components[0].components,s={},n=[],a=i.length,o=0;o<a-1;o++){var l={};l.x=i[o].x,l.y=i[o].y,n.push(l)}s.points=n,s.type="REGION",e[r]=s}}}class Bi extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.MathExpressionAnalysisService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof Ri&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/mathanalyst")),Ri.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class Gi{constructor(t,e){t&&(this.geometry=t,this.unit=l.METER,this.prjCoordSys=null,this.distanceMode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.MeasureParameters")}destroy(){this.geometry=null,this.unit=null,this.prjCoordSys=null}}class Ui extends ie{constructor(t,e){super(t,e),this.measureMode=o.DISTANCE,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.MeasureService"}destroy(){super.destroy();this.measureMode=null}processAsync(t,e){if(t instanceof Gi){var r,i,s=this,n=t.geometry;if(n){s.url=rt.urlPathAppend(s.url,s.measureMode===o.AREA?"area":"distance");var a,l,h,u=Tt.fromGeometry(n);if(u)return r=u.parts[0],i=u.points.splice(0,r),t.prjCoordSys?("object"==typeof t.prjCoordSys?a='{"epsgCode"'+(l=t.prjCoordSys.projCode).substring(l.indexOf(":"),l.length)+"}":"string"==typeof t.prjCoordSys&&(a='{"epsgCode"'+t.prjCoordSys.substring(t.prjCoordSys.indexOf(":"),t.prjCoordSys.length)+"}"),h={point2Ds:rt.toJSON(i),unit:t.unit,prjCoordSys:a,distanceMode:t.distanceMode||"Geodesic"}):h={point2Ds:rt.toJSON(i),unit:t.unit,distanceMode:t.distanceMode||"Geodesic"},s.request({method:"GET",params:h,scope:s,success:e,failure:e})}}}}class ji extends ue{constructor(t,e){super(t,e),this.mode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.OverlayAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},i=this;t instanceof ze?(i.mode="datasets",i.url=rt.urlPathAppend(i.url,"datasets/"+t.sourceDataset+"/overlay"),ze.toObject(t,r)):t instanceof Or&&(i.mode="geometry",t.operateGeometries&&t.sourceGeometries?(i.url=rt.urlPathAppend(i.url,"geometry/overlay/batch"),i.url=rt.urlAppend(i.url,"ignoreAnalystParam=true")):i.url=rt.urlPathAppend(i.url,"geometry/overlay"),Or.toObject(t,r)),this.returnContent=!0;var s=rt.toJSON(r);return i.request({method:"POST",data:s,scope:i,success:e,failure:e})}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}}class zi{constructor(t){t&&(this.datasetName="",this.datasetOverlay="",this.mode="",this.srcFields="",this.overlayFields="",this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.OverlayGeoJobParameter")}destroy(){this.datasetName=null,this.datasetOverlay=null,this.mode=null,this.srcFields=null,this.overlayFields=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!=r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Vi extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/overlay"),this.CLASS_NAME="SuperMap.OverlayGeoJobsService"}destroy(){super.destroy()}getOverlayGeoJobs(t){return super.getJobs(this.url,t)}getOverlayGeoJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addOverlayGeoJob(t,e,r,i){return super.addJob(this.url,t,zi,e,r,i)}}class Ji extends Ne{constructor(t){super(t=t||{}),this.returnContent=!0,this.bounds=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.QueryByBoundsParameters"}destroy(){super.destroy();this.returnContent=null,this.bounds&&(this.bounds=null)}}class qi extends ie{constructor(t,r){super(t,r),this.returnContent=!1,this.format=e.GEOJSON,this.returnFeatureWithFieldCaption=!1,r&&rt.extend(this,r),this.CLASS_NAME="SuperMap.QueryService",this.url&&(r&&r.format&&(this.format=r.format.toUpperCase()),this.url=rt.urlPathAppend(this.url,"queryResults"))}destroy(){super.destroy();this.returnContent=null,this.format=null}processAsync(t,e){if(t instanceof Ne){var r,i=this,s=null;return i.returnContent=t.returnContent,r=i.getJsonParameters(t),i.returnContent||(s=t.returnCustomResult)&&(i.url=rt.urlAppend(i.url,"returnCustomResult="+s)),i.returnFeatureWithFieldCaption=t.returnFeatureWithFieldCaption,i.request({method:"POST",data:r,scope:i,success:e,failure:e})}}transformResult(t,r){t=rt.transformResult(t);var i=new Nt;if(t&&t.recordsets)for(var s=0,n=t.recordsets,a=n.length;s<a;s++)n[s].features&&(!0===this.returnFeatureWithFieldCaption&&n[s].features.map(t=>(t.fieldNames=n[s].fieldCaptions,t)),this.format===e.GEOJSON&&(n[s].features=i.toGeoJSON(n[s].features)));return{result:t,options:r}}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}getQueryParameters(t){return new Ne({customParams:t.customParams,expectCount:t.expectCount,networkType:t.networkType,queryOption:t.queryOption,queryParams:t.queryParams,startRecord:t.startRecord,prjCoordSys:t.prjCoordSys,holdTime:t.holdTime})}}class Hi extends qi{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByBoundsService"}destroy(){super.destroy()}getJsonParameters(t){if(!(t instanceof Ji))return null;var e,r="",i=t.bounds;return e=this.getQueryParameters(t),r+="'queryMode':'BoundsQuery','queryParameters':",r+=rt.toJSON(e),r="{"+(r+=",'bounds': {'rightTop':{'y':"+i.top+",'x':"+i.right+"},'leftBottom':{'y':"+i.bottom+",'x':"+i.left+"}}")+"}"}}class Wi extends Ne{constructor(t){super(t=t||{}),this.geometry=null,this.isNearest=null,this.returnContent=!0,rt.extend(this,t),this.CLASS_NAME="SuperMap.QueryByDistanceParameters"}destroy(){super.destroy();var t=this;t.returnContent=null,t.distance=null,t.isNearest=null,t.geometry&&(t.geometry.destroy(),t.geometry=null)}}class Yi extends qi{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByDistanceService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Wi){var e="",r=this.getQueryParameters(t),i=Tt.fromGeometry(t.geometry);return e+=t.isNearest?"'queryMode':'FindNearest','queryParameters':":"'queryMode':'DistanceQuery','queryParameters':",e+=rt.toJSON(r),e="{"+(e+=",'geometry':"+rt.toJSON(i)+",'distance':"+t.distance)+"}"}}}class Xi extends Ne{constructor(t){super(t=t||{}),this.returnContent=!0,this.geometry=null,this.spatialQueryMode=a.INTERSECT,rt.extend(this,t),this.CLASS_NAME="SuperMap.QueryByGeometryParameters"}destroy(){super.destroy();this.returnContent=null,this.geometry=null,this.spatialQueryMode=null}}class Qi extends qi{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryByGeometryService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Xi){var e,r="",i=t.geometry,s=Tt.fromGeometry(i);return e=this.getQueryParameters(t),r+="'queryMode':'SpatialQuery','queryParameters':",r="{"+(r+=rt.toJSON(e)+",'geometry':"+rt.toJSON(s)+",'spatialQueryMode':"+rt.toJSON(t.spatialQueryMode))+"}"}}}class Zi extends Ne{constructor(t){super(t=t||{}),this.returnContent=!0,rt.extend(this,t),this.CLASS_NAME="SuperMap.QueryBySQLParameters"}destroy(){super.destroy();this.returnContent=null}}class Ki extends qi{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.QueryBySQLService"}destroy(){super.destroy()}getJsonParameters(t){if(t instanceof Zi){var e,r="";return e=this.getQueryParameters(t),r+="'queryMode':'SqlQuery','queryParameters':",r="{"+(r+=rt.toJSON(e))+"}"}}}class $i{constructor(t){this.referenceDatasetName=null,this.referenceFilterQueryParameter=null,this.createResultDataset=null,this.resultDatasetName=null,this.resultDatasourceName=null,this.minDistance=null,this.maxDistance=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.MinDistanceAnalystParameters"}destroy(){var t=this;t.referenceDatasetName=null,t.dataset=null,t.referenceFilterQueryParameter=null,t.createResultDataset=null,t.resultDatasetName=null,t.resultDatasourceName=null,t.minDistance=null,t.maxDistance=null}}class ts extends $i{constructor(t){super(t),this.dataset=null,this.inputFilterQueryParameter=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.DatasetMinDistanceAnalystParameters"}destroy(){super.destroy();this.dataset=null,this.inputFilterQueryParameter=null}}class es extends $i{constructor(t){super(t),this.inputGeometries=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.GeometryMinDistanceAnalystParameters"}destroy(){super.destroy();this.inputGeometries=null}static toObject(t,e){for(var r in t)if("inputGeometries"===r&&t.inputGeometries){for(var i=[],s=0;s<t.inputGeometries.length;s++)i.push(Tt.fromGeometry(t.inputGeometries[s]));e.inputGeometries=i}else e[r]=t[r]}}class rs extends ue{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.MinDistanceAnalystService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof ts?(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/mindistance"),i=t):t instanceof es&&(r.url=rt.urlPathAppend(r.url,"geometry/mindistance"),es.toObject(t,i));var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class is{constructor(t){t&&(this.dataset=null,this.cutFillType="GRID",this.afterCutFillDataset=null,this.resultDataset=null,this.buildPyramid=null,this.deleteExistResultDataset=null,this.bufferRadius=null,this.isRoundHead=null,this.line3D=null,this.region=null,this.region3D=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TerrainCutFillCalculationParameters")}destroy(){var t=this;t.cutFillType=null,t.afterCutFillDataset=null,t.resultDataset=null,t.buildPyramid=null,t.deleteExistResultDataset=null,t.bufferRadius=null,t.isRoundHead=null,t.line3D=null,t.region=null,t.region3D=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class ss extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainCutFillCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof is&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/cutfill")),is.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class ns{constructor(t){t&&(this.dataset=null,this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TerrainAspectCalculationParameters")}destroy(){this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class as extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainAspectCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof ns&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/aspect")),ns.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class os{constructor(t){t&&(this.dataset=null,this.terrainAnalystSetting=null,this.resultDatasetName=null,this.deleteExistResultDataset=null,this.zFactor=null,this.slopeType=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TerrainSlopeCalculationParameters")}destroy(){var t=this;t.terrainAnalystSetting=null,t.resultDatasetName=null,t.deleteExistResultDataset=null,t.zFactor=null,t.slopeType=null}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class ls extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainSlopeCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof os&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/slope")),os.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class hs extends ue{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.ConvexHullAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r=this;r.url=rt.urlPathAppend(r.url,"geometry/3d/convexhull");var i=rt.toJSON(t);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:i,scope:r,success:e,failure:e})}}class us{constructor(t){this.edgeID=null,this.nodeID=null,this.weightName=null,this.returnFeatures=!0,this.isUncertainDirectionValid=!0,this.traceType=null,this.withIndex=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TraceAnalystParameters"}destroy(){var t=this;t.edgeID=null,t.nodeID=null,t.weightName=null,t.returnFeatures=null,t.isUncertainDirectionValid=null,t.type=null,t.withIndex=null}}class cs extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TraceAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof us){var r,i=this;if(0===t.traceType)i.url=rt.urlPathAppend(i.url,"traceup");else{if(1!==t.traceType)return;i.url=rt.urlPathAppend(i.url,"tracedown")}if(r={weightName:t.weightName,isUncertainDirectionValid:t.isUncertainDirectionValid,returnFeatures:t.returnFeatures},!(null!==t.edgeID&&null!==t.nodeID||null===t.edgeID&&null===t.nodeID))return null!==t.edgeID?r.edgeID=t.edgeID:r.nodeID=t.nodeID,i.request({method:"GET",params:r,scope:i,success:e,failure:e})}}toGeoJSONResult(t){if(!t)return null;var e=new Nt;return t.edgesFeatures&&(t.edgesFeatures=e.toGeoJSON(t.edgesFeatures)),t.nodesFeatures&&(t.nodesFeatures=e.toGeoJSON(t.nodesFeatures)),t}}class ds{constructor(t){this.connected=null,this.returnFeatures=!0,this.edgeIDs=null,this.nodeIDs=null,this.withIndex=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.ConnectedEdgesAnalystParameters"}destroy(){var t=this;t.edgeIDs=null,t.nodeIDs=null,t.connected=null,t.returnFeatures=null,t.withIndex=null}}class ps extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.ConnectedEdgesAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ds){var r;if(this.url=rt.urlPathAppend(this.url,"connectededges"),r={connected:t.connected,returnFeatures:t.returnFeatures},!(null!==t.edgeIDs&&null!==t.nodeIDs||null===t.edgeIDs&&null===t.nodeIDs))return null!==t.edgeIDs?r.edgeIDs=t.edgeIDs:r.nodeIDs=t.nodeIDs,this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}toGeoJSONResult(t){if(!t)return null;var e=new Nt;return t.edgesFeatures&&(t.edgesFeatures=e.toGeoJSON(t.edgesFeatures)),t.nodesFeatures&&(t.nodesFeatures=e.toGeoJSON(t.nodesFeatures)),t}}class fs extends ie{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.GetLayersLegendInfoService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t,e){return this.url=rt.urlPathAppend(this.url,"/legend"),this.request({method:"GET",params:t,scope:this,success:e,failure:e})}}class ms{constructor(t,e){this.options=e||{},this.url=t}queryByBounds(t,e,r){var i=this;return new Hi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}queryByDistance(t,e,r){var i=this;return new Yi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:r}).processAsync(t,e)}queryBySQL(t,e,r){var i=this;return new Ki(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:r}).processAsync(t,e)}queryByGeometry(t,e,r){var i=this;return new Qi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:r}).processAsync(t,e)}_processFormat(t){return t||e.GEOJSON}}class ys{constructor(t){if(!t)return this;this.sourceRoute=null,this.point=null,this.tolerance=null,this.isIgnoreGap=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.RouteCalculateMeasureParameters"}destroy(){var t=this;t.sourceRoute=null,t.point=null,t.tolerance&&(t.tolerance=null),t.isIgnoreGap&&(t.isIgnoreGap=!1)}}class gs extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.RouteCalculateMeasureService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ys){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){return this.url=rt.urlPathAppend(this.url,"geometry/calculatemeasure"),this.url=rt.urlAppend(this.url,"returnContent=true"),rt.toJSON(t)}}class vs{constructor(t){if(!t)return this;this.sourceRoute=null,this.dataset=null,this.routeIDField=null,this.routeID=null,this.type=null,this.measure=null,this.offset=0,this.isIgnoreGap=!1,this.startMeasure=null,this.endMeasure=null;var e=t.sourceRoute,r={};if(e&&e instanceof Z&&e.components){r.type=e.type,r.parts=e.parts;for(var i=[],s=0,n=e.components.length;s<n;s++)i=i.concat(e.components[s].components);r.points=i,t.sourceRoute=r}rt.extend(this,t),this.CLASS_NAME="SuperMap.RouteLocatorParameters"}destroy(){var t=this;t.sourceRoute=null,t.type=null,t.measure=null,t.offset=0,t.isIgnoreGap=!1,t.startMeasure=null,t.endMeasure=null,t.dataset=null,t.routeID=null,t.routeIDField=null}}class bs extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.RouteLocatorService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof vs){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="geometry/routelocator";return t.dataset&&(e="datasets/"+t.dataset+"/linearreferencing/routelocator",t.sourceRoute=null),this.url=rt.urlPathAppend(this.url,e),this.url=rt.urlAppend(this.url,"returnContent=true"),rt.toJSON(t)}}class Ss{constructor(t){this.fieldNames=null,this.fieldValues=null,this.geometry=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ServerFeature"}destroy(){var t=this;t.fieldNames=null,t.fieldValues=null,t.geometry&&(t.geometry.destroy(),t.geometry=null)}toFeature(){var t,e,r,i,s={},n=this;for(var a in t=n.fieldNames,e=n.fieldValues,t)s[t[a]]=e[a];return n.geometry&&(r=n.geometry.toGeometry()),i=new Ot(r,s),n.geometry&&n.geometry.id&&(i.fid=n.geometry.id),i}static fromJson(t){var e=null;if(t)return(e=t.geometry)&&(e=Tt.fromJson(e)),new Ss({fieldNames:t.fieldNames,fieldValues:t.fieldValues,geometry:e})}}class _s{constructor(t){t&&(this.datasourceName=null,this.description=null,this.coordUnit=null,this.distanceUnit=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.SetDatasourceParameters")}destroy(){this.datasourceName=null,this.description=null,this.coordUnit=null,this.distanceUnit=null}}class xs extends ie{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.SetLayerInfoService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t,e){if(t){var r=rt.toJSON(t);return this.request({method:"PUT",data:r,scope:this,success:e,failure:e})}}}class ws extends ie{constructor(t,e){super(t,e),this.resourceID=null,this.isTempLayers=!1,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.SetLayersInfoService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t,e){if(t){var r,i=[],s=this,n="";s.isTempLayers?(s.url=rt.urlPathAppend(s.url,"tempLayersSet/"+s.resourceID),n="PUT"):(s.url=rt.urlPathAppend(s.url,"tempLayersSet"),n="POST"),t.subLayers||(t.subLayers={layers:[]}),t.subLayers.layers||(t.subLayers.layers=[]);var a=t.subLayers.layers,o=a.length;for(let t in a){if("GRID"===a[t].ugcLayerType){var l={},h=a[t].colorDictionarys;for(var u in h){l[h[u].elevation]=h[u].color}}a[t].colorDictionary=l,delete a[t].colorDictionarys}for(let t=0;t<o;t++)a[t].toJsonObject?i.push(a[t].toJsonObject()):i.push(a[t]);(r=rt.extend(r,t)).subLayers={layers:i},r.object=null;var c=rt.toJSON([r]);return s.request({method:n,data:c,scope:s,success:e,failure:e})}}}class Cs{constructor(t){this.layerStatusList=[],this.holdTime=15,this.resourceID=null,t&&rt.extend(this,t)}destroy(){this.layerStatusList=null,this.holdTime=null,this.resourceID=null}toJSON(){var t="{";t+='"layers":[';for(var e=[],r=0,i=this.layerStatusList.length;r<i;r++)e.push(this.layerStatusList[r].toJSON());return t+=e,t+="]",t+="}"}}class Ms extends ie{constructor(t,e){super(t,e),this.lastparams=null,this.mapUrl=t,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.SetLayerStatusService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t,e){if(t instanceof Cs){var r=this;if(r.url=r.mapUrl,null==t.resourceID)return r.url=rt.urlPathAppend(r.url,"tempLayersSet"),r.lastparams=t,r.request({method:"POST",scope:r,success:r.createTempLayerComplete.bind(r,e),failure:e});r.url=rt.urlPathAppend(r.url,"tempLayersSet/"+t.resourceID),r.url=rt.urlAppend(r.url,"elementRemain=true&reference="+t.resourceID+"&holdTime="+t.holdTime.toString());var i="[{";return i+='"type":"UGC",',null!=t.layerStatusList&&t.layerStatusList.length>0&&(i+='"subLayers":'+t.toJSON()),i+=',"visible":true,',i+='"name":"'+this.getMapName(this.mapUrl)+'"',i+="}]",r.request({method:"PUT",data:i,scope:r,success:e,failure:e})}}createTempLayerComplete(t,e){return e.result=rt.transformResult(e.result),e.result.succeed&&(this.lastparams.resourceID=e.result.newResourceID),this.processAsync(this.lastparams,t)}getMapName(t){var e=t;"/"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1));var r=e.lastIndexOf("/");return e.substring(r+1,e.length)}transformResult(t,e){return null!=(t=rt.transformResult(t))&&null!=this.lastparams&&null!=this.lastparams.resourceID&&(t.newResourceID=this.lastparams.resourceID),{result:t,options:e}}}class As{constructor(t){t&&(this.datasetName="",this.datasetQuery="",this.geometryQuery="",this.mode=a.CONTAIN,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SingleObjectQueryJobsParameter")}destroy(){this.datasetName=null,this.datasetQuery=null,this.geometryQuery=null,this.mode=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Ts extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/query"),this.CLASS_NAME="SuperMap.SingleObjectQueryJobsService"}destroy(){super.destroy()}getQueryJobs(t){return super.getJobs(this.url,t)}getQueryJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addQueryJob(t,e,r,i){return super.addJob(this.url,t,As,e,r,i)}}class Es{constructor(t){t=t||{},this.keyWord=null,this.returnPosition=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.StopQueryParameters"}destroy(){rt.reset(this)}}class Os extends ie{constructor(t,e){super(t,e),e=e||{},rt.extend(this,e),this.CLASS_NAME="SuperMap.StopQueryService"}destroy(){super.destroy(),rt.reset(this)}processAsync(t,e){if(t instanceof Es){return this.url=rt.urlPathAppend(this.url,"stops/keyword/"+t.keyWord),this.request({method:"GET",params:{returnPosition:t.returnPosition},scope:this,success:e,failure:e})}}}class Ls{constructor(t){t&&(this.datasetName="",this.groupField="",this.attributeField="",this.statisticModes="",this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SummaryAttributesJobsParameter")}destroy(){this.datasetName=null,this.groupField=null,this.attributeField=null,this.statisticModes=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Ps extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/summaryattributes"),this.CLASS_NAME="SuperMap.SummaryAttributesJobsService"}destroy(){super.destroy()}getSummaryAttributesJobs(t){return super.getJobs(this.url,t)}getSummaryAttributesJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addSummaryAttributesJob(t,e,r,i){return super.addJob(this.url,t,Ls,e,r,i)}}class Ns{constructor(t){t&&(this.datasetName="",this.regionDataset="",this.query="",this.resolution=100,this.meshType=0,this.statisticModes=D.AVERAGE,this.fields="",this.type=R.SUMMARYMESH,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SummaryMeshJobParameter")}destroy(){this.datasetName=null,this.query=null,this.resolution=null,this.statisticModes=null,this.meshType=null,this.fields=null,this.regionDataset=null,this.type=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"type"!==r?"output"!==r?("SUMMARYMESH"===t.type&&"regionDataset"!==r||"SUMMARYREGION"===t.type&&!i(["meshType","resolution","query"],r))&&(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):e.type=t[r]:(e.input=e.input||{},e.input[r]=t[r]);function i(t,e){for(var r=t.length;r--;)if(t[r]===e)return!0;return!1}}}class Is extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/aggregatepoints"),this.CLASS_NAME="SuperMap.SummaryMeshJobsService"}destroy(){super.destroy()}getSummaryMeshJobs(t){return super.getJobs(this.url,t)}getSummaryMeshJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addSummaryMeshJob(t,e,r,i){return super.addJob(this.url,t,Ns,e,r,i)}}class Fs{constructor(t){t&&(this.datasetName="",this.regionDataset="",this.sumShape=!0,this.query="",this.standardSummaryFields=!1,this.standardFields="",this.standardStatisticModes="",this.weightedSummaryFields=!1,this.weightedFields="",this.weightedStatisticModes="",this.meshType=0,this.resolution=100,this.meshSizeUnit=k.METER,this.type=R.SUMMARYMESH,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SummaryRegionJobParameter")}destroy(){this.datasetName=null,this.sumShape=null,this.regionDataset=null,this.query=null,this.standardSummaryFields=null,this.standardFields=null,this.standardStatisticModes=null,this.weightedSummaryFields=null,this.weightedFields=null,this.weightedStatisticModes=null,this.meshType=null,this.resolution=null,this.meshSizeUnit=null,this.type=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"type"!==r&&"type"!==r?"output"!==r?("SUMMARYREGION"===t.type||"SUMMARYMESH"===t.type&&"regionDataset"!==r)&&(e.analyst=e.analyst||{},"query"===r&&t[r]?e.analyst[r]=t[r].toBBOX():e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):e.type=t[r]:(e.input=e.input||{},e.input[r]=t[r])}}class ks extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/summaryregion"),this.CLASS_NAME="SuperMap.SummaryRegionJobsService"}destroy(){super.destroy()}getSummaryRegionJobs(t){return super.getJobs(this.url,t)}getSummaryRegionJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addSummaryRegionJob(t,e,r,i){return super.addJob(this.url,t,Fs,e,r,i)}}class Ds{constructor(t){this.maxWeight=null,this.nodeID=null,this.resourceValue=null,this.type=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.SupplyCenter"}destroy(){this.maxWeight=null,this.nodeID=null,this.resourceValue=null,this.type=null}static fromJson(t){if(t)return new Ds({maxWeight:t.maxWeight,nodeID:t.nodeID,resourceValue:t.resourceValue,type:t.type})}}class Rs extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.SurfaceAnalystService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Je){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e="",r={};if(t instanceof qe)this.url=rt.urlPathAppend(this.url,"datasets/"+t.dataset+"/"+t.surfaceAnalystMethod.toLowerCase()),qe.toObject(t,r),e=rt.toJSON(r);else{if(!(t instanceof Lr))return;this.url=rt.urlPathAppend(this.url,"geometry/"+t.surfaceAnalystMethod.toLowerCase()),e=rt.toJSON(t)}return this.returnContent=!0,e}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}}class Bs{constructor(t){t&&(this.dataset=null,this.zFactor=1,this.averageCurvatureName=null,this.profileCurvatureName="",this.planCurvatureName="",this.deleteExistResultDataset=!1,rt.extend(this,t),this.CLASS_NAME="SuperMap.TerrainCurvatureCalculationParameters")}destroy(){var t=this;t.dataset=null,t.zFactor=1,t.averageCurvatureName=null,t.profileCurvatureName=null,t.planCurvatureName=null,t.deleteExistResultDataset=!0}static toObject(t,e){for(var r in t)"dataset"!==r&&(e[r]=t[r])}}class Gs extends ue{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TerrainCurvatureCalculationService"}destroy(){super.destroy()}processAsync(t,e){var r=this,i={};t instanceof Bs&&(r.url=rt.urlPathAppend(r.url,"datasets/"+t.dataset+"/terraincalculation/curvature")),Bs.toObject(t,i);var s=rt.toJSON(i);return r.url=rt.urlAppend(r.url,"returnContent=true"),r.request({method:"POST",data:s,scope:r,success:e,failure:e})}}class Us{constructor(t){this.flowEnabled=!1,this.leaderLineDisplayed=!1,this.leaderLineStyle=new Ct,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeFlow"}destroy(){var t=this;t.flowEnabled=null,t.leaderLineDisplayed=null,t.leaderLineStyle&&(t.leaderLineStyle.destroy(),t.leaderLineStyle=null)}static fromObj(t){if(t){var e=new Us;return rt.copy(e,t),e.leaderLineStyle=Ct.fromJson(t.leaderLineStyle),e}}}class js{constructor(t){this.caption=null,this.color=new wt,this.end=0,this.start=0,this.visible=!0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridRangeItem"}destroy(){var t=this;t.caption=null,t.end=null,t.start=null,t.color&&(t.color.destroy(),t.color=null),t.visible=null}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).color&&t.color.toServerJSONObject&&(t.color=t.color.toServerJSONObject()),t}static fromObj(t){if(t){var e=new js;return rt.copy(e,t),e.color=wt.fromJson(t.color),e}}}class zs extends Zr{constructor(t){super("GRIDRANGE",t),this.items=null,this.rangeMode=f.EQUALINTERVAL,this.rangeParameter=0,this.colorGradientType=m.YELLOW_RED,this.reverseColor=!1,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridRange"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.reverseColor=null,t.rangeMode=null,t.rangeParameter=null,t.colorGradientType=null}static fromObj(t){if(t){var e=new zs;rt.copy(e,t);var r=t.items,i=r?r.length:0;e.items=[];for(var s=0;s<i;s++)e.items.push(js.fromObj(r[s]));return e}}}class Vs{constructor(t){this.caption=null,this.color=new wt,this.unique=null,this.visible=!0,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridUniqueItem"}destroy(){var t=this;t.caption=null,t.unique=null,t.color&&(t.color.destroy(),t.color=null),t.visible=null}toServerJSONObject(){var t={};return(t=rt.copyAttributes(t,this)).color&&t.color.toServerJSONObject&&(t.color=t.color.toServerJSONObject()),t}static fromObj(t){var e=new Vs;return rt.copy(e,t),e.color=wt.fromJson(t.color),e}}class Js extends Zr{constructor(t){super("GRIDUNIQUE",t),this.defaultcolor=new wt,this.items=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeGridUnique"}destroy(){super.destroy();var t=this;if(t.items){if(t.items.length>0)for(var e in t.items)t.items[e].destroy(),t.items[e]=null;t.items=null}t.defaultcolor&&(t.defaultcolor.destroy(),t.defaultcolor=null)}toServerJSONObject(){var t={};if((t=rt.copyAttributes(t,this)).defaultcolor&&t.defaultcolor.toServerJSONObject&&(t.defaultcolor=t.defaultcolor.toServerJSONObject()),t.items){for(var e=[],r=t.items.length,i=0;i<r;i++)e.push(t.items[i].toServerJSONObject());t.items=e}return t}static fromObj(t){var e=new Js,r=t.items,i=r?r.length:0;rt.extend(e,t),e.items=[],e.defaultcolor=wt.fromJson(t.defaultcolor);for(var s=0;s<i;s++)e.items.push(Vs.fromObj(r[s]));return e}}class qs{constructor(t){this.caption=null,this.unique=null,this.offsetX=0,this.offsetY=0,this.visible=!0,this.style=new Kr,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeLabelUniqueItem"}destroy(){var t=this;t.unique=null,t.caption=null,t.offsetX=null,t.offsetY=null,t.style&&(t.style.destroy(),t.style=null),t.visible=null}static fromObj(t){if(t){var e=new qs;return rt.copy(e,t),e}}}class Hs{constructor(t){this.datasetNames=null,this.dataSourceNames=null,this.joinItems=null,this.themes=null,this.displayFilters=null,this.displayOrderBys=null,this.fieldValuesDisplayFilter=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ThemeParameters"}destroy(){var t=this;if(t.datasetNames=null,t.dataSourceNames=null,t.joinItems){for(let e=0,r=t.joinItems,i=r.length;e<i;e++)r[e].destroy();t.joinItems=null}if(t.themes){for(let e=0,r=t.themes,i=r.length;e<i;e++)r[e].destroy();t.themes=null}}}class Ws extends ie{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.url=rt.urlPathAppend(this.url,"tempLayersSet"),this.CLASS_NAME="SuperMap.ThemeService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof Hs){var r;return r=this.getJsonParameters(t),this.request({method:"POST",data:r,scope:this,success:e,failure:e})}}getJsonParameters(t){var e,r="",i=null,s=null,n=null;r+="[{'type': 'UGC','subLayers': {'layers': [";for(var a=0;a<t.themes.length;a++){i=t.themes[a];var o=rt.toJSON(i);if(r+="{'theme': "+(o=o.slice(0,-1))+"},'type': 'UGC','ugcLayerType': 'THEME',",(s=t.displayFilters)&&s.length>0&&(1===s.length?r+="'displayFilter':\""+s[0]+'",':r+="'displayFilter':\""+s[a]+'",'),(n=t.displayOrderBy)&&n.length>0&&(1===n.length?r+="'displayOrderBy':'"+n[0]+"',":r+="'displayOrderBy':'"+n[a]+"',"),(e=t.fieldValuesDisplayFilter)&&(r+="'fieldValuesDisplayFilter':"+rt.toJSON(e)+","),t.joinItems&&t.joinItems.length>0&&t.joinItems[a]&&(r+="'joinItems':["+rt.toJSON(t.joinItems[a])+"],"),t.datasetNames&&t.dataSourceNames){var l=t.datasetNames[a]?a:t.datasetNames.length-1,h=t.dataSourceNames[a]?a:t.dataSourceNames.length-1;r+="'datasetInfo': {'name': '"+t.datasetNames[l]+"','dataSourceName': '"+t.dataSourceNames[h]+"'}},"}else r+="},"}t.themes&&t.themes.length>0&&(r=r.substring(0,r.length-1)),r+="]},";var u=this.url.split("/");return r+="'name': '"+u[u.length-2]+"'}]"}}class Ys extends ue{constructor(t,e){super(t,e),this.mode=null,e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.ThiessenAnalystService"}destroy(){super.destroy(),this.mode=null}processAsync(t,e){var r={},i=this;t instanceof We?(i.mode="datasets",i.url=rt.urlPathAppend(i.url,"datasets/"+t.dataset+"/thiessenpolygon"),We.toObject(t,r)):t instanceof Pr&&(i.mode="geometry",i.url=rt.urlPathAppend(i.url,"geometry/thiessenpolygon"),Pr.toObject(t,r));var s=rt.toJSON(r);return this.returnContent=!0,i.request({method:"POST",data:s,scope:i,success:e,failure:e})}dataFormat(){return[e.GEOJSON,e.ISERVER,e.FGB]}}class Xs extends ue{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.GeometryBatchAnalystService"}processAsync(t,e){var r=this;r.url=rt.urlPathAppend(r.url,"geometry/batchanalyst"),r.url=rt.urlAppend(r.url,"returnContent=true&ignoreAnalystParam=true");var i=r._processParams(t),s=rt.toJSON(i);return r.request({method:"POST",data:s,scope:r,success:e,failure:e})}_processParams(t){var e=this;if(rt.isArray(t)){var r=[];return t.map(function(t){return r.push(e._toJSON(t)),t}),r}}_toJSON(t){var e={};if("buffer"===t.analystName)e.analystName="buffer",e.param={},ve.toObject(t.param,e.param);else if("overlay"===t.analystName)e.analystName="overlay",e.param={},Or.toObject(t.param,e.param);else if("interpolationDensity"===t.analystName)e.analystName="interpolationDensity",e.param={},Ti.toObject(t.param,e.param);else if("interpolationidw"===t.analystName)e.analystName="interpolationidw",e.param={},Ti.toObject(t.param,e.param);else if("interpolationRBF"===t.analystName)e.analystName="interpolationRBF",e.param={},Ti.toObject(t.param,e.param);else if("interpolationKriging"===t.analystName)e.analystName="interpolationKriging",e.param={},Ti.toObject(t.param,e.param);else{if("thiessenpolygon"!==t.analystName)return t;e.analystName="thiessenpolygon",e.param={},Pr.toObject(t.param,e.param)}return e}destroy(){super.destroy()}}class Qs extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TilesetsService"}destroy(){super.destroy()}processAsync(t){if(this.url){return this.url=rt.urlPathAppend(this.url,"tilesets"),this.request({method:"GET",scope:this,success:t,failure:t})}}}class Zs{constructor(t){t&&(this.datasetName="",this.datasetTopology="",this.tolerance="",this.rule=B.REGIONNOOVERLAP,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TopologyValidatorJobsParameter")}destroy(){this.datasetName=null,this.datasetTopology=null,this.tolerance=null,this.rule=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class Ks extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/topologyvalidator"),this.CLASS_NAME="SuperMap.TopologyValidatorJobsService"}destroy(){super.destroy()}getTopologyValidatorJobs(t){return super.getJobs(this.url,t)}getTopologyValidatorJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addTopologyValidatorJob(t,e,r,i){return super.addJob(this.url,t,Zs,e,r,i)}}class $s{constructor(t){t=t||{},this.lineID=null,this.lineName=null,this.lineAliasName=null,this.startStopIndex=null,this.startStopName=null,this.startStopAliasName=null,this.endStopIndex=null,this.endStopName=null,this.endStopAliasName=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TransferLine"}destroy(){rt.reset(this)}static fromJson(t){if(t)return new $s({lineID:t.lineID,lineName:t.lineName,lineAliasName:t.lineAliasName,startStopIndex:t.startStopIndex,startStopName:t.startStopName,startStopAliasName:t.startStopAliasName,endStopIndex:t.endStopIndex,endStopName:t.endStopName,endStopAliasName:t.endStopAliasName})}}class tn{constructor(t){t=t||{},this.transferLines=null,this.points=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TransferPathParameters"}destroy(){rt.reset(this)}static toJson(t){if(t)return rt.toJSON(t)}}class en extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TransferPathService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof tn){var r;return this.url=rt.urlPathAppend(this.url,"path"),r={points:rt.toJSON(t.points),transferLines:rt.toJSON(t.transferLines)},this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class rn{constructor(t){t=t||{},this.solutionCount=6,this.transferPreference=E.NONE,this.transferTactic=T.LESS_TIME,this.walkingRatio=null,this.points=!1,this.evadeLines=null,this.evadeStops=null,this.priorLines=null,this.priorStops=null,this.travelTime=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.TransferSolutionParameters"}destroy(){rt.reset(this)}static toJson(t){if(t)return rt.toJSON(t)}}class sn extends ie{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.TransferSolutionService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof rn){var r;return this.url=rt.urlPathAppend(this.url,"solutions"),r={points:rt.toJSON(t.points),walkingRatio:t.walkingRatio,transferTactic:t.transferTactic,solutionCount:t.solutionCount,transferPreference:t.transferPreference},t.evadeLines&&(r.evadeLines=rt.toJSON(t.evadeLines)),t.evadeStops&&(r.evadeStops=rt.toJSON(t.evadeStops)),t.priorLines&&(r.priorLines=rt.toJSON(t.priorLines)),t.priorStops&&(r.priorStops=rt.toJSON(t.priorStops)),t.travelTime&&(r.travelTime=t.travelTime),this.request({method:"GET",params:r,scope:this,success:e,failure:e})}}}class nn{constructor(t){t&&(this.edgeId="",this.fromNodeId="",this.toNodeId="",this.weightField="",this.edgeWeight="",rt.extend(this,t),this.CLASS_NAME="SuperMap.UpdateEdgeWeightParameters")}destroy(){this.edgeId=null,this.fromNodeId=null,this.toNodeId=null,this.weightField=null,this.edgeWeight=null}}class an{constructor(t){t&&(this.datasourceName=null,this.datasetName=null,this.datasetType=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.CreateDatasetParameters")}destroy(){this.datasourceName=null,this.datasetName=null,this.datasetType=null}}class on extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.UpdateEdgeWeightService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof nn){var r=this,i=r.parse(t);r.url=rt.urlPathAppend(r.url,i);var s=t.edgeWeight?t.edgeWeight:null;return r.request({method:"PUT",scope:r,data:s,success:e,failure:e})}}parse(t){if(t){var e="";for(var r in t)if(""!==t[r]&&"edgeWeight"!==t[r])switch(r){case"edgeId":e+="/edgeweight/"+t[r];break;case"fromNodeId":e+="/fromnode/"+t[r];break;case"toNodeId":e+="/tonode/"+t[r];break;case"weightField":e+="/weightfield/"+t[r]}return e}}}class ln{constructor(t){t&&(this.nodeId="",this.fromEdgeId="",this.toEdgeId="",this.weightField="",this.turnNodeWeight="",rt.extend(this,t),this.CLASS_NAME="SuperMap.UpdateTurnNodeWeightParameters")}destroy(){this.nodeId=null,this.fromEdgeId=null,this.toEdgeId=null,this.weightField=null,this.turnNodeWeight=null}}class hn extends Te{constructor(t,e){super(t,e),this.CLASS_NAME="SuperMap.UpdateTurnNodeWeightService"}destroy(){super.destroy()}processAsync(t,e){if(t instanceof ln){var r=this,i=r.parse(t);r.url=rt.urlPathAppend(r.url,i);var s=t.turnNodeWeight?t.turnNodeWeight:null;return r.request({method:"PUT",scope:r,data:s,success:e,failure:e})}}parse(t){if(t){var e="";for(var r in t)if(""!==t[r]&&"turnNodeWeight"!==t[r])switch(r){case"nodeId":e+="/turnnodeweight/"+t[r];break;case"fromEdgeId":e+="/fromedge/"+t[r];break;case"toEdgeId":e+="/toedge/"+t[r];break;case"weightField":e+="/weightfield/"+t[r]}return e}}}class un{constructor(t){t&&(this.datasourceName=null,this.datasetName=null,this.isFileCache=null,this.description=null,this.prjCoordSys=null,this.charset=null,this.palette=null,this.noValue=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.UpdateDatasetParameters")}destroy(){var t=this;t.datasourceName=null,t.datasetName=null,t.isFileCache=null,t.prjCoordSys=null,t.charset=null,t.palette=null,t.noValue=null}}class cn{constructor(t){t=t||{},this.datasetName="",this.datasetVectorClip="",this.geometryClip="",this.mode=I.CLIP,this.output=null,this.mappingParameters=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.VectorClipJobsParameter"}destroy(){this.datasetName=null,this.datasetVectorClip=null,this.geometryClip=null,this.mode=null,this.output instanceof _e&&(this.output.destroy(),this.output=null),this.mappingParameters instanceof xe&&(this.mappingParameters.destroy(),this.mappingParameters=null)}static toObject(t,e){for(var r in t)"datasetName"!==r?"output"!==r?(e.analyst=e.analyst||{},e.analyst[r]=t[r],"mappingParameters"===r&&(e.analyst[r]=e.analyst[r]||{},e.analyst.mappingParameters=t[r])):(e.output=e.output||{},e.output=t[r]):(e.input=e.input||{},e.input[r]=t[r])}}class dn extends Ce{constructor(t,e){super(t,e),this.url=rt.urlPathAppend(this.url,"spatialanalyst/vectorclip"),this.CLASS_NAME="SuperMap.VectorClipJobsService"}destroy(){super.destroy()}getVectorClipJobs(t){return super.getJobs(this.url,t)}getVectorClipJob(t,e){return super.getJobs(rt.urlPathAppend(this.url,t),e)}addVectorClipJob(t,e,r,i){return super.addJob(this.url,t,cn,e,r,i)}}class pn{constructor(t){t=t||{},this.type=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.RasterFunctionParameter"}destroy(){this.type=null}}class fn{constructor(t){this.name=null,this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobCustomItems",rt.extend(this,t)}destroy(){this.name=null,this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={name:this.name};return this.title&&(t.title=this.title),this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),rt.toJSON(t)}}class mn{constructor(t){this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobImage",rt.extend(this,t)}destroy(){this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={};return this.picAsUrl&&(t.picAsUrl=this.picAsUrl),this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),rt.toJSON(t)}}class yn{constructor(t){this.name=null,this.layerType=null,this.url=null,this.CLASS_NAME="SuperMap.WebPrintingJobLayers",rt.extend(this,t)}destroy(){this.name=null,this.layerType=null,this.url=null}}class gn{constructor(t){this.title=null,this.picAsUrl=null,this.picAsBase64=null,this.layers=null,this.customItems=null,this.CLASS_NAME="SuperMap.WebPrintingJobLegendOptions",rt.extend(this,t)}destroy(){this.title=null,this.picAsUrl=null,this.picAsBase64=null,this.layers instanceof yn&&(this.layers.destroy(),this.layers=null),this.customItems instanceof fn&&(this.customItems.destroy(),this.customItems=null)}toJSON(){var t={title:this.title||""};return this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64?t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,""):this.customItems&&(t.customItems=this.customItems),rt.toJSON(t)}}class vn{constructor(t){this.center=null,this.scale=null,this.layerNames=null,this.image=null,this.layers=null,this.CLASS_NAME="SuperMap.WebPrintingJobLittleMapOptions",rt.extend(this,t)}destroy(){this.center=null,this.scale=null,this.layerNames=null,this.image instanceof mn&&(this.image.destroy(),this.image=null),this.layers instanceof yn&&(this.layers.destroy(),this.layers=null)}toJSON(){var t={scale:this.scale,center:this.center};return this.layerNames?t.layerNames=this.layerNames:this.layers&&(t.layers=this.layers),this.image&&(t.image=this.image),rt.toJSON(t)}}class bn{constructor(t){this.picAsUrl=null,this.picAsBase64=null,this.CLASS_NAME="SuperMap.WebPrintingJobNorthArrowOptions",rt.extend(this,t)}destroy(){this.picAsUrl=null,this.picAsBase64=null}toJSON(){var t={};return this.picAsUrl?t.picAsUrl=this.picAsUrl:this.picAsBase64&&(t.picAsBase64=this.picAsBase64.replace(/^data:.+;base64,/,"")),rt.toJSON(t)}}class Sn{constructor(t){this.scaleText=null,this.orientation=null,this.type=null,this.intervals=null,this.unit=null,this.CLASS_NAME="SuperMap.WebPrintingJobScaleBarOptions",rt.extend(this,t)}destroy(){this.scaleText=null,this.orientation=null,this.type=null,this.intervals=null,this.unit=null}toJSON(){var t={scaleText:this.scaleText||"",type:this.type||"BAR",intervals:this.intervals||"",unit:this.unit||"METER"};return this.orientation&&(t.orientation=this.orientation),rt.toJSON(t)}}class _n{constructor(t){this.type=null,this.url=null,this.token=null,this.value=null,this.CLASS_NAME="SuperMap.WebPrintingJobContent",rt.extend(this,t)}destroy(){this.type="WEBMAP",this.url=null,this.token=null,this.value=null}toJSON(){var t={type:this.type};return this.token&&(t.token=this.token),this.url?t.url=this.url:this.value&&(t.value=this.value),rt.toJSON(t)}}class xn{constructor(t){this.templateName=null,this.title=null,this.subTitle=null,this.author=null,this.copyright=null,this.scaleBarOptions=null,this.northArrowOptions=null,this.littleMapOptions=null,this.legendOptions=null,this.CLASS_NAME="SuperMap.WebPrintingJobLayoutOptions",rt.extend(this,t)}destroy(){this.templateName=null,this.title=null,this.subTitle=null,this.author=null,this.copyright=null,this.scaleBarOptions instanceof Sn&&(this.scaleBarOptions.destroy(),this.scaleBarOptions=null),this.northArrowOptions instanceof bn&&(this.northArrowOptions.destroy(),this.northArrowOptions=null),this.littleMapOptions instanceof vn&&(this.littleMapOptions.destroy(),this.littleMapOptions=null),this.legendOptions instanceof gn&&(this.legendOptions.destroy(),this.legendOptions=null)}toJSON(){var t={templateName:this.templateName,title:this.title,subTitle:this.subTitle,author:this.author,copyright:this.copyright};return this.scaleBarOptions&&(t.scaleBarOptions=this.scaleBarOptions),this.northArrowOptions&&(t.northArrowOptions=this.northArrowOptions),this.littleMapOptions&&(t.littleMapOptions=this.littleMapOptions),this.legendOptions&&(t.legendOptions=this.legendOptions),rt.toJSON(t)}}class wn{constructor(t){this.format=null,this.dpi=96,this.scale=null,this.rotation=null,this.center=null,this.CLASS_NAME="SuperMap.WebPrintingJobExportOptions",rt.extend(this,t)}destroy(){this.format=null,this.dpi=null,this.scale=null,this.rotation=null,this.center=null,this.outputSize=null}toJSON(){var t={format:this.format||"PDF",dpi:this.dpi,scale:this.scale,center:this.center};return this.rotation&&(t.rotation=this.rotation),this.outputSize&&(t.outputSize=this.outputSize),rt.toJSON(t)}}class Cn extends ie{constructor(t,e){super(t,e),e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.WebPrintingService",this.url}destroy(){super.destroy()}createWebPrintingJob(t,e){if(t)return t.layoutOptions&&t.layoutOptions.legendOptions&&(!t.layoutOptions.legendOptions.title&&(t.layoutOptions.legendOptions.title=""),t.layoutOptions.legendOptions.picAsBase64=t.layoutOptions.legendOptions.picAsBase64&&t.layoutOptions.legendOptions.picAsBase64.replace(/^data:.+;base64,/,""),t.layoutOptions.legendOptions.customItems&&t.layoutOptions.legendOptions.customItems.hasOwnProperty("picAsBase64")&&(t.layoutOptions.legendOptions.customItems.picAsBase64=t.layoutOptions.legendOptions.customItems.picAsBase64.replace(/^data:.+;base64,/,""))),this.processAsync("jobs","POST",e,t)}getPrintingJob(t,e){var r=this;r.processAsync(`jobs/${t}`,"GET",function(i){r.rollingProcess(i,r._processUrl(`jobs/${t}`),e)})}getPrintingJobResult(t,e){return this.processAsync(`jobs/${t}/result`,"GET",e)}getLayoutTemplates(t){return this.processAsync("layouts","GET",t)}rollingProcess(t,e,r){var i=this;t&&(this.id&&clearInterval(this.id),this.id=setInterval(function(){i.request({url:e,method:"GET",scope:i,success:r,failure:r})},1e3))}processAsync(t,e,r,i){let s={url:this._processUrl(t),method:e,scope:this,success:r,failure:r};return i&&(s.data=rt.toJSON(i)),this.request(s)}transformResult(t,e){return"FINISHED"!==(t=rt.transformResult(t)).status&&"ERROR"!==t.status||clearInterval(this.id),{result:t,options:e}}_processUrl(t){return t?rt.urlPathAppend(this.url,t):this.url}}class Mn extends ie{constructor(t,e){super(t,e),this.options=e||{},e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.ImageCollectionService"}destroy(){super.destroy()}getLegend(t,e){var r={collectionId:this.options.collectionId};"function"==typeof t&&(e=t,t=null);var i=rt.convertPath("/collections/{collectionId}/legend",r),s=rt.urlPathAppend(this.url,i);return this._processAsync({url:s,method:"GET",params:t,callback:e})}getStatistics(t){var e={collectionId:this.options.collectionId},r=rt.convertPath("/collections/{collectionId}/statistics",e),i=rt.urlPathAppend(this.url,r);return this._processAsync({url:i,method:"GET",callback:t})}getTileInfo(t){var e={collectionId:this.options.collectionId},r=rt.convertPath("/collections/{collectionId}/tileInfo",e),i=rt.urlPathAppend(this.url,r);return this._processAsync({url:i,method:"GET",callback:t})}deleteItemByID(t,e){var r={collectionId:this.options.collectionId,featureId:t},i=rt.convertPath("/collections/{collectionId}/items/{featureId}",r),s=rt.urlPathAppend(this.url,i);return this._processAsync({url:s,method:"DELETE",callback:e})}getItemByID(t,e){var r={collectionId:this.options.collectionId,featureId:t},i=rt.convertPath("/collections/{collectionId}/items/{featureId}",r),s=rt.urlPathAppend(this.url,i);return this._processAsync({url:s,method:"GET",callback:e})}_processAsync({url:t,method:e,callback:r,params:i}){return this.request({method:e||"GET",url:t,params:i,scope:this,success:r,failure:r})}}class An extends ie{constructor(t,e){super(t,e),this.options=e||{},e&&rt.extend(this,e),this.CLASS_NAME="SuperMap.ImageService"}destroy(){super.destroy()}getCollections(t){var e=rt.convertPath("/collections"),r=rt.urlPathAppend(this.url,e);return this._processAsync({url:r,mehtod:"GET",callback:t})}getCollectionByID(t,e){var r={collectionId:t},i=rt.convertPath("/collections/{collectionId}",r),s=rt.urlPathAppend(this.url,i);return this._processAsync({url:s,mehtod:"GET",callback:e})}search(t,e){var r={...t||{}},i=rt.convertPath("/search"),s=rt.urlPathAppend(this.url,i);return this._processAsync({url:s,method:"POST",data:r,callback:e})}_processAsync({url:t,method:e,callback:r,data:i}){return this.request({method:e||"GET",url:t,data:i,scope:this,success:r,failure:r})}}class Tn{constructor(t){this.include=void 0,this.exclude=void 0,this.CLASS_NAME="SuperMap.FieldsFilter",rt.extend(this,t)}destroy(){this.include=void 0,this.exclude=void 0}static constructFromObject(t,e){return t&&(e=e||new Tn,t.hasOwnProperty("include")&&(e.include=t.include),t.hasOwnProperty("exclude")&&(e.exclude=t.exclude)),e}}class En{constructor(t){this.field=void 0,this.direction=En.Direction.ASC,this.CLASS_NAME="SuperMap.Sortby",rt.extend(this,t)}destroy(){this.field=void 0,this.direction="ASC"}static constructFromObject(t,e){return t&&(e=e||new En,t.hasOwnProperty("field")&&(e.field=t.field),t.hasOwnProperty("direction")&&(e.direction=t.direction)),e}}En.Direction={ASC:"ASC",DESC:"DESC"};class On{constructor(t){this.bbox=void 0,this.collections=void 0,this.ids=void 0,this.limit=void 0,this.fields=void 0,this.query=void 0,this.sortby=void 0,this.CLASS_NAME="SuperMap.ImageSearchParameter",rt.extend(this,t)}destroy(){var t=this;t.bbox=void 0,t.collections=void 0,t.ids=void 0,t.limit=void 0,t.fields=void 0,t.query=void 0,t.sortby=void 0}static constructFromObject(t,e){return t&&(e=e||new On,t.hasOwnProperty("bbox")&&(e.bbox=t.bbox),t.hasOwnProperty("collections")&&(e.collections=t.collections),t.hasOwnProperty("ids")&&(e.ids=t.ids),t.hasOwnProperty("limit")&&(e.limit=t.limit),t.hasOwnProperty("fields")&&(e.fields=Tn.constructFromObject&&Tn.constructFromObject(t.fields,{})||t.fields),t.hasOwnProperty("query")&&(e.query=t.query),t.hasOwnProperty("sortby")&&(e.sortby=t.sortby,t.sortby&&(e.sortby=t.sortby.map(t=>En.constructFromObject&&En.constructFromObject(t,{})||t)))),e}}class Ln{constructor(t){this.stretchType=void 0,this.stdevCoefficient=void 0,this.gaussianCoefficient=void 0,this.useMedianValue=void 0,this.minPercent=void 0,this.maxPercent=void 0,this.CLASS_NAME="SuperMap.ImageStretchOption",rt.extend(this,t)}destroy(){var t=this;t.stretchType=void 0,t.stdevCoefficient=void 0,t.gaussianCoefficient=void 0,t.useMedianValue=void 0,t.minPercent=void 0,t.maxPercent=void 0}static constructFromObject(t,e){return t&&(e=e||new Ln,t.hasOwnProperty("stretchType")&&(e.stretchType=t.stretchType),t.hasOwnProperty("stdevCoefficient")&&(e.stdevCoefficient=t.stdevCoefficient),t.hasOwnProperty("gaussianCoefficient")&&(e.gaussianCoefficient=t.gaussianCoefficient),t.hasOwnProperty("useMedianValue")&&(e.useMedianValue=t.useMedianValue),t.hasOwnProperty("minPercent")&&(e.minPercent=t.minPercent),t.hasOwnProperty("maxPercent")&&(e.maxPercent=t.maxPercent)),e}}Ln.StretchType={NONE:"NONE",GAUSSIAN:"GAUSSIAN",PERCENTCLIP:"PERCENTCLIP",MINIMUMMAXIMUM:"MINIMUMMAXIMUM",STANDARDDEVIATION:"STANDARDDEVIATION"};class Pn{constructor(t){this.displayMode=void 0,this.displayBands=void 0,this.stretchOption=void 0,this.interpolationMode=void 0,this.colorScheme=void 0,this.colorTable=void 0,this.brightness=void 0,this.contrast=void 0,this.noData=void 0,this.noDataColor=void 0,this.noDataTransparent=void 0,this.backgroundValue=void 0,this.backgroundColor=void 0,this.backgroundTransparent=void 0,this.gridFunctions=void 0,this.CLASS_NAME="SuperMap.ImageRenderingRule",rt.extend(this,t)}destroy(){var t=this;t.displayMode=void 0,t.displayBands=void 0,t.stretchOption=void 0,t.interpolationMode=void 0,t.colorScheme=void 0,t.colorTable=void 0,t.brightness=void 0,t.contrast=void 0,t.noData=void 0,t.noDataColor=void 0,t.noDataTransparent=void 0,t.backgroundValue=void 0,t.backgroundColor=void 0,t.backgroundTransparent=void 0,t.gridFuncOptions=void 0}static constructFromObject(t,e){return t&&(e=e||new Pn,t.hasOwnProperty("displayMode")&&(e.displayMode=t.displayMode),t.hasOwnProperty("displayBands")&&(e.displayBands=t.displayBands),t.hasOwnProperty("stretchOption")&&(e.stretchOption=Ln.constructFromObject&&Ln.constructFromObject(t.stretchOption,{})||t.stretchOption),t.hasOwnProperty("interpolationMode")&&(e.interpolationMode=t.interpolationMode),t.hasOwnProperty("colorScheme")&&(e.colorScheme=t.colorScheme),t.hasOwnProperty("colorTable")&&(e.colorTable=t.colorTable),t.hasOwnProperty("brightness")&&(e.brightness=t.brightness),t.hasOwnProperty("contrast")&&(e.contrast=t.contrast),t.hasOwnProperty("noData")&&(e.noData=t.noData),t.hasOwnProperty("noDataColor")&&(e.noDataColor=t.noDataColor),t.hasOwnProperty("backgroundValue")&&(e.backgroundValue=t.backgroundValue),t.hasOwnProperty("noDataTransparent")&&(e.noDataTransparent=t.noDataTransparent),t.hasOwnProperty("backgroundColor")&&(e.backgroundColor=t.backgroundColor),t.hasOwnProperty("backgroundTransparent")&&(e.backgroundTransparent=t.backgroundTransparent),t.hasOwnProperty("gridFunctions")&&(e.gridFunctions=t.gridFunctions)),e}}Pn.DisplayMode={COMPOSITE:"COMPOSITE",STRETCHED:"Stretched"},Pn.InterpolationMode={NEARESTNEIGHBOR:"NEARESTNEIGHBOR",HIGHQUALITYBILINEAR:"HIGHQUALITYBILINEAR",DEFAULT:"DEFAULT"};class Nn{constructor(t){this.girdFuncName="GFHillShade",this.Azimuth=315,this.Altitude=45,this.ZFactor=1,this.CLASS_NAME="SuperMap.ImageGFHillShade",rt.extend(this,t)}destroy(){this.girdFuncName="GFHillShade",this.Azimuth=315,this.Altitude=45,this.ZFactor=1}static constructFromObject(t,e){return t&&(e=e||new Nn,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Azimuth")&&(e.Azimuth=t.Azimuth),t.hasOwnProperty("Altitude")&&(e.Altitude=t.Altitude),t.hasOwnProperty("ZFactor")&&(e.ZFactor=t.ZFactor)),e}}class In{constructor(t){this.girdFuncName="GFAspect",this.Azimuth=void 0,this.CLASS_NAME="SuperMap.ImageGFAspect",rt.extend(this,t)}destroy(){this.girdFuncName="GFAspect",this.Azimuth=void 0}static constructFromObject(t,e){return t&&(e=e||new In,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Azimuth")&&(e.Azimuth=t.Azimuth)),e}}class Fn{constructor(t){this.girdFuncName="GFOrtho",this.CLASS_NAME="SuperMap.ImageGFOrtho",rt.extend(this,t)}destroy(){this.girdFuncName="GFOrtho"}static constructFromObject(t,e){return t&&(e=e||new Fn,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName)),e}}class kn{constructor(t){this.girdFuncName="GFSlope",this.Altitude=45,this.ZFactor=1,this.CLASS_NAME="SuperMap.ImageGFSlope",rt.extend(this,t)}destroy(){this.girdFuncName="GFSlope",this.Altitude=45,this.ZFactor=1}static constructFromObject(t,e){return t&&(e=e||new kn,t.hasOwnProperty("girdFuncName")&&(e.girdFuncName=t.girdFuncName),t.hasOwnProperty("Altitude")&&(e.Altitude=t.Altitude),t.hasOwnProperty("ZFactor")&&(e.ZFactor=t.ZFactor)),e}}class Dn{constructor(t){t=t||{},rt.extend(this,t),this.CLASS_NAME="SuperMap.OnlineServiceBase"}request(t,e,r,i={}){return e=Vt.appendCredential(e),i.crossOrigin=this.options.crossOrigin,i.headers=this.options.headers,zt.commit(t,e,r,i).then(function(t){return t.json()})}}class Rn extends Dn{constructor(t,e){super(t),e=e||{},this.MD5=null,this.type=null,this.userName=null,this.fileName=null,this.size=null,this.serviceStatus=null,this.serviceId=null,this.id=null,this.lastModfiedTime=null,this.status=null,this.storageId=null,this.publishInfo=null,this.authorizeSetting=null,this.nickname=null,this.tags=[],this.description=null,this.dataItemServices=null,this.coordType=null,this.dataCheckResult=null,this.dataMetaInfo=null,this.thumbnail=null,rt.extend(this,e),this.id&&(this.serviceUrl=t+"/"+this.id),this.CLASS_NAME="SuperMap.OnlineData"}load(){if(this.serviceUrl){var t=this;return t.request("GET",this.serviceUrl).then(function(e){rt.extend(t,e)})}}getPublishedServices(){return this.dataItemServices}getAuthorizeSetting(){return this.authorizeSetting}}class Bn{constructor(){this.BUILTIN_OBJECT={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1},this._ctx=null,this._canvas=null,this._pixelCtx=null,this._width=null,this._height=null,this._offsetX=0,this._offsetY=0,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Util"}clone(t){var e=this.BUILTIN_OBJECT;if("object"==typeof t&&null!==t){var r=t;if(t instanceof Array){r=[];for(var i=0,s=t.length;i<s;i++)r[i]=this.clone(t[i])}else if(!e[Object.prototype.toString.call(t)])for(var n in r={},t)t.hasOwnProperty(n)&&(r[n]=this.clone(t[n]));return r}return t}mergeItem(t,e,r,i){var s=this.BUILTIN_OBJECT;e.hasOwnProperty(r)&&("object"!=typeof t[r]||s[Object.prototype.toString.call(t[r])]?!i&&r in t||(t[r]=e[r]):this.merge(t[r],e[r],i))}merge(t,e,r){for(var i in e)this.mergeItem(t,e,i,r);return t}getContext(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx}getPixelContext(){return this._pixelCtx||(this._canvas=document.createElement("canvas"),this._width=this._canvas.width,this._height=this._canvas.height,this._pixelCtx=this._canvas.getContext("2d")),this._pixelCtx}adjustCanvasSize(t,e){var r,i=this._canvas,s=this._pixelCtx,n=this._width,a=this._height,o=this._offsetX,l=this._offsetY;t+o>n&&(n=t+o+100,i.width=n,r=!0),e+l>a&&(a=e+l+100,i.height=a,r=!0),t<-o&&(n+=o=100*Math.ceil(-t/100),i.width=n,r=!0),e<-l&&(a+=l=100*Math.ceil(-e/100),i.height=a,r=!0),r&&s.translate(o,l)}getPixelOffset(){return{x:this._offsetX,y:this._offsetY}}indexOf(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}inherits(t,e){var r=t.prototype;function i(){}for(var s in i.prototype=e.prototype,t.prototype=new i,r)t.prototype[s]=r[s];t.constructor=t}}class Gn{constructor(){this.util=new Bn,this._ctx=null,this.palette=["#ff9277"," #dddd00"," #ffc877"," #bbe3ff"," #d5ffbb","#bbbbff"," #ddb000"," #b0dd00"," #e2bbff"," #ffbbe3","#ff7777"," #ff9900"," #83dd00"," #77e3ff"," #778fff","#c877ff"," #ff77ab"," #ff6600"," #aa8800"," #77c7ff","#ad77ff"," #ff77ff"," #dd0083"," #777700"," #00aa00","#0088aa"," #8400dd"," #aa0088"," #dd0000"," #772e00"],this._palette=this.palette,this.highlightColor="rgba(0,0,255,1)",this._highlightColor=this.highlightColor,this.colorRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,this._nameColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"},this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Color"}customPalette(t){this.palette=t}resetPalette(){this.palette=this._palette}getColor(t,e){return t|=0,(e=e||this.palette)[t%e.length]}customHighlight(t){this.highlightColor=t}resetHighlight(){this.highlightColor=this._highlightColor}getHighlightColor(){return this.highlightColor}getRadialGradient(t,e,r,i,s,n,a){var o=this.util;this._ctx||(this._ctx=o.getContext());for(var l=this._ctx.createRadialGradient(t,e,r,i,s,n),h=0,u=a.length;h<u;h++)l.addColorStop(a[h][0],a[h][1]);return l.__nonRecursion=!0,l}getLinearGradient(t,e,r,i,s){var n=this.util;this._ctx||(this._ctx=n.getContext());for(var a=this._ctx.createLinearGradient(t,e,r,i),o=0,l=s.length;o<l;o++)a.addColorStop(s[o][0],s[o][1]);return a.__nonRecursion=!0,a}getStepColors(t,e,r){t=this.toRGBA(t),e=this.toRGBA(e),t=this.getData(t);for(var i=[],s=((e=this.getData(e))[0]-t[0])/r,n=(e[1]-t[1])/r,a=(e[2]-t[2])/r,o=(e[3]-t[3])/r,l=0,h=t[0],u=t[1],c=t[2],d=t[3];l<r;l++)i[l]=this.toColor([this.adjust(Math.floor(h),[0,255]),this.adjust(Math.floor(u),[0,255]),this.adjust(Math.floor(c),[0,255]),d.toFixed(4)-0],"rgba"),h+=s,u+=n,c+=a,d+=o;return h=e[0],u=e[1],c=e[2],d=e[3],i[l]=this.toColor([h,u,c,d],"rgba"),i}getGradientColors(t,e){var r=[],i=t.length;if(void 0===e&&(e=20),1===i)r=this.getStepColors(t[0],t[0],e);else if(i>1)for(var s=0,n=i-1;s<n;s++){var a=this.getStepColors(t[s],t[s+1],e);s<n-1&&a.pop(),r=r.concat(a)}return r}toColor(t,e){if(e=e||"rgb",t&&(3===t.length||4===t.length)){if(t=this.map(t,function(t){return t>1?Math.ceil(t):t}),e.indexOf("hex")>-1)return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1);if(e.indexOf("hs")>-1){var r=this.map(t.slice(1,3),function(t){return t+"%"});t[1]=r[0],t[2]=r[1]}return e.indexOf("a")>-1?(3===t.length&&t.push(1),t[3]=this.adjust(t[3],[0,1]),e+"("+t.slice(0,4).join(",")+")"):e+"("+t.slice(0,3).join(",")+")"}}toArray(t){(t=this.trim(t)).indexOf("rgba")<0&&(t=this.toRGBA(t));var e=[],r=0;return t.replace(/[\d.]+/g,function(t){r<3?t|=0:t=+t,e[r++]=t}),e}convert(t,e){if(!this.isCalculableColor(t))return t;var r=this.getData(t),i=r[3];return void 0===i&&(i=1),t.indexOf("hsb")>-1?r=this._HSV_2_RGB(r):t.indexOf("hsl")>-1&&(r=this._HSL_2_RGB(r)),e.indexOf("hsb")>-1||e.indexOf("hsv")>-1?r=this._RGB_2_HSB(r):e.indexOf("hsl")>-1&&(r=this._RGB_2_HSL(r)),r[3]=i,this.toColor(r,e)}toRGBA(t){return this.convert(t,"rgba")}toRGB(t){return this.convert(t,"rgb")}toHex(t){return this.convert(t,"hex")}toHSVA(t){return this.convert(t,"hsva")}toHSV(t){return this.convert(t,"hsv")}toHSBA(t){return this.convert(t,"hsba")}toHSB(t){return this.convert(t,"hsb")}toHSLA(t){return this.convert(t,"hsla")}toHSL(t){return this.convert(t,"hsl")}toName(t){for(var e in this._nameColors)if(this.toHex(this._nameColors[e])===this.toHex(t))return e;return null}trim(t){return String(t).replace(/\s+/g,"")}normalize(t){if(this._nameColors[t]&&(t=this._nameColors[t]),t=(t=this.trim(t)).replace(/hsv/i,"hsb"),/^#[\da-f]{3}$/i.test(t)){var e=(3840&(t=parseInt(t.slice(1),16)))<<8,r=(240&t)<<4,i=15&t;t="#"+((1<<24)+(e<<4)+e+(r<<4)+r+(i<<4)+i).toString(16).slice(1)}return t}lift(t,e){if(!this.isCalculableColor(t))return t;var r=e>0?1:-1;void 0===e&&(e=0),e=Math.abs(e)>1?1:Math.abs(e),t=this.toRGB(t);for(var i=this.getData(t),s=0;s<3;s++)i[s]=1===r?i[s]*(1-e)|0:(255-i[s])*e+i[s]|0;return"rgb("+i.join(",")+")"}reverse(t){if(!this.isCalculableColor(t))return t;var e=this.getData(this.toRGBA(t));return e=this.map(e,function(t){return 255-t}),this.toColor(e,"rgb")}mix(t,e,r){if(!this.isCalculableColor(t)||!this.isCalculableColor(e))return t;void 0===r&&(r=.5);for(var i=2*(r=1-this.adjust(r,[0,1]))-1,s=this.getData(this.toRGBA(t)),n=this.getData(this.toRGBA(e)),a=s[3]-n[3],o=((i*a==-1?i:(i+a)/(1+i*a))+1)/2,l=1-o,h=[],u=0;u<3;u++)h[u]=s[u]*o+n[u]*l;var c=s[3]*r+n[3]*(1-r);return c=Math.max(0,Math.min(1,c)),1===s[3]&&1===n[3]?this.toColor(h,"rgb"):(h[3]=c,this.toColor(h,"rgba"))}random(){return"#"+Math.random().toString(16).slice(2,8)}getData(t){var e,r,i=(t=this.normalize(t)).match(this.colorRegExp);if(null===i)throw new Error("The color format error");var s,n=[];if(i[2])s=[(e=i[2].replace("#","").split(""))[0]+e[1],e[2]+e[3],e[4]+e[5]],n=this.map(s,function(t){return Gn.prototype.adjust.call(this,parseInt(t,16),[0,255])});else if(i[4]){var a=i[4].split(",");r=a[3],s=a.slice(0,3),n=this.map(s,function(t){return t=Math.floor(t.indexOf("%")>0?2.55*parseInt(t,0):t),Gn.prototype.adjust.call(this,t,[0,255])}),void 0!==r&&n.push(this.adjust(parseFloat(r),[0,1]))}else if(i[5]||i[6]){var o=(i[5]||i[6]).split(","),l=parseInt(o[0],0)/360,h=o[1],u=o[2];r=o[3],(n=this.map([h,u],function(t){return Gn.prototype.adjust.call(this,parseFloat(t)/100,[0,1])})).unshift(l),void 0!==r&&n.push(this.adjust(parseFloat(r),[0,1]))}return n}alpha(t,e){if(!this.isCalculableColor(t))return t;null===e&&(e=1);var r=this.getData(this.toRGBA(t));return r[3]=this.adjust(Number(e).toFixed(4),[0,1]),this.toColor(r,"rgba")}map(t,e){if("function"!=typeof e)throw new TypeError;for(var r=t?t.length:0,i=0;i<r;i++)t[i]=e(t[i]);return t}adjust(t,e){return t<=e[0]?t=e[0]:t>=e[1]&&(t=e[1]),t}isCalculableColor(t){return t instanceof Array||"string"==typeof t}_HSV_2_RGB(t){var e,r,i,s=t[0],n=t[1],a=t[2];if(0===n)e=255*a,r=255*a,i=255*a;else{var o=6*s;6===o&&(o=0);var l=0|o,h=a*(1-n),u=a*(1-n*(o-l)),c=a*(1-n*(1-(o-l))),d=0,p=0,f=0;0===l?(d=a,p=c,f=h):1===l?(d=u,p=a,f=h):2===l?(d=h,p=a,f=c):3===l?(d=h,p=u,f=a):4===l?(d=c,p=h,f=a):(d=a,p=h,f=u),e=255*d,r=255*p,i=255*f}return[e,r,i]}_HSL_2_RGB(t){var e,r,i,s=t[0],n=t[1],a=t[2];if(0===n)e=255*a,r=255*a,i=255*a;else{var o,l=2*a-(o=a<.5?a*(1+n):a+n-n*a);e=255*this._HUE_2_RGB(l,o,s+1/3),r=255*this._HUE_2_RGB(l,o,s),i=255*this._HUE_2_RGB(l,o,s-1/3)}return[e,r,i]}_HUE_2_RGB(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+6*(e-t)*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}_RGB_2_HSB(t){var e,r,i=t[0]/255,s=t[1]/255,n=t[2]/255,a=Math.min(i,s,n),o=Math.max(i,s,n),l=o-a,h=o;if(0===l)e=0,r=0;else{r=l/o;var u=((o-i)/6+l/2)/l,c=((o-s)/6+l/2)/l,d=((o-n)/6+l/2)/l;i===o?e=d-c:s===o?e=1/3+u-d:n===o&&(e=2/3+c-u),e<0&&(e+=1),e>1&&(e-=1)}return[e*=360,r*=100,h*=100]}_RGB_2_HSL(t){var e,r,i=t[0]/255,s=t[1]/255,n=t[2]/255,a=Math.min(i,s,n),o=Math.max(i,s,n),l=o-a,h=(o+a)/2;if(0===l)e=0,r=0;else{r=h<.5?l/(o+a):l/(2-o-a);var u=((o-i)/6+l/2)/l,c=((o-s)/6+l/2)/l,d=((o-n)/6+l/2)/l;i===o?e=d-c:s===o?e=1/3+u-d:n===o&&(e=2/3+c-u),e<0&&(e+=1),e>1&&(e-=1)}return[e*=360,r*=100,h*=100]}}var Un=new Gn;var jn=function(t){var e;if(t===l.METER)e=1;else if(t===l.DEGREE)e=2*Math.PI*6378137/360;else if(t===l.KILOMETER)e=.001;else if(t===l.INCH)e=1/.025399999918;else{if(t!==l.FOOT)return e;e=.3048}return e};function zn(t,e,r,i,s=22){var n=[];if(t&&t.length>0)for(let e=0;e<t.length;e++)n.push(Vn(t[e],r,i));else{const t=Math.abs(e.left-e.right)/256;for(let e=0;e<s;e++)n.push(t/Math.pow(2,e))}return n.sort(function(t,e){return e-t})}function Vn(t,e,r){return 1/(t*e*(1/.0254)*jn(r))}var Jn=r(52),qn=r.n(Jn);class Hn{constructor(t){this.env=null,this.parser=null,this.ruleSet=null,this.cartoStr="",this.shaders=null,"string"==typeof t&&(this.cartoStr=t,this.env={frames:[],errors:[],error:function(t){this.errors.push(t)}},this.parser=this.getParser(this.env),this.parse(t),this.shaders=this.toShaders())}getParser(t){var e,r,i,s,n,a,o,l,h,u=this;function c(){s=o[i],n=r,l=r}function d(){o[i]=s,l=r=n}function p(){r>l&&(o[i]=o[i].slice(r-l),l=r)}function f(t){var s,n,a,u;if(t instanceof Function)return t.call(h.parsers);if("string"==typeof t)s=e.charAt(r)===t?t:null,n=1,p();else{if(p(),!(s=t.exec(o[i])))return null;n=s[0].length}if(s){var c=r+=n;for(u=r+o[i].length-n;r<u&&(32===(a=e.charCodeAt(r))||10===a||9===a);)r++;return o[i]=o[i].slice(n+(r-c)),l=r,0===o[i].length&&i<o.length-1&&i++,"string"==typeof s?s:1===s.length?s[0]:s}}function m(r){var i,s={index:a,filename:t.filename,message:"Parse error.",line:0,column:-1};for(var n in s)0===r[n]&&(r[n]=s[n]);i=r.filename&&u.env.inputs&&u.env.inputs[r.filename]?u.env.inputs[r.filename]:e,r.line=(i.slice(0,r.index).match(/\n/g)||"").length+1;for(var o=r.index;o>=0&&"\n"!==i.charAt(o);o--)r.column++;return new Error([r.filename,r.line,r.column,r.message].join(";"))}return this.env=t=t||{},this.env.filename=this.env.filename||null,this.env.inputs=this.env.inputs||{},h={parse:function(s){var n,h=null;if(r=i=l=a=0,o=[],e=s.replace(/\r\n/g,"\n"),t.filename&&(u.env.inputs[t.filename]=e),o=function(t){for(var r,i,s,n,a=0,o=/(?:@\{[\w-]+\}|[^"'`\{\}\/\(\)\\])+/g,l=/\/\*(?:[^*]|\*+[^\/*])*\*+\/|\/\/.*/g,u=/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'|`((?:[^`]|\\.)*)`/g,c=0,d=t[0],p=0;p<e.length;)if(o.lastIndex=p,(r=o.exec(e))&&r.index===p&&(p+=r[0].length,d.push(r[0])),s=e.charAt(p),l.lastIndex=u.lastIndex=p,(r=u.exec(e))&&r.index===p)p+=r[0].length,d.push(r[0]);else if(i||"/"!==s||"/"!==(n=e.charAt(p+1))&&"*"!==n||!(r=l.exec(e))||r.index!==p){switch(s){case"{":if(!i){c++,d.push(s);break}case"}":if(!i){c--,d.push(s),t[++a]=d=[];break}case"(":if(!i){i=!0,d.push(s);break}case")":if(i){i=!1,d.push(s);break}default:d.push(s)}p++}else p+=r[0].length,d.push(r[0]);return 0!==c&&(h={index:p-1,type:"Parse",message:c>0?"missing closing `}`":"missing opening `{`"}),t.map(function(t){return t.join("")})}([[]]),h)throw m(h);var c=function(t,e){var r=t.specificity,i=e.specificity;return r[0]!=i[0]?i[0]-r[0]:r[1]!=i[1]?i[1]-r[1]:r[2]!=i[2]?i[2]-r[2]:i[3]-r[3]};return(n=new Hn.Tree.Ruleset([],f(this.parsers.primary))).root=!0,n.toList=function(t){t.error=function(e){t.errors||(t.errors=new Error("")),t.errors.message?t.errors.message+="\n"+m(e).message:t.errors.message=m(e).message},t.frames=t.frames||[];var e=this.flatten([],[],t);return e.sort(c),e},n},parsers:{primary:function(){for(var t,e=[];(t=f(this.rule)||f(this.ruleset)||f(this.comment))||f(/^[\s\n]+/)||(t=f(this.invalid));)t&&e.push(t);return e},invalid:function(){var t=f(/^[^;\n]*[;\n]/);if(t)return new Hn.Tree.Invalid(t,n)},comment:function(){var t;if("/"===e.charAt(r))return"/"===e.charAt(r+1)?new Hn.Tree.Comment(f(/^\/\/.*/),!0):(t=f(/^\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/))?new Hn.Tree.Comment(t):void 0},entities:{quoted:function(){if('"'===e.charAt(r)||"'"===e.charAt(r)){var t=f(/^"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/);return t?new Hn.Tree.Quoted(t[1]||t[2]):void 0}},field:function(){if(f("[")){var t=f(/(^[^\]]+)/);if(f("]"))return t?new Hn.Tree.Field(t[1]):void 0}},comparison:function(){var t=f(/^=~|=|!=|<=|>=|<|>/);if(t)return t},keyword:function(){var t=f(/^[A-Za-z\u4e00-\u9fa5-]+[A-Za-z-0-9\u4e00-\u9fa5_]*/);if(t)return new Hn.Tree.Keyword(t)},call:function(){var t,e;if(t=/^([\w\-]+|%)\(/.exec(o[i])){if("url"===(t=t[1]))return null;r+=t.length;if(f("("),e=f(this.entities.arguments),f(")"))return t?new Hn.Tree.Call(t,e,r):void 0}},arguments:function(){for(var t,e=[];t=f(this.expression);){e.push(t);if(!f(","))break}return e},literal:function(){return f(this.entities.dimension)||f(this.entities.keywordcolor)||f(this.entities.hexcolor)||f(this.entities.quoted)},url:function(){var t;if("u"===e.charAt(r)&&f(/^url\(/)){t=f(this.entities.quoted)||f(this.entities.variable)||f(/^[\-\w%@_match\/.&=:;#+?~]+/)||"";return f(")")?new Hn.Tree.URL(void 0!==t.value||t instanceof Hn.Tree.Variable?t:new Hn.Tree.Quoted(t)):new Hn.Tree.Invalid(t,n,"Missing closing ) in URL.")}},variable:function(){var i,s=r;if("@"===e.charAt(r)&&(i=f(/^@[\w-]+/)))return new Hn.Tree.Variable(i,s,t.filename)},hexcolor:function(){var t;if("#"===e.charAt(r)&&(t=f(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/)))return new Hn.Tree.Color(t[1])},keywordcolor:function(){var t=o[i].match(/^[a-z]+/);if(t&&t[0]in Hn.Tree.Reference.data.colors)return new Hn.Tree.Color(Hn.Tree.Reference.data.colors[f(/^[a-z]+/)])},dimension:function(){var t=e.charCodeAt(r);if(!(t>57||t<45||47===t)){var i=f(/^(-?\d*\.?\d+(?:[eE][-+]?\d+)?)(\%|\w+)?/);return i?new Hn.Tree.Dimension(i[1],i[2],n):void 0}}},variable:function(){var t;if("@"===e.charAt(r)&&(t=f(/^(@[\w-]+)\s*:/)))return t[1]},entity:function(){var t=f(this.entities.call)||f(this.entities.literal),e=f(this.entities.field)||f(this.entities.variable),r=f(this.entities.url)||f(this.entities.keyword);return t||e||r},end:function(){var t;return f(";")||("string"==typeof(t="}")?e.charAt(r)===t:!!t.test(o[i]))},element:function(){var t=f(/^(?:[.#][\w\u4e00-\u9fa5\-]+|\*|Map)/);if(t)return new Hn.Tree.Element(t)},attachment:function(){var t=f(/^::([\w\-]+(?:\/[\w\-]+)*)/);if(t)return t[1]},selector:function(){for(var t,i,s,a,o,l=[],h=new Hn.Tree.Filterset,u=[],c=0,d=0;(s=f(this.element))||(o=f(this.zoom))||(a=f(this.filter))||(t=f(this.attachment));){if(c++,s)l.push(s);else if(o)u.push(o),d++;else if(a){var p=h.add(a);if(p)throw m({message:p,index:r-1});d++}else{if(i)throw m({message:"Encountered second attachment name.",index:r-1});i=t}var y=e.charAt(r);if("{"===y||"}"===y||";"===y||","===y)break}if(c)return new Hn.Tree.Selector(h,u,l,i,d,n)},filter:function(){c();var e,r,i;if(f("[")&&(e=f(/^[a-zA-Z0-9\-_]+/)||f(this.entities.quoted)||f(this.entities.variable)||f(this.entities.keyword)||f(this.entities.field))&&(e instanceof Hn.Tree.Quoted&&(e=new Hn.Tree.Field(e.toString())),(r=f(this.entities.comparison))&&(i=f(this.entities.quoted)||f(this.entities.variable)||f(this.entities.dimension)||f(this.entities.keyword)||f(this.entities.field)))){if(!f("]"))throw m({message:"Missing closing ] of filter.",index:n-1});return e.is||(e=new Hn.Tree.Field(e)),new Hn.Tree.Filter(e,r,i,n,t.filename)}},zoom:function(){c();var t,e;if(f(/^\[\s*zoom/g)&&(t=f(this.entities.comparison))&&(e=f(this.entities.variable)||f(this.entities.dimension))&&f("]"))return new Hn.Tree.Zoom(t,e,n);d()},block:function(){var t;if(f("{")&&(t=f(this.primary))&&f("}"))return t},ruleset:function(){var t,e,r=[];for(c();t=f(this.selector);){for(r.push(t);f(this.comment););if(!f(","))break;for(;f(this.comment););}if(t)for(;f(this.comment););if(r.length>0&&(e=f(this.block))){if(1===r.length&&r[0].elements.length&&"Map"===r[0].elements[0].value){var i=new Hn.Tree.Ruleset(r,e);return i.isMap=!0,i}return new Hn.Tree.Ruleset(r,e)}d()},rule:function(){var i,s,o=e.charAt(r);if(c(),"."!==o&&"#"!==o&&(i=f(this.variable)||f(this.property))){if((s=f(this.value))&&f(this.end))return new Hn.Tree.Rule(i,s,n,t.filename);a=r,d()}},font:function(){for(var t,e=[],r=[];t=f(this.entity);)r.push(t);if(e.push(new Hn.Tree.Expression(r)),f(","))for(;(t=f(this.expression))&&(e.push(t),f(",")););return new Hn.Tree.Value(e)},value:function(){for(var t,e=[];(t=f(this.expression))&&(e.push(t),f(",")););return e.length>1?new Hn.Tree.Value(e.map(function(t){return t.value[0]})):1===e.length?new Hn.Tree.Value(e):void 0},sub:function(){var t;if(f("(")&&(t=f(this.expression))&&f(")"))return t},multiplication:function(){var t,e,r,i;if(t=f(this.operand)){for(;(r=f("/")||f("*")||f("%"))&&(e=f(this.operand));)i=new Hn.Tree.Operation(r,[i||t,e],n);return i||t}},addition:function(){var t,i,s,a;if(t=f(this.multiplication)){for(;(s=f(/^[-+]\s+/)||" "!=e.charAt(r-1)&&(f("+")||f("-")))&&(i=f(this.multiplication));)a=new Hn.Tree.Operation(s,[a||t,i],n);return a||t}},operand:function(){return f(this.sub)||f(this.entity)},expression:function(){for(var t,e=[];t=f(this.addition)||f(this.entity);)e.push(t);if(e.length>0)return new Hn.Tree.Expression(e)},property:function(){var t=f(/^(([a-z][-a-z_0-9]*\/)?\*?-?[-a-z_0-9]+)\s*:/);if(t)return t[1]}}}}parse(t){var e=this.parser;return this.ruleSet=e.parse(t)}toShaders(){if(this.ruleSet){var t=this.ruleSet;if(t){var e=t.toList(this.env);e.reverse();var r={},i=[];this._toShaders(r,i,e);for(var s=[],n={},a=0,o=e.length;a<o;++a){var l=e[a],h=l.attachment,u=r[i[a]],c=[];if(!n[h]){var d=0;for(var p in u)if("zoom"!==p&&"frames"!==p&&"attachment"!==p&&"elements"!=p)if("layer-index"===p){var f=(u[p].join("\n"),null);Object.defineProperty(c,"layerIndex",{configurable:!0,enumerable:!1,value:f})}else c[d++]=function(t,e){if(!Array.isArray(t))return t;var r=t.join("\n"),i='attributes["FEATUREID"]&&attributes["FEATUREID"]',s=r.indexOf(i);if(s>=0){if(!e.featureFilter){var n=s+i.length,a=r.indexOf(")",n+1),o="featureId&&(featureId"+r.substring(n,a)+")";Object.defineProperty(e,"featureFilter",{configurable:!0,enumerable:!1,value:function(t){return!!o}})}return{property:p,getValue:Function("attributes","zoom","seftFilter","var _value = null; var isExcute=typeof seftFilter=='function'?sefgFilter():seftFilter;if(isExcute){"+r+";} return _value; ")}}return{property:p,getValue:Function("attributes","zoom","var _value = null;"+r+"; return _value; ")}}(u[p],c);Object.defineProperty(c,"attachment",{configurable:!0,enumerable:!1,value:h}),Object.defineProperty(c,"elements",{configurable:!0,enumerable:!1,value:l.elements}),s.push(c),n[i[a]]=!0}Object.defineProperty(c,"zoom",{configurable:!0,enumerable:!1,value:l.zoom})}return s}}return null}_toShaders(t,e,r){for(let i=0,s=r.length;i<s;++i){let s=r[i],n=[];for(let t=0,e=s.elements.length;t<e;t++)n.push(s.elements[t]);let a=s.filters.filters,o=[];for(let t in a)o.push(a[t].id);let l=n.join("/")+"::"+s.attachment+"_"+o.join("_");e.push(l);let h=t[l]=t[l]||{};h.zoom=Hn.Tree.Zoom.all;let u=s.toJS(this.env);for(let t in u)(h[t]=h[t]||[]).push(u[t].join("\n"))}}getShaders(){return this.shaders}destroy(){this.cartoStr=null,this.env=null,this.ruleSet=null,this.parser=null,this.shaders=null}}var Wn={version:"2.1.1",style:{"filter-mode":{type:["all","first"],doc:"Control the processing behavior of Rule filters within a Style. If 'all' is used then all Rules are processed sequentially independent of whether any previous filters matched. If 'first' is used then it means processing ends after the first match (a positive filter evaluation) and no further Rules in the Style are processed ('first' is usually the default for CSS implementations on top of Mapnik to simplify translation from CSS to Mapnik XML)","default-value":"all","default-meaning":"All Rules in a Style are processed whether they have filters or not and whether or not the filter conditions evaluate to true."},"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},layer:{name:{"default-value":"",type:"string",required:!0,"default-meaning":"No layer name has been provided",doc:"The name of a layer. Can be anything you wish and is not strictly validated, but ideally unique  in the map"},srs:{"default-value":"",type:"string","default-meaning":"No srs value is provided and the value will be inherited from the Map's srs",doc:"The spatial reference system definition for the layer, aka the projection. Can either be a proj4 literal string like '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs' or, if the proper proj4 epsg/nad/etc identifier files are installed, a string that uses an id like: '+init=epsg:4326'"},status:{"default-value":!0,type:"boolean","default-meaning":"This layer will be marked as active and available for processing",doc:"A property that can be set to false to disable this layer from being processed"},minzoom:{"default-value":"0",type:"float","default-meaning":"The layer will be visible at the minimum possible scale",doc:"The minimum scale denominator that this layer will be visible at. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},maxzoom:{"default-value":"1.79769e+308",type:"float","default-meaning":"The layer will be visible at the maximum possible scale",doc:"The maximum scale denominator that this layer will be visible at. The default is the numeric limit of the C++ double type, which may vary slightly by system, but is likely a massive number like 1.79769e+308 and ensures that this layer will always be visible unless the value is reduced. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},queryable:{"default-value":!1,type:"boolean","default-meaning":"The layer will not be available for the direct querying of data values",doc:"This property was added for GetFeatureInfo/WMS compatibility and is rarely used. It is off by default meaning that in a WMS context the layer will not be able to be queried unless the property is explicitly set to true"},"clear-label-cache":{"default-value":!1,type:"boolean","default-meaning":"The renderer's collision detector cache (used for avoiding duplicate labels and overlapping markers) will not be cleared immediately before processing this layer",doc:"This property, by default off, can be enabled to allow a user to clear the collision detector cache before a given layer is processed. This may be desirable to ensure that a given layers data shows up on the map even if it normally would not because of collisions with previously rendered labels or markers"},"group-by":{"default-value":"",type:"string","default-meaning":"No special layer grouping will be used during rendering",doc:"https://github.com/mapnik/mapnik/wiki/Grouped-rendering"},"buffer-size":{"default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:"Extra tolerance around the Layer extent (in pixels) used to when querying and (potentially) clipping the layer data during rendering"},"maximum-extent":{"default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query this specific layer data during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Layer."}},symbolizers:{"*":{"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},map:{"background-color":{css:"background-color","default-value":"none","default-meaning":"transparent",type:"color",doc:"Map Background color"},"background-image":{css:"background-image",type:"uri","default-value":"","default-meaning":"transparent",doc:"An image that is repeated below all features on a map as a background.",description:"Map Background image"},srs:{css:"srs",type:"string","default-value":"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","default-meaning":"The proj4 literal of EPSG:4326 is assumed to be the Map's spatial reference and all data from layers within this map will be plotted using this coordinate system. If any layers do not declare an srs value then they will be assumed to be in the same srs as the Map and not transformations will be needed to plot them in the Map's coordinate space",doc:"Map spatial reference (proj4 string)"},"buffer-size":{css:"buffer-size","default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:'Extra tolerance around the map (in pixels) used to ensure labels crossing tile boundaries are equally rendered in each tile (e.g. cut in each tile). Not intended to be used in combination with "avoid-edges".'},"maximum-extent":{css:"","default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query all layers during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Map."},base:{css:"base","default-value":"","default-meaning":"This base path defaults to an empty string meaning that any relative paths to files referenced in styles or layers will be interpreted relative to the application process.",type:"string",doc:"Any relative paths used to reference files will be understood as relative to this directory path if the map is loaded from an in memory object rather than from the filesystem. If the map is loaded from the filesystem and this option is not provided it will be set to the directory of the stylesheet."},"paths-from-xml":{css:"","default-value":!0,"default-meaning":"Paths read from XML will be interpreted from the location of the XML",type:"boolean",doc:"value to control whether paths in the XML will be interpreted from the location of the XML or from the working directory of the program that calls load_map()"},"minimum-version":{css:"","default-value":"none","default-meaning":"Mapnik version will not be detected and no error will be thrown about compatibility",type:"string",doc:"The minumum Mapnik version (e.g. 0.7.2) needed to use certain functionality in the stylesheet"},"font-directory":{css:"font-directory",type:"uri","default-value":"none","default-meaning":"No map-specific fonts will be registered",doc:"Path to a directory which holds fonts which should be registered when the Map is loaded (in addition to any fonts that may be automatically registered)."}},polygon:{fill:{css:"polygon-fill",type:"color","default-value":"rgba(128,128,128,1)","default-meaning":"gray and fully opaque (alpha = 1), same as rgb(128,128,128)",doc:"Fill color to assign to a polygon"},"fill-opacity":{css:"polygon-opacity",type:"float",doc:"The opacity of the polygon","default-value":1,"default-meaning":"opaque"},gamma:{css:"polygon-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon edges"},"gamma-method":{css:"polygon-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},clip:{css:"polygon-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},line:{stroke:{css:"line-color","default-value":"rgba(0,0,0,1)",type:"color","default-meaning":"black and fully opaque (alpha = 1), same as rgb(0,0,0)",doc:"The color of a drawn line"},"stroke-width":{css:"line-width","default-value":1,type:"float",doc:"The width of a line in pixels"},"stroke-opacity":{css:"line-opacity","default-value":1,type:"float","default-meaning":"opaque",doc:"The opacity of a line"},"stroke-linejoin":{css:"line-join","default-value":"miter",type:["miter","round","bevel"],doc:"The behavior of lines when joining"},"stroke-linecap":{css:"line-cap","default-value":"butt",type:["butt","round","square"],doc:"The display of line endings"},"stroke-gamma":{css:"line-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of stroke line"},"stroke-gamma-method":{css:"line-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},"stroke-dasharray":{css:"line-dasharray",type:"numbers",doc:"A pair of length values [a,b], where (a) is the dash length and (b) is the gap length respectively. More than two values are supported for more complex patterns.","default-value":"none","default-meaning":"solid line"},"stroke-dashoffset":{css:"line-dash-offset",type:"numbers",doc:"valid parameter but not currently used in renderers (only exists for experimental svg support in Mapnik which is not yet enabled)","default-value":"none","default-meaning":"solid line"},"stroke-miterlimit":{css:"line-miterlimit",type:"float",doc:"The limit on the ratio of the miter length to the stroke-width. Used to automatically convert miter joins to bevel joins for sharp angles to avoid the miter extending beyond the thickness of the stroking path. Normally will not need to be set, but a larger value can sometimes help avoid jaggy artifacts.","default-value":4,"default-meaning":"Will auto-convert miters to bevel line joins when theta is less than 29 degrees as per the SVG spec: 'miterLength / stroke-width = 1 / sin ( theta / 2 )'"},clip:{css:"line-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},offset:{css:"line-offset",type:"float","default-value":0,"default-meaning":"no offset",doc:"Offsets a line a number of pixels parallel to its actual path. Postive values move the line left, negative values move it right (relative to the directionality of the line)."},rasterizer:{css:"line-rasterizer",type:["full","fast"],"default-value":"full",doc:"Exposes an alternate AGG rendering method that sacrifices some accuracy for speed."},"geometry-transform":{css:"line-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},markers:{file:{css:"marker-file",doc:"An SVG file that this marker shows at each placement. If no file is given, the marker will show an ellipse.","default-value":"","default-meaning":"An ellipse or circle, if width equals height",type:"uri"},opacity:{css:"marker-opacity",doc:"The overall opacity of the marker, if set, overrides both the opacity of both the fill and stroke","default-value":1,"default-meaning":"The stroke-opacity and fill-opacity will be used",type:"float"},"fill-opacity":{css:"marker-fill-opacity",doc:"The fill opacity of the marker","default-value":1,"default-meaning":"opaque",type:"float"},stroke:{css:"marker-line-color",doc:"The color of the stroke around a marker shape.","default-value":"black",type:"color"},"stroke-width":{css:"marker-line-width",doc:"The width of the stroke around a marker shape, in pixels. This is positioned on the boundary, so high values can cover the area itself.",type:"float"},"stroke-opacity":{css:"marker-line-opacity","default-value":1,"default-meaning":"opaque",doc:"The opacity of a line",type:"float"},placement:{css:"marker-placement",type:["point","line","interior"],"default-value":"point","default-meaning":"Place markers at the center point (centroid) of the geometry",doc:"Attempt to place markers on a point, in the center of a polygon, or if markers-placement:line, then multiple times along a line. 'interior' placement can be used to ensure that points placed on polygons are forced to be inside the polygon interior"},"multi-policy":{css:"marker-multi-policy",type:["each","whole","largest"],"default-value":"each","default-meaning":"If a feature contains multiple geometries and the placement type is either point or interior then a marker will be rendered for each",doc:"A special setting to allow the user to control rendering behavior for 'multi-geometries' (when a feature contains multiple geometries). This setting does not apply to markers placed along lines. The 'each' policy is default and means all geometries will get a marker. The 'whole' policy means that the aggregate centroid between all geometries will be used. The 'largest' policy means that only the largest (by bounding box areas) feature will get a rendered marker (this is how text labeling behaves by default)."},"marker-type":{css:"marker-type",type:["arrow","ellipse"],"default-value":"ellipse",doc:"The default marker-type. If a SVG file is not given as the marker-file parameter, the renderer provides either an arrow or an ellipse (a circle if height is equal to width)"},width:{css:"marker-width","default-value":10,doc:"The width of the marker, if using one of the default types.",type:"expression"},height:{css:"marker-height","default-value":10,doc:"The height of the marker, if using one of the default types.",type:"expression"},fill:{css:"marker-fill","default-value":"blue",doc:"The color of the area of the marker.",type:"color"},"allow-overlap":{css:"marker-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping markers are shown or hidden.","default-meaning":"Do not allow makers to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"marker-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},spacing:{css:"marker-spacing",doc:"Space between repeated labels","default-value":100,type:"float"},"max-error":{css:"marker-max-error",type:"float","default-value":.2,doc:"The maximum difference between actual marker placement and the marker-spacing parameter. Setting a high value can allow the renderer to try to resolve placement conflicts with other symbolizers."},transform:{css:"marker-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},clip:{css:"marker-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"marker-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"marker-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"marker-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},shield:{name:{css:"shield-name",type:"expression",serialization:"content",doc:'Value to use for a shield"s text label. Data columns are specified using brackets like [column_name]'},file:{css:"shield-file",required:!0,type:"uri","default-value":"none",doc:"Image file to render behind the shield text"},"face-name":{css:"shield-face-name",type:"string",validate:"font",doc:"Font name and style to use for the shield text","default-value":"",required:!0},"unlock-image":{css:"shield-unlock-image",type:"boolean",doc:"This parameter should be set to true if you are trying to position text beside rather than on top of the shield image","default-value":!1,"default-meaning":"text alignment relative to the shield image uses the center of the image as the anchor for text positioning."},size:{css:"shield-size",type:"float",doc:"The size of the shield text in pixels"},fill:{css:"shield-fill",type:"color",doc:"The color of the shield text"},placement:{css:"shield-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"How this shield should be placed. Point placement attempts to place it on top of points, line places along lines multiple times per feature, vertex places on the vertexes of polygons, and interior attempts to place inside of polygons."},"avoid-edges":{css:"shield-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.",type:"boolean","default-value":!1},"allow-overlap":{css:"shield-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping shields are shown or hidden.","default-meaning":"Do not allow shields to overlap with other map elements already placed."},"minimum-distance":{css:"shield-min-distance",type:"float","default-value":0,doc:"Minimum distance to the next shield symbol, not necessarily the same shield."},spacing:{css:"shield-spacing",type:"float","default-value":0,doc:"The spacing between repeated occurrences of the same shield on a line"},"minimum-padding":{css:"shield-min-padding","default-value":0,doc:"Determines the minimum amount of padding that a shield gets relative to other shields",type:"float"},"wrap-width":{css:"shield-wrap-width",type:"unsigned","default-value":0,doc:"Length of a chunk of text in characters before wrapping text"},"wrap-before":{css:"shield-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"shield-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long names."},"halo-fill":{css:"shield-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"shield-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},"character-spacing":{css:"shield-character-spacing",type:"unsigned","default-value":0,doc:"Horizontal spacing between characters (in pixels). Currently works for point placement only, not line placement."},"line-spacing":{css:"shield-line-spacing",doc:"Vertical spacing between lines of multiline labels (in pixels)",type:"unsigned"},dx:{css:"shield-text-dx",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"shield-text-dy",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"shield-dx":{css:"shield-dx",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},"shield-dy":{css:"shield-dy",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},opacity:{css:"shield-opacity",type:"float",doc:"(Default 1.0) - opacity of the image used for the shield","default-value":1},"text-opacity":{css:"shield-text-opacity",type:"float",doc:"(Default 1.0) - opacity of the text placed on top of the shield","default-value":1},"horizontal-alignment":{css:"shield-horizontal-alignment",type:["left","middle","right","auto"],doc:"The shield's horizontal alignment from its centerpoint","default-value":"auto"},"vertical-alignment":{css:"shield-vertical-alignment",type:["top","middle","bottom","auto"],doc:"The shield's vertical alignment from its centerpoint","default-value":"middle"},"text-transform":{css:"shield-text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"justify-alignment":{css:"shield-justify-alignment",type:["left","center","right","auto"],doc:"Define how text in a shield's label is justified","default-value":"auto"},clip:{css:"shield-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"shield-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"line-pattern":{file:{css:"line-pattern-file",type:"uri","default-value":"none",required:!0,doc:"An image file to be repeated and warped along a line"},clip:{css:"line-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"line-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"polygon-pattern":{file:{css:"polygon-pattern-file",type:"uri","default-value":"none",required:!0,doc:"Image to use as a repeated pattern fill within a polygon"},alignment:{css:"polygon-pattern-alignment",type:["local","global"],"default-value":"local",doc:"Specify whether to align pattern fills to the layer or to the map."},gamma:{css:"polygon-pattern-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon pattern edges"},opacity:{css:"polygon-pattern-opacity",type:"float",doc:"(Default 1.0) - Apply an opacity level to the image used for the pattern","default-value":1,"default-meaning":"The image is rendered without modifications"},clip:{css:"polygon-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},raster:{opacity:{css:"raster-opacity","default-value":1,"default-meaning":"opaque",type:"float",doc:"The opacity of the raster symbolizer on top of other symbolizers."},"filter-factor":{css:"raster-filter-factor","default-value":-1,"default-meaning":"Allow the datasource to choose appropriate downscaling.",type:"float",doc:"This is used by the Raster or Gdal datasources to pre-downscale images using overviews. Higher numbers can sometimes cause much better scaled image output, at the cost of speed."},scaling:{css:"raster-scaling",type:["near","fast","bilinear","bilinear8","bicubic","spline16","spline36","hanning","hamming","hermite","kaiser","quadric","catrom","gaussian","bessel","mitchell","sinc","lanczos","blackman"],"default-value":"near",doc:"The scaling algorithm used to making different resolution versions of this raster layer. Bilinear is a good compromise between speed and accuracy, while lanczos gives the highest quality."},"mesh-size":{css:"raster-mesh-size","default-value":16,"default-meaning":"Reprojection mesh will be 1/16 of the resolution of the source image",type:"unsigned",doc:"A reduced resolution mesh is used for raster reprojection, and the total image size is divided by the mesh-size to determine the quality of that mesh. Values for mesh-size larger than the default will result in faster reprojection but might lead to distortion."},"comp-op":{css:"raster-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},point:{file:{css:"point-file",type:"uri",required:!1,"default-value":"none",doc:"Image file to represent a point"},"allow-overlap":{css:"point-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping points are shown or hidden.","default-meaning":"Do not allow points to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"point-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},opacity:{css:"point-opacity",type:"float","default-value":1,"default-meaning":"Fully opaque",doc:"A value from 0 to 1 to control the opacity of the point"},placement:{css:"point-placement",type:["centroid","interior"],doc:"How this point should be placed. Centroid calculates the geometric center of a polygon, which can be outside of it, while interior always places inside of a polygon.","default-value":"centroid"},transform:{css:"point-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},"comp-op":{css:"point-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},text:{name:{css:"text-name",type:"expression",required:!0,"default-value":"",serialization:"content",doc:"Value to use for a text label. Data columns are specified using brackets like [column_name]"},"face-name":{css:"text-face-name",type:"string",validate:"font",doc:"Font name and style to render a label in",required:!0},size:{css:"text-size",type:"float","default-value":10,doc:"Text size in pixels"},"text-ratio":{css:"text-ratio",doc:"Define the amount of text (of the total) present on successive lines when wrapping occurs","default-value":0,type:"unsigned"},"wrap-width":{css:"text-wrap-width",doc:"Length of a chunk of text in characters before wrapping text","default-value":0,type:"unsigned"},"wrap-before":{css:"text-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"text-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long text."},spacing:{css:"text-spacing",type:"unsigned",doc:"Distance between repeated text labels on a line (aka. label-spacing)"},"character-spacing":{css:"text-character-spacing",type:"float","default-value":0,doc:"Horizontal spacing adjustment between characters in pixels"},"line-spacing":{css:"text-line-spacing","default-value":0,type:"unsigned",doc:"Vertical spacing adjustment between lines in pixels"},"label-position-tolerance":{css:"text-label-position-tolerance","default-value":0,type:"unsigned",doc:"Allows the label to be displaced from its ideal position by a number of pixels (only works with placement:line)"},"max-char-angle-delta":{css:"text-max-char-angle-delta",type:"float","default-value":"22.5",doc:"The maximum angle change, in degrees, allowed between adjacent characters in a label. This value internally is converted to radians to the default is 22.5*math.pi/180.0. The higher the value the fewer labels will be placed around around sharp corners."},fill:{css:"text-fill",doc:"Specifies the color for the text","default-value":"#000000",type:"color"},opacity:{css:"text-opacity",doc:"A number from 0 to 1 specifying the opacity for the text","default-value":1,"default-meaning":"Fully opaque",type:"float"},"halo-fill":{css:"text-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"text-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},dx:{css:"text-dx",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"text-dy",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"vertical-alignment":{css:"text-vertical-alignment",type:["top","middle","bottom","auto"],doc:"Position of label relative to point position.","default-value":"auto","default-meaning":'Default affected by value of dy; "bottom" for dy>0, "top" for dy<0.'},"avoid-edges":{css:"text-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.","default-value":!1,type:"boolean"},"minimum-distance":{css:"text-min-distance",doc:"Minimum permitted distance to the next text symbolizer.",type:"float"},"minimum-padding":{css:"text-min-padding",doc:"Determines the minimum amount of padding that a text symbolizer gets relative to other text",type:"float"},"minimum-path-length":{css:"text-min-path-length",type:"float","default-value":0,"default-meaning":"place labels on all paths",doc:"Place labels only on paths longer than this value."},"allow-overlap":{css:"text-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping text is shown or hidden.","default-meaning":"Do not allow text to overlap with other text - overlapping markers will not be shown."},orientation:{css:"text-orientation",type:"expression",doc:"Rotate the text."},placement:{css:"text-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"Control the style of placement of a point versus the geometry it is attached to."},"placement-type":{css:"text-placement-type",doc:'Re-position and/or re-size text to avoid overlaps. "simple" for basic algorithm (using text-placements string,) "dummy" to turn this feature off.',type:["dummy","simple"],"default-value":"dummy"},placements:{css:"text-placements",type:"string","default-value":"",doc:'If "placement-type" is set to "simple", use this "POSITIONS,[SIZES]" string. An example is `text-placements: "E,NE,SE,W,NW,SW";` '},"text-transform":{css:"text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"horizontal-alignment":{css:"text-horizontal-alignment",type:["left","middle","right","auto"],doc:"The text's horizontal alignment from its centerpoint","default-value":"auto"},"justify-alignment":{css:"text-align",type:["left","right","center","auto"],doc:"Define how text is justified","default-value":"auto","default-meaning":"Auto alignment means that text will be centered by default except when using the `placement-type` parameter - in that case either right or left justification will be used automatically depending on where the text could be fit given the `text-placements` directives"},clip:{css:"text-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"text-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},building:{fill:{css:"building-fill","default-value":"#FFFFFF",doc:"The color of the buildings walls.",type:"color"},"fill-opacity":{css:"building-fill-opacity",type:"float",doc:"The opacity of the building as a whole, including all walls.","default-value":1},height:{css:"building-height",doc:"The height of the building in pixels.",type:"expression","default-value":"0"}}},colors:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50],transparent:[0,0,0,0]},filter:{value:["true","false","null","point","linestring","polygon","collection"]}};Hn.mapnik_reference={version:{latest:Wn,"2.1.1":Wn}},Hn.Tree={},Hn.Tree.operate=function(t,e,r){switch(t){case"+":return e+r;case"-":return e-r;case"*":return e*r;case"%":return e%r;case"/":return e/r}},Hn.Tree.functions={rgb:function(t,e,r){return this.rgba(t,e,r,1)},rgba:function(t,e,r,i){var s=this,n=[t,e,r].map(function(t){return s.number(t)});return i=s.number(i),n.some(isNaN)||isNaN(i)?null:new Hn.Tree.Color(n,i)},stop:function(t){var e,r;return arguments.length>1&&(e=arguments[1]),arguments.length>2&&(r=arguments[2]),{is:"tag",val:t,color:e,mode:r,toString:i=>'\n\t<stop value="'+t.ev(i)+'"'+(e?' color="'+e.ev(i)+'" ':"")+(r?' mode="'+r.ev(i)+'" ':"")+"/>"}},hsl:function(t,e,r){return this.hsla(t,e,r,1)},hsla:function(t,e,r,i){if([t=this.number(t)%360/360,e=this.number(e),r=this.number(r),i=this.number(i)].some(isNaN))return null;var s=r<=.5?r*(e+1):r+e-r*e,n=2*r-s;return this.rgba(255*a(t+1/3),255*a(t),255*a(t-1/3),i);function a(t){return 6*(t=t<0?t+1:t>1?t-1:t)<1?n+(s-n)*t*6:2*t<1?s:3*t<2?n+(s-n)*(2/3-t)*6:n}},hue:function(t){return"toHSL"in t?new Hn.Tree.Dimension(Math.round(t.toHSL().h)):null},saturation:function(t){return"toHSL"in t?new Hn.Tree.Dimension(Math.round(100*t.toHSL().s),"%"):null},lightness:function(t){return"toHSL"in t?new Hn.Tree.Dimension(Math.round(100*t.toHSL().l),"%"):null},alpha:function(t){return"toHSL"in t?new Hn.Tree.Dimension(t.toHSL().a):null},saturate:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.s+=e.value/100,r.s=this.clamp(r.s),this.hsla_simple(r)},desaturate:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.s-=e.value/100,r.s=this.clamp(r.s),this.hsla_simple(r)},lighten:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.l+=e.value/100,r.l=this.clamp(r.l),this.hsla_simple(r)},darken:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.l-=e.value/100,r.l=this.clamp(r.l),this.hsla_simple(r)},fadein:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.a+=e.value/100,r.a=this.clamp(r.a),this.hsla_simple(r)},fadeout:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL();return r.a-=e.value/100,r.a=this.clamp(r.a),this.hsla_simple(r)},spin:function(t,e){if(!("toHSL"in t))return null;var r=t.toHSL(),i=(r.h+e.value)%360;return r.h=i<0?360+i:i,this.hsla_simple(r)},replace:function(t,e,r){return"field"===t.is?t.toString+".replace("+e.toString()+", "+r.toString()+")":t.replace(e,r)},mix:function(t,e,r){var i=r.value/100,s=2*i-1,n=t.toHSL().a-e.toHSL().a,a=((s*n==-1?s:(s+n)/(1+s*n))+1)/2,o=1-a,l=[t.rgb[0]*a+e.rgb[0]*o,t.rgb[1]*a+e.rgb[1]*o,t.rgb[2]*a+e.rgb[2]*o],h=t.alpha*i+e.alpha*(1-i);return new Hn.Tree.Color(l,h)},greyscale:function(t){return this.desaturate(t,new Hn.Tree.Dimension(100))},"%":function(t){for(var e=Array.prototype.slice.call(arguments,1),r=t.value,i=0;i<e.length;i++)r=r.replace(/%s/,e[i].value).replace(/%[da]/,e[i].toString());return r=r.replace(/%%/g,"%"),new Hn.Tree.Quoted(r)},hsla_simple:function(t){return this.hsla(t.h,t.s,t.l,t.a)},number:function(t){return t instanceof Hn.Tree.Dimension?parseFloat("%"===t.unit?t.value/100:t.value):"number"==typeof t?t:NaN},clamp:function(t){return Math.min(1,Math.max(0,t))}},Hn.Tree.Call=class{constructor(t,e,r){this.is="call",this.name=t,this.args=e,this.index=r}ev(t){for(var e=this.args.map(function(e){return e.ev(t)}),r=0;r<e.length;r++)if("undefined"===e[r].is)return{is:"undefined",value:"undefined"};if(this.name in Hn.Tree.functions){if(Hn.Tree.functions[this.name].length<=e.length){var i=Hn.Tree.functions[this.name].apply(Hn.Tree.functions,e);return null===i?(t.error({message:"incorrect arguments given to "+this.name+"()",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):i}return t.error({message:"incorrect number of arguments for "+this.name+"(). "+Hn.Tree.functions[this.name].length+" expected.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}var s=Hn.Tree.Reference.mapnikFunctions[this.name];if(void 0===s){var n=qn()(Hn.Tree.Reference.mapnikFunctions),a=this.name,o=n.map(function(t){return[t[0],Hn.Tree.Reference.editDistance(a,t[0]),t[1]]}).sort(function(t,e){return t[1]-e[1]});return t.error({message:"unknown function "+this.name+"(), did you mean "+o[0][0]+"("+o[0][2]+")",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}return s!==e.length&&-1!==s?(t.error({message:"function "+this.name+"() takes "+s+" arguments and was given "+e.length,index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):(this.args=e,this)}toString(t,e){return this.args.length?this.name+"("+this.args.join(",")+")":this.name}},Hn.Tree.Color=class{constructor(t,e){this.is="color",Array.isArray(t)?this.rgb=t.slice(0,3):6==t.length?this.rgb=t.match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=t.split("").map(function(t){return parseInt(t+t,16)}),"number"==typeof e?this.alpha=e:4===t.length?this.alpha=t[3]:this.alpha=1}ev(){return this}toString(){return"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")"}operate(t,e,r){var i=[];r instanceof Hn.Tree.Color||(r=r.toColor());for(var s=0;s<3;s++)i[s]=Hn.Tree.operate(e,this.rgb[s],r.rgb[s]);return new Hn.Tree.Color(i)}toHSL(){var t,e,r=this.rgb[0]/255,i=this.rgb[1]/255,s=this.rgb[2]/255,n=this.alpha,a=Math.max(r,i,s),o=Math.min(r,i,s),l=(a+o)/2,h=a-o;if(a===o)t=e=0;else{switch(e=l>.5?h/(2-a-o):h/(a+o),a){case r:t=(i-s)/h+(i<s?6:0);break;case i:t=(s-r)/h+2;break;case s:t=(r-i)/h+4}t/=6}return{h:360*t,s:e,l,a:n}}},Hn.Tree.Comment=class{constructor(t,e){this.value=t,this.silent=!!e}toString(t){return"\x3c!--"+this.value+"--\x3e"}ev(){return this}},Hn.Tree.Definition=class{constructor(t,e){this.elements=t.elements,this.rules=e,this.ruleIndex={};for(var r=0;r<this.rules.length;r++)"zoom"in this.rules[r]&&(this.rules[r]=this.rules[r].clone()),this.rules[r].zoom=t.zoom,this.ruleIndex[this.rules[r].updateID()]=!0;this.filters=t.filters,this.zoom=t.zoom,this.attachment=t.attachment||"__default__",this.specificity=t.specificity()}toString(){for(var t=this.filters.toString(),e=0;e<this.rules.length;e++)t+="\n    "+this.rules[e];return t}toJS(t){var e={},r=this.zoom,i=this.filters.toJS(t),s=[r];function n(r){if(r instanceof Hn.Tree.Rule)e[r.name]=e[r.name]||[],i?e[r.name].push("if("+i+"){"+r.value.toJS(t)+"}"):e[r.name].push(r.value.toJS(t));else if(r instanceof Hn.Tree.Ruleset){var s=r.toJS(t);for(var n in s)for(var a in e[n]=e[n]||[],s[n])e[n].push(s[n][a])}}for(var a in i&&s.push(i),i=s.join(" && "),this.rules)n(this.rules[a]);return e}},Hn.Tree.Dimension=class{constructor(t,e,r){this.is="float",this.physical_units=["m","cm","in","mm","pt","pc"],this.screen_units=["px","%"],this.all_units=["m","cm","in","mm","pt","pc","px","%"],this.densities={m:.0254,mm:25.4,cm:2.54,pt:72,pc:6},this.value=parseFloat(t),this.unit=e||null,this.index=r}ev(t){if(this.unit&&this.all_units.indexOf(this.unit)<0)return t.error({message:"Invalid unit: '"+this.unit+"'",index:this.index}),{is:"undefined",value:"undefined"};if(this.unit&&this.physical_units.indexOf(this.unit)>=0){if(!t.ppi)return t.error({message:"ppi is not set, so metric units can't be used",index:this.index}),{is:"undefined",value:"undefined"};this.value=this.value/this.densities[this.unit]*t.ppi,this.unit="px"}return this}toColor(){return new Hn.Tree.Color([this.value,this.value,this.value])}round(){return this.value=Math.round(this.value),this}toString(){return this.value.toString()}operate(t,e,r){return"%"===this.unit&&"%"!==r.unit?(t.error({message:"If two operands differ, the first must not be %",index:this.index}),{is:"undefined",value:"undefined"}):"%"!==this.unit&&"%"===r.unit?"*"===e||"/"===e||"%"===e?(t.error({message:"Percent values can only be added or subtracted from other values",index:this.index}),{is:"undefined",value:"undefined"}):new Hn.Tree.Dimension(Hn.Tree.operate(e,this.value,this.value*r.value*.01),this.unit):new Hn.Tree.Dimension(Hn.Tree.operate(e,this.value,r.value),this.unit||r.unit)}},Hn.Tree.Element=class{constructor(t){this.value=t.trim(),"#"===this.value[0]&&(this.type="id",this.clean=this.value.replace(/^#/,"")),"."===this.value[0]&&(this.type="class",this.clean=this.value.replace(/^\./,"")),-1!==this.value.indexOf("*")&&(this.type="wildcard")}specificity(){return["id"===this.type?1:0,"class"===this.type?1:0]}toString(){return this.value}},Hn.Tree.Expression=class{constructor(t){this.is="expression",this.value=t}ev(t){return this.value.length>1?new Hn.Tree.Expression(this.value.map(function(e){return e.ev(t)})):this.value[0].ev(t)}toString(t){return this.value.map(function(e){return e.toString(t)}).join(" ")}},Hn.Tree.Field=class{constructor(t){this.is="field",this.value=t||""}toString(){return'["'+this.value.toUpperCase()+'"]'}ev(){return this}},Hn.Tree.Filter=class{constructor(t,e,r,i,s){this.ops={"<":[" &lt; ","numeric"],">":[" &gt; ","numeric"],"=":[" = ","both"],"!=":[" != ","both"],"<=":[" &lt;= ","numeric"],">=":[" &gt;= ","numeric"],"=~":[".match(","string",")"]},this.key=t,this.op=e,this.val=r,this.index=i,this.filename=s,this.id=this.key+this.op+this.val}ev(t){return this.key=this.key.ev(t),this.val=this.val.ev(t),this}toString(){return"["+this.id+"]"}},Hn.Tree.Filterset=class{constructor(){this.filters={}}toJS(t){function e(t){var e=t.op;"="===e&&(e="==");var r=t.val;void 0!==t._val&&(r=t._val.toString(!0)),t.key&&"scale"===t.key.value?r=+r:"string"!=typeof r&&"object"!=typeof r||(r="'"+r+"'");var i="attributes";return i+"&&"+i+t.key+"&&"+i+t.key+" "+e+r}var r=[];for(var i in this.filters)r.push(e(this.filters[i]));return r.join(" && ")}toString(){var t=[];for(var e in this.filters)t.push(this.filters[e].id);return t.sort().join("\t")}ev(t){for(var e in this.filters)this.filters[e].ev(t);return this}clone(){var t=new Hn.Tree.Filterset;for(var e in this.filters)t.filters[e]=this.filters[e];return t}cloneWith(t){var e=[];for(var r in t.filters){var i=this.addable(t.filters[r]);if(!1===i)return!1;!0===i&&e.push(t.filters[r])}if(!e.length)return null;var s=new Hn.Tree.Filterset;for(r in this.filters)s.filters[r]=this.filters[r];for(;r=e.shift();)s.add(r);return s}addable(t){var e=t.key.toString(),r=t.val.toString();switch(r.match(/^[0-9]+(\.[0-9]*)?_match/)&&(r=parseFloat(r)),t.op){case"=":return void 0!==this.filters[e+"="]?this.filters[e+"="].val.toString()==r&&null:void 0===this.filters[e+"!="+r]&&(!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)&&!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r))));case"=~":return!0;case"!=":return void 0!==this.filters[e+"="]?this.filters[e+"="].val!==r&&null:void 0!==this.filters[e+"!="+r]?null:void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)||null;case">":return e+"="in this.filters?!(this.filters[e+"="].val<=r)&&null:!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<=r)&&(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)||null));case">=":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val<r)&&null:!(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r)&&(!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)&&(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r?null:!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>=r)||null));case"<":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val>=r)&&null:!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>=r)&&(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<r)||null));case"<=":return void 0!==this.filters[e+"="]?!(this.filters[e+"="].val>r)&&null:!(void 0!==this.filters[e+">"]&&this.filters[e+">"].val>=r)&&(!(void 0!==this.filters[e+">="]&&this.filters[e+">="].val>r)&&(void 0!==this.filters[e+"<"]&&this.filters[e+"<"].val<=r?null:!(void 0!==this.filters[e+"<="]&&this.filters[e+"<="].val<=r)||null))}}conflict(t){var e=t.key.toString(),r=t.val.toString();return isNaN(parseFloat(r))||(r=parseFloat(r)),("="===t.op&&void 0!==this.filters[e+"="]&&r!=this.filters[e+"="].val.toString()||"!="===t.op&&void 0!==this.filters[e+"="]&&r==this.filters[e+"="].val.toString()||"="===t.op&&void 0!==this.filters[e+"!="]&&r===this.filters[e+"!="].val.toString())&&t.toString()+" added to "+this.toString()+" produces an invalid filter"}add(t,e){var r,i=t.key.toString(),s=t.op,n=this.conflict(t);if(n)return n;if("="===s){for(var a in this.filters)this.filters[a].key===i&&delete this.filters[a];this.filters[i+"="]=t}else if("!="===s)this.filters[i+"!="+t.val]=t;else if("=~"===s)this.filters[i+"=~"+t.val]=t;else if(">"===s){for(var o in this.filters)this.filters[o].key===i&&this.filters[o].val<=t.val&&delete this.filters[o];this.filters[i+">"]=t}else if(">="===s){for(var l in this.filters)r=+this.filters[l].val.toString(),this.filters[l].key===i&&r<t.val&&delete this.filters[l];void 0!==this.filters[i+"!="+t.val]?(delete this.filters[i+"!="+t.val],t.op=">",this.filters[i+">"]=t):this.filters[i+">="]=t}else if("<"===s){for(var h in this.filters)r=+this.filters[h].val.toString(),this.filters[h].key===i&&r>=t.val&&delete this.filters[h];this.filters[i+"<"]=t}else if("<="===s){for(var u in this.filters)r=+this.filters[u].val.toString(),this.filters[u].key===i&&r>t.val&&delete this.filters[u];void 0!==this.filters[i+"!="+t.val]?(delete this.filters[i+"!="+t.val],t.op="<",this.filters[i+"<"]=t):this.filters[i+"<="]=t}}},Hn.Tree.Fontset=class{constructor(t,e){this.fonts=e,this.name="fontset-"+t.effects.length}},Hn.Tree.Invalid=class{constructor(t,e,r){this.is="invalid",this.chunk=t,this.index=e,this.type="syntax",this.message=r||"Invalid code: "+this.chunk}ev(t){return t.error({chunk:this.chunk,index:this.index,type:"syntax",message:this.message||"Invalid code: "+this.chunk}),{is:"undefined"}}},Hn.Tree.Keyword=class{ev(){return this}constructor(t){this.value=t;var e={transparent:"color",true:"boolean",false:"boolean"};this.is=e[t]?e[t]:"keyword"}toString(){return this.value}},Hn.Tree.Literal=class{constructor(t){this.value=t||"",this.is="field"}toString(){return this.value}ev(){return this}},Hn.Tree.Operation=class{constructor(t,e,r){this.is="operation",this.op=t.trim(),this.operands=e,this.index=r}ev(t){var e,r=this.operands[0].ev(t),i=this.operands[1].ev(t);return"undefined"===r.is||"undefined"===i.is?{is:"undefined",value:"undefined"}:(r instanceof Hn.Tree.Dimension&&i instanceof Hn.Tree.Color&&("*"===this.op||"+"===this.op?(e=i,i=r,r=e):t.error({name:"OperationError",message:"Can't substract or divide a color from a number",index:this.index})),r instanceof Hn.Tree.Quoted&&i instanceof Hn.Tree.Quoted&&"+"!==this.op?(t.error({message:"Can't subtract, divide, or multiply strings.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):r instanceof Hn.Tree.Field||i instanceof Hn.Tree.Field||r instanceof Hn.Tree.Literal||i instanceof Hn.Tree.Literal?"color"===r.is||"color"===i.is?(t.error({message:"Can't subtract, divide, or multiply colors in expressions.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):new Hn.Tree.Literal(r.ev(t).toString(!0)+this.op+i.ev(t).toString(!0)):void 0===r.operate?(t.error({message:"Cannot do math with type "+r.is+".",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):r.operate(t,this.op,i))}},Hn.Tree.Quoted=class{constructor(t){this.is="string",this.value=t||""}toString(t){var e=this.value.replace(/&/g,"&amp;"),r=e.replace(/\'/g,"\\'").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/\>/g,"&gt;");return!0===t?"'"+r+"'":e}ev(){return this}operate(t,e,r){return new Hn.Tree.Quoted(Hn.Tree.operate(e,this.toString(),r.toString(this.contains_field)))}},Hn.Tree.Reference={_validateValue:{font:function(t,e){return!t.validation_data||!t.validation_data.fonts||-1!=t.validation_data.fonts.indexOf(e)}},setData:function(t){this.data=t,this.selector_cache=function(t){var e={};for(var r in t.symbolizers)for(var i in t.symbolizers[r])t.symbolizers[r][i].hasOwnProperty("css")&&(e[t.symbolizers[r][i].css]=[t.symbolizers[r][i],r,i]);return e}(t),this.mapnikFunctions=function(t){var e={};for(var r in t.symbolizers)for(var i in t.symbolizers[r])if("functions"===t.symbolizers[r][i].type)for(var s=0;s<t.symbolizers[r][i].functions.length;s++){var n=t.symbolizers[r][i].functions[s];e[n[0]]=n[1]}return e}(t),this.required_cache=function(t){var e={};for(var r in t.symbolizers)for(var i in e[r]=[],t.symbolizers[r])t.symbolizers[r][i].required&&e[r].push(t.symbolizers[r][i].css);return e}(t)},setVersion:function(t){return!!Hn.mapnik_reference.version.hasOwnProperty(t)&&(this.setData(Hn.mapnik_reference.version[t]),!0)},selectorData:function(t,e){if(this.selector_cache&&this.selector_cache[t])return this.selector_cache[t][e]},validSelector:function(t){return!!this.selector_cache[t]},selectorName:function(t){return this.selectorData(t,2)},selector:function(t){return this.selectorData(t,0)},symbolizer:function(t){return this.selectorData(t,1)},requiredProperties:function(t,e){var r=this.required_cache[t];for(var i in r)if(!(r[i]in e))return"Property "+r[i]+" required for defining "+t+" styles."},isFont:function(t){return"font"===this.selector(t).validate},editDistance:function(t,e){if(0===t.length)return e.length;if(0===e.length)return t.length;for(var r=[],i=0;i<=e.length;i++)r[i]=[i];for(var s=0;s<=t.length;s++)r[0][s]=s;for(i=1;i<=e.length;i++)for(s=1;s<=t.length;s++)e.charAt(i-1)===t.charAt(s-1)?r[i][s]=r[i-1][s-1]:r[i][s]=Math.min(r[i-1][s-1]+1,Math.min(r[i][s-1]+1,r[i-1][s]+1));return r[e.length][t.length]},validValue:function(t,e,r){var i;if(this.selector(e)){if("keyword"===r.value[0].is)return function(t,e){return"object"==typeof this.selector(e).type?-1!==this.selector(e).type.indexOf(t.value[0].value):"string"===this.selector(e).type}(r,e);if("undefined"===r.value[0].is)return!0;if("numbers"===this.selector(e).type){for(i in r.value)if("float"!==r.value[i].is)return!1;return!0}if("tags"===this.selector(e).type){if(!r.value)return!1;if(!r.value[0].value)return"tag"===r.value[0].is;for(i=0;i<r.value[0].value.length;i++)if("tag"!==r.value[0].value[i].is)return!1;return!0}if("functions"==this.selector(e).type)return function(t,e){if("string"===t.value[0].is)return!0;for(var r in t.value)for(var i in t.value[r].value){if("call"!==t.value[r].value[i].is)return!1;var s=find(this.selector(e).functions,function(e){return e[0]===t.value[r].value[i].name});if(!(s&&-1===s[1]||s&&s[1]===t.value[r].value[i].args.length))return!1}return!0}(r,e);if("expression"===this.selector(e).type)return!0;if("unsigned"===this.selector(e).type)return"float"===r.value[0].is&&(r.value[0].round(),!0);if(this.selector(e).validate){for(i=0;i<r.value.length;i++)if(this.selector(e).type===r.value[i].is&&this._validateValue[this.selector(e).validate](t,r.value[i].value))return!0;return!1}return this.selector(e).type===r.value[0].is}return!1}},Hn.Tree.Reference.setVersion("latest"),Hn.Tree.Rule=class{constructor(t,e,r,i){this.is="rule";var s=t.split("/");this.name=s.pop(),this.instance=s.length?s[0]:"__default__",this.value=e instanceof Hn.Tree.Value?e:new Hn.Tree.Value([e]),this.index=r,this.symbolizer=Hn.Tree.Reference.symbolizer(this.name),this.filename=i,this.variable="@"===t.charAt(0)}clone(){var t=Object.create(Hn.Tree.Rule.prototype);return t.name=this.name,t.value=this.value,t.index=this.index,t.instance=this.instance,t.symbolizer=this.symbolizer,t.filename=this.filename,t.variable=this.variable,t}updateID(){return this.id=this.zoom+"#"+this.instance+"#"+this.name}toString(){return"["+Hn.Tree.Zoom.toString(this.zoom)+"] "+this.name+": "+this.value}ev(t){return new Hn.Tree.Rule(this.name,this.value.ev(t),this.index,this.filename)}},Hn.Tree.Ruleset=class{constructor(t,e){this.is="ruleset",this.selectors=t,this.rules=e,this._lookups={}}ev(t){var e,r,i=new Hn.Tree.Ruleset(this.selectors,this.rules.slice(0));for(i.root=this.root,t.frames.unshift(i),e=0;e<i.rules.length;e++)r=i.rules[e],i.rules[e]=r.ev?r.ev(t):r;return t.frames.shift(),i}match(t){return!t||0===t.length}variables(){return this._variables?this._variables:this._variables=this.rules.reduce(function(t,e){return e instanceof Hn.Tree.Rule&&!0===e.variable&&(t[e.name]=e),t},{})}variable(t){return this.variables()[t]}rulesets(){return this._rulesets?this._rulesets:this._rulesets=this.rules.filter(function(t){return t instanceof Hn.Tree.Ruleset})}find(t,e){e=e||this;var r=[],i=t.toString();return i in this._lookups?this._lookups[i]:(this.rulesets().forEach(function(i){if(i!==e)for(var s=0;s<i.selectors.length;s++)if(t.match(i.selectors[s])){t.elements.length>1?Array.prototype.push.apply(r,i.find(new Hn.Tree.Selector(null,null,t.elements.slice(1)),e)):r.push(i);break}}),this._lookups[i]=r)}evZooms(t){for(var e=0;e<this.selectors.length;e++){for(var r=Hn.Tree.Zoom.all,i=0;i<this.selectors[e].zoom.length;i++)r=this.selectors[e].zoom[i].ev(t).zoom;this.selectors[e].zoom=r}}flatten(t,e,r){var i,s,n=[];for(0===this.selectors.length&&(r.frames=r.frames.concat(this.rules)),this.evZooms(r),i=0;i<this.selectors.length;i++){var a=this.selectors[i];if(a.filters)if(e.length)for(s=0;s<e.length;s++){var o=e[s],l=o.filters.cloneWith(a.filters);if(null===l){if(o.zoom===a.zoom&&o.attachment===a.attachment&&o.elements.join()===a.elements.join()){n.push(o);continue}l=o.filters}else if(!l)continue;var h=Object.create(Hn.Tree.Selector.prototype);h.filters=l,h.zoom=a.zoom,h.elements=o.elements.concat(a.elements),o.attachment&&a.attachment?h.attachment=o.attachment+"/"+a.attachment:h.attachment=a.attachment||o.attachment,h.conditions=o.conditions+a.conditions,h.index=a.index,n.push(h)}else n.push(a)}var u=[];for(i=0;i<this.rules.length;i++){var c=this.rules[i];c instanceof Hn.Tree.Ruleset?c.flatten(t,n,r):c instanceof Hn.Tree.Rule?u.push(c):c instanceof Hn.Tree.Invalid&&r.error(c)}var d=!!u.length&&u[0].index;for(i=0;i<n.length;i++)!1!==d&&(n[i].index=d),t.push(new Hn.Tree.Definition(n[i],u.slice()));return t}},Hn.Tree.Selector=class{constructor(t,e,r,i,s,n){this.elements=r||[],this.attachment=i,this.filters=t||{},this.zoom=void 0!==e?e:Hn.Tree.Zoom.all,this.conditions=s,this.index=n}specificity(){return this.elements.reduce(function(t,e){var r=e.specificity();return t[0]+=r[0],t[1]+=r[1],t},[0,0,this.conditions,this.index])}},Hn.Tree.URL=class{constructor(t,e){this.is="uri",this.value=t,this.paths=e}toString(){return this.value.toString()}ev(t){return new Hn.Tree.URL(this.value.ev(t),this.paths)}},Hn.Tree.Value=class{constructor(t){this.is="value",this.value=t}ev(t){return 1===this.value.length?this.value[0].ev(t):new Hn.Tree.Value(this.value.map(function(e){return e.ev(t)}))}toJS(t){var e=this.ev(t),r=e.toString();return"color"===e.is||"uri"===e.is||"string"===e.is||"keyword"===e.is?r="'"+r+"'":"field"===e.is?r=r.replace(/\[(.*)\]/g,"attributes['_match1']"):e.value&&"object"==typeof e.value&&(r="["+r+"]"),"_value = "+r+";"}toString(t,e,r,i){return this.value.map(function(e){return e.toString(t,i)}).join(r||", ")}clone(){var t=Object.create(Hn.Tree.Value.prototype);return Array.isArray(t)?t.value=this.value.slice():t.value=this.value,t.is=this.is,t}},Hn.Tree.Variable=class{constructor(t,e,r){this.is="variable",this.name=t,this.index=e,this.filename=r}toString(){return this.name}ev(t){if(this._css)return this._css;var e=t.frames.filter(function(t){return t.name===this.name}.bind(this));return e.length?e[0].value.ev(t):(t.error({message:"variable "+this.name+" is undefined",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"})}},Hn.Tree.Zoom=class{constructor(t,e,r){this.op=t,this.value=e,this.index=r}setZoom(t){return this.zoom=t,this}ev(t){var e=parseInt(this.value.ev(t).toString(),10);switch((e>Hn.Tree.Zoom.maxZoom||e<0)&&t.error({message:"Only zoom levels between 0 and "+Hn.Tree.Zoom.maxZoom+" supported.",index:this.index}),this.op){case"=":return this.zoom="zoom && zoom === "+e,this;case">":this.zoom="zoom && zoom > "+e;break;case">=":this.zoom="zoom && zoom >= "+e;break;case"<":this.zoom="zoom && zoom < "+e;break;case"<=":this.zoom="zoom && zoom <= "+e}return this}toString(){for(var t="",e=0;e<=Hn.Tree.Zoom.maxZoom;e++)t+=this.zoom&1<<e?"X":".";return t}},Hn.Tree.Zoom.all=23,Hn.Tree.Zoom.maxZoom=22,Hn.Tree.Zoom.ranges={0:1e9,1:5e8,2:2e8,3:1e8,4:5e7,5:25e6,6:125e5,7:65e5,8:3e6,9:15e5,10:75e4,11:4e5,12:2e5,13:1e5,14:5e4,15:25e3,16:12500,17:5e3,18:2500,19:1500,20:750,21:500,22:250,23:100};class Yn{constructor(t){t=t||{},this.fill=!0,this.fillColor="#000000",this.fillOpacity=1,this.stroke=!1,this.strokeColor="#000000",this.strokeOpacity=1,this.strokeWidth=1,this.strokeLinecap="butt",this.strokeLineJoin="miter",this.strokeDashstyle="solid",this.pointRadius=6,this.shadowBlur=0,this.shadowColor="#000000",this.shadowOffsetX=0,this.shadowOffsetY=0,this.label="",this.labelRect=!1,this.fontColor="",this.fontSize=12,this.fontStyle="normal",this.fontVariant="normal",this.fontWeight="normal",this.fontFamily="arial,sans-serif",this.labelPosition="top",this.labelAlign="center",this.labelBaseline="middle",this.labelXOffset=0,this.labelYOffset=0,rt.extend(this,t)}}class Xn{constructor(){this.refOriginalPosition=[0,0],this.refDataID=null,this.isHoverByRefDataID=!1,this.refDataHoverGroup=null,this.dataInfo=null,this.clickable=!0,this.hoverable=!0,this.style=null,this.highlightStyle={},this.CLASS_NAME="SuperMap.Feature.ShapeParameters"}destroy(){this.refOriginalPosition=null,this.refDataID=null,this.isHoverByRefDataID=null,this.refDataHoverGroup=null,this.dataInfo=null,this.clickable=null,this.hoverable=null,this.style=null,this.highlightStyle=null}}class Qn extends Xn{constructor(t,e){super(t,e),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=6,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Point"}destroy(){this.x=null,this.y=null,this.r=null,super.destroy()}}class Zn extends Xn{constructor(t){super(t),this.pointList=t,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Line"}destroy(){this.pointList=null,super.destroy()}}class Kn extends Xn{constructor(t){super(t),this.pointList=t,this.holePolygonPointLists=null,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Polygon"}destroy(){this.pointList=null,this.holePolygonPointLists=null,super.destroy()}}class $n extends Xn{constructor(t,e,r,i){super(t,e,r,i),this.x=isNaN(t)?0:t,this.y=isNaN(t)?0:e,this.width=isNaN(r)?0:r,this.height=isNaN(i)?0:i,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Rectangle"}destroy(){this.x=null,this.y=null,this.width=null,this.height=null,super.destroy()}}class ta extends Xn{constructor(t,e,r,i,s,n,a){super(t,e,r,i,s,n,a),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=isNaN(r)?0:r,this.startAngle=isNaN(i)?0:i,this.endAngle=isNaN(s)?0:s,this.r0=isNaN(n)?0:n,this.clockWise=a,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Sector"}destroy(){this.x=null,this.y=null,this.r=null,this.startAngle=null,this.endAngle=null,this.r0=null,this.clockWise=null,super.destroy()}}class ea extends Xn{constructor(t,e,r){super(t,e,r),this.x=t,this.y=e,this.text=r,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Label"}destroy(){this.x=null,this.y=null,this.text=null,super.destroy()}}class ra extends Xn{constructor(t,e,r,i,s,n,a,o,l){super(t,e,r,i,s,n,a,o,l),this.x=t,this.y=e,this.image=r,this.width=i,this.height=s,this.sx=n,this.sy=a,this.sWidth=o,this.sHeight=l,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Image"}destroy(){this.x=null,this.y=null,this.image=null,this.width=null,this.height=null,this.sx=null,this.sy=null,this.sWidth=null,this.sHeight=null,super.destroy()}}class ia extends Xn{constructor(t,e,r){super(t,e,r),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.r=isNaN(r)?0:r,this.CLASS_NAME="SuperMap.Feature.ShapeParameters.Circle"}destroy(){this.x=null,this.y=null,this.r=null,super.destroy()}}class sa{constructor(){this._handlers={},this.CLASS_NAME="SuperMap.LevelRenderer.Eventful"}destroy(){this._handlers=null}one(t,e,r){var i=this._handlers;return e&&t?(i[t]||(i[t]=[]),i[t].push({h:e,one:!0,ctx:r||this}),this):this}bind(t,e,r){var i=this._handlers;return e&&t?(i[t]||(i[t]=[]),i[t].push({h:e,one:!1,ctx:r||this}),this):this}unbind(t,e){var r=this._handlers;if(!t)return this._handlers={},this;if(e){if(r[t]){for(var i=[],s=0,n=r[t].length;s<n;s++)r[t][s].h!=e&&i.push(r[t][s]);r[t]=i}r[t]&&0===r[t].length&&delete r[t]}else delete r[t];return this}dispatch(t){if(this._handlers[t]){var e=arguments,r=e.length;r>3&&(e=Array.prototype.slice.call(e,1));for(var i=this._handlers[t],s=i.length,n=0;n<s;){switch(r){case 1:i[n].h.call(i[n].ctx);break;case 2:i[n].h.call(i[n].ctx,e[1]);break;case 3:i[n].h.call(i[n].ctx,e[1],e[2]);break;default:i[n].h.apply(i[n].ctx,e)}i[n].one?(i.splice(n,1),s--):n++}}return this}dispatchWithContext(t){if(this._handlers[t]){var e=arguments,r=e.length;r>4&&(e=Array.prototype.slice.call(e,1,e.length-1));for(var i=e[e.length-1],s=this._handlers[t],n=s.length,a=0;a<n;){switch(r){case 1:s[a].h.call(i);break;case 2:s[a].h.call(i,e[1]);break;case 3:s[a].h.call(i,e[1],e[2]);break;default:s[a].h.apply(i,e)}s[a].one?(s.splice(a,1),n--):a++}}return this}}class na{constructor(){this.ArrayCtor="undefined"==typeof Float32Array?Array:Float32Array,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Vector"}create(t,e){var r=new(0,this.ArrayCtor)(2);return r[0]=t||0,r[1]=e||0,r}copy(t,e){return t[0]=e[0],t[1]=e[1],t}set(t,e,r){return t[0]=e,t[1]=r,t}add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}scaleAndAdd(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}sub(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}len(t){return Math.sqrt(this.lenSquare(t))}lenSquare(t){return t[0]*t[0]+t[1]*t[1]}mul(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}div(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}dot(t,e){return t[0]*e[0]+t[1]*e[1]}scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}normalize(t,e){var r=this.len(e);return 0===r?(t[0]=0,t[1]=0):(t[0]=e[0]/r,t[1]=e[1]/r),t}distance(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}distanceSquare(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}lerp(t,e,r,i){return t[0]=e[0]+i*(r[0]-e[0]),t[1]=e[1]+i*(r[1]-e[1]),t}applyTransform(t,e,r){var i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}length(t){return this.len(t)}lengthSquare(t){return this.lenSquare(t)}dist(t,e){return this.distance(t,e)}distSquare(t,e){return this.distanceSquare(t,e)}}class aa{constructor(){this.vector=new na,this.EPSILON=1e-4,this.THREE_SQRT=Math.sqrt(3),this.ONE_THIRD=1/3,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Curve"}isAroundZero(t){return t>-this.EPSILON&&t<this.EPSILON}isNotAroundZero(t){return t>this.EPSILON||t<-this.EPSILON}cubicAt(t,e,r,i,s){var n=1-s;return n*n*(n*t+3*s*e)+s*s*(s*i+3*n*r)}cubicDerivativeAt(t,e,r,i,s){var n=1-s;return 3*(((e-t)*n+2*(r-e)*s)*n+(i-r)*s*s)}cubicRootAt(t,e,r,i,s,n){var a=i+3*(e-r)-t,o=3*(r-2*e+t),l=3*(e-t),h=t-s,u=o*o-3*a*l,c=o*l-9*a*h,d=l*l-3*o*h,p=0;if(this.isAroundZero(u)&&this.isAroundZero(c))if(this.isAroundZero(o))n[0]=0;else{let t=-l/o;t>=0&&t<=1&&(n[p++]=t)}else{var f=c*c-4*u*d;if(this.isAroundZero(f)){var m=c/u;let t=-o/a+m,e=-m/2;t>=0&&t<=1&&(n[p++]=t),e>=0&&e<=1&&(n[p++]=e)}else if(f>0){let t=Math.sqrt(f),e=u*o+1.5*a*(-c+t),r=u*o+1.5*a*(-c-t),i=(-o-((e=e<0?-Math.pow(-e,this.ONE_THIRD):Math.pow(e,this.ONE_THIRD))+(r=r<0?-Math.pow(-r,this.ONE_THIRD):Math.pow(r,this.ONE_THIRD))))/(3*a);i>=0&&i<=1&&(n[p++]=i)}else{var y=(2*u*o-3*a*c)/(2*Math.sqrt(u*u*u)),g=Math.acos(y)/3,v=Math.sqrt(u),b=Math.cos(g);let t=(-o-2*v*b)/(3*a),e=(-o+v*(b+this.THREE_SQRT*Math.sin(g)))/(3*a),r=(-o+v*(b-this.THREE_SQRT*Math.sin(g)))/(3*a);t>=0&&t<=1&&(n[p++]=t),e>=0&&e<=1&&(n[p++]=e),r>=0&&r<=1&&(n[p++]=r)}}return p}cubicExtrema(t,e,r,i,s){var n=6*r-12*e+6*t,a=9*e+3*i-3*t-9*r,o=3*e-3*t,l=0;if(this.isAroundZero(a)){if(this.isNotAroundZero(n)){let t=-o/n;t>=0&&t<=1&&(s[l++]=t)}}else{var h=n*n-4*a*o;if(this.isAroundZero(h))s[0]=-n/(2*a);else if(h>0){let t=Math.sqrt(h),e=(-n+t)/(2*a),r=(-n-t)/(2*a);e>=0&&e<=1&&(s[l++]=e),r>=0&&r<=1&&(s[l++]=r)}}return l}cubicSubdivide(t,e,r,i,s,n){var a=(e-t)*s+t,o=(r-e)*s+e,l=(i-r)*s+r,h=(o-a)*s+a,u=(l-o)*s+o,c=(u-h)*s+h;n[0]=t,n[1]=a,n[2]=h,n[3]=c,n[4]=c,n[5]=u,n[6]=l,n[7]=i}cubicProjectPoint(t,e,r,i,s,n,a,o,l,h,u){var c,d=this.vector.create(),p=this.vector.create(),f=this.vector.create(),m=.005,y=1/0;d[0]=l,d[1]=h;for(let l=0;l<1;l+=.05){p[0]=this.cubicAt(t,r,s,a,l),p[1]=this.cubicAt(e,i,n,o,l);let h=this.vector.distSquare(d,p);h<y&&(c=l,y=h)}y=1/0;for(let l=0;l<32&&!(m<this.EPSILON);l++){let l=c-m,h=c+m;p[0]=this.cubicAt(t,r,s,a,l),p[1]=this.cubicAt(e,i,n,o,l);let u=this.vector.distSquare(p,d);if(l>=0&&u<y)c=l,y=u;else{f[0]=this.cubicAt(t,r,s,a,h),f[1]=this.cubicAt(e,i,n,o,h);let l=this.vector.distSquare(f,d);h<=1&&l<y?(c=h,y=l):m*=.5}}return u&&(u[0]=this.cubicAt(t,r,s,a,c),u[1]=this.cubicAt(e,i,n,o,c)),Math.sqrt(y)}quadraticAt(t,e,r,i){var s=1-i;return s*(s*t+2*i*e)+i*i*r}quadraticDerivativeAt(t,e,r,i){return 2*((1-i)*(e-t)+i*(r-e))}quadraticRootAt(t,e,r,i,s){var n=t-2*e+r,a=2*(e-t),o=t-i,l=0;if(this.isAroundZero(n)){if(this.isNotAroundZero(a)){var h=-o/a;h>=0&&h<=1&&(s[l++]=h)}}else{var u=a*a-4*n*o;if(this.isAroundZero(u)){let t=-a/(2*n);t>=0&&t<=1&&(s[l++]=t)}else if(u>0){let t=Math.sqrt(u),e=(-a+t)/(2*n),r=(-a-t)/(2*n);e>=0&&e<=1&&(s[l++]=e),r>=0&&r<=1&&(s[l++]=r)}}return l}quadraticExtremum(t,e,r){var i=t+r-2*e;return 0===i?.5:(t-e)/i}quadraticProjectPoint(t,e,r,i,s,n,a,o,l){var h,u=this.vector.create(),c=this.vector.create(),d=this.vector.create(),p=.005,f=1/0;u[0]=a,u[1]=o;for(let a=0;a<1;a+=.05){c[0]=this.quadraticAt(t,r,s,a),c[1]=this.quadraticAt(e,i,n,a);let o=this.vector.distSquare(u,c);o<f&&(h=a,f=o)}f=1/0;for(let a=0;a<32&&!(p<this.EPSILON);a++){let a=h-p,o=h+p;c[0]=this.quadraticAt(t,r,s,a),c[1]=this.quadraticAt(e,i,n,a);let l=this.vector.distSquare(c,u);if(a>=0&&l<f)h=a,f=l;else{d[0]=this.quadraticAt(t,r,s,o),d[1]=this.quadraticAt(e,i,n,o);let a=this.vector.distSquare(d,u);o<=1&&a<f?(h=o,f=a):p*=.5}}return l&&(l[0]=this.quadraticAt(t,r,s,h),l[1]=this.quadraticAt(e,i,n,h)),Math.sqrt(f)}}class oa{}oa.EVENT={RESIZE:"resize",CLICK:"click",DBLCLICK:"dblclick",MOUSEWHEEL:"mousewheel",MOUSEMOVE:"mousemove",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",GLOBALOUT:"globalout",DRAGSTART:"dragstart",DRAGEND:"dragend",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",touchClickDelay:300},oa.catchBrushException=!1,oa.debugMode=0;class la{static SUtil_smoothBezier(t,e,r,i,s){s&&2===s.length||(s=[0,0]);var n,a,o=s,l=[],h=[],u=[],c=[],d=!!i;if(d){n=[1/0,1/0],a=[-1/0,-1/0];let e=t.length;for(let r=0;r<e;r++)la.Util_vector.min(n,n,[t[r][0]+o[0],t[r][1]+o[1]]),la.Util_vector.max(a,a,[t[r][0]+o[0],t[r][1]+o[1]]);la.Util_vector.min(n,n,i[0]),la.Util_vector.max(a,a,i[1])}let p=t.length;for(let i=0;i<p;i++){let s,f,m=[t[i][0]+o[0],t[i][1]+o[1]];if(r)s=[t[i?i-1:p-1][0]+o[0],t[i?i-1:p-1][1]+o[1]],f=[t[(i+1)%p][0]+o[0],t[(i+1)%p][1]+o[1]];else{if(0===i||i===p-1){l.push([t[i][0]+o[0],t[i][1]+o[1]]);continue}s=[t[i-1][0]+o[0],t[i-1][1]+o[1]],f=[t[i+1][0]+o[0],t[i+1][1]+o[1]]}la.Util_vector.sub(h,f,s),la.Util_vector.scale(h,h,e);let y=la.Util_vector.distance(m,s),g=la.Util_vector.distance(m,f),v=y+g;0!==v&&(y/=v,g/=v),la.Util_vector.scale(u,h,-y),la.Util_vector.scale(c,h,g);let b=la.Util_vector.add([],m,u),S=la.Util_vector.add([],m,c);d&&(la.Util_vector.max(b,b,n),la.Util_vector.min(b,b,a),la.Util_vector.max(S,S,n),la.Util_vector.min(S,S,a)),l.push(b),l.push(S)}return r&&l.push(l.shift()),l}static SUtil_smoothSpline(t,e,r,i){i&&2===i.length||(i=[0,0]);var s=i,n=t.length,a=[],o=0;for(let e=1;e<n;e++)o+=la.Util_vector.distance([t[e-1][0]+s[0],t[e-1][1]+s[1]],[t[e][0]+s[0],t[e][1]+s[1]]);var l=o/5;l=l<n?n:l;for(let r=0;r<l;r++){let i,o,u,c=r/(l-1)*(e?n:n-1),d=Math.floor(c),p=c-d,f=[t[d%n][0]+s[0],t[d%n][1]+s[1]];e?(i=[t[(d-1+n)%n][0]+s[0],t[(d-1+n)%n][1]+s[1]],o=[t[(d+1)%n][0]+s[0],t[(d+1)%n][1]+s[1]],u=[t[(d+2)%n][0]+s[0],t[(d+2)%n][1]+s[1]]):(i=[t[0===d?d:d-1][0]+s[0],t[0===d?d:d-1][1]+s[1]],o=[t[d>n-2?n-1:d+1][0]+s[0],t[d>n-2?n-1:d+1][1]+s[1]],u=[t[d>n-3?n-1:d+2][0]+s[0],t[d>n-3?n-1:d+2][1]+s[1]]);let m=p*p,y=p*m;a.push([h(i[0],f[0],o[0],u[0],p,m,y),h(i[1],f[1],o[1],u[1],p,m,y)])}return a;function h(t,e,r,i,s,n,a){var o=.5*(r-t),l=.5*(i-e);return(2*(e-r)+o+l)*a+(-3*(e-r)-2*o-l)*n+o*s+e}}static SUtil_dashedLineTo(t,e,r,i,s,n,a){var o=[5,5];if(n="number"!=typeof n?5:n,t.setLineDash)return o[0]=n,o[1]=n,a&&a instanceof Array?t.setLineDash(a):t.setLineDash(o),t.moveTo(e,r),void t.lineTo(i,s);var l=i-e,h=s-r,u=Math.floor(Math.sqrt(l*l+h*h)/n);l/=u,h/=u;for(var c=!0,d=0;d<u;++d)c?t.moveTo(e,r):t.lineTo(e,r),c=!c,e+=l,r+=h;t.lineTo(i,s)}}la.Util_area=new class{constructor(){this.util=new Bn,this.curve=new aa,this._ctx=null,this._textWidthCache={},this._textHeightCache={},this._textWidthCacheCounter=0,this._textHeightCacheCounter=0,this.TEXT_CACHE_MAX=5e3,this.PI2=2*Math.PI,this.roots=[-1,-1,-1],this.extrema=[-1,-1],this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Area"}normalizeRadian(t){return(t%=this.PI2)<0&&(t+=this.PI2),t}isInside(t,e,r,i){if(!e||!t)return!1;var s=t.type;this._ctx=this._ctx||this.util.getContext();var n=this._mathMethod(t,e,r,i);if(void 0!==n)return n;if(t.buildPath&&this._ctx.isPointInPath)return this._buildPathMethod(t,this._ctx,e,r,i);switch(s){case"ellipse":case"smicellipse":return!0;case"trochoid":var a="out"==e.location?e.r1+e.r2+e.d:e.r1-e.r2+e.d;return this.isInsideCircle(e,r,i,a);case"rose":return this.isInsideCircle(e,r,i,e.maxr);default:return!1}}_mathMethod(t,e,r,i){switch(t.type){case"bezier-curve":return void 0===e.cpX2?this.isInsideQuadraticStroke(e.xStart,e.yStart,e.cpX1,e.cpY1,e.xEnd,e.yEnd,e.lineWidth,r,i):this.isInsideCubicStroke(e.xStart,e.yStart,e.cpX1,e.cpY1,e.cpX2,e.cpY2,e.xEnd,e.yEnd,e.lineWidth,r,i);case"line":return this.isInsideLine(e.xStart,e.yStart,e.xEnd,e.yEnd,e.lineWidth,r,i);case"broken-line":return this.isInsideBrokenLine(e.pointList,e.lineWidth,r,i);case"smicbroken-line":{let s=r,n=i;return t.refOriginalPosition&&(s=r-t.refOriginalPosition[0],n=i-t.refOriginalPosition[1]),this.isInsideBrokenLine(e.pointList,e.lineWidth,s,n)}case"ring":return this.isInsideRing(e.x,e.y,e.r0,e.r,r,i);case"smicring":{let s=e.x,n=e.y;return t.refOriginalPosition&&(s=e.x+t.refOriginalPosition[0],n=e.y+t.refOriginalPosition[1]),this.isInsideRing(s,n,e.r0,e.r,r,i)}case"circle":return this.isInsideCircle(e.x,e.y,e.r,r,i);case"smicpoint":{let s=r,n=i;return t.refOriginalPosition&&(s=r-t.refOriginalPosition[0],n=i-t.refOriginalPosition[1]),this.isInsideCircle(e.x,e.y,e.r,s,n)}case"sector":{let t=e.startAngle*Math.PI/180,s=e.endAngle*Math.PI/180;return e.clockWise||(t=-t,s=-s),this.isInsideSector(e.x,e.y,e.r0,e.r,t,s,!e.clockWise,r,i)}case"smicsector":{let s=e.startAngle*Math.PI/180,n=e.endAngle*Math.PI/180;e.clockWise||(s=-s,n=-n);let a=e.x,o=e.y;return t.refOriginalPosition&&(a=e.x+t.refOriginalPosition[0],o=e.y+t.refOriginalPosition[1]),this.isInsideSector(a,o,e.r0,e.r,s,n,!e.clockWise,r,i)}case"path":return this.isInsidePath(e.pathArray,Math.max(e.lineWidth,5),e.brushType,r,i);case"polygon":case"star":case"smicstar":case"isogon":case"smicisogon":return this.isInsidePolygon(e.pointList,r,i);case"smicpolygon":{let u=r,c=i;if(t.refOriginalPosition&&(u=r-t.refOriginalPosition[0],c=i-t.refOriginalPosition[1]),t.holePolygonPointLists&&t.holePolygonPointLists.length>0){for(var s=this.isInsidePolygon(e.pointList,u,c),n=t.holePolygonPointLists,a=!1,o=0,l=n.length;o<l;o++){var h=n[o];!0===this.isInsidePolygon(h,u,c)&&(a=!0)}return!0===s&&!1===a}return this.isInsidePolygon(e.pointList,u,c)}case"text":var u=e.__rect||t.getRect(e);return this.isInsideRect(u.x,u.y,u.width,u.height,r,i);case"smictext":var c=t.getTextBackground(e);return this.isInsidePolygon(c,r,i);case"rectangle":case"image":return this.isInsideRect(e.x,e.y,e.width,e.height,r,i);case"smicimage":{let s=e.x,n=e.y;return t.refOriginalPosition&&(s=e.x+t.refOriginalPosition[0],n=e.y+t.refOriginalPosition[1]),this.isInsideRect(s,n,e.width,e.height,r,i)}}}_buildPathMethod(t,e,r,i,s){return e.beginPath(),t.buildPath(e,r),e.closePath(),e.isPointInPath(i,s)}isOutside(t,e,r,i){return!this.isInside(t,e,r,i)}isInsideLine(t,e,r,i,s,n,a){if(0===s)return!1;var o=Math.max(s,5),l=0;if(a>e+o&&a>i+o||a<e-o&&a<i-o||n>t+o&&n>r+o||n<t-o&&n<r-o)return!1;if(t===r)return Math.abs(n-t)<=o/2;var h=(l=(e-i)/(t-r))*n-a+(t*i-r*e)/(t-r);return h*h/(l*l+1)<=o/2*o/2}isInsideCubicStroke(t,e,r,i,s,n,a,o,l,h,u){if(0===l)return!1;var c=Math.max(l,5);return!(u>e+c&&u>i+c&&u>n+c&&u>o+c||u<e-c&&u<i-c&&u<n-c&&u<o-c||h>t+c&&h>r+c&&h>s+c&&h>a+c||h<t-c&&h<r-c&&h<s-c&&h<a-c)&&this.curve.cubicProjectPoint(t,e,r,i,s,n,a,o,h,u,null)<=c/2}isInsideQuadraticStroke(t,e,r,i,s,n,a,o,l){if(0===a)return!1;var h=Math.max(a,5);return!(l>e+h&&l>i+h&&l>n+h||l<e-h&&l<i-h&&l<n-h||o>t+h&&o>r+h&&o>s+h||o<t-h&&o<r-h&&o<s-h)&&this.curve.quadraticProjectPoint(t,e,r,i,s,n,o,l,null)<=h/2}isInsideArcStroke(t,e,r,i,s,n,a,o,l){var h=this.PI2;if(0===a)return!1;var u=Math.max(a,5);o-=t,l-=e;var c=Math.sqrt(o*o+l*l);if(c-u>r||c+u<r)return!1;if(Math.abs(i-s)>=h)return!0;if(n){var d=i;i=this.normalizeRadian(s),s=this.normalizeRadian(d)}else i=this.normalizeRadian(i),s=this.normalizeRadian(s);i>s&&(s+=h);var p=Math.atan2(l,o);return p<0&&(p+=h),p>=i&&p<=s||p+h>=i&&p+h<=s}isInsideBrokenLine(t,e,r,i){for(var s=Math.max(e,10),n=0,a=t.length-1;n<a;n++){var o=t[n][0],l=t[n][1],h=t[n+1][0],u=t[n+1][1];if(this.isInsideLine(o,l,h,u,s,r,i))return!0}return!1}isInsideRing(t,e,r,i,s,n){var a=(s-t)*(s-t)+(n-e)*(n-e);return a<i*i&&a>r*r}isInsideRect(t,e,r,i,s,n){return s>=t&&s<=t+r&&n>=e&&n<=e+i}isInsideCircle(t,e,r,i,s){return(i-t)*(i-t)+(s-e)*(s-e)<r*r}isInsideSector(t,e,r,i,s,n,a,o,l){return this.isInsideArcStroke(t,e,(r+i)/2,s,n,a,i-r,o,l)}isInsidePolygon(t,e,r){for(var i=t.length,s=0,n=0,a=i-1;n<i;n++){var o=t[a][0],l=t[a][1],h=t[n][0],u=t[n][1];s+=this.windingLine(o,l,h,u,e,r),a=n}return 0!==s}windingLine(t,e,r,i,s,n){return n>e&&n>i||n<e&&n<i?0:i==e?0:(n-e)/(i-e)*(r-t)+t>s?i<e?1:-1:0}swapExtrema(){var t=this.extrema[0];this.extrema[0]=this.extrema[1],this.extrema[1]=t}windingCubic(t,e,r,i,s,n,a,o,l,h){var u=this.curve,c=this.roots,d=this.extrema;if(h>e&&h>i&&h>n&&h>o||h<e&&h<i&&h<n&&h<o)return 0;var p=u.cubicRootAt(e,i,n,o,h,c);if(0===p)return 0;for(var f,m,y=0,g=-1,v=0;v<p;v++){var b=c[v];u.cubicAt(t,r,s,a,b)<l||(g<0&&(g=u.cubicExtrema(e,i,n,o,d),d[1]<d[0]&&g>1&&this.swapExtrema(),f=u.cubicAt(e,i,n,o,d[0]),g>1&&(m=u.cubicAt(e,i,n,o,d[1]))),2==g?b<d[0]?y+=f<e?1:-1:b<d[1]?y+=m<f?1:-1:y+=o<m?1:-1:b<d[0]?y+=f<e?1:-1:y+=o<f?1:-1)}return y}windingQuadratic(t,e,r,i,s,n,a,o){var l=this.curve,h=this.roots;if(o>e&&o>i&&o>n||o<e&&o<i&&o<n)return 0;var u=l.quadraticRootAt(e,i,n,o,h);if(0===u)return 0;var c=l.quadraticExtremum(e,i,n);if(c>=0&&c<=1){var d=0,p=l.quadraticAt(e,i,n,c);for(let i=0;i<u;i++)l.quadraticAt(t,r,s,h[i])>a||(h[i]<c?d+=p<e?1:-1:d+=n<p?1:-1);return d}return l.quadraticAt(t,r,s,h[0])>a?0:n<e?1:-1}windingArc(t,e,r,i,s,n,a,o){var l=this.roots,h=this.PI2;if((o-=e)>r||o<-r)return 0;let u=Math.sqrt(r*r-o*o);if(l[0]=-u,l[1]=u,Math.abs(i-s)>=h){i=0,s=h;var c=n?1:-1;return a>=l[0]+t&&a<=l[1]+t?c:0}if(n){let t=i;i=this.normalizeRadian(s),s=this.normalizeRadian(t)}else i=this.normalizeRadian(i),s=this.normalizeRadian(s);i>s&&(s+=h);var d=0;for(let e=0;e<2;e++){var p=l[e];if(p+t>a){let t=Math.atan2(o,p),e=n?1:-1;t<0&&(t=h+t),(t>=i&&t<=s||t+h>=i&&t+h<=s)&&(t>Math.PI/2&&t<1.5*Math.PI&&(e=-e),d+=e)}}return d}isInsidePath(t,e,r,i,s){for(var n=0,a=0,o=0,l=0,h=0,u=!0,c=!0,d="stroke"===(r=r||"fill")||"both"===r,p="fill"===r||"both"===r,f=0;f<t.length;f++){var m=t[f],y=m.points;if(u||"M"===m.command){if(f>0&&(p&&(n+=this.windingLine(a,o,l,h,i,s)),0!==n))return!0;l=y[y.length-2],h=y[y.length-1],u=!1,c&&"A"!==m.command&&(c=!1,a=l,o=h)}switch(m.command){case"M":a=y[0],o=y[1];break;case"L":if(d&&this.isInsideLine(a,o,y[0],y[1],e,i,s))return!0;p&&(n+=this.windingLine(a,o,y[0],y[1],i,s)),a=y[0],o=y[1];break;case"C":if(d&&this.isInsideCubicStroke(a,o,y[0],y[1],y[2],y[3],y[4],y[5],e,i,s))return!0;p&&(n+=this.windingCubic(a,o,y[0],y[1],y[2],y[3],y[4],y[5],i,s)),a=y[4],o=y[5];break;case"Q":if(d&&this.isInsideQuadraticStroke(a,o,y[0],y[1],y[2],y[3],e,i,s))return!0;p&&(n+=this.windingQuadratic(a,o,y[0],y[1],y[2],y[3],i,s)),a=y[2],o=y[3];break;case"A":var g=y[0],v=y[1],b=y[2],S=y[3],_=y[4],x=y[5],w=Math.cos(_)*b+g,C=Math.sin(_)*S+v;c?(c=!1,l=w,h=C):n+=this.windingLine(a,o,w,C);var M=(i-g)*S/b+g;if(d&&this.isInsideArcStroke(g,v,S,_,_+x,1-y[7],e,M,s))return!0;p&&(n+=this.windingArc(g,v,S,_,_+x,1-y[7],M,s)),a=Math.cos(_+x)*b+g,o=Math.sin(_+x)*S+v;break;case"z":if(d&&this.isInsideLine(a,o,l,h,e,i,s))return!0;u=!0}}return p&&(n+=this.windingLine(a,o,l,h,i,s)),0!==n}getTextWidth(t,e){var r=t+":"+e;if(this._textWidthCache[r])return this._textWidthCache[r];this._ctx=this._ctx||this.util.getContext(),this._ctx.save(),e&&(this._ctx.font=e);for(var i=0,s=0,n=(t=(t+"").split("\n")).length;s<n;s++)i=Math.max(this._ctx.measureText(t[s]).width,i);return this._ctx.restore(),this._textWidthCache[r]=i,++this._textWidthCacheCounter>this.TEXT_CACHE_MAX&&(this._textWidthCacheCounter=0,this._textWidthCache={}),i}getTextHeight(t,e){var r=t+":"+e;if(this._textHeightCache[r])return this._textHeightCache[r];this._ctx=this._ctx||this.util.getContext(),this._ctx.save(),e&&(this._ctx.font=e),t=(t+"").split("\n");var i=(this._ctx.measureText("ZH").width+2)*t.length;return this._ctx.restore(),this._textHeightCache[r]=i,++this._textHeightCacheCounter>this.TEXT_CACHE_MAX&&(this._textHeightCacheCounter=0,this._textHeightCache={}),i}},la.Util_color=new Gn,la.Util_computeBoundingBox=new class{constructor(){3===arguments.length&&this.computeBoundingBox(arguments),this.CLASS_NAME="SuperMap.LevelRenderer.Tool.ComputeBoundingBox"}computeBoundingBox(t,e,r){if(0!==t.length){for(var i=t[0][0],s=t[0][0],n=t[0][1],a=t[0][1],o=1;o<t.length;o++){var l=t[o];l[0]<i&&(i=l[0]),l[0]>s&&(s=l[0]),l[1]<n&&(n=l[1]),l[1]>a&&(a=l[1])}e[0]=i,e[1]=n,r[0]=s,r[1]=a}}cubeBezier(t,e,r,i,s,n){var a=new aa,o=[];a.cubicExtrema(t[0],e[0],r[0],i[0],o);for(let s=0;s<o.length;s++)o[s]=a.cubicAt(t[0],e[0],r[0],i[0],o[s]);var l=[];a.cubicExtrema(t[1],e[1],r[1],i[1],l);for(let s=0;s<l.length;s++)l[s]=a.cubicAt(t[1],e[1],r[1],i[1],l[s]);o.push(t[0],i[0]),l.push(t[1],i[1]);var h=Math.min.apply(null,o),u=Math.max.apply(null,o),c=Math.min.apply(null,l),d=Math.max.apply(null,l);s[0]=h,s[1]=c,n[0]=u,n[1]=d}quadraticBezier(t,e,r,i,s){var n=new aa,a=n.quadraticExtremum(t[0],e[0],r[0]),o=n.quadraticExtremum(t[1],e[1],r[1]),l=1-(a=Math.max(Math.min(a,1),0)),h=1-(o=Math.max(Math.min(o,1),0)),u=l*l*t[0]+2*l*a*e[0]+a*a*r[0],c=l*l*t[1]+2*l*a*e[1]+a*a*r[1],d=h*h*t[0]+2*h*o*e[0]+o*o*r[0],p=h*h*t[1]+2*h*o*e[1]+o*o*r[1];i[0]=Math.min(t[0],r[0],u,d),i[1]=Math.min(t[1],r[1],c,p),s[0]=Math.max(t[0],r[0],u,d),s[1]=Math.max(t[1],r[1],c,p)}arc(t,e,r,i,s,n,a,o){var l=new na,h=l.create(),u=l.create(),c=l.create();if(h[0]=Math.cos(i)*r+t,h[1]=Math.sin(i)*r+e,u[0]=Math.cos(s)*r+t,u[1]=Math.sin(s)*r+e,l.min(a,h,u),l.max(o,h,u),(i%=2*Math.PI)<0&&(i+=2*Math.PI),(s%=2*Math.PI)<0&&(s+=2*Math.PI),i>s&&!n?s+=2*Math.PI:i<s&&n&&(i+=2*Math.PI),n){var d=s;s=i,i=d}for(var p=0;p<s;p+=Math.PI/2)p>i&&(c[0]=Math.cos(p)*r+t,c[1]=Math.sin(p)*r+e,l.min(a,c,a),l.max(o,c,o))}},la.Util_curve=new aa,la.Util_env=new class{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Env";var t,e,r,i,s,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_=this;return t=navigator.userAgent,e=_.os={},r=_.browser={},i=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),s=t.match(/(Android);?[\s\/]+([\d.]+)?/),n=t.match(/(iPad).*OS\s([\d_]+)/),a=t.match(/(iPod)(.*OS\s([\d_]+))?/),o=!n&&t.match(/(iPhone\sOS)\s([\d_]+)/),l=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),h=l&&t.match(/TouchPad/),u=t.match(/Kindle\/([\d.]+)/),c=t.match(/Silk\/([\d._]+)/),d=t.match(/(BlackBerry).*Version\/([\d.]+)/),p=t.match(/(BB10).*Version\/([\d.]+)/),f=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),m=t.match(/PlayBook/),y=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),g=t.match(/Firefox\/([\d.]+)/),v=t.match(/MSIE ([\d.]+)/),b=i&&t.match(/Mobile\//)&&!y,S=t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)&&!y,(r.webkit=!!i)&&(r.version=i[1]),s&&(e.android=!0,e.version=s[2]),o&&!a&&(e.ios=e.iphone=!0,e.version=o[2].replace(/_/g,".")),n&&(e.ios=e.ipad=!0,e.version=n[2].replace(/_/g,".")),a&&(e.ios=e.ipod=!0,e.version=a[3]?a[3].replace(/_/g,"."):null),l&&(e.webos=!0,e.version=l[2]),h&&(e.touchpad=!0),d&&(e.blackberry=!0,e.version=d[2]),p&&(e.bb10=!0,e.version=p[2]),f&&(e.rimtabletos=!0,e.version=f[2]),m&&(r.playbook=!0),u&&(e.kindle=!0,e.version=u[1]),c&&(r.silk=!0,r.version=c[1]),!c&&e.android&&t.match(/Kindle Fire/)&&(r.silk=!0),y&&(r.chrome=!0,r.version=y[1]),g&&(r.firefox=!0,r.version=g[1]),v&&(r.ie=!0,r.version=v[1]),b&&(t.match(/Safari/)||e.ios)&&(r.safari=!0),S&&(r.webview=!0),v&&(r.ie=!0,r.version=v[1]),e.tablet=!!(n||m||s&&!t.match(/Mobile/)||g&&t.match(/Tablet/)||v&&!t.match(/Phone/)&&t.match(/Touch/)),e.phone=!(e.tablet||e.ipod||!(s||o||l||d||p||y&&t.match(/Android/)||y&&t.match(/CriOS\/([\d.]+)/)||g&&t.match(/Mobile/)||v&&t.match(/Touch/))),{browser:r,os:e,canvasSupported:!!document.createElement("canvas").getContext}}destory(){return!0}},la.Util_event=new class{constructor(){this.stop="function"==typeof window.addEventListener?function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}:function(t){t.returnValue=!1,t.cancelBubble=!0},this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Event"}getX(t){return void 0!==t.zrenderX&&t.zrenderX||void 0!==t.offsetX&&t.offsetX||void 0!==t.layerX&&t.layerX||void 0!==t.clientX&&t.clientX}getY(t){return void 0!==t.zrenderY&&t.zrenderY||void 0!==t.offsetY&&t.offsetY||void 0!==t.layerY&&t.layerY||void 0!==t.clientY&&t.clientY}getDelta(t){return void 0!==t.zrenderDelta&&t.zrenderDelta||void 0!==t.wheelDelta&&t.wheelDelta||void 0!==t.detail&&-t.detail}},la.Util_http=new class{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Http"}get(t,e,r){if("object"==typeof t){var i=t;t=i.url,e=i.onsuccess,r=i.onerror}var s=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");s.open("GET",t,!0),s.onreadystatechange=function(){4==s.readyState&&(s.status>=200&&s.status<300||304===s.status?e&&e(s.responseText):r&&r(),s.onreadystatechange=new Function,s=null)},s.send(null)}},la.Util_log=new class{constructor(){return this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Log",function(){if(0!=+oa.debugMode)if(1==+oa.debugMode)for(let t in arguments)throw new Error(arguments[t]);else if(+oa.debugMode>1)for(let t in arguments)console.log(arguments[t])}}destory(){return!0}},la.Util_math=new class{constructor(){this._radians=window.Math.PI/180,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Math"}sin(t,e){return window.Math.sin(e?t*this._radians:t)}cos(t,e){return window.Math.cos(e?t*this._radians:t)}degreeToRadian(t){return t*this._radians}radianToDegree(t){return t/this._radians}},la.Util_matrix=new class{constructor(){this.ArrayCtor="undefined"==typeof Float32Array?Array:Float32Array,this.CLASS_NAME="SuperMap.LevelRenderer.Tool.Matrix"}create(){var t=new(0,this.ArrayCtor)(6);return this.identity(t),t}identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}mul(t,e,r){return t[0]=e[0]*r[0]+e[2]*r[1],t[1]=e[1]*r[0]+e[3]*r[1],t[2]=e[0]*r[2]+e[2]*r[3],t[3]=e[1]*r[2]+e[3]*r[3],t[4]=e[0]*r[4]+e[2]*r[5]+e[4],t[5]=e[1]*r[4]+e[3]*r[5]+e[5],t}translate(t,e,r){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+r[0],t[5]=e[5]+r[1],t}rotate(t,e,r){var i=e[0],s=e[2],n=e[4],a=e[1],o=e[3],l=e[5],h=Math.sin(r),u=Math.cos(r);return t[0]=i*u+a*h,t[1]=-i*h+a*u,t[2]=s*u+o*h,t[3]=-s*h+u*o,t[4]=u*n+h*l,t[5]=u*l-h*n,t}scale(t,e,r){var i=r[0],s=r[1];return t[0]=e[0]*i,t[1]=e[1]*s,t[2]=e[2]*i,t[3]=e[3]*s,t[4]=e[4]*i,t[5]=e[5]*s,t}invert(t,e){var r=e[0],i=e[2],s=e[4],n=e[1],a=e[3],o=e[5],l=r*a-n*i;return l?(l=1/l,t[0]=a*l,t[1]=-n*l,t[2]=-i*l,t[3]=r*l,t[4]=(i*o-a*s)*l,t[5]=(n*s-r*o)*l,t):null}mulVector(t,e,r){var i=e[0],s=e[2],n=e[4],a=e[1],o=e[3],l=e[5];return t[0]=r[0]*i+r[1]*s+n,t[1]=r[0]*a+r[1]*o+l,t}},la.Util=new Bn,la.Util_vector=new na;class ha{constructor(){var t;this.position=[0,0],this.rotation=[0,0,0],this.scale=[1,1,0,0],this.needLocalTransform=!1,this.needTransform=!1,this.CLASS_NAME="SuperMap.LevelRenderer.Transformable",this.lookAt=(t=la.Util_vector.create(),function(e){this.transform||(this.transform=la.Util_matrix.create());var r=this.transform;function i(t){return t>-5e-5&&t<5e-5}la.Util_vector.sub(t,e,this.position),i(t[0])&&i(t[1])||(la.Util_vector.normalize(t,t),r[2]=t[0]*this.scale[1],r[3]=t[1]*this.scale[1],r[0]=t[1]*this.scale[0],r[1]=-t[0]*this.scale[0],r[4]=this.position[0],r[5]=this.position[1],this.decomposeTransform())})}destroy(){this.position=null,this.rotation=null,this.scale=null,this.needLocalTransform=null,this.needTransform=null}updateNeedTransform(){function t(t){return t>5e-5||t<-5e-5}this.needLocalTransform=t(this.rotation[0])||t(this.position[0])||t(this.position[1])||t(this.scale[0]-1)||t(this.scale[1]-1)}updateTransform(){if(this.updateNeedTransform(),this.parent?this.needTransform=this.needLocalTransform||this.parent.needTransform:this.needTransform=this.needLocalTransform,this.needTransform){var t=[0,0],e=this.transform||la.Util_matrix.create();if(la.Util_matrix.identity(e),this.needLocalTransform){if(r(this.scale[0])||r(this.scale[1])){t[0]=-this.scale[2]||0,t[1]=-this.scale[3]||0;let i=r(t[0])||r(t[1]);i&&la.Util_matrix.translate(e,e,t),la.Util_matrix.scale(e,e,this.scale),i&&(t[0]=-t[0],t[1]=-t[1],la.Util_matrix.translate(e,e,t))}if(this.rotation instanceof Array){if(0!==this.rotation[0]){t[0]=-this.rotation[1]||0,t[1]=-this.rotation[2]||0;let i=r(t[0])||r(t[1]);i&&la.Util_matrix.translate(e,e,t),la.Util_matrix.rotate(e,e,this.rotation[0]),i&&(t[0]=-t[0],t[1]=-t[1],la.Util_matrix.translate(e,e,t))}}else 0!=+this.rotation&&la.Util_matrix.rotate(e,e,this.rotation);(r(this.position[0])||r(this.position[1]))&&la.Util_matrix.translate(e,e,this.position)}this.transform=e,this.parent&&this.parent.needTransform&&(this.needLocalTransform?la.Util_matrix.mul(this.transform,this.parent.transform,this.transform):la.Util_matrix.copy(this.transform,this.parent.transform))}function r(t){return t>5e-5||t<-5e-5}}setTransform(t){if(this.needTransform){var e=this.transform;t.transform(e[0],e[1],e[2],e[3],e[4],e[5])}}decomposeTransform(){if(this.transform){var t=this.transform,e=t[0]*t[0]+t[1]*t[1],r=this.position,i=this.scale,s=this.rotation;a(e-1)&&(e=Math.sqrt(e));var n=t[2]*t[2]+t[3]*t[3];a(n-1)&&(n=Math.sqrt(n)),r[0]=t[4],r[1]=t[5],i[0]=e,i[1]=n,i[2]=i[3]=0,s[0]=Math.atan2(-t[1]/n,t[0]/e),s[1]=s[2]=0}function a(t){return t>5e-5||t<-5e-5}}}class ua extends(H(sa,ha)){constructor(t){var e;super(t),t=t||{},this.id=null,this.style={},this.highlightStyle=null,this.parent=null,this.__dirty=!0,this.__clipShapes=[],this.invisible=!1,this.ignore=!1,this.zlevel=0,this.draggable=!1,this.clickable=!1,this.hoverable=!0,this.z=0,this.refOriginalPosition=[0,0],this.refDataID=null,this.isHoverByRefDataID=!1,this.refDataHoverGroup=null,this.dataInfo=null,rt.extend(this,t),this.id=this.id||rt.createUniqueID("smShape_"),this.CLASS_NAME="SuperMap.LevelRenderer.Shape",this.getTansform=(e=[],function(t,r){var i=[t,r];return this.needTransform&&this.transform&&(la.Util_matrix.invert(e,this.transform),la.Util_matrix.mulVector(i,e,[t,r,1]),t==i[0]&&r==i[1]&&this.updateNeedTransform()),i})}destroy(){this.id=null,this.style=null,this.highlightStyle=null,this.parent=null,this.__dirty=null,this.__clipShapes=null,this.invisible=null,this.ignore=null,this.zlevel=null,this.draggable=null,this.clickable=null,this.hoverable=null,this.z=null,this.refOriginalPosition=null,this.refDataID=null,this.refDataHoverGroup=null,this.isHoverByRefDataID=null,this.dataInfo=null,super.destroy()}brush(t,e){var r=this.beforeBrush(t,e);switch(t.beginPath(),this.buildPath(t,r),r.brushType){case"both":this.setCtxGlobalAlpha(t,"fill",r),t.fill(),r.lineWidth>0&&(this.setCtxGlobalAlpha(t,"stroke",r),t.stroke()),this.setCtxGlobalAlpha(t,"reset",r);break;case"stroke":this.setCtxGlobalAlpha(t,"stroke",r),r.lineWidth>0&&t.stroke(),this.setCtxGlobalAlpha(t,"reset",r);break;default:this.setCtxGlobalAlpha(t,"fill",r),t.fill(),this.setCtxGlobalAlpha(t,"reset",r)}this.drawText(t,r,this.style),this.afterBrush(t)}beforeBrush(t,e){var r=this.style;return this.brushTypeOnly&&(r.brushType=this.brushTypeOnly),e&&(r=this.getHighlightStyle(r,this.highlightStyle||{},this.brushTypeOnly)),"stroke"==this.brushTypeOnly&&(r.strokeColor=r.strokeColor||r.color),t.save(),this.doClip(t),this.setContext(t,r),this.setTransform(t),r}afterBrush(t){t.restore()}setContext(t,e){for(var r=[["color","fillStyle"],["strokeColor","strokeStyle"],["opacity","globalAlpha"],["lineCap","lineCap"],["lineJoin","lineJoin"],["miterLimit","miterLimit"],["lineWidth","lineWidth"],["shadowBlur","shadowBlur"],["shadowColor","shadowColor"],["shadowOffsetX","shadowOffsetX"],["shadowOffsetY","shadowOffsetY"]],i=0,s=r.length;i<s;i++){var n=e[r[i][0]],a=r[i][1];void 0!==n&&(t[a]=n)}}doClip(t){var e=la.Util_matrix.create();if(this.__clipShapes)for(var r=0;r<this.__clipShapes.length;r++){var i=this.__clipShapes[r];if(i.needTransform){let r=i.transform;la.Util_matrix.invert(e,r),t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}if(t.beginPath(),i.buildPath(t,i.style),t.clip(),i.needTransform){let r=e;t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}}}getHighlightStyle(t,e,r){var i={};for(let e in t)i[e]=t[e];var s=la.Util_color.getHighlightColor();"stroke"!=t.brushType?(i.strokeColor=s,i.lineWidth=t.lineWidth||1,i.brushType="both"):"stroke"!=r?(i.strokeColor=s,i.lineWidth=t.lineWidth||1):i.strokeColor=e.strokeColor||la.Util_color.mix(t.strokeColor,la.Util_color.toRGB(s));for(let t in e)void 0!==e[t]&&(i[t]=e[t]);return i}getHighlightZoom(){return"text"!=this.type?6:2}drift(t,e){this.position[0]+=t,this.position[1]+=e}buildPath(t,e){la.Util_log("buildPath not implemented in "+this.type)}getRect(t){la.Util_log("getRect not implemented in "+this.type)}isCover(t,e){var r=this.getTansform(t,e);t=r[0],e=r[1];var i=this.style.__rect;return i||(i=this.style.__rect=this.getRect(this.style)),t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height&&la.Util_area.isInside(this,this.style,t,e)}drawText(t,e,r){if(void 0!==e.text&&!1!==e.text){var i=e.textColor||e.color||e.strokeColor;t.fillStyle=i;var s,n,a,o,l=10,h=e.textPosition||this.textPosition||"top",u=[];switch(u=this.refOriginalPosition&&2===this.refOriginalPosition.length?this.refOriginalPosition:[0,0],h){case"inside":case"top":case"bottom":case"left":case"right":if(this.getRect){var c=(r||e).__rect||this.getRect(r||e);switch(h){case"inside":a=c.x+c.width/2,o=c.y+c.height/2,s="center",n="middle","stroke"!=e.brushType&&i==e.color&&(t.fillStyle="#fff");break;case"left":a=c.x-l,o=c.y+c.height/2,s="end",n="middle";break;case"right":a=c.x+c.width+l,o=c.y+c.height/2,s="start",n="middle";break;case"top":a=c.x+c.width/2,o=c.y-l,s="center",n="bottom";break;case"bottom":a=c.x+c.width/2,o=c.y+c.height+l,s="center",n="top"}}break;case"start":case"end":var d=0,p=0,f=0,m=0;if(void 0!==e.pointList){var y=e.pointList;if(y.length<2)return;var g=y.length;switch(h){case"start":d=y[0][0]+u[0],p=y[1][0]+u[0],f=y[0][1]+u[1],m=y[1][1]+u[1];break;case"end":d=y[g-2][0]+u[0],p=y[g-1][0]+u[0],f=y[g-2][1]+u[1],m=y[g-1][1]+u[1]}}else d=e.xStart+u[0]||0,p=e.xEnd+u[0]||0,f=e.yStart+u[1]||0,m=e.yEnd+u[1]||0;switch(h){case"start":s=d<p?"end":"start",n=f<m?"bottom":"top",a=d,o=f;break;case"end":s=d<p?"start":"end",n=f<m?"top":"bottom",a=p,o=m}l-=4,d&&p&&d!=p?a-="end"==s?l:-l:s="center",f!=m?o-="bottom"==n?l:-l:n="middle";break;case"specific":a=e.textX||0,o=e.textY||0,s="start",n="middle"}e.labelXOffset&&!isNaN(e.labelXOffset)&&(a+=e.labelXOffset),e.labelYOffset&&!isNaN(e.labelYOffset)&&(o+=e.labelYOffset),null!=a&&null!=o&&ua._fillText(t,e.text,a,o,e.textFont,e.textAlign||s,e.textBaseline||n)}}modSelf(){this.__dirty=!0,this.style&&(this.style.__rect=null),this.highlightStyle&&(this.highlightStyle.__rect=null)}isSilent(){return!(this.hoverable||this.draggable||this.clickable||this.onmousemove||this.onmouseover||this.onmouseout||this.onmousedown||this.onmouseup||this.onclick||this.ondragenter||this.ondragover||this.ondragleave||this.ondrop)}setCtxGlobalAlpha(t,e,r){t.globalAlpha="fill"===e?void 0===r.fillOpacity?void 0===r.opacity?1:r.opacity:r.fillOpacity:"stroke"===e?void 0===r.strokeOpacity?void 0===r.opacity?1:r.opacity:r.strokeOpacity:void 0===r.opacity?1:r.opacity}static _fillText(t,e,r,i,s,n,a){s&&(t.font=s),t.textAlign=n,t.textBaseline=a;var o=ua._getTextRect(e,r,i,s,n,a);e=(e+"").split("\n");var l=la.Util_area.getTextHeight("ZH",s);switch(a){case"top":i=o.y;break;case"bottom":i=o.y+l;break;default:i=o.y+l/2}for(var h=0,u=e.length;h<u;h++)t.fillText(e[h],r,i),i+=l}static _getTextRect(t,e,r,i,s,n){var a=la.Util_area.getTextWidth(t,i),o=la.Util_area.getTextHeight("ZH",i);switch(t=(t+"").split("\n"),s){case"end":case"right":e-=a;break;case"center":e-=a/2}switch(n){case"top":break;case"bottom":r-=o*t.length;break;default:r-=o*t.length/2}return{x:e,y:r,width:a,height:o*t.length}}}class ca extends ua{constructor(t){super(t),this.type="smicpoint",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicPoint"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;t.arc(e.x+r[0],e.y+r[1],e.r,0,2*Math.PI,!0)}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition;return t.__rect?t.__rect:(e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(t.x+r[0]-t.r-e/2),y:Math.round(t.y+r[1]-t.r-e/2),width:2*t.r+e,height:2*t.r+e},t.__rect)}}class da extends ua{constructor(t){super(t),this.type="smictext",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicText"}destroy(){this.type=null,super.destroy()}brush(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,i=this.style;if(e&&(i=this.getHighlightStyle(i,this.highlightStyle||{})),void 0!==i.text&&!1!==i.text){t.save(),this.doClip(t),this.setContext(t,i),this.setTransform(t),i.textFont&&(t.font=i.textFont),t.textAlign=i.textAlign||"start",t.textBaseline=i.textBaseline||"middle";var s,n=(i.text+"").split("\n"),a=la.Util_area.getTextHeight("ZH",i.textFont),o=this.getRectNoRotation(i),l=i.x+r[0];s="top"==i.textBaseline?o.y:"bottom"==i.textBaseline?o.y+a:o.y+a/2;for(var h=i.x+r[0],u=i.y+r[1],c=0,d=n.length;c<d;c++){switch(i.labelRect&&(t.fillRect(o.x-2,o.y,o.width+4,o.height),t.fillStyle=i.strokeColor,t.strokeRect(o.x-2,o.y,o.width+4,o.height),t.fillStyle=i.textColor),i.brushType){case"stroke":this.setCtxGlobalAlpha(t,"stroke",i),i.textRotation&&0!==i.textRotation?(t.save(),t.translate(h,u),t.rotate(i.textRotation*Math.PI/180),"top"==i.textBaseline?i.maxWidth?t.strokeText(n[c],0,a*c,i.maxWidth):t.strokeText(n[c],0,a*c):"bottom"==i.textBaseline?i.maxWidth?t.strokeText(n[c],0,a*(c+1)-o.height,i.maxWidth):t.strokeText(n[c],0,a*(c+1)-o.height):i.maxWidth?t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2,i.maxWidth):t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2),t.restore()):i.maxWidth?t.strokeText(n[c],l,s,i.maxWidth):t.strokeText(n[c],l,s),this.setCtxGlobalAlpha(t,"reset",i);break;case"both":i.textRotation&&0!==i.textRotation?(t.save(),t.translate(h,u),t.rotate(i.textRotation*Math.PI/180),"top"==i.textBaseline?i.maxWidth?(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*c,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*c,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i)):(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*c),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*c),this.setCtxGlobalAlpha(t,"reset",i)):"bottom"==i.textBaseline?i.maxWidth?(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*(c+1)-o.height,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*(c+1)-o.height,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i)):(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*(c+1)-o.height),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*(c+1)-o.height),this.setCtxGlobalAlpha(t,"reset",i)):i.maxWidth?(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*(c+1)-o.height/2-a/2,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i)):(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],0,a*(c+1)-o.height/2-a/2),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],0,a*(c+1)-o.height/2-a/2),this.setCtxGlobalAlpha(t,"reset",i)),t.restore()):i.maxWidth?(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],l,s,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],l,s,i.maxWidth),this.setCtxGlobalAlpha(t,"reset",i)):(this.setCtxGlobalAlpha(t,"fill",i),t.fillText(n[c],l,s),this.setCtxGlobalAlpha(t,"reset",i),this.setCtxGlobalAlpha(t,"stroke",i),t.strokeText(n[c],l,s),this.setCtxGlobalAlpha(t,"reset",i));break;default:this.setCtxGlobalAlpha(t,"fill",i),i.textRotation&&0!==i.textRotation?(t.save(),t.translate(h,u),t.rotate(i.textRotation*Math.PI/180),"top"==i.textBaseline?i.maxWidth?t.fillText(n[c],0,a*c,i.maxWidth):t.fillText(n[c],0,a*c):"bottom"==i.textBaseline?i.maxWidth?t.fillText(n[c],0,a*(c+1)-o.height,i.maxWidth):t.fillText(n[c],0,a*(c+1)-o.height):i.maxWidth?t.fillText(n[c],0,a*(c+1)-o.height/2-a/2,i.maxWidth):t.fillText(n[c],0,a*(c+1)-o.height/2-a/2),t.restore()):i.maxWidth?t.fillText(n[c],l,s,i.maxWidth):t.fillText(n[c],l,s),this.setCtxGlobalAlpha(t,"reset",i)}s+=a}t.restore()}}getRect(t){if(t.__rect)return t.__rect;for(var e,r,i,s,n=this.getTextBackground(t,!0),a=0,o=n.length;a<o;a++){var l=n[a];0==a?(e=l[0],i=l[0],r=l[1],s=l[1]):(l[0]<e&&(e=l[0]),l[0]>i&&(i=l[0]),l[1]<r&&(r=l[1]),l[1]>s&&(s=l[1]))}return t.__rect={x:e,y:r,width:i-e,height:s-r},t.__rect}getRectNoRotation(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition,i=la.Util_area.getTextHeight("ZH",t.textFont),s=la.Util_area.getTextWidth(t.text,t.textFont),n=la.Util_area.getTextHeight(t.text,t.textFont),a=t.x+r[0];"end"==t.textAlign||"right"==t.textAlign?a-=s:"center"==t.textAlign&&(a-=s/2),e="top"==t.textBaseline?t.y+r[1]:"bottom"==t.textBaseline?t.y+r[1]-n:t.y+r[1]-n/2;var o,l=!1;if(t.maxWidth){var h=parseInt(t.maxWidth);h<s&&(o=s,l=!0,s=h),a=t.x+r[0],"end"==t.textAlign||"right"==t.textAlign?a-=s:"center"==t.textAlign&&(a-=s/2)}t.textFont&&(t.textFont.toLowerCase().indexOf("italic")>-1&&(s+=!0===l?i/3*(s/o):i/3));return{x:a,y:e,width:s,height:n}}getTextBackground(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;if(!e&&t.__textBackground)return t.__textBackground;var i=this.getRectNoRotation(t),s=t.x+r[0],n=t.y+r[1],a=[];if(t.textRotation&&0!==t.textRotation){let e=t.textRotation,r=this.getRotatedLocation(i.x,i.y,s,n,e),o=this.getRotatedLocation(i.x+i.width,i.y,s,n,e),l=this.getRotatedLocation(i.x+i.width,i.y+i.height,s,n,e),h=this.getRotatedLocation(i.x,i.y+i.height,s,n,e);a.push(r),a.push(o),a.push(l),a.push(h)}else{let t=[i.x,i.y],e=[i.x+i.width,i.y],r=[i.x+i.width,i.y+i.height],s=[i.x,i.y+i.height];a.push(t),a.push(e),a.push(r),a.push(s)}return t.__textBackground=a,t.__textBackground}getRotatedLocation(t,e,r,i,s){var n,a,o=new Array;return e=-e,i=-i,s=-s,n=(t-r)*Math.cos(s/180*Math.PI)-(e-i)*Math.sin(s/180*Math.PI)+r,a=(t-r)*Math.sin(s/180*Math.PI)+(e-i)*Math.cos(s/180*Math.PI)+i,o[0]=n,o[1]=-a,o}}class pa extends ua{constructor(t){super(t),this.type="smiccircle",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicCircle"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,i=e.x+r[0],s=e.y+r[1];return t.moveTo(i+e.r,s),t.arc(i,s,e.r,0,2*Math.PI,!0),!0}getRect(t){if(t.__rect)return t.__rect;this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition,i=t.x+r[0],s=t.y+r[1],n=t.r;return e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(i-n-e/2),y:Math.round(s-n-e/2),width:2*n+e,height:2*n+e},t.__rect}}class fa extends ua{constructor(t){super(t),this.type="smicpolygon",this.holePolygonPointLists=null,this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicPolygon"}destroy(){this.type=null,this.holePolygonPointLists=null,super.destroy()}brush(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.style;e&&(r=this.getHighlightStyle(r,this.highlightStyle||{})),t.save(),this.setContext(t,r),this.setTransform(t);var i=!1;"fill"!=r.brushType&&"both"!=r.brushType&&void 0!==r.brushType||(t.beginPath(),"dashed"==r.lineType||"dotted"==r.lineType||"dot"==r.lineType||"dash"==r.lineType||"dashdot"==r.lineType||"longdash"==r.lineType||"longdashdot"==r.lineType?this.buildPath(t,{lineType:"solid",lineWidth:r.lineWidth,pointList:r.pointList}):(this.buildPath(t,r),i=!0),t.closePath(),this.setCtxGlobalAlpha(t,"fill",r),t.fill(),this.setCtxGlobalAlpha(t,"reset",r)),r.lineWidth>0&&("stroke"==r.brushType||"both"==r.brushType)&&(i||(t.beginPath(),this.buildPath(t,r)),this.setCtxGlobalAlpha(t,"stroke",r),t.stroke(),this.setCtxGlobalAlpha(t,"reset",r)),this.drawText(t,r,this.style);var s=rt.cloneObject(r);if(s.pointList&&this.holePolygonPointLists&&this.holePolygonPointLists.length>0)for(var n=this.holePolygonPointLists,a=n.length,o=0;o<a;o++){var l=n[o];s.pointList=l,t.globalCompositeOperation="destination-out",i=!1,"fill"!=s.brushType&&"both"!=s.brushType&&void 0!==s.brushType||(t.beginPath(),"dashed"==s.lineType||"dotted"==s.lineType||"dot"==s.lineType||"dash"==s.lineType||"dashdot"==s.lineType||"longdash"==s.lineType||"longdashdot"==s.lineType?this.buildPath(t,{lineType:"solid",lineWidth:s.lineWidth,pointList:s.pointList}):(this.buildPath(t,s),i=!0),t.closePath(),this.setCtxGlobalAlpha(t,"fill",s),t.fill(),this.setCtxGlobalAlpha(t,"reset",s)),s.lineWidth>0&&("stroke"==s.brushType||"both"==s.brushType)?(i||(t.beginPath(),this.buildPath(t,s)),t.globalCompositeOperation="source-over",this.setCtxGlobalAlpha(t,"stroke",s),t.stroke(),this.setCtxGlobalAlpha(t,"reset",s)):t.globalCompositeOperation="source-over"}t.restore()}buildPath(t,e){e.showShadow&&(t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY),this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,i=e.pointList;if(!(i.length<2))if(e.smooth&&"spline"!==e.smooth){var s,n,a,o=la.SUtil_smoothBezier(i,e.smooth,!0,e.smoothConstraint,r);t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(var l=i.length,h=0;h<l;h++)s=o[2*h],n=o[2*h+1],a=[i[(h+1)%l][0]+r[0],i[(h+1)%l][1]+r[1]],t.bezierCurveTo(s[0],s[1],n[0],n[1],a[0],a[1])}else if("spline"===e.smooth&&(i=la.SUtil_smoothSpline(i,!0,null,r)),e.lineType&&"solid"!=e.lineType){if("dashed"===e.lineType||"dotted"===e.lineType||"dot"===e.lineType||"dash"===e.lineType||"longdash"===e.lineType){let s=e._dashLength||(e.lineWidth||1)*("dashed"==e.lineType?5:1);e._dashLength=s;let n=e.lineWidth||1,a=n,o=n;"dashed"===e.lineType&&(a*=5,o*=5,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"dotted"===e.lineType&&e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n),"dot"===e.lineType&&(o*=4,e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n)),"dash"===e.lineType&&(a*=4,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"longdash"===e.lineType&&(a*=8,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=1;e<i.length;e++)la.SUtil_dashedLineTo(t,i[e-1][0]+r[0],i[e-1][1]+r[1],i[e][0]+r[0],i[e][1]+r[1],n,[a,o]);la.SUtil_dashedLineTo(t,i[i.length-1][0]+r[0],i[i.length-1][1]+r[1],i[0][0]+r[0],i[0][1]+r[1],n,[a,o])}else if("dashdot"===e.lineType||"longdashdot"===e.lineType){let s=e._dashLength||(e.lineWidth||1)*("dashed"==e.lineType?5:1);e._dashLength=s;let n=e.lineWidth||1,a=n,o=n,l=n,h=n;"dashdot"===e.lineType&&(a*=4,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),"longdashdot"===e.lineType&&(a*=8,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=1;e<i.length;e++)la.SUtil_dashedLineTo(t,i[e-1][0]+r[0],i[e-1][1]+r[1],i[e][0]+r[0],i[e][1]+r[1],n,[a,o,l,h]);la.SUtil_dashedLineTo(t,i[i.length-1][0]+r[0],i[i.length-1][1]+r[1],i[0][0]+r[0],i[0][1]+r[1],n,[a,o,l,h])}}else{t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=1;e<i.length;e++)t.lineTo(i[e][0]+r[0],i[e][1]+r[1]);t.lineTo(i[0][0]+r[0],i[0][1]+r[1])}}getRect(t,e){var r;if(e?r=e:(this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),r=this.refOriginalPosition),t.__rect)return t.__rect;for(var i,s=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MAX_VALUE,o=Number.MIN_VALUE,l=t.pointList,h=0,u=l.length;h<u;h++)l[h][0]+r[0]<s&&(s=l[h][0]+r[0]),l[h][0]+r[0]>n&&(n=l[h][0]+r[0]),l[h][1]+r[1]<a&&(a=l[h][1]+r[1]),l[h][1]+r[1]>o&&(o=l[h][1]+r[1]);return i="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(s-i/2),y:Math.round(a-i/2),width:n-s+i,height:o-a+i},t.__rect}}class ma extends ua{constructor(t){super(t),this.brushTypeOnly="stroke",this.textPosition="end",this.type="smicbroken-line",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicBrokenLine"}destroy(){this.brushTypeOnly=null,this.textPosition=null,this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,i=e.pointList;if(!(i.length<2)){var s=Math.min(e.pointList.length,Math.round(e.pointListLength||e.pointList.length));if(e.smooth&&"spline"!==e.smooth){var n,a,o,l=la.SUtil_smoothBezier(i,e.smooth,!1,e.smoothConstraint,r);t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=0;e<s-1;e++)n=l[2*e],a=l[2*e+1],o=[i[e+1][0]+r[0],i[e+1][1]+r[1]],t.bezierCurveTo(n[0],n[1],a[0],a[1],o[0],o[1])}else if("spline"===e.smooth&&(s=(i=la.SUtil_smoothSpline(i,null,null,r)).length),e.lineType&&"solid"!==e.lineType){if("dashed"===e.lineType||"dotted"===e.lineType||"dot"===e.lineType||"dash"===e.lineType||"longdash"===e.lineType){let n=e.lineWidth||1,a=n,o=n;"dashed"===e.lineType&&(a*=5,o*=5,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"dotted"===e.lineType&&e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n),"dot"===e.lineType&&(o*=4,e.lineCap&&"butt"!==e.lineCap&&(a=1,o+=n)),"dash"===e.lineType&&(a*=4,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),"longdash"===e.lineType&&(a*=8,o*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n)),t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(var h=1;h<s;h++)la.SUtil_dashedLineTo(t,i[h-1][0]+r[0],i[h-1][1]+r[1],i[h][0]+r[0],i[h][1]+r[1],n,[a,o])}else if("dashdot"===e.lineType||"longdashdot"===e.lineType){let n=e.lineWidth||1,a=n,o=n,l=n,h=n;"dashdot"===e.lineType&&(a*=4,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),"longdashdot"===e.lineType&&(a*=8,o*=4,h*=4,e.lineCap&&"butt"!==e.lineCap&&(a-=n,o+=n,l=1,h+=n)),n=(e.lineWidth||1)*("dashed"===e.lineType?5:1),t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=1;e<s;e++)la.SUtil_dashedLineTo(t,i[e-1][0]+r[0],i[e-1][1]+r[1],i[e][0]+r[0],i[e][1]+r[1],n,[a,o,l,h])}}else{t.moveTo(i[0][0]+r[0],i[0][1]+r[1]);for(let e=1;e<s;e++)t.lineTo(i[e][0]+r[0],i[e][1]+r[1])}}}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition;return fa.prototype.getRect.apply(this,[t,e])}}class ya extends ua{constructor(t){super(t),this.type="smicimage",this._imageCache={},this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicImage"}destroy(){this.type=null,this._imageCache=null,super.destroy()}brush(t,e,r){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var i=this.refOriginalPosition,s=this.style||{};e&&(s=this.getHighlightStyle(s,this.highlightStyle||{}));var n=s.image,a=this;if("string"==typeof n){var o=n;this._imageCache[o]?n=this._imageCache[o]:((n=new Image).onload=function(){n.onload=null,clearTimeout(ya._refreshTimeout),ya._needsRefresh.push(a),ya._refreshTimeout=setTimeout(function(){r&&r(ya._needsRefresh),ya._needsRefresh=[]},10)},n.src=o,this._imageCache[o]=n)}if(n){if("IMG"==n.nodeName.toUpperCase())if(window.ActiveXObject){if("complete"!=n.readyState)return}else if(!n.complete)return;var l=s.width||n.width,h=s.height||n.height,u=s.x+i[0],c=s.y+i[1];if(!n.width||!n.height)return;if(t.save(),this.doClip(t),this.setContext(t,s),this.setTransform(t),s.sWidth&&s.sHeight){let e=s.sx+i[0]||0,r=s.sy+i[1]||0;t.drawImage(n,e,r,s.sWidth,s.sHeight,u,c,l,h)}else if(s.sx&&s.sy){let e=s.sx+i[0],r=s.sy+i[1];var d=l-e,p=h-r;t.drawImage(n,e,r,d,p,u,c,l,h)}else t.drawImage(n,u,c,l,h);s.width||(s.width=l),s.height||(s.height=h),this.style.width||(this.style.width=l),this.style.height||(this.style.height=h),this.drawText(t,s,this.style),t.restore()}}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition;return{x:t.x+e[0],y:t.y+e[1],width:t.width,height:t.height}}clearCache(){this._imageCache={}}}ya._needsRefresh=[],ya._refreshTimeout=null;class ga extends ua{constructor(t){super(t),this.type="smicrectangle",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicRectangle"}destroy(){this.type=null,super.destroy()}_buildRadiusPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r,i,s,n,a,o=this.refOriginalPosition,l=e.x+o[0],h=e.y+o[1],u=e.width,c=e.height,d=e.radius;"number"==typeof d?r=i=s=n=d:d instanceof Array?1===d.length?r=i=s=n=d[0]:2===d.length?(r=s=d[0],i=n=d[1]):3===d.length?(r=d[0],i=n=d[1],s=d[2]):(r=d[0],i=d[1],s=d[2],n=d[3]):r=i=s=n=0,r+i>u&&(r*=u/(a=r+i),i*=u/a),s+n>u&&(s*=u/(a=s+n),n*=u/a),i+s>c&&(i*=c/(a=i+s),s*=c/a),r+n>c&&(r*=c/(a=r+n),n*=c/a),t.moveTo(l+r,h),t.lineTo(l+u-i,h),0!==i&&t.quadraticCurveTo(l+u,h,l+u,h+i),t.lineTo(l+u,h+c-s),0!==s&&t.quadraticCurveTo(l+u,h+c,l+u-s,h+c),t.lineTo(l+n,h+c),0!==n&&t.quadraticCurveTo(l,h+c,l,h+c-n),t.lineTo(l,h+r),0!==r&&t.quadraticCurveTo(l,h,l+r,h)}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition;e.radius?this._buildRadiusPath(t,e):(t.moveTo(e.x+r[0],e.y+r[1]),t.lineTo(e.x+r[0]+e.width,e.y+r[1]),t.lineTo(e.x+r[0]+e.width,e.y+r[1]+e.height),t.lineTo(e.x+r[0],e.y+r[1]+e.height),t.lineTo(e.x+r[0],e.y+r[1])),t.closePath()}getRect(t){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e,r=this.refOriginalPosition;return t.__rect?t.__rect:(e="stroke"==t.brushType||"fill"==t.brushType?t.lineWidth||1:0,t.__rect={x:Math.round(t.x+r[0]-e/2),y:Math.round(t.y+r[1]-e/2),width:t.width+e,height:t.height+e},t.__rect)}}class va extends ua{constructor(t){super(t),this.type="smicsector",this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]),this.CLASS_NAME="SuperMap.LevelRenderer.Shape.SmicSector"}destroy(){this.type=null,super.destroy()}buildPath(t,e){this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var r=this.refOriginalPosition,i=e.x+r[0],s=e.y+r[1],n=e.r0||0,a=e.r,o=e.startAngle,l=e.endAngle,h=e.clockWise||!1;o=la.Util_math.degreeToRadian(o),l=la.Util_math.degreeToRadian(l),h||(o=-o,l=-l);var u=la.Util_math.cos(o),c=la.Util_math.sin(o);t.moveTo(u*n+i,c*n+s),t.lineTo(u*a+i,c*a+s),t.arc(i,s,a,o,l,!h),t.lineTo(la.Util_math.cos(l)*n+i,la.Util_math.sin(l)*n+s),0!==n&&t.arc(i,s,n,l,o,h),t.closePath()}getRect(t){if(t.__rect)return t.__rect;this.refOriginalPosition&&2===this.refOriginalPosition.length||(this.refOriginalPosition=[0,0]);var e=this.refOriginalPosition,r=la.Util_vector.create(),i=la.Util_vector.create(),s=la.Util_vector.create(),n=la.Util_vector.create(),a=t.x+e[0],o=t.y+e[1],l=t.r0||0,h=t.r,u=la.Util_math.degreeToRadian(t.startAngle),c=la.Util_math.degreeToRadian(t.endAngle),d=t.clockWise;return d||(u=-u,c=-c),l>1?la.Util_computeBoundingBox.arc(a,o,l,u,c,!d,r,s):(r[0]=s[0]=a,r[1]=s[1]=o),la.Util_computeBoundingBox.arc(a,o,h,u,c,!d,i,n),la.Util_vector.min(r,r,i),la.Util_vector.max(s,s,n),t.__rect={x:r[0],y:r[1],width:s[0]-r[0],height:s[1]-r[1]},t.__rect}}class ba{constructor(t){this.shapeParameters=t,this.CLASS_NAME="SuperMap.Feature.ShapeFactory"}destroy(){this.shapeParameters=null}createShape(t){if(t&&(this.shapeParameters=t),!this.shapeParameters)return null;var e=this.shapeParameters;if(e instanceof Qn){let t=new Object;t.x=e.x,t.y=e.y,t.r=e.r,t=rt.copyAttributesWithClip(t,e.style,["x","y"]);let r=new ca;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","style","highlightStyle"]),r}if(e instanceof Zn){if(!e.pointList)return null;let t=new Object;t.pointList=e.pointList,t=rt.copyAttributesWithClip(t,e.style,["pointList"]);let r=new ma;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["pointList","style","highlightStyle"]),r}if(e instanceof Kn){if(!e.pointList)return null;let t=new Object;t.pointList=e.pointList,t=rt.copyAttributesWithClip(t,e.style,["pointList"]);let r=new fa;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["pointList","style","highlightStyle"]),r}if(e instanceof $n){if(!e.x&&!e.y&!e.width&!e.height)return null;let t=new Object;t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t=rt.copyAttributesWithClip(t,e.style,["x","y","width","height"]);let r=new ga;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","width","height","style","highlightStyle"]),r}if(e instanceof ta){let t=new Object;t.x=e.x,t.y=e.y,t.r=e.r,t.startAngle=e.startAngle,t.endAngle=e.endAngle,e.r0&&(t.r0=e.r0),e.clockWise&&(t.clockWise=e.clockWise),t=rt.copyAttributesWithClip(t,e.style,["x","y","r","startAngle","endAngle","r0","endAngle"]);let r=new va;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","r","startAngle","endAngle","r0","endAngle","style","highlightStyle"]),r}if(e instanceof ea){let t=new Object;t.x=e.x,t.y=e.y,t.text=e.text,t=rt.copyAttributesWithClip(t,e.style,["x","y","text"]);let r=new da;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","text","style","highlightStyle"]),r}if(e instanceof ra){let t=new Object;t.x=e.x,t.y=e.y,e.image&&(t.image=e.image),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.sx&&(t.sx=e.sx),e.sy&&(t.sy=e.sy),e.sWidth&&(t.sWidth=e.sWidth),e.sHeight&&(t.sHeight=e.sHeight),t=rt.copyAttributesWithClip(t,e.style,["x","y","image","width","height","sx","sy","sWidth","sHeight"]);let r=new ya;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","image","width","height","style","highlightStyle"]),r}if(e instanceof ia){let t=new Object;t.x=e.x,t.r=e.r,t.y=e.y,t=rt.copyAttributesWithClip(t,e.style,["x","y","r"]);let r=new pa;return r.style=ba.transformStyle(t),r.highlightStyle=ba.transformStyle(e.highlightStyle),rt.copyAttributesWithClip(r,e,["x","y","r","style","highlightStyle","lineWidth","text","textPosition"]),r}return null}static transformStyle(t){var e={},r=["normal","normal","normal","12","arial,sans-serif"],i=[!0,!1];for(var s in t)switch(s){case"fill":i[0]=t[s];break;case"fillColor":e.color=t[s];break;case"stroke":i[1]=t[s];break;case"strokeWidth":e.lineWidth=t[s];break;case"strokeLinecap":e.lineCap=t[s];break;case"strokeLineJoin":e.lineJoin=t[s];break;case"strokeDashstyle":e.lineType=t[s];break;case"pointRadius":e.r=t[s];break;case"label":e.text=t[s];break;case"labelRect":e.labelRect=t[s];break;case"fontColor":e.textColor=t[s];break;case"fontStyle":r[0]=t[s];break;case"fontVariant":r[1]=t[s];break;case"fontWeight":r[2]=t[s];break;case"fontSize":var n="";t[s]&&t[s].toString().indexOf("px")<0&&(n="px"),r[3]=t[s]+n;break;case"fontFamily":r[4]=t[s];break;case"fontOpacity":e.opacity=t[s];break;case"labelPosition":e.textPosition=t[s];break;case"labelAlign":e.textAlign=t[s];break;case"labelBaseline":e.textBaseline=t[s];break;case"labelRotation":e.textRotation=t[s];break;default:e[s]=t[s]}return e.textFont=r.join(" "),!0===i[0]&&!1===i[1]?e.brushType="fill":!1===i[0]&&!0===i[1]?e.brushType="stroke":!0===i[0]&&!0===i[1]?e.brushType="both":e.brushType="fill",null==e.lineWidth&&(e.lineWidth=1),e}static Background(t,e,r){var i=r||{},s=new $n(e[0],e[3],Math.abs(e[2]-e[0]),Math.abs(e[3]-e[1]));return s.style={fillColor:"#f3f3f3"},i.backgroundStyle&&rt.copyAttributesWithClip(s.style,i.backgroundStyle),i.backgroundRadius&&(s.style.radius=i.backgroundRadius),s.clickable=!1,s.hoverable=!1,t.createShape(s)}static GraphAxis(t,e,r,i){var s=e,n=r||{},a=[],o=[],l=!!n.useXReferenceLine&&n.useXReferenceLine,h=n.axisYTick&&!isNaN(n.axisYTick)?n.axisYTick:0,u=[],c=[];if(0==h){if(c.push([s[0],s[3]-5]),c.push([s[0],s[1]]),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){let t=parseInt(n.axis3DParameter),e=[s[0]-t,s[1]+t];n.axisUseArrow?(u.push([e[0]+1.5,e[1]-7.5]),u.push([e[0]-1,e[1]+1]),u.push([e[0]+7.5,e[1]-1.5]),c.push([e[0],e[1]])):c.push([e[0],e[1]]),c.push([s[0],s[1]])}c.push([s[2]+5,s[1]])}else{var d=Math.abs(s[1]-s[3])/h,p=s[3];c.push([s[0],p-5]);for(var f=0;f<h;f++){if(c.push([s[0],p]),c.push([s[0]-5,p]),c.push([s[0],p]),l){var m=new Zn([[s[0],p],[s[2],p]]);m.style={strokeColor:"#cfcfcf",strokeLinecap:"butt",strokeLineJoin:"round",strokeWidth:1},m.clickable=!1,m.hoverable=!1,n.xReferenceLineStyle&&rt.copyAttributesWithClip(m.style,n.xReferenceLineStyle),a.push(t.createShape(m))}p+=d}if(c.push([s[0],s[1]]),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){let t=parseInt(n.axis3DParameter),e=[s[0]-t,s[1]+t];n.axisUseArrow?(u.push([e[0]+1.5,e[1]-7.5]),u.push([e[0]-1,e[1]+1]),u.push([e[0]+7.5,e[1]-1.5]),c.push([e[0],e[1]])):c.push([e[0],e[1]]),c.push([s[0],s[1]])}c.push([s[2]+5,s[1]])}if(n.axisUseArrow){var y=[[s[2]+5,s[1]+4],[s[2]+13,s[1]],[s[2]+5,s[1]-4]],g=[[s[0]-4,s[3]-5],[s[0],s[3]-13],[s[0]+4,s[3]-5]],v=new Kn(y);v.style={fillColor:"#008acd"},rt.copyAttributesWithClip(v.style,n.axisStyle),o.push(t.createShape(v));var b=new Kn(g);if(b.style={fillColor:"#008acd"},rt.copyAttributesWithClip(b.style,n.axisStyle),o.push(t.createShape(b)),n.axis3DParameter&&!isNaN(n.axis3DParameter)&&n.axis3DParameter>=15){var S=new Kn(u);S.style={fillColor:"#008acd"},rt.copyAttributesWithClip(S.style,n.axisStyle),o.push(t.createShape(S))}}var _=new Zn(c);_.style={strokeLinecap:"butt",strokeLineJoin:"round",strokeColor:"#008acd",strokeWidth:1},n.axisStyle&&rt.copyAttributesWithClip(_.style,n.axisStyle),_.clickable=!1,_.hoverable=!1;var x=[t.createShape(_)],w=[];if(n.axisYLabels&&n.axisYLabels.length&&n.axisYLabels.length>0){var C=n.axisYLabels;let e=C.length;var M=[0,0];if(n.axisYLabelsOffset&&n.axisYLabelsOffset.length&&(M=n.axisYLabelsOffset),1==e){let e=new ea(s[0]-5+M[0],s[3]+M[1],C[0]);e.style={labelAlign:"right"},n.axisYLabelsStyle&&rt.copyAttributesWithClip(e.style,n.axisYLabelsStyle),e.clickable=!1,e.hoverable=!1,w.push(t.createShape(e))}else for(var A=s[3],T=Math.abs(s[1]-s[3])/(e-1),E=0;E<e;E++){let e=new ea(s[0]-5+M[0],A+M[1],C[E]);e.style={labelAlign:"right"},n.axisYLabelsStyle&&rt.copyAttributesWithClip(e.style,n.axisYLabelsStyle),e.clickable=!1,e.hoverable=!1,w.push(t.createShape(e)),A+=T}}var O=[];if(n.axisXLabels&&n.axisXLabels.length&&n.axisXLabels.length>0){let e=n.axisXLabels,r=e.length,a=[0,0];if(n.axisXLabelsOffset&&n.axisXLabelsOffset.length&&(a=n.axisXLabelsOffset),i&&i.xPositions&&i.xPositions.length&&i.xPositions.length==r){let o=i.xPositions;for(let i=0;i<r;i++){let r=new ea(o[i]+a[0],s[1]+a[1],e[i]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&rt.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,O.push(t.createShape(r))}}else if(1==r){let r=new ea(s[0]-5+a[0],s[1]+a[0],e[0]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&rt.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,O.push(t.createShape(r))}else{let i=s[0],o=Math.abs(s[2]-s[0])/(r-1);for(let l=0;l<r;l++){let r=new ea(i+a[0],s[1]+a[1],e[l]);r.style={labelAlign:"center",labelBaseline:"top"},n.axisXLabelsStyle&&rt.copyAttributesWithClip(r.style,n.axisXLabelsStyle),r.clickable=!1,r.hoverable=!1,O.push(t.createShape(r)),i+=o}}}return a.concat(x).concat(w).concat(O).concat(o)}static ShapeStyleTool(t,e,r,i,s,n){var a=t||{};if(e&&rt.copyAttributesWithClip(a,e),r&&r.length&&void 0!==s&&!isNaN(s)&&s>=0&&r[s]&&rt.copyAttributesWithClip(a,r[s]),i&&i.length&&void 0!==n)for(var o=i,l=o.length,h=parseFloat(n),u=0;u<l;u++)if(o[u].start<=h&&h<o[u].end){rt.copyAttributesWithClip(a,o[u].style);break}return a}}class Sa{constructor(t,e){t&&e&&e.map&&e.renderer&&(this.id=rt.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=null,this.location=[],this.data=t,this.shapes=[],this.layer=e,this.CLASS_NAME="SuperMap.Feature.Theme")}destroy(){this.data=null,this.id=null,this.lonlat=null,this.location=null,this.shapes=null,this.layer=null}getLocalXY(t){var e=this.layer.map.getResolution(),r=this.layer.map.getExtent();if(t instanceof ut||t instanceof dt){return[t.x/e+-r.left/e,r.top/e-t.y/e]}if(t instanceof nt){return[t.lon/e+-r.left/e,r.top/e-t.lat/e]}return null}}class _a extends Sa{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n),this.shapeFactory=new ba,this.shapeParameters=null,this.RelativeCoordinate=!1,this.setting=null,this.origonPoint=null,this.chartBox=null,this.chartBounds=null,this.width=null,this.height=null,this.XOffset=0,this.YOffset=0,this.DVBParameter=null,this.dataViewBox=null,this.DVBCodomain=null,this.DVBCenterPoint=null,this.DVBUnitValue=null,this.DVBOrigonPoint=null,this.DVBWidth=null,this.DVBHeight=null,this.origonPointOffset=null,this.fields=r||[],this.dataValues=null,this.lonlat=s||this.data.geometry.getBounds().getCenterLonLat(),i&&i.width&&i.height&&i.codomain&&(this.setting=i),this.CLASS_NAME="SuperMap.Feature.Theme.Graph"}destroy(){this.shapeFactory=null,this.shapeParameters=null,this.width=null,this.height=null,this.origonPoint=null,this.chartBox=null,this.dataViewBox=null,this.chartBounds=null,this.DVBParameter=null,this.DVBOrigonPoint=null,this.DVBCenterPoint=null,this.DVBWidth=null,this.DVBHeight=null,this.DVBCodomain=null,this.DVBUnitValue=null,this.origonPointOffset=null,this.XOffset=null,this.YOffset=null,this.fields=null,this.dataValues=null,this.setting=null,super.destroy()}initBaseParameter(){if(!this.setting)return!1;var t=this.setting;if(!(t.width&&t.height&&t.codomain))return!1;var e=void 0===t.decimalNumber||isNaN(t.decimalNumber)?-1:t.decimalNumber,r=Sa.getDataValues(this.data,this.fields,e);this.dataValues=r||[],this.width=parseFloat(t.width),this.height=parseFloat(t.height),this.DVBCodomain=t.codomain,this.XOffset=t.XOffset?t.XOffset:0,this.YOffset=t.YOffset?t.YOffset:0,this.origonPoint=[],this.chartBox=[],this.dataViewBox=[],this.DVBParameter=t.dataViewBoxParameter?t.dataViewBoxParameter:[0,0,0,0],this.DVBOrigonPoint=[],this.DVBCenterPoint=[],this.origonPointOffset=[],this.resetLocation();var i=this.width,s=this.height,n=this.location;this.origonPoint=[n[0]-i/2,n[1]-s/2];var a=this.origonPoint;this.chartBox=[a[0],a[1]+s,a[0]+i,a[1]];var o=this.chartBox,l=this.DVBParameter;this.dataViewBox=[o[0]+l[0],o[1]-l[1],o[2]-l[2],o[3]+l[3]];var h=this.dataViewBox;return!(h[0]>=h[2]||h[1]<=h[3])&&(this.DVBOrigonPoint=[h[0],h[3]],this.DVBWidth=Math.abs(h[2]-h[0]),this.DVBHeight=Math.abs(h[1]-h[3]),this.DVBCenterPoint=[this.DVBOrigonPoint[0]+this.DVBWidth/2,this.DVBOrigonPoint[1]+this.DVBHeight/2],this.origonPointOffset=[this.DVBOrigonPoint[0]-a[0],this.DVBOrigonPoint[1]-a[1]],!0)}resetLocation(t){t&&(this.lonlat=t);var e=this.getLocalXY(this.lonlat);e[0]+=this.XOffset,e[1]+=this.YOffset,this.location=e;var r=this.width,i=this.height,s=this.location;return this.chartBounds=new at(s[0]-r/2,s[1]+i/2,s[0]+r/2,s[1]-i/2),this.resetLinearGradient(),s}resetLinearGradient(){}shapesConvertToRelativeCoordinate(){for(var t=this.shapes,e=this.location,r=0,i=t.length;r<i;r++){t[r].refOriginalPosition=e;var s=t[r].style;for(var n in s)switch(n){case"pointList":for(var a=s[n],o=0,l=a.length;o<l;o++)a[o][0]-=e[0],a[o][1]-=e[1];break;case"x":s[n]-=e[0];break;case"y":s[n]-=e[1]}}this.RelativeCoordinate=!0}assembleShapes(){}getLocalXY(t){return this.layer.getLocalXY(t)}}Sa.getDataValues=function(t,e,r){if(!t.attributes)return!1;for(var i=[],s=t.attributes,n=0;n<e.length;n++)for(var a in s)if(a===e[n])try{!isNaN(r)&&r>=0?i.push(parseFloat(s[a].toString()).toFixed(r)):i.push(parseFloat(s[a].toString()))}catch(t){throw new Error("not a number")}return i.length===e.length&&i};class xa extends _a{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n),this.setting=null,i&&i.codomain&&(this.setting=i,this.DVBCodomain=this.setting.codomain),this.CLASS_NAME="SuperMap.Feature.Theme.RankSymbol"}destroy(){this.setting=null,super.destroy()}initBaseParameter(){if(!this.setting)return!1;var t=this.setting;t.XOffset&&(this.XOffset=t.XOffset),t.YOffset&&(this.YOffset=t.YOffset),this.XOffset=t.XOffset?t.XOffset:0,this.YOffset=t.YOffset?t.YOffset:0,this.origonPoint=[],this.chartBox=[],this.dataViewBox=[],this.DVBParameter=t.dataViewBoxParameter?t.dataViewBoxParameter:[0,0,0,0],this.DVBOrigonPoint=[],this.DVBCenterPoint=[],this.origonPointOffset=[],this.resetLocation();var e=this.width,r=this.height,i=this.location;this.origonPoint=[i[0]-e/2,i[1]-r/2];var s=this.origonPoint;this.chartBox=[s[0],s[1]+r,s[0]+e,s[1]];var n=this.chartBox,a=this.DVBParameter;this.dataViewBox=[n[0]+a[0],n[1]-a[1],n[2]-a[2],n[3]+a[3]];var o=this.dataViewBox;return!(o[0]>=o[2]||o[1]<=o[3])&&(this.DVBOrigonPoint=[o[0],o[3]],this.DVBWidth=Math.abs(o[2]-o[0]),this.DVBHeight=Math.abs(o[1]-o[3]),this.DVBCenterPoint=[this.DVBOrigonPoint[0]+this.DVBWidth/2,this.DVBOrigonPoint[1]+this.DVBHeight/2],this.origonPointOffset=[this.DVBOrigonPoint[0]-s[0],this.DVBOrigonPoint[1]-s[1]],!0)}}class wa extends Sa{constructor(t,e,r,i,s){if(super(t,e),t.geometry&&t.geometry instanceof Z){this.dataBounds=t.geometry.getBounds(),this.nodesClipPixel=2,this.isHoverAble=!0,this.isMultiHover=!0,this.isClickAble=!0,this.highlightStyle=null,this.shapeOptions={},this.style=r||{},this.CLASS_NAME="SuperMap.Feature.Theme.Vector",this.style=r||{},i&&rt.copyAttributesWithClip(this,i,["shapeOptions","dataBounds"]),s&&rt.copyAttributesWithClip(this.shapeOptions,s);var n=t.geometry;this.lonlat=this.dataBounds.getCenterLonLat(),this.location=this.getLocalXY(this.lonlat),n instanceof pt?this.lineToTF(n):n instanceof ct?this.lineToTF(n):n instanceof ht||(n instanceof lt?this.multiPointToTF(n):n instanceof ft?this.multiLineStringToTF(n):n instanceof mt?this.multiPolygonToTF(n):n instanceof yt?this.polygonToTF(n):n instanceof ot||(n instanceof ut?this.pointToTF(n):n instanceof gt?this.rectangleToTF(n):n instanceof dt&&this.geoTextToTF(n)))}}destroy(){this.style=null,this.dataBounds=null,this.nodesClipPixel=null,this.isHoverAble=null,this.isMultiHover=null,this.isClickAble=null,this.highlightStyle=null,this.shapeOptions=null,super.destroy()}lineToTF(t){for(var e=t.components,r=[],i=[],s=this.location,n=[],a=this.nodesClipPixel,o=0;o<e.length;o++){var l=e[o];if(i=[],r=this.getLocalXY(l),i[0]=r[0]-s[0],i[1]=r[1]-s[1],n.length>0){var h=n[n.length-1];if(Math.abs(h[0]-i[0])<=a&&Math.abs(h[1]-i[1])<=a)continue}n.push(i)}if(n.length<2)return null;var u=new Object;(u=rt.copyAttributesWithClip(u,this.style,["pointList"])).pointList=n;var c=new ma({style:u,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(c.highlightStyle=this.highlightStyle),c.refOriginalPosition=this.location,c.refDataID=this.data.id,c.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&rt.copyAttributesWithClip(c,this.shapeOptions),this.shapes.push(c)}multiPointToTF(t){for(var e=t.components,r=[],i=[],s=this.location,n=[],a=this.nodesClipPixel,o=0;o<e.length;o++){var l=e[o];if(i=[],r=this.getLocalXY(l),i[0]=r[0]-s[0],i[1]=r[1]-s[1],n.length>0){var h=n[n.length-1];if(Math.abs(h[0]-i[0])<=a&&Math.abs(h[1]-i[1])<=a)continue}n.push(i);var u=new Object;u.r=6,(u=rt.copyAttributesWithClip(u,this.style)).x=i[0],u.y=i[1];var c=new ca({style:u,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(c.highlightStyle=this.highlightStyle),c.refOriginalPosition=s,c.refDataID=this.data.id,c.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&rt.copyAttributesWithClip(c,this.shapeOptions),this.shapes.push(c)}}multiLineStringToTF(t){for(var e=t.components,r=0;r<e.length;r++){var i=e[r];this.lineToTF(i)}}multiPolygonToTF(t){for(var e=t.components,r=0;r<e.length;r++){var i=e[r];this.polygonToTF(i)}}pointToTF(t){var e=this.location,r=this.getLocalXY(t),i=new Object;i.r=6,(i=rt.copyAttributesWithClip(i,this.style)).x=r[0]-e[0],i.y=r[1]-e[1];var s=new ca({style:i,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(s.highlightStyle=this.highlightStyle),s.refOriginalPosition=e,s.refDataID=this.data.id,s.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&rt.copyAttributesWithClip(s,this.shapeOptions),this.shapes.push(s)}polygonToTF(t){for(var e=t.components,r=[],i=[],s=this.location,n=[],a=[],o=[],l=this.nodesClipPixel,h=0;h<e.length;h++){var u=e[h].components;if(0===h){n=[];for(var c=0;c<u.length;c++){if(i=[],r=this.getLocalXY(u[c]),i[0]=r[0]-s[0],i[1]=r[1]-s[1],n.length>0){var d=n[n.length-1];if(Math.abs(d[0]-i[0])<=l&&Math.abs(d[1]-i[1])<=l)continue}n.push(i)}}else{a=[];for(var p=0;p<u.length;p++){if(i=[],r=this.getLocalXY(u[p]),i[0]=r[0]-s[0],i[1]=r[1]-s[1],a.length>0){var f=a[a.length-1];if(Math.abs(f[0]-i[0])<=l&&Math.abs(f[1]-i[1])<=l)continue}a.push(i)}}a.length<2||o.push(a)}if(!(n.length<2)){var m={};(m=rt.copyAttributesWithClip(m,this.style,["pointList"])).pointList=n;var y=new fa({style:m,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(y.highlightStyle=this.highlightStyle),y.refOriginalPosition=this.location,y.refDataID=this.data.id,y.isHoverByRefDataID=this.isMultiHover,o.length>0&&(y.holePolygonPointLists=o),this.shapeOptions&&rt.copyAttributesWithClip(y,this.shapeOptions),this.shapes.push(y)}}rectangleToTF(t){var e=this.location,r=new nt(t.x,t.y),i=this.layer.map.getResolution(),s=this.getLocalXY(r),n=new Object;n.r=6,(n=rt.copyAttributesWithClip(n,this.style)).x=s[0]-e[0],n.y=s[1]-e[1]-2*t.width/i,n.width=t.width/i,n.height=t.height/i;var a=new ga({style:n,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(a.highlightStyle=this.highlightStyle),a.refOriginalPosition=e,a.refDataID=this.data.id,a.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&rt.copyAttributesWithClip(a,this.shapeOptions),this.shapes.push(a)}geoTextToTF(t){var e=this.location,r=this.getLocalXY(t),i=new Object;i.r=6,(i=rt.copyAttributesWithClip(i,this.style,["x","y","text"])).x=r[0]-e[0],i.y=r[1]-e[1],i.text=t.text;var s=new da({style:i,clickable:this.isClickAble,hoverable:this.isHoverAble});this.highlightStyle&&(s.highlightStyle=this.highlightStyle),s.refOriginalPosition=e,s.refDataID=this.data.id,s.isHoverByRefDataID=this.isMultiHover,this.shapeOptions&&rt.copyAttributesWithClip(s,this.shapeOptions),this.shapes.push(s)}updateAndAddShapes(){var t=this.getLocalXY(this.lonlat);this.location=t;for(var e=this.layer.renderer,r=0,i=this.shapes.length;r<i;r++){var s=this.shapes[r];s.refOriginalPosition=t,e.addShape(s)}}getShapesCount(){return this.shapes.length}getLocalXY(t){return this.layer.getLocalXY(t)}}class Ca extends(H(sa,ha)){constructor(t){super(t),t=t||{},this.id=null,this.type="group",this.clipShape=null,this._children=[],this._storage=null,this.__dirty=!0,this.ignore=!1,rt.extend(this,t),this.id=this.id||rt.createUniqueID("smShapeGroup_"),this.CLASS_NAME="SuperMap.LevelRenderer.Group"}destroy(){this.id=null,this.type=null,this.clipShape=null,this._children=null,this._storage=null,this.__dirty=null,this.ignore=null,super.destroy()}children(){return this._children.slice()}childAt(t){return this._children[t]}addChild(t){t!=this&&t.parent!=this&&(t.parent&&t.parent.removeChild(t),this._children.push(t),t.parent=this,this._storage&&this._storage!==t._storage&&(this._storage.addToMap(t),t instanceof Ca&&t.addChildrenToStorage(this._storage)))}removeChild(t){var e=rt.indexOf(this._children,t);this._children.splice(e,1),t.parent=null,this._storage&&(this._storage.delFromMap(t.id),t instanceof Ca&&t.delChildrenFromStorage(this._storage))}eachChild(t,e){for(var r=!!e,i=0;i<this._children.length;i++){var s=this._children[i];r?t.call(e,s):t(s)}}traverse(t,e){for(var r=!!e,i=0;i<this._children.length;i++){var s=this._children[i];r?t.call(e,s):t(s),"group"===s.type&&s.traverse(t,e)}}addChildrenToStorage(t){for(var e=0;e<this._children.length;e++){var r=this._children[e];t.addToMap(r),"group"===r.type&&r.addChildrenToStorage(t)}}delChildrenFromStorage(t){for(var e=0;e<this._children.length;e++){var r=this._children[e];t.delFromMap(r.id),"group"===r.type&&r.delChildrenFromStorage(t)}}modSelf(){this.__dirty=!0}}class Ma{constructor(){this._elements={},this._hoverElements=[],this._roots=[],this._shapeList=[],this._shapeListOffset=0,this.CLASS_NAME="SuperMap.LevelRenderer.Storage"}destroy(){this.dispose(),this._shapeList=null,this._shapeListOffset=null}iterShape(t,e){if(!e){e={hover:!1,normal:"down",update:!1}}if(e.hover)for(var r=0,i=this._hoverElements.length;r<i;r++){var s=this._hoverElements[r];if(s.updateTransform(),t(s))return this}switch(e.update&&this.updateShapeList(),e.normal){case"down":{let e=this._shapeList.length;for(;e--;)if(t(this._shapeList[e]))return this;break}default:for(let e=0,r=this._shapeList.length;e<r;e++)if(t(this._shapeList[e]))return this}return this}getHoverShapes(t){var e=[],r=this._hoverElements.length;for(let t=0;t<r;t++){e.push(this._hoverElements[t]);var i=this._hoverElements[t].hoverConnect;if(i)for(var s,n=0,a=(i=i instanceof Array?i:[i]).length;n<a;n++)(s=i[n].id?i[n]:this.get(i[n]))&&e.push(s)}if(e.sort(Ma.shapeCompareFunc),t)for(let t=0,r=e.length;t<r;t++)e[t].updateTransform();return e}getShapeList(t){return t&&this.updateShapeList(),this._shapeList}updateShapeList(){this._shapeListOffset=0;var t=this._roots.length;for(let e=0;e<t;e++){let t=this._roots[e];this._updateAndAddShape(t)}this._shapeList.length=this._shapeListOffset;var e=this._shapeList.length;for(let t=0;t<e;t++)this._shapeList[t].__renderidx=t;this._shapeList.sort(Ma.shapeCompareFunc)}_updateAndAddShape(t,e){if(!t.ignore)if(t.updateTransform(),"group"==t.type){t.clipShape&&(t.clipShape.parent=t,t.clipShape.updateTransform(),e?(e=e.slice()).push(t.clipShape):e=[t.clipShape]);for(var r=0;r<t._children.length;r++){var i=t._children[r];i.__dirty=t.__dirty||i.__dirty,this._updateAndAddShape(i,e)}t.__dirty=!1}else t.__clipShapes=e,this._shapeList[this._shapeListOffset++]=t}mod(t,e){var r=this._elements[t];if(r&&(r.modSelf(),e))if(e.parent||e._storage||e.__startClip){var i={};for(var s in e)"parent"!=s&&"_storage"!=s&&"__startClip"!=s&&e.hasOwnProperty(s)&&(i[s]=e[s]);(new Bn).merge(r,i,!0)}else(new Bn).merge(r,e,!0);return this}drift(t,e,r){var i=this._elements[t];return i&&(i.needTransform=!0,"horizontal"===i.draggable?r=0:"vertical"===i.draggable&&(e=0),(!i.ondrift||i.ondrift&&!i.ondrift(e,r))&&i.drift(e,r)),this}addHover(t){return t.updateNeedTransform(),this._hoverElements.push(t),this}delHover(){return this._hoverElements=[],this}hasHoverShape(){return this._hoverElements.length>0}addRoot(t){t instanceof Ca&&t.addChildrenToStorage(this),this.addToMap(t),this._roots.push(t)}delRoot(t){if(void 0===t){for(var e=0;e<this._roots.length;e++){var r=this._roots[e];r instanceof Ca&&r.delChildrenFromStorage(this)}return this._elements={},this._hoverElements=[],void(this._roots=[])}if(t instanceof Array){var i=t.length;for(let e=0;e<i;e++)this.delRoot(t[e])}else{var s;s="string"==typeof t?this._elements[t]:t;var n=(new Bn).indexOf(this._roots,s);n>=0&&(this.delFromMap(s.id),this._roots.splice(n,1),s instanceof Ca&&s.delChildrenFromStorage(this))}}addToMap(t){return t instanceof Ca&&(t._storage=this),t.modSelf(),this._elements[t.id]=t,this}get(t){return this._elements[t]}delFromMap(t){var e=this._elements[t];return e&&(delete this._elements[t],e instanceof Ca&&(e._storage=null)),this}dispose(){this._elements=null,this._roots=null,this._hoverElements=null}static shapeCompareFunc(t,e){return t.zlevel==e.zlevel?t.z==e.z?t.__renderidx-e.__renderidx:t.z-e.z:t.zlevel-e.zlevel}}class Aa{constructor(t,e){this.root=t,this.storage=e,this._domRoot=null,this._layers={},this._zlevelList=[],this._layerConfig={},this._bgDom=null,this.shapeToImage=null,Aa.devicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.CLASS_NAME="SuperMap.LevelRenderer.Painter",this.root.innerHTML="",this._width=this._getWidth(),this._height=this._getHeight();var r=document.createElement("div");this._domRoot=r,r.style.position="relative",r.style.overflow="hidden",r.style.width=this._width+"px",r.style.height=this._height+"px",this.root.appendChild(r),this.shapeToImage=this._createShapeToImageProcessor(),this._bgDom=Aa.createDom(rt.createUniqueID("SuperMap.Theme_background_"),"div",this),r.appendChild(this._bgDom),this._bgDom.onselectstart=n,this._bgDom.style["-webkit-user-select"]="none",this._bgDom.style["user-select"]="none",this._bgDom.style["-webkit-touch-callout"]="none";var i=new Ta(rt.createUniqueID("_highLightLayer_"),this);this._layers.hover=i,r.appendChild(i.dom),i.initContext(),i.dom.onselectstart=n,i.dom.style["-webkit-user-select"]="none",i.dom.style["user-select"]="none",i.dom.style["-webkit-touch-callout"]="none";var s=this;function n(){return!1}this.updatePainter=function(t,e){s.refreshShapes(t,e)}}destroy(){this.dispose(),this._zlevelList=null,this._layerConfig=null,this._bgDom=null,this.shapeToImage=null}render(t){return this.refresh(t,!0),this}refresh(t,e){var r=this.storage.getShapeList(!0);return this._paintList(r,e),"function"==typeof t&&t(),this}_paintList(t,e){var r,i,s;for(var n in void 0===e&&(e=!1),this._updateLayerStatus(t),this._layers)"hover"!==n&&(this._layers[n].unusedCount++,this._layers[n].updateTransform());for(var a=[],o=0,l=t.length;o<l;o++){var h=t[o];if(i!==h.zlevel&&(r&&r.needTransform&&s.restore(),s=(r=this.getLayer(h.zlevel)).ctx,i=h.zlevel,r.unusedCount=0,(r.dirty||e)&&r.clear(),r.needTransform&&(s.save(),r.setTransform(s))),s&&h.__startClip){var u=h.__startClip;if(s.save(),u.needTransform){let t=u.transform;la.Util_matrix.invert(a,t),s.transform(t[0],t[1],t[2],t[3],t[4],t[5])}if(s.beginPath(),u.buildPath(s,u.style),s.clip(),u.needTransform){let t=a;s.transform(t[0],t[1],t[2],t[3],t[4],t[5])}}if((r&&r.dirty||e)&&!h.invisible&&(!h.onbrush||h.onbrush&&!h.onbrush(s,!1)))if(oa.catchBrushException)try{h.brush(s,!1,this.updatePainter)}catch(t){la.Util_log(t,"brush error of "+h.type,h)}else h.brush(s,!1,this.updatePainter);s&&h.__stopClip&&s.restore(),h.__dirty=!1}s&&r&&r.needTransform&&s.restore();for(let t in this._layers)if("hover"!==t){var c=this._layers[t];c.dirty=!1,1==c.unusedCount&&c.clear()}}getLayer(t){var e=this._layers[t];if(!e){var r=this._zlevelList.length,i=null,s=-1;if(r>0&&t>this._zlevelList[0]){for(s=0;s<r-1&&!(this._zlevelList[s]<t&&this._zlevelList[s+1]>t);s++);i=this._layers[this._zlevelList[s]]}this._zlevelList.splice(s+1,0,t),e=new Ta(rt.createUniqueID("_levelLayer_"+t),this);var n=i?i.dom:this._bgDom;n.nextSibling?n.parentNode.insertBefore(e.dom,n.nextSibling):n.parentNode.appendChild(e.dom),e.initContext(),this._layers[t]=e,this._layerConfig[t]&&(new Bn).merge(e,this._layerConfig[t],!0),e.updateTransform()}return e}getLayers(){return this._layers}_updateLayerStatus(t){var e=this._layers,r={};for(let t in e)"hover"!==t&&(r[t]=e[t].elCount,e[t].elCount=0);for(let r=0;r<t.length;r++){var i=t[r],s=e[i.zlevel];if(s){if(s.elCount++,s.dirty)continue;s.dirty=i.__dirty}}for(let t in e)"hover"!==t&&r[t]!==e[t].elCount&&(e[t].dirty=!0)}refreshShapes(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];this.storage.mod(s.id)}return this.refresh(e),this}clear(){for(var t in this._layers)"hover"!=t&&this._layers[t].clear();return this}modLayer(t,e){if(e){this._layerConfig[t]?(new Bn).merge(this._layerConfig[t],e,!0):this._layerConfig[t]=e;var r=this._layers[t];r&&(new Bn).merge(r,this._layerConfig[t],!0)}}delLayer(t){var e=this._layers[t];e&&(this.modLayer(t,{position:e.position,rotation:e.rotation,scale:e.scale}),e.dom.parentNode.removeChild(e.dom),delete this._layers[t],this._zlevelList.splice((new Bn).indexOf(this._zlevelList,t),1))}refreshHover(){this.clearHover();for(var t=this.storage.getHoverShapes(!0),e=0,r=t.length;e<r;e++)this._brushHover(t[e]);return this.storage.delHover(),this}clearHover(){var t=this._layers.hover;return t&&t.clear(),this}resize(){var t=this._domRoot;t.style.display="none";var e=this._getWidth(),r=this._getHeight();if(t.style.display="",this._width!=e||r!=this._height){for(var i in this._width=e,this._height=r,t.style.width=e+"px",t.style.height=r+"px",this._layers)this._layers[i].resize(e,r);this.refresh(null,!0)}return this}clearLayer(t){var e=this._layers[t];e&&e.clear()}dispose(){this.root.innerHTML="",this.root=null,this.storage=null,this._domRoot=null,this._layers=null}getDomHover(){return this._layers.hover.dom}toDataURL(t,e,r){var i=Aa.createDom(rt.createUniqueID("SuperMap.Theme.image_"),"canvas",this);this._bgDom.appendChild(i);var s=i.getContext("2d");1!=Aa.devicePixelRatio&&s.scale(Aa.devicePixelRatio,Aa.devicePixelRatio),s.fillStyle=e||"#fff",s.rect(0,0,this._width*Aa.devicePixelRatio,this._height*Aa.devicePixelRatio),s.fill();var n=this;this.storage.iterShape(function(t){if(!t.invisible&&(!t.onbrush||t.onbrush&&!t.onbrush(s,!1)))if(oa.catchBrushException)try{t.brush(s,!1,n.updatePainter)}catch(e){la.Util_log(e,"brush error of "+t.type,t)}else t.brush(s,!1,n.updatePainter)},{normal:"up",update:!0});var a=i.toDataURL(t,r);return s=null,this._bgDom.removeChild(i),a}getWidth(){return this._width}getHeight(){return this._height}_getWidth(){var t=this.root,e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientWidth||parseInt(e.width,10))-parseInt(e.paddingLeft,10)-parseInt(e.paddingRight,10)).toFixed(0)-0}_getHeight(){var t=this.root,e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientHeight||parseInt(e.height,10))-parseInt(e.paddingTop,10)-parseInt(e.paddingBottom,10)).toFixed(0)-0}_brushHover(t){var e=this._layers.hover.ctx;if(!t.onbrush||t.onbrush&&!t.onbrush(e,!0)){var r=this.getLayer(t.zlevel);if(r.needTransform&&(e.save(),r.setTransform(e)),oa.catchBrushException)try{t.brush(e,!0,this.updatePainter)}catch(e){la.Util_log(e,"hoverBrush error of "+t.type,t)}else t.brush(e,!0,this.updatePainter);r.needTransform&&e.restore()}}_shapeToImage(t,e,r,i,s){var n=document.createElement("canvas"),a=n.getContext("2d"),o=s||window.devicePixelRatio||1;n.style.width=r+"px",n.style.height=i+"px",n.setAttribute("width",r*o),n.setAttribute("height",i*o),a.clearRect(0,0,r*o,i*o);var l={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[0,0,0],e.rotation=0,e.scale=[1,1],e&&e.brush(a,!1);var h=new ya({id:t,style:{x:0,y:0,image:n}});return null!=l.position&&(h.position=e.position=l.position),null!=l.rotation&&(h.rotation=e.rotation=l.rotation),null!=l.scale&&(h.scale=e.scale=l.scale),h}_createShapeToImageProcessor(){var t=this;return function(e,r,i,s){return t._shapeToImage(e,r,i,s,Aa.devicePixelRatio)}}updateHoverLayer(t){if(!(t instanceof Array))return this;this.clearHover(),this.storage.delHover();for(var e=0;e<t.length;e++)this.storage.addHover(t[e]),this._brushHover(t[e])}static createDom(t,e,r){var i=document.createElement(e),s=r._width,n=r._height;return i.style.position="absolute",i.style.left=0,i.style.top=0,i.style.width=s+"px",i.style.height=n+"px",i.setAttribute("width",s*Aa.devicePixelRatio),i.setAttribute("height",n*Aa.devicePixelRatio),i.setAttribute("id",t),i}}class Ta extends ha{constructor(t,e){super(t,e),this.dom=null,this.domBack=null,this.ctxBack=null,this.painter=e,this.unusedCount=0,this.config=null,this.dirty=!0,this.elCount=0,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.zoomable=!1,this.panable=!1,this.maxZoom=1/0,this.minZoom=0,this.ctx=null,this.dom=Aa.createDom(rt.createUniqueID("SuperMap.Theme"+t),"canvas",e),this.dom.onselectstart=function(){return!1},this.dom.style["-webkit-user-select"]="none",this.dom.style["user-select"]="none",this.dom.style["-webkit-touch-callout"]="none",this.CLASS_NAME="SuperMap.LevelRenderer.Painter.Layer"}destroy(){this.dom=null,this.domBack=null,this.ctxBack=null,this.painter=null,this.unusedCount=null,this.config=null,this.dirty=null,this.elCount=null,this.clearColor=null,this.motionBlur=null,this.lastFrameAlpha=null,this.zoomable=null,this.panable=null,this.maxZoom=null,this.minZoom=null,this.ctx=null,ha.destroy.apply(this,arguments)}initContext(){this.ctx=this.dom.getContext("2d"),1!=Aa.devicePixelRatio&&this.ctx.scale(Aa.devicePixelRatio,Aa.devicePixelRatio)}createBackBuffer(){this.domBack=Aa.createDom(rt.createUniqueID("SuperMap.Theme.back-"+this.id),"canvas",this.painter),this.ctxBack=this.domBack.getContext("2d"),1!=Aa.devicePixelRatio&&this.ctxBack.scale(Aa.devicePixelRatio,Aa.devicePixelRatio)}resize(t,e){this.dom.style.width=t+"px",this.dom.style.height=e+"px",this.dom.setAttribute("width",t*Aa.devicePixelRatio),this.dom.setAttribute("height",e*Aa.devicePixelRatio),1!=Aa.devicePixelRatio&&this.ctx.scale(Aa.devicePixelRatio,Aa.devicePixelRatio),this.domBack&&(this.domBack.setAttribute("width",t*Aa.devicePixelRatio),this.domBack.setAttribute("height",e*Aa.devicePixelRatio),1!=Aa.devicePixelRatio&&this.ctxBack.scale(Aa.devicePixelRatio,Aa.devicePixelRatio))}clear(){var t=this.dom,e=this.ctx,r=t.width,i=t.height,s=this.clearColor,n=this.motionBlur,a=this.lastFrameAlpha;if(n&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(t,0,0,r/Aa.devicePixelRatio,i/Aa.devicePixelRatio)),s?(e.save(),e.fillStyle=this.config.clearColor,e.fillRect(0,0,r/Aa.devicePixelRatio,i/Aa.devicePixelRatio),e.restore()):e.clearRect(0,0,r/Aa.devicePixelRatio,i/Aa.devicePixelRatio),n){var o=this.domBack;e.save(),e.globalAlpha=a,e.drawImage(o,0,0,r/Aa.devicePixelRatio,i/Aa.devicePixelRatio),e.restore()}}}class Ea extends sa{constructor(t,e,r){var i,s;super(t,e,r),this.root=t,this.storage=e,this.painter=r,this._lastX=0,this._lastY=0,this._mouseX=0,this._mouseY=0,this._findHover=null,this._domHover=null,this._findHover=(i=function(t,e,r){var i=this;if(i._draggingTarget&&i._draggingTarget.id==t.id||t.isSilent())return!1;var s=i._event;if(t.isCover(e,r)){if(t.hoverable)if(t.isHoverByRefDataID&&!0===t.isHoverByRefDataID){if(t.refDataID){var n=t.refDataID,a=null;t.refDataHoverGroup&&(a=t.refDataHoverGroup);for(var o=i.storage._shapeList,l=0,h=o.length;l<h;l++){var u=o[l];u.refDataID&&n===u.refDataID&&(a?u.refDataHoverGroup&&a===u.refDataHoverGroup&&i.storage.addHover(u):i.storage.addHover(u))}}}else i.storage.addHover(t);for(var c=t.parent;c;){if(c.clipShape&&!c.clipShape.isCover(i._mouseX,i._mouseY))return!1;c=c.parent}return i._lastHover!=t&&(i._processOutShape(s),i._processDragLeave(s),i._lastHover=t,i._processDragEnter(s)),i._processOverShape(s),i._processDragOver(s),i._hasfound=1,!0}return!1},s=this,function(t,e,r){return i.call(s,t,e,r)}),this._domHover=r.getDomHover(),this.CLASS_NAME="SuperMap.LevelRenderer.Handler";var n={resize:function(t){t=t||window.event,this._lastHover=null,this._isMouseDown=0,this.dispatch(oa.EVENT.RESIZE,t)},click:function(t){t=this._zrenderEventFixed(t);var e=this._lastHover;(e&&e.clickable||!e)&&this._clickThreshold<10&&this._dispatchAgency(e,oa.EVENT.CLICK,t),this._mousemoveHandler(t)},dblclick:function(t){t=t||window.event,t=this._zrenderEventFixed(t);var e=this._lastHover;(e&&e.clickable||!e)&&this._clickThreshold<5&&this._dispatchAgency(e,oa.EVENT.DBLCLICK,t),this._mousemoveHandler(t)},mousewheel:function(t){var e=((t=this._zrenderEventFixed(t)).wheelDelta||-t.detail)>0?1.1:1/1.1,r=this.painter.getLayers(),i=!1;for(var s in r)if("hover"!==s){var n=r[s],a=n.position;if(n.zoomable){n.__zoom=n.__zoom||1;var o=n.__zoom;o*=e,e=(o=Math.max(Math.min(n.maxZoom,o),n.minZoom))/n.__zoom,n.__zoom=o,a[0]-=(this._mouseX-a[0])*(e-1),a[1]-=(this._mouseY-a[1])*(e-1),n.scale[0]*=e,n.scale[1]*=e,n.dirty=!0,i=!0}}i&&this.painter.refresh(),this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEWHEEL,t),this._mousemoveHandler(t)},mousemove:function(t){this._clickThreshold++,t=this._zrenderEventFixed(t),this._lastX=this._mouseX,this._lastY=this._mouseY,this._mouseX=la.Util_event.getX(t),this._mouseY=la.Util_event.getY(t);var e=this._mouseX-this._lastX,r=this._mouseY-this._lastY;this._processDragStart(t),this._hasfound=0,this._event=t,this._iterateAndFindHover(),this._hasfound||((!this._draggingTarget||this._lastHover&&this._lastHover!=this._draggingTarget)&&(this._processOutShape(t),this._processDragLeave(t)),this._lastHover=null,this.storage.delHover(),this.painter.clearHover());var i="";if(this._draggingTarget)this.storage.drift(this._draggingTarget.id,e,r),this._draggingTarget.modSelf(),this.storage.addHover(this._draggingTarget);else if(this._isMouseDown){var s=this.painter.getLayers(),n=!1;for(var a in s)if("hover"!==a){var o=s[a];o.panable&&(i="move",o.position[0]+=e,o.position[1]+=r,n=!0,o.dirty=!0)}n&&this.painter.refresh()}this._draggingTarget||this._hasfound&&this._lastHover.draggable?i="move":this._hasfound&&this._lastHover.clickable&&(i="pointer"),this.root.style.cursor=i,this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEMOVE,t),(this._draggingTarget||this._hasfound||this.storage.hasHoverShape())&&this.painter.refreshHover()},mouseout:function(t){var e=(t=this._zrenderEventFixed(t)).toElement||t.relatedTarget;if(e!=this.root)for(;e&&9!=e.nodeType;){if(e==this.root)return void this._mousemoveHandler(t);e=e.parentNode}t.zrenderX=this._lastX,t.zrenderY=this._lastY,this.root.style.cursor="",this._isMouseDown=0,this._processOutShape(t),this._processDrop(t),this._processDragEnd(t),this.painter.refreshHover(),this.dispatch(oa.EVENT.GLOBALOUT,t)},mousedown:function(t){if(this._clickThreshold=0,2==this._lastDownButton)return this._lastDownButton=t.button,void(this._mouseDownTarget=null);this._lastMouseDownMoment=new Date,t=this._zrenderEventFixed(t),this._isMouseDown=1,this._mouseDownTarget=this._lastHover,this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEDOWN,t),this._lastDownButton=t.button},mouseup:function(t){t=this._zrenderEventFixed(t),this.root.style.cursor="",this._isMouseDown=0,this._mouseDownTarget=null,this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEUP,t),this._processDrop(t),this._processDragEnd(t)},touchstart:function(t){t=this._zrenderEventFixed(t,!0),this._lastTouchMoment=new Date,this._mobildFindFixed(t),this._mousedownHandler(t)},touchmove:function(t){t=this._zrenderEventFixed(t,!0),this._mousemoveHandler(t),this._isDragging&&la.Util_event.stop(t)},touchend:function(t){t=this._zrenderEventFixed(t,!0),this._mouseupHandler(t);var e=new Date;e-this._lastTouchMoment<oa.EVENT.touchClickDelay&&(this._mobildFindFixed(t),this._clickHandler(t),e-this._lastClickMoment<oa.EVENT.touchClickDelay/2&&(this._dblclickHandler(t),this._lastHover&&this._lastHover.clickable&&la.Util_event.stop(t)),this._lastClickMoment=e),this.painter.clearHover()}};function a(t,e){return function(r){return t.call(e,r)}}!function(t){var e=["resize","click","dblclick","mousewheel","mousemove","mouseout","mouseup","mousedown","touchstart","touchend","touchmove"],r=e.length;for(;r--;){var i=e[r];t["_"+i+"Handler"]=a(n[i],t)}}(this),window.addEventListener?(window.addEventListener("resize",this._resizeHandler),la.Util_env.os.tablet||la.Util_env.os.phone?(t.addEventListener("touchstart",this._touchstartHandler),t.addEventListener("touchmove",this._touchmoveHandler),t.addEventListener("touchend",this._touchendHandler)):(t.addEventListener("click",this._clickHandler),t.addEventListener("dblclick",this._dblclickHandler),t.addEventListener("mousewheel",this._mousewheelHandler),t.addEventListener("mousemove",this._mousemoveHandler),t.addEventListener("mousedown",this._mousedownHandler),t.addEventListener("mouseup",this._mouseupHandler)),t.addEventListener("DOMMouseScroll",this._mousewheelHandler),t.addEventListener("mouseout",this._mouseoutHandler)):(window.attachEvent("onresize",this._resizeHandler),t.attachEvent("onclick",this._clickHandler),t.ondblclick=this._dblclickHandler,t.attachEvent("onmousewheel",this._mousewheelHandler),t.attachEvent("onmousemove",this._mousemoveHandler),t.attachEvent("onmouseout",this._mouseoutHandler),t.attachEvent("onmousedown",this._mousedownHandler),t.attachEvent("onmouseup",this._mouseupHandler))}destroy(){this.dispose(),this._lastX=null,this._lastY=null,this._mouseX=null,this._mouseY=null,this._findHover=null,sa.prototype.destroy.apply(this,arguments)}on(t,e){return this.bind(t,e),this}un(t,e){return this.unbind(t,e),this}trigger(t,e){var r=oa.EVENT;switch(t){case r.RESIZE:case r.CLICK:case r.DBLCLICK:case r.MOUSEWHEEL:case r.MOUSEMOVE:case r.MOUSEDOWN:case r.MOUSEUP:case r.MOUSEOUT:this["_"+t+"Handler"](e)}}dispose(){var t=this.root;window.removeEventListener?(window.removeEventListener("resize",this._resizeHandler),la.Util_env.os.tablet||la.Util_env.os.phone?(t.removeEventListener("touchstart",this._touchstartHandler),t.removeEventListener("touchmove",this._touchmoveHandler),t.removeEventListener("touchend",this._touchendHandler)):(t.removeEventListener("click",this._clickHandler),t.removeEventListener("dblclick",this._dblclickHandler),t.removeEventListener("mousewheel",this._mousewheelHandler),t.removeEventListener("mousemove",this._mousemoveHandler),t.removeEventListener("mousedown",this._mousedownHandler),t.removeEventListener("mouseup",this._mouseupHandler)),t.removeEventListener("DOMMouseScroll",this._mousewheelHandler),t.removeEventListener("mouseout",this._mouseoutHandler)):(window.detachEvent("onresize",this._resizeHandler),t.detachEvent("onclick",this._clickHandler),t.detachEvent("dblclick",this._dblclickHandler),t.detachEvent("onmousewheel",this._mousewheelHandler),t.detachEvent("onmousemove",this._mousemoveHandler),t.detachEvent("onmouseout",this._mouseoutHandler),t.detachEvent("onmousedown",this._mousedownHandler),t.detachEvent("onmouseup",this._mouseupHandler)),this.root=null,this._domHover=null,this.storage=null,this.painter=null,this.un()}_processDragStart(t){var e=this._lastHover;if(this._isMouseDown&&e&&e.draggable&&!this._draggingTarget&&this._mouseDownTarget==e){if(e.dragEnableTime&&new Date-this._lastMouseDownMoment<e.dragEnableTime)return;var r=e;this._draggingTarget=r,this._isDragging=1,r.invisible=!0,this.storage.mod(r.id),this._dispatchAgency(r,oa.EVENT.DRAGSTART,t),this.painter.refresh()}}_processDragEnter(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,oa.EVENT.DRAGENTER,t,this._draggingTarget)}_processDragOver(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,oa.EVENT.DRAGOVER,t,this._draggingTarget)}_processDragLeave(t){this._draggingTarget&&this._dispatchAgency(this._lastHover,oa.EVENT.DRAGLEAVE,t,this._draggingTarget)}_processDrop(t){this._draggingTarget&&(this._draggingTarget.invisible=!1,this.storage.mod(this._draggingTarget.id),this.painter.refresh(),this._dispatchAgency(this._lastHover,oa.EVENT.DROP,t,this._draggingTarget))}_processDragEnd(t){this._draggingTarget&&(this._dispatchAgency(this._draggingTarget,oa.EVENT.DRAGEND,t),this._lastHover=null),this._isDragging=0,this._draggingTarget=null}_processOverShape(t){this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEOVER,t)}_processOutShape(t){this._dispatchAgency(this._lastHover,oa.EVENT.MOUSEOUT,t)}_dispatchAgency(t,e,r,i){var s="on"+e,n={type:e,event:r,target:t,cancelBubble:!1},a=t;for(i&&(n.dragged=i);a&&(a[s]&&(n.cancelBubble=a[s](n)),a.dispatch(e,n),a=a.parent,!n.cancelBubble););t?n.cancelBubble||this.dispatch(e,n):i||this.dispatch(e,{type:e,event:r})}_iterateAndFindHover(){for(var t,e=la.Util_matrix.create(),r=this.storage.getShapeList(),i=[0,0],s=r.length-1;s>=0;s--){var n=r[s];if(void 0!==n.zlevel&&(t=this.painter.getLayer(n.zlevel,t),i[0]=this._mouseX,i[1]=this._mouseY,t.needTransform&&(la.Util_matrix.invert(e,t.transform),la.Util_vector.applyTransform(i,i,e))),this._findHover(n,i[0],i[1]))break}}_mobildFindFixed(t){var e=[{x:10},{x:-20},{x:10,y:10},{y:-20}];this._lastHover=null,this._mouseX=t.zrenderX,this._mouseY=t.zrenderY,this._event=t,this._iterateAndFindHover();for(var r=0;!this._lastHover&&r<e.length;r++){var i=e[r];i.x&&(this._mouseX+=i.x),i.y&&(this._mouseX+=i.y),this._iterateAndFindHover()}this._lastHover&&(t.zrenderX=this._mouseX,t.zrenderY=this._mouseY)}_zrenderEventFixed(t,e){if(t.zrenderFixed)return t;if(e){var r="touchend"!=t.type?t.targetTouches[0]:t.changedTouches[0];if(r){var i=this.root.getBoundingClientRect();t.zrenderX=r.clientX-i.left,t.zrenderY=r.clientY-i.top}}else{var s=(t=t||window.event).toElement||t.relatedTarget||t.srcElement||t.target;s&&s!=this._domHover&&(t.zrenderX=(void 0!==t.offsetX?t.offsetX:t.layerX)+s.offsetLeft,t.zrenderY=(void 0!==t.offsetY?t.offsetY:t.layerY)+s.offsetTop)}return t.zrenderFixed=1,t}getLastHoverOne(){return this._lastHover?this._lastHover:null}}class Oa{constructor(){this.CLASS_NAME="SuperMap.LevelRenderer.Animation.easing"}destroy(){}Linear(t){return t}QuadraticIn(t){return t*t}QuadraticOut(t){return t*(2-t)}QuadraticInOut(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}CubicIn(t){return t*t*t}CubicOut(t){return--t*t*t+1}CubicInOut(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}QuarticIn(t){return t*t*t*t}QuarticOut(t){return 1- --t*t*t*t}QuarticInOut(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}QuinticIn(t){return t*t*t*t*t}QuinticOut(t){return--t*t*t*t*t+1}QuinticInOut(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}SinusoidalIn(t){return 1-Math.cos(t*Math.PI/2)}SinusoidalOut(t){return Math.sin(t*Math.PI/2)}SinusoidalInOut(t){return.5*(1-Math.cos(Math.PI*t))}ExponentialIn(t){return 0===t?0:Math.pow(1024,t-1)}ExponentialOut(t){return 1===t?1:1-Math.pow(2,-10*t)}ExponentialInOut(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}CircularIn(t){return 1-Math.sqrt(1-t*t)}CircularOut(t){return Math.sqrt(1- --t*t)}CircularInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}ElasticIn(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))}ElasticOut(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)}ElasticInOut(t){var e,r=.1;return 0===t?0:1===t?1:(r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}BackIn(t){var e=1.70158;return t*t*((e+1)*t-e)}BackOut(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}BackInOut(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}BounceIn(t){return 1-this.BounceOut(1-t)}BounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}BounceInOut(t){return t<.5?.5*this.BounceIn(2*t):.5*this.BounceOut(2*t-1)+.5}}class La{constructor(t){this._targetPool=t.target||{},this._targetPool instanceof Array||(this._targetPool=[this._targetPool]),this._life=t.life||1e3,this._delay=t.delay||0,this._startTime=(new Date).getTime()+this._delay,this._endTime=this._startTime+1e3*this._life,this.loop=void 0!==t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"Linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart,this.CLASS_NAME="SuperMap.LevelRenderer.Animation.Clip"}destroy(){}step(t){var e=new Oa,r=(t-this._startTime)/this._life;if(!(r<0)){r=Math.min(r,1);var i="string"==typeof this.easing?e[this.easing]:this.easing,s="function"==typeof i?i(r):r;return this.fire("frame",s),1==r?this.loop?(this.restart(),"restart"):(this._needsRemove=!0,"destroy"):null}}restart(){var t=((new Date).getTime()-this._startTime)%this._life;this._startTime=(new Date).getTime()-t+this.gap}fire(t,e){for(var r=0,i=this._targetPool.length;r<i;r++)this["on"+t]&&this["on"+t](this._targetPool[r],e)}}class Pa extends sa{constructor(t){super(t),t=t||{},this.stage={},this.onframe=function(){},this._clips=[],this._running=!1,this._time=0,rt.extend(this,t),this.CLASS_NAME="SuperMap.LevelRenderer.Animation"}add(t){this._clips.push(t)}remove(t){var e=(new Bn).indexOf(this._clips,t);e>=0&&this._clips.splice(e,1)}_update(){var t=(new Date).getTime(),e=t-this._time,r=this._clips,i=r.length,s=[],n=[];for(let e=0;e<i;e++){var a=r[e],o=a.step(t);o&&(s.push(o),n.push(a))}this.stage.update&&this.stage.update();for(let t=0;t<i;)r[t]._needsRemove?(r[t]=r[i-1],r.pop(),i--):t++;i=s.length;for(let t=0;t<i;t++)n[t].fire(s[t]);this._time=t,this.onframe(e),this.dispatch("frame",e)}start(){var t=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},e=this;this._running=!0,this._time=(new Date).getTime(),t(function r(){e._running&&(e._update(),t(r))})}stop(){this._running=!1}clear(){this._clips=[]}animate(t,e){var r=new Na(t,(e=e||{}).loop,e.getter,e.setter);return r.animation=this,r}static _interpolateNumber(t,e,r){return(e-t)*r+t}static _interpolateArray(t,e,r,i,s){var n=t.length;if(1==s)for(let s=0;s<n;s++)i[s]=Pa._interpolateNumber(t[s],e[s],r);else{var a=t[0].length;for(let s=0;s<n;s++)for(let n=0;n<a;n++)i[s][n]=Pa._interpolateNumber(t[s][n],e[s][n],r)}}static _isArrayLike(t){switch(typeof t){case"undefined":case"string":return!1}return void 0!==t.length}static _catmullRomInterpolateArray(t,e,r,i,s,n,a,o,l){var h=t.length;if(1==l)for(let l=0;l<h;l++)o[l]=Pa._catmullRomInterpolate(t[l],e[l],r[l],i[l],s,n,a);else{var u=t[0].length;for(let l=0;l<h;l++)for(var c=0;c<u;c++)o[l][c]=Pa._catmullRomInterpolate(t[l][c],e[l][c],r[l][c],i[l][c],s,n,a)}}static _catmullRomInterpolate(t,e,r,i,s,n,a){var o=.5*(r-t),l=.5*(i-e);return(2*(e-r)+o+l)*a+(-3*(e-r)-2*o-l)*n+o*s+e}static _cloneValue(t){var e=Array.prototype.slice;if(Pa._isArrayLike(t)){var r=t.length;if(Pa._isArrayLike(t[0])){for(var i=[],s=0;s<r;s++)i.push(e.call(t[s]));return i}return e.call(t)}return t}static rgba2String(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}}class Na{constructor(t,e,r,i){this._tracks={},this._target=t,this._loop=e||!1,this._getter=r||function(t,e){return t[e]},this._setter=i||function(t,e,r){t[e]=r},this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[],this.CLASS_NAME="SuperMap.LevelRenderer.Animation.Animator"}when(t,e){for(var r in e)this._tracks[r]||(this._tracks[r]=[],0!==t&&this._tracks[r].push({time:0,value:Pa._cloneValue(this._getter(this._target,r))})),this._tracks[r].push({time:parseInt(t,10),value:e[r]});return this}during(t){return this._onframeList.push(t),this}start(t){var e=this,r=this._setter,i=this._getter,s=e._onframeList.length,n="spline"===t,a=function(){if(e._clipCount--,0===e._clipCount){e._tracks={};for(var t=e._doneList.length,r=0;r<t;r++)e._doneList[r].call(e)}},o=function(o,l){var h=o.length;if(h){var u=o[0].value,c=Pa._isArrayLike(u),d=!1,p=c&&Pa._isArrayLike(u[0])?2:1;o.sort(function(t,e){return t.time-e.time});var f=o[h-1].time,m=[],y=[];for(let t=0;t<h;t++){m.push(o[t].time/f);var g=o[t].value;"string"==typeof g&&(0===(g=la.Util_color.toArray(g)).length&&(g[0]=g[1]=g[2]=0,g[3]=1),d=!0),y.push(g)}var v,b,S,_,x,w,C,M=0,A=0;if(d)var T=[0,0,0,0];var E=new La({target:e._target,life:f,loop:e._loop,delay:e._delay,onframe:function(t,a){if(a<A){for(v=Math.min(M+1,h-1),b=v;b>=0&&!(m[b]<=a);b--);b=Math.min(b,h-2)}else{for(b=M;b<h&&!(m[b]>a);b++);b=Math.min(b-1,h-2)}M=b,A=a;var o=m[b+1]-m[b];if(0!==o){if(S=(a-m[b])/o,n)if(x=y[b],_=y[0===b?b:b-1],w=y[b>h-2?h-1:b+1],C=y[b>h-3?h-1:b+2],c)Pa._catmullRomInterpolateArray(_,x,w,C,S,S*S,S*S*S,i(t,l),p);else{let e;e=d?Pa.rgba2String(T):Pa._catmullRomInterpolate(_,x,w,C,S,S*S,S*S*S),r(t,l,e)}else if(c)Pa._interpolateArray(y[b],y[b+1],S,i(t,l),p);else{let e;d?(Pa._interpolateArray(y[b],y[b+1],S,T,1),e=Pa.rgba2String(T)):e=Pa._interpolateNumber(y[b],y[b+1],S),r(t,l,e)}for(b=0;b<s;b++)e._onframeList[b](t,a)}},ondestroy:a});t&&"spline"!==t&&(E.easing=t),e._clipList.push(E),e._clipCount++,e.animation.add(E)}};for(var l in this._tracks)o(this._tracks[l],l);return this}stop(){for(var t=0;t<this._clipList.length;t++){var e=this._clipList[t];this.animation.remove(e)}this._clipList=[]}delay(t){return this._delay=t,this}done(t){return t&&this._doneList.push(t),this}}class Ia{constructor(t,e){this.id=t,this.storage=new Ma,this.painter=new Aa(e,this.storage),this.handler=new Ea(e,this.storage,this.painter),this.animatingElements=[],this.animation=new Pa({stage:{update:Ia.getFrameCallback(this)}}),this._needsRefreshNextFrame=!1,this.animation.start(),this.CLASS_NAME="SuperMap.LevelRenderer.Render"}destroy(){this.id=null,this.storage=null,this.painter=null,this.handler=null,this.animatingElements=null,this.animation=null,this._needsRefreshNextFrame=null}getId(){return this.id}addShape(t){return this.storage.addRoot(t),this}addGroup(t){return this.storage.addRoot(t),this}delShape(t){return this.storage.delRoot(t),this}delGroup(t){return this.storage.delRoot(t),this}modShape(t,e){return this.storage.mod(t,e),this}modGroup(t,e){return this.storage.mod(t,e),this}modLayer(t,e){return this.painter.modLayer(t,e),this}addHoverShape(t){return this.storage.addHover(t),this}render(t){return this.painter.render(t),this._needsRefreshNextFrame=!1,this}refresh(t){return this.painter.refresh(t),this._needsRefreshNextFrame=!1,this}refreshNextFrame(){return this._needsRefreshNextFrame=!0,this}refreshHover(t){return this.painter.refreshHover(t),this}refreshShapes(t,e){return this.painter.refreshShapes(t,e),this}resize(){return this.painter.resize(),this}animate(t,e,r){if("string"==typeof t&&(t=this.storage.get(t)),t){var i;if(e){for(var s=e.split("."),n=t,a=0,o=s.length;a<o;a++)n&&(n=n[s[a]]);n&&(i=n)}else i=t;if(!i)return void la.Util_log('Property "'+e+'" is not existed in element '+t.id);var l=this.animatingElements;return void 0===t.__aniCount&&(t.__aniCount=0),0===t.__aniCount&&l.push(t),t.__aniCount++,this.animation.animate(i,{loop:r}).done(function(){if(t.__aniCount--,0===t.__aniCount){var e=(new Bn).indexOf(l,t);l.splice(e,1)}})}la.Util_log("Element not existed")}clearAnimation(){this.animation.clear()}getWidth(){return this.painter.getWidth()}getHeight(){return this.painter.getHeight()}toDataURL(t,e,r){return this.painter.toDataURL(t,e,r)}shapeToImage(t,e,r){var i=rt.createUniqueID("SuperMap.LevelRenderer.ToImage_");return this.painter.shapeToImage(i,t,e,r)}on(t,e){return this.handler.on(t,e),this}un(t,e){return this.handler.un(t,e),this}trigger(t,e){return this.handler.trigger(t,e),this.handler.dispatch(t,e),this}clear(){return this.storage.delRoot(),this.painter.clear(),this}dispose(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=null,this.animatingElements=null,this.storage=null,this.painter=null,this.handler=null}updateHoverShapes(t){return this.painter.updateHoverLayer(t),this}getAllShapes(){return this.storage._shapeList}clearAll(){return this.clear(),this.painter.clearHover(),this}getHoverOne(){return this.handler.getLastHoverOne()}static getFrameCallback(t){return function(){var e=t.animatingElements;if(e instanceof Array){for(var r=0,i=e.length;r<i;r++)t.storage.mod(e[r].id);(e.length||t._needsRefreshNextFrame)&&t.refresh()}}}}class Fa{constructor(){Fa._instances={},Fa.Tool={},this.version="2.0.4",this.CLASS_NAME="SuperMap.LevelRenderer"}destroy(){this.dispose(),this.version=null}init(t){var e=new Ia(rt.createUniqueID("LRenderer_"),t);return Fa._instances[e.id]=e,e}dispose(t){if(t)t.dispose(),this.delInstance(t.id);else{for(var e in Fa._instances)Fa._instances[e].dispose();Fa._instances={}}return this}getInstance(t){return Fa._instances[t]}delInstance(t){return delete Fa._instances[t],this}}function ka(t,e,r){if(t===r||t===e)return t;let i=r-e;return((t-e)%i+i)%i+e}function Da(t){return t*Math.PI/180}Math.PI,Math.PI;const Ra={EXCEL:"EXCEL",CSV:"CSV",ISERVER:"ISERVER",GEOJSON:"GEOJSON",JSON:"JSON"},Ba={fileMaxSize:10485760};class Ga{constructor(){this._initView()}_initView(){const t=document.createElement("div");t.hidden=!0,t.setAttribute("class","component-messageboxcontainer component-border-bottom-orange");const e=document.createElement("div");e.setAttribute("class","icon"),this.icon=document.createElement("span"),this.icon.setAttribute("class","supermapol-icons-message-warning"),e.appendChild(this.icon),t.appendChild(e);const r=document.createElement("div");r.setAttribute("class","component-messagebox"),r.innerHTML="",t.appendChild(r),this.messageBox=r;const i=document.createElement("div");i.setAttribute("class","component-messagebox__cancelbtncontainer");const s=document.createElement("button");s.setAttribute("class","component-messagebox__cancelBtn"),s.innerHTML="x",s.onclick=this.closeView.bind(this),i.appendChild(s),t.appendChild(i),this.messageBoxContainer=t,document.body.appendChild(this.messageBoxContainer)}closeView(){this.messageBoxContainer.hidden=!0}showView(t,e="warring"){"success"===e?(this.icon.setAttribute("class","supermapol-icons-message-success"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-green")):"failure"===e?(this.icon.setAttribute("class","supermapol-icons-message-failure"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-red")):"warring"===e&&(this.icon.setAttribute("class","supermapol-icons-message-warning"),this.messageBoxContainer.setAttribute("class","component-messageboxcontainer component-border-bottom-orange")),this.messageBox.innerHTML=t,this.messageBoxContainer.hidden=!1}}const Ua=function(){try{return echarts}catch(t){return{}}}();let ja={"en-US":{title_dataFlowService:"Data Flow Service",title_distributedAnalysis:"Distributed Analysis",title_clientComputing:"Client Computing",title_dataServiceQuery:"Data Service Query",title_searchCity:"Search city",title_searchLayer:" Search layer",text_input_value_inputDataFlowUrl:"Please enter the data stream service address such as: ws://{serviceRoot}/{dataFlowName}/dataflow/subscribe",text_displayFeaturesInfo:"Display feature information",text_subscribe:"subscribe",text_cancelSubscribe:"unsubscribe",text_densityAnalysis:"Density Analysis",text_CalculateTheValuePerUnitArea:"Calculate the value per unit area within the neighborhood shape",text_option_selectDataset:"Please select a dataset",text_label_dataset:"Dataset",text_option_simplePointDensityAnalysis:"Simple point density analysis",text_option_nuclearDensityAnalysis:"Nuclear density analysis",text_label_analyticalMethod:"Analytical method",text_option_quadrilateral:"Quadrilateral",text_option_hexagon:"hexagon",text_label_meshType:"Mesh type",text_option_notSet:"Not set",text_label_weightField:"Weight field",text_label_gridSizeInMeters:"Grid size",text_label_searchRadius:"Search radius",text_label_queryRange:"Scope of analysis",text_label_areaUnit:"Area unit",text_option_equidistantSegmentation:"Equidistant segmentation",text_option_logarithm:"Logarithm",text_option_equalCountingSegment:"Equal counting segment",text_option_squareRootSegmentation:"Square root segmentation",text_label_thematicMapSegmentationMode:"Thematic map segmentation mode",text_label_thematicMapSegmentationParameters:"Thematic map segmentation parameters",text_option_greenOrangePurpleGradient:"Green orange purple gradient",text_option_greenOrangeRedGradient:"Green orange red gradient",text_option_rainbowGradient:"Rainbow gradient",text_option_spectralGradient:"Spectral gradient",text_option_terrainGradient:"Terrain gradient",text_label_thematicMapColorGradientMode:"Thematic map color gradient mode",text_label_resultLayerName:"Result layer name",text_chooseFile:"Open File",text_isoline:"Isoline",text_extractDiscreteValue:"Extract discrete value generation curve",text_buffer:"Buffer",text_specifyTheDistance:"Specify the distance to create the surrounding area",text_label_analysisLayer:"Analysis layer",text_label_extractField:"Extract field",text_label_extractedValue:"Extracted value",text_label_distanceAttenuation:"Distance attenuation",text_label_gridSize:"gridSize",text_label_bufferRadius:"Buffer radius",text_label_defaultkilometers:"Default 10 kilometers",text_label_kilometer:"kilometer",text_label_unit:"unit",text_retainOriginal:"Retain original object field",text_mergeBuffer:"Merge buffer",text_label_color:"Color",text_label_buffer:"[Buffer]",text_label_isolines:"[Isolines]",text_label_queryRangeTips:"The default is the full range of input data. Example: -74.050, 40.650, -73.850, 40.850",text_label_queryModel:"Query mode",text_label_IDArrayOfFeatures:"ID array of features",text_label_maxFeatures:"The maximum number of features that can be returned",text_label_bufferDistance:"Buffer distance",text_label_queryRange1:"Query range",text_label_spatialQueryMode:"Spatial query mode",text_label_featureFilter:"Feature filter",text_label_geometricObject:"Geometric object",text_label_queryMode:"Query mode",text_label_searchTips:"Search for city locations or layer features",text_label_chooseSearchLayers:"Select a query layer",text_loadSearchCriteria:"Load search criteria",text_saveSearchCriteria:"Save search criteria",btn_analyze:"Analyze",btn_analyzing:"Analyzing",btn_emptyTheAnalysisLayer:"Empty the analysis layer",btn_cancelAnalysis:"Cancel",btn_query:"Query",btn_querying:"Querying",btn_emptyTheRresultLayer:"Clear all result layers","msg_dataReturnedIsEmpty.":"The request is successful and the data returned by the query is empty.",msg_dataFlowServiceHasBeenSubscribed:"The data stream service has been subscribed to.",msg_inputDataFlowUrlFirst:"Please enter the data stream service address first.",msg_datasetOrMethodUnsupport:"This dataset does not support this analysis type. Please reselect the dataset.",msg_selectDataset:"Please select a data set!",msg_setTheWeightField:"Please set the weight field!",msg_theFieldNotSupportAnalysis:"The field you currently select does not support analysis!",msg_resultIsEmpty:"The result of the analysis is empty!",msg_openFileFail:"Failed to open file!",msg_fileTypeUnsupported:"File format is not supported!",msg_fileSizeExceeded:"File size exceeded! The file size should not exceed 10M!",msg_dataInWrongGeoJSONFormat:"Wrong data format! Non standard GEOJSON format data!",msg_dataInWrongFormat:"Wrong data format! Non standard EXCEL, CSV or GEOJSON format data!",msg_searchKeywords:"Search keywords cannot be empty. Please enter your search criteria.",msg_searchGeocodeField:"Did not match the address matching service data!",msg_cityGeocodeField:"The address matching service of the current city is not configured.",msg_getFeatureField:"No related vector features found!",msg_dataflowservicesubscribed:"The data stream service has been subscribed to.",msg_subscribesucceeded:"The data stream service subscription was successful.",msg_crsunsupport:"Does not support the coordinate system of the current map",msg_tilematrixsetunsupport:"Incoming TileMatrixSet is not supported",msg_jsonResolveFiled:"JSON format parsing failureï¼",msg_requestContentFiled:"Failed to request data through iportal!",msg_getdatafailed:"Failed to get data!"},"zh-CN":{title_dataFlowService:"æ°æ®æµæå¡",title_distributedAnalysis:"åå¸å¼åæ",title_clientComputing:"å®¢æ·ç«¯è®¡ç®",title_dataServiceQuery:"æ°æ®æå¡æ¥è¯¢",title_searchCity:"æç´¢åå¸",title_searchLayer:"æç´¢å¾å±",text_input_value_inputDataFlowUrl:"è¯·è¾å¥æ°æ®æµæå¡å°åå¦:ws://{serviceRoot}/{dataFlowName}/dataflow/subscribe",text_displayFeaturesInfo:"æ¾ç¤ºè¦ç´ ä¿¡æ¯",text_subscribe:"è®¢é",text_cancelSubscribe:"åæ¶è®¢é",text_densityAnalysis:"å¯åº¦åæ",text_CalculateTheValuePerUnitArea:"è®¡ç®ç¹æå®é»åå½¢ç¶åçæ¯åä½é¢ç§¯éå¼",text_option_selectDataset:"è¯·éæ©æ°æ®é",text_label_dataset:"æ°æ®é",text_option_simplePointDensityAnalysis:"ç®åç¹å¯åº¦åæ",text_option_nuclearDensityAnalysis:"æ ¸å¯åº¦åæ",text_label_analyticalMethod:"åææ¹æ³",text_option_quadrilateral:"åè¾¹å½¢",text_option_hexagon:"å­è¾¹å½¢",text_label_meshType:"ç½æ ¼é¢ç±»å",text_option_notSet:"æªè®¾ç½®",text_label_weightField:"æéå­æ®µ",text_label_gridSizeInMeters:"ç½æ ¼å¤§å°",text_label_searchRadius:"æç´¢åå¾",text_label_queryRange:"åæèå´",text_label_areaUnit:"é¢ç§¯åä½",text_option_equidistantSegmentation:"ç­è·ç¦»åæ®µ",text_option_logarithm:"å¯¹æ°",text_option_equalCountingSegment:"ç­è®¡æ°åæ®µ",text_option_squareRootSegmentation:"å¹³æ¹æ ¹åæ®µ",text_label_thematicMapSegmentationMode:"ä¸é¢å¾åæ®µæ¨¡å¼",text_label_thematicMapSegmentationParameters:"ä¸é¢å¾åæ®µåæ°",text_option_greenOrangePurpleGradient:"ç»¿æ©ç´«æ¸å",text_option_greenOrangeRedGradient:"ç»¿æ©çº¢æ¸å",text_option_rainbowGradient:"å½©è¹æ¸å",text_option_spectralGradient:"åè°±æ¸å",text_option_terrainGradient:"å°å½¢æ¸å",text_label_thematicMapColorGradientMode:"ä¸é¢å¾é¢è²æ¸åæ¨¡å¼",text_label_resultLayerName:"ç»æå¾å±åç§°",text_chooseFile:"éæ©æä»¶",text_isoline:"ç­å¼çº¿",text_extractDiscreteValue:"æåç¦»æ£å¼çææ²çº¿",text_buffer:"ç¼å²åº",text_specifyTheDistance:"æå®è·ç¦»åå»ºå¨è¾¹åºå",text_label_analysisLayer:"åæå¾å±",text_label_extractField:"æåå­æ®µ",text_label_extractedValue:"æåå¼",text_label_distanceAttenuation:"è·ç¦»è¡°å",text_label_gridSize:"æ æ ¼å¤§å°",text_label_bufferRadius:"ç¼å²åå¾",text_label_defaultkilometers:"é»è®¤10åç±³",text_option_kilometer:"åç±³",text_label_unit:"åä½",text_retainOriginal:"ä¿çåå¯¹è±¡å­æ®µå±æ§",text_mergeBuffer:"åå¹¶ç¼å²åº",text_label_color:"é¢è²",text_label_buffer:"[ç¼å²åº]",text_label_isolines:"[ç­å¼çº¿]",text_label_queryRangeTips:"é»è®¤ä¸ºè¾å¥æ°æ®çå¨å¹èå´ãèä¾ï¼-74.050,40.650,-73.850,40.850",text_label_IDArrayOfFeatures:"è¦ç´  ID æ°ç»",text_label_maxFeatures:"æå¤å¯è¿åçè¦ç´ æ°é",text_label_bufferDistance:"ç¼å²åºè·ç¦»",text_label_queryRange1:"æ¥è¯¢èå´",text_label_spatialQueryMode:"ç©ºé´æ¥è¯¢æ¨¡å¼",text_label_featureFilter:"è¦ç´ è¿æ»¤å¨",text_label_geometricObject:"å ä½å¯¹è±¡",text_label_queryMode:"æ¥è¯¢æ¨¡å¼",text_label_searchTips:"æç´¢åå¸å°ç¹æå¾å±è¦ç´ ",text_label_chooseSearchLayers:"éæ©æ¥è¯¢å¾å±",text_loadSearchCriteria:"å è½½æç´¢æ¡ä»¶",text_saveSearchCriteria:"ä¿å­æç´¢æ¡ä»¶",btn_analyze:"åæ",btn_analyzing:"åæä¸­",btn_emptyTheAnalysisLayer:"æ¸ç©ºåæå¾å±",btn_cancelAnalysis:"åæ¶",btn_query:"æ¥è¯¢",btn_querying:"æ¥è¯¢ä¸­",btn_emptyTheRresultLayer:"æ¸é¤ææç»æå¾å±",msg_dataFlowServiceHasBeenSubscribed:"å·²è®¢éè¯¥æ°æ®æµæå¡ã",msg_inputDataFlowUrlFirst:"è¯·åè¾å¥æ°æ®æµæå¡å°åã",msg_datasetOrMethodUnsupport:"è¯¥æ°æ®éä¸æ¯ææ¬åæç±»åï¼è¯·éæ°éæ©æ°æ®é",msg_selectDataset:"è¯·éæ©æ°æ®éï¼",msg_setTheWeightField:"è¯·è®¾ç½®æéå­æ®µï¼",msg_theFieldNotSupportAnalysis:"æ¨å½åéæ©çå­æ®µä¸æ¯æåæï¼",msg_resultIsEmpty:"åæçç»æä¸ºç©ºï¼",msg_dataReturnedIsEmpty:"è¯·æ±æåï¼æ¥è¯¢è¿åçæ°æ®ä¸ºç©ºã",msg_openFileFail:"æå¼æä»¶å¤±è´¥ï¼",msg_fileTypeUnsupported:"ä¸æ¯æè¯¥æä»¶æ ¼å¼ï¼",msg_fileSizeExceeded:"æä»¶å¤§å°è¶éï¼æä»¶å¤§å°ä¸å¾è¶è¿ 10Mï¼",msg_dataInWrongGeoJSONFormat:"æ°æ®æ ¼å¼éè¯¯ï¼éæ åç GEOJSON æ ¼å¼æ°æ®ï¼",msg_dataInWrongFormat:"æ°æ®æ ¼å¼éè¯¯ï¼éæ åç EXCEL, CSV æ GEOJSON æ ¼å¼æ°æ®ï¼",msg_searchKeywords:"æç´¢å³é®å­ä¸è½ä¸ºç©ºï¼è¯·è¾å¥æç´¢æ¡ä»¶ã",msg_searchGeocodeField:"æªå¹éå°å°åå¹éæå¡æ°æ®ï¼",msg_cityGeocodeField:"æªéç½®å½ååå¸çå°åå¹éæå¡ã",msg_getFeatureField:"æªæ¥æ¾å°ç¸å³ç¢éè¦ç´ ï¼",msg_dataflowservicesubscribed:"å·²è®¢éè¯¥æ°æ®æµæå¡ã",msg_subscribesucceeded:"æ°æ®æµæå¡è®¢éæåã",msg_crsunsupport:"ä¸æ¯æå½åå°å¾çåæ ç³»",msg_tilematrixsetunsupport:"ä¸æ¯æä¼ å¥çTileMatrixSet",msg_jsonResolveFiled:"jsonæ ¼å¼è§£æå¤±è´¥ï¼",msg_requestContentFiled:"éè¿iportalè¯·æ±æ°æ®å¤±è´¥ï¼",msg_getdatafailed:"è·åæ°æ®å¤±è´¥ï¼"},code:null,defaultCode:"en-US",getCode:function(){return ja.code||ja.setCode(),ja.code},setCode:function(){var t=this.getLanguageFromCookie();t||(t=ja.defaultCode,t="Netscape"===navigator.appName?navigator.language:navigator.browserLanguage),0===t.indexOf("zh")&&(t="zh-CN"),0===t.indexOf("en")&&(t="en-US"),ja.code=t},getLanguageFromCookie(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){for(var r=t[e];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf("language="))return r.substring("language=".length,r.length)}return""},i18n:function(t){var e=ja[ja.getCode()],r=e&&e[t];return r||(r=t),r}};const za=function(){try{return XLSX}catch(t){return{}}}();let Va={rABS:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsBinaryString,rABF:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsArrayBuffer,rAT:"undefined"!=typeof FileReader&&FileReader.prototype&&FileReader.prototype.readAsText,readFile(t,e,r,i,s){Ra.JSON===t||Ra.GEOJSON===t?this.readTextFile(e,r,i,s):Ra.EXCEL!==t&&Ra.CSV!==t||this.readXLSXFile(e,r,i,s)},readTextFile(t,e,r,i){let s=new FileReader;s.onloadend=function(t){e&&e.call(i,t.target.result)},s.onerror=function(t){r&&r.call(i,t)},this.rAT?s.readAsText(t.file,"utf-8"):s.readAsBinaryString(t.file)},readXLSXFile(t,e,r,i){let s=new FileReader;s.onloadend=function(t){let s=new Uint8Array(t.target.result),n=za.read(s,{type:"array"});try{if(n&&n.SheetNames&&n.SheetNames.length>0){let t=n.SheetNames[0],r=za.utils.sheet_to_csv(n.Sheets[t]);e&&e.call(i,r)}}catch(t){r&&r.call(i,t)}},s.onerror=function(t){r&&r.call(i,t)},this.rABF&&s.readAsArrayBuffer(t.file)},processDataToGeoJson(t,e,r,i,s){let n=null;if("EXCEL"===t||"CSV"===t)n=this.processExcelDataToGeoJson(e),r&&r.call(s,n);else if("JSON"===t||"GEOJSON"===t){let t=e;"string"==typeof t&&(t=JSON.parse(t)),"ISERVER"===t.type?n=t.data.recordsets[0].features:"FeatureCollection"===t.type?n=t:i&&i.call(s,ja.i18n("msg_dataInWrongGeoJSONFormat")),r&&r.call(s,n)}else i&&i.call(s,ja.i18n("msg_dataInWrongFormat"))},processExcelDataToGeoJson(t){let e=this.string2Csv(t),r=e.colTitles,i=-1,s=-1;for(let t=0,e=r.length;t<e;t++)this.isXField(r[t])&&(i=t),this.isYField(r[t])&&(s=t);let n=[];for(let t=0,r=e.rows.length;t<r;t++){let r=e.rows[t],a=Number(r[i]),o=Number(r[s]),l={};for(let r in e.colTitles){l[e.colTitles[r]]=e.rows[t][r]}let h={type:"Feature",geometry:{type:"Point",coordinates:[a,o]},properties:l};n.push(h)}return n},isXField(t){var e=t.toLowerCase();return"x"===e||"smx"===e||"jd"===e||"ç»åº¦"===e||"ä¸ç»"===e||"longitude"===e||"lot"===e||"lon"===e||"lng"===e||"xåæ "===e},isYField(t){var e=t.toLowerCase();return"y"===e||"smy"===e||"wd"===e||"çº¬åº¦"===e||"åçº¬"===e||"latitude"===e||"lat"===e||"yåæ "===e},string2Csv(t,e){let r=t.split("\n"),i={};i.colTitles=e?[]:r[0].split(","),i.rows=[];for(let t=e?0:1;t<r.length;t++)r[t]&&i.rows.push(r[t].split(","));return i}};class Ja{constructor(t){this.datasets=t,this.EVENT_TYPES=["getdatafailed"],this.events=new _t(this,null,this.EVENT_TYPES)}getDatasetInfo(t){let e=this.datasets.url,r=this;zt.get(e).then(function(t){return t.json()}).then(function(e){if(e.datasetInfo){let i=e.datasetInfo;r.datasetsInfo={dataSourceName:i.dataSourceName,datasetName:i.name,mapName:e.name},t({result:r.datasetsInfo})}}).catch(function(t){console.log(t),r._fireFailedEvent(t)})}getDataFeatures(t,e){let r,i,s,n=t.result,a={name:n.datasetName+"@"+n.dataSourceName};Object.assign(a,this.datasets.queryInfo),r=new ye(a),i=new Hr({queryParameter:r,datasetNames:[n.dataSourceName+":"+n.datasetName],fromIndex:0,toIndex:1e5}),(s=new Wr(n.dataUrl)).processAsync(i,e)}getLayerFeatures(t,e){let r,i,s,n=t.result,a={name:n.mapName};Object.assign(a,this.datasets.queryInfo),r=new ye(a),i=new Zi({queryParams:[r],expectCount:1e5}),(s=new Ki(n.dataUrl)).processAsync(i,e)}getDataInfoByIptl(t){this.getServiceInfo(this.datasets.url,t)}getServiceInfo(t,e){let r=this;zt.get(t,null,{withCredentials:this.datasets.withCredentials}).then(t=>t.json()).then(i=>{if(!1!==i.succeed)if(i.dataItemServices&&i.dataItemServices.length>0){let s;i.dataItemServices.forEach(i=>{if("RESTDATA"===i.serviceType&&"PUBLISHED"===i.serviceStatus)s=i;else{if("RESTMAP"!==i.serviceType||"PUBLISHED"!==i.serviceStatus)return void r.getDatafromContent(t,e);s=i}}),s&&r.getDatafromRest(s.serviceType,s.address,e)}else r.getDatafromContent(t,e);else r._fireFailedEvent(i)}).catch(t=>{console.log(t),r._fireFailedEvent(t)})}getDatafromContent(t,e){let r={result:{}},i=this;t+="/content.json?pageSize=9999999&currentPage=1",zt.get(t,null,{withCredentials:this.datasets.withCredentials}).then(t=>t.json()).then(t=>{if(!1!==t.succeed){if(t.type){if("JSON"===t.type||"GEOJSON"===t.type){if(t.content=JSON.parse(t.content.trim()),!t.content.features)return void console.log(ja.i18n("msg_jsonResolveFiled"));let e=this._formatGeoJSON(t.content);r.result.features={type:t.content.type,features:e}}else if("EXCEL"===t.type||"CSV"===t.type){let e=this._excelData2Feature(t.content);r.result.features={type:"FeatureCollection",features:e}}e(r,"content")}}else i._fireFailedEvent(t)},this).catch(t=>{console.log(t),i._fireFailedEvent(t)})}getDatafromRest(t,e,r){let i=this,s=this.datasets.withCredentials;if("RESTDATA"===t){let t,n,a=`${e}/data/datasources`;zt.get(a,null,{withCredentials:s}).then(t=>t.json()).then(o=>{t=o.datasourceNames[0],a=`${e}/data/datasources/${t}/datasets`,zt.get(a,null,{withCredentials:s}).then(t=>t.json()).then(s=>(n=s.datasetNames[0],i.getDatafromRestData(`${e}/data`,[t+":"+n],r),[t+":"+n])).catch(function(t){i._fireFailedEvent(t)})}).catch(function(t){i._fireFailedEvent(t)})}else{let t,n,a,o=`${e}/maps`;zt.get(o,null,{withCredentials:s}).then(t=>t.json()).then(l=>{t=l[0].name,a=l[0].path,o=o=`${e}/maps/${t}/layers`,zt.get(o,null,{withCredentials:s}).then(t=>t.json()).then(t=>(n=t[0].subLayers.layers[0].caption,i.getDatafromRestMap(n,a,r),n)).catch(function(t){i._fireFailedEvent(t)})}).catch(function(t){i._fireFailedEvent(t)})}}getDatafromRestData(t,e,r){let i=this;this.datasets.queryInfo.attributeFilter=this.datasets.queryInfo.attributeFilter||"SmID>0",this._getFeatureBySQL(t,e,this.datasets.queryInfo,t=>{r(t,"RESTDATA")},t=>{console.log(t),i._fireFailedEvent(t)})}getDatafromRestMap(t,e,r){let i=this;this.datasets.queryInfo.attributeFilter=this.datasets.queryInfo.attributeFilter||"smid=1",this._queryFeatureBySQL(e,t,this.datasets.queryInfo,null,null,t=>{r(t,"RESTMAP")},t=>{console.log(t),i._fireFailedEvent(t)})}_getFeatureBySQL(t,e,r,i,s){let n,a,o,l={name:e.join().replace(":","@")};Object.assign(l,r),n=new ye(l),o=new Hr({queryParameter:n,datasetNames:e,fromIndex:0,toIndex:1e5,returnContent:!0}),(a=new Wr(t)).processAsync(o,function(t){"processCompleted"===t.type?i&&i(t):s&&s(t)})}_queryFeatureBySQL(t,e,r,i,s,a,o,l,h,u){var c,d,p={name:e};Object.assign(p,r),c=new ye(p),i&&(c.fields=i);var f={queryParams:[c]};u&&(f.queryOption=n.ATTRIBUTE),l&&(f.startRecord=l),h&&(f.expectCount=h),s&&(f.prjCoordSys={epsgCode:s}),d=new Zi(f),this._queryBySQL(t,d,t=>{"processCompleted"===t.type?a(t):o(t)})}_queryBySQL(t,e,r,i){new Ki(t,{format:this._processFormat(i)}).processAsync(e,r)}_processFormat(t){return t||e.GEOJSON}_formatGeoJSON(t){let e=t.features;return e.forEach((t,e)=>{t.properties.index=e}),e}_excelData2Feature(t){let e=t.colTitles,r=-1,i=-1;for(let t=0,s=e.length;t<s;t++)Va.isXField(e[t])&&(r=t),Va.isYField(e[t])&&(i=t);let s=[];for(let e=0,n=t.rows.length;e<n;e++){let n=t.rows[e],a=Number(n[r]),o=Number(n[i]),l={};for(let r in t.colTitles){l[t.colTitles[r]]=t.rows[e][r]}l.index=e+"";let h={type:"Feature",geometry:{type:"Point",coordinates:[a,o]},properties:l};s.push(h)}return s}_fireFailedEvent(t){let e=t?{error:t,message:ja.i18n("msg_getdatafailed")}:{message:ja.i18n("msg_getdatafailed")};this.events.triggerEvent("getdatafailed",e)}}class qa{constructor(t){this.datasets=t.datasets,this.xField=[],this.yField=[],this.grid={top:"50px",bottom:"50px",left:"50px",right:"60px"},this.chartType=t.type||"bar",this._initXYField(t.chartOptions),this.EVENT_TYPES=["getdatafailed"],this.events=new _t(this,null,this.EVENT_TYPES)}_initXYField(t){let e=this;t&&t.length>0&&t.forEach(function(t){t.xAxis&&e.xField.push({field:t.xAxis.field,name:t.xAxis.name}),t.yAxis&&e.yField.push({field:t.yAxis.field,name:t.yAxis.name})})}getDatasetInfo(t){this.createChart=t,this.datasets&&this._checkUrl(this.datasets.url)&&(this.chartModel=new Ja(this.datasets),"iServer"===this.datasets.type?this.chartModel.getDatasetInfo(this._getDatasetInfoSuccess.bind(this)):"iPortal"===this.datasets.type&&this.chartModel.getDataInfoByIptl(this._getDataInfoSuccess.bind(this)),this.chartModel.events.on({getdatafailed:t=>{this.events.triggerEvent("getdatafailed",t)}}))}_getDatasetInfoSuccess(t){let e=this.datasets.url,r=e.indexOf("rest");if(r>0){let i=e.indexOf("/",r+5),s=e.substring(r+5,i),n=e.substring(0,r+4)+"/data";if("maps"===s){let s=e.indexOf("/",i+1),a=e.substring(i+1,s);n=e.substring(0,r+4)+"/maps/"+a,t.result.dataUrl=n,this._getLayerFeatures(t)}else"data"===s&&(t.result.dataUrl=n,this._getDataFeatures(t))}}_getDataInfoSuccess(t,e){let r=this;"RESTMAP"===e?r._getChartDatasFromLayer(t):r._getChartDatas(t)}_getDataFeatures(t){this.chartModel.getDataFeatures(t,this._getChartDatas.bind(this))}_getLayerFeatures(t){this.chartModel.getLayerFeatures(t,this._getChartDatasFromLayer.bind(this))}_getChartDatas(t){if(t){this.features=t.result.features;let e=this.features.features,r={};if(e.length){let t=e[0],i=[],s=[];for(let e in t.properties)i.push(e),s.push(this._getDataType(t.properties[e]));r={features:e,fieldCaptions:i,fieldTypes:s,fieldValues:[]};for(let t in s){let i=[];for(let s in e){let n=e[s],a=r.fieldCaptions[t],o=n.properties[a];i.push(o)}r.fieldValues.push(i)}this.createChart(r)}}}_getChartDatasFromLayer(t){if(t.result.recordsets){let e=t.result.recordsets[0],r=e.features.features;this.features=e.features;let i={};if(r.length){i={features:e.features,fieldCaptions:e.fieldCaptions,fieldTypes:e.fieldTypes,fieldValues:[]};for(let t in i.fieldCaptions){let e=[];for(let s in r){let n=r[s],a=i.fieldCaptions[t],o=n.properties[a];e.push(o)}i.fieldValues.push(e)}this.createChart(i)}}}_createChartOptions(t){return this.calculatedData=this._createChartDatas(t),this.updateChartOptions(this.chartType)}changeType(t){if(t!==this.chartType)return this.chartType=t,this.updateChartOptions(this.chartType)}updateData(t,e,r){this.updateChart=r,this.xField=[],this.yField=[],this._initXYField(e),t.type=t.type||"iServer",t.withCredentials=t.withCredentials||!1,this.datasets=t,this.getDatasetInfo(this._updateDataSuccess.bind(this))}_updateDataSuccess(t){let e=this._createChartOptions(t);this.updateChart(e)}updateChartOptions(t,e){if(this.calculatedData){let r=this.grid,i=this._createChartSeries(this.calculatedData,t),s=[];for(let t in this.calculatedData.XData)s.push({value:this.calculatedData.XData[t].fieldsData});let n={type:"category",name:this.xField[0].name||"X",data:s,nameTextStyle:{color:"#fff",fontSize:14},splitLine:{show:!1},axisLine:{lineStyle:{color:"#eee"}}},a={type:"value",name:this.yFieldName||"Y",data:{},nameTextStyle:{color:"#fff",fontSize:14},splitLine:{show:!1},axisLine:{lineStyle:{color:"#eee"}}},o={formatter:"{b0}: {c0}"},l="#404a59";return e&&(e.grid&&(r=e.grid),e.tooltip&&(o=e.tooltip),e.backgroundColor&&(l=e.backgroundColor)),{backgroundColor:l,grid:r,series:i,xAxis:n,yAxis:a,tooltip:o}}}_createChartDatas(t){let e=0,r=[],i=t.fieldCaptions,s=this;i.forEach(function(t,r){s.xField[0]&&t===s.xField[0].field&&(e=r)}),this.yFieldName="",this.yField.forEach(function(t,e){0!==e&&(s.yFieldName=s.yFieldName+","),s.yFieldName=s.yFieldName+t.name,i.forEach(function(e,i){e===t.field&&r.push(i)})});let n=this._getAttrData(t,e),a=[];if(r.length>0)r.forEach(function(e){let r=[];for(let i in t.fieldValues[e])r.push({value:t.fieldValues[e][i]});a.push(r)});else{let t=[],e=[],r=n.length;for(let i=0;i<r;i++){let r=!1;for(let s=0,a=e.length;s<a;s++)if(n[i].fieldsData===e[s].fieldsData){t[s].value++,e[s].recordIndexs.push(i),r=!0;break}r||n[i].fieldsData&&(e.push({fieldsData:n[i].fieldsData,recordIndexs:[i]}),t.push({value:1}))}n=e,a=[t]}return{XData:n,YData:a}}_getAttrData(t,e){0===e&&(this.xField=[{field:t.fieldCaptions[e],name:t.fieldCaptions[e]}]);let r=[];for(let i=0,s=t.fieldValues[e].length;i<s;i++){let s=t.fieldValues[e][i];r.push({recordIndexs:i,fieldsData:s})}return r}_createChartSeries(t,e){let r=[];return t.YData.forEach(function(t){let i=0,s=[];for(let e of t)i=e.value,s.push({value:i});let n={type:e,data:s,name:"y"};r.push(n)}),r}_isDate(t){return/((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))/gi.test(t)}_isNumber(t){let e=Number(t);return 0===e||!isNaN(e)}_getDataType(t){if(null!==t&&void 0!==t&&""!==t){if(this._isDate(t))return"DATE";if(this._isNumber(t))return"NUMBER"}return"STRING"}_checkUrl(t){let e;return e=!(""===t||!this._isMatchUrl(t))&&(!/^http[s]?:\/\/localhost/.test(t)&&!/^http[s]?:\/\/127.0.0.1/.test(t))}_isMatchUrl(t){return new RegExp("(https?|http|file|ftp)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]").test(t)}getStyle(){return{grid:this.grid,tooltip:this.tooltip,backgroundColor:this.backgroundColor}}getFeatures(){return this.features}setStyle(t){return this.updateChartOptions(this.chartType,t)}}class Ha{constructor(t){t=t||{},this.id=t.id?t.id:null,this.rootContainer=null}getElement(){return this.id&&(this.rootContainer.id=this.id),this.rootContainer}_initView(){}showView(){this.rootContainer.hidden=!1}closeView(){this.rootContainer.hidden=!0}}class Wa extends Ha{constructor(t){super(t);let e=t.title?t.title:"";this._initView(e)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-container");const r=document.createElement("div");r.setAttribute("class","component-title");const i=document.createElement("div");i.innerHTML=t,r.appendChild(i),e.appendChild(r);const s=document.createElement("div");return s.setAttribute("class","component-content"),e.appendChild(s),this.content=s,this.rootContainer=e,e}getContentElement(){return this.content}appendContent(t){this.content.appendChild(t)}}class Ya extends Ha{constructor(t){super(t),this._initView(t)}_initView(t){let e=this._createElement("div","component-selecttool");if(t.labelName){this._createElement("label","component-selecttool__lable--describe",e).innerHTML=t.labelName}let r=this._createElement("div","component-selecttool--chart",e);r.setAttribute("tabindex","1");let i=this._createElement("div","component-selecttool__name",r);i.title=t.optionsArr[0],i.innerHTML=t.optionsArr[0];let s=this._createElement("div","component-selecttool__trianglebtn--chart",r),n=this._createElement("div","component-triangle-down-img",s),a=this._createElement("div","component-selecttool__content",r),o=this._createElement("div","component-selecttool__content--chart",a),l=this._createElement("div","component-selecttool__scrollarea__content",o);l.setAttribute("tabindex","1"),this.createOptions(l,t.optionsArr),this.optionClickEvent(l,i,t.optionsClickCb),this._selectClickEvent(r,a,n),this.rootContainer=e}createOptions(t,e){for(let r in e){let i=this._createElement("div","component-selecttool__option",t);i.title=e[r],i.innerHTML=e[r]}}_selectClickEvent(t,e,r){t.onclick=function(t){"block"===e.style.display?(e.style.display="none",r.className="component-triangle-down-img"):(e.style.display="block",r.className="triangle-up-img"),t.preventDefault(),t.stopPropagation()},t.onmousedown=function(t){t.target!==this&&(this.focus(),t.preventDefault(),t.stopPropagation())},t.onblur=function(){e.style.display="none",r.className="component-triangle-down-img"}}_createElement(t,e,r){let i=document.createElement(t||"div");return e&&(i.className=e),r&&r.appendChild(i),i}optionClickEvent(t,e,r){for(let i=0;i<t.children.length;i++){let s=t.children[i];s.onclick=function(){e.innerHTML=s.innerHTML,e.title=s.title,s.getAttribute("data-value")&&e.setAttribute("data-value",s.getAttribute("data-value")),r&&r(s)}}}}class Xa extends Ha{constructor(t){super(t),this._initView(t)}_initView(t){let e=document.createElement("div");e.className="component-dropdownbox--container";let r=document.createElement("div");r.setAttribute("tabindex","1"),r.className="component-dropdownbox",e.appendChild(r);let i=document.createElement("div");r.appendChild(i),this._createDropDownOption(t[0],i);let s=document.createElement("div");s.className="component-dropdownbox__triangle-btn",r.appendChild(s);let n=document.createElement("div");n.className="component-triangle-down-img",s.appendChild(n);let a={parentEle:r,dropDownContent:["component-dropdownbox__content component-dropdownbox__content--chart","dropDownContent"],scrollareaContent:"component-selecttool__scrollarea__content",optionsArr:t,triangleBtn:n,dropDownTopContainer:i};this._createDropDownBox(a),this.rootContainer=e}_createDropDownBox(t){let e=t.parentEle,r=t.dropDownTopContainer,i=document.createElement("div");i.className=t.dropDownContent[0],e.appendChild(i);let s=document.createElement("div");s.className=t.scrollareaContent,i.appendChild(s);let n=t.optionsArr;for(let t=0;t<n.length;t++)this._createDropDownOption(n[t],s);let a=t.triangleBtn;this._dropDownClickEvent(e,i,a),this._eleOnblur(e,i,a);let o=s.children;for(let t=0;t<o.length;t++)o[t].onclick=function(){r.innerHTML=o[t].outerHTML}}_createDropDownOption(t,e){let r=document.createElement("div");r.className="component-dropdownbox__item";let i=t;i.dataValue&&r.setAttribute("data-value",i.dataValue),e.appendChild(r);let s=document.createElement("div");s.className="component-dropdownbox__item__img",r.appendChild(s);let n=document.createElement("div");i.icon.className&&(n.className=i.icon.className),i.icon.background&&(n.style.background=i.icon.background),s.appendChild(n);let a=document.createElement("div");a.className="component-dropdownbox__item__title",a.title=i.title,a.innerHTML=i.title,r.appendChild(a);let o=document.createElement("div");o.className="component-dropdownbox__item__remark",o.title=i.remark,o.innerHTML=i.remark,r.appendChild(o)}_dropDownClickEvent(t,e,r){t.onclick=function(t){"block"===e.style.display?(e.style.display="none",r.className="component-triangle-down-img"):(e.style.display="block",r.className="triangle-up-img"),t.preventDefault(),t.stopPropagation()},t.onmousedown=function(t){t.target!==this&&(this.focus(),t.preventDefault(),t.stopPropagation())}}_eleOnblur(t,e,r){t.onblur=function(){e.style.display="none",r.className="component-triangle-down-img"}}_createElement(t,e,r){let i=document.createElement(t||"div");return e&&(i.className=e),r&&r.appendChild(i),i}}class Qa extends Ha{constructor(t){super(t=t||{}),t.title=t.title?t.title:"",this._initView(t.title)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-popcontainer");const r=document.createElement("div");r.setAttribute("class","component-popcontainer__header");const i=document.createElement("label");i.setAttribute("class","component-popcontainer__header__title"),i.innerHTML=t,r.appendChild(i);const s=document.createElement("span");s.setAttribute("class","supermapol-icons-clear component-popcontainer__header__close"),s.onclick=this.closeView.bind(this),e.appendChild(s),e.appendChild(r);const n=document.createElement("div");n.setAttribute("class","component-popcontainer__content"),this.content=n,e.appendChild(n),this.rootContainer=e}appendContent(t){this.content.appendChild(t)}}class Za extends Qa{constructor(t){t.title=t.title?t.title:"å±æ§",super(t),this.rootContainer.firstChild.hidden=!0,t.attributes=t.attributes?t.attributes:[],this._createAttributesTable(t.attributes)}_createAttributesTable(t){const e=document.createElement("table");e.setAttribute("class","component-popcontainer__content__table");const r=document.createElement("tbody");let i=!0;for(let e in t){const s=document.createElement("tr");i&&s.setAttribute("class","component-popcontainer__content__td--color");const n=document.createElement("td"),a=document.createElement("Span");a.innerHTML=e,n.appendChild(a);const o=document.createElement("td");o.innerHTML=t[e],s.appendChild(n),s.appendChild(o),r.appendChild(s),i=!i}e.appendChild(r),this.appendContent(e)}}class Ka extends Ha{constructor(t){super(t),this._initView()}_initView(){const t=document.createElement("div");t.setAttribute("class","component-tabpage");const e=document.createElement("ul");this.header=e;const r=document.createElement("div");r.setAttribute("class","component-tabpage__content"),this.content=r,t.appendChild(e),t.appendChild(r),this.rootContainer=t}setTabs(t){this.removeAllTabs(),this.appendTabs(t)}appendTabs(t){for(let e=0;e<t.length;e++){let r=document.createElement("span");r.index=e,r.appendChild(document.createTextNode(t[e].title)),r.onclick=this._changeTabsPage.bind(this);let i=t[e].content;i.index=e,i.hidden=!0,this.header.appendChild(r),this.content.appendChild(i)}this.header.firstChild.setAttribute("class","on"),this.content.firstChild.hidden=!1}removeTab(t){this.header.removeChild(this.header.children[t]),this.content.removeChild(this.content.children[t])}removeAllTabs(){for(let t=this.header.children.length;t>0;t--)this.header.removeChild(this.header.children[t]),this.content.removeChild(this.content.children[t])}_changeTabsPage(t){const e=t.target.index;for(let t=0;t<this.header.children.length;t++)this.header.children[t].setAttribute("class",""),this.content.children[t].hidden=!0,t===e&&(this.header.children[t].setAttribute("class","on"),this.content.children[t].hidden=!1)}}class $a extends Ka{constructor(t){super(t),this.rootContainer.classList.add("component-citytabpage--noneBoxShadow"),this.config=t.config,rt.isArray(this.config)?(this.header.hidden=!0,this._createCityItem("åå¸",this.config),this.content.style.border="none"):(this._createTabs(),this.header.onclick=(t=>{for(let t=0;t<this.header.children.length;t++)this.header.children[t].setAttribute("class","");t.target.setAttribute("class","on"),this._createCityContent(t.target.innerHTML)}))}_createTabs(){if(rt.isArray(this.config))for(let t=0;t<this.config.length;t++){let e="";for(const r in this.config[t])e+=r;let r=document.createElement("li");r.innerHTML=e,this.header.appendChild(r)}else for(const t in this.config){let e=document.createElement("li");e.innerHTML=t,this.header.appendChild(e)}this.header.firstChild.setAttribute("class","on"),this._createCityContent(this.header.firstChild.innerHTML)}_createCityContent(t){for(let t=this.content.children.length;t>0;t--)this.content.removeChild(this.content.children[t-1]);const e=this.config[t];for(let t in e)this._createCityItem(t,e[t])}_createCityItem(t,e){const r=document.createElement("div"),i=document.createElement("div");i.setAttribute("class","component-citytabpag__py-key"),i.innerHTML=t,r.appendChild(i);const s=document.createElement("div");s.setAttribute("class","component-citytabpag__content");for(let t=0;t<e.length;t++){let r=document.createElement("span");r.innerHTML=e[t],s.appendChild(r)}"HOT"===t&&(s.style.width="428px"),r.appendChild(s),this.content.appendChild(r)}}class to extends Ha{constructor(t){super(t),this.navTabsTitle=null,this.navTabsContent=null,t.tabs=t.tabs?t.tabs:[],this._initView(t.tabs)}_initView(t){const e=document.createElement("div");e.setAttribute("class","component-navtabspage");const r=document.createElement("span");r.setAttribute("class","supermapol-icons-close"),r.onclick=this.closeView.bind(this),e.appendChild(r);const i=document.createElement("div");this.navTabsTitle=i,i.setAttribute("class","component-navtabspage__title"),e.appendChild(i);const s=document.createElement("div");this.navTabsContent=s,s.setAttribute("class","component-navtabspage__content"),e.appendChild(s),t.length>0&&this.appendTabs(t),this.rootContainer=e}setTabs(t){this.removeAllTabs(),this.appendTabs(t)}appendTabs(t){for(let e=0;e<t.length;e++){let r=document.createElement("span");r.index=e,r.appendChild(document.createTextNode(t[e].title)),r.onclick=this._changeTabsPage.bind(this);let i=t[e].content;i.index=e,i.hidden=!0,this.navTabsTitle.appendChild(r),this.navTabsContent.appendChild(i)}this.navTabsTitle.firstChild.setAttribute("class","component-navtabspage__tabs--select"),this.navTabsContent.firstChild.hidden=!1}removeTab(t){this.navTabsTitle.removeChild(this.navTabsTitle.children[t]),this.navTabsContent.removeChild(this.navTabsContent.children[t])}removeAllTabs(){for(let t=this.navTabsTitle.children.length;t>0;t--)this.navTabsTitle.removeChild(this.navTabsTitle.children[t]),this.navTabsContent.removeChild(this.navTabsContent.children[t])}_changeTabsPage(t){const e=t.target.index;for(let t=0;t<this.navTabsTitle.children.length;t++)this.navTabsTitle.children[t].setAttribute("class",""),this.navTabsContent.children[t].hidden=!0,t===e&&(this.navTabsTitle.children[t].setAttribute("class","component-navtabspage__tabs--select"),this.navTabsContent.children[t].hidden=!1)}}class eo extends Ha{constructor(t){super(t=t||{}),this.currentPage=0,this.pageNumberLis=[],this.currentPageNumberLis=[],this.linkageEvent=null,t.contents=t.contents?t.contents:null,t.pageCounts=t.pageCounts?t.pageCounts:0,this._initView(t.contents,t.pageCounts)}setLinkageEvent(t){this.linkageEvent=t}_initView(t,e){const r=document.createElement("div");r.setAttribute("class","component-pagination");const i=document.createElement("div");i.setAttribute("class","component-pagination__content"),r.appendChild(i),this.content=i;const s=document.createElement("ul");s.setAttribute("class","component-pagination__link"),s.onclick=this._changePageEvent.bind(this),r.appendChild(s),this._createLink(s),this.link=s,t&&this.setContent(t),0!==e&&this.setPageLink(e),this.rootContainer=r}setContent(t){this.clearContent(),this.appendContent(t)}appendContent(t){this.content.appendChild(t)}clearContent(){for(let t=this.content.children.length-1;t>=0;t--)this.content.removeChild(this.content.children[t])}setPageLink(t){this.pageNumberLis=[],this.currentPageNumberLis=[],this.clearPageLink(),this._createPageLi(t),this._appendPageLink()}_createPageLi(t){for(let e=0;e<t;e++){const t=document.createElement("li");t.innerHTML=e+1,this.pageNumberLis.push(t)}if(this.pageNumberLis[0].setAttribute("class","active"),this.currentPage=1,t<5)this.currentPageNumberLis=this.pageNumberLis;else for(let t=0;t<5;t++)this.currentPageNumberLis.push(this.pageNumberLis[t])}_appendPageLink(){for(let t=0;t<this.currentPageNumberLis.length;t++)this.link.insertBefore(this.currentPageNumberLis[t],this.link.childNodes[this.link.children.length-2]);for(let t=0;t<this.currentPageNumberLis.length;t++)this.currentPageNumberLis[t].setAttribute("class",""),Number(this.currentPageNumberLis[t].innerHTML)===this.currentPage&&this.currentPageNumberLis[t].setAttribute("class","active");this._changeDisableState(),this.linkageEvent&&this.linkageEvent(this.currentPage)}clearPageLink(){for(let t=this.link.children.length-3;t>1;t--)this.link.removeChild(this.link.children[t])}_createLink(t){for(let e=0;e<4;e++){const r=document.createElement("li");r.setAttribute("class","disable");const i=document.createElement("span");r.appendChild(i),0===e?(i.id="first",i.setAttribute("class","supermapol-icons-first")):1===e?(i.id="prev",i.setAttribute("class","supermapol-icons-prev")):2===e?(i.id="next",i.setAttribute("class","supermapol-icons-next")):3===e&&(i.id="last",i.setAttribute("class","supermapol-icons-last")),t.appendChild(r)}}_changePageEvent(t){const e=t.target;if("disable"===e.parentElement.classList[0])return;let r;if(e.id)r=e.id;else{if(!Number(e.innerHTML))return;r=Number(e.innerHTML)}this._prePageNum(r),this.clearPageLink(),this._appendPageLink()}_changeDisableState(){this.link.children[0].setAttribute("class",""),this.link.children[1].setAttribute("class",""),this.link.children[this.link.children.length-1].setAttribute("class",""),this.link.children[this.link.children.length-2].setAttribute("class",""),1===this.currentPage&&(this.link.children[0].setAttribute("class","disable"),this.link.children[1].setAttribute("class","disable")),this.currentPage===this.pageNumberLis.length&&(this.link.children[this.link.children.length-1].setAttribute("class","disable"),this.link.children[this.link.children.length-2].setAttribute("class","disable"))}_prePageNum(t){const e=[];if(this.currentPage="first"===t?1:"last"===t?this.pageNumberLis.length:"prev"===t?this.currentPage-1:"next"===t?this.currentPage+1:t,this.pageNumberLis.length<=5)for(let t=0;t<this.pageNumberLis.length;t++)e.push(this.pageNumberLis[t]);else if(this.currentPage<=3)for(let t=0;t<5;t++)e.push(this.pageNumberLis[t]);else if(this.currentPage>=this.pageNumberLis.length-3)for(let t=this.pageNumberLis.length-5;t<this.pageNumberLis.length;t++)e.push(this.pageNumberLis[t]);else for(let t=this.currentPage-3;t<=this.currentPage+1;t++)e.push(this.pageNumberLis[t]);e.length>0&&(this.currentPageNumberLis=e)}}let ro={getFileType:t=>/^.*\.(?:xls|xlsx)$/i.test(t)?Ra.EXCEL:/^.*\.(?:csv)$/i.test(t)?Ra.CSV:/^.*\.(?:geojson|json)$/i.test(t)?Ra.GEOJSON:null};var io=r(618),so=r.n(io);function no(t,e){const r=e&&e.styles&&e.styles.style,i=e&&e.captionFields&&e.captionFields.captionField,s={nodes:[],edges:[]};return t.forEach(t=>{const e=t.path;if(e){const{nodes:t,edges:n}=function(t,e,r){const i={nodes:[],edges:[]};return t.forEach(t=>{if(oo(t)){const r=ho(t,e);i.edges.push(r)}else{const s=lo(t,e,r);i.nodes.push(s)}}),i}(e,r,i);s.nodes.push(...t),s.edges.push(...n)}else if(oo(t)){const e=ho(t,r);s.edges.push(e)}else{const e=lo(t,r,i);s.nodes.push(e)}}),{nodes:ao(s.nodes),edges:ao(s.edges,"edgeId")}}function ao(t,e="id"){return so()(t,e)}function oo(t){return t.hasOwnProperty("start")&&t.hasOwnProperty("end")}function lo(t,e,r){const{id:i,properties:s,lables:n}=t,a=e?function(t,e){if(!e)return{};const{id:r,labels:i}=t,s=e.filter(t=>"entity"===t.type);for(let t=0;t<s.length;t++){const{color:e,textColor:n,font:a,size:o,entityTypes:l,entityIds:h}=s[t],u=JSON.parse(h||"[]"),c=JSON.parse(l||"[]");if(u.includes(r)||c.includes(i[0]))return{fillColor:e,fontSize:a.fontSize,fill:n,size:o,...co(a.fontName),...uo(a.fontStyle)}}return{}}(t,e):{},o=function(t,e){const{id:r,labels:i,properties:s}=t;if(e){const t=e instanceof Array?e:[e];for(let e=0;e<t.length;e++){const{name:n,entityTypes:a,entityIds:o}=t[e],l=JSON.parse(o||"[]"),h=JSON.parse(a||"[]"),u=i&&i.join("&");if(l.includes(r)||h.includes(u))return s[n]||""}}return s[s._labelfieldname]||""}(t,r),l=a.fillColor||"",h={id:i+"",label:o,properties:s,lables:n};return a.size&&(h.size=a.size,delete a.size),a.fillColor&&(h.style={fill:l,stroke:l},delete a.fillColor),0!==Object.keys(a).length&&(h.labelCfg={style:a}),h}function ho(t,e){const{start:r,end:i,id:s,type:n,properties:a}=t,o=e?function(t,e){if(!e)return{};const{id:r,type:i}=t,s=e.filter(t=>"relationShip"===t.type);for(let t=0;t<s.length;t++){const{color:e,width:n,textColor:a,font:o,relationTypes:l,relationIds:h}=s[t],u=JSON.parse(h||"[]"),c=JSON.parse(l||"[]");if(u.includes(r)||c.includes(i))return{stroke:e,lineWidth:1.4*Number(n),fontSize:o.fontSize,fill:a,...co(o.fontName),...uo(o.fontStyle)}}return{}}(t,e):{},l={source:r+"",target:i+"",edgeId:s+"",label:n,style:{},labelCfg:{},properties:a};return o.stroke&&(l.style.stroke=o.stroke,l.style.endArrow={path:"M 0,0 L 4,2 L 4,-2 Z",fill:o.stroke},delete o.stroke),o.lineWidth&&(l.style.lineWidth=o.lineWidth,delete o.lineWidth),l.labelCfg={style:o},l}function uo(t){return 1===t||"bold"===t?{fontWeight:"bold"}:2===t||"italic"===t?{fontStyle:"italic"}:"bolditalic"===t?{fontWeight:"bold",fontStyle:"italic"}:{}}function co(t){if(!t)return{};const e=t.split(".");return{fontFamily:e[0],...uo(e[1])}}const po=function(){try{return G6}catch(t){return{}}}();var fo=r.n(po),mo=r(186),yo=r.n(mo);class go{constructor(){this.config=null,this.graph=null,this.data=null,this.collpasedData={},this.importG6(),this.CLASS_NAME="SuperMap.G6Render"}importG6(){fo()||console.log("please import g6, egï¼https://gw.alipayobjects.com/os/lib/antv/g6/4.3.2/dist/g6.min.js")}initGraph(t){const e=new(fo().Graph)(t);return this.graph=e,t&&!1===t.highlightNode||this.highlightNode(e),t&&!1===t.highlightEdge||this.highlightEdge(e),!1===t.dragCanvas&&!1===t.dragNode||this.stopDefaultEventPropagation(),e}_getContextMenu(){return new(fo().Menu)({shouldBegin:t=>!!(t.target&&t.target.isCanvas&&t.target.isCanvas())||!!t.item,getContent:t=>{const{item:e}=t;if(t.target&&t.target.isCanvas&&t.target.isCanvas())return;if(!e)return;const r=e.getType(),i=e.getModel();return r&&i&&"node"===r?this.isCollpased(i.id)?"<ul>\n              <li id='expand'>å±å¼</li>\n            </ul>":"<ul>\n              <li id='collapse'>æå </li>\n            </ul>":void 0},handleMenuClick:(t,e)=>{switch(t.id.split("-")[0]){case"hide":this.hideItem(e);break;case"expand":this.expandNode(e);break;case"collapse":this.collapseNode(e);break;case"show":this.showItem(e)}},offsetX:26,offsetY:0,itemTypes:["node","edge","canvas"]})}_getGraphConfig(t){const e={speed:120,maxIteration:83,tick:()=>{this.refreshPositions()}},r={type:"fruchterman",gravity:5},i={},s={type:"line",style:{endArrow:{path:"M 0,0 L 4,2 L 4,-2 Z",fill:"#e0e0e0"},lineWidth:.5},labelCfg:{autoRotate:!0,style:{fontSize:4,fill:"#333"}}},n={default:["drag-canvas","zoom-canvas","drag-node"]},a=this._getContextMenu(),o=[new(fo().ToolBar),a],l={lineWidth:3,stroke:"#b4d6ff"},h={stroke:"#b4d6ff",shadowColor:"#b4d6ff",shadowBlur:5,endArrow:{path:"M 0,0 L 4,2 L 4,-2 Z",fill:"#b4d6ff"}};if(!t)return this._setToolBarStyle(),((t="knowledgeGraph")=>{const a=document.querySelector(`#${t}`);return{container:t,width:a.scrollWidth,height:a.scrollHeight,plugins:o,modes:n,layout:{...r,...e},defaultNode:i,defaultEdge:s,nodeStateStyles:{hover:l},edgeStateStyles:{hover:h}}})();t.container=t.container||"knowledgeGraph";const u="string"==typeof t.container?document.querySelector(`#${t.container}`):t.container;return t.width=t.width||u.scrollWidth,t.height=t.height||u.scrollHeight,t.layout={...r,...t.layout||{},...!1!==t.animate?e:{}},t.defaultNode={...i,...t.defaultNode||{}},t.defaultEdge={...s,...t.defaultEdge||{}},t.modes={default:[!1!==t.dragCanvas&&"drag-canvas",!1!==t.zoomCanvas&&"zoom-canvas",!1!==t.dragNode&&"drag-node"]},t.nodeStateStyles={hover:{...l,...t.nodeHighlightStyle||{}}},t.edgeStateStyles={hover:{...h,...t.edgeHighlightStyle||{}}},!1!==t.showToolBar&&(t.plugins=[new(fo().ToolBar)],this._setToolBarStyle()),!1!==t.showContextMenu&&(t.plugins=[...t.plugins||[],a],this._setToolBarStyle()),t}changeSize(t,e){return this.graph.changeSize(t,e)}autoResize(){const t=this.getContainer();window.addEventListener("resize",()=>{const e=t.scrollWidth,r=t.scrollHeight;this.graph.changeSize(e,r),this.graph.refresh()})}zoom(t,e,r,i){this.graph.zoom(t,e,r,i)}zoomTo(t,e,r,i){this.graph.zoomTo(t,e,r,i)}fitView(t,e,r,i){this.graph.fitView(t,e,r,i)}fitCenter(t,e){this.graph.fitCenter(t,e)}getGraphCenterPoint(){return this.graph.getGraphCenterPoint()}getViewPortCenterPoint(){return this.graph.getViewPortCenterPoint()}getZoom(){return this.graph.getZoom()}getMinZoom(){return this.graph.getMinZoom()}setMinZoom(t){this.graph.setMinZoom(t)}getMaxZoom(){return this.graph.getMaxZoom()}setMaxZoom(t){this.graph.setMaxZoom(t)}getWidth(){return this.graph.getWidth()}getHeight(){return this.graph.getHeight()}setCenter(t){var e=this.graph.getWidth()/2,r=this.graph.getHeight()/2,i=this.graph.getCanvasByPoint(t.x,t.y);this.graph.translate(e-i.x,r-i.y)}_setToolBarStyle(){yo()("\n      .g6-component-toolbar li[code='redo'],\n      .g6-component-toolbar li[code='undo'],\n      .g6-component-toolbar li[code='realZoom'] {\n        display: none;\n      }\n      .g6-component-contextmenu {\n        position: absolute;\n        z-index: 2;\n        list-style-type: none;\n        border-radius: 6px;\n        font-size: 14px;\n        width: fit-content;\n        transition: opacity .2s;\n        text-align: center;\n        box-shadow: 0 5px 18px 0 rgba(0, 0, 0, 0.6);\n        border: 0px;\n      }\n      .g6-component-contextmenu ul {\n        padding-left: 0px;\n        margin: 0;\n      }\n      .g6-component-contextmenu li {\n        cursor: pointer;\n        list-style-type: none;\n        list-style: none;\n        margin-left: 0;\n        line-height: 38px;\n        padding: 0px 35px;\n      }\n      .g6-component-contextmenu li:hover {\n        color: #333;\n        background: #aaaaaa45;\n      }\n    ")}highlightNode(t=this.graph){t.on("node:mouseenter",function(e){const r=e.item;t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.setItemState(r,"hover",!0),t.paint(),t.setAutoPaint(!0)}),t.on("node:mouseleave",function(){t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.paint(),t.setAutoPaint(!0)})}highlightEdge(t=this.graph){t.on("edge:mouseenter",function(e){const r=e.item;t.setAutoPaint(!1),t.getNodes().forEach(function(e){t.clearItemStates(e)}),t.setItemState(r,"hover",!0),t.paint(),t.setAutoPaint(!0)}),t.on("edge:mouseleave",function(){t.setAutoPaint(!1),t.getEdges().forEach(function(e){t.clearItemStates(e)}),t.paint(),t.setAutoPaint(!0)})}setData(t,e=this.graph){this.data?e.changeData(t):e.data(t),this.data=t}render(t=this.graph){return t.render()}updateGraph(t,e=this.graph){this.data=t,e.changeData(t)}refresh(t=this.graph){t.refresh()}getContainer(t=this.graph){return t.getContainer()}getCanvas(t=this.graph){return t.get("canvas")}getNodes(t=this.graph){return t.getNodes()}getEdges(t=this.graph){return t.getEdges()}getNeighbors(t,e,r=this.graph){return r.getNeighbors(t,e)}findById(t,e=this.graph){return e.findById(t)}find(t,e,r=this.graph){return r.find(t,e)}findAll(t,e,r=this.graph){return r.findAll(t,e)}getEdgesByNode(t){return t.getEdges()}getInEdges(t){return t.getInEdges()}getOutEdges(t){return t.getOutEdges()}getSourceByEdge(t){return t.getSource()}getTargetByEdge(t){return t.getTarget()}expandNode(t){const e=t.getModel().id;this._expandCollapseNode(this.collpasedData[e],"show"),delete this.collpasedData[e]}collapseNode(t){const e=t.getModel().id,r=[];this._collapseFunc(t,r),this.collpasedData[e]=r,this._expandCollapseNode(r)}isCollpased(t){return!!this.collpasedData[t]}_collapseFunc(t,e=[]){const r=this.getNeighbors(t,"target"),i=this.getNeighbors(t,"source");for(let t=0;t<r.length;t++){const i=r[t],s=i.getModel();1===this.getNeighbors(i).length&&e.push({id:s.id})}for(let t=0;t<i.length;t++){const r=i[t],s=r.getModel();let n=this.getNeighbors(r),a=this.getNeighbors(r,"source");if(1===n.length||0===a.length)e.push({id:s.id});else{const t=[];this._collapseFunc(r,t),e.push({id:s.id,children:t})}}return e}_expandCollapseNode(t,e="hide"){t&&t.forEach(t=>{"hide"===e?this.hideItem(t.id):(this.showItem(t.id),this.isCollpased(t.id)&&delete this.collpasedData[t.id]),t.children&&this._expandCollapseNode(t.children,e)})}showItem(t,e,r=this.graph){r.showItem(t,e)}hideItem(t,e,r=this.graph){r.hideItem(t,e)}show(t){t.show()}hide(t){t.hide()}changeVisibility(t,e){t.changeVisibility(e)}isVisible(t){return t.isVisible()}getModel(t){return t.getModel()}addItem(t,e,r=this.graph){r.addItem(t,e)}removeItem(t,e=this.graph){e.removeItem(t)}updateItem(t,e,r=this.graph){r.updateItem(t,e)}refreshItem(t,e=this.graph){e.refreshItem(t)}refreshPositions(t=this.graph){t.refreshPositions()}on(t,e,r=this.graph){r.on(t,e)}off(t,e,r=this.graph){r.off(t,e)}toDataURL(t,e,r=this.graph){r.toDataURL(t,e)}bindNodeDefaultDragEvent(t=this.graph){t.on("node:dragstart",function(t){vo(t)}),t.on("node:drag",function(t){vo(t)}),t.on("node:dragend",function(t){t.item.get("model").fx=null,t.item.get("model").fy=null})}stopDefaultEventPropagation(t=this.graph){t.on("click",function(t){t.stopPropagation()}),t.on("mousedown",function(t){t.stopPropagation()}),t.on("mouseover",function(t){t.stopPropagation()}),t.on("mouseout",function(t){t.stopPropagation()})}clear(t=this.graph){t.clear()}destroy(t=this.graph){t.destroy()}}function vo(t){const e=t.item.get("model");return e.fx=t.x,e.fy=t.y,e.x=t.x,e.y=t.y,e}var bo=r(465),So=r.n(bo);class _o{constructor(t,e="G6"){this.graph=null,this.config=So()(t),this.graphRender=null,this.type=e,this.createGraphRender(this.type),this.config=this.graphRender._getGraphConfig(this.config),this.createGraph(this.config),this.CLASS_NAME="SuperMap.KnowledgeGraph"}static dataFromGraphMap(t,e){return no(t,e)}static dataFromKnowledgeGraphQuery(t){return no(t)}handleNodeStatus(t){const{expand:e,collapse:r,hidden:i}=t;this.expandNodes(e),this.collapseNodes(r),this.hideNodes(i)}expandNodes(t){t&&t.forEach(t=>{this.expandNode(t+"")})}collapseNodes(t){t&&t.forEach(t=>{this.collapseNode(t+"")})}hideNodes(t){t&&t.forEach(t=>{this.hideItem(t+"")})}createGraphRender(t){"G6"===t&&(this.graphRender=new go)}createGraph(t){const e=this.initGraph(t);return this.graph=e,this.autoResize(),e}getGraph(){return this.graph}autoResize(){this.config&&!1!==this.config.autoResize&&this.graphRender.autoResize()}zoom(t,e,r,i){this.graphRender.zoom(t,e,r,i)}zoomTo(t,e,r,i){this.graphRender.zoomTo(t,e,r,i)}fitView(t,e,r,i){this.graphRender.fitView(t,e,r,i)}fitCenter(t,e){this.graphRender.fitCenter(t,e)}getGraphCenterPoint(){return this.graphRender.getGraphCenterPoint()}getViewPortCenterPoint(){return this.graphRender.getViewPortCenterPoint()}getZoom(){return this.graphRender.getZoom()}getMinZoom(){return this.graphRender.getMinZoom()}setMinZoom(t){this.graphRender.setMinZoom(t)}getMaxZoom(){return this.graphRender.getMaxZoom()}setMaxZoom(t){this.graphRender.setMaxZoom(t)}getWidth(){return this.graphRender.getWidth()}getHeight(){return this.graphRender.getHeight()}initGraph(t){const e=this.graphRender.initGraph(t);this.graph=e;return this.graph.on("beforelayout",()=>{void 0!==this.config.zoom&&this.zoom(this.config.zoom),void 0!==this.config.center&&this.graphRender.setCenter({x:this.config.center[0],y:this.config.center[1]})}),e}setData(t,e=this.graph){t=t||{nodes:[],edges:[]},this.config&&this.config.nodeLabelMaxWidth&&(t.nodes=this.nodeLabelOpenEllipsis(this.config.nodeLabelMaxWidth,t.nodes)),this.graphRender.setData(t,e),this.render(e),this.data=t}render(t=this.graph){t&&this.graphRender.render(t)}updateGraph(t,e=this.graph){e&&this.graphRender.updateGraph(t,e)}refresh(){return this.graphRender.refresh()}changeSize(t,e){return this.graphRender.changeSize(t,e)}resize(t,e){this.graphRender.changeSize(t,e),this.graphRender.refresh()}getContainer(){return this.graphRender.getContainer()}getCanvas(){return this.graphRender.getCanvas()}getNodes(){return this.graphRender.getNodes()}getEdges(){return this.graphRender.getEdges()}getNeighbors(t,e){return this.graphRender.getNeighbors(t,e)}findById(t){return this.graphRender.findById(t)}find(t,e){return this.graphRender.find(t,e)}findAll(t,e){return this.graphRender.findAll(t,e)}getEdgesByNode(t){return this.graphRender.getEdgesByNode(t)}getInEdges(t){return this.graphRender.getInEdges(t)}getOutEdges(t){return this.graphRender.getOutEdges(t)}getSourceByEdge(t){return this.graphRender.getSourceByEdge(t)}getTargetByEdge(t){return this.graphRender.getTargetByEdge(t)}expandNode(t){const e=this.findById(t);e&&this.graphRender.expandNode(e)}collapseNode(t){const e=this.findById(t);e&&this.graphRender.collapseNode(e)}showItem(t,e){this.graphRender.showItem(t,e)}hideItem(t,e){this.graphRender.hideItem(t,e)}show(t){this.graphRender.show(t)}hide(t){this.graphRender.hide(t)}changeVisibility(t,e){this.graphRender.changeVisibility(t,e)}isVisible(t){return this.graphRender.isVisible(t)}getModel(t){return this.graphRender.getModel(t)}addItem(t,e){return this.graphRender.addItem(t,e)}removeItem(t){return this.graphRender.removeItem(t)}updateItem(t,e){return this.graphRender.updateItem(t,e)}refreshItem(t){return this.graphRender.refreshItem(t)}refreshPositions(){return this.graphRender.refreshPositions()}on(t,e){this.graphRender.on(t,e)}off(t,e){this.graphRender.off(t,e)}toDataURL(t,e){this.graphRender.toDataURL(t,e)}nodeLabelOpenEllipsis(t,e){return e?t?e.map(e=>{const r=e.labelCfg&&e.labelCfg.fontSize||this.defaultNode&&this.defaultNode.labelCfg&&this.defaultNode.labelCfg.fontSize||14;return e.label=function(t,e,r){const i=1*r;e*=1.6;if((t=>{let e=0;for(let r=0;r<t.length;r++)t.charCodeAt(r)>0&&t.charCodeAt(r)<128?e++:e+=2;return e})(t)*i>e){const r=Math.floor((e-20)/i),s=t.substring(0,r);return(t.substring(r).length+"â¦".length)*i>e?s+"\n"+t.substring(r,r+r-2)+"â¦":0==t.substring(r).length?s:s+"\n"+t.substring(r)}return t}(e.label,t,r),e}):e:[]}clear(t=this.graph){t&&t.clear()}destroy(t=this.graph){t&&t.destroy()}}t.Lang=ja,t.i18n=t.Lang.i18n,t.Util={...t.Util,...rt},t.Browser=K,t.INCHES_PER_UNIT=it,t.METERS_PER_INCH=st,t.DOTS_PER_INCH=et,t.IS_GECKO=tt,t.setCORS=function(t){Rt=t},t.isCORS=Ut,t.setRequestTimeout=function(t){return Bt=t},t.getRequestTimeout=jt,t.FetchRequest=zt,t.inherit=function(t,e){var r,i,s,n=function(){};for(n.prototype=e.prototype,t.prototype=new n,r=2,i=arguments.length;r<i;r++)"function"==typeof(s=arguments[r])&&(s=s.prototype),rt.extend(t.prototype,s)},t.mixin=H,t.String=W,t.Number=Y,t.Function=X,t.Array=Q,t.Date=bt,t.Event=St,t.Bounds=at,t.Credential=vt,t.Events=_t,t.Feature=xt,t.Geometry=Z,t.Geometry3D=class extends Tt{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry3D",this.position=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.scaleX=null,this.scaleY=null,this.scaleZ=null,rt.extend(this,t)}destroy(){this.position=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.scaleX=null,this.scaleY=null,this.scaleZ=null}},t.Pixel=q,t.Size=J,t.Feature.Vector=Ot,t.Geometry.Collection=ot,t.Geometry.Curve=ht,t.Geometry.GeoText=dt,t.Geometry.LinearRing=pt,t.Geometry.LineString=ct,t.Geometry.MultiLineString=ft,t.Geometry.MultiPoint=lt,t.Geometry.MultiPolygon=mt,t.Geometry.Point=ut,t.Geometry.Polygon=yt,t.Geometry.Rectangle=gt,t.Components.Chart=class{constructor(t,e){this.domID=t,this.chartType=e.type||"bar",e.datasets.type=e.datasets.type||"iServer",e.datasets.withCredentials=e.datasets.withCredentials||!1,this.viewModel=new qa(e),this._fillDataToView()}onAdd(t){this.addChart=t}_fillDataToView(){let t=new Ga;this.viewModel.getDatasetInfo(this._createChart.bind(this)),this.viewModel.events.on({getdatafailed:e=>{t.showView(e.message)}})}getStyle(){return this.viewModel.getStyle()}getFeatures(){return this.viewModel.getFeatures()}setStyle(t){let e=this.viewModel.setStyle(t);this._updateChart(e)}changeType(t){if(this.chartType!==t){this.chartType=t;let e=this.viewModel.changeType(t);this._updateChart(e)}}updateData(t,e){let r=this;this.viewModel.updateData(t,e,function(t){r._updateChart(t),r.addChart&&r.addChart()})}_createChart(t){this.echart=Ua.init(document.getElementById(this.domID),null,{renderer:"canvas"});let e=this.viewModel._createChartOptions(t);this.echart.setOption(e),this.addChart&&this.addChart()}_updateChart(t){this.echart&&(this.echart.clear(),this.echart.setOption(t))}},t.Components.ChartViewModel=qa,t.Components.MessageBox=Ga,t.Components.AttributesPopContainer=Za,t.Components.CityTabsPage=$a,t.Components.CommonContainer=Wa,t.Components.DropDownBox=Xa,t.Components.IndexTabsPageContainer=Ka,t.Components.NavTabsPage=to,t.Components.PaginationContainer=eo,t.Components.PopContainer=Qa,t.Components.Select=Ya,t.Components.TemplateBase=Ha,t.Components.FileReaderUtil=Va,t.TimeControlBase=It,t.TimeFlowControl=class extends It{constructor(t,e){super(e);var r=this;r.callback=t,Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,i=function(){},s=function(){return r.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,s.prototype=new i,s}),r.update=r.update.bind(r),r.oldTime=r.currentTime,r.CLASS_NAME="SuperMap.TimeFlowControl"}updateOptions(t){t=t||{},super.updateOptions(t)}start(){var t=this;t.running||(t.running=!0,t.reverse?t.currentTime===t.startTime&&(t.oldTime=t.endTime,t.currentTime=t.oldTime):t.oldTime===t.endTime&&(t.currentTime=t.startTime,t.oldTime=t.currentTime),t.tick())}stop(){super.stop();var t=this;t.oldTime=t.currentTime,t.running&&(t.running=!1),t.intervalId&&window.clearTimeout(t.intervalId)}destroy(){super.destroy(),this.oldTime=null,this.callback=null}tick(){var t=this;t.intervalId&&window.clearInterval(t.intervalId),t.intervalId=null,t.update(),t.intervalId=window.setInterval(t.update,t.frequency)}update(){var t=this;if(t.running)if(t.callback&&t.callback(t.currentTime),t.reverse){if(t.currentTime===t.startTime){if(!t.repeat)return t.running=!1,null;t.oldTime=t.endTime,t.currentTime=t.oldTime}else t.currentTime=t.oldTime,t.oldTime-=t.speed;t.oldTime<=t.startTime&&(t.oldTime=t.startTime)}else{if(t.currentTime===t.endTime){if(!t.repeat)return t.running=!1,t.stop(),null;t.stop(),t.currentTime=t.startTime,t.oldTime=t.currentTime,t.start()}else t.oldTime=t.currentTime,t.currentTime+=t.speed;t.currentTime>=t.endTime&&(t.currentTime=t.endTime)}}},t.Format=t.Format||Lt,t.Format.GeoJSON=Nt,t.Format.JSON=Pt,t.Format.WKT=class extends Lt{constructor(t){super(t),this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},this.CLASS_NAME="SuperMap.Format.WKT",this.extract={point:function(t){return t.x+" "+t.y},multipoint(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push("("+this.extract.point.apply(this,[t.components[r]])+")");return e.join(",")},linestring(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extract.point.apply(this,[t.components[r]]));return e.join(",")},multilinestring(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push("("+this.extract.linestring.apply(this,[t.components[r]])+")");return e.join(",")},polygon(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push("("+this.extract.linestring.apply(this,[t.components[r]])+")");return e.join(",")},multipolygon(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push("("+this.extract.polygon.apply(this,[t.components[r]])+")");return e.join(",")},collection(t){for(var e=[],r=0,i=t.components.length;r<i;++r)e.push(this.extractGeometry.apply(this,[t.components[r]]));return e.join(",")}},this.parse={point:function(t){var e=W.trim(t).split(this.regExes.spaces);return new Ot(new ut(e[0],e[1]))},multipoint:function(t){for(var e,r=W.trim(t).split(","),i=[],s=0,n=r.length;s<n;++s)e=r[s].replace(this.regExes.trimParens,"$1"),i.push(this.parse.point.apply(this,[e]).geometry);return new Ot(new lt(i))},linestring:function(t){for(var e=W.trim(t).split(","),r=[],i=0,s=e.length;i<s;++i)r.push(this.parse.point.apply(this,[e[i]]).geometry);return new Ot(new ct(r))},multilinestring:function(t){for(var e,r=W.trim(t).split(this.regExes.parenComma),i=[],s=0,n=r.length;s<n;++s)e=r[s].replace(this.regExes.trimParens,"$1"),i.push(this.parse.linestring.apply(this,[e]).geometry);return new Ot(new ft(i))},polygon:function(t){for(var e,r,i,s=W.trim(t).split(this.regExes.parenComma),n=[],a=0,o=s.length;a<o;++a)e=s[a].replace(this.regExes.trimParens,"$1"),r=this.parse.linestring.apply(this,[e]).geometry,i=new pt(r.components),n.push(i);return new Ot(new yt(n))},multipolygon:function(t){for(var e,r=W.trim(t).split(this.regExes.doubleParenComma),i=[],s=0,n=r.length;s<n;++s)e=r[s].replace(this.regExes.trimParens,"$1"),i.push(this.parse.polygon.apply(this,[e]).geometry);return new Ot(new mt(i))},geometrycollection:function(t){t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var e=W.trim(t).split("|"),r=[],i=0,s=e.length;i<s;++i)r.push(this.read(e[i]));return r}}}read(t){var e,r,i;t=t.replace(/[\n\r]/g," ");var s=this.regExes.typeStr.exec(t);return s&&(r=s[1].toLowerCase(),i=s[2],this.parse[r]&&(e=this.parse[r].apply(this,[i]))),e}write(t){var e,r,i;t.constructor===Array?(e=t,i=!0):(e=[t],i=!1);var s=[];i&&s.push("GEOMETRYCOLLECTION(");for(var n=0,a=e.length;n<a;++n)i&&n>0&&s.push(","),r=e[n].geometry,s.push(this.extractGeometry(r));return i&&s.push(")"),s.join("")}extractGeometry(t){var e=t.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[e]?("collection"===e?"GEOMETRYCOLLECTION":e.toUpperCase())+"("+this.extract[e].apply(this,[t])+")":null}},t.iManager=class extends Jt{constructor(t){super(t)}load(){return this.request("GET",this.serviceUrl+"/web/api/service.json")}createIServer(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/server.json",new qt(t))}createIPortal(t){return this.request("POST",this.serviceUrl+"/icloud/web/nodes/portal.json",new qt(t))}iServerList(){return this.request("GET",this.serviceUrl+"/cloud/web/nodes/server.json")}iPortalList(){return this.request("GET",this.serviceUrl+"/icloud/web/nodes/portal.json")}startNodes(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/started.json",t)}stopNodes(t){return this.request("POST",this.serviceUrl+"/cloud/web/nodes/stopped.json",t)}},t.iManagerCreateNodeParam=qt,t.iManagerServiceBase=Jt,t.iPortal=class extends Ht{constructor(t,e){super(t,e),this.iportalUrl=t,e=e||{},this.withCredentials=e.withCredentials||!1}load(){return zt.get(this.iportalUrl+"/web")}queryResources(t){if(!(t instanceof Wt))return new Promise(function(t){t("queryParams is not instanceof iPortalQueryParam !")});var e=this,r=this.iportalUrl+"/gateway/catalog/resource/search.json";return t.t=(new Date).getTime(),this.request("GET",r,t).then(function(t){var r=[];(t.content||[]).forEach(function(t){r.push(new Xt(e.iportalUrl,t))});let i=new Yt;return i.content=r,i.total=t.total,i.currentPage=t.currentPage,i.pageSize=t.pageSize,i.aggregations=t.aggregations,i})}updateResourcesShareSetting(t){if(!(t instanceof Qt))return new Promise(function(t){t("shareParams is not instanceof iPortalShareParam !")});var e=t.resourceType.replace("_","").toLowerCase()+"s";"datas"===e&&(e="mycontent/"+e);var r={ids:t.ids,entities:t.entities},i=this.iportalUrl+"/web/"+e+"/sharesetting.json";return this.request("PUT",i,JSON.stringify(r)).then(function(t){return t})}},t.iPortalAddDataParam=$t,t.iPortalAddResourceParam=Zt,t.iPortalDataConnectionInfoParam=re,t.iPortalDataMetaInfoParam=te,t.iPortalDataStoreInfoParam=ee,t.iPortalQueryParam=Wt,t.iPortalQueryResult=Yt,t.iPortalRegisterServiceParam=Kt,t.iPortalResource=Xt,t.iPortalServiceBase=Ht,t.iPortalShareEntity=class{constructor(t){t=t||{},this.permissionType="",this.entityType="",this.entityName="GUEST",this.entityId=null,rt.extend(this,t)}},t.iPortalShareParam=Qt,t.iPortalUser=class extends Ht{constructor(t){super(t),this.iportalUrl=t}deleteResources(t){var e=t.resourceType.replace("_","").toLowerCase(),r=this.iportalUrl+"/web/"+e+"s.json?ids="+encodeURI(JSON.stringify(t.ids));return"data"===e?(r=this.iportalUrl+"/web/mycontent/datas/delete.json",this.request("POST",r,JSON.stringify(t.ids))):this.request("DELETE",r)}addMap(t){if(!(t instanceof Zt))return this.getErrMsgPromise("addMapParams is not instanceof IPortalAddResourceParam !");let e={rootUrl:t.rootUrl,tags:t.tags,authorizeSetting:t.entities},r=this.iportalUrl+"/web/maps/batchaddmaps.json";return this.request("POST",r,JSON.stringify(e)).then(function(t){return t})}addScene(t){if(!(t instanceof Zt))return this.getErrMsgPromise("addSceneParams is not instanceof IPortalAddResourceParam !");let e={rootUrl:t.rootUrl,tags:t.tags,authorizeSetting:t.entities},r=this.iportalUrl+"/web/scenes/batchaddscenes.json";return this.request("POST",r,JSON.stringify(e)).then(function(t){return t})}registerService(t){if(!(t instanceof Kt))return this.getErrMsgPromise("registerParams is not instanceof IPortalRegisterServiceParam !");let e={type:t.type,tags:t.tags,authorizeSetting:t.entities,metadata:t.metadata,addedMapNames:t.addedMapNames,addedSceneNames:t.addedSceneNames},r=this.iportalUrl+"/web/services.json";return this.request("POST",r,JSON.stringify(e)).then(t=>t)}getErrMsgPromise(t){return new Promise(e=>{e(t)})}uploadDataRequest(t,e){var r=this.iportalUrl+"/web/mycontent/datas/"+t+"/upload.json";return this.request("POST",r,e)}addData(t,e){if(!(t instanceof $t))return this.getErrMsgPromise("params is not instanceof iPortalAddDataParam !");var r,i=this.iportalUrl+"/web/mycontent/datas.json",s={fileName:t.fileName,tags:t.tags,type:t.type},n=t.type.toLowerCase();if("excel"===n||"csv"===n){if(!(t.dataMetaInfo instanceof te))return this.getErrMsgPromise("params.dataMetaInfo is not instanceof iPortalDataMetaInfoParam !");r={xField:t.dataMetaInfo.xField,yField:t.dataMetaInfo.yField},"csv"===n&&(r.fileEncoding=t.dataMetaInfo.fileEncoding),s.coordType="WGS84",s.dataMetaInfo=r}else if("hdfs"===n||"hbase"===n){if(!(t.dataMetaInfo instanceof te))return this.getErrMsgPromise("params.dataMetaInfo is not instanceof iPortalDataMetaInfoParam !");if(!(t.dataMetaInfo.dataStoreInfo instanceof ee))return this.getErrMsgPromise("params.dataMetaInfo.dataStoreInfo is not instanceof iPortalDataStoreInfoParam !");var a={type:t.dataMetaInfo.dataStoreInfo.type};switch(n){case"hdfs":a.url=t.dataMetaInfo.dataStoreInfo.url,r={url:t.dataMetaInfo.url,dataStoreInfo:a};break;case"hbase":if(!(t.dataMetaInfo.dataStoreInfo.connectionInfo instanceof re))return this.getErrMsgPromise("params.dataMetaInfo.dataStoreInfo.connectionInfo is not instanceof iPortalDataConnectionInfoParam !");a.connectionInfo={dataBase:t.dataMetaInfo.dataStoreInfo.connectionInfo.dataBase,server:t.dataMetaInfo.dataStoreInfo.connectionInfo.server,engineType:"HBASE"},a.datastoreType="SPATIAL",r={dataStoreInfo:a}}s.dataMetaInfo=r}return this.request("POST",i,JSON.stringify(s)).then(t=>"hdfs"===n||"hbase"===n?t:t.childID?this.uploadDataRequest(t.childID,e):t.customResult)}publishOrUnpublish(t,e){if(!t.dataId||!t.serviceType)return this.getErrMsgPromise("option.dataID and option.serviceType are Required!");var r=t.dataId,i=t.dataServiceId,s=t.serviceType,n=this.iportalUrl+"/web/mycontent/datas/"+r+"/publishstatus.json?serviceType="+s;return i&&(n+="&dataServiceId="+i),this.request("PUT",n,JSON.stringify(e)).then(t=>e?(i||(i=t.customResult),i):t)}getDataPublishedStatus(t,e){var r=this.iportalUrl+"/web/mycontent/datas/"+t+"/publishstatus.json?dataServiceId="+e+"&forPublish=true";return this.request("GET",r)}unPublishDataService(t){return this.publishOrUnpublish(t,!1)}publishDataService(t){return this.publishOrUnpublish(t,!0)}},t.AddressMatchService=ae,t.AggregationParameter=oe,t.AreaSolarRadiationParameters=he,t.AreaSolarRadiationService=ce,t.BucketAggParameter=le,t.BufferAnalystParameters=fe,t.BufferAnalystService=be,t.BufferDistance=de,t.BuffersAnalystJobsParameter=we,t.BuffersAnalystJobsService=Me,t.BufferSetting=pe,t.BurstPipelineAnalystParameters=Ae,t.BurstPipelineAnalystService=Ee,t.ChartFeatureInfoSpecsService=Oe,t.ChartQueryFilterParameter=Le,t.ChartQueryParameters=Pe,t.ChartQueryService=Ie,t.ClipParameter=class{constructor(t){this.clipDatasetName=null,this.clipDatasourceName=null,this.clipRegion=null,this.isClipInRegion=!0,this.isExactClip=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ClipParameter"}destroy(){var t=this;t.clipDatasetName=null,t.clipDatasourceName=null,t.clipRegion=null,t.isClipInRegion=null,t.isExactClip=null}toJSON(){return rt.toJSON({isClipInRegion:this.isClipInRegion,clipDatasetName:this.clipDatasetName,clipDatasourceName:this.clipDatasourceName,isExactClip:this.isExactClip,clipRegion:Tt.fromGeometry(this.clipRegion)})}},t.ColorDictionary=Fe,t.CommonServiceBase=ie,t.ComputeWeightMatrixParameters=Re,t.ComputeWeightMatrixService=Be,t.CreateDatasetParameters=an,t.DataFlowService=Ge,t.DataReturnOption=me,t.DatasetBufferAnalystParameters=ge,t.DatasetInfo=Ue,t.DatasetOverlayAnalystParameters=ze,t.DatasetService=kr,t.DatasetSurfaceAnalystParameters=qe,t.DatasetThiessenAnalystParameters=We,t.DatasourceConnectionInfo=Se,t.DatasourceService=Ye,t.DensityAnalystService=Qe,t.DensityKernelAnalystParameters=Xe,t.EditFeaturesParameters=Ze,t.EditFeaturesService=Ke,t.FacilityAnalyst3DParameters=$e,t.FacilityAnalystSinks3DParameters=tr,t.FacilityAnalystSinks3DService=er,t.FacilityAnalystSources3DParameters=rr,t.FacilityAnalystSources3DService=ir,t.FacilityAnalystStreamParameters=sr,t.FacilityAnalystStreamService=nr,t.FacilityAnalystTracedown3DParameters=ar,t.FacilityAnalystTracedown3DService=or,t.FacilityAnalystTraceup3DParameters=lr,t.FacilityAnalystTraceup3DService=hr,t.FacilityAnalystUpstream3DParameters=ur,t.FacilityAnalystUpstream3DService=cr,t.FieldParameters=dr,t.FieldsFilter=Tn,t.FieldStatisticService=fr,t.FieldStatisticsParameters=pr,t.FilterParameter=ye,t.FindClosestFacilitiesParameters=mr,t.FindClosestFacilitiesService=yr,t.FindLocationParameters=gr,t.FindLocationService=vr,t.FindMTSPPathsParameters=br,t.FindMTSPPathsService=Sr,t.FindPathParameters=_r,t.FindPathService=xr,t.FindServiceAreasParameters=wr,t.FindServiceAreasService=Cr,t.FindTSPPathsParameters=Mr,t.FindTSPPathsService=Ar,t.GenerateSpatialDataParameters=Tr,t.GenerateSpatialDataService=Er,t.GeoCodingParameter=se,t.GeoDecodingParameter=ne,t.GeoHashGridAggParameter=class extends le{constructor(t){super(),this.precision=5,rt.extend(this,t),this.aggType=G.GEOHASH_GRID,this.CLASS_NAME="SuperMap.GeoHashGridAggParameter"}destroy(){super.destroy(),this.aggType=null,this.precision=null}static toJsonParameters(t){var e={aggName:t.aggName,aggFieldName:t.aggFieldName,aggType:t.aggType,precision:t.precision};return rt.toJson(e)}},t.GeometryBatchAnalystService=Xs,t.GeometryBufferAnalystParameters=ve,t.GeometryOverlayAnalystParameters=Or,t.GeometrySurfaceAnalystParameters=Lr,t.GeometryThiessenAnalystParameters=Pr,t.GeoprocessingService=Nr,t.GeoRelationAnalystParameters=Ir,t.GeoRelationAnalystService=Fr,t.GetFeaturesByBoundsParameters=Rr,t.GetFeaturesByBoundsService=Gr,t.GetFeaturesByBufferParameters=Ur,t.GetFeaturesByBufferService=jr,t.GetFeaturesByGeometryParameters=zr,t.GetFeaturesByGeometryService=Vr,t.GetFeaturesByIDsParameters=Jr,t.GetFeaturesByIDsService=qr,t.GetFeaturesBySQLParameters=Hr,t.GetFeaturesBySQLService=Wr,t.GetFeaturesParametersBase=Dr,t.GetFeaturesServiceBase=Br,t.GetFieldsService=Yr,t.GetGridCellInfosParameters=Xr,t.GetGridCellInfosService=Qr,t.GetLayersInfoService=Ai,t.Grid=wi,t.HillshadeParameter=class extends pn{constructor(t){super(t),this.altitude=45,this.azimuth=315,this.zFactor=1,this.type=j.HILLSHADE,rt.extend(this,t),this.CLASS_NAME="SuperMap.HillshadeParameter"}destroy(){super.destroy(),this.altitude=null,this.azimuth=null,this.zFactor=null}toJSON(){return{altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,type:this.type}}},t.Image=Ci,t.ImageCollectionService=Mn,t.ImageGFAspect=In,t.ImageGFHillShade=Nn,t.ImageGFOrtho=Fn,t.ImageGFSlope=kn,t.ImageRenderingRule=Pn,t.ImageSearchParameter=On,t.ImageService=An,t.ImageStretchOption=Ln,t.InterpolationAnalystParameters=Ti,t.InterpolationAnalystService=Ni,t.InterpolationDensityAnalystParameters=Oi,t.InterpolationIDWAnalystParameters=Li,t.InterpolationKrigingAnalystParameters=Pi,t.InterpolationRBFAnalystParameters=Ei,t.JoinItem=Si,t.KernelDensityJobParameter=Ii,t.KernelDensityJobsService=Fi,t.LabelImageCell=class extends ki{constructor(t){super(t),this.height=0,this.pathField=null,this.rotation=0,this.width=0,this.sizeFixed=!1,this.type="IMAGE",t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.LabelImageCell"}destroy(){var t=this;t.height=null,t.pathField=null,t.rotation=null,t.width=null,t.sizeFixed=null}},t.LabelMatrixCell=ki,t.LabelMixedTextStyle=ri,t.LabelSymbolCell=class extends ki{constructor(t){super(t),this.style=new Ct,this.symbolIDField=null,this.type="SYMBOL",t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.LabelSymbolCell"}destroy(){this.style&&(this.style.destroy(),this.style=null),this.symbolIDField=null}},t.LabelThemeCell=class extends ki{constructor(t){super(t),this.themeLabel=new ai,this.type="THEME",t&&rt.extend(this,t),this.CLASS_NAME=" SuperMap.LabelThemeCell"}destroy(){this.themeLabel&&(this.themeLabel.destroy(),this.themeLabel=null)}},t.LayerStatus=class{constructor(t){this.layerName=null,this.isVisible=null,this.displayFilter=null,this.fieldValuesDisplayFilter=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.LayerStatus"}destroy(){this.layerName=null,this.isVisible=null,this.displayFilter=null}toJSON(){var t="{";t+='"type":"UGC",';var e=[];return this.layerName&&(e.push('"name":"'+this.layerName+'"'),e.push('"visible":'+this.isVisible)),this.displayFilter&&e.push('"displayFilter":"'+this.displayFilter+'"'),(this.minScale||0==this.minScale)&&e.push('"minScale":'+this.minScale),(this.maxScale||0==this.maxScale)&&e.push('"maxScale":'+this.maxScale),this.fieldValuesDisplayFilter&&e.push('"fieldValuesDisplayFilter":'+rt.toJSON(this.fieldValuesDisplayFilter)),t+=e,t+="}"}},t.LinkItem=class{constructor(t){this.datasourceConnectionInfo=null,this.foreignKeys=null,this.foreignTable=null,this.linkFields=null,this.linkFilter=null,this.name=null,this.primaryKeys=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.LinkItem"}destroy(){var t=this;t.datasourceConnectionInfo instanceof Se&&(t.datasourceConnectionInfo.destroy(),t.datasourceConnectionInfo=null),t.foreignKeys=null,t.foreignTable=null,t.linkFields=null,t.linkFilter=null,t.name=null,t.primaryKeys=null}},t.MappingParameters=xe,t.MapService=Di,t.MathExpressionAnalysisParameters=Ri,t.MathExpressionAnalysisService=Bi,t.MeasureParameters=Gi,t.MeasureService=Ui,t.MetricsAggParameter=class extends oe{constructor(t){super(),this.aggType=U.AVG,rt.extend(this,t),this.CLASS_NAME="SuperMap.MetricsAggParameter"}destroy(){super.destroy(),this.aggType=null}},t.NDVIParameter=class extends pn{constructor(t){super(t),this.redIndex=0,this.nirIndex=1,this.colorMap="0:ffffe5ff;0.1:f7fcb9ff;0.2:d9f0a3ff;0.3:addd8eff;0.4:78c679ff;0.5:41ab5dff;0.6:238443ff;0.7:006837ff;1:004529ff",this.type=j.NDVI,rt.extend(this,t),this.CLASS_NAME="SuperMap.NDVIParameter"}destroy(){super.destroy(),this.redIndex=null,this.nirIndex=null,this.colorMap=null}toJSON(){return{redIndex:this.redIndex,nirIndex:this.nirIndex,colorMap:this.colorMap,type:this.type}}},t.NetworkAnalystServiceBase=Te,t.OutputSetting=_e,t.OverlapDisplayedOptions=class{constructor(t){t=t||{},this.allowPointOverlap=!0,this.allowPointWithTextDisplay=!0,this.allowTextOverlap=!1,this.allowTextAndPointOverlap=!0,this.allowThemeGraduatedSymbolOverlap=!1,this.allowThemeGraphOverlap=!1,this.horizontalOverlappedSpaceSize=0,this.verticalOverlappedSpaceSize=0,rt.extend(this,t),this.ugcLayer=new vi(t),this.CLASS_NAME="SuperMap.OverlapDisplayedOptions"}destroy(){rt.reset(this)}fromJson(t){this.ugcLayer.fromJson.apply(this,[t])}toServerJSONObject(){return this.ugcLayer.toServerJSONObject.apply(this,arguments)}toString(){var t=this.ugcLayer.toServerJSONObject.apply(this,arguments),e="{";for(var r in t)t.hasOwnProperty(r)&&(e+="'"+r+"':"+t[r]+",");return e=e.substr(0,e.length-1),e+="}"}},t.OverlayAnalystParameters=je,t.OverlayAnalystService=ji,t.OverlayGeoJobParameter=zi,t.OverlayGeoJobsService=Vi,t.PointWithMeasure=Mt,t.ProcessingServiceBase=Ce,t.QueryByBoundsParameters=Ji,t.QueryByBoundsService=Hi,t.QueryByDistanceParameters=Wi,t.QueryByDistanceService=Yi,t.QueryByGeometryParameters=Xi,t.QueryByGeometryService=Qi,t.QueryBySQLParameters=Zi,t.QueryBySQLService=Ki,t.DatasetMinDistanceAnalystParameters=ts,t.MinDistanceAnalystService=rs,t.TerrainCutFillCalculationParameters=is,t.TerrainCutFillCalculationService=ss,t.terrainAnalystSetting=class{constructor(t){this.bounds=null,this.boundsType=z.MAX,this.cellSize=null,this.cellSizeType=V.UNION,rt.extend(this,t),this.CLASS_NAME="SuperMap.terrainAnalystSetting"}destroy(){this.bounds=null,this.boundsType=null,this.cellSize=null,this.cellSizeType=null}},t.TerrainAspectCalculationParameters=ns,t.TerrainAspectCalculationService=as,t.TerrainSlopeCalculationParameters=os,t.TerrainSlopeCalculationService=ls,t.GeometryMinDistanceAnalystParameters=es,t.ConvexHullAnalystParameters=class{constructor(t){this.model=null,this.resultSetting=null,t&&rt.extend(this,t),this.CLASS_NAME="SuperMap.ConvexHullAnalystParameters"}destroy(){this.model=null,this.resultSetting=null}},t.ConvexHullAnalystService=hs,t.TraceAnalystParameters=us,t.TraceAnalystService=cs,t.ConnectedEdgesAnalystParameters=ds,t.ConnectedEdgesAnalystService=ps,t.GetLayersLegendInfoParameters=class{constructor(t){this.bbox=null,this.layers=null,this.transparent=null,this.mapScale=null,this.returnVisibleOnly=null,this.width=null,this.height=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.GetLayersLegendInfoParameters"}destroy(){var t=this;t.bbox=null,t.layers=null,t.transparent=null,t.mapScale=null,t.returnVisibleOnly=null,t.width=null,t.height=null}},t.GetLayersLegendInfoService=fs,t.QueryParameters=Ne,t.QueryService=ms,t.RasterFunctionParameter=pn,t.Route=At,t.RouteCalculateMeasureParameters=ys,t.RouteCalculateMeasureService=gs,t.RouteLocatorParameters=vs,t.RouteLocatorService=bs,t.ServerColor=wt,t.ServerFeature=Ss,t.ServerGeometry=Tt,t.ServerStyle=Ct,t.ServerTextStyle=Kr,t.ServerTheme=xi,t.SetDatasourceParameters=_s,t.SetLayerInfoParameters=class{constructor(t){t=t||{},this.resourceID=null,this.tempLayerName=null,this.layerInfo=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SetLayerInfoParameters"}destroy(){this.resourceID=null,this.tempLayerName=null,this.layerInfo=null}},t.SetLayerInfoService=xs,t.SetLayersInfoParameters=class{constructor(t){t=t||{},this.isTempLayers=null,this.resourceID=null,this.layersInfo=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.SetLayersInfoParameters"}destroy(){this.isTempLayers=null,this.resourceID=null,this.layersInfo=null}},t.SetLayersInfoService=ws,t.SetLayerStatusParameters=Cs,t.SetLayerStatusService=Ms,t.SingleObjectQueryJobsParameter=As,t.SingleObjectQueryJobsService=Ts,t.Sortby=En,t.SpatialAnalystBase=ue,t.StopQueryParameters=Es,t.StopQueryService=Os,t.SummaryAttributesJobsParameter=Ls,t.SummaryAttributesJobsService=Ps,t.SummaryMeshJobParameter=Ns,t.SummaryMeshJobsService=Is,t.SummaryRegionJobParameter=Fs,t.SummaryRegionJobsService=ks,t.SupplyCenter=Ds,t.SurfaceAnalystParameters=Je,t.SurfaceAnalystParametersSetting=Ve,t.SurfaceAnalystService=Rs,t.TerrainCurvatureCalculationParameters=Bs,t.TerrainCurvatureCalculationService=Gs,t.Theme=Zr,t.ThemeDotDensity=pi,t.ThemeFlow=Us,t.ThemeGraduatedSymbol=mi,t.ThemeGraduatedSymbolStyle=fi,t.ThemeGraph=di,t.ThemeGraphAxes=li,t.ThemeGraphItem=ci,t.ThemeGraphSize=hi,t.ThemeGraphText=ui,t.ThemeGridRange=zs,t.ThemeGridRangeItem=js,t.ThemeGridUnique=Js,t.ThemeGridUniqueItem=Vs,t.ThemeLabel=ai,t.ThemeLabelAlongLine=si,t.ThemeLabelBackground=ni,t.ThemeLabelItem=$r,t.ThemeLabelText=ii,t.ThemeLabelUniqueItem=qs,t.ThemeMemoryData=class{constructor(t,e){this.srcData=t,this.targetData=e,this.CLASS_NAME="SuperMap.ThemeMemoryData"}destroy(){this.srcData=null,this.targetData=null}toJSON(){if(this.srcData&&this.targetData){for(var t="",e=Math.min(this.srcData.length,this.targetData.length),r=0;r<e;r++)t+="'"+this.srcData[r]+"':'"+this.targetData[r]+"',";return r>0&&(t=t.substring(0,t.length-1)),"{"+t+"}"}return null}},t.ThemeOffset=ei,t.ThemeParameters=Hs,t.ThemeRange=gi,t.ThemeRangeItem=yi,t.ThemeService=Ws,t.ThemeUnique=oi,t.ThemeUniqueItem=ti,t.ThiessenAnalystParameters=He,t.ThiessenAnalystService=Ys,t.TilesetsService=Qs,t.TopologyValidatorJobsParameter=Zs,t.TopologyValidatorJobsService=Ks,t.TransferLine=$s,t.TransferPathParameters=tn,t.TransferPathService=en,t.TransferSolutionParameters=rn,t.TransferSolutionService=sn,t.TransportationAnalystParameter=De,t.TransportationAnalystResultSetting=ke,t.UGCLayer=vi,t.UGCMapLayer=bi,t.UGCSubLayer=_i,t.UpdateDatasetParameters=un,t.UpdateEdgeWeightParameters=nn,t.UpdateEdgeWeightService=on,t.UpdateTurnNodeWeightParameters=ln,t.UpdateTurnNodeWeightService=hn,t.Vector=Mi,t.VectorClipJobsParameter=cn,t.VectorClipJobsService=dn,t.WebPrintingJobContent=_n,t.WebPrintingJobCustomItems=fn,t.WebPrintingJobExportOptions=wn,t.WebPrintingJobImage=mn,t.WebPrintingJobLayers=yn,t.WebPrintingJobLayoutOptions=xn,t.WebPrintingJobLegendOptions=gn,t.WebPrintingJobLittleMapOptions=vn,t.WebPrintingJobNorthArrowOptions=bn,t.WebPrintingJobParameters=class{constructor(t){t&&(this.content=null,this.layoutOptions=null,this.exportOptions=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.WebPrintingJobParameters")}destroy(){this.content instanceof _n&&(this.content.destroy(),this.content=null),this.layoutOptions instanceof xn&&(this.layoutOptions.destroy(),this.layoutOptions=null),this.exportOptions instanceof wn&&(this.exportOptions.destroy(),this.exportOptions=null)}},t.WebPrintingJobScaleBarOptions=Sn,t.WebPrintingService=Cn,t.Online=class{constructor(){this.rootUrl="https://www.supermapol.com",this.webUrl=this.rootUrl+"/web";var t=this.webUrl+"/mycontent";this.mDatasUrl=t+"/datas",this.CLASS_NAME="SuperMap.Online"}load(){return zt.get(this.rootUrl).then(function(t){return t})}login(){Vt.loginOnline(this.rootUrl,!0)}queryDatas(t){var e=this,r=e.mDatasUrl;return t&&(t=t.toJSON()),zt.get(r,t).then(function(t){if(t&&t.content&&!(t.content.length<1)){for(var r=[],i=t.content,s=i.length,n=0;n<s;n++){var a=i[n],o=new Rn(e.mDatasUrl,a);r.push(o)}return r}})}},t.OnlineData=Rn,t.OnlineQueryDatasParameter=class{constructor(t){t=t||{},this.userNames=null,this.types=null,this.fileName=null,this.serviceStatuses=null,this.serviceId=null,this.ids=null,this.keywords=null,this.orderBy=null,this.tags=null,this.filterFields=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.OnlineQueryDatasParameter"}toJSON(){var t=this,e={types:t.types,fileName:t.fileName,serviceStatuses:t.serviceStatuses,serviceId:t.serviceId,ids:t.ids,keywords:t.keywords,orderBy:t.orderBy,tags:t.tags,filterFields:t.filterFields};for(var r in e)null==e[r]&&delete e[r];return e}},t.ServiceStatus={DOES_NOT_INVOLVE:"DOES_NOT_INVOLVE",PUBLISH_FAILED:"PUBLISH_FAILED",PUBLISHED:"PUBLISHED",PUBLISHING:"PUBLISHING",UNPUBLISHED:"UNPUBLISHED",UNPUBLISHED_FAILED:"UNPUBLISHED_FAILED"},t.DataItemType={GEOJSON:"GEOJSON",UGCV5_MVT:"UGCV5_MVT",JSON:"JSON",AUDIO:"AUDIO",COLOR:"COLOR",COLORSCHEME:"COLORSCHEME",CSV:"CSV",EXCEL:"EXCEL",FILLSYMBOL:"FILLSYMBOL",IMAGE:"IMAGE",LAYERTEMPLATE:"LAYERTEMPLATE",LAYOUTTEMPLATE:"LAYOUTTEMPLATE",LINESYMBOL:"LINESYMBOL",MAPTEMPLATE:"MAPTEMPLATE",MARKERSYMBOL:"MARKERSYMBOL",MBTILES:"MBTILES",PHOTOS:"PHOTOS",SHP:"SHP",SMTILES:"SMTILES",SVTILES:"SVTILES",THEMETEMPLATE:"THEMETEMPLATE",TPK:"TPK",UDB:"UDB",UGCV5:"UGCV5",UNKNOWN:"UNKNOWN",VIDEO:"VIDEO",WORKENVIRONMENT:"WORKENVIRONMENT",WORKSPACE:"WORKSPACE"},t.DataItemOrderBy={FILENAME:"FILENAME",ID:"ID",LASTMODIFIEDTIME:"LASTMODIFIEDTIME",NICKNAME:"NICKNAME",SERVICESTATUS:"SERVICESTATUS",SIZE:"SIZE",STATUS:"STATUS",TYPE:"TYPE",UPDATETIME:"UPDATETIME",USERNAME:"USERNAME"},t.FilterField={LINKPAGE:"LINKPAGE",MAPTITLE:"MAPTITLE",NICKNAME:"NICKNAME",RESTITLE:"RESTITLE",USERNAME:"USERNAME"},t.OnlineServiceBase=Dn,t.Feature=t.Feature||{},t.Feature.Theme=Sa,t.Feature.Theme.Bar=class extends _a{constructor(t,e,r,i,s){super(t,e,r,i,s),this.CLASS_NAME="SuperMap.Feature.Theme.Bar"}destroy(){super.destroy()}assembleShapes(){var t={showShadow:!0,shadowBlur:8,shadowColor:"rgba(100,100,100,0.8)",shadowOffsetX:2,shadowOffsetY:2},e=this.setting;if(e.barLinearGradient||(e.barLinearGradient=[["#00FF00","#00CD00"],["#00CCFF","#5E87A2"],["#00FF66","#669985"],["#CCFF00","#94A25E"],["#FF9900","#A2945E"]]),e.dataViewBoxParameter||(void 0===e.useAxis||e.useAxis?e.dataViewBoxParameter=[45,15,15,15]:e.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var i=this.dataViewBox,s=this.dataValues;if(!(s.length<1)){for(let t=0,e=s.length;t<e;t++)if(s[t]<r[0]||s[t]>r[1])return;var n=this.calculateXShapeInfo();if(n){var a=n.xPositions,o=n.width;(void 0===e.useBackground||e.useBackground)&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,e)),(void 0===e.useAxis||e.useAxis)&&(this.shapes=this.shapes.concat(ba.GraphAxis(this.shapeFactory,i,e,n)));for(var l=0;l<s.length;l++){var h=i[1]-(s[l]-r[0])/this.DVBUnitValue,u=[[a[l]-o/2,i[1]-1],[a[l]+o/2,i[1]-1],[a[l]+o/2,h],[a[l]-o/2,h]],c=new Kn(u);if(void 0===e.showShadow||e.showShadow){if(e.barShadowStyle){var d=e.barShadowStyle;d.shadowBlur&&(t.shadowBlur=d.shadowBlur),d.shadowColor&&(t.shadowColor=d.shadowColor),d.shadowOffsetX&&(t.shadowOffsetX=d.shadowOffsetX),d.shadowOffsetY&&(t.shadowOffsetY=d.shadowOffsetY)}c.style={},rt.copyAttributesWithClip(c.style,t)}c.refDataID=this.data.id,c.dataInfo={field:this.fields[l],value:s[l]},void 0!==e.barHoverAble&&(c.hoverable=e.barHoverAble),void 0!==e.barClickAble&&(c.clickable=e.barClickAble),this.shapes.push(this.shapeFactory.createShape(c))}this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,i=this.dataValues.length;if(i<1)return null;var s=[],n=0,a=this.DVBWidth;if(r.xShapeBlank&&r.xShapeBlank.length&&3==r.xShapeBlank.length){var o=a-((t=r.xShapeBlank)[0]+t[2]+(i-1)*t[1]);if(o<=i)return null;n=o/i}else t=[n=a/(2*i+1),n,n];for(var l=0,h=0;h<i;h++)0==h?l=t[0]+n/2:l+=n+t[1],s.push(e[0]+l);return{xPositions:s,width:n}}resetLinearGradient(){if(this.RelativeCoordinate)for(var t=this.shapes.length,e=this.setting.barLinearGradient,r=-1,i=0;i<t;i++){var s=this.shapes[i];if("SuperMap.LevelRenderer.Shape.SmicPolygon"===s.CLASS_NAME){var n=s.style,a=this.location[0]+n.pointList[0][0],o=this.location[0]+n.pointList[1][0];++r>=e.length&&(r%=e.length);var l=e[r][0],h=e[r][1],u=(new Gn).getLinearGradient(a,0,o,0,[[0,l],[1,h]]);s.style.color=u}}}},t.Feature.Theme.Bar3D=class extends _a{constructor(t,e,r,i,s){super(t,e,r,i,s),this.CLASS_NAME="SuperMap.Feature.Theme.Bar3D"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,25,20,20]:t.dataViewBoxParameter=[5,5,5,5]),t.axisUseArrow=void 0===t.axisUseArrow||t.axisUseArrow,t.axisXLabelsOffset=void 0!==t.axisXLabelsOffset?t.axisXLabelsOffset:[-10,10],this.initBaseParameter()){var e=this.DVBCodomain;this.DVBUnitValue=(e[1]-e[0])/this.DVBHeight;var r=this.dataViewBox,i=this.dataValues;if(!(i.length<1)){for(let t=0,r=i.length;t<r;t++)if(i[t]<e[0]||i[t]>e[1])return;var s=this.calculateXShapeInfo();if(s){var n=s.xPositions,a=s.width;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,t)),(!t.axis3DParameter||isNaN(t.axis3DParameter)||t.axis3DParameter<15)&&(t.axis3DParameter=20),(void 0===t.useAxis||t.useAxis)&&(this.shapes=this.shapes.concat(ba.GraphAxis(this.shapeFactory,r,t,s)));var o=t.bar3DParameter&&!isNaN(t.bar3DParameter)?t.bar3DParameter:10;for(let s=0;s<i.length;s++){var l=r[1]-(i[s]-e[0])/this.DVBUnitValue,h=n[s]-a/2,u=n[s]+a/2,c=[[h,l],[u,l],[u-o,l+o],[h-o,l+o]],d=[[u,l],[u-o,l+o],[u-o,r[1]+o],[u,r[1]]],p=[[h-o,r[1]+o],[u-o,r[1]+o],[u-o,l+o],[h-o,l+o]];o<=0&&(p=[[h,r[1]],[u,r[1]],[u,l],[h,l]]);var f=new Kn(c),m=new Kn(d),y=new Kn(p);t.barSideStyle=t.barSideStyle?t.barSideStyle:t.barFaceStyle,t.barSideStyleByFields=t.barSideStyleByFields?t.barSideStyleByFields:t.barFaceStyleByFields,t.barSideStyleByCodomain=t.barSideStyleByCodomain?t.barSideStyleByCodomain:t.barFaceStyleByCodomain,t.barTopStyle=t.barTopStyle?t.barTopStyle:t.barFaceStyle,t.barTopStyleByFields=t.barTopStyleByFields?t.barTopStyleByFields:t.barFaceStyleByFields,t.barTopStyleByCodomain=t.barTopStyleByCodomain?t.barTopStyleByCodomain:t.barFaceStyleByCodomain,y.style=ba.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barFaceStyle,t.barFaceStyleByFields,t.barFaceStyleByCodomain,s,i[s]),m.style=ba.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barSideStyle,t.barSideStyleByFields,t.barSideStyleByCodomain,s,i[s]),f.style=ba.ShapeStyleTool({stroke:!0,strokeColor:"#ffffff",fillColor:"#ee9900"},t.barTopStyle,t.barTopStyleByFields,t.barTopStyleByCodomain,s,i[s]),t.barSideHoverStyle=t.barSideHoverStyle?t.barSideHoverStyle:t.barFaceHoverStyle,t.barTopHoverStyle=t.barTopHoverStyle?t.barTopHoverStyle:t.barFaceHoverStyle,y.highlightStyle=ba.ShapeStyleTool({stroke:!0},t.barFaceHoverStyle),m.highlightStyle=ba.ShapeStyleTool({stroke:!0},t.barSideHoverStyle),f.highlightStyle=ba.ShapeStyleTool({stroke:!0},t.barTopHoverStyle),f.refDataID=m.refDataID=y.refDataID=this.data.id,f.isHoverByRefDataID=m.isHoverByRefDataID=y.isHoverByRefDataID=!0,f.refDataHoverGroup=m.refDataHoverGroup=y.refDataHoverGroup=rt.createUniqueID("lr_shg"),f.dataInfo=m.dataInfo=y.dataInfo={field:this.fields[s],value:i[s]},void 0!==t.barHoverAble&&(f.hoverable=m.hoverable=y.hoverable=t.barHoverAble),void 0!==t.barClickAble&&(f.clickable=m.clickable=y.clickable=t.barClickAble),this.shapes.push(this.shapeFactory.createShape(m)),this.shapes.push(this.shapeFactory.createShape(f)),this.shapes.push(this.shapeFactory.createShape(y))}this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,i=this.dataValues.length;if(i<1)return null;var s=[],n=0,a=this.DVBWidth;if(r.xShapeBlank&&r.xShapeBlank.length&&3==r.xShapeBlank.length){var o=a-((t=r.xShapeBlank)[0]+t[2]+(i-1)*t[1]);if(o<=i)return null;n=o/i}else t=[n=a/(2*i+1),n,n];for(var l=0,h=0;h<i;h++)0==h?l=t[0]+n/2:l+=n+t[1],s.push(e[0]+l);return{xPositions:s,width:n}}},t.Feature.Theme.Circle=class extends xa{constructor(t,e,r,i,s){super(t,e,r,i,s),this.CLASS_NAME="SuperMap.Feature.Theme.Circle"}destroy(){super.destroy()}assembleShapes(){if(!this.setting)return!1;var t=this.setting;if(!t.codomain)return!1;var e=void 0===t.decimalNumber||isNaN(t.decimalNumber)?-1:t.decimalNumber,r=Sa.getDataValues(this.data,this.fields,e);this.dataValues=r||[];var i=this.dataValues;t.maxR||(t.maxR=100),t.minR||(t.minR=0);var s=this.DVBCodomain;s&&s[1]-s[0]>0?this.DVBUnitValue=t.maxR/(s[1]-s[0]):this.DVBUnitValue=t.maxR;var n=this.DVBUnitValue,a=i[0]*n+t.minR;if(this.width=2*a,this.height=2*a,this.initBaseParameter()&&(!s||!(i[0]<s[0]||i[0]>s[1]))){var o=this.DVBCenterPoint,l=new ia(o[0],o[1],a);l.style=ba.ShapeStyleTool(null,t.circleStyle,null,null,0),void 0!==t.fillColor?l.style.fillColor=t.fillColor:l.style.fillColor="#ff9277",l.highlightStyle=ba.ShapeStyleTool(null,t.circleHoverStyle),void 0!==t.circleHoverAble&&(l.hoverable=t.circleHoverAble),void 0!==t.circleClickAble&&(l.clickable=t.circleClickAble),l.refDataID=this.data.id,l.dataInfo={field:this.fields[0],r:a,value:i[0]},this.shapes.push(this.shapeFactory.createShape(l)),this.shapesConvertToRelativeCoordinate()}}},t.Feature.Theme.Graph=_a,t.Feature.Theme.Line=class extends _a{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n),this.CLASS_NAME="SuperMap.Feature.Theme.Line"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,15,15,15]:t.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var e=this.dataViewBox,r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var i=this.DVBUnitValue,s=this.dataValues;if(!(s.length<1)){var n=this.calculateXShapeInfo();if(n){var a,o,l=n.xPositions;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,t)),this.shapes=this.shapes.concat(ba.GraphAxis(this.shapeFactory,e,t,n));for(var h=[],u=[],c=0,d=s.length;c<d;c++){if(s[c]<r[0]||s[c]>r[1])return null;a=l[c],o=e[1]-(s[c]-r[0])/i;var p=new Qn(a,o);p.style=ba.ShapeStyleTool({fillColor:"#ee9900"},t.pointStyle,t.pointStyleByFields,t.pointStyleByCodomain,c,s[c]),p.highlightStyle=ba.ShapeStyleTool(null,t.pointHoverStyle),void 0!==t.pointHoverAble&&(p.hoverable=t.pointHoverAble),void 0!==t.pointClickAble&&(p.clickable=t.pointClickAble),p.refDataID=this.data.id,p.dataInfo={field:this.fields[c],value:s[c]},u.push(this.shapeFactory.createShape(p));var f=[a,o];h.push(f)}var m=new Zn(h);m.style=ba.ShapeStyleTool({strokeColor:"#ee9900"},t.lineStyle),m.clickable=!1,m.hoverable=!1;var y=this.shapeFactory.createShape(m);this.shapes.push(y),this.shapes=this.shapes.concat(u),this.shapesConvertToRelativeCoordinate()}}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,i=this.dataValues.length;if(i<1)return null;var s=[],n=this.DVBWidth,a=0;if(r.xShapeBlank&&r.xShapeBlank.length&&2==r.xShapeBlank.length){var o=n-((t=r.xShapeBlank)[0]+t[1]);if(o<=i)return null;a=o/(i-1)}else t=[a=n/(i+1),a,a];for(var l=0,h=0;h<i;h++)0==h?l=t[0]:l+=a,s.push(e[0]+l);return{xPositions:s,width:0}}},t.Feature.Theme.Pie=class extends _a{constructor(t,e,r,i,s){super(t,e,r,i,s),this.CLASS_NAME="SuperMap.Feature.Theme.Pie"}destroy(){super.destroy()}assembleShapes(){var t=this.setting,e=[{fillColor:"#ff9277"},{fillColor:"#dddd00"},{fillColor:"#ffc877"},{fillColor:"#bbe3ff"},{fillColor:"#d5ffbb"},{fillColor:"#bbbbff"},{fillColor:"#ddb000"},{fillColor:"#b0dd00"},{fillColor:"#e2bbff"},{fillColor:"#ffbbe3"},{fillColor:"#ff7777"},{fillColor:"#ff9900"},{fillColor:"#83dd00"},{fillColor:"#77e3ff"},{fillColor:"#778fff"},{fillColor:"#c877ff"},{fillColor:"#ff77ab"},{fillColor:"#ff6600"},{fillColor:"#aa8800"},{fillColor:"#77c7ff"},{fillColor:"#ad77ff"},{fillColor:"#ff77ff"},{fillColor:"#dd0083"},{fillColor:"#777700"},{fillColor:"#00aa00"},{fillColor:"#0088aa"},{fillColor:"#8400dd"},{fillColor:"#aa0088"},{fillColor:"#dd0000"},{fillColor:"#772e00"}];if(this.initBaseParameter()){t.useBackground&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,t));var r=this.dataValues;if(!(r.length<1)){var i=this.DVBCodomain;for(let t=0;t<r.length;t++)if(r[t]<i[0]||r[t]>i[1])return;var s=0;for(let t=0;t<r.length;t++)s+=Math.abs(r[t]);this.DVBUnitValue=360/s;for(var n=this.DVBUnitValue,a=this.DVBCenterPoint,o=0,l=0,h=o,u=this.DVBHeight<this.DVBWidth?this.DVBHeight/2:this.DVBWidth/2,c=0;c<r.length;c++){var d=Math.abs(r[c]);(l=0===c?o+d*n:c===d.length-1?h:o+d*n)-o>=360&&(l=359.9999999);var p=new ta(a[0],a[1],u,o,l);if(void 0===t.sectorStyleByFields){var f=c%e.length;p.style=ba.ShapeStyleTool(null,t.sectorStyle,e,null,f)}else p.style=ba.ShapeStyleTool(null,t.sectorStyle,t.sectorStyleByFields,t.sectorStyleByCodomain,c,r[c]);p.highlightStyle=ba.ShapeStyleTool(null,t.sectorHoverStyle),void 0!==t.sectorHoverAble&&(p.hoverable=t.sectorHoverAble),void 0!==t.sectorClickAble&&(p.clickable=t.sectorClickAble),p.refDataID=this.data.id,p.dataInfo={field:this.fields[c],value:r[c]},this.shapes.push(this.shapeFactory.createShape(p)),o=l}this.shapesConvertToRelativeCoordinate()}}}},t.Feature.Theme.Point=class extends _a{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n),this.CLASS_NAME="SuperMap.Feature.Theme.Point"}destroy(){super.destroy()}assembleShapes(){var t=this.setting;if(t.dataViewBoxParameter||(void 0===t.useAxis||t.useAxis?t.dataViewBoxParameter=[45,15,15,15]:t.dataViewBoxParameter=[5,5,5,5]),this.initBaseParameter()){var e=this.dataViewBox,r=this.DVBCodomain;this.DVBUnitValue=(r[1]-r[0])/this.DVBHeight;var i=this.DVBUnitValue,s=this.dataValues,n=this.calculateXShapeInfo();if(n){var a,o,l=n.xPositions;(void 0===t.useBackground||t.useBackground)&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,t)),this.shapes=this.shapes.concat(ba.GraphAxis(this.shapeFactory,e,t,n));for(var h=0,u=s.length;h<u;h++){if(s[h]<r[0]||s[h]>r[1])return null;a=l[h],o=e[1]-(s[h]-r[0])/i;var c=new Qn(a,o);c.style=ba.ShapeStyleTool({fillColor:"#ee9900"},t.pointStyle,t.pointStyleByFields,t.pointStyleByCodomain,h,s[h]),c.highlightStyle=ba.ShapeStyleTool(null,t.pointHoverStyle),void 0!==t.pointHoverAble&&(c.hoverable=t.pointHoverAble),void 0!==t.pointClickAble&&(c.clickable=t.pointClickAble),c.refDataID=this.data.id,c.dataInfo={field:this.fields[h],value:s[h]},this.shapes.push(this.shapeFactory.createShape(c))}this.shapesConvertToRelativeCoordinate()}}}calculateXShapeInfo(){var t,e=this.dataViewBox,r=this.setting,i=this.dataValues.length;if(i<1)return null;var s=[],n=this.DVBWidth,a=0;if(r.xShapeBlank&&r.xShapeBlank.length&&2==r.xShapeBlank.length){var o=n-((t=r.xShapeBlank)[0]+t[1]);if(o<=i)return null;a=o/(i-1)}else t=[a=n/(i+1),a,a];for(var l=0,h=0;h<i;h++)0==h?l=t[0]:l+=a,s.push(e[0]+l);return{xPositions:s,width:0}}},t.Feature.Theme.RankSymbol=xa,t.Feature.Theme.Ring=class extends _a{constructor(t,e,r,i,s){super(t,e,r,i,s),this.CLASS_NAME="SuperMap.Feature.Theme.Ring"}destroy(){super.destroy()}assembleShapes(){if(this.initBaseParameter()){var t=[{fillColor:"#ff9277"},{fillColor:"#dddd00"},{fillColor:"#ffc877"},{fillColor:"#bbe3ff"},{fillColor:"#d5ffbb"},{fillColor:"#bbbbff"},{fillColor:"#ddb000"},{fillColor:"#b0dd00"},{fillColor:"#e2bbff"},{fillColor:"#ffbbe3"},{fillColor:"#ff7777"},{fillColor:"#ff9900"},{fillColor:"#83dd00"},{fillColor:"#77e3ff"},{fillColor:"#778fff"},{fillColor:"#c877ff"},{fillColor:"#ff77ab"},{fillColor:"#ff6600"},{fillColor:"#aa8800"},{fillColor:"#77c7ff"},{fillColor:"#ad77ff"},{fillColor:"#ff77ff"},{fillColor:"#dd0083"},{fillColor:"#777700"},{fillColor:"#00aa00"},{fillColor:"#0088aa"},{fillColor:"#8400dd"},{fillColor:"#aa0088"},{fillColor:"#dd0000"},{fillColor:"#772e00"}],e=this.setting;e.useBackground&&this.shapes.push(ba.Background(this.shapeFactory,this.chartBox,e));var r=this.dataValues;if(!(r.length<1)){var i=this.DVBCodomain;for(let t=0;t<r.length;t++)if(r[t]<i[0]||r[t]>i[1])return;var s=0;for(let t=0;t<r.length;t++)s+=Math.abs(r[t]);this.DVBUnitValue=360/s;for(var n=this.DVBUnitValue,a=this.DVBCenterPoint,o=0,l=0,h=o,u=this.DVBHeight<this.DVBWidth?this.DVBHeight/2:this.DVBWidth/2,c=e.innerRingRadius>=0&&e.innerRingRadius<u,d=void 0!==e.innerRingRadius&&!isNaN(e.innerRingRadius)&&c?e.innerRingRadius:0,p=0;p<r.length;p++){var f=Math.abs(r[p]);l=0===p?o+f*n:p===f.length-1?h:o+f*n;var m=new ta(a[0],a[1],u,o,l,d);if(void 0===e.sectorStyleByFields){var y=p%t.length;m.style=ba.ShapeStyleTool(null,e.sectorStyle,t,null,y)}else m.style=ba.ShapeStyleTool(null,e.sectorStyle,e.sectorStyleByFields,e.sectorStyleByCodomain,p,r[p]);m.highlightStyle=ba.ShapeStyleTool(null,e.sectorHoverStyle),void 0!==e.sectorHoverAble&&(m.hoverable=e.sectorHoverAble),void 0!==e.sectorClickAble&&(m.clickable=e.sectorClickAble),m.refDataID=this.data.id,m.dataInfo={field:this.fields[p],value:r[p]},this.shapes.push(this.shapeFactory.createShape(m)),o=l}this.shapesConvertToRelativeCoordinate()}}}},t.Feature.Theme.ThemeVector=wa,t.Feature.ShapeParameters=Xn,t.Feature.ShapeParameters.Circle=ia,t.Feature.ShapeParameters.Image=ra,t.Feature.ShapeParameters.Label=ea,t.Feature.ShapeParameters.Line=Zn,t.Feature.ShapeParameters.Point=Qn,t.Feature.ShapeParameters.Polygon=Kn,t.Feature.ShapeParameters.Rectangle=$n,t.Feature.ShapeParameters.Sector=ta,t.Feature.ShapeFactory=ba,t.LevelRenderer=Fa,t.KeyServiceParameter=class{constructor(t){this.name=null,this.serviceIds=null,this.clientType=N.SERVER,this.limitation=null,rt.extend(this,t),this.CLASS_NAME="SuperMap.KeyServiceParameter"}toJSON(){return{name:this.name,serviceIds:this.serviceIds,clientType:this.clientType,limitation:this.limitation}}},t.SecurityManager=Vt,t.ServerInfo=class{constructor(t,e){this.type=t,this.server=null,this.tokenServiceUrl=null,this.keyServiceUrl=null,rt.extend(this,e),this.CLASS_NAME="SuperMap.ServerInfo",this.type=this.type||i.ISERVER,this.server||console.error("server url require is not  undefined");var r="/services/security/tokens";this.type===i.ISERVER&&this.server.indexOf("iserver")<0&&(r="/iserver"+r),this.tokenServiceUrl||(this.tokenServiceUrl=rt.urlPathAppend(this.server,r)),this.keyServiceUrl||(this.type===i.IPORTAL?this.keyServiceUrl=rt.urlPathAppend(this.server,"/web/mycontent/keys/register"):this.type===i.ONLINE&&(this.keyServiceUrl=rt.urlPathAppend(this.server,"/web/mycontent/keys")))}},t.TokenServiceParameter=class{constructor(t){this.userName=null,this.password=null,this.clientType=N.NONE,this.ip=null,this.referer=null,this.expiration=60,rt.extend(this,t),this.CLASS_NAME="SuperMap.TokenServiceParameter"}toJSON(){return{userName:this.userName,password:this.password,clientType:this.clientType,ip:this.ip,referer:this.referer,expiration:this.expiration}}},t.ThemeStyle=Yn,t.CartoCSS=Hn,t.ElasticSearch=class{constructor(t,e,r){if(!e||"function"!=typeof e&&"object"!=typeof e||"function"!=typeof e.Client)throw Error("Please enter the global variable of @elastic/elasticsearch@5.6.22 or elasticsearch@16.7.3 for the second parameter!");r=r||{},this.url=t;try{this.client=new e.Client({host:this.url})}catch(t){this.client=new e.Client({node:{url:new URL(this.url)}})}this.change=null,this.openGeoFence=!1,this.outOfGeoFence=null,this.geoFence=null,this.EVENT_TYPES=["change","error","outOfGeoFence"],this.events=new _t(this,null,this.EVENT_TYPES),this.eventListeners=null,rt.extend(this,r),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}setGeoFence(t){this.geoFence=t}bulk(t,e){return this.client.bulk(t,this._handleCallback(e))}clearScroll(t,e){return this.client.clearScroll(t,this._handleCallback(e))}count(t,e){return this.client.count(t,this._handleCallback(e))}create(t,e){return this.client.create(t,this._handleCallback(e))}delete(t,e){return this.client.delete(t,this._handleCallback(e))}deleteByQuery(t,e){return this.client.deleteByQuery(t,this._handleCallback(e))}deleteScript(t,e){return this.client.deleteScript(t,this._handleCallback(e))}deleteTemplate(t,e){return this.client.deleteTemplate(t,this._handleCallback(e))}exists(t,e){return this.client.exists(t,this._handleCallback(e))}existsSource(t,e){return this.client.existsSource(t,this._handleCallback(e))}explain(t,e){return this.client.explain(t,this._handleCallback(e))}fieldCaps(t,e){return this.client.fieldCaps(t,this._handleCallback(e))}get(t,e){return this.client.get(t,this._handleCallback(e))}getScript(t,e){return this.client.getScript(t,this._handleCallback(e))}getSource(t,e){return this.client.getSource(t,this._handleCallback(e))}getTemplate(t,e){return this.client.getTemplate(t,this._handleCallback(e))}index(t,e){return this.client.index(t,this._handleCallback(e))}info(t,e){return this.client.info(t,this._handleCallback(e))}mget(t,e){return this.client.mget(t,this._handleCallback(e))}msearch(t,e){let r=this;return r.client.msearch(t).then(function(t){return t=t.body||t,r._update(t.responses,e),t},function(t){return e(t),r.events.triggerEvent("error",{error:t}),t})}msearchTemplate(t,e){return this.client.msearchTemplate(t,this._handleCallback(e))}mtermvectors(t,e){return this.client.mtermvectors(t,this._handleCallback(e))}ping(t,e){return this.client.ping(t,this._handleCallback(e))}putScript(t,e){return this.client.putScript(t,this._handleCallback(e))}putTemplate(t,e){return this.client.putTemplate(t,this._handleCallback(e))}reindex(t,e){return this.client.reindex(t,this._handleCallback(e))}reindexRessrottle(t,e){return this.client.reindexRessrottle(t,this._handleCallback(e))}renderSearchTemplate(t,e){return this.client.renderSearchTemplate(t,this._handleCallback(e))}scroll(t,e){return this.client.scroll(t,this._handleCallback(e))}search(t,e){let r=this;return r.client.search(t).then(function(t){return t=t.body||t,r._update(t,e),t},function(t){return e&&e(t),r.events.triggerEvent("error",{error:t}),t})}searchShards(t,e){return this.client.searchShards(t,this._handleCallback(e))}searchTemplate(t,e){return this.client.searchTemplate(t,this._handleCallback(e))}suggest(t,e){return this.client.suggest(t,this._handleCallback(e))}termvectors(t,e){return this.client.termvectors(t,this._handleCallback(e))}update(t,e){return this.client.update(t,this._handleCallback(e))}updateByQuery(t,e){return this.client.updateByQuery(t,this._handleCallback(e))}_handleCallback(t){return function(){let e=Array.from(arguments);const r=e.shift();let i=e.shift();const s=i&&i.body;if(s){const{statusCode:t,headers:r}=i;e=[t,r],i=s}t.call(this,r,i,...e)}}_update(t,e){let r=this;t&&(r.data=t,r.openGeoFence&&r.geoFence&&r._validateDatas(t),r.events.triggerEvent("change",{data:r.data}),r.change?r.change&&r.change(t):e&&e(void 0,{responses:t}))}_validateDatas(t){if(t){t instanceof Array||(t=[t]);var e,r=t.length;for(e=0;e<r;e++)this._validateData(t[e])}}_validateData(t){let e=this;t.hits.hits.map(function(r){let i=r._source,s=e._getMeterPerMapUnit(e.geoFence.unit),n=e.geoFence.center[0]*s,a=e.geoFence.center[1]*s,o=i.x*s,l=i.y*s;return e._distance(o,l,n,a)>e.geoFence.radius&&(e.outOfGeoFence&&e.outOfGeoFence(t),e.events.triggerEvent("outOfGeoFence",{data:t})),r})}_distance(t,e,r,i){return Math.sqrt((t-r)*(t-r)+(e-i)*(e-i))}_getMeterPerMapUnit(t){let e;return"meter"===t?e=1:"degree"===t&&(e=2*Math.PI*6378137/360),e}},t.ArrayStatistic=class{static newInstance(){return this.geostatsInstance||(this.geostatsInstance=new window.geostats),this.geostatsInstance}static getInstance(t){let e=this.newInstance();return e.setSerie(t),e}static getArrayStatistic(t,e){return t.length?"Sum"===e||"æ±å"===e?this.getSum(t):"Maximum"===e||"æå¤§å¼"===e?this.getMax(t):"Minimum"===e||"æå°å¼"===e?this.getMin(t):"Average"===e||"å¹³åå¼"===e?this.getMean(t):"Median"===e||"ä¸­ä½æ°"===e?this.getMedian(t):"times"===e||"è®¡æ°"===e?this.getTimes(t):void 0:0}static getArraySegments(t,e,r){return"offset"===e?this.getEqInterval(t,r):"jenks"===e?this.getJenks(t,r):"square"===e?this.getMin(t)>=0&&this.getSqrtInterval(t,r):"logarithm"===e?this.getMin(t)>0&&this.getGeometricProgression(t,r):void 0}static getSum(t){return this.getInstance(t).sum()}static getMax(t){return this.getInstance(t).max()}static getMin(t){return this.getInstance(t).min()}static getMean(t){return this.getInstance(t).mean()}static getMedian(t){return this.getInstance(t).median()}static getTimes(t){return t.length}static getEqInterval(t,e){return this.getInstance(t).getClassEqInterval(e)}static getJenks(t,e){return this.getInstance(t).getClassJenks(e)}static getSqrtInterval(t,e){return t=t.map(function(t){return Math.sqrt(t)}),this.getInstance(t).getClassEqInterval(e).map(function(t){return t*t})}static getGeometricProgression(t,e){return this.getInstance(t).getClassGeometricProgression(e)}},t.ColorsPickerUtil=class{static createCanvas(t,e){var r=document.createElement("canvas");return r.height=t,r.width=e,r.getContext("2d")}static getLinearGradient(t,e,r,i,s){this._ctx||(this._ctx=this.getContext());for(var n=this._ctx.createLinearGradient(t,e,r,i),a=s.length,o=1/(a-1),l=0,h=0;h<a;h++)n.addColorStop(l,s[h]),l+=o;return n.__nonRecursion=!0,n}static getContext(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx}static getStepColors(t,e,r){t=Un.toRGBA(t),e=Un.toRGBA(e),t=Un.getData(t);for(var i=[],s=((e=Un.getData(e))[0]-t[0])/r,n=(e[1]-t[1])/r,a=(e[2]-t[2])/r,o=(e[3]-t[3])/r,l=0,h=t[0],u=t[1],c=t[2],d=t[3];l<r;l++)i[l]=Un.toColor([Un.adjust(Math.floor(h),[0,255]),Un.adjust(Math.floor(u),[0,255]),Un.adjust(Math.floor(c),[0,255]),d.toFixed(4)-0],"hex"),h+=s,u+=n,c+=a,d+=o;return h=e[0],u=e[1],c=e[2],d=e[3],i[l]=Un.toColor([h,u,c,d],"hex"),i}static getGradientColors(t,e,r){var i,s,n,a=[],o=t.length;if(void 0!==e){if(o>=e)if("RANGE"===r)for(s=0;s<e;s++)a.push(t[s]);else for(s=0;s<e;s++){let e=Math.floor(s/2);if(s%2==0)a.push(t[e]);else{let r=t.length-1-e;a.push(t[r])}}else{for(i=Math.ceil(e/(o-1)),s=0,n=o-1;s<n;s++){var l=this.getStepColors(t[s],t[s+1],i);s<n-1&&l.pop(),a=a.concat(l)}for(var h=a.length-e,u=0;u<h;u++)a.splice(2,1)}return a}}},t.DataFormat=e,t.ServerType=i,t.GeometryType=s,t.QueryOption=n,t.JoinType={INNERJOIN:"INNERJOIN",LEFTJOIN:"LEFTJOIN"},t.SpatialQueryMode=a,t.SpatialRelationType={CONTAIN:"CONTAIN",INTERSECT:"INTERSECT",WITHIN:"WITHIN"},t.MeasureMode=o,t.Unit=l,t.BufferRadiusUnit=h,t.EngineType={IMAGEPLUGINS:"IMAGEPLUGINS",OGC:"OGC",ORACLEPLUS:"ORACLEPLUS",SDBPLUS:"SDBPLUS",SQLPLUS:"SQLPLUS",UDB:"UDB"},t.ThemeGraphTextFormat=u,t.ThemeGraphType=c,t.GraphAxesTextDisplayMode=d,t.GraduatedMode=p,t.RangeMode=f,t.ThemeType={DOTDENSITY:"DOTDENSITY",GRADUATEDSYMBOL:"GRADUATEDSYMBOL",GRAPH:"GRAPH",LABEL:"LABEL",RANGE:"RANGE",UNIQUE:"UNIQUE"},t.ColorGradientType=m,t.TextAlignment=y,t.FillGradientMode={NONE:"NONE",LINEAR:"LINEAR",RADIAL:"RADIAL",CONICAL:"CONICAL",SQUARE:"SQUARE"},t.AlongLineDirection=g,t.LabelBackShape=v,t.LabelOverLengthMode=b,t.DirectionType={EAST:"EAST",NONE:"NONE",NORTH:"NORTH",SOURTH:"SOURTH",WEST:"WEST"},t.OverlayOperationType=_,t.OutputType=x,t.SideType={LEFT:"LEFT",MIDDLE:"MIDDLE",NONE:"NONE",RIGHT:"RIGHT"},t.SupplyCenterType={FIXEDCENTER:"FIXEDCENTER",NULL:"NULL",OPTIONALCENTER:"OPTIONALCENTER"},t.TurnType={AHEAD:"AHEAD",BACK:"BACK",END:"END",LEFT:"LEFT",NONE:"NONE",RIGHT:"RIGHT"},t.BufferEndType=S,t.SmoothMethod=w,t.SurfaceAnalystMethod=C,t.DataReturnMode=M,t.EditType=A,t.TransferTactic=T,t.TransferPreference=E,t.GridType={CROSS:"CROSS",GRID:"GRID",POINT:"POINT"},t.ColorSpaceType={CMYK:"CMYK",RGB:"RGB"},t.LayerType={UGC:"UGC",WMS:"WMS",WFS:"WFS",CUSTOM:"CUSTOM"},t.UGCLayerType={THEME:"THEME",VECTOR:"VECTOR",GRID:"GRID",IMAGE:"IMAGE"},t.StatisticMode={AVERAGE:"AVERAGE",MAX:"MAX",MIN:"MIN",STDDEVIATION:"STDDEVIATION",SUM:"SUM",VARIANCE:"VARIANCE"},t.PixelFormat={BIT16:"BIT16",BIT32:"BIT32",BIT64:"BIT64",SINGLE:"SINGLE",DOUBLE:"DOUBLE",UBIT1:"UBIT1",UBIT4:"UBIT4",UBIT8:"UBIT8",UBIT24:"UBIT24",UBIT32:"UBIT32"},t.SearchMode={KDTREE_FIXED_COUNT:"KDTREE_FIXED_COUNT",KDTREE_FIXED_RADIUS:"KDTREE_FIXED_RADIUS",NONE:"NONE",QUADTREE:"QUADTREE"},t.InterpolationAlgorithmType={KRIGING:"KRIGING",SimpleKriging:"SimpleKriging",UniversalKriging:"UniversalKriging"},t.VariogramMode=O,t.Exponent=P,t.ClientType=N,t.ChartType={BAR:"Bar",BAR3D:"Bar3D",CIRCLE:"Circle",PIE:"Pie",POINT:"Point",LINE:"Line",RING:"Ring"},t.ClipAnalystMode=I,t.AnalystAreaUnit=F,t.AnalystSizeUnit=k,t.StatisticAnalystMode=D,t.SummaryType=R,t.TopologyValidatorRule=B,t.BucketAggType=G,t.MetricsAggType=U,t.GetFeatureMode={BOUNDS:"BOUNDS",BUFFER:"BUFFER",ID:"ID",SPATIAL:"SPATIAL",SQL:"SQL"},t.RasterFunctionType=j,t.ResourceType={MAP:"MAP",SERVICE:"SERVICE",SCENE:"SCENE",DATA:"DATA",INSIGHTS_WORKSPACE:"INSIGHTS_WORKSPACE",MAP_DASHBOARD:"MAP_DASHBOARD"},t.OrderBy={UPDATETIME:"UPDATETIME",HEATLEVEL:"HEATLEVEL",RELEVANCE:"RELEVANCE"},t.OrderType={ASC:"ASC",DESC:"DESC"},t.SearchType={PUBLIC:"PUBLIC",MY_RES:"MY_RES",MYGROUP_RES:"MYGROUP_RES",MYDEPARTMENT_RES:"MYDEPARTMENT_RES",SHARETOME_RES:"SHARETOME_RES"},t.AggregationTypes={TAG:"TAG",TYPE:"TYPE"},t.PermissionType={SEARCH:"SEARCH",READ:"READ",READWRITE:"READWRITE",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD"},t.EntityType={DEPARTMENT:"DEPARTMENT",GROUP:"GROUP",IPORTALGROUP:"IPORTALGROUP",ROLE:"ROLE",USER:"USER"},t.WebExportFormatType={PNG:"PNG",PDF:"PDF"},t.WebScaleOrientationType={HORIZONTALLABELSBELOW:"HORIZONTALLABELSBELOW",HORIZONTALLABELSABOVE:"HORIZONTALLABELSABOVE",VERTICALLABELSLEFT:"VERTICALLABELSLEFT",VERTICALLABELSRIGHT:"VERTICALLABELSRIGHT"},t.WebScaleType={LINE:"LINE",BAR:"BAR",BAR_SUB:"BAR_SUB"},t.WebScaleUnit={METER:"METER",FOOT:"FOOT",DEGREES:"DEGREES"},t.KnowledgeGraph=_o,t.BoundsType=z,t.CellSizeType=V;const xo=L;var wo=r.n(xo);var Co=1,Mo=2,Ao=3,To=4,Eo=5,Oo=6378137,Lo=6356752.314,Po=.0066943799901413165,No=484813681109536e-20,Io=Math.PI/2,Fo=.16666666666666666,ko=.04722222222222222,Do=.022156084656084655,Ro=1e-10,Bo=.017453292519943295,Go=57.29577951308232,Uo=Math.PI/4,jo=2*Math.PI,zo=3.14159265359,Vo={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const Jo={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var qo=/[\s_\-\/\(\)]/g;function Ho(t,e){if(t[e])return t[e];for(var r,i=Object.keys(t),s=e.toLowerCase().replace(qo,""),n=-1;++n<i.length;)if((r=i[n]).toLowerCase().replace(qo,"")===s)return t[r]}function Wo(t){var e,r,i,s={},n=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t},{}),a={proj:"projName",datum:"datumCode",rf:function(t){s.rf=parseFloat(t)},lat_0:function(t){s.lat0=t*Bo},lat_1:function(t){s.lat1=t*Bo},lat_2:function(t){s.lat2=t*Bo},lat_ts:function(t){s.lat_ts=t*Bo},lon_0:function(t){s.long0=t*Bo},lon_1:function(t){s.long1=t*Bo},lon_2:function(t){s.long2=t*Bo},alpha:function(t){s.alpha=parseFloat(t)*Bo},gamma:function(t){s.rectified_grid_angle=parseFloat(t)},lonc:function(t){s.longc=t*Bo},x_0:function(t){s.x0=parseFloat(t)},y_0:function(t){s.y0=parseFloat(t)},k_0:function(t){s.k0=parseFloat(t)},k:function(t){s.k0=parseFloat(t)},a:function(t){s.a=parseFloat(t)},b:function(t){s.b=parseFloat(t)},r_a:function(){s.R_A=!0},zone:function(t){s.zone=parseInt(t,10)},south:function(){s.utmSouth=!0},towgs84:function(t){s.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){s.to_meter=parseFloat(t)},units:function(t){s.units=t;var e=Ho(Jo,t);e&&(s.to_meter=e.to_meter)},from_greenwich:function(t){s.from_greenwich=t*Bo},pm:function(t){var e=Ho(Vo,t);s.from_greenwich=(e||parseFloat(t))*Bo},nadgrids:function(t){"@null"===t?s.datumCode="none":s.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(s.axis=t)},approx:function(){s.approx=!0}};for(e in n)r=n[e],e in a?"function"==typeof(i=a[e])?i(r):s[i]=r:s[e]=r;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s}const Yo=function(t){return new el(t).output()};var Xo=1,Qo=/\s/,Zo=/[A-Za-z]/,Ko=/[A-Za-z84_]/,$o=/[,\]]/,tl=/[\d\.E\-\+]/;function el(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Xo}function rl(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var i=e?{}:t,s=r.reduce(function(t,e){return il(e,t),t},i);e&&(t[e]=s)}function il(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void il(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var i;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&il(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&il(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void rl(e,r,t);default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return il(t,e[r]);return rl(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}el.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Qo.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Xo:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},el.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if($o.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},el.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Xo)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Xo,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},el.prototype.number=function(t){if(!tl.test(t)){if($o.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},el.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},el.prototype.keyword=function(t){if(Ko.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Xo)}if(!$o.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},el.prototype.neutral=function(t){if(Zo.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(tl.test(t))return this.word=t,void(this.state=3);if(!$o.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},el.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var sl=.017453292519943295;function nl(t){return t*sl}function al(t){var e=Yo(t),r=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",r]);var s={};return il(e,s),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",r=0,i=t.AXIS.length;r<i;++r){var s=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];-1!==s[0].indexOf("north")||("y"===s[0]||"lat"===s[0])&&"north"===s[1]?e+="n":-1!==s[0].indexOf("south")||("y"===s[0]||"lat"===s[0])&&"south"===s[1]?e+="s":-1!==s[0].indexOf("east")||("x"===s[0]||"lon"===s[0])&&"east"===s[1]?e+="e":-1===s[0].indexOf("west")&&("x"!==s[0]&&"lon"!==s[0]||"west"!==s[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var n=t.GEOGCS;function a(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(n=t),n&&(n.DATUM?t.datumCode=n.DATUM.name.toLowerCase():t.datumCode=n.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(t.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=n.DATUM.SPHEROID.a,t.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(t.datum_params=n.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",nl],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",nl],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",nl],["lat0","latitude_of_origin",nl],["lat0","standard_parallel_1",nl],["lat1","standard_parallel_1",nl],["lat2","standard_parallel_2",nl],["azimuth","Azimuth"],["alpha","azimuth",nl],["srsCode","name"]].forEach(function(e){return r=t,s=(i=e)[0],n=i[1],void(!(s in r)&&n in r&&(r[s]=r[n],3===i.length&&(r[s]=i[2](r[s]))));var r,i,s,n}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName?!t.lat_ts&&t.lat0&&"Polar_Stereographic"===t.projName&&(t.lat_ts=t.lat0,t.lat0=nl(t.lat0>0?90:-90)):(t.lat0=nl(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(s),s}function ol(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?ol[t]=Wo(arguments[1]):ol[t]=al(arguments[1]):ol[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?ol.apply(e,t):ol(t)});if("string"==typeof t){if(t in ol)return ol[t]}else"EPSG"in t?ol["EPSG:"+t.EPSG]=t:"ESRI"in t?ol["ESRI:"+t.ESRI]=t:"IAU2000"in t?ol["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(ol);const ll=ol;var hl=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var ul=["3857","900913","3785","102113"];const cl=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in ll}(t))return ll[t];if(function(t){return hl.some(function(e){return t.indexOf(e)>-1})}(t)){var e=al(t);if(function(t){var e=Ho(t,"authority");if(e){var r=Ho(e,"epsg");return r&&ul.indexOf(r)>-1}}(e))return ll["EPSG:3857"];var r=function(t){var e=Ho(t,"extension");if(e)return Ho(e,"proj4")}(e);return r?Wo(r):e}return function(t){return"+"===t[0]}(t)?Wo(t):void 0};function dl(t,e){var r,i;if(t=t||{},!e)return t;for(i in e)void 0!==(r=e[i])&&(t[i]=r);return t}function pl(t,e,r){var i=t*e;return r/Math.sqrt(1-i*i)}function fl(t){return t<0?-1:1}function ml(t){return Math.abs(t)<=zo?t:t-fl(t)*jo}function yl(t,e,r){var i=t*r,s=.5*t;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(Io-e))/i}function gl(t,e){for(var r,i,s=.5*t,n=Io-2*Math.atan(e),a=0;a<=15;a++)if(r=t*Math.sin(n),n+=i=Io-2*Math.atan(e*Math.pow((1-r)/(1+r),s))-n,Math.abs(i)<=1e-10)return n;return-9999}function vl(t){return t}var bl=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=pl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,i=t.x,s=t.y;if(s*Go>90&&s*Go<-90&&i*Go>180&&i*Go<-180)return null;if(Math.abs(Math.abs(s)-Io)<=Ro)return null;if(this.sphere)e=this.x0+this.a*this.k0*ml(i-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Uo+.5*s));else{var n=Math.sin(s),a=yl(this.e,s,n);e=this.x0+this.a*this.k0*ml(i-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,i=t.x-this.x0,s=t.y-this.y0;if(this.sphere)r=Io-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var n=Math.exp(-s/(this.a*this.k0));if(-9999===(r=gl(this.e,n)))return null}return e=ml(this.long0+i/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:vl,inverse:vl,names:["longlat","identity"]}],Sl={},_l=[];function xl(t,e){var r=_l.length;return t.names?(_l[r]=t,t.names.forEach(function(t){Sl[t.toLowerCase()]=r}),this):(console.log(e),!0)}const wl={start:function(){bl.forEach(xl)},add:xl,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==Sl[e]&&_l[Sl[e]]?_l[Sl[e]]:void 0}};var Cl={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Ml=Cl.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Cl.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Al={};Al.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Al.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Al.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Al.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Al.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Al.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Al.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Al.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Al.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Al.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Al.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Al.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Al.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Al.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Al.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Al.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Al.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};const Tl=function(t,e,r,i,s,n,a){var o={};return o.datum_type=void 0===t||"none"===t?Eo:To,e&&(o.datum_params=e.map(parseFloat),0===o.datum_params[0]&&0===o.datum_params[1]&&0===o.datum_params[2]||(o.datum_type=Co),o.datum_params.length>3&&(0===o.datum_params[3]&&0===o.datum_params[4]&&0===o.datum_params[5]&&0===o.datum_params[6]||(o.datum_type=Mo,o.datum_params[3]*=No,o.datum_params[4]*=No,o.datum_params[5]*=No,o.datum_params[6]=o.datum_params[6]/1e6+1))),a&&(o.datum_type=Ao,o.grids=a),o.a=r,o.b=i,o.es=s,o.ep2=n,o};var El={};function Ol(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:El[t]||null,isNull:!1}}function Ll(t){return t/3600*Math.PI/180}function Pl(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function Nl(t){return t.map(function(t){return[Ll(t.longitudeShift),Ll(t.latitudeShift)]})}function Il(t,e,r){return{name:Pl(t,e+8,e+16).trim(),parent:Pl(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function Fl(t,e,r,i){for(var s=e+176,n=[],a=0;a<r.gridNodeCount;a++){var o={latitudeShift:t.getFloat32(s+16*a,i),longitudeShift:t.getFloat32(s+16*a+4,i),latitudeAccuracy:t.getFloat32(s+16*a+8,i),longitudeAccuracy:t.getFloat32(s+16*a+12,i)};n.push(o)}return n}function kl(t,e){if(!(this instanceof kl))return new kl(t);e=e||function(t){if(t)throw t};var r=cl(t);if("object"==typeof r){var i=kl.projections.get(r.projName);if(i){if(r.datumCode&&"none"!==r.datumCode){var s=Ho(Al,r.datumCode);s&&(r.datum_params=r.datum_params||(s.towgs84?s.towgs84.split(","):null),r.ellps=s.ellipse,r.datumName=s.datumName?s.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var n,a,o,l,h,u,c,d=function(t,e,r,i,s){if(!t){var n=Ho(Cl,i);n||(n=Ml),t=n.a,e=n.b,r=n.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<Ro)&&(s=!0,e=t),{a:t,b:e,rf:r,sphere:s}}(r.a,r.b,r.rf,r.ellps,r.sphere),p=(n=d.a,a=d.b,d.rf,o=r.R_A,u=((l=n*n)-(h=a*a))/l,c=0,o?(l=(n*=1-u*(Fo+u*(ko+u*Do)))*n,u=0):c=Math.sqrt(u),{es:u,e:c,ep2:(l-h)/h}),f=function(t){return void 0===t?null:t.split(",").map(Ol)}(r.nadgrids),m=r.datum||Tl(r.datumCode,r.datum_params,d.a,d.b,p.es,p.ep2,f);dl(this,r),dl(this,i),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=p.es,this.e=p.e,this.ep2=p.ep2,this.datum=m,this.init(),e(null,this)}else e(t)}else e(t)}kl.projections=wl,kl.projections.start();const Dl=kl;function Rl(t,e,r){var i,s,n,a,o=t.x,l=t.y,h=t.z?t.z:0;if(l<-Io&&l>-1.001*Io)l=-Io;else if(l>Io&&l<1.001*Io)l=Io;else{if(l<-Io)return{x:-1/0,y:-1/0,z:t.z};if(l>Io)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),s=Math.sin(l),a=Math.cos(l),n=s*s,{x:((i=r/Math.sqrt(1-e*n))+h)*a*Math.cos(o),y:(i+h)*a*Math.sin(o),z:(i*(1-e)+h)*s}}function Bl(t,e,r,i){var s,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b=t.x,S=t.y,_=t.z?t.z:0;if(s=Math.sqrt(b*b+S*S),n=Math.sqrt(b*b+S*S+_*_),s/r<1e-12){if(g=0,n/r<1e-12)return Io,v=-i,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(S,b);a=_/n,c=(o=s/n)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),d=a*l,y=0;do{y++,h=e*(u=r/Math.sqrt(1-e*d*d))/(u+(v=s*c+_*d-u*(1-e*d*d))),m=(f=a*(l=1/Math.sqrt(1-h*(2-h)*o*o)))*c-(p=o*(1-h)*l)*d,c=p,d=f}while(m*m>1e-24&&y<30);return{x:g,y:Math.atan(f/Math.abs(p)),z:v}}function Gl(t){return t===Co||t===Mo}function Ul(t,e,r){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===Co?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==Mo||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return r;if(t.datum_type===Eo||e.datum_type===Eo)return r;var i=t.a,s=t.es;if(t.datum_type===Ao){if(0!==jl(t,!1,r))return;i=Oo,s=Po}var n=e.a,a=e.b,o=e.es;if(e.datum_type===Ao&&(n=Oo,a=Lo,o=Po),s===o&&i===n&&!Gl(t.datum_type)&&!Gl(e.datum_type))return r;if((r=Rl(r,s,i),Gl(t.datum_type)&&(r=function(t,e,r){if(e===Co)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===Mo){var i=r[0],s=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6];return{x:h*(t.x-l*t.y+o*t.z)+i,y:h*(l*t.x+t.y-a*t.z)+s,z:h*(-o*t.x+a*t.y+t.z)+n}}}(r,t.datum_type,t.datum_params)),Gl(e.datum_type)&&(r=function(t,e,r){if(e===Co)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===Mo){var i=r[0],s=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6],u=(t.x-i)/h,c=(t.y-s)/h,d=(t.z-n)/h;return{x:u+l*c-o*d,y:-l*u+c+a*d,z:o*u-a*c+d}}}(r,e.datum_type,e.datum_params)),r=Bl(r,o,n,a),e.datum_type===Ao)&&0!==jl(e,!0,r))return;return r}function jl(t,e,r){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var i={x:-r.x,y:r.y},s={x:Number.NaN,y:Number.NaN},n=[],a=0;a<t.grids.length;a++){var o=t.grids[a];if(n.push(o.name),o.isNull){s=i;break}if(o.mandatory,null!==o.grid){var l=o.grid.subgrids[0],h=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,u=l.ll[0]-h,c=l.ll[1]-h,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+h,p=l.ll[1]+(l.lim[1]-1)*l.del[1]+h;if(!(c>i.y||u>i.x||p<i.y||d<i.x||(s=zl(i,e,l),isNaN(s.x))))break}else if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Go+" "+i.y*Go+" tried: '"+n+"'"),-1):(r.x=-s.x,r.y=s.y,0)}function zl(t,e,r){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var s={x:t.x,y:t.y};s.x-=r.ll[0],s.y-=r.ll[1],s.x=ml(s.x-Math.PI)+Math.PI;var n=Vl(s,r);if(e){if(isNaN(n.x))return i;n.x=s.x-n.x,n.y=s.y-n.y;var a,o,l=9;do{if(o=Vl(n,r),isNaN(o.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:s.x-(o.x+n.x),y:s.y-(o.y+n.y)},n.x+=a.x,n.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=ml(n.x+r.ll[0]),i.y=n.y+r.ll[1]}else isNaN(n.x)||(i.x=t.x+n.x,i.y=t.y+n.y);return i}function Vl(t,e){var r,i={x:t.x/e.del[0],y:t.y/e.del[1]},s=Math.floor(i.x),n=Math.floor(i.y),a=i.x-1*s,o=i.y-1*n,l={x:Number.NaN,y:Number.NaN};if(s<0||s>=e.lim[0])return l;if(n<0||n>=e.lim[1])return l;r=n*e.lim[0]+s;var h=e.cvs[r][0],u=e.cvs[r][1];r++;var c=e.cvs[r][0],d=e.cvs[r][1];r+=e.lim[0];var p=e.cvs[r][0],f=e.cvs[r][1];r--;var m=e.cvs[r][0],y=e.cvs[r][1],g=a*o,v=a*(1-o),b=(1-a)*(1-o),S=(1-a)*o;return l.x=b*h+v*c+S*m+g*p,l.y=b*u+v*d+S*y+g*f,l}function Jl(t,e,r){var i,s,n,a=r.x,o=r.y,l=r.z||0,h={};for(n=0;n<3;n++)if(!e||2!==n||void 0!==r.z)switch(0===n?(i=a,s=-1!=="ew".indexOf(t.axis[n])?"x":"y"):1===n?(i=o,s=-1!=="ns".indexOf(t.axis[n])?"y":"x"):(i=l,s="z"),t.axis[n]){case"e":h[s]=i;break;case"w":h[s]=-i;break;case"n":h[s]=i;break;case"s":h[s]=-i;break;case"u":void 0!==r[s]&&(h.z=i);break;case"d":void 0!==r[s]&&(h.z=-i);break;default:return null}return h}function ql(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function Hl(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Wl(t,e,r,i){var s,n=void 0!==(r=Array.isArray(r)?ql(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(t){Hl(t.x),Hl(t.y)}(r),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===Co||t.datum.datum_type===Mo||t.datum.datum_type===Ao)&&"WGS84"!==e.datumCode||(e.datum.datum_type===Co||e.datum.datum_type===Mo||e.datum.datum_type===Ao)&&"WGS84"!==t.datumCode}(t,e)&&(r=Wl(t,s=new Dl("WGS84"),r,i),t=s),i&&"enu"!==t.axis&&(r=Jl(t,!1,r)),"longlat"===t.projName)r={x:r.x*Bo,y:r.y*Bo,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=Ul(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*Go,y:r.y*Go,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),i&&"enu"!==e.axis?Jl(e,!0,r):(n||delete r.z,r)}var Yl=Dl("WGS84");function Xl(t,e,r,i){var s,n,a;return Array.isArray(r)?(s=Wl(t,e,r,i)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof s.z?[s.x,s.y,s.z].concat(r.splice(3)):[s.x,s.y,r[2]].concat(r.splice(3)):[s.x,s.y].concat(r.splice(2)):[s.x,s.y]):(n=Wl(t,e,r,i),2===(a=Object.keys(r)).length?n:(a.forEach(function(i){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===i||"y"===i||"z"===i)return}else if("x"===i||"y"===i)return;n[i]=r[i]}),n))}function Ql(t){return t instanceof Dl?t:t.oProj?t.oProj:Dl(t)}const Zl=function(t,e,r){t=Ql(t);var i,s=!1;return void 0===e?(e=t,t=Yl,s=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=Yl,s=!0),e=Ql(e),r?Xl(t,e,r):(i={forward:function(r,i){return Xl(t,e,r,i)},inverse:function(r,i){return Xl(e,t,r,i)}},s&&(i.oProj=e),i)};var Kl=6,$l="AJSAJS",th="AFAFAF",eh=65,rh=73,ih=79,sh=86,nh=90;const ah={forward:oh,inverse:function(t){var e=ch(ph(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:lh};function oh(t,e){return e=e||5,function(t,e){var r="00000"+t.easting,i="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(p=t.easting,f=t.northing,m=t.zoneNumber,y=dh(m),g=Math.floor(p/1e5),v=Math.floor(f/1e5)%20,s=g,n=v,a=y,o=a-1,l=$l.charCodeAt(o),h=th.charCodeAt(o),u=l+s-1,c=h+n,d=!1,u>nh&&(u=u-nh+eh-1,d=!0),(u===rh||l<rh&&u>rh||(u>rh||l<rh)&&d)&&u++,(u===ih||l<ih&&u>ih||(u>ih||l<ih)&&d)&&++u===rh&&u++,u>nh&&(u=u-nh+eh-1),c>sh?(c=c-sh+eh-1,d=!0):d=!1,(c===rh||h<rh&&c>rh||(c>rh||h<rh)&&d)&&c++,(c===ih||h<ih&&c>ih||(c>ih||h<ih)&&d)&&++c===rh&&c++,c>sh&&(c=c-sh+eh-1),String.fromCharCode(u)+String.fromCharCode(c))+r.substr(r.length-5,e)+i.substr(i.length-5,e);var s,n,a,o,l,h,u,c,d;var p,f,m,y,g,v}(function(t){var e,r,i,s,n,a,o,l=t.lat,h=t.lon,u=6378137,c=hh(l),d=hh(h);o=Math.floor((h+180)/6)+1,180===h&&(o=60);l>=56&&l<64&&h>=3&&h<12&&(o=32);l>=72&&l<84&&(h>=0&&h<9?o=31:h>=9&&h<21?o=33:h>=21&&h<33?o=35:h>=33&&h<42&&(o=37));a=hh(6*(o-1)-180+3),.006739496752268451,e=u/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),r=Math.tan(c)*Math.tan(c),i=.006739496752268451*Math.cos(c)*Math.cos(c),s=Math.cos(c)*(d-a),n=u*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c));var p=.9996*e*(s+(1-r+i)*s*s*s/6+(5-18*r+r*r+72*i-.39089081163157013)*s*s*s*s*s/120)+5e5,f=.9996*(n+e*Math.tan(c)*(s*s/2+(5-r+9*i+4*i*i)*s*s*s*s/24+(61-58*r+r*r+600*i-2.2240339282485886)*s*s*s*s*s*s/720));l<0&&(f+=1e7);return{northing:Math.round(f),easting:Math.round(p),zoneNumber:o,zoneLetter:function(t){var e="Z";84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C");return e}(l)}}({lat:t[1],lon:t[0]}),e)}function lh(t){var e=ch(ph(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function hh(t){return t*(Math.PI/180)}function uh(t){return t/Math.PI*180}function ch(t){var e=t.northing,r=t.easting,i=t.zoneLetter,s=t.zoneNumber;if(s<0||s>60)return null;var n,a,o,l,h,u,c,d,p=6378137,f=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=r-5e5,y=e;i<"N"&&(y-=1e7),u=6*(s-1)-180+3,d=(c=y/.9996/6367449.145945056)+(3*f/2-27*f*f*f/32)*Math.sin(2*c)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*c)+151*f*f*f/96*Math.sin(6*c),n=p/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),o=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*p/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),h=m/(.9996*n);var g=d-n*Math.tan(d)/l*(h*h/2-(5+3*a+10*o-4*o*o-.06065547077041606)*h*h*h*h/24+(61+90*a+298*o+45*a*a-1.6983531815716497-3*o*o)*h*h*h*h*h*h/720);g=uh(g);var v,b=(h-(1+2*a+o)*h*h*h/6+(5-2*o+28*a-3*o*o+.05391597401814761+24*a*a)*h*h*h*h*h/120)/Math.cos(d);if(b=u+uh(b),t.accuracy){var S=ch({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});v={top:S.lat,right:S.lon,bottom:g,left:b}}else v={lat:g,lon:b};return v}function dh(t){var e=t%Kl;return 0===e&&(e=Kl),e}function ph(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,i=null,s="",n=0;!/[A-Z]/.test(e=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;s+=e,n++}var a=parseInt(s,10);if(0===n||n+3>r)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(n++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;i=t.substring(n,n+=2);for(var l=dh(a),h=function(t,e){var r=$l.charCodeAt(e-1),i=1e5,s=!1;for(;r!==t.charCodeAt(0);){if(++r===rh&&r++,r===ih&&r++,r>nh){if(s)throw"Bad character: "+t;r=eh,s=!0}i+=1e5}return i}(i.charAt(0),l),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var r=th.charCodeAt(e-1),i=0,s=!1;for(;r!==t.charCodeAt(0);){if(++r===rh&&r++,r===ih&&r++,r>sh){if(s)throw"Bad character: "+t;r=eh,s=!0}i+=1e5}return i}(i.charAt(1),l);u<fh(o);)u+=2e6;var c=r-n;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,p,f,m=c/2,y=0,g=0;return m>0&&(d=1e5/Math.pow(10,m),p=t.substring(n,n+m),y=parseFloat(p)*d,f=t.substring(n+m),g=parseFloat(f)*d),{easting:y+h,northing:g+u,zoneLetter:o,zoneNumber:a,accuracy:d}}function fh(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function mh(t,e,r){if(!(this instanceof mh))return new mh(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}mh.fromMGRS=function(t){return new mh(lh(t))},mh.prototype.toMGRS=function(t){return oh([this.x,this.y],t)};const yh=mh;var gh=1,vh=.25,bh=.046875,Sh=.01953125,_h=.01068115234375,xh=.75,wh=.46875,Ch=.013020833333333334,Mh=.007120768229166667,Ah=.3645833333333333,Th=.005696614583333333,Eh=.3076171875;function Oh(t){var e=[];e[0]=gh-t*(vh+t*(bh+t*(Sh+t*_h))),e[1]=t*(xh-t*(bh+t*(Sh+t*_h)));var r=t*t;return e[2]=r*(wh-t*(Ch+t*Mh)),r*=t,e[3]=r*(Ah-t*Th),e[4]=r*t*Eh,e}function Lh(t,e,r,i){return r*=e,e*=e,i[0]*t-r*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var Ph=20;function Nh(t,e,r){for(var i=1/(1-e),s=t,n=Ph;n;--n){var a=Math.sin(s),o=1-e*a*a;if(s-=o=(Lh(s,a,Math.cos(s),r)-t)*(o*Math.sqrt(o))*i,Math.abs(o)<Ro)return s}return s}const Ih={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Oh(this.es),this.ml0=Lh(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,i,s=t.x,n=t.y,a=ml(s-this.long0),o=Math.sin(n),l=Math.cos(n);if(this.es){var h=l*a,u=Math.pow(h,2),c=this.ep2*Math.pow(l,2),d=Math.pow(c,2),p=Math.abs(l)>Ro?Math.tan(n):0,f=Math.pow(p,2),m=Math.pow(f,2);e=1-this.es*Math.pow(o,2),h/=Math.sqrt(e);var y=Lh(n,o,l,this.en);r=this.a*(this.k0*h*(1+u/6*(1-f+c+u/20*(5-18*f+m+14*c-58*f*c+u/42*(61+179*m-m*f-479*f)))))+this.x0,i=this.a*(this.k0*(y-this.ml0+o*a*h/2*(1+u/12*(5-f+9*c+4*d+u/30*(61+m-58*f+270*c-330*f*c+u/56*(1385+543*m-m*f-3111*f))))))+this.y0}else{var g=l*Math.sin(a);if(Math.abs(Math.abs(g)-1)<Ro)return 93;if(r=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,i=l*Math.cos(a)/Math.sqrt(1-Math.pow(g,2)),(g=Math.abs(i))>=1){if(g-1>Ro)return 93;i=0}else i=Math.acos(i);n<0&&(i=-i),i=this.a*this.k0*(i-this.lat0)+this.y0}return t.x=r,t.y=i,t},inverse:function(t){var e,r,i,s,n=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(r=Nh(e=this.ml0+a/this.k0,this.es,this.en),Math.abs(r)<Io){var o=Math.sin(r),l=Math.cos(r),h=Math.abs(l)>Ro?Math.tan(r):0,u=this.ep2*Math.pow(l,2),c=Math.pow(u,2),d=Math.pow(h,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2);var f=n*Math.sqrt(e)/this.k0,m=Math.pow(f,2);i=r-(e*=h)*m/(1-this.es)*.5*(1-m/12*(5+3*d-9*u*d+u-4*c-m/30*(61+90*d-252*u*d+45*p+46*u-m/56*(1385+3633*d+4095*p+1574*p*d)))),s=ml(this.long0+f*(1-m/6*(1+2*d+u-m/20*(5+28*d+24*p+8*u*d+6*u-m/42*(61+662*d+1320*p+720*p*d))))/l)}else i=Io*fl(a),s=0;else{var y=Math.exp(n/this.k0),g=.5*(y-1/y),v=this.lat0+a/this.k0,b=Math.cos(v);e=Math.sqrt((1-Math.pow(b,2))/(1+Math.pow(g,2))),i=Math.asin(e),a<0&&(i=-i),s=0===g&&0===b?0:ml(Math.atan2(g,b)+this.long0)}return t.x=s,t.y=i,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Fh(t){var e=Math.exp(t);return e=(e-1/e)/2}function kh(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),i=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(i,2))}function Dh(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(kh(1,e)+1))),t<0?-e:e}function Rh(t,e){for(var r,i=2*Math.cos(2*e),s=t.length-1,n=t[s],a=0;--s>=0;)r=i*n-a+t[s],a=n,n=r;return e+r*Math.sin(2*e)}function Bh(t,e,r){for(var i,s,n=Math.sin(e),a=Math.cos(e),o=Fh(r),l=function(t){var e=Math.exp(t);return e=(e+1/e)/2}(r),h=2*a*l,u=-2*n*o,c=t.length-1,d=t[c],p=0,f=0,m=0;--c>=0;)i=f,s=p,d=h*(f=d)-i-u*(p=m)+t[c],m=u*f-s+h*p;return[(h=n*l)*d-(u=a*o)*m,h*m+u*d]}const Gh={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ih.init.apply(this),this.forward=Ih.forward,this.inverse=Ih.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var i=Rh(this.cbg,this.lat0);this.Zb=-this.Qn*(i+function(t,e){for(var r,i=2*Math.cos(e),s=t.length-1,n=t[s],a=0;--s>=0;)r=i*n-a+t[s],a=n,n=r;return Math.sin(e)*r}(this.gtu,2*i))},forward:function(t){var e=ml(t.x-this.long0),r=t.y;r=Rh(this.cbg,r);var i=Math.sin(r),s=Math.cos(r),n=Math.sin(e),a=Math.cos(e);r=Math.atan2(i,a*s),e=Math.atan2(n*s,kh(i,s*a)),e=Dh(Math.tan(e));var o,l,h=Bh(this.gtu,2*r,2*e);return r+=h[0],e+=h[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(o=1/0,l=1/0),t.x=o,t.y=l,t},inverse:function(t){var e,r,i=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,i/=this.Qn,Math.abs(i)<=2.623395162778){var n=Bh(this.utg,2*s,2*i);s+=n[0],i+=n[1],i=Math.atan(Fh(i));var a=Math.sin(s),o=Math.cos(s),l=Math.sin(i),h=Math.cos(i);s=Math.atan2(a*h,kh(l,h*o)),e=ml((i=Math.atan2(l,h*o))+this.long0),r=Rh(this.cgb,s)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};const Uh={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(ml(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Bo,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Gh.init.apply(this),this.forward=Gh.forward,this.inverse=Gh.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function jh(t,e){return Math.pow((1-t)/(1+t),e)}var zh=20;const Vh={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Uo)/(Math.pow(Math.tan(.5*this.lat0+Uo),this.C)*jh(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+Uo),this.C)*jh(this.e*Math.sin(r),this.ratexp))-Io,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,i=Math.pow(Math.tan(.5*r+Uo)/this.K,1/this.C),s=zh;s>0&&(r=2*Math.atan(i*jh(this.e*Math.sin(t.y),-.5*this.e))-Io,!(Math.abs(r-t.y)<1e-14));--s)t.y=r;return s?(t.x=e,t.y=r,t):null},names:["gauss"]};const Jh={init:function(){Vh.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,i,s;return t.x=ml(t.x-this.long0),Vh.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),i=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*i),t.x=s*r*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*r*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,i,s,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(n,this.R2);e=Math.sin(a),r=Math.cos(a),s=Math.asin(r*this.sinc0+t.y*e*this.cosc0/n),i=Math.atan2(t.x*e,n*this.cosc0*r-t.y*this.sinc0*e)}else s=this.phic0,i=0;return t.x=i,t.y=s,Vh.inverse.apply(this,[t]),t.x=ml(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};const qh={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ro&&(this.k0=.5*(1+fl(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Ro&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ro&&(this.k0=.5*this.cons*pl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/yl(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=pl(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Io,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,i,s,n,a,o=t.x,l=t.y,h=Math.sin(l),u=Math.cos(l),c=ml(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=Ro&&Math.abs(l+this.lat0)<=Ro?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*h+this.coslat0*u*Math.cos(c)),t.x=this.a*e*u*Math.sin(c)+this.x0,t.y=this.a*e*(this.coslat0*h-this.sinlat0*u*Math.cos(c))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,h,this.e))-Io,s=Math.cos(r),i=Math.sin(r),Math.abs(this.coslat0)<=Ro?(n=yl(this.e,l*this.con,this.con*h),a=2*this.a*this.k0*n/this.cons,t.x=this.x0+a*Math.sin(o-this.long0),t.y=this.y0-this.con*a*Math.cos(o-this.long0),t):(Math.abs(this.sinlat0)<Ro?(e=2*this.a*this.k0/(1+s*Math.cos(c)),t.y=e*i):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*i+this.cosX0*s*Math.cos(c))),t.y=e*(this.cosX0*i-this.sinX0*s*Math.cos(c))+this.y0),t.x=e*s*Math.sin(c)+this.x0,t))},inverse:function(t){var e,r,i,s,n;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=Ro?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),e=Math.abs(this.coslat0)<Ro?this.lat0>0?ml(this.long0+Math.atan2(t.x,-1*t.y)):ml(this.long0+Math.atan2(t.x,t.y)):ml(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=Ro){if(a<=Ro)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,i=a*this.cons/(2*this.a*this.k0),r=this.con*gl(this.e,i),e=this.con*ml(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=Ro?n=this.X0:(n=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/a),e=ml(this.long0+Math.atan2(t.x*Math.sin(s),a*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),r=-1*gl(this.e,Math.tan(.5*(Io+n)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(Io+t))*Math.pow((1-e)/(1+e),.5*r)}};const Hh={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,i=1/this.rf,s=2*i-Math.pow(i,2),n=this.e=Math.sqrt(s);this.R=this.k0*r*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+n*e)/(1-n*e));this.K=a-this.alpha*o+this.alpha*n/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+r)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(n))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,i=e/this.R,s=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+a/this.alpha,l=0,h=n,u=-1e3,c=0;Math.abs(h-u)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),u=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=o,t.y=h,t},names:["somerc"]};var Wh=1e-7;const Yh={init:function(){var t,e,r,i,s,n,a,o,l,h,u,c,d,p=0,f=0,m=0,y=0,g=0,v=0,b=0;this.no_off=(d="object"==typeof(c=this).PROJECTION?Object.keys(c.PROJECTION)[0]:c.PROJECTION,"no_uoff"in c||"no_off"in c||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)),this.no_rot="no_rot"in this;var S=!1;"alpha"in this&&(S=!0);var _=!1;if("rectified_grid_angle"in this&&(_=!0),S&&(b=this.alpha),_&&(p=this.rectified_grid_angle*Bo),S||_)f=this.longc;else if(m=this.long1,g=this.lat1,y=this.long2,v=this.lat2,Math.abs(g-v)<=Wh||(t=Math.abs(g))<=Wh||Math.abs(t-Io)<=Wh||Math.abs(Math.abs(this.lat0)-Io)<=Wh||Math.abs(Math.abs(v)-Io)<=Wh)throw new Error;var x=1-this.es;e=Math.sqrt(x),Math.abs(this.lat0)>Ro?(o=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*o*o,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/x),this.A=this.B*this.k0*e/t,(s=(i=this.B*e/(r*Math.sqrt(t)))*i-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(yl(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=s=1),S||_?(S?(u=Math.asin(Math.sin(b)/i),_||(p=b)):(u=p,b=Math.asin(i*Math.sin(u))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(n=Math.pow(yl(this.e,g,Math.sin(g)),this.B),a=Math.pow(yl(this.e,v,Math.sin(v)),this.B),s=this.E/n,l=(a-n)/(a+n),h=((h=this.E*this.E)-a*n)/(h+a*n),(t=m-y)<-Math.pi?y-=jo:t>Math.pi&&(y+=jo),this.lam0=ml(.5*(m+y)-Math.atan(h*Math.tan(.5*this.B*(m-y))/l)/this.B),u=Math.atan(2*Math.sin(this.B*ml(m-this.lam0))/(s-1/s)),p=b=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(b))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Uo-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Uo+s))},forward:function(t){var e,r,i,s,n,a,o,l,h={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Io)>Ro){if(e=.5*((n=this.E/Math.pow(yl(this.e,t.y,Math.sin(t.y)),this.B))-(a=1/n)),r=.5*(n+a),s=Math.sin(this.B*t.x),i=(e*this.singam-s*this.cosgam)/r,Math.abs(Math.abs(i)-1)<Ro)throw new Error;l=.5*this.ArB*Math.log((1-i)/(1+i)),a=Math.cos(this.B*t.x),o=Math.abs(a)<Wh?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+s*this.singam,a)}else l=t.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*t.y;return this.no_rot?(h.x=o,h.y=l):(o-=this.u_0,h.x=l*this.cosrot+o*this.sinrot,h.y=o*this.cosrot-l*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(t){var e,r,i,s,n,a,o,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),s=.5*((i=Math.exp(-this.BrA*r))-1/i),n=.5*(i+1/i),o=((a=Math.sin(this.BrA*e))*this.cosgam+s*this.singam)/n,Math.abs(Math.abs(o)-1)<Ro)l.x=0,l.y=o<0?-Io:Io;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=gl(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};const Xh={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Ro)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),i=pl(this.e,e,r),s=yl(this.e,this.lat1,e),n=Math.sin(this.lat2),a=Math.cos(this.lat2),o=pl(this.e,n,a),l=yl(this.e,this.lat2,n),h=yl(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Ro?this.ns=Math.log(i/o)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=Ro&&(r=fl(r)*(Io-2*Ro));var i,s,n=Math.abs(Math.abs(r)-Io);if(n>Ro)i=yl(this.e,r,Math.sin(r)),s=this.a*this.f0*Math.pow(i,this.ns);else{if((n=r*this.ns)<=0)return null;s=0}var a=this.ns*ml(e-this.long0);return t.x=this.k0*(s*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,t},inverse:function(t){var e,r,i,s,n,a=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),r=1):(e=-Math.sqrt(a*a+o*o),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*a,r*o)),0!==e||this.ns>0){if(r=1/this.ns,i=Math.pow(e/(this.a*this.f0),r),-9999===(s=gl(this.e,i)))return null}else s=-Io;return n=ml(l/this.ns+this.long0),t.x=n,t.y=s,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};const Qh={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,i,s,n,a,o,l=t.x,h=t.y,u=ml(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-u*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(s)),a=this.n*n,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),t.y=o*Math.cos(a)/1,t.x=o*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,i,s,n,a,o,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x)/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),r=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),t.x=this.long0-r/this.alfa,a=e,o=0;var h=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(o=1),a=t.y,h+=1}while(0===o&&h<15);return h>=15?null:t},names:["Krovak","krovak"]};function Zh(t,e,r,i,s){return t*s-e*Math.sin(2*s)+r*Math.sin(4*s)-i*Math.sin(6*s)}function Kh(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function $h(t){return.375*t*(1+.25*t*(1+.46875*t))}function tu(t){return.05859375*t*t*(1+.75*t)}function eu(t){return t*t*t*(35/3072)}function ru(t,e,r){var i=e*r;return t/Math.sqrt(1-i*i)}function iu(t){return Math.abs(t)<Io?t:t-fl(t)*Math.PI}function su(t,e,r,i,s){var n,a;n=t/e;for(var o=0;o<15;o++)if(n+=a=(t-(e*n-r*Math.sin(2*n)+i*Math.sin(4*n)-s*Math.sin(6*n)))/(e-2*r*Math.cos(2*n)+4*i*Math.cos(4*n)-6*s*Math.cos(6*n)),Math.abs(a)<=1e-10)return n;return NaN}const nu={init:function(){this.sphere||(this.e0=Kh(this.es),this.e1=$h(this.es),this.e2=tu(this.es),this.e3=eu(this.es),this.ml0=this.a*Zh(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,i=t.x,s=t.y;if(i=ml(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(i)),r=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var n=Math.sin(s),a=Math.cos(s),o=ru(this.a,this.e,n),l=Math.tan(s)*Math.tan(s),h=i*Math.cos(s),u=h*h,c=this.es*a*a/(1-this.es);e=o*h*(1-u*l*(1/6-(8-l+8*c)*u/120)),r=this.a*Zh(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*n/a*u*(.5+(5-l+6*c)*u/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,i=t.x/this.a,s=t.y/this.a;if(this.sphere){var n=s+this.lat0;e=Math.asin(Math.sin(n)*Math.cos(i)),r=Math.atan2(Math.tan(i),Math.cos(n))}else{var a=su(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-Io)<=Ro)return t.x=this.long0,t.y=Io,s<0&&(t.y*=-1),t;var o=ru(this.a,this.e,Math.sin(a)),l=o*o*o/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(a),2),u=i*this.a/o,c=u*u;e=a-o*Math.tan(a)/l*u*u*(.5-(1+3*h)*u*u/24),r=u*(1-c*(h/3+(1+3*h)*h*c/15))/Math.cos(a)}return t.x=ml(r+this.long0),t.y=iu(e),t},names:["Cassini","Cassini_Soldner","cass"]};function au(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var ou=.3333333333333333,lu=.17222222222222222,hu=.10257936507936508,uu=.06388888888888888,cu=.0664021164021164,du=.016415012942191543;const pu={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-Io)<Ro?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Ro?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=au(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=t*ou,e=t*t,r[0]+=e*lu,r[1]=e*uu,e*=t,r[0]+=e*hu,r[1]+=e*cu,r[2]=e*du,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=au(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,i,s,n,a,o,l,h,u,c=t.x,d=t.y;if(c=ml(c-this.long0),this.sphere){if(n=Math.sin(d),u=Math.cos(d),i=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+u*i:1+this.sinph0*n+this.cosph0*u*i)<=Ro)return null;e=(r=Math.sqrt(2/r))*u*Math.sin(c),r*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*u*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<Ro)return null;r=Uo-.5*d,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(c),r*=i}}else{switch(o=0,l=0,h=0,i=Math.cos(c),s=Math.sin(c),n=Math.sin(d),a=au(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=Io+d,a=this.qp-a;break;case this.S_POLE:h=d-Io,a=this.qp+a}if(Math.abs(h)<Ro)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),r=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*o-this.sinb1*l*i):(h=Math.sqrt(2/(1+l*i)))*o*this.ymf,e=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(h=Math.sqrt(a))*s,r=i*(this.mode===this.S_POLE?h:-h)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,i,s,n,a,o,l,h,u,c=t.x/this.a,d=t.y/this.a;if(this.sphere){var p,f=0,m=0;if((r=.5*(p=Math.sqrt(c*c+d*d)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),f=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(p)<=Ro?0:Math.asin(d*m/p),c*=m,d=f*p;break;case this.OBLIQ:r=Math.abs(p)<=Ro?this.lat0:Math.asin(f*this.sinph0+d*m*this.cosph0/p),c*=m*this.cosph0,d=(f-Math.sin(r)*this.sinph0)*p;break;case this.N_POLE:d=-d,r=Io-r;break;case this.S_POLE:r-=Io}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,d):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,d*=this.dd,(a=Math.sqrt(c*c+d*d))<Ro)return t.x=this.long0,t.y=this.lat0,t;s=2*Math.asin(.5*a/this.rq),i=Math.cos(s),c*=s=Math.sin(s),this.mode===this.OBLIQ?(o=i*this.sinb1+d*s*this.cosb1/a,n=this.qp*o,d=a*this.cosb1*i-d*this.sinb1*s):(o=d*s/a,n=this.qp*o,d=a*i)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(n=c*c+d*d))return t.x=this.long0,t.y=this.lat0,t;o=1-n/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(c,d),l=Math.asin(o),h=this.apa,u=l+l,r=l+h[0]*Math.sin(u)+h[1]*Math.sin(u+u)+h[2]*Math.sin(u+u+u)}return t.x=ml(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function fu(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const mu={init:function(){Math.abs(this.lat1+this.lat2)<Ro||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=pl(this.e3,this.sin_po,this.cos_po),this.qs1=au(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=pl(this.e3,this.sin_po,this.cos_po),this.qs2=au(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=au(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Ro?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var i=au(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,n=this.ns0*ml(e-this.long0),a=s*Math.sin(n)+this.x0,o=this.rh-s*Math.cos(n)+this.y0;return t.x=a,t.y=o,t},inverse:function(t){var e,r,i,s,n,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),s=0,0!==e&&(s=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(r=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,r)),n=ml(s/this.ns0+this.long0),t.x=n,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,i,s,n,a,o=fu(.5*e);if(t<Ro)return o;for(var l=t*t,h=1;h<=25;h++)if(r=Math.sin(o),i=Math.cos(o),o+=a=.5*(n=1-(s=t*r)*s)*n/i*(e/(1-l)-r/n+.5/t*Math.log((1-s)/(1+s))),Math.abs(a)<=1e-7)return o;return null}};const yu={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,i,s,n,a,o,l=t.x,h=t.y;return i=ml(l-this.long0),e=Math.sin(h),r=Math.cos(h),s=Math.cos(i),(n=this.sin_p14*e+this.cos_p14*r*s)>0||Math.abs(n)<=Ro?(a=this.x0+1*this.a*r*Math.sin(i)/n,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*s)/n):(a=this.x0+this.infinity_dist*r*Math.sin(i),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*s)),t.x=a,t.y=o,t},inverse:function(t){var e,r,i,s,n,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),r=Math.sin(s),a=fu((i=Math.cos(s))*this.sin_p14+t.y*r*this.cos_p14/e),n=Math.atan2(t.x*r,e*this.cos_p14*i-t.y*this.sin_p14*r),n=ml(this.long0+n)):(a=this.phic0,n=0),t.x=n,t.y=a,t},names:["gnom"]};const gu={init:function(){this.sphere||(this.k0=pl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,i=t.x,s=t.y,n=ml(i-this.long0);if(this.sphere)e=this.x0+this.a*n*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var a=au(this.e,Math.sin(s));e=this.x0+this.a*this.k0*n,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=ml(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*Io:Io;for(var i,s,n,a,o=Math.asin(.5*e),l=0;l<30;l++)if(s=Math.sin(o),n=Math.cos(o),a=t*s,o+=i=Math.pow(1-a*a,2)/(2*n)*(e/(1-t*t)-s/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(i)<=1e-10)return o;return NaN}(this.e,2*t.y*this.k0/this.a),e=ml(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]};const vu={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,i=ml(e-this.long0),s=iu(r-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*s,t},inverse:function(t){var e=t.x,r=t.y;return t.x=ml(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=iu(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var bu=20;const Su={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Kh(this.es),this.e1=$h(this.es),this.e2=tu(this.es),this.e3=eu(this.es),this.ml0=this.a*Zh(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,i,s=t.x,n=t.y,a=ml(s-this.long0);if(i=a*Math.sin(n),this.sphere)Math.abs(n)<=Ro?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(i)/Math.tan(n),r=this.a*(iu(n-this.lat0)+(1-Math.cos(i))/Math.tan(n)));else if(Math.abs(n)<=Ro)e=this.a*a,r=-1*this.ml0;else{var o=ru(this.a,this.e,Math.sin(n))/Math.tan(n);e=o*Math.sin(i),r=this.a*Zh(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+o*(1-Math.cos(i))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,i,s,n,a,o,l,h;if(i=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Ro)e=ml(i/this.a+this.long0),r=0;else{var u;for(a=this.lat0+s/this.a,o=i*i/this.a/this.a+a*a,l=a,n=bu;n;--n)if(l+=h=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+o)*u)/((l-a)/u-1),Math.abs(h)<=Ro){r=l;break}e=ml(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(s+this.ml0)<=Ro)r=0,e=ml(this.long0+i/this.a);else{var c,d,p,f,m;for(a=(this.ml0+s)/this.a,o=i*i/this.a/this.a+a*a,l=a,n=bu;n;--n)if(m=this.e*Math.sin(l),c=Math.sqrt(1-m*m)*Math.tan(l),d=this.a*Zh(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=h=(a*(c*(f=d/this.a)+1)-f-.5*c*(f*f+o))/(this.es*Math.sin(2*l)*(f*f+o-2*a*f)/(4*c)+(a-f)*(c*p-2/Math.sin(2*l))-p),Math.abs(h)<=Ro){r=l;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=ml(this.long0+Math.asin(i*c/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]};const _u={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,i=t.y-this.lat0,s=r-this.long0,n=i/No*1e-5,a=s,o=1,l=0;for(e=1;e<=10;e++)o*=n,l+=this.A[e]*o;var h,u=l,c=a,d=1,p=0,f=0,m=0;for(e=1;e<=6;e++)h=p*u+d*c,d=d*u-p*c,p=h,f=f+this.B_re[e]*d-this.B_im[e]*p,m=m+this.B_im[e]*d+this.B_re[e]*p;return t.x=m*this.a+this.x0,t.y=f*this.a+this.y0,t},inverse:function(t){var e,r,i=t.x,s=t.y,n=i-this.x0,a=(s-this.y0)/this.a,o=n/this.a,l=1,h=0,u=0,c=0;for(e=1;e<=6;e++)r=h*a+l*o,l=l*a-h*o,h=r,u=u+this.C_re[e]*l-this.C_im[e]*h,c=c+this.C_im[e]*l+this.C_re[e]*h;for(var d=0;d<this.iterations;d++){var p,f=u,m=c,y=a,g=o;for(e=2;e<=6;e++)p=m*u+f*c,f=f*u-m*c,m=p,y+=(e-1)*(this.B_re[e]*f-this.B_im[e]*m),g+=(e-1)*(this.B_im[e]*f+this.B_re[e]*m);f=1,m=0;var v=this.B_re[1],b=this.B_im[1];for(e=2;e<=6;e++)p=m*u+f*c,f=f*u-m*c,m=p,v+=e*(this.B_re[e]*f-this.B_im[e]*m),b+=e*(this.B_im[e]*f+this.B_re[e]*m);var S=v*v+b*b;u=(y*v+g*b)/S,c=(g*v-y*b)/S}var _=u,x=c,w=1,C=0;for(e=1;e<=9;e++)w*=_,C+=this.D[e]*w;var M=this.lat0+C*No*1e5,A=this.long0+x;return t.x=A,t.y=M,t},names:["New_Zealand_Map_Grid","nzmg"]};const xu={init:function(){},forward:function(t){var e=t.x,r=t.y,i=ml(e-this.long0),s=this.x0+this.a*i,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=s,t.y=n,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=ml(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]};var wu=20;const Cu={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Oh(this.es)},forward:function(t){var e,r,i=t.x,s=t.y;if(i=ml(i-this.long0),this.sphere){if(this.m)for(var n=this.n*Math.sin(s),a=wu;a;--a){var o=(this.m*s+Math.sin(s)-n)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<Ro)break}else s=1!==this.n?Math.asin(this.n*Math.sin(s)):s;e=this.a*this.C_x*i*(this.m+Math.cos(s)),r=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);r=this.a*Lh(s,l,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,i;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=fu((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=fu(Math.sin(e)/this.n)),r=ml(r+this.long0),e=iu(e)):(e=Nh(t.y/this.a,this.es,this.en),(i=Math.abs(e))<Io?(i=Math.sin(e),r=ml(this.long0+t.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(e)))):i-Ro<Io&&(r=this.long0)),t.x=r,t.y=e,t},names:["Sinusoidal","sinu"]};const Mu={init:function(){},forward:function(t){for(var e=t.x,r=t.y,i=ml(e-this.long0),s=r,n=Math.PI*Math.sin(r);;){var a=-(s+Math.sin(s)-n)/(1+Math.cos(s));if(s+=a,Math.abs(a)<Ro)break}s/=2,Math.PI/2-Math.abs(r)<Ro&&(i=0);var o=.900316316158*this.a*i*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=o,t.y=l,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var i=ml(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var s=Math.asin(r);return t.x=i,t.y=s,t},names:["Mollweide","moll"]};const Au={init:function(){Math.abs(this.lat1+this.lat2)<Ro||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Kh(this.es),this.e1=$h(this.es),this.e2=tu(this.es),this.e3=eu(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=pl(this.e,this.sinphi,this.cosphi),this.ml1=Zh(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Ro?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=pl(this.e,this.sinphi,this.cosphi),this.ml2=Zh(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Zh(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,i=t.y;if(this.sphere)e=this.a*(this.g-i);else{var s=Zh(this.e0,this.e1,this.e2,this.e3,i);e=this.a*(this.g-s)}var n=this.ns*ml(r-this.long0),a=this.x0+e*Math.sin(n),o=this.y0+this.rh-e*Math.cos(n);return t.x=a,t.y=o,t},inverse:function(t){var e,r,i,s;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;return 0!==r&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere?(s=ml(this.long0+n/this.ns),i=iu(this.g-r/this.a),t.x=s,t.y=i,t):(i=su(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),s=ml(this.long0+n/this.ns),t.x=s,t.y=i,t)},names:["Equidistant_Conic","eqdc"]};const Tu={init:function(){this.R=this.a},forward:function(t){var e,r,i=t.x,s=t.y,n=ml(i-this.long0);Math.abs(s)<=Ro&&(e=this.x0+this.R*n,r=this.y0);var a=fu(2*Math.abs(s/Math.PI));(Math.abs(n)<=Ro||Math.abs(Math.abs(s)-Io)<=Ro)&&(e=this.x0,r=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/n-n/Math.PI),l=o*o,h=Math.sin(a),u=Math.cos(a),c=u/(h+u-1),d=c*c,p=c*(2/h-1),f=p*p,m=Math.PI*this.R*(o*(c-f)+Math.sqrt(l*(c-f)*(c-f)-(f+l)*(d-f)))/(f+l);n<0&&(m=-m),e=this.x0+m;var y=l+c;return m=Math.PI*this.R*(p*y-o*Math.sqrt((f+l)*(l+1)-y*y))/(f+l),r=s>=0?this.y0+m:this.y0-m,t.x=e,t.y=r,t},inverse:function(t){var e,r,i,s,n,a,o,l,h,u,c,d;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,n=(i=t.x/c)*i+(s=t.y/c)*s,c=3*(s*s/(l=-2*(a=-Math.abs(s)*(1+n))+1+2*s*s+n*n)+(2*(o=a-2*s*s+i*i)*o*o/l/l/l-9*a*o/l/l)/27)/(h=(a-o*o/3/l)/l)/(u=2*Math.sqrt(-h/3)),Math.abs(c)>1&&(c=c>=0?1:-1),d=Math.acos(c)/3,r=t.y>=0?(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:-(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(i)<Ro?this.long0:ml(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(i*i-s*s)+n*n))/2/i),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};const Eu={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,i,s,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_,x,w=t.x,C=t.y,M=Math.sin(t.y),A=Math.cos(t.y),T=ml(w-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Ro?(t.x=this.x0+this.a*(Io-C)*Math.sin(T),t.y=this.y0-this.a*(Io-C)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=Ro?(t.x=this.x0+this.a*(Io+C)*Math.sin(T),t.y=this.y0+this.a*(Io+C)*Math.cos(T),t):(v=this.sin_p12*M+this.cos_p12*A*Math.cos(T),g=(y=Math.acos(v))?y/Math.sin(y):1,t.x=this.x0+this.a*g*A*Math.sin(T),t.y=this.y0+this.a*g*(this.cos_p12*M-this.sin_p12*A*Math.cos(T)),t):(e=Kh(this.es),r=$h(this.es),i=tu(this.es),s=eu(this.es),Math.abs(this.sin_p12-1)<=Ro?(n=this.a*Zh(e,r,i,s,Io),a=this.a*Zh(e,r,i,s,C),t.x=this.x0+(n-a)*Math.sin(T),t.y=this.y0-(n-a)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=Ro?(n=this.a*Zh(e,r,i,s,Io),a=this.a*Zh(e,r,i,s,C),t.x=this.x0+(n+a)*Math.sin(T),t.y=this.y0+(n+a)*Math.cos(T),t):(o=M/A,l=ru(this.a,this.e,this.sin_p12),h=ru(this.a,this.e,M),u=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(h*A)),b=0===(c=Math.atan2(Math.sin(T),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(T)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(c)-Math.PI)<=Ro?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(T)*Math.cos(u)/Math.sin(c)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),y=l*b*(1-(S=b*b)*(m=(p=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es))*p)*(1-m)/6+(_=S*b)/8*(f=d*p)*(1-2*m)+(x=_*b)/120*(m*(4-7*m)-3*d*d*(1-7*m))-x*b/48*f),t.x=this.x0+y*Math.sin(c),t.y=this.y0+y*Math.cos(c),t))},inverse:function(t){var e,r,i,s,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_,x,w;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Io*this.a)return;return r=e/this.a,i=Math.sin(r),s=Math.cos(r),n=this.long0,Math.abs(e)<=Ro?a=this.lat0:(a=fu(s*this.sin_p12+t.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-Io,n=Math.abs(o)<=Ro?this.lat0>=0?ml(this.long0+Math.atan2(t.x,-t.y)):ml(this.long0-Math.atan2(-t.x,t.y)):ml(this.long0+Math.atan2(t.x*i,e*this.cos_p12*s-t.y*this.sin_p12*i))),t.x=n,t.y=a,t}return l=Kh(this.es),h=$h(this.es),u=tu(this.es),c=eu(this.es),Math.abs(this.sin_p12-1)<=Ro?(a=su(((d=this.a*Zh(l,h,u,c,Io))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,l,h,u,c),n=ml(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=a,t):Math.abs(this.sin_p12+1)<=Ro?(d=this.a*Zh(l,h,u,c,Io),a=su(((e=Math.sqrt(t.x*t.x+t.y*t.y))-d)/this.a,l,h,u,c),n=ml(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),p=ru(this.a,this.e,this.sin_p12),y=Math.cos(m),v=-(g=this.e*this.cos_p12*y)*g/(1-this.es),b=3*this.es*(1-v)*this.sin_p12*this.cos_p12*y/(1-this.es),x=1-v*(_=(S=e/p)-v*(1+v)*Math.pow(S,3)/6-b*(1+3*v)*Math.pow(S,4)/24)*_/2-S*_*_*_/6,f=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*y),n=ml(this.long0+Math.asin(Math.sin(m)*Math.sin(_)/Math.cos(f))),w=Math.sin(f),a=Math.atan2((w-this.es*x*this.sin_p12)*Math.tan(f),w*(1-this.es)),t.x=n,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]};const Ou={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,i,s,n,a,o,l=t.x,h=t.y;return i=ml(l-this.long0),e=Math.sin(h),r=Math.cos(h),s=Math.cos(i),((n=this.sin_p14*e+this.cos_p14*r*s)>0||Math.abs(n)<=Ro)&&(a=1*this.a*r*Math.sin(i),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*s)),t.x=a,t.y=o,t},inverse:function(t){var e,r,i,s,n,a,o;return t.x-=this.x0,t.y-=this.y0,r=fu((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),i=Math.sin(r),s=Math.cos(r),a=this.long0,Math.abs(e)<=Ro?(o=this.lat0,t.x=a,t.y=o,t):(o=fu(s*this.sin_p14+t.y*i*this.cos_p14/e),n=Math.abs(this.lat0)-Io,Math.abs(n)<=Ro?(a=this.lat0>=0?ml(this.long0+Math.atan2(t.x,-t.y)):ml(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=o,t):(a=ml(this.long0+Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i)),t.x=a,t.y=o,t))},names:["ortho"]};var Lu={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Pu={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Nu(t,e,r,i){var s;return t<Ro?(i.value=Pu.AREA_0,s=0):(s=Math.atan2(e,r),Math.abs(s)<=Uo?i.value=Pu.AREA_0:s>Uo&&s<=Io+Uo?(i.value=Pu.AREA_1,s-=Io):s>Io+Uo||s<=-(Io+Uo)?(i.value=Pu.AREA_2,s=s>=0?s-zo:s+zo):(i.value=Pu.AREA_3,s+=Io)),s}function Iu(t,e){var r=t+e;return r<-zo?r+=jo:r>+zo&&(r-=jo),r}const Fu={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Io-Uo/2?this.face=Lu.TOP:this.lat0<=-(Io-Uo/2)?this.face=Lu.BOTTOM:Math.abs(this.long0)<=Uo?this.face=Lu.FRONT:Math.abs(this.long0)<=Io+Uo?this.face=this.long0>0?Lu.RIGHT:Lu.LEFT:this.face=Lu.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,i,s,n,a,o={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,this.face===Lu.TOP)s=Io-e,r>=Uo&&r<=Io+Uo?(l.value=Pu.AREA_0,i=r-Io):r>Io+Uo||r<=-(Io+Uo)?(l.value=Pu.AREA_1,i=r>0?r-zo:r+zo):r>-(Io+Uo)&&r<=-Uo?(l.value=Pu.AREA_2,i=r+Io):(l.value=Pu.AREA_3,i=r);else if(this.face===Lu.BOTTOM)s=Io+e,r>=Uo&&r<=Io+Uo?(l.value=Pu.AREA_0,i=-r+Io):r<Uo&&r>=-Uo?(l.value=Pu.AREA_1,i=-r):r<-Uo&&r>=-(Io+Uo)?(l.value=Pu.AREA_2,i=-r-Io):(l.value=Pu.AREA_3,i=r>0?-r+zo:-r-zo);else{var h,u,c,d,p,f;this.face===Lu.RIGHT?r=Iu(r,+Io):this.face===Lu.BACK?r=Iu(r,+zo):this.face===Lu.LEFT&&(r=Iu(r,-Io)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(r),h=p*Math.cos(r),u=p*f,c=d,this.face===Lu.FRONT?i=Nu(s=Math.acos(h),c,u,l):this.face===Lu.RIGHT?i=Nu(s=Math.acos(u),c,-h,l):this.face===Lu.BACK?i=Nu(s=Math.acos(-h),c,-u,l):this.face===Lu.LEFT?i=Nu(s=Math.acos(-u),c,h,l):(s=i=0,l.value=Pu.AREA_0)}return a=Math.atan(12/zo*(i+Math.acos(Math.sin(i)*Math.cos(Uo))-Io)),n=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(i))))),l.value===Pu.AREA_1?a+=Io:l.value===Pu.AREA_2?a+=zo:l.value===Pu.AREA_3&&(a+=1.5*zo),o.x=n*Math.cos(a),o.y=n*Math.sin(a),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,r,i,s,n,a,o,l,h,u,c,d,p={lam:0,phi:0},f={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?f.value=Pu.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(f.value=Pu.AREA_1,e-=Io):t.x<0&&-t.x>=Math.abs(t.y)?(f.value=Pu.AREA_2,e=e<0?e+zo:e-zo):(f.value=Pu.AREA_3,e+=Io),h=zo/12*Math.tan(e),n=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(n),(o=1-(i=Math.cos(e))*i*(s=Math.tan(r))*s*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?o=-1:o>1&&(o=1),this.face===Lu.TOP)l=Math.acos(o),p.phi=Io-l,f.value===Pu.AREA_0?p.lam=a+Io:f.value===Pu.AREA_1?p.lam=a<0?a+zo:a-zo:f.value===Pu.AREA_2?p.lam=a-Io:p.lam=a;else if(this.face===Lu.BOTTOM)l=Math.acos(o),p.phi=l-Io,f.value===Pu.AREA_0?p.lam=-a+Io:f.value===Pu.AREA_1?p.lam=-a:f.value===Pu.AREA_2?p.lam=-a-Io:p.lam=a<0?-a-zo:-a+zo;else{var m,y,g;h=(m=o)*m,y=(h+=(g=h>=1?0:Math.sqrt(1-h)*Math.sin(a))*g)>=1?0:Math.sqrt(1-h),f.value===Pu.AREA_1?(h=y,y=-g,g=h):f.value===Pu.AREA_2?(y=-y,g=-g):f.value===Pu.AREA_3&&(h=y,y=g,g=-h),this.face===Lu.RIGHT?(h=m,m=-y,y=h):this.face===Lu.BACK?(m=-m,y=-y):this.face===Lu.LEFT&&(h=m,m=y,y=-h),p.phi=Math.acos(-g)-Io,p.lam=Math.atan2(y,m),this.face===Lu.RIGHT?p.lam=Iu(p.lam,-Io):this.face===Lu.BACK?p.lam=Iu(p.lam,-zo):this.face===Lu.LEFT&&(p.lam=Iu(p.lam,+Io))}return 0!==this.es&&(u=p.phi<0?1:0,c=Math.tan(p.phi),d=this.b/Math.sqrt(c*c+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),u&&(p.phi=-p.phi)),p.lam+=this.long0,t.x=p.lam,t.y=p.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var ku=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Du=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ru=.8487,Bu=1.3523,Gu=Go/5,Uu=1/Gu,ju=18,zu=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Vu=function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])};const Ju={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=ml(t.x-this.long0),r=Math.abs(t.y),i=Math.floor(r*Gu);i<0?i=0:i>=ju&&(i=ju-1),r=Go*(r-Uu*i);var s={x:zu(ku[i],r)*e,y:zu(Du[i],r)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*Ru+this.x0,s.y=s.y*this.a*Bu+this.y0,s},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Ru),y:Math.abs(t.y-this.y0)/(this.a*Bu)};if(e.y>=1)e.x/=ku[ju][0],e.y=t.y<0?-Io:Io;else{var r=Math.floor(e.y*ju);for(r<0?r=0:r>=ju&&(r=ju-1);;)if(Du[r][0]>e.y)--r;else{if(!(Du[r+1][0]<=e.y))break;++r}var i=Du[r],s=5*(e.y-i[0])/(Du[r+1][0]-i[0]);s=function(t,e,r,i){for(var s=e;i;--i){var n=t(s);if(s-=n,Math.abs(n)<r)break}return s}(function(t){return(zu(i,t)-e.y)/Vu(i,t)},s,Ro,100),e.x/=zu(ku[r],s),e.y=(5*r+s)*Bo,t.y<0&&(e.y=-e.y)}return e.x=ml(e.x+this.long0),e},names:["Robinson","robin"]};const qu={init:function(){this.name="geocent"},forward:function(t){return Rl(t,this.es,this.a)},inverse:function(t){return Bl(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var Hu={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Wu={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const Yu={init:function(){if(Object.keys(Wu).forEach(function(t){if(void 0===this[t])this[t]=Wu[t].def;else{if(Wu[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Wu[t].num&&(this[t]=parseFloat(this[t]))}Wu[t].degrees&&(this[t]=this[t]*Bo)}.bind(this)),Math.abs(Math.abs(this.lat0)-Io)<Ro?this.mode=this.lat0<0?Hu.S_POLE:Hu.N_POLE:Math.abs(this.lat0)<Ro?this.mode=Hu.EQUIT:(this.mode=Hu.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,r,i,s,n=Math.sin(t.y),a=Math.cos(t.y),o=Math.cos(t.x);switch(this.mode){case Hu.OBLIQ:r=this.sinph0*n+this.cosph0*a*o;break;case Hu.EQUIT:r=a*o;break;case Hu.S_POLE:r=-n;break;case Hu.N_POLE:r=n}switch(e=(r=this.pn1/(this.p-r))*a*Math.sin(t.x),this.mode){case Hu.OBLIQ:r*=this.cosph0*n-this.sinph0*a*o;break;case Hu.EQUIT:r*=n;break;case Hu.N_POLE:r*=-a*o;break;case Hu.S_POLE:r*=a*o}return s=1/((i=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-r*this.sg)*this.cw*s,r=i*s,t.x=e*this.a,t.y=r*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,r,i,s={x:t.x,y:t.y};i=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*i,r=this.pn1*t.y*this.cw*i,t.x=e*this.cg+r*this.sg,t.y=r*this.cg-e*this.sg;var n=kh(t.x,t.y);if(Math.abs(n)<Ro)s.x=0,s.y=t.y;else{var a,o;switch(o=1-n*n*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/n+n/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Hu.OBLIQ:s.y=Math.asin(a*this.sinph0+t.y*o*this.cosph0/n),t.y=(a-this.sinph0*Math.sin(s.y))*n,t.x*=o*this.cosph0;break;case Hu.EQUIT:s.y=Math.asin(t.y*o/n),t.y=a*n,t.x*=o;break;case Hu.N_POLE:s.y=Math.asin(a),t.y=-t.y;break;case Hu.S_POLE:s.y=-Math.asin(a)}s.x=Math.atan2(t.x,t.y)}return t.x=s.x+this.long0,t.y=s.y,t},names:["Tilted_Perspective","tpers"]};const Xu={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,r,i,s,n=t.x,a=t.y;if(n-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var o=this.radius_p/kh(this.radius_p*Math.cos(a),Math.sin(a));if(r=o*Math.cos(n)*Math.cos(a),i=o*Math.sin(n)*Math.cos(a),s=o*Math.sin(a),(this.radius_g-r)*r-i*i-s*s*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(i/kh(s,e)),t.y=this.radius_g_1*Math.atan(s/e)):(t.x=this.radius_g_1*Math.atan(i/e),t.y=this.radius_g_1*Math.atan(s/kh(i,e)))}else"sphere"===this.shape&&(e=Math.cos(a),r=Math.cos(n)*e,i=Math.sin(n)*e,s=Math.sin(a),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(i/kh(s,e)),t.y=this.radius_g_1*Math.atan(s/e)):(t.x=this.radius_g_1*Math.atan(i/e),t.y=this.radius_g_1*Math.atan(s/kh(i,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,r,i,s,n=-1,a=0,o=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*kh(1,o)):(a=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*kh(1,a));var l=o/this.radius_p;if(e=a*a+l*l+n*n,(i=(r=2*this.radius_g*n)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;s=(-r-Math.sqrt(i))/(2*e),n=this.radius_g+s*n,a*=s,o*=s,t.x=Math.atan2(a,n),t.y=Math.atan(o*Math.cos(t.x)/n),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+o*o)):(a=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),e=a*a+o*o+n*n,(i=(r=2*this.radius_g*n)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;s=(-r-Math.sqrt(i))/(2*e),n=this.radius_g+s*n,a*=s,o*=s,t.x=Math.atan2(a,n),t.y=Math.atan(o*Math.cos(t.x)/n)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};Zl.defaultDatum="WGS84",Zl.Proj=Dl,Zl.WGS84=new Zl.Proj("WGS84"),Zl.Point=yh,Zl.toPoint=ql,Zl.defs=ll,Zl.nadgrid=function(t,e){var r=new DataView(e),i=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),s=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Pl(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(r,i);s.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var n={header:s,subgrids:function(t,e,r){for(var i=[],s=0;s<e.nSubgrids;s++){var n=Il(t,176,r),a=Fl(t,176,n,r),o=Math.round(1+(n.upperLongitude-n.lowerLongitude)/n.longitudeInterval),l=Math.round(1+(n.upperLatitude-n.lowerLatitude)/n.latitudeInterval);i.push({ll:[Ll(n.lowerLongitude),Ll(n.lowerLatitude)],del:[Ll(n.longitudeInterval),Ll(n.latitudeInterval)],lim:[o,l],count:n.gridNodeCount,cvs:Nl(a)})}return i}(r,s,i)};return El[t]=n,n},Zl.transform=Wl,Zl.mgrs=ah,Zl.version="__VERSION__",function(t){t.Proj.projections.add(Ih),t.Proj.projections.add(Gh),t.Proj.projections.add(Uh),t.Proj.projections.add(Jh),t.Proj.projections.add(qh),t.Proj.projections.add(Hh),t.Proj.projections.add(Yh),t.Proj.projections.add(Xh),t.Proj.projections.add(Qh),t.Proj.projections.add(nu),t.Proj.projections.add(pu),t.Proj.projections.add(mu),t.Proj.projections.add(yu),t.Proj.projections.add(gu),t.Proj.projections.add(vu),t.Proj.projections.add(Su),t.Proj.projections.add(_u),t.Proj.projections.add(xu),t.Proj.projections.add(Cu),t.Proj.projections.add(Mu),t.Proj.projections.add(Au),t.Proj.projections.add(Tu),t.Proj.projections.add(Eu),t.Proj.projections.add(Ou),t.Proj.projections.add(Fu),t.Proj.projections.add(Ju),t.Proj.projections.add(qu),t.Proj.projections.add(Yu),t.Proj.projections.add(Xu)}(Zl);const Qu=Zl;window.proj4=Qu,window.Proj4js=Qu,wo().Proj=wo().Proj||{},wo().Proj._isProj4Obj=function(t){return void 0!==t.inverse&&void 0!==t.forward},wo().Proj.Projection=wo().Class.extend({initialize:function(t,e,r,i){var s=wo().Proj._isProj4Obj(t);this._proj=s?t:this._projFromCodeDef(t,e);var n=r;wo().Util.isArray(r)&&(n=wo().bounds(r)),this.bounds=s?e:n,this.wrapLng=i},project:function(t){var e=this._proj.forward([t.lng,t.lat]);return new(wo().Point)(e[0],e[1])},unproject:function(t,e){this.bounds&&!this.wrapLng&&(t.x=t.x<this.bounds.min.x?this.bounds.min.x:t.x>this.bounds.max.x?this.bounds.max.x:t.x,t.y=t.y<this.bounds.min.y?this.bounds.min.y:t.y>this.bounds.max.y?this.bounds.max.y:t.y);var r=this._proj.inverse([t.x,t.y]);return new(wo().LatLng)(r[1],r[0],e)},_projFromCodeDef:function(t,e){if(e)Qu.defs(t,e);else if(void 0===Qu.defs[t]){var r=t.split(":");if(r.length>3&&(t=r[r.length-3]+":"+r[r.length-1]),void 0===Qu.defs[t])throw"No projection definition for code "+t}return Qu(t)},getUnits:function(){return this._proj.oProj.units||"degrees"}});var Zu=wo().Class.extend({includes:wo().CRS,options:{transformation:new(wo().Transformation)(1,0,-1,0)},initialize:function(t,e){var r,i,s;if(e.bounds&&4===e.bounds.length){const[t,r,i,s]=e.bounds;e.bounds=[[t,r],[i,s]]}if(wo().Proj._isProj4Obj(t)?(r=(i=t).srsCode,e=e||{},this.projection=new(wo().Proj.Projection)(i,e.bounds,e.wrapLng)):(r=t,s=(e=e||{}).def||"",this.projection=new(wo().Proj.Projection)(r,s,e.bounds,e.wrapLng)),wo().Util.setOptions(this,e),this.options.wrapLng&&(this.wrapLng=this.options.wrapLng),this.code=r,this.transformation=this.options.transformation,this.options.dpi=this.options.dpi||96,this.options.bounds&&(this.options.bounds=wo().bounds(this.options.bounds)),!this.options.origin&&this.options.bounds&&(this.options.origin=[this.options.bounds.min.x,this.options.bounds.max.y]),this.options.origin&&(this.options.origin instanceof wo().Point&&(this.options.origin=[this.options.origin.x,this.options.origin.y]),this.transformation=new(wo().Transformation)(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales&&this.options.scales.length>0)this.scales=this.options.scales,this._scales=this._toProj4Scales(this.options.scales,this.options.dpi);else if(this.options.scaleDenominators&&this.options.scaleDenominators.length>0){this.scales=[];for(let t=0;t<this.options.scaleDenominators.length;t++)this.scales[t]=1/this.options.scaleDenominators[t];this._scales=this._toProj4Scales(this.scales,this.options.dpi)}else if(this.options.resolutions&&this.options.resolutions.length>0){this._scales=[];for(let t=this.options.resolutions.length-1;t>=0;t--)this.options.resolutions[t]&&(this._scales[t]=1/this.options.resolutions[t])}else this.options.bounds&&(this._scales=this._getDefaultProj4ScalesByBounds(this.options.bounds));this._rectify(),this.infinite=!this.options.bounds},_rectify:function(){if(this._scales&&(this.resolutions||(this.resolutions=[],this.resolutions=this._proj4ScalesToResolutions(this._scales)),!this.scales)){this.scales=[];for(let e=0;e<this.resolutions.length;e++){var t=this.resolutions[e]*this.options.dpi*(1/.0254)*this._getMeterPerMapUnit(this.projection.getUnits());this.scales[e]=1/t}}},scale:function(t){var e,r=Math.floor(t);return t===r?this._scales[t]:(e=this._scales[r])+(this._scales[r+1]-e)*(t-r)},zoom:function(t){var e,r,i=this._closestElement(this._scales,t),s=this._scales.indexOf(i);return i?t===i?s:(r=s+1,void 0===(e=this._scales[r])?s:(t-i)/(e-i)+s):0},distance:wo().CRS.Earth.distance,R:wo().CRS.Earth.R,_closestElement:function(t,e){for(var r,i=t.length;i--;)t[i]<=e&&(void 0===r||r<t[i])&&(r=t[i]);return r},_proj4ScalesToResolutions(t){var e=[];if(!t)return e;for(var r=0;r<t.length;r++)e[r]=1/t[r];return e},_toProj4Scales:function(t,e){var r=[];if(!t)return r;for(var i=0;i<t.length;i++){var s=this.projection?this._getMeterPerMapUnit(this.projection.getUnits()):1;r[i]=1/(.0254/((e||96)*t[i])/s)}return r},_getMeterPerMapUnit:function(t){var e=1;return"meter"===t?e=1:"degrees"===t||"degree"===t?e=2*Math.PI*6378137/360:"kilometer"===t?e=.001:"inch"===t?e=1/.025399999918:"feet"===t&&(e=.3048),e},_getDefaultProj4ScalesByBounds:function(t){if(!t)return[];for(var e=t.getSize(),r=Math.max(e.x,e.y)/256,i=[],s=0;s<23;s++)i[s]=Math.pow(2,s)/r;return i}}),Ku=function(t,e){return new Zu(t,e)};const $u={Prefix:"Leaflet with <span>Â© <a href='https://iclient.supermap.io' title='SuperMap iClient' target='_blank'>SuperMap iClient</a></span>",Common:{attribution:"Map Data <span>Â© <a href='http://support.supermap.com.cn/product/iServer.aspx' title='SuperMap iServer' target='_blank'>SuperMap iServer</a></span>"},Online:{attribution:"Map Data <span>Â© <a href='https://www.supermapol.com' title='SuperMap Online' target='_blank'>SuperMap Online</a></span>"},ECharts:{attribution:"Â© 2018 ç¾åº¦ ECharts"},MapV:{attribution:"Â© 2018 ç¾åº¦ MapV "},Turf:{attribution:"<span>Â© <a href='https://turfjs.org/' title='turfjs' target='_blank'>turfjs</a></span>"},Baidu:{attribution:"Map Data Â© 2018 Baidu - GS(2016)2089å· - Data Â© é¿å°ä¸æ¹"},Cloud:{attribution:"Map Data Â©2014 SuperMap - GS(2014)6070å·-dataÂ©Navinfo"},Tianditu:{attribution:"Map Data <a href='https://www.tianditu.gov.cn' target='_blank'><img style='background-color:transparent;bottom:2px;opacity:1;' src='https://api.tianditu.gov.cn/img/map/logo.png' width='53px' height='22px' opacity='0'></a>"}};wo().Control.Attribution.include({options:{position:"bottomright",prefix:$u.Prefix}}),wo().Map.include({latLngToAccurateContainerPoint:function(t){var e=this.project(wo().latLng(t))._subtract(this.getPixelOrigin());return wo().point(e).add(this._getMapPanePos())}}),function(t){t.map(t=>(t.defaultFunction=t.prototype.toGeoJSON,t.include({toGeoJSON:function(e){return t.defaultFunction.call(this,e||10)}}),t))}([wo().Polyline,wo().Polygon,wo().Marker,wo().CircleMarker,wo().Circle,wo().LayerGroup]);var tc=wo().Evented.extend({options:{url:null,proxy:null,withCredentials:!1,crossOrigin:null},initialize:function(t,e){t&&(t=t.indexOf("/")!==t.length-1?t:t.substr(0,t.length-1)),this.url=t,wo().setOptions(this,e),this.fire("initialized",this)},destroy:function(){this.fire("destroy",this)}}),ec=tc.extend({options:{projection:null},initialize:function(t,e){e=e||{},wo().setOptions(this,e),e.projection&&(this.options.projection=e.projection),tc.prototype.initialize.call(this,t,e)},getMapInfo:function(t){var e=this;return new Di(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers,projection:e.options.projection}).processAsync(t)},getWKT(t){var e=this;return new Di(`${e.url}/prjCoordSys.wkt`,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,withoutFormatSuffix:!0,crossOrigin:e.options.crossOrigin,headers:e.options.headers,projection:e.options.projection}).processAsync(t)},getTilesets:function(t){var e=this;return new Qs(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}}),rc=wo().Control.extend({options:{layer:null,position:"topleft",title:"switch tile version",tooltip:"top",collapsed:!0,nextText:"+",lastText:"-",ico:"V",orientation:"horizontal",switch:!0},onAdd:function(){"vertical"!==this.options.orientation&&(this.options.orientation="horizontal");var t=this._initLayout();return this.options.layer&&this.setLayer(this.options.layer),t},setContent:function(t){var e=wo().Util.extend({},t);this.setVersionName(e.desc).setToolTip(e.desc)},setVersionName:function(t){var e=t;return t||(e=this.getValue()),this._sliderValue.innerHTML=e,this},setToolTip:function(t){return this.tooltip.innerHTML=t,this},updateLength:function(t){t>0&&(this.length=t,this.max=this.length-1,this.slider.setAttribute("max",this.max))},setLayer:function(t){t&&(this.options.layer=t);var e=this,r=e.options.layer;r.on("tilesetsinfoloaded",function(t){var r=t&&t.tileVersions;e.update(r)}),r.on("tileversionschanged",function(t){var r=t&&t.tileVersion;e.setContent(r)}),e.getTileSetsInfo()},update:function(t){this.tileVersions=t||[],this.updateLength(this.tileVersions.length)},getTileSetsInfo:function(){var t=this;t.options.layer&&new ec(t.options.layer._url).getTilesets(function(e){t.options.layer.setTileSetsInfo(e.result)})},removeLayer:function(){this.options.layer=null},nextTilesVersion:function(){return this.firstLoad?(this.options.layer.nextTilesVersion(),this.firstLoad=!1,this):parseInt(this.slider.value)>this.max-1?this:(this.slider.value=parseInt(this.slider.value)+1,this.options.layer.nextTilesVersion(),this)},lastTilesVersion:function(){return parseInt(this.slider.value)<this.min+1?this:(this.slider.value=parseInt(this.slider.value)-1,this.options.layer.lastTilesVersion(),this)},tilesVersion:function(t){for(var e=this.options.layer,r=this.tileVersions,i=r.length,s=0;s<i;s++)if(r[s].name==t){e.updateCurrentTileSetsIndex(s),e.changeTilesVersion();break}},getValue:function(){return this.slider.value},getVersion:function(){var t=this.tileVersions[this.getValue()];return t&&t.name},_initLayout:function(){var t="leaflet-control-ctv";this._container=wo().DomUtil.create("div",t+" "+t+"-"+this.options.orientation),this._sliderBtn=wo().DomUtil.create("a",t+"-toggle",this._container),this._sliderBtn.setAttribute("title",this.options.title),this._sliderBtn.innerHTML=this.options.ico,this._sliderValue=wo().DomUtil.create("p",t+"-value",this._container),this._sliderValue.innerHTML=this.options.ico;return this._sliderContent=wo().DomUtil.create("div","leaflet-ctv-slider-main  tooltip",this._container),this.tooltip=wo().DomUtil.create("span","tooltip-text  tooltip-"+this.options.tooltip,this._sliderContent),this.tooltip.innerHTML=this.options.ico,this.options.switch&&(this._next=wo().DomUtil.create("a","leaflet-ctv-slider-incdec leaflet-ctv-slider-next",this._sliderContent),this._next.innerHTML=this.options.nextText,wo().DomEvent.on(this._next,"click",this.nextTilesVersion,this),wo().DomUtil.addClass(this._container,t+"-incdec")),this._sliderContainer=wo().DomUtil.create("div","leaflet-ctv-slider-container",this._sliderContent),this.slider=wo().DomUtil.create("input","leaflet-ctv-slider",this._sliderContainer),this.min=null==this.min||isNaN(this.min)?0:parseInt(this.min),this.slider.setAttribute("title",this.options.title),this.slider.setAttribute("id","slider"),this.slider.setAttribute("type","range"),this.slider.setAttribute("min",this.min),this.slider.setAttribute("max",0),this.slider.setAttribute("step",1),this.slider.setAttribute("value",0),this.firstLoad=!0,"oninput"in this.slider||"onchange"in this.slider?wo().DomEvent.on(this.slider,"change",this._tilesVersion,this):this.slider.onpropertychange=this._tilesVersion,this.options.switch&&(this._last=wo().DomUtil.create("a","leaflet-ctv-slider-incdec leaflet-ctv-slider-last",this._sliderContent),this._last.innerHTML=this.options.lastText,wo().DomEvent.on(this._last,"click",this.lastTilesVersion,this)),"vertical"===this.options.orientation?(this.slider.style.width="170px",this._sliderContainer.style.height="170px"):this._sliderContainer.style.width="150px",wo().DomEvent.disableClickPropagation(this._container),this.options.collapsed?(wo().Browser.android||wo().DomEvent.on(this._container,"mouseenter",this._expand,this).on(this._container,"mouseleave",this._collapse,this),wo().Browser.touch?wo().DomEvent.on(this._sliderBtn,"click",wo().DomEvent.stop).on(this._sliderBtn,"click",this._expand,this):wo().DomEvent.on(this._sliderBtn,"focus",this._expand,this)):this._expand(),this._container},_expand:function(){wo().DomUtil.addClass(this._container,"leaflet-control-ctv-expanded")},_collapse:function(){wo().DomUtil.removeClass(this._container,"leaflet-control-ctv-expanded")},_tilesVersion:function(){var t=this.getVersion();this.tilesVersion(t)}});wo().Map.mergeOptions({changeTileVersionControl:!1}),wo().Map.addInitHook(function(){this.options.changeTileVersionControl&&(this.changeTileVersionControl=new rc,this.addControl(this.changeTileVersionControl))});var ic=wo().Control.extend({options:{position:"bottomright",imageUrl:null,link:null,width:null,height:null,alt:"SuperMap iClient"},onAdd:function(){var t=wo().DomUtil.create("div","iclient-leaflet-logo");t.style.marginTop=0,t.style.marginBottom=0,t.style.marginLeft=0,t.style.marginRight=0;var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF4AAAAdCAYAAAAjHtusAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozYWZlOGIwMi01MWE3LTRiZjYtYWVkYS05MGQ2ZTQ4YjZiMmUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODg0NkFBQUE3RjEzMTFFNzhFRjJFQkY4RjcxQjc1NjIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODg0NkFBQTk3RjEzMTFFNzhFRjJFQkY4RjcxQjc1NjIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4MWI3NzdhNC1lZmEyLTQ1MzUtOGQzNi03MmRjNDkyODMzN2UiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpjYTYzODVjMi1jNDQ1LTExN2EtYTc0ZC1lM2I5MzJlMGE4Y2QiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5q1HM0AAAF/ElEQVR42tSabYhUVRjHZ7W01C1uaCRW4F3oi9SXCUnwQ9gsGUFvOEtQH1bLu5VS9sbYh5KicjYt29qiGQwVg2xWWKgocob91AvC+CWsoJqB3qHMSdTMpZyeU/+Df07n3pk7997Z6cBv99z7nHvOvf/z/pxJNZvNVI/jCKXmv6EquAmVkxPSlvtp2GItr0/96fFQForChJAWDiVYTkMYMu4XBFcYjLOwWS3sNwmn8NGzZ0h4Flv/zwIdchAnh/slCGmmKUNIBzYPaXOUr0vPuEjD71JAPh7l61embzinhV3V8nnCGmGT8LwlzSL8/yUh4Tfjo9T/CgnCIYNKycA2Qq21AcHU/VHE80Idoo3Qs0W6p0UtUnkZvEMDeVcCyqxEafF7hL8Qf0oYsIj+lfC9cH1CwhchWAGCtZO+AooQOkdC1Km1VtCb63StW73uFSzgKFUkNwBbmZGGmqowhvg8ZNpH9oXChcIcYRdeNomgxLkaH+S1SGubAxyIpFv+Zp+0DYjrAS00j/dem2VGEl6FJ4Qa4quEu8j2hTCJ+GJhe4JjfQMf6JCYPPbysMPxBlp0BUKOogEF9Rg9/heNvNKYfM0KsZUZaYxX4STGrzJa+zbhPeFH2DcK10KItcI+pI0rVElwXl1ULaKnIJhDw0oRQpTQc1zcbwRU8ATy4DR6yMlTzwkqMziEWHvubJ4Nk4ZtHdnqwvwY17xq3Z4FjrG+z2Kdrdf2ZSGD+xlLPh6t1R0jP9fI22ZzKI92yvQl7EbmBxI4S7Y+vIAOL87QZqsc5uNnssxZIcfYjXT9snCR7jjobidp+FkxA2v+Cq1QervMDmp4P7Xs3YZtE9kOC3P/By6JGaETl8ElwueYTNTDq4UDsKnd7YfCNbT239LF1udS72xYJt1UWxNfN4IIP4bWuTpEja01JtMFZFsm/AHbtHBlDE6yasA4moYTrUbvdBTXHqUrAH4uSadbyzF+vbBM2IsNkS3MNa5305JxqfA02T4TnkX8XOH1mPw8ruVejpxbI9hZD2Cz1U7LdrrUvjP/WfZinNZhr6V27hP+FPZh9aLvLxVO4DllX0G2OcKnlO/DCblxaz6uXBtmi+8mBaP3/SP8IuEIiTRoPPQm2TaEmEyXo0JU+F0YiPFD0hhOsiE/vqeEVwyTgF8L51OilcIZ2I4Ll5NttvAJPfukUeB2sk0ZPSbKIUUJpCII7+DasWy08uhNNazT0wGHI7mAtB7KqMKm38HhDdAUibTVKGicbB8YAqrJ9DRsp43JdB4qUof1HQrPE6XTQWu3Ce/inVzjXhXpMiTwUYugNVQ+p80jrUsV5EH0POKeuXO9QjhFq5GryNYvfEMCDhsftYVsB9ETtG0V9ZjfhCURhbcJFpfwVZ9jvhxsLHwTYtp2svlWQw3vXL8UnqHVSIG8l8ex+tHhBXgjddgqHEZ8ufAA2aaEnYgrF/KrPXrEmMUqZ9THLW06xhoBaVueQpkug+ewOUphE3Qv2Q5gGamXYa+QbVq4O+DQ5FHyZqrjxNt7UHh9uuRa0F7HjCF8o9PCTOGnscM7g2u1Hl9C9oeEnxC/1ajZg8JLiM9Hj9GHJseMShwL2DO0G5yEWn3Zh1QUods5CPkIoqlwAZxhXMsb6HrcEPBxchhdJ6wj29vCW4hfLOzo8J3rltYX50nXQAATSf/K4DEaGlTLvplsk/QCpoD60EQ7gLYZc8H9wq+I3yncEOEcNhuz6HWf3XEiwU/4Y8YEqVp2P10rt+8REvBGw026i4aDcbL9jF8r8Blmf4fCOzhViiscskygXRdehf3CO4hfigmTBXyQrl8TFtD1IzQX3CbcQrY3hPcRv4z8OmHPXwchVNln2MmE7BX6VwIFi/he6uxvb6JM3m0fdqvx/ATidxg2JeC7VDErAw5NzGfvwRJVheEIQ8Mg/pdwIM+UOmi9Q8ivCsrIy0tF+wVbEcLrd3Pb2XisEb4Tdlhsi4WP4RBbaLGrHfC3PrvMIezy9rTpGm5lz9LOMG15xvFxD/j5gjzjjDbMOzk+9zzt3v5bgAEAibzFeFHVgYkAAAAASUVORK5CYII=";this.options.imageUrl&&(e=this.options.imageUrl);var r=this.options.alt,i="94px",s="29px",n="width:"+i+";height:"+s+";";this.options.imageUrl&&(n="width:"+(i=this.options.width)+";height:"+(s=this.options.height)+";",i&&s||(n=""));var a=this.options.link;return t.innerHTML="<a href='"+a+"' target='_blank' style='border: none;display: block;'><img src="+e+" alt='"+r+"' style='border: none;"+n+"margin-right:5px;margin-bottom:2px;white-space: nowrap'></a>",t}});wo().Map.mergeOptions({logoControl:!0}),wo().Map.addInitHook(function(){!this._logoAdded&&this.options.logoControl&&(!0===this.options.logoControl?this.logoControl=new ic:this.options.logoControl instanceof wo().Control&&(this.logoControl=this.options.logoControl),this.logoControl&&(this.addControl(this.logoControl),this._logoAdded=!0))});const sc=function(t){return"[object Array]"==Object.prototype.toString.call(t)},nc={toSuperMapBounds:t=>(t&&-1!==["FeatureCollection","Feature"].indexOf(t.type)&&(t=wo().geoJSON(t).getBounds()),t instanceof wo().LatLngBounds?new at(t.getSouthWest().lng,t.getSouthWest().lat,t.getNorthEast().lng,t.getNorthEast().lat):t instanceof wo().Bounds?new at(t.min.x,t.min.y,t.max.x,t.max.y):sc(t)?new at(t[0],t[1],t[2],t[3]):new at),isArray:sc,toProcessingParam(t){var e={};if(t.length<1)e="";else{for(var r=[],i=0;i<t.length;i++){var s={};s.x=t[i][0],s.y=t[i][1],r.push(s)}e.type="REGION",e.points=r}return e}};var ac=wo().extend({},wo().CRS.EPSG3857,{code:"Baidu",scale:function(t){return 6378137*Math.PI*2/Math.pow(2,18-t)},transformation:function(){var t=.5/(6378137*Math.PI);return new(wo().Transformation)(t,0,-t,0)}()}),oc=[];for(let t=1;t<19;t++)oc.push(1.40625/Math.pow(2,t));var lc=Ku("EPSG:4326",{origin:[-180,90],resolutions:oc,bounds:wo().bounds([-180,-90],[180,90]),wrapLng:[-180,180]});const hc=2*Math.PI*6378137,uc=hc/2;var cc=[];for(let t=1;t<19;t++)cc.push(hc/256/Math.pow(2,t));var dc=Ku("EPSG:3857",{origin:[-uc,uc],resolutions:cc,bounds:wo().bounds([-uc,-uc],[uc,uc]),wrapLng:[-180,180]}),pc=wo().Class.extend({initialize:function(t){this.bounds=t},project:function(t){return new(wo().Point)(t.lng,t.lat)},unproject:function(t){return new(wo().LatLng)(t.y,t.x)}}),fc=function(t){return new pc(t)},mc=wo().Class.extend({includes:wo().CRS,initialize:function(t){t.origin&&(this.transformation=new(wo().Transformation)(1,-t.origin.x,-1,t.origin.y)),this.projection=fc(t.bounds),this.bounds=t.bounds,this.origin=t.origin,this.resolutions=t.resolutions},scale:function(t){let e;if(!this.resolutions||0===this.resolutions.length){return(e=1/(Math.max(this.bounds.getSize().x,this.bounds.getSize().y)/256))*Math.pow(2,t)}return this.resolutions[t]?1/this.resolutions[t]:1/this.resolutions[0]*Math.pow(2,t)},zoom:function(t){let e;if(!this.resolutions||0===this.resolutions.length){return e=1/(Math.max(this.bounds.getSize().x,this.bounds.getSize().y)/256),Math.log(t/e)/Math.LN2}const r=this.resolutions.indexOf(1/t);return r>-1?r:Math.log(t/(1/this.resolutions[0]))/Math.LN2},distance:function(t,e){var r=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(r*r+i*i)},infinite:!1}),yc=function(t){return new mc(t)},gc=function(t){return t?(new Nt).toGeoJSON(t):t},vc=function(t){if(!t)return t;var e,r=new Nt;if(-1!=["FeatureCollection","Feature","Geometry"].indexOf(t.type))e=r.read(t,t.type);else if("function"==typeof t.toGeoJSON){var i=t.toGeoJSON();e=i?r.read(i,i.type):t}var s=e||t;return wo().Util.isArray(e)&&(1===e.length?s=e[0]:e.length>1&&(s=[],e.map(function(t){return s.push(t.geometry),t}))),s&&s.geometry?s.geometry:s},bc=jn,Sc=function(t,e,r){var i=t*e*(1/.0254)*bc(r);return i=1/i},_c=function(t,e,r){var i=t*e*(1/.0254)*bc(r);return i=1/i},xc=function(t){return t>1?1/t:t},wc=function(t,e,r,i){return i=i||6378137,r=r||"",t>0&&e>0?(t=xc(t),"degree"===r.toLowerCase()||"degrees"===r.toLowerCase()||"dd"===r.toLowerCase()?254/e/t/(2*Math.PI*i/360)/1e4:254/e/t/1e4):-1},Cc=function(t,e=wo().CRS.EPSG4326,r){let i=null,s=null;if(-1===["FeatureCollection","Feature","Geometry"].indexOf(t.type))if(t.toGeoJSON)t=t.toGeoJSON();else if(t instanceof wo().LatLngBounds)t=wo().rectangle(t).toGeoJSON();else{if(!(t instanceof wo().Bounds))throw new Error("This tool only supports data conversion in geojson format or Vector Layers of Leaflet.");t=wo().rectangle([[t.getTopLeft().x,t.getTopLeft().y],[t.getBottomRight().x,t.getBottomRight().y]]).toGeoJSON()}const n={point:function(t){return s(t)},multipoint:function(t){return n.linestring.apply(this,[t])},linestring:function(t){let e=[],r=null;for(let i=0,s=t.length;i<s;++i){try{r=n.point.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return e},multilinestring:function(t){return n.polygon.apply(this,[t])},polygon:function(t){let e,r=[];for(let i=0,s=t.length;i<s;++i){try{e=n.linestring.apply(this,[t[i]])}catch(t){throw t}r.push(e)}return r},multipolygon:function(t){let e=[],r=null;for(let i=0,s=t.length;i<s;++i){try{r=n.polygon.apply(this,[t[i]])}catch(t){throw t}e.push(r)}return e}};return function(t,e){if(i=t,s=e,"Feature"===t.type)i=a(t);else if("FeatureCollection"===t.type){let e=[];for(let r=0;r<t.features.length;++r)try{e.push(a(t.features[r]))}catch(t){e=null}i.features=e}return i}(t,function(t){var i=e.unproject({x:t[0],y:t[1]});const s=r.project(i);return[s.x,s.y]});function a(t){const e=t.geometry;if(!rt.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!n[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{e.coordinates=n[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(t){throw t}return t.geometry=e,t}},Mc=wo().TileLayer.extend({url:"https://maponline{num}.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles={styles}&udt=20150815&scaler=1",options:{minZoom:3,maxZoom:19,bounds:wo().latLngBounds(wo().latLng(-85.0511287798,-180),wo().latLng(85.0511287798,180)),retina:wo().Browser.retina,attribution:$u.Baidu.attribution},initialize:function(t,e){t&&(this.url=t),wo().setOptions(this,e),this.options.retina&&(this.options.maxZoom=18),wo().stamp(this)},getTileUrl:function(t){var e=wo().Util.template(this.url,{num:Math.abs((t.x+t.y)%4),x:t.x,y:-t.y-1,z:this._getZoomForUrl(),styles:this.options.retina?"ph":"pl"});return this.options.tileProxy&&(e=this.options.tileProxy+encodeURIComponent(e)),e}}),Ac=function(t,e){return new Mc(t,e)},Tc=wo().TileLayer.extend({defaultURL:"http://t2.dituhui.com/FileService/image",options:{mapName:"quanguo",type:"web",minZoom:3,maxZoom:18,attribution:$u.Cloud.attribution},initialize:function(t,e){wo().setOptions(this,e);var r=t||this.defaultURL;this._url=r+"?map="+this.options.mapName+"&type="+this.options.type,wo().stamp(this)},getTileUrl:function(t){var e=this._url+"&x="+t.x+"&y="+t.y+"&z="+t.z;return this.options.tileProxy&&(e=this.options.tileProxy+encodeURIComponent(e)),e}}),Ec=function(t,e){return new Tc(t,e)},Oc=xo.Layer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,opacity:1,alt:"",pane:"tilePane",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:"",attribution:$u.Common.attribution,updateInterval:150,tileProxy:null,format:"png"},initialize:function(t,e){this._url=t,xo.Util.setOptions(this,e)},onAdd:function(t){this.update=xo.Util.throttle(this.update,this.options.updateInterval,this),t.on("moveend",this.update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this.update()},onRemove:function(){this._currentImage&&this._map.removeLayer(this._currentImage),this._map.off("moveend",this.update,this)},bringToFront:function(){return this.options.position="front",this._currentImage&&this._currentImage.bringToFront(),this},bringToBack:function(){return this.options.position="back",this._currentImage&&this._currentImage.bringToBack(),this},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getImageUrl:function(t){let e=rt.urlPathAppend(this._url,`image.${this.options.format}`),r=e+xo.Util.getParamString(Object.assign({},this._initAllRequestParams(),t),e);return r=Vt.appendCredential(r),this.options.tileProxy&&(r=this.options.tileProxy+encodeURIComponent(r)),this.options.cacheEnabled||(r+="&_t="+(new Date).getTime()),r},_getImageParams:function(t){var e=this._calculateImageSize(t);return{viewBounds:this._compriseBounds(this._calculateBounds(t)),width:e.x,height:e.y}},_initAllRequestParams:function(){var t=this.options||{},e={},r=!0===t.redirect&&t.redirect;e.redirect=r;var i=!0===t.transparent&&t.transparent;e.transparent=i;var s=!1!==t.cacheEnabled||t.cacheEnabled;return e.cacheEnabled=s,t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID),t.rasterfunction&&(e.rasterfunction=JSON.stringify(t.rasterfunction)),t.clipRegionEnabled&&t.clipRegion&&(e.clipRegionEnabled=t.clipRegionEnabled,e.clipRegion=JSON.stringify(Tt.fromGeometry(vc(t.clipRegion)))),!1===t.overlapDisplayed?(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=this.overlapDisplayedOptions.toString())):e.overlapDisplayed=!0,e},_requestImage:function(t,e){var r=this.getImageUrl(t);this._loadImage(r,e)},_loadImage:function(t,e){if(this._map){var r=new xo.ImageOverlay(t,e,{opacity:0,alt:this.options.alt,zIndex:this.options.zIndex,className:this.options.className,errorOverlayUrl:this.options.error,crossOrigin:this.options.crossOrigin,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),i=function(t){r.off("error",s,this);var i=this._map;if(i){var n=t.target,a=this._currentImage;n._bounds&&n._bounds.equals(e)&&n._bounds.equals(i.getBounds())?(this._currentImage=n,"front"===this.options.position&&this.bringToFront(),"back"===this.options.position&&this.bringToBack(),this._currentImage._map&&this._currentImage.setOpacity(this.options.opacity),a&&i.removeLayer(a),a&&a._map&&a._map.removeLayer(a)):i.removeLayer(n),this.fire("load",{bounds:e})}},s=function(){this._map.removeLayer(r),this.fire("error"),r.off("load",i,this)};r.once("load",i,this),r.once("error",s,this),this.fire("loading",{bounds:e})}},update:function(){if(this._map){var t=this._map.getZoom(),e=this._map.getBounds();if(t>(this._map.options.maxZoom||18)||t<(this._map.options.minZoom||0))this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);else{var r=this._getImageParams(e);r?this._requestImage(r,e):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_calculateBounds:function(t){var e=this._map.options.crs.project(t.getNorthEast()),r=this._map.options.crs.project(t.getSouthWest());return wo().bounds(e,r)},_compriseBounds:function(t){var e={leftBottom:{x:t.getBottomLeft().x,y:t.getTopRight().y},rightTop:{x:t.getTopRight().x,y:t.getBottomLeft().y}};return JSON.stringify(e)},_calculateImageSize:function(t){return new(wo().Bounds)(this._map.latLngToLayerPoint(t.getNorthWest()),this._map.latLngToLayerPoint(t.getSouthEast())).getSize()}}),Lc=wo().TileLayer.extend({options:{version:"1.0.0",style:"",tilematrixSet:"",format:"image/png",tileSize:256,matrixIds:null,layer:"",requestEncoding:"KVP",attribution:"",noWrap:!0},initialize:function(t,e){this._url=t,wo().setOptions(this,e);var r=this.options;if("REST"===r.requestEncoding){this.formatSuffix="."+({"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"}[r.format]||r.format.split("/").pop()||"png")}else r.requestEncoding="KVP"},getTileUrl:function(t){var e=this._getZoomForUrl(),r=this.options.matrixIds?this.options.matrixIds[e].identifier:e,i=this._url.indexOf("?"),s=i>-1?this._url.substring(0,this._url.indexOf("?")):this._url,n=i>-1?this._url.substring(this._url.indexOf("?")):"";s=wo().Util.template(s,{s:this._getSubdomain(t)});var a={service:"WMTS",request:"GetTile",version:this.options.version,style:this.options.style,tilematrixSet:this.options.tilematrixSet,format:this.options.format,width:this.options.tileSize,height:this.options.tileSize,layer:this.options.layer,tilematrix:r,tilerow:t.y,tilecol:t.x};if(this.options.tileProxy&&(s=this.options.tileProxy+s),"KVP"===this.options.requestEncoding)s+=wo().Util.getParamString(a,s);else if("REST"===this.options.requestEncoding){s+="/"+a.layer+"/"+a.style+"/"+a.tilematrixSet+"/"+a.tilematrix+"/"+a.tilerow+"/"+a.tilecol+this.formatSuffix}return s=rt.urlAppend(s,n),s=Vt.appendCredential(s)}}),Pc=function(t,e){return new Lc(t,e)},Nc=Lc.extend({layerLabelMap:{vec:"cva",ter:"cta",img:"cia"},layerZoomMap:{vec:18,ter:14,img:18},options:{layerType:"vec",isLabel:!1,attribution:$u.Tianditu.attribution,url:"https://t{s}.tianditu.gov.cn/{layer}_{proj}/wmts?",zoomOffset:1,key:"",dpi:96,style:"default",format:"tiles",subdomains:[0,1,2,3,4,5,6,7],bounds:[[-90,-180],[90,180]],noWrap:!0},initialize:function(t){t=t||{},wo().setOptions(this,t),this.options.layer=this.options.isLabel?this.layerLabelMap[this.options.layerType]:this.options.layerType,this.options.maxZoom=this.layerZoomMap[this.options.layerType]-1,Lc.prototype.initialize.call(this,this.options.url,this.options),wo().stamp(this),this.options.key&&(this._url=`${this._url}tk=${this.options.key}`)},onAdd:function(t){this.options.tilematrixSet="EPSG:4326"===t.options.crs.code?"c":"w",this._url=this._url.replace("{layer}",this.options.layer).replace("{proj}",this.options.tilematrixSet),Lc.prototype.onAdd.call(this,t)},_isValidTile:function(t){const e=this._map.options.crs;if(!e.infinite){const r=this._globalTileRange;if((!e.wrapLng||this.options.noWrap)&&(t.x<r.min.x||t.x>r.max.x)||!e.wrapLat&&(t.y<r.min.y||t.y>r.max.y))return!1}if(!this.options.bounds)return!0;const r=this._tileCoordsToBounds(t);return wo().latLngBounds(this.options.bounds).overlaps(r)}}),Ic=wo().TileLayer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,tileversion:null,crs:null,format:"png",tileProxy:null,attribution:$u.Common.attribution,subdomains:null},initialize:function(t,e){this._url=t,wo().TileLayer.prototype.initialize.apply(this,arguments),wo().setOptions(this,e),wo().stamp(this),this.tileSetsIndex=-1,this.tempIndex=-1},onAdd:function(t){this._crs=this.options.crs||t.options.crs,wo().TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this.getScaleFromCoords(t),r=this._getLayerUrl()+"&scale="+e+"&x="+t.x+"&y="+t.y;return this.options.tileProxy&&(r=this.options.tileProxy+encodeURIComponent(r)),this.options.cacheEnabled||(r+="&_t="+(new Date).getTime()),this.options.subdomains&&(r=wo().Util.template(r,{s:this._getSubdomain(t)})),r},getScale:function(t){var e=t||this._map.getZoom();return this.scales[e]},getScaleFromCoords:function(t){var e,r=this;return r.scales&&r.scales[t.z]?r.scales[t.z]:(r.scales=r.scales||{},e=r.getDefaultScale(t),r.scales[t.z]=e,e)},getDefaultScale:function(t){var e=this._crs;if(e.scales)return e.scales[t.z];var r=this._tileCoordsToBounds(t),i=e.project(r.getNorthEast()),s=e.project(r.getSouthWest()),n=this.options.tileSize,a=Math.max(Math.abs(i.x-s.x)/n,Math.abs(i.y-s.y)/n),o=l.METER;if(e.code){var h=e.code.split(":");if(h&&h.length>1){var u=parseInt(h[1]);o=u&&u>=4e3&&u<=5e3?l.DEGREE:l.METER}}return Sc(a,96,o)},setTileSetsInfo:function(t){this.tileSets=t,wo().Util.isArray(this.tileSets)&&(this.tileSets=this.tileSets[0]),this.tileSets&&(this.fire("tilesetsinfoloaded",{tileVersions:this.tileSets.tileVersions}),this.changeTilesVersion())},lastTilesVersion:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()},nextTilesVersion:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()},changeTilesVersion:function(){var t=this;if(null!=t.tileSets&&!(t.tempIndex===t.tileSetsIndex||this.tempIndex<0)){var e=t.tileSets.tileVersions;if(e&&t.tempIndex<e.length&&t.tempIndex>=0){var r=e[t.tempIndex].name;t.mergeTileVersionParam(r)&&(t.tileSetsIndex=t.tempIndex,t.fire("tileversionschanged",{tileVersion:e[t.tempIndex]}))}}},updateCurrentTileSetsIndex:function(t){this.tempIndex=t},mergeTileVersionParam:function(t){return!!t&&(this.requestParams.tileversion=t,this._paramsChanged=!0,this.redraw(),this._paramsChanged=!1,!0)},_getLayerUrl:function(){return this._paramsChanged&&(this._layerUrl=this._createLayerUrl()),this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let t=rt.urlPathAppend(this._url,`tileImage.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),t=rt.urlAppend(t,xo.Util.getParamString(this.requestParams)),t=Vt.appendCredential(t),this._layerUrl=t,t},_getAllRequestParams:function(){var t=this.options||{},e={},r=this.options.tileSize;r instanceof wo().Point||(r=wo().point(r,r)),e.width=r.x,e.height=r.y,e.redirect=!0===t.redirect,e.transparent=!0===t.transparent,e.cacheEnabled=!(!1===t.cacheEnabled),t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID.toString()),t.clipRegionEnabled&&t.clipRegion&&(t.clipRegion=Tt.fromGeometry(vc(t.clipRegion)),e.clipRegionEnabled=t.clipRegionEnabled,e.clipRegion=JSON.stringify(t.clipRegion));var i=this._crs;if(i.options&&i.options.origin)e.origin=JSON.stringify({x:i.options.origin[0],y:i.options.origin[1]});else if(i.projection&&i.projection.bounds){var s=i.projection.bounds,n=wo().point(s.min.x,s.max.y);e.origin=JSON.stringify({x:n.x,y:n.y})}return!1===t.overlapDisplayed?(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=t.overlapDisplayedOptions)):e.overlapDisplayed=!0,!0===e.cacheEnabled&&t.tileversion&&(e.tileversion=t.tileversion.toString()),t.rasterfunction&&(e.rasterfunction=JSON.stringify(t.rasterfunction)),e}}),Fc=function(t,e){return new Ic(t,e)},kc=r(545),Dc=r.n(kc),Rc={TEXT:{fontSize:"14px",fontFamily:"Arial Unicode MS Regular,Microsoft YaHei",textAlign:"left",color:"rgba(255,255,255,0)",fillColor:"rgba(80,80,80,1)",weight:1,globalAlpha:1},POINT:{fillColor:"#ffcc00",color:"#cc3333",weight:1,radius:3,opacity:1},LINE:{color:"rgba(0,0,0,0)",weight:1,lineCap:"butt",lineJoin:"round",dashOffset:0,dashArray:[],opacity:1},REGION:{color:"rgba(0,0,0,0)",fillColor:"rgba(0,0,0,0)",weight:1,lineCap:"butt",lineJoin:"round",dashOffset:0,opacity:1,fillOpacity:1,dashArray:[]}},Bc={TEXT:{"text-size":"fontSize","text-face-name":"fontFamily","text-align":"textAlign","text-name":"textName","text-weight":"fontWeight","text-halo-color":"color","text-fill":"fillColor","text-comp-op":"globalCompositeOperation"},POINT:{"point-file":"iconUrl","point-fill":"fillColor","point-radius":"radius","point-halo-color":"color","point-comp-op":"globalCompositeOperation"},LINE:{"line-color":"color","line-width":"weight","line-cap":"lineCap","line-join":"lineJoin","line-dash-offset":"dashOffset","line-opacity":"opacity","line-dasharray":"dashArray","line-comp-op":"globalCompositeOperation"},REGION:{"line-color":"color","line-width":"weight","line-cap":"lineCap","line-join":"lineJoin","line-dash-offset":"dashOffset","line-opacity":"opacity","line-dasharray":"dashArray","polygon-fill":"fillColor","polygon-opacity":"fillOpacity","polygon-comp-op":"globalCompositeOperation"}},Gc={lineWidth:{leafletStyle:"weight",type:"number",unit:"mm",defaultValue:.1},fillForeColor:{leafletStyle:"fillColor",type:"color",defaultValue:"rgba(0,0,0,0)"},foreColor:{leafletStyle:"color",type:"color",defaultValue:"rgba(0,0,0,0)"},markerSize:{leafletStyle:"markerSize",type:"number",unit:"mm",defaultValue:2.4},lineColor:{leafletStyle:"color",type:"color",defaultValue:"#000000"}},Uc={clear:"",src:"",dst:"","src-over":"source-over","dst-over":"destination-over","src-in":"source-in","dst-in":"destination-in","src-out":"source-out","dst-out":"destination-out","src-atop":"source-atop","dst-atop":"destination-atop",xor:"xor",plus:"lighter",minus:"",multiply:"",screen:"",overlay:"",darken:"",lighten:"lighter","color-dodge":"","color-burn":"","hard-light":"","soft-light":"",difference:"",exclusion:"",contrast:"",invert:"","invert-rgb":"","grain-merge":"","grain-extract":"",hue:"",saturation:"",color:"",value:""};class jc{constructor(t){this.cartoCSS=null,this.mapUrl=t}pretreatedCartoCSS(t,e){e&&(t=this.processCharacters(t)),this.cartoCSS=this.cartoCSS||{};var r=new Hn(t).getShaders();if(r)for(var i=0;i<r.length;i++){var s=r[i].elements[0],n=r[i].attachment;this.cartoCSS[s.clean]=this.cartoCSS[s.clean]||{},this.cartoCSS[s.clean][n]=this.cartoCSS[s.clean][n]||[],this.cartoCSS[s.clean][n].push(r[i])}}processCharacters(t){var e=t;if(e){e=(e=e.replace(/[@]/gi,"___")).replace(/\\#/gi,"#");var r={};return this.layersInfo&&Object.keys(this.layersInfo).sort().forEach(function(t){var i=t.replace(/[@#\s]/gi,"___"),s=t,n=Object.keys(r);for(let e=n.length;e>-1;e--)if(t.indexOf(n[e])>-1){s=t.replace(n[e],r[n[e]]);break}s=s.replace(/[#]/gi,"#"),r[t]=i,e=e.replace(new RegExp(s,"g"),i)}),e=(e=e.replace(/[#]/gi,"\n#")).replace(/\[zoom/gi,"[scale")}}pickShader(t){if(!this.cartoCSS)return null;var e=t.replace(/[@#\s]/gi,"___");return this.cartoCSS[e]}getDefaultStyle(t){var e={},r=Rc[t];for(var i in r){var s=r[i];e[i]=s}return e}getStyleFromiPortalMarker(t){return 0==t.indexOf("./")?null:wo().icon({iconUrl:t,iconSize:wo().point(48,43),iconAnchor:wo().point(24,43),popupAnchor:wo().point(0,-43)})}getStyleFromiPortalStyle(t,e,r){var i=r?JSON.parse(r):null,s={};if("Point"===e||"MultiPoint"===e){var n=i||t.pointStyle;return n.externalGraphic?0==n.externalGraphic.indexOf("./")?null:wo().icon({iconUrl:n.externalGraphic,iconSize:wo().point(n.graphicWidth,n.graphicHeight),iconAnchor:wo().point(-n.graphicXOffset,-n.graphicYOffset),popupAnchor:wo().point(0,-n.graphicHeight)}):(s.radius=n.pointRadius,s.color=n.strokeColor,s.opacity=n.strokeOpacity,s.lineCap=n.strokeLineCap,s.weight=n.strokeWidth,s.fillColor=n.fillColor,s.fillOpacity=n.fillOpacity,s.dashArray=this.dashStyle(n,1),s)}if("LineString"===e||"MultiLineString"===e||"Box"===e){var a=i||t.lineStyle;return s.color=a.strokeColor,s.opacity=a.strokeOpacity,s.fillOpacity=a.fillOpacity,s.lineCap=a.strokeLineCap,s.weight=a.strokeWidth,s.dashArray=this.dashStyle(a,1),s}if("Polygon"===e||"MultiPolygon"===e){var o=i||t.polygonStyle;return s.color=o.strokeColor,s.opacity=o.strokeOpacity,s.lineCap=o.strokeLineCap,s.weight=o.strokeWidth,s.fillColor=o.fillColor,s.fillOpacity=o.fillOpacity,s.dashArray=this.dashStyle(o,1),s}}dashStyle(t,e){if(!t)return[];var r=t.strokeWidth*e,i=t.strokeDashstyle;switch(i){case"solid":return[];case"dot":return[1,4*r];case"dash":return[4*r,4*r];case"dashdot":return[4*r,4*r,1,4*r];case"longdash":return[8*r,4*r];case"longdashdot":return[8*r,4*r,1,4*r];default:return i?rt.isArray(i)?i:(i=W.trim(i).replace(/\s+/g,",")).replace(/\[|\]/gi,"").split(","):[]}}getValidStyleFromCarto(t,e,r,i,s){if(!r)return null;var n=i.type,a=i.properties.attributes||{},o=this.getDefaultStyle(n);s=void 0===s||s,a.FEATUREID=i.properties.id,a.SCALE=e;for(var l,h,u=Bc[n],c=0,d=r.length;c<d;c++){var p=r[c],f=u[p.property],m=p.getValue(a,t,!0);if(null!==m&&f)if("fontSize"===f)s&&(m*=.8),l=m+"px",o.fontSize=l;else if("fontName"===f)h=m,o.fontName=h;else{if("globalCompositeOperation"===f){if(!(m=Uc[m]))continue}else if(s&&"iconUrl"===f){m=(m=this.mapUrl+"/tileFeature/symbols/"+m.replace(/(___)/gi,"@")).replace(/(__0__0__)/gi,"__8__8__"),o.iconUrl=m;continue}"weight"===f&&m<1&&(m=Math.ceil(m)),o[f]=m}}return o}getValidStyleFromLayerInfo(t,e){var r=t.type,i=this.getDefaultStyle(r),s=e&&e.layerStyle;if(!s)return i;if("POINT"===r){var n=Math.ceil(s.markerSize*et*it.mm)||8,a={transparent:!0,resourceType:"SYMBOLMARKER",picWidth:n,picHeight:n,style:JSON.stringify(s)};return i.iconUrl=rt.urlAppend(this.mapUrl+"/symbol.png",rt.getParameterString(a)),i.iconSize=[n,n],i}if("TEXT"===r){if(s=t.properties.textStyle||e.layerStyle,i.fontWeight=s.bold?s.fontWeight:"normal",s.fontHeight){var o=s.fontHeight*et*it.mm*.85;i.fontSize=o+"px",i.textHeight=o}if(s.fontName&&(i.fontFamily=s.fontName.indexOf("@")?s.fontName.replace(/@/g,""):s.fontName),s.align){var l=s.align.replace(/TOP|MIDDLE|BASELINE|BOTTOM/,"");i.textAlign=l.toLowerCase()}return i.weight=s.outline?s.outlineWidth:0,s.backColor&&(i.color="rgba("+s.backColor.red+","+s.backColor.green+","+s.backColor.blue+",1)"),s.foreColor&&(i.fillColor="rgba("+s.foreColor.red+","+s.foreColor.green+","+s.foreColor.blue+",1)"),i.rotation=s.rotation||0,i}var h=s.fillSymbolID>7?0:s.fillSymbolID,u=s.lineSymbolID>5?0:s.lineSymbolID;for(var c in s){var d=Gc[c];if(d){var p=d.leafletStyle;switch(d.type){case"number":{let t=s[c];d.unit&&(t=t*et*it[d.unit]*2.5),i[p]=t;break}case"color":{var f=s[c];let t,e=1;if("fillColor"===p)0!==h&&1!==h||(e=1-h,t="rgba("+f.red+","+f.green+","+f.blue+","+e+")");else if("color"===p){if(0===u||5===u)e=0===u?1:0;else{var m=[1,0];switch(u){case 1:m=[9.7,3.7];break;case 2:m=[3.7,3.7];break;case 3:m=[9.7,3.7,2.3,3.7];break;case 4:m=[9.7,3.7,2.3,3.7,2.3,3.7]}i.lineDasharray=m}t="rgba("+f.red+","+f.green+","+f.blue+","+e+")"}i[p]=t;break}}}}return e.textField&&(i.textAlign="LEFT"),i}}var zc=wo().Class.extend({initialize:function(t){var e=(t=t||{}).latLng||t._latLng;this._latLng=wo().latLng(e.lat,e.lng),this._style=t.style||t._canvas,this.attributes=t.attributes,this.id=t.id?t.id:null},getId(){return this.id},setId(t){this.id=t},setLatLng:function(t){this._latLng=t},setCanvas:function(t){this._style=t},setAttributes:function(t){this.attributes=t},getLatLng:function(){return this._latLng},getCanvas:function(){return this._style},getAttributes:function(){return this.attributes},setStyle:function(t){this._style=t},getStyle:function(){return this._style}}),Vc=wo().Class.extend({initialize:function(t,e){this.geometry=t,this.attributes=e},toFeature:function(){let t=this.geometry;if(t.toGeoJSON){const e=t.toGeoJSON();return e.properties=this.attributes,(new Nt).read(e)[0]}if(3===t.length)t=new dt(t[1],t[0],t[2]);else if(2===t.length)t=new ut(t[0],t[1]);else if(t instanceof wo().LatLng)t=new ut(t.lng,t.lat);else if(t instanceof wo().Point)t=new ut(t.x,t.y);else if(t instanceof wo().CircleMarker){var e=t.getLatLng();t=new ut(e.lng,e.lat)}return new Ot(t,this.attributes)},reverseLatLngs:function(t){wo().Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e]=[t[e].lng,t[e].lat];return t}}),Jc=wo().Layer.extend({options:{alwaysMapCRS:!1,id:rt.createUniqueID("themeLayer_"),opacity:1,TFEvents:[],attribution:$u.Common.attribution},initialize:function(t,e){wo().Util.setOptions(this,e),this.name=t,this.features=[],this.TFEvents=this.options.TFEvents,this.levelRenderer=new Fa,this.movingOffset=[0,0]},getEvents:function(){var t={zoomend:this._reset,moveend:this._reset,resize:this._resize};return this._map._zoomAnimated&&(t.zoomanim=this._zoomAnim),t},onRemove:function(t){wo().DomUtil.remove(this.container),t.off("mousemove",this.mouseMoveHandler)},onAdd:function(t){var e=this;if(e.map=e._map=t,e._initContainer(),e.levelRenderer){var r=t.getSize();e.container.style.width=r.x+"px",e.container.style.height=r.y+"px",e._updateOpacity(),e.renderer=e.levelRenderer.init(e.container),e.renderer.clear(),e.features&&e.features.length>0&&e._reset(),e.addTFEvents(),e.mouseMoveHandler=function(t){var r=t.layerPoint;e.currentMousePosition=wo().point(r.x+e.movingOffset[0],r.y+e.movingOffset[1])},t.on("mousemove",e.mouseMoveHandler),e.update(t.getBounds())}else t.removeLayer(e)},addFeatures:function(t){},redrawThematicFeatures:function(t){},destroyFeatures:function(t){if(void 0===t&&(t=this.features),t){this.removeFeatures(t),Array.isArray(t)||(t=[t]);for(var e=t.length-1;e>=0;e--)t[e].destroy()}},removeFeatures:function(t){var e=this;if(t){if(t===e.features)return e.removeAllFeatures();wo().Util.isArray(t)||"function"==typeof t||(t=[t]);for(var r=[],i=0;i<e.features.length;i++){var s=e.features[i];if(t&&"function"==typeof t)t(s)&&e.features.splice(i--,1);else-1===wo().Util.indexOf(t,s)?r.push(s):e.features.splice(i--,1)}for(var n=[],a=0,o=e.features.length;a<o;a++)s=e.features[a],n.push(s);e.features=[],e.addFeatures(n),e.renderer&&(e._map?e.redrawThematicFeatures(e._map.getBounds()):e.redrawThematicFeatures());var l=0==r.length;e.fire("featuresremoved",{features:r,succeed:l})}},removeAllFeatures:function(){this.renderer&&this.renderer.clear(),this.features=[],this.fire("featuresremoved",{features:[],succeed:!0})},getFeatures:function(t){for(var e=this.features.length,r=[],i=0;i<e;++i)(!t||t&&"function"==typeof t&&t(this.features[i]))&&r.push(this.features[i]);return r},getFeatureBy:function(t,e){var r=null;for(var i in this.features)if(this.features[i][t]===e){r=this.features[i];break}return r},getFeatureById:function(t){return this.getFeatureBy("id",t)},getFeaturesByAttribute:function(t,e){var r,i=[];for(var s in this.features)(r=this.features[s])&&r.attributes&&r.attributes[t]===e&&i.push(r);return i},update:function(t){var e=this._map.containerPointToLayerPoint([0,0]);wo().DomUtil.setPosition(this.container,e);var r=this;r.renderer&&r.redrawThematicFeatures(t),r.currentMousePosition&&(r.currentMousePosition=wo().point(r.currentMousePosition.x-r.movingOffset[0],r.currentMousePosition.y-r.movingOffset[1])),r.movingOffset=[0,0],r._zoom=r._map.getZoom(),r._center=r._map.getCenter()},setOpacity:function(t){t!==this.options.opacity&&(isNaN(t)||(this.options.opacity=t,this._updateOpacity()))},redraw:function(){var t=this;return!!t.renderer&&(t._map?t.redrawThematicFeatures(t._map.getBounds()):t.redrawThematicFeatures(),!0)},on:function(t,e,r){return this.renderer?this.renderer.on(t,e):wo().Layer.prototype.on.call(this,t,e),this},off:function(t,e,r){return this.renderer?this.renderer.un(t,e):wo().Layer.prototype.off.call(this,t,e),this},fire:function(t,e,r){return this.renderer&&this.renderer.trigger(t,e),wo().Layer.prototype.fire.call(this,t,e,r),this},addTFEvents:function(){for(var t=this.TFEvents,e=t.length,r=0;r<e;r++)this.renderer.on(t[r][0],t[r][1])},getLocalXY:function(t){if(!this._map)return t;var e=t;wo().Util.isArray(t)&&(e=wo().point(t[0],t[1])),t instanceof wo().Point||(e=t instanceof ut||t instanceof dt?wo().point(t.x,t.y):wo().point(t.lon,t.lat));var r=this._map.latLngToAccurateContainerPoint(this.options.alwaysMapCRS?this._map.options.crs.unproject(e):wo().latLng(e.y,e.x));return[r.x,r.y]},toiClientFeature:function(t){rt.isArray(t)||(t=[t]);let e=[];for(let r=0;r<t.length;r++)if(t[r]instanceof Vc)e.push(t[r].toFeature());else if(t[r]instanceof Ot)e.push(t[r]);else if(-1!=["FeatureCollection","Feature","Geometry"].indexOf(t[r].type)){const i=new Nt;e=e.concat(i.read(t[r]))}else{if(!t[r].geometry||!t[r].geometry.parts)throw new Error(`features[${r}]'s type is not be supported.`);e.push(Ss.fromJson(t[r]).toFeature())}return e},toFeature:function(t){return this.toiClientFeature(t)},_initContainer:function(){var t=this.getPane(),e="themeLayer leaflet-layer leaflet-zoom-"+(this._map.options.zoomAnimation&&wo().Browser.any3d?"animated":"hide");this.container=wo().DomUtil.create("div",e,t);var r=wo().DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this.container.id=this.options.id,this.container.style[r]="50% 50%",this.container.style.position="absolute",this.container.style.zIndex=200},_zoomAnim:function(t){var e=this._map.getZoomScale(t.zoom),r=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());wo().DomUtil.setTransform?wo().DomUtil.setTransform(this.container,r,e):this.container.style[wo().DomUtil.TRANSFORM]=wo().DomUtil.getTranslateString(r)+" scale("+e+")"},_updateOpacity:function(){var t=this;rt.modifyDOMElement(t.container,null,null,null,null,null,null,t.options.opacity),null!==t._map&&t._map.fire("changelayer",{layer:t,property:"opacity"})},_reset:function(){var t=this,e=t._map.getBounds();t.update(e);var r=t._map.getSize(),i=this._map.containerPointToLayerPoint([0,0]);wo().DomUtil.setPosition(this.container,i),parseFloat(t.container.width)!==parseFloat(r.x)&&(t.container.width=r.x+"px"),parseFloat(t.container.height)!==parseFloat(r.y)&&(t.container.height=r.y+"px"),t.redraw()},_resize:function(){var t=this._map.getSize();this.container.style.width=t.x+"px",this.container.style.height=t.y+"px",this.renderer.resize()}}),qc=Jc.extend({options:{nodesClipPixel:2,isHoverAble:!1,isMultiHover:!1,isClickAble:!0,isAllowFeatureStyle:!1},initialize:function(t,e){Jc.prototype.initialize.call(this,t,e),wo().Util.setOptions(this,e);this.cache={},this.cacheFields=[],this.style={},this.highlightStyle={}},addFeatures:function(t){var e=this;e.fire("beforefeaturesadded",{features:t}),this.features=this.toiClientFeature(t),e.isCustomSetMaxCacheCount||(e.maxCacheCount=5*e.features.length),e.renderer&&(e._map?e.redrawThematicFeatures(e._map.getBounds()):e.redrawThematicFeatures())},removeFeatures:function(t){this.clearCache(),Jc.prototype.removeFeatures.call(this,t)},removeAllFeatures:function(){this.clearCache(),Jc.prototype.removeAllFeatures.call(this,arguments)},redrawThematicFeatures:function(t){var e=this,r=e.renderer.getHoverOne(),i=null;if(r&&r.refDataID&&(i=r.refDataID),this.options.alwaysMapCRS&&t&&t instanceof wo().LatLngBounds){var s=this._map.options.crs;t=wo().bounds(s.project(t.getSouthWest()),s.project(t.getNorthEast()))}t=nc.toSuperMapBounds(t),e.renderer.clearAll();for(var n=e.features,a=e.cache,o=e.cacheFields,l=e._map.getZoom(),h=e.maxCacheCount,u=0,c=n.length;u<c;u++){var d=n[u],p=d.geometry.getBounds();if(!t||t.intersectsBounds(p)){var f=d.id+"_zoom_"+l.toString();if(a[f])a[f].updateAndAddShapes();else{var m=e.createThematicFeature(n[u]);if(!(m.getShapesCount()<1)&&(a[f]=m,o.push(f),o.length>h)){var y=o[0];o.splice(0,1),delete a[y]}}}}if(e.renderer.render(),i&&e.options.isHoverAble&&e.options.isMultiHover){var g=this.getShapesByFeatureID(i);this.renderer.updateHoverShapes(g)}},createThematicFeature:function(t){var e=this,r=e.getStyleByData(t);t.style&&e.isAllowFeatureStyle&&(r=rt.copyAttributesWithClip(t.style));var i={};i.nodesClipPixel=e.options.nodesClipPixel,i.isHoverAble=e.options.isHoverAble,i.isMultiHover=e.options.isMultiHover,i.isClickAble=e.options.isClickAble,i.highlightStyle=ba.transformStyle(e.highlightStyle);for(var s=new wa(t,e,ba.transformStyle(r),i),n=0;n<s.shapes.length;n++)e.renderer.addShape(s.shapes[n]);return s},redraw:function(){return this.clearCache(),Jc.prototype.redraw.apply(this,arguments)},clearCache:function(){this.cache={},this.cacheFields=[]},clear:function(){this.renderer.clearAll(),this.renderer.refresh(),this.removeAllFeatures(),this.clearCache()},getCacheCount:function(){return this.cacheFields.length},setMaxCacheCount:function(t){isNaN(t)||(this.maxCacheCount=t,this.isCustomSetMaxCacheCount=!0)},getShapesByFeatureID:function(t){var e=[],r=this.renderer.getAllShapes();if(!t)return r;for(var i=0,s=r.length;i<s;i++){var n=r[i];n.refDataID&&t===n.refDataID&&e.push(n)}return e}}),Hc=qc.extend({initialize:function(t,e){qc.prototype.initialize.call(this,t,e),this.style=[],this.themeField=null,this.styleGroups=[]},getStyleByData:function(t){var e=this,r=t,i=rt.copyAttributesWithClip({},e.style),s=e.styleGroups,n=!1,a=null,o=e.styleGroups&&e.styleGroups.length>0;if(e.themeField&&o&&r.attributes){var l=e.themeField,h=r.attributes;for(var u in h)if(l===u){n=!0,a=h[u];break}}if(n)for(var c=0,d=s.length;c<d;c++)if(a.toString()===s[c].value.toString()){var p=s[c].style;i=rt.copyAttributesWithClip(i,p)}return i}}),Wc=qc.extend({initialize:function(t,e){qc.prototype.initialize.call(this,t,e),this.style=[],this.themeField=null,this.styleGroups=[]},getStyleByData:function(t){var e=this,r=t,i=rt.copyAttributesWithClip({},e.style),s=e.styleGroups,n=!1,a=null,o=e.styleGroups&&e.styleGroups.length>0;if(e.themeField&&o&&r.attributes){var l=e.themeField,h=r.attributes;for(var u in h)if(l===u){n=!0,a=h[u];break}}if(n)for(var c=0,d=s.length;c<d;c++){if(c===d-1?a>=s[c].start&&a<=s[c].end:a>=s[c].start&&a<s[c].end){var p=s[c].style;i=rt.copyAttributesWithClip(i,p)}}return i}}),Yc=qc.extend({options:{isOverLay:!0,isAvoid:!0},initialize:function(t,e){qc.prototype.initialize.call(this,t,e),wo().Util.setOptions(this,e),this.style=[],this.themeField=null,this.styleGroups=[],this.defaultStyle={fontColor:"#000000",fontOpacity:1,fontSize:"12px",fontStyle:"normal",fontWeight:"normal",labelAlign:"cm",labelXOffset:0,labelYOffset:0,labelRotation:0,fill:!1,fillColor:"#ee9900",fillOpacity:.4,stroke:!1,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",labelRect:!0,labelSelect:!0,_isGeoTextStrategyStyle:!0},this.getPxBoundsMode=0,this.labelFeatures=[]},onAdd:function(t){qc.prototype.onAdd.call(this,t),this.container.style.zIndex=200},redrawThematicFeatures:function(t){if(this.features.length>0&&0==this.labelFeatures.length)for(var e=this.setLabelsStyle(this.features),r=0,i=e.length;r<i;r++)this.labelFeatures.push(e[r]);this.features=this.getDrawnLabels(this.labelFeatures),qc.prototype.redrawThematicFeatures.call(this,t)},removeFeatures:function(t){this.labelFeatures=[],qc.prototype.removeFeatures.call(this,t)},removeAllFeatures:function(){this.labelFeatures=[],qc.prototype.removeAllFeatures.call(this,arguments)},getDrawnLabels:function(t){for(var e,r,i,s,n=[],a=[],o={labelAlign:"cm",labelXOffset:0,labelYOffset:0},l=this._map,h=l.getSize(),u=l.getZoom(),c=0,d=t.length;c<d;c++){((r=t[c]).isStyleChange||void 0===r.isStyleChange)&&(r=this.setStyle(r));var p=this.getLabelPxLocation(r);if(p.x>=0&&p.x<=h.x&&p.y>=0&&p.y<=h.y){if(r.style.minZoomLevel>-1&&u<=r.style.minZoomLevel)continue;if(r.style.maxZoomLevel>-1&&u>r.style.maxZoomLevel)continue;var f=null;r.isStyleChange?(r.isStyleChange=null,f=this.calculateLabelBounds(r,p)):f=r.geometry.bsInfo.w&&r.geometry.bsInfo.h?this.calculateLabelBounds2(r,p):this.calculateLabelBounds(r,p);var m=new at(0,h.y,h.x,0),y=f.length;if(this.options.isAvoid){var g=this.getAvoidInfo(m,f);if(g){if("left"===g.aspectW){r.style.labelXOffset+=g.offsetX;for(let t=0;t<y;t++)f[t].x+=g.offsetX}else if("right"===g.aspectW){r.style.labelXOffset+=-g.offsetX;for(let t=0;t<y;t++)f[t].x+=-g.offsetX}if("top"===g.aspectH){r.style.labelYOffset+=g.offsetY;for(let t=0;t<y;t++)f[t].y+=g.offsetY}else if("bottom"===g.aspectH){r.style.labelYOffset+=-g.offsetY;for(let t=0;t<y;t++)f[t].y+=-g.offsetY}r.isStyleChange=!0}}if(this.options.isOverLay){var v=!1;if(0!=c)for(let t=0;t<a.length;t++)if(this.isQuadrilateralOverLap(f,a[t])){v=!0;break}if(v)continue;a.push(f)}var b=[];for(let t=0;t<y-1;t++)b.push(l.containerPointToLatLng(f[t]));var S=b[3],_=b[1],x=new at(S.lng,S.lat,_.lng,_.lat).getCenterLonLat(),w=new dt(x.lon,x.lat,r.attributes[this.themeField]);w.calculateBounds(),i=rt.cloneObject(r.style),s=rt.cloneObject(rt.copyAttributes(i,o)),(e=new Ot(w,r.attributes,s)).id=r.id,e.fid=r.fid,n.push(e)}}return n},getStyleByData:function(t){var e=t;if(e.style=rt.copyAttributes(e.style,this.defaultStyle),this.style&&this.style.fontSize&&parseFloat(this.style.fontSize)<12&&(this.style.fontSize="12px"),e.style=rt.copyAttributes(e.style,this.style),this.themeField&&this.styleGroups&&e.attributes){var r=this.themeField,i=e.attributes,s=this.styleGroups,n=!1,a=null;for(var o in i)if(r===o){n=!0,a=i[o];break}if(n)for(var l=0,h=s.length;l<h;l++)if(a>=s[l].start&&a<s[l].end){var u=s[l].style;u&&u.fontSize&&parseFloat(u.fontSize)<12&&(u.fontSize="12px"),e.style=rt.copyAttributes(e.style,u)}e.style.label=e.attributes[this.themeField]}return e.style},setLabelsStyle:function(t){for(var e,r=[],i=0,s=t.length;i<s;i++){var n=t[i];if("SuperMap.Geometry.GeoText"!==n.geometry.CLASS_NAME)return t;(n.geometry.bsInfo.w||n.geometry.bsInfo.h)&&(n.geometry.bsInfo.w=null,n.geometry.bsInfo.h=null,n.geometry.labelWTmp=null),(e=this.setStyle(n)).layer=this.layer,r.push(e)}return r},setStyle:function(t){var e=t;if(e.style=rt.copyAttributes(e.style,this.defaultStyle),this.style&&this.style.fontSize&&parseFloat(this.style.fontSize)<12&&(this.style.fontSize="12px"),e.style=rt.copyAttributes(e.style,this.style),this.groupField&&this.styleGroups&&e.attributes){var r=this.groupField,i=e.attributes,s=this.styleGroups,n=!1,a=null;for(var o in i)if(r===o){n=!0,a=i[o];break}if(n)for(var l=0,h=s.length;l<h;l++)if(a>=s[l].start&&a<s[l].end){var u=s[l].style;u&&u.fontSize&&parseFloat(u.fontSize)<12&&(u.fontSize="12px"),e.style=rt.copyAttributes(e.style,u)}}return e.style.label=e.geometry.text,e},getLabelPxLocation:function(t){var e=t.geometry,r=t.style,i=e.getCentroid(),s=this._map.latLngToContainerPoint(this.options.alwaysMapCRS?this._map.options.crs.unproject(wo().point(i.x,i.y)):wo().latLng(i.y,i.x)),n=wo().point(s.x,s.y);if(r.labelXOffset||r.labelYOffset){var a=isNaN(r.labelXOffset)?0:r.labelXOffset,o=isNaN(r.labelYOffset)?0:r.labelYOffset,l=n.add(wo().point(a,-o));return wo().point(l.x,l.y)}return wo().point(n.x,n.y)},calculateLabelBounds:function(t,e){var r=t.geometry,i=null,s=null;if(0==this.getPxBoundsMode)i=r.getLabelPxBoundsByText(e,t.style);else{if(1!==this.getPxBoundsMode)return null;s=this.getLabelInfo(t.geometry.getCentroid(),t.style),i=r.getLabelPxBoundsByLabel(e,s.w,s.h,t.style)}var n=[];return n=t.style.labelRotation%180==0?[{x:i.left,y:i.top},{x:i.right,y:i.top},{x:i.right,y:i.bottom},{x:i.left,y:i.bottom},{x:i.left,y:i.top}]:this.rotationBounds(i,e,t.style.labelRotation),r.bounds=new at(n[1].x,n[3].y,n[2].x,n[4].y),n},calculateLabelBounds2:function(t,e){var r,i,s,n,a,o=t.geometry.bsInfo,l=t.style,h=rt.cloneObject(e);if(l.labelAlign&&"cm"!==l.labelAlign)switch(l.labelAlign){case"lt":h.x+=o.w/2,h.y+=o.h/2;break;case"lm":h.x+=o.w/2;break;case"lb":h.x+=o.w/2,h.y-=o.h/2;break;case"ct":h.y+=o.h/2;break;case"cb":h.y-=o.h/2;break;case"rt":h.x-=o.w/2,h.y+=o.h/2;break;case"rm":h.x-=o.w/2;break;case"rb":h.x-=o.w/2,h.y-=o.h/2}i=h.x-o.w/2,s=h.y+o.h/2,a=l.fontStyle&&"italic"===l.fontStyle?h.x+o.w/2+parseInt(parseFloat(l.fontSize)/2):h.x+o.w/2,n=h.y-o.h/2,r=new at(i,s,a,n);var u=[];return u=l.labelRotation%180==0?[{x:r.left,y:r.top},{x:r.right,y:r.top},{x:r.right,y:r.bottom},{x:r.left,y:r.bottom},{x:r.left,y:r.top}]:this.rotationBounds(r,e,l.labelRotation),t.geometry.bounds=new at(u[1].x,u[3].y,u[2].x,u[4].y),u},getLabelInfo:function(t,e){var r={l:"left",r:"right",t:"top",b:"bottom"},i={l:0,r:-1,t:0,b:-1};e=rt.extend({fontColor:"#000000",labelAlign:"cm"},e);var s=this.getLocalXY(t),n=0;if(e.labelXOffset||e.labelYOffset){var a=isNaN(e.labelXOffset)?0:e.labelXOffset,o=isNaN(e.labelYOffset)?0:e.labelYOffset;s[0]+=a,s[1]-=o}var l=document.createElement("canvas");l.globalAlpha=0,l.lineWidth=1;var h=l.getContext("2d");h.fillStyle=e.fontColor,h.globalAlpha=e.fontOpacity||1;var u,c,d,p=[e.fontStyle?e.fontStyle:"normal","normal",e.fontWeight?e.fontWeight:"normal",e.fontSize?e.fontSize:"1em",e.fontFamily?e.fontFamily:"sans-serif"].join(" "),f=e.label.split("\n"),m=f.length;if(h.fillText){h.font=p,h.textAlign=r[e.labelAlign[0]]||"center",h.textBaseline=r[e.labelAlign[1]]||"middle",null==(u=i[e.labelAlign[1]])&&(u=-.5),c=h.measureText("Mg").height||h.measureText("xx").width,s[1]+=c*u*(m-1);for(let t=0;t<m;t++)n<(d=h.measureText(f[t]).width)&&(n=d)}else if(h.mozDrawText){h.mozTextStyle=p,null==(u=i[e.labelAlign[1]])&&(u=-.5),c=h.mozMeasureText("xx"),s[1]+=c*(1+u*m);for(let t=0;t<m;t++)n<(d=h.measureText(f[t]).width)&&(n=d)}var y={};return n?(y.w=n,y.h=e.fontSize,y.rows=f.length,y):null},rotationBounds:function(t,e,r){var i=wo().point(t.left,t.top),s=wo().point(t.right,t.top),n=wo().point(t.right,t.bottom),a=wo().point(t.left,t.bottom),o=[];o.push(this.getRotatedLocation(i.x,i.y,e.x,e.y,r)),o.push(this.getRotatedLocation(s.x,s.y,e.x,e.y,r)),o.push(this.getRotatedLocation(n.x,n.y,e.x,e.y,r)),o.push(this.getRotatedLocation(a.x,a.y,e.x,e.y,r));for(var l=[],h=0;h<o.length;h++)l.push({x:o[h].x,y:o[h].y});return l.push({x:o[0].x,y:o[0].y}),l},getRotatedLocation:function(t,e,r,i,s){var n,a,o={};return e=-e,i=-i,s=-s,n=(t-r)*Math.cos(s/180*Math.PI)-(e-i)*Math.sin(s/180*Math.PI)+r,a=(t-r)*Math.sin(s/180*Math.PI)+(e-i)*Math.cos(s/180*Math.PI)+i,o.x=n,o.y=-a,o},getAvoidInfo:function(t,e){if(5!==e.length)return null;for(var r=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom},{x:t.left,y:t.top}],i=!1,s=r.length,n=e.length,a=0,o=0,l="",h="",u=0;u<s-1;u++)for(var c=0;c<n-1;c++){"SuperMap.Geometry.Point"===rt.lineIntersection(r[u],r[u+1],e[c],e[c+1]).CLASS_NAME&&(d(e[c]),d(e[c+1]),i=!0)}return i?{aspectW:h,aspectH:l,offsetX:a,offsetY:o}:null;function d(e){if(!t.contains(e.x,e.y)){if(e.y<t.top){let r=Math.abs(t.top-e.y);r>o&&(o=r,l="top")}if(e.y>t.bottom){let r=Math.abs(e.y-t.bottom);r>o&&(o=r,l="bottom")}if(e.x<t.left){let r=Math.abs(t.left-e.x);r>a&&(a=r,h="left")}if(e.x>t.right){let r=Math.abs(e.x-t.right);r>a&&(a=r,h="right")}}}},isQuadrilateralOverLap:function(t,e){var r=t.length,i=e.length;if(5!==r||5!==i)return null;var s=!1;for(let i=0;i<r;i++)if(this.isPointInPoly(t[i],e)){s=!0;break}for(let r=0;r<i;r++)if(this.isPointInPoly(e[r],t)){s=!0;break}for(let a=0;a<r-1&&!s;a++)for(var n=0;n<i-1;n++){if("SuperMap.Geometry.Point"===rt.lineIntersection(t[a],t[a+1],e[n],e[n+1]).CLASS_NAME){s=!0;break}}return s},isPointInPoly:function(t,e){for(var r=!1,i=-1,s=e.length,n=s-1;++i<s;n=i)(e[i].y<=t.y&&t.y<e[n].y||e[n].y<=t.y&&t.y<e[i].y)&&t.x<(e[n].x-e[i].x)*(t.y-e[i].y)/(e[n].y-e[i].y)+e[i].x&&(r=!r);return r}});var Xc=tc.extend({initialize:function(t,r){tc.prototype.initialize.call(this,t,r),this._featureService=new class{constructor(t,e){this.url=t,this.options=e||{}}getFeaturesByIDs(t,e,r){var i=this;return new qr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:r}).processAsync(t,e)}getFeaturesByBounds(t,e,r){var i=this;return new Gr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}getFeaturesByBuffer(t,e,r){var i=this;return new jr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}getFeaturesBySQL(t,e,r){var i=this;return new Wr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}getFeaturesByGeometry(t,e,r){var i=this;return new Vr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}editFeatures(t,e){if(t&&t.dataSourceName&&t.dataSetName){var r=this,i=r.url,s=t.dataSourceName,n=t.dataSetName;return i=rt.urlPathAppend(i,"datasources/"+s+"/datasets/"+n),new Ke(i,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}getMetadata(t,e){var r=this,i=r.url,s=t.dataSourceName,n=t.dataSetName;return i=rt.urlPathAppend(i,"datasources/"+s+"/datasets/"+n),new Ke(i,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).getMetaData(t,e)}_processFormat(t){return t||e.GEOJSON}}(t,r)},getFeaturesByIDs:function(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByIDs(t,e,r)},getFeaturesByBounds:function(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByBounds(t,e,r)},getFeaturesByBuffer:function(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByBuffer(t,e,r)},getFeaturesBySQL:function(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesBySQL(t,e,r)},getFeaturesByGeometry:function(t,e,r){return t=this._processParams(t),this._featureService.getFeaturesByGeometry(t,e,r)},editFeatures:function(t,e){if(t&&t.dataSourceName&&t.dataSetName){var r=this,i=r.url,s=t.dataSourceName,n=t.dataSetName;return i=rt.urlPathAppend(i,"datasources/"+s+"/datasets/"+n),new Ke(i,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(r._processParams(t),e)}},getMetadata(t,e){return this._featureService.getMetadata(t,e)},_processParams:function(t){if(!t)return{};t.returnContent=null==t.returnContent||t.returnContent,t.fromIndex=t.fromIndex?t.fromIndex:0,t.toIndex=t.toIndex?t.toIndex:-1,t.isUseBatch=null!=t.isUseBatch&&t.isUseBatch,t.bounds&&(t.bounds=nc.toSuperMapBounds(t.bounds)),t.geometry&&(t.geometry=vc(t.geometry)),t.editType&&(t.editType=t.editType.toLowerCase());var e=this;if(t.features){var r=[];wo().Util.isArray(t.features)?t.features.map(function(t){return r.push(e._createServerFeature(t)),t}):r.push(e._createServerFeature(t.features)),t.features=r}return t},_createServerFeature:function(t){var e,r={},i=[],s=[];for(var n in(e=t||{}).properties)i.push(n),s.push(e.properties[n]);return r.fieldNames=i,r.fieldValues=s,e.id&&(r.id=e.id),r.geometry=vc(e),r},_processFormat:function(t){return t||e.GEOJSON}}),Qc=function(t,e){return new Xc(t,e)},Zc=wo().Path.extend({options:{fontStyle:"normal",fontWeight:"normal",fontSize:"1em",fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle",vfactor:-.5,labelRotation:0,globalAlpha:1,label:""},initialize:function(t,e){wo().Util.setOptions(this,e),this._latlng=t},setLatLng:function(t){return this._latlng=t,this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._clickTolerance(),e=[t,t];this._pxBounds=new(wo().Bounds)(this._point.subtract(e),this._point.add(e))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateUnicode(this)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._clickTolerance()}});wo().Canvas.include({_updateUnicode:function(t){if(!this._drawing)return;let e={x:t._point.x,y:t._point.y},r=this._ctx,i=[t.options.fontStyle,"normal",t.options.fontWeight,t.options.fontSize,t.options.fontFamily].join(" "),s=t.options.label.replace(/^&#x/,""),n=(s=String.fromCharCode(parseInt(s,16))).split("\n"),a=n.length;if(r.fillStyle=t.options.fontColor,r.globalAlpha=1,t.options.fontOpacity>=0&&t.options.fontOpacity<1&&(r.globalAlpha=t.options.fontOpacity),r.fillText){r.font=i,r.textAlign=t.options.textAlign,r.textBaseline=t.options.textBaseline;let s=t.options.vfactor,o=r.measureText("Mg").height||r.measureText("xx").width;e.y+=o*s*(a-1);for(let i=0;i<a;i++)0!=t.options.labelRotation?(r.save(),r.translate(e.x,e.y),r.rotate(t.options.labelRotation*Math.PI/180),r.fillText(n[i],0,o*i),r.restore()):r.fillText(n[i],e.x,e.y)}else if(r.mozDrawText){r.mozTextStyle=i;let s=t.options.textAlign,o=t.options.vfactor,l=r.mozMeasureText("xx");e.y+=l*(1+o*a);for(let t=0;t<a;t++){let i=e.x+s*r.mozMeasureText(n[t]),a=e.y+t*l;r.translate(i,a),r.mozDrawText(n[t]),r.translate(-i,-a)}}}});var Kc=wo().LayerGroup.extend({options:{map:"map",server:"",featureLayerPopupEnable:!0,featureLayerPopup:null,credentialValue:null,credentialKey:"key",attribution:$u.Online.attribution},defaultFeatureLayerPopup:function(t){return t.feature.properties.attributes.title+":"+t.feature.properties.attributes.description},initialize:function(t,e){(t||e)&&(this._layers={},wo().setOptions(this,e),this.id=t,this.load(),this.cartoCSSToLeaflet=new jc)},load:function(){this.options.server.indexOf("http://")<0&&this.options.server.indexOf("https://")<0&&(this.options.server="http://"+this.options.server);var t=this.options.server+"/web/maps/"+this.id+".json";this.options.credentialValue&&(t+="?"+this.options.credentialKey+"="+this.options.credentialValue);var e=this;zt.get(t).then(function(t){return t.json()}).then(function(t){if(t){var r=t.layers;e.mapInfo=t,e.createLayersByJson(r)}})},addLayerWrapper:function(t,e,r){return e&&this.createMap(r),this.addLayer(t),t.labelLayer&&this.addLayer(t.labelLayer),this},createLayersByJson:function(t){if(wo().Util.isArray(t)&&0!==t.length){this.layers=[];for(var e=[],r=0;r<t.length;r++){var i=t[r];i._originIndex=r,"BASE_LAYER"===(i.layerType=i.layerType||"BASE_LAYER")?(i.isBaseLayer=!0,this.createLayer(i.type,i)):e.unshift(i)}for(;e.length>0;){var s=e.pop(),n=s.type,a=s.layerType=s.layerType||"BASE_LAYER";"OVERLAY_LAYER"!==a&&(n=a),this.createLayer(n,s)}this.fire("maploaded",{map:this._map})}},createCRS:function(t,e,r,i,s){return t<0?new mc({bounds:s,origin:i,resolutions:r}):910112===t||910102===t?ac:(910111===t&&(t=3857),910101===t&&(t=4326),Ku("EPSG:"+t,{origin:i,resolutions:r,bounds:s}))},createMap:function(t){var e=t.crs||wo().CRS.EPSG3857,r=wo().latLngBounds(e.unproject(t.bounds.min),e.unproject(t.bounds.max));this._map=wo().map(this.options.map,{center:r.getCenter(),maxZoom:t.maxZoom||22,minZoom:t.minZoom||0,zoom:t.zoom||0,crs:e,renderer:wo().canvas()}),e instanceof mc?this._map.setZoom(t.zoom?t.zoom+2:2,{maxZoom:t.maxZoom||22}):this._map.fitBounds(r,{maxZoom:t.maxZoom||22})},getResolutionsFromScales:function(t,e,r,i){for(var s=[],n=0;n<t.length;n++)s.push(wc(t[n],e,r,i));return s},createLayer:function(t,e){var r=e.prjCoordSys,i=r&&r.epsgCode||this.mapInfo.epsgCode,s=this.mapInfo.center||e.center,n=this.mapInfo.level||e.level,a=this.mapInfo.extent||e.bounds,o=e.scales,l=e.isBaseLayer,h=e.opacity,u=wo().bounds([a.leftBottom.x,a.leftBottom.y],[a.rightTop.x,a.rightTop.y]),c=e.bounds?wo().bounds([e.bounds.leftBottom.x,e.bounds.leftBottom.y],[e.bounds.rightTop.x,e.bounds.rightTop.y]):u;s||(s=c.getCenter());var d,p=wo().point(c.min.x,c.max.y),f=o?this.getResolutionsFromScales(o,96,e.units):null,m=this.createCRS(i,r?r.type:"",f,p,c),y={bounds:u,center:wo().point(s.x,s.y),crs:m,zoom:n};switch(t){case"SUPERMAP_REST":d=Fc(e.url,{transparent:!0,opacity:h});break;case"SUPERMAP_REST_VECTOR":break;case"TIANDITU_VEC":case"TIANDITU_IMG":case"TIANDITU_TER":y.crs=4326===i?lc:dc,y.minZoom=1,y.zoom=1+y.zoom,d=this.createTiandituLayer(e);break;case"BAIDU":y.crs=ac,y.zoom=3+y.zoom,y.minZoom=3,d=Ac();break;case"BING":break;case"WMS":d=this.createWmsLayer(e);break;case"WMTS":y.resolutions=this.getResolutionsFromScales(o,90.71446714322,e.units);var g=e.identifier,v=g.substring(g.indexOf("_")+1);d=Pc(e.url,{layer:v,style:"default",tilematrixSet:g,format:"image/png"});break;case"CLOUD":y.crs=wo().CRS.EPSG3857,y.zoom=3+y.zoom,y.minZoom=3,d=Ec(e.url,{opacity:h});break;case"MARKER_LAYER":d=this.createMarkersLayer(e,m);break;case"FEATURE_LAYER":"ANIMATORVECTOR"==e.identifier||(d="THEME"==e.identifier?this.createThemeLayer(e):this.createVectorLayer(e,m));break;default:throw new Error("unSupported Layer Type")}d&&e.isVisible&&this.addLayerWrapper(d,l,y)},createTiandituLayer:function(t){var e=t.type.split("_")[1].toLowerCase(),r="OVERLAY_LAYER"===t.layerType;return new Nc({layerType:e,isLabel:r})},createMarkersLayer:function(t,e){var r=this,i=t.markers||[],s=wo().geoJSON(gc(i),{pointToLayer:function(t,e){var r=new(wo().Marker)(e);return r.setStyle=function(t){t&&r.setIcon(t)},r},coordsToLatLng:function(t){var r=e.unproject(wo().point(t[0],t[1]));return new(wo().LatLng)(r.lat,r.lng,t[2])},style:function(t){return r.cartoCSSToLeaflet.getStyleFromiPortalMarker(t.properties.icon)}});return this.options.featureLayerPopupEnable&&s.bindPopup(this.options.featureLayerPopup||this.defaultFeatureLayerPopup),s},createWmsLayer:function(t){var e=t.url,r=t.opacity,i=t.subLayers;return i&&"undefined"!==i&&"null"!==i||(i="0"),wo().tileLayer.wms(e,{layers:i,format:"image/png",transparent:!0,noWrap:!0,opacity:r})},createVectorLayer:function(t,r){var i=t.style,s=t.opacity,n=this,a=function(t){var e=r.unproject(wo().point(t[0],t[1]));return new(wo().LatLng)(e.lat,e.lng,t[2])};if(!t.url){var o=wo().geoJSON(gc(t.features),{pointToLayer:function(t,e){var r=new(wo().Marker)(e);return r.setStyle=function(t){t&&r.setIcon(t)},r},coordsToLatLng:a,style:function(t){let e=n.cartoCSSToLeaflet.getStyleFromiPortalStyle(i||{},t.geometry.type,t.properties.style);return e&&e.dashArray&&0==e.dashArray.length&&(e.dashArray=null),e},opacity:s});return this.options.featureLayerPopupEnable&&o.bindPopup(this.options.featureLayerPopup||this.defaultFeatureLayerPopup),o}for(var l=t.url,h=t.name,u=t.features,c=0;c<u.length;c++){var d=u[c];d.visible&&this.getFeaturesBySQL(l,h,d.name,"",e.GEOJSON,t=>{var e=wo().geoJSON(t.result,{pointToLayer:function(t,e){var r=new(wo().Marker)(e);return r.setStyle=function(t){t&&r.setIcon(t)},r},coordsToLatLng:a,style:function(t){return this.cartoCSSToLeaflet.getStyleFromiPortalStyle(i||{},t.geometry.type,t.properties.style)},opacity:s});this.options.featureLayerPopupEnable&&e.bindPopup(n.options.featureLayerPopup||n.defaultFeatureLayerPopup),this.addLayer(e)})}},getFeaturesBySQL:function(t,e,r,i,s,n){var a=new Hr({queryParameter:{name:r+"@"+e,attributeFilter:i=i||"SMID > 0"},datasetNames:[e+":"+r],fromIndex:0,toIndex:1e5});Qc(t).getFeaturesBySQL(a,n,s)},createThemeLayer:function(t){var e,r=t.themeSettings&&JSON.parse(t.themeSettings),i=r.type;if(t.themeSettings=r,(e="HEAT"===i?this.createHeatLayer(t,r):"UNIQUE"===i?this.createUniqueLayer(t,r):"RANGE"===i?this.createRangeLayer(t,r):this.createBaseThemeLayer(t,r))&&(this.addFeature2ThemeLayer(t,e),e.on("add",t=>{this.registerThemeEvent(t.target)})),r&&r.labelField){var s=this.createLabelLayer(t,r);s.on("add",t=>{this.registerThemeEvent(t.target)}),e.labelLayer=s}return e},createBaseThemeLayer:function(t,e){let r=t.style,i=t.opacity,s=e.vectorType,n=r.pointStyle;n.fill="LINE"!==s;var a={};a.radius=n.pointRadius,a.color=n.strokeColor,a.opacity=n.strokeOpacity,a.lineCap=n.strokeLineCap,a.weight=n.strokeWidth,a.fillColor=n.fillColor,a.fillOpacity=n.fillOpacity;var o=(t,e)=>wo().circleMarker(e,a);return n.unicode&&(o=((t,e)=>new Zc(e,n))),wo().geoJSON({type:"GeometryCollection",geometries:[]},{pointToLayer:o,opacity:i})},createUniqueLayer:function(t,e){for(var r=t.title,i=e.field,s=[],n=e.settings,a=t.isVisible,o=t.opacity,l=e.vectorType,h=0;h<n.length;h++){var u={};u.value=n[h].value,u.style=n[h].style,s.push(u)}var c=new Hc(r,{opacity:o,visibility:a});this.registerThemeEvent(c),c.style=t.style.pointStyle,c.style.fill="LINE"!==l,c.style.stroke=!0,c.themeField=i,c.styleGroups=s;var d=this;return c.on("click",function(t){if(t.target&&t.target.refDataID){var e=c.getFeatureById(t.target.refDataID);d.events.triggerEvent("uniquefeatureclicked",e,c)}}),c},createRangeLayer:function(t,e){var r=t.title,i=e.field,s=[],n=e.settings,a=t.isVisible,o=t.opacity,l=e.vectorType,h=t.style.pointStyle;h.fill="LINE"!==l;for(var u=0;u<n.length;u++){var c={};c.start=n[u].start,c.end=n[u].end,c.style=n[u].style,s.push(c)}var d=new Wc(r,{visibility:a,opacity:o});return this.registerThemeEvent(d),d.style=t.style.pointStyle,d.style.stroke=!0,d.themeField=i,d.styleGroups=s,d},createLabelLayer:function(t,e){var r,i=t.title,s=e.labelField,n=e.settings,a=t.isVisible;r=!n||n.length>0?{fillColor:"#ffffff"}:n[0].style;var o=wo().Util.extend(new Yn,r);o.fontWeight="bold",o.fontSize="14px",o.labelRect=!0,o.strokeColor=o.fillColor,o.fontColor=e.labelColor,e.labelFont&&(o.fontFamily=e.labelFont);var l=new Yc(i,{visibility:a,opacity:.7});return this.registerThemeEvent(l),l.style=o,l.themeField=s,l.styleGroups=[],l},createHeatLayer:function(t,e){let r,i=e.colors||["blue","cyan","lime","yellow","red"],s={};for(let t=0,e=i.length,r=1;t<e;t++)s[r/e]=i[t],r++;let n=e.settings[0].radius;return"åç±³"!==e.heatUnit&&"km"!==e.heatUnit||(n=1e3*e.heatRadius),e.settings[0]&&e.settings[0].featureWeight&&(r=e.settings[0].featureWeight),wo().heatLayer([],{radius:n/2,minOpacity:t.opacity,gradient:s,blur:n/2,featureWeight:r})},addFeature2ThemeLayer:function(t,r){if("FEATURE_LAYER"===t.layerType&&"THEME"===t.identifier){var i=this,s=!!t.datasourceName,n=t.cartoCSS;if(n)var a=this.getCartoCSS2Obj(n).needTransform,o=this.getCartoCSS2Obj(n).isAddFile;var l,h,u,c=t.url,d=t.credential,p=t.themeSettings,f=p.filter;if(o){var m=JSON.parse(t.datasourceName),y=this.getSQLFromFilter(f);if(c)this.getFeatureFromFileAdded(t,function(e){var s,n=[];if("EXCEL"===e.type||"CSV"===e.type)for(var o=0,l=(s=i.parseFeatureFromEXCEL.apply(i,[e.content.rows,e.content.colTitles,!1,m])).length;o<l;o++)Dc()({attr:s[o].attributes},y).length>0&&n.push(s[o]);else for(var h=0,u=(s=i.parseFeatureFromJson(e.content)).length;h<u;h++)Dc()({attr:s[h].attributes},y).length>0&&n.push(s[h]);var c=t.prjCoordSys&&t.prjCoordSys.epsgCode;a?i.changeFeatureLayerEpsgCode(c,"4326",r,n,function(t){E(t)}):E(n)},function(){});else{for(var g=[],v=t.features,b=0,S=v.length;b<S;b++){var _=v[b];if(Dc()({attr:_.attributes},y).length>0){var x=_.geometry.points[0].x,w=_.geometry.points[0].y,C=new ut(x,w),M=new Ot(C,_.attributes,_.style);g.push(M)}}E(g)}}else if(s){var A=t.datasourceName;u=(h=(l=t.subLayers&&JSON.parse(t.subLayers)).length&&l.length>0?l[0]:l)&&h.name,this.getFeaturesBySQL(t.url,A,u,p.filter,e.ISERVER,e=>{var i,s,n=e.result,o=[];if(n&&n.features){for(var l=0,h=(i=n.features).length;l<h;l++)s=Ss.fromJson(i[l]).toFeature(),o.push(s);var u=t.prjCoordSys&&t.prjCoordSys.epsgCode;a?this.changeFeatureLayerEpsgCode(u,"4326",r,o,function(t){E(t)}):E(i)}})}else{u=(h=(l=t.subLayers&&JSON.parse(t.subLayers)).length&&l.length>0?l[0]:l)&&h.name;var T=t.prjCoordSys&&t.prjCoordSys.epsgCode;this.getFeaturesBySQL(c,d,u,f,e.ISERVER,function(t){a?i.changeFeatureLayerEpsgCode(T,"4326",r,t,function(t){E(t)}):E(t)})}}function E(e){if(r&&r.labelLayer instanceof Yc&&i.addFeature2LabelLayer(r.labelLayer,e,t),wo().HeatLayer&&r instanceof wo().HeatLayer){var s=[];for(let t=0,i=e.length;t<i;t++){let i=e[t].geometry;s[t]=wo().latLng(i.y,i.x),r.options.featureWeight&&(s[t]=[s[t].lat,s[t].lng,parseFloat(e[t].attributes[r.options.featureWeight])])}r.setLatLngs(s)}else r instanceof wo().GeoJSON?r.addData((new Nt).toGeoJSON(e)):r.addFeatures(e)}},addFeature2LabelLayer:function(t,e,r){if(e){for(var i,s,n=r.themeSettings,a=(n="string"==typeof n?JSON.parse(r.themeSettings):r.themeSettings).labelField,o=t.style,l=[],h=r.styleString&&JSON.parse(r.styleString),u=0;u<e.length;u++){s=this.getLabelLngLat(n.vectorType,e[u]),this.setLabelOffset(n.vectorType,h,e[u],o);var c=e[u].attributes;i=new Vc([s.lat,s.lng,c[a]],c),l.push(i)}t.style=o,t.addFeatures(l)}},setLabelOffset:function(t,e,r,i){if("POINT"===t){var s=e.pointStyle.pointRadius||0,n=e.pointStyle.strokeWidth||0,a=parseInt(e.pointStyle.fontSize)||0;i.labelXOffset=0,i.labelYOffset=e.pointStyle.unicode?20+a:25+(s+n)}},getLabelLngLat:function(t,e){var r={};if("POINT"===t){var i=e.geometry;r.lng=i.x,r.lat=i.y}else if("LINE"===t){var s,n,a=e.geometry.components;if(a[0].x)s=a.length,n=parseInt(s/2),r.lng=a[n].x,r.lat=a[n].y;else{var o=a[0].components;s=o.length,n=parseInt(s/2),r.lng=o[n].x,r.lat=o[n].y}}else{var l=e.geometry.getCentroid();r.lng=l.x,r.lat=l.y}return r},changeFeatureLayerEpsgCode:function(t,e,r,i,s){var n,a,o=this,l=[];if(t&&e){if(i&&i.length>0){for(n=0,a=i.length;n<a;n++){var h=i[n].geometry.getVertices();l=l.concat(h)}t="EPSG:"+t,e="EPSG:"+e,o.coordsTransform(t,e,l,function(t,e){return function(t){var r=t.length;for(n=0;n<r;n++){var i=l[n],a=t[n];i.x=a.x,i.y=a.y,i.calculateBounds()}for(n=0,r=e.length;n<r;n++){var h=e[n].geometry;h.components&&o.calculateComponents(h.components),h.calculateBounds()}s&&s.call(o,e)}}(0,i))}return!0}},calculateComponents:function(t){if(t)if(t.components)this.calculateComponents(t.components);else for(var e=0,r=t.length;e<r;e++){var i=t[e];i.components&&this.calculateComponents(i.components),i.calculateBounds()}},coordsTransform:function(t,e,r,i){var s,n=this.SERVER_TYPE_MAP[t],a=this.SERVER_TYPE_MAP[e];if(t!==e&&n&&a){var o=this.SERVER_TYPE_MAP["EPSG:3857"],l=this.SERVER_TYPE_MAP["EPSG:4326"];if(n!==o&&n!==l||a!==o&&a!==l){var h=n+"_"+a;this.postTransform(h,r,i)}else this.projTransform(t,e,r,i)}else{if(r&&void 0!==r.length){s=[];for(var u=0,c=r.length;u<c;u++){var d={x:r[u].x,y:r[u].y};s.push(d)}}else s={x:r.x,y:r.y};i&&i.call(this,s)}},projTransform:function(t,e,r,i){var s;if(Qu){if(r&&void 0!==r.length){s=[];for(var n=0,a=r.length;n<a;n++){var o=Qu(t,e,[r[n].x,r[n].y]);s.push({x:o[0],y:o[1]})}}else s={x:(s=Qu(t,e,[r.x,r.y]))[0],y:s[1]};i&&(this.fire("coordconvertsuccess",{newCoor:s}),i.call(this,s))}},postTransform:function(t,e,r){var i=[];if(!t)return r.call(this,null);if(e&&void 0!==e.length)for(var s=0,n=e.length;s<n;s++)i.push({x:e[s].x,y:e[s].y});else i=[{x:e.x,y:e.y}];if(0===i.length)return r.call(this,null);var a={convertType:t,points:i},o=this.server+"/apps/viewer/coordconvert.json";a=JSON.stringify(a);var l={};!rt.isInTheSameDomain(o)&&this.proxy&&(l.proxy=this.proxy),zt.post(o,a,l).then(t=>t.json()).then(t=>{var i=t;e||void 0===e.length||(i=i[0]),this.fire("coordconvertsuccess",{newCoors:i}),r.call(this,i)}).catch(t=>{this.actived&&this.fire("coordconvertfailed",{err:t})})},getSQLFromFilter:function(t){return t?" *  where ("+(t=t.replace(/=/g,"==").replace(/and|AND/g,"&&").replace(/or|OR/g,"||").replace(/>==/g,">=").replace(/<==/g,"<="))+")":" * where (1==1||1>=0)"},getAttributesObjFromTable:function(t,e){if(0!==t.length&&0!==e.length){for(var r=[],i=0;i<t.length;i++){for(var s={},n=0;n<e.length;n++)s[e[n]]=t[i][n];r.push(s)}return r}},parseFeatureFromEXCEL:function(t,e,r,i){for(var s=this.getAttributesObjFromTable(t,e),n=[],a=0,o=s.length;a<o;a++){var l=s[a][i.lon],h=s[a][i.lat];if(l&&h){l=parseFloat(l),h=parseFloat(h);var u,c=new ut(l,h);u=r?new zc(c,s[a],null):new Ot(c,s[a],null),n.push(u)}}return n},parseFeatureFromJson:function(t){var e=new Nt,r=e.read(t);if(null==r){var i=JSON.parse(t.replace(/'/,'"'));(i.isAnalyseResult||"MapEditor"===i.type||"DataInsights"===i.type||"ISERVER"===i.type)&&(i=i.data.recordsets[0].features),r=(e=new Nt).read(i)}for(var s=0,n=r.length;s<n;s++)r[s].attributes=r[s].attributes.properties||r[s].attributes;return r},getFeatureFromFileAdded:function(t,e,r,i){var s=i?t.url+"?currentPage=1&&pageSize=9999999":t.url;zt.get(s).then(t=>t.json()).then(t=>{e&&e(t)}).catch(t=>r&&r(t))},getCartoCSS2Obj:function(t){var e,r=!1;return t.indexOf("}")>-1?(r=(t=JSON.parse(t)).needTransform,e=t.isAddFile):"needTransform"===t?(r=!0,e=!1):e="true"===t,{isAddFile:e,needTransform:r}},registerThemeEvent:function(t){t.on("click",e=>{if(!t.map)return;let r;this.selectedFeature&&(this.fire("featureunselected",{feature:this.selectedFeature}),this.selectedFeature=null),e.target&&e.target.refDataID&&(r=t.getFeatureById(e.target.refDataID)),r&&(this.selectedFeature=r,this.fire("featureselected",{feature:r}))}),t.on("mousemove",e=>{if(t.map&&e.target&&e.target.refDataID){let r;e.target&&e.target.refDataID&&(r=t.getFeatureById(e.target.refDataID)),r&&this.fire("featuremousemove",{feature:r})}})},SERVER_TYPE_MAP:{"EPSG:4326":"WGS84","EPSG:3857":"MERCATOR","EPSG:900913":"MERCATOR","EPSG:102113":"MERCATOR","EPSG:910101":"GCJ02","EPSG:910111":"GCJ02MERCATOR","EPSG:910102":"BD","EPSG:910112":"BDMERCATOR"}}),$c=wo().TileLayer.extend({options:{collectionId:null,sqlFilter:null,ids:null,names:null,renderingRule:null,format:"png",zoomOffset:1,transparent:!0,cacheEnabled:!0,tileProxy:null,attribution:$u.Common.attribution,subdomains:null},initialize:function(t,e){this._url=t,wo().TileLayer.prototype.initialize.apply(this,arguments),wo().setOptions(this,e),wo().stamp(this)},onAdd:function(t){wo().TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._getLayerUrl()+"&z="+this._getZoomForUrl()+"&x="+t.x+"&y="+t.y;return this.options.tileProxy&&(e=this.options.tileProxy+encodeURIComponent(e)),this.options.cacheEnabled||(e+="&_t="+(new Date).getTime()),this.options.subdomains&&(e=wo().Util.template(e,{s:this._getSubdomain(t)})),e},_getLayerUrl:function(){return this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let t=rt.urlPathAppend(this._url,`/collections/${this.options.collectionId}/tile.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),t=rt.urlAppend(t,xo.Util.getParamString(this.requestParams)),t=Vt.appendCredential(t),this._layerUrl=t,t},_getAllRequestParams:function(){var t=this.options||{},e={};return e.transparent=!0===t.transparent,e.cacheEnabled=!(!1===t.cacheEnabled),t.sqlFilter&&(e.sqlFilter=t.sqlFilter),t.renderingRule&&(e.renderingRule=JSON.stringify(t.renderingRule)),t.ids&&(e.ids=t.ids.join(",")),t.names&&(e.names=t.names.join(",")),e}});class td{constructor(t,e,r){this.MapService=t,this.url=e,this.options=r,this.CLASS_NAME="SuperMap.InitMapServiceBase"}createMapService(){const t=this.MapService,e=this.url,r=this.options;return new t(e,{proxy:r.proxy,withCredentials:r.withCredentials,crossOrigin:r.crossOrigin,headers:r.headers,projection:r.projection})}getMapInfo(t){return new Promise((e,r)=>{this.createMapService().getMapInfo(i=>{t(i,e,r)})})}getWKT(){return new Promise((t,e)=>{this.createMapService().getWKT(r=>{try{const i=r.result.data;t(i)}catch(t){e(t)}})})}}function ed(t){return"PCS_NON_EARTH"===t}function rd(t){const{type:e,epsgCode:r}=t;return"PCS_NON_EARTH"==e?"":"EPSG:"+r}function id(t,e){const{maxZoom:r=22}=e||{},{bounds:i,prjCoordSys:s,dpi:n,visibleScales:a,coordUnit:o}=t,l=zn(a,i,n,o,r);if(ed(s.type))return function(t){let e={bounds:wo().bounds([t.left,t.bottom],[t.right,t.top]),origin:wo().point(t.left,t.top)};return new mc(e)}(i);const h=rd(s);return sd(h)?function(t,{bounds:e,dpi:r,resolutions:i}){const s=Qu(t,"EPSG:4326").forward([e.left,0],!0),n=Qu(t,"EPSG:4326").forward([e.right,0],!0);let a={wrapLng:[parseInt(s[0]),parseInt(n[0])],bounds:wo().bounds([e.left,e.bottom],[e.right,e.top]),origin:[e.left,e.top],dpi:r};i&&i.length>0&&(a.resolutions=i);return new Zu(t,a)}(h,{bounds:i,dpi:n,resolutions:l}):void 0}function sd(t,e=!0){try{Qu(t)}catch(r){return e&&console.error(`The projection of ${t} is missing, please register the projection of ${t} first, refer to the documentation: https://iclient.supermap.io/web/introduction/leafletDevelop.html#multiProjection`),!1}return!0}var nd=tc.extend({options:{geometry:null,prjCoordSys:null,excludeField:null},initialize:function(t,e){e=e||{},wo().setOptions(this,e),e.projection&&(this.options.prjCoordSys=e.projection),tc.prototype.initialize.call(this,t,e),this.dataFlow=new Ge(t,e),this.dataFlow.events.on({broadcastSocketConnected:this._defaultEvent,broadcastSocketError:this._defaultEvent,broadcastFailed:this._defaultEvent,broadcastSucceeded:this._defaultEvent,subscribeSocketConnected:this._defaultEvent,subscribeSocketError:this._defaultEvent,messageSucceeded:this._defaultEvent,setFilterParamSucceeded:this._defaultEvent,scope:this})},initBroadcast:function(){return this.dataFlow.initBroadcast(),this},broadcast:function(t){this.dataFlow.broadcast(t)},initSubscribe:function(){return this.dataFlow.initSubscribe(),this},setExcludeField:function(t){return this.dataFlow.setExcludeField(t),this.options.excludeField=t,this},setGeometry:function(t){return this.dataFlow.setGeometry(t),this.options.geometry=t,this},unSubscribe:function(){this.dataFlow.unSubscribe()},unBroadcast:function(){this.dataFlow.unBroadcast()},_defaultEvent:function(t){this.fire(t.eventType||t.type,t)}});const ad=function(){try{return mapv}catch(t){return{}}}();var od=ad.baiduMapLayer?ad.baiduMapLayer.__proto__:Function;var ld=wo().Layer.extend({options:{attributionPrefix:null,attribution:$u.MapV.attribution},initialize:function(t,e,r){r=r||{},this.dataSet=t||{},this.mapVOptions=e||{},this.render=this.render.bind(this),wo().Util.setOptions(this,r),this.options.attributionPrefix&&(this.options.attribution=this.options.attributionPrefix+this.options.attribution),this.canvas=this._createCanvas(),wo().stamp(this)},onAdd:function(t){this._map=t;var e=this.getPane(),r=this.container=wo().DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e);r.appendChild(this.canvas);var i=t.getSize();r.style.width=i.x+"px",r.style.height=i.y+"px",this.renderer=new class extends od{constructor(t,e,r,i){super(t,r,i),od&&(i=i||{},this.init(i),this.argCheck(i),this.canvasLayer=e,this.clickEvent=this.clickEvent.bind(this),this.mousemoveEvent=this.mousemoveEvent.bind(this),this._moveStartEvent=this.moveStartEvent.bind(this),this._moveEndEvent=this.moveEndEvent.bind(this),this._zoomStartEvent=this.zoomStartEvent.bind(this),this.bindEvent())}clickEvent(t){var e=this.map.containerPointToLayerPoint([0,0]),r=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio||1,i=t.layerPoint;super.clickEvent(wo().point((i.x-e.x)/r,(i.y-e.y)/r),t)}mousemoveEvent(t){var e=t.layerPoint;super.mousemoveEvent(e,t)}bindEvent(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent)),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}destroy(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}unbindEvent(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent)),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}getContext(){return this.canvasLayer.getCanvas().getContext(this.context)}addData(t,e){var r=t;t&&t.get&&(r=t.get()),this.dataSet.add(r),this.update({options:e})}update(t){var e=t||{},r=e.data;r&&r.get&&(r=r.get()),void 0!=r&&this.dataSet.set(r),super.update({options:e.options})}getData(){return this.dataSet}removeData(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}clearData(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}_canvasUpdate(t){if(this.canvasLayer){var e=this,r=e.options.animation,i=this.getContext(),s=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(i);"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else this.clear(i);if("2d"===this.context)for(var n in e.options)i[n]=e.options[n];else i.clear(i.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&s.getZoom()<e.options.minZoom||e.options.maxZoom&&s.getZoom()>e.options.maxZoom)){var a=s.getBounds(),o=a.getEast()-a.getWest(),l=a.getNorth()-a.getSouth(),h=s.getSize(),u=o/h.x,c=l/h.y,d=bc("DEGREE")*u,p=this.canvasLayer.getTopLeft(),f=s.latLngToAccurateContainerPoint(p),m={transferCoordinate:function(t){var r,i={x:(r="2d"===e.context?s.latLngToAccurateContainerPoint(wo().latLng(t[1],t[0])):{x:(t[0]-p.lng)/u,y:(p.lat-t[1])/c}).x-f.x,y:r.y-f.y};return[i.x,i.y]}};void 0!==t&&(m.filter=function(e){var i=r.trails||10;return t&&e.time>t-i&&e.time<t});var y=e.dataSet.get(m);this.processData(y);var g=s.latLngToContainerPoint(wo().latLng(0,0)),v={x:g.x-f.x,y:g.y-f.y};"m"===e.options.unit?(e.options.size&&(e.options._size=e.options.size/d),e.options.width&&(e.options._width=e.options.width/d),e.options.height&&(e.options._height=e.options.height/d)):(e.options._size=e.options.size,e.options._height=e.options.height,e.options._width=e.options.width),this.drawContext(i,y,e.options,v),e.options.updateCallback&&e.options.updateCallback(t)}}}init(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}addAnimatorEvent(){}moveStartEvent(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}moveEndEvent(){this.canvasLayer.draw(),this._show()}zoomStartEvent(){this._hide()}clear(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}_hide(){this.canvasLayer.canvas.style.display="none"}_show(){this.canvasLayer.canvas.style.display="block"}draw(){this.canvasLayer.draw()}}(t,this,this.dataSet,this.mapVOptions),this.draw(),this.fire("loaded")},onRemove:function(){wo().DomUtil.remove(this.container),this.renderer.destroy()},addData:function(t,e){this.renderer.addData(t,e)},update:function(t){this.renderer.update(t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},draw:function(){return this._reset()},setZIndex:function(t){this.canvas.style.zIndex=t},render:function(){this.renderer._canvasUpdate()},getCanvas:function(){return this.canvas},getContainer:function(){return this.container},getTopLeft:function(){var t,e=this._map;e&&(t=e.getBounds().getNorthWest());return t},_createCanvas:function(){var t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600;var e="undefined"==typeof window?{}:window,r=this.devicePixelRatio=e.devicePixelRatio||1;return this.mapVOptions.context&&"2d"!==this.mapVOptions.context||t.getContext("2d").scale(r,r),t},_resize:function(){var t=this.canvas;if(t){var e=this._map,r=e.getSize();"heatmap"===this.mapVOptions.draw?(t.width=parseInt(r.x)*this.devicePixelRatio,t.height=parseInt(r.y)*this.devicePixelRatio):(t.width=parseInt(r.x),t.height=parseInt(r.y)),t.style.width=r.x+"px",t.style.height=r.y+"px";var i=e.getBounds(),s=e.latLngToLayerPoint(i.getNorthWest());wo().DomUtil.setPosition(t,s)}},_reset:function(){this._resize(),this._render()},redraw:function(){this._resize(),this._render()},_render:function(){this.render()}}),hd=ld.extend({initialize:function(t,e){e=e||{},wo().Util.setOptions(this,e),this.data=[],this.mapVOptions={draw:"simple"},ld.prototype.initialize.call(this,new window.mapv.DataSet([]),this.mapVOptions,e),this.idCache={},this.url=t,this._last=new Date,this._imageCache={}},onMessageSuccessed:function(t){const e=t.featureResult.properties.id,r=t.featureResult.geometry,i={geometry:t.featureResult.geometry};if("Point"===r.type&&this.options.pointToLayer){const s=this.options.pointToLayer(t.featureResult,wo().latLng(r.coordinates[1],r.coordinates[0]));if(s instanceof wo().Marker){this.mapVOptions.draw="icon";let n=s.options.icon;const a=`${n._getIconUrl("icon")}_${n.options.iconSize?n.options.iconSize[0]:null}_${n.options.iconSize?n.options.iconSize[1]:null}`;let o=this._imageCache[a];o||(o=n.createIcon(),this._imageCache[a]=o,o.onload=(()=>{this.update({data:this.data,options:this.mapVOptions})})),i.icon=o,(n.options.iconSize||o.style.height)&&(this.mapVOptions.offset={x:0,y:-(n.options.iconSize[1]||o.style.height)/2}),this.options.deg&&(i.deg=this.options.deg,"function"==typeof i.deg&&this.idCache[e]&&this.data[this.idCache[e]]&&(i.deg=i.deg(t.featureResult,wo().latLng(r.coordinates[1],r.coordinates[0]),this.data[this.idCache[e]])))}if(s instanceof wo().CircleMarker){this.mapVOptions.draw="simple";const t=this._toMapvStyle(s);for(const e in t)t.hasOwnProperty(e)&&(i[e]=t[e])}}else if(this.options.style){const e=this._toMapvStyle(this.options.style(t.featureResult));for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t])}void 0==this.idCache[e]?(this.data.push(i),this.idCache[e]=this.data.length-1):this.data[this.idCache[e]]=i,new Date-this._last>200&&(this._last=new Date,this.update({data:this.data,options:this.mapVOptions}))},_toMapvStyle:function(t){const e={draw:"simple"};return e.strokeStyle=t.color,e.lineWidth=t.width,e.globalAlpha=t.fillOpacity||t.opacity,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.fillStyle=t.fillColor,e.size=t.radius,e}}),ud=wo().GeoJSON.extend({initialize:function(t,e){(e=e||{}).style&&!e.pointToLayer&&(e.pointToLayer=function(t,r){return wo().circleMarker(r,e.style())}),wo().Util.setOptions(this,e),this._layers={},wo().stamp(this),this.url=t,this.idCache={}},onMessageSuccessed:function(t){const e=t.featureResult,r=t.featureResult.properties[this.options.idField];let i=null;void 0!==r&&this.idCache[r]?(i=this.getLayer(this.idCache[r]),this._updateLayerData(i,e)):((i=wo().GeoJSON.geometryToLayer(e,this.options)).feature=wo().GeoJSON.asFeature(e),this.addLayer(i),void 0!==r&&(this.idCache[r]=this.getLayerId(i))),this.options.onEachFeature&&this.options.onEachFeature(e,i)},_updateLayerData:function(t,e){e.properties&&(t.feature.properties=e.properties);var r=[];switch(e.geometry.type){case"Point":r=wo().GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(r);break;case"LineString":r=wo().GeoJSON.coordsToLatLngs(e.geometry.coordinates,0),t.setLatLngs(r);break;case"MultiLineString":case"Polygon":r=wo().GeoJSON.coordsToLatLngs(e.geometry.coordinates,1),t.setLatLngs(r);break;case"MultiPolygon":r=wo().GeoJSON.coordsToLatLngs(e.geometry.coordinates,2),t.setLatLngs(r)}}}),cd=wo().LayerGroup.extend({options:{geometry:null,prjCoordSys:null,excludeField:null,idField:"id",render:"normal"},initialize:function(t,e){e=e||{},wo().Util.setOptions(this,e),this.url=t,this._layers={},this.dataService=new nd(this.url,{geometry:this.options.geometry,prjCoordSys:this.options.prjCoordSys,excludeField:this.options.excludeField})},onAdd:function(t){this.dataService.initSubscribe(),this.dataService.on("subscribeSocketConnected",t=>this.fire("subscribesucceeded",t)),this.dataService.on("subscribeSocketError",t=>this.fire("subscribefailed",t)),this.dataService.on("messageSucceeded",t=>this._onMessageSuccessed(t)),this.dataService.on("setFilterParamSucceeded",t=>this.fire("setfilterparamsucceeded",t)),"mapv"===this.options.render?this.addLayer(new hd(this.url,this.options)):this.addLayer(new ud(this.url,this.options)),wo().LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){wo().LayerGroup.prototype.onRemove.call(this,t),this.dataService&&this.dataService.unSubscribe()},setExcludeField:function(t){return this.dataService.setExcludeField(t),this.options.excludeField=t,this},setGeometry:function(t){return this.dataService.setGeometry(t),this.options.geometry=t,this},_onMessageSuccessed:function(t){this.getLayers().map(e=>(e.onMessageSuccessed&&(e.onMessageSuccessed(t),this.fire("dataupdated",{layer:e,data:t.featureResult})),e))}});const dd=wo().Layer.extend({includes:[],_echartsContainer:null,_map:null,_ec:null,_echartsOptions:null,options:{attribution:$u.ECharts.attribution,loadWhileAnimating:!1},initialize:function(t,e){wo().Util.setOptions(this,e),this.setOption(t)},setOption:function(t,e,r){const i=t.baseOption||t;i.LeafletMap=i.LeafletMap||{roam:!0},i.animation=!0===i.animation,this._echartsOptions=t,this._ec&&this._ec.setOption(t,e,r)},getEcharts:function(){return this._ec},_disableEchartsContainer:function(){this._echartsContainer.style.visibility="hidden"},_enableEchartsContainer:function(){this._echartsContainer.style.visibility="visible"},onAdd:function(t){this._map=t,this._initEchartsContainer(),this._ec=Ua.init(this._echartsContainer),this._ec.leafletMap=t;const e=this;t.on("zoomstart",function(){e._disableEchartsContainer()}),!e.options.loadWhileAnimating&&t.on("movestart",function(){e._disableEchartsContainer()}),Ua.registerAction({type:"LeafletMapLayout",event:"LeafletMapLayout",update:"updateLayout"},function(t){}),Ua.registerCoordinateSystem("leaflet",pd),Ua.extendComponentModel({type:"LeafletMap",getBMap:function(){return this.__LeafletMap},defaultOption:{roam:!1}}),Ua.extendComponentView({type:"LeafletMap",render:function(t,r,i){let s=!0,n=r.scheduler.ecInstance.leafletMap;const a=i.getZr().painter.getViewportRoot(),o=n.options.zoomAnimation&&wo().Browser.any3d;a.className=" leaflet-layer leaflet-zoom-"+(o?"animated":"hide")+" echarts-layer";const l=wo().DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);a.style[l]="50% 50%";const h=t.coordinateSystem,u=i.getZr().painter.getLayers();md(e._map,a);const c=function(){if(s)return;const r=md(e._map,a);if(!e.options.loadWhileAnimating){for(let t in u)u.hasOwnProperty(t)&&u[t]&&(n=u[t].ctx)&&n.clearRect&&n.clearRect(0,0,n.canvas.width,n.canvas.height);e._enableEchartsContainer()}var n;h.setMapOffset(r),t.__mapOffset=r,i.dispatchAction({type:"LeafletMapLayout"})};function d(){s||(i.dispatchAction({type:"LeafletMapLayout"}),e._enableEchartsContainer())}e._oldMoveHandler&&n.off(e.options.loadWhileAnimating?"move":"moveend",e._oldMoveHandler),e._oldZoomEndHandler&&n.off("zoomend",e._oldZoomEndHandler),n.on(e.options.loadWhileAnimating?"move":"moveend",c),n.on("zoomend",d),e._oldMoveHandler=c,e._oldZoomEndHandler=d,s=!1}}),this._ec.setOption(this._echartsOptions)},onRemove:function(){this._ec.clear(),this._ec.dispose(),delete this._ec,wo().DomUtil.remove(this._echartsContainer),this._oldZoomEndHandler&&(this._map.off("zoomend",this._oldZoomEndHandler),this._oldZoomEndHandler=null),this._oldMoveHandler&&(this._map.off(this.options.loadWhileAnimating?"move":"moveend",this._oldMoveHandler),this._oldMoveHandler=null),this._resizeHandler&&(this._map.off("resize",this._resizeHandler),this._resizeHandler=null),delete this._map},_initEchartsContainer:function(){const t=this._map.getSize(),e=document.createElement("div");e.style.position="absolute",e.style.height=t.y+"px",e.style.width=t.x+"px",e.style.zIndex=10,this._echartsContainer=e,this.getPane().appendChild(this._echartsContainer);const r=this;function i(t){let e=t.newSize;r._echartsContainer.style.width=e.x+"px",r._echartsContainer.style.height=e.y+"px",r._ec.resize()}this._map.on("resize",i),this._resizeHandler=i}});function pd(t){this._LeafletMap=t,this.dimensions=["lng","lat"],this._mapOffset=fd(t)}function fd(t){const e=t.containerPointToLayerPoint([0,0]);return[e.x||0,e.y||0]}function md(t,e){const r=fd(t);return e.style.left=r[0]+"px",e.style.top=r[1]+"px",r}pd.prototype.dimensions=["lng","lat"],pd.prototype.setMapOffset=function(t){this._mapOffset=t},pd.prototype.getBMap=function(){return this._LeafletMap},pd.prototype.prepareCustoms=function(){const t=Ua.util,e=this.getViewRect();return{coordSys:{type:"leaflet",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:t.bind(this.dataToPoint,this),size:t.bind(function(e,r){return r=r||[0,0],t.map([0,1],function(t){const i=r[t],s=e[t]/2,n=[],a=[];return n[t]=i-s,a[t]=i+s,n[1-t]=a[1-t]=r[1-t],Math.abs(this.dataToPoint(n)[t]-this.dataToPoint(a)[t])},this)},this)}}},pd.prototype.dataToPoint=function(t){null===t[1]&&(t[1]=wo().CRS.EPSG3857.projection.MAX_LATITUDE);const e=this._LeafletMap.latLngToLayerPoint([t[1],t[0]]),r=this._mapOffset;return[e.x-r[0],e.y-r[1]]},pd.prototype.fixLat=function(t){return t>=90?89.99999999999999:t<=-90?-89.99999999999999:t},pd.prototype.pointToData=function(t){let e=this._mapOffset,r=this._LeafletMap.layerPointToLatLng([t[0]+e[0],t[1]+e[1]]);return[r.lng,r.lat]},pd.prototype.getViewRect=function(){const t=this._LeafletMap.getSize();return new Ua.graphic.BoundingRect(0,0,t.x,t.y)},pd.prototype.getRoamTransform=function(){return Ua.matrix.create()},pd.dimensions=pd.prototype.dimensions,pd.create=function(t){let e,r=t.scheduler.ecInstance.leafletMap;t.eachComponent("LeafletMap",function(t){e||(e=new pd(r)),t.coordinateSystem=e,t.coordinateSystem.setMapOffset(t.__mapOffset||fd(r))}),t.eachSeries(function(t){"leaflet"===t.get("coordinateSystem")&&(e||(e=new pd(r)),t.coordinateSystem=e,t.animation=!0===t.animation)})};function yd(t){var e=document.createElement("canvas");return e&&e.getContext(t)}var gd=wo().Class.extend({options:{radius:10,angele:60,spaceAngle:0,count:3,fill:!1,stroke:!0,color:"#3388ff",weight:1,lineCap:"round",lineJoin:"round",fillColor:"#66ccff",fillOpacity:.2,fillRule:"evenodd",opacity:1,strokeWidth:1},initialize:function(t){t=t||{},wo().Util.setOptions(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=2*(this.options.radius+this.options.weight),this._canvas.height=2*(this.options.radius+this.options.weight),this._ctx=this._canvas.getContext("2d");var e=void 0===this.options.strokeWidth?1:this.options.strokeWidth;this.options.width=2*(this.options.radius+e)+1,this._initStyle()},getStyle:function(){return this._canvas},drawSector:function(t,e,r,i,s,n){s=s/180*Math.PI,n=n/180*Math.PI,t.moveTo(e,r),t.lineTo(e+i*Math.cos(s),r+i*Math.sin(s)),t.arc(e,r,i,s,n),t.lineTo(e,r)},_initStyle:function(){var t=0,e=this.options,r=e.angle;if(e.spaceAngle=360/e.count-e.angle,!(e.spaceAngle<0)){this._ctx.beginPath(),this.anchor=[e.width/2,e.width/2];for(var i=0;i<e.count;i++)this.drawSector(this._ctx,this.anchor[0],this.anchor[1],e.radius,t,r),r=(t=r+e.spaceAngle)+e.angle;this._fillStroke()}},_fillStroke:function(){var t=this.options;t.fill&&(this._ctx.globalAlpha=t.fillOpacity,this._ctx.fillStyle=t.fillColor||t.color,this._ctx.fill(t.fillRule||"evenodd")),t.stroke&&0!==t.weight&&(this._ctx.globalAlpha=t.opacity,this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color,this._ctx.lineCap=t.lineCap,this._ctx.lineJoin=t.lineJoin,this._ctx.stroke())}}),vd=wo().Class.extend({options:{stroke:!0,color:"#3388ff",weight:1,opacity:1,lineCap:"round",lineJoin:"round",fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",radius:3},initialize:function(t){t=t||{},wo().Util.setOptions(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=2*(this.options.radius+this.options.weight),this._canvas.height=2*(this.options.radius+this.options.weight),this._ctx=this._canvas.getContext("2d"),this._initStyle()},getCanvas:function(){return this._canvas},getStyle:function(){return this._canvas},_initStyle:function(){this._ctx.beginPath(),this._ctx.arc(this._canvas.width/2,this._canvas.height/2,this.options.radius,0,2*Math.PI),this._fillStroke()},_fillStroke:function(){var t=this.options;t.fill&&(this._ctx.globalAlpha=t.fillOpacity,this._ctx.fillStyle=t.fillColor||t.color,this._ctx.fill(t.fillRule||"evenodd")),t.stroke&&0!==t.weight&&(this._ctx.globalAlpha=t.opacity,this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color,this._ctx.lineCap=t.lineCap,this._ctx.lineJoin=t.lineJoin,this._ctx.stroke())}}),bd=wo().Class.extend({options:{img:null,origin:[0,0],anchor:null,size:null},initialize:function(t){t=t||{},wo().Util.setOptions(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=2*(this.options.radius+this.options.weight),this._canvas.height=2*(this.options.radius+this.options.weight),this._ctx=this._canvas.getContext("2d")},getStyle:function(){return this.options}});const Sd=wo().Util.falseFn;var _d=wo().Class.extend({initialize:function(t,e){this.layer=t,e=e||{},wo().Util.setOptions(this,e)},getRenderer:function(){return this.options.renderer},update:function(){this.getRenderer()._clear(),this.getRenderer()._draw()},_getGraphicAtPoint:function(t){const e=this.layer,r=e._map;let i=e._getGraphicsInBounds();for(let e=i.length-1;e>=0;e--){let s,n,a;const o=r.latLngToLayerPoint(i[e].getLatLng());let l=i[e].getStyle();if(!l&&this.defaultStyle&&(l=this.defaultStyle),l.img){let t=l.img.width,e=l.img.height;l.size&&l.size[0]&&l.size[1]&&(t=l.size[0],e=l.size[1]);const r=l.anchor||[t/2,e/2];s=wo().point(o.x-r[0],o.y-r[1]),n=wo().point(s.x+t,s.y+e)}else s=wo().point(o.x-l.width/2,o.y-l.height/2),n=wo().point(o.x+l.width/2,o.y+l.height/2);if((a=wo().bounds(s,n)).contains(t))return i[e]}return null},containsPoint:function(t){return!!this._getGraphicAtPoint(t)},_handleClick:function(t){t.target=null;const e=this.layer,r=e._map,i=this._getGraphicAtPoint(r.latLngToLayerPoint(t.latlng));if(i)return this.layer._renderer._ctx.canvas.style.cursor="pointer",t.target=i,void("click"===t.type&&e.options.onClick&&e.options.onClick.call(e,i,t));this.layer._renderer._ctx.canvas.style.cursor="auto"},_clearBuffer:Sd});wo().Canvas.include({drawGraphics:function(t,e){var r=this;r._drawing&&t.forEach(function(t){var i=t.getStyle();!i&&e&&(i=e),i.img?r._drawImage.call(r,r._ctx,i,t.getLatLng()):r._drawCanvas.call(r,r._ctx,i,t.getLatLng())})},_drawCanvas:function(t,e,r){var i=e,s=this._map.latLngToLayerPoint(r),n=s.x-i.width/2,a=s.y-i.height/2,o=i.width,l=i.height;t.drawImage(i,n,a,o,l)},_drawImage:function(t,e,r){var i,s;if(e.size){var n=e.size;i=n[0],s=n[1]}else i=e.img.width,s=e.img.height;var a=this._coordinateToPoint(r),o=wo().point(a),l=wo().point(e.anchor||[i/2,s/2]);a=[o.x-l.x,o.y-l.y],t.drawImage(e.img,a[0],a[1],i,s)},_coordinateToPoint:function(t){if(!this._map)return t;var e=t;wo().Util.isArray(t)?e=wo().latLng(t[0],t[1]):t instanceof wo().LatLng&&(e=wo().latLng(t.lat,t.lng));var r=this._map.latLngToLayerPoint(e);return[r.x,r.y]}});const xd=wo().Util.falseFn,wd=function(){let t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"];for(let r=0;r<e.length;r++){let i=e[r];if(void 0!==t.style[i])return i}return e[0]}();var Cd=wo().Class.extend({initialize:function(t,e){this.layer=t;let r=e||{};wo().Util.setOptions(this,r),this.options.radius=this._pixelToMeter(this.options.radius),this._initContainer()},getRenderer:function(){return this},update:function(t){t&&t.length>-1&&(this._data=t),this._renderLayer.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,updateTriggersChanged:!0}),this._refreshData();let e=this._getLayerState();e.data=this._data||[],this._layerDefaultStyleCache=null,this._renderLayer.setNeedsRedraw(!0),this._renderLayer.setState(e)},drawGraphics:function(t){this._clearBuffer();let e=this.layer._map.getSize();this._container.width!==e.x&&(this._container.width=e.x),this._container.height!==e.y&&(this._container.height=e.y);let r=this.layer._map.getPanes().mapPane._leaflet_pos;this._container.style[wd]="translate("+-Math.round(r.x)+"px,"+-Math.round(r.y)+"px)",this._data=t||[],this._renderLayer||this._createInnerRender(),this._draw()},_initContainer:function(){this._container=this._createCanvas(this.options.width,this.options.height),this._layerContainer=this.options.container,this._wrapper=wo().DomUtil.create("div","deck-wrapper",this._layerContainer),this._wrapper.appendChild(this._container)},_createCanvas:function(t,e){let r=wo().DomUtil.create("canvas","graphicLayer  leaflet-layer leaflet-zoom-hide");return r.oncontextmenu=wo().Util.falseFn,r.width=t,r.height=e,r.style.width=t+"px",r.style.height=e+"px",r},_pixelToMeter:function(t){const e=this.layer._map.getBounds();return t*((e.getEast()-e.getWest())/this.layer._map.getSize().x*(6378137*Math.PI/180))},_createInnerRender:function(){let t=this,e=this._getLayerState(),{color:r,radius:i,opacity:s,highlightColor:n,radiusScale:a,radiusMinPixels:o,radiusMaxPixels:l,strokeWidth:h,outline:u}=e,c={id:"scatter-plot",data:t._data,pickable:Boolean(this.options.onClick)||Boolean(this.options.onHover),autoHighlight:!0,color:r,opacity:s,radius:i,radiusScale:a,highlightColor:n,radiusMinPixels:o,radiusMaxPixels:l,strokeWidth:h,coordinateSystem:this._isWGS84()?window.DeckGL.COORDINATE_SYSTEM.LNGLAT_OFFSETS:window.DeckGL.COORDINATE_SYSTEM.LNGLAT,isGeographicCoordinateSystem:this._isWGS84(),outline:u,getPosition:function(t){if(!t)return[0,0,0];let e=t.getLatLng();return e&&[e.lng,e.lat,0]},getColor:function(e){let r=t._getLayerDefaultStyle(),i=e&&e.options;return i&&i.color||r.color},getRadius:function(e){let r=t._getLayerDefaultStyle(),i=e&&e.getStyle();return i&&i.radius||r.radius},updateTriggers:{getColor:[r],getRadius:[i]}},d=this;this.options.onClick&&(c.onClick=function(){d._container.style.cursor="pointer",d.options.onClick.apply(d,arguments)}),this.options.onHover&&(c.onHover=function(){d._container.style.cursor="pointer",d.options.onHover.apply(d,arguments)}),t._renderLayer=new window.DeckGL.ScatterplotLayer(c)},_getLayerDefaultStyle:function(){if(this._layerDefaultStyleCache)return this._layerDefaultStyleCache;let{color:t,opacity:e,radius:r,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:n,strokeWidth:a,outline:o}=this.layer.options;return r=this._pixelToMeter(r),this._layerDefaultStyleCache={color:t,opacity:e,radius:r,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:n,strokeWidth:a,outline:o},this._layerDefaultStyleCache},_getLayerState:function(){let t=this.layer.getState();return t.zoom=t.zoom-1,t},_draw:function(){let t=this._getLayerState();this._refreshData(),t.data=this._data||[];let e={};for(let r in t)e[r]=t[r];this._layerDefaultStyleCache=null,this._renderLayer.setNeedsRedraw(!0),e.layers=[this._renderLayer],e.canvas=this._container,e.onBeforeRender=this._onBeforeRender.bind(this),e.onAfterRender=this._onAfterRender.bind(this),e.coordinateSystem=this._isWGS84()?window.DeckGL.COORDINATE_SYSTEM.LNGLAT_OFFSETS:window.DeckGL.COORDINATE_SYSTEM.LNGLAT,e.isGeographicCoordinateSystem=this._isWGS84(),this.deckGL?this.deckGL.setProps(e):this.deckGL=new window.DeckGL.experimental.DeckGLJS(e)},_clearBuffer:function(){if(this.deckGL){let t=this.deckGL.layerManager;t&&t.context.gl.clear(t.context.gl.COLOR_BUFFER_BIT)}return this},_refreshData:function(){let t=this._data||[],e=wo().Util.isArray(t)?[].concat(t):[t];this._renderLayer.props.data||(this._renderLayer.props.data=[]),this._renderLayer.props.data.length=0;for(let t=0;t<e.length;t++)this._renderLayer.props.data.push(e[t]);this._data=this._renderLayer.props.data},_handleClick:xd,_onBeforeRender:xd,_onAfterRender:xd,_removePath:function(){return this._wrapper.parentElement.removeChild(this._wrapper),this._container=null,this._wrapper=null,this},_initPath:xd,_addPath:xd,containsPoint:xd,_isWGS84(){return"EPSG:4326"===this.layer._map.options.crs.code}});const Md=["canvas","webgl"],Ad={color:[0,0,0,255],opacity:.8,radius:10,radiusScale:1,radiusMinPixels:0,radiusMaxPixels:Number.MAX_SAFE_INTEGER,strokeWidth:1,outline:!1},Td={"EPSG:4326":1.40625,"EPSG:3857":156543.03392804688},Ed={"EPSG:4326":1,"EPSG:3857":0};var Od=wo().Path.extend({initialize:function(t,e){this.graphics=[].concat(t);let r=e||{};r.pane="overlayPane",wo().Util.setOptions(this,r),this.options.render=this.options.render||Md[0],class{static supportWebGL(){return yd("webgl")}static supportWebGL2(){return yd("webgl2")}static supportCanvas(){return yd("2d")}}.supportWebGL2()||(this.options.render=Md[0]),this.options.interactive&&this.on("click mousemove dblclick mousedown mouseup mouseout contextmenu",this._handleClick,this)},getEvents:function(){return{resize:this._resize.bind(this),moveend:this._moveEnd.bind(this)}},onAdd:function(t){this._map=t,this._crs=t.options.crs,this.defaultStyle=this._getDefaultStyle(this.options),this._renderer=this._createRenderer(),this._container=this._renderer._container,wo().Path.prototype.onAdd.call(this)},onRemove:function(){this.off("click mousemove dblclick mousedown mouseup contextmenu",this._handleClick,this),this._renderer._removePath(this)},setGraphics:function(t){this.graphics=this.graphics||[],this.graphics.length=0;let e=wo().Util.isArray(t)?[].concat(t):[t];this.graphics=[].concat(e),this.update()},addGraphics:function(t){this.graphics=this.graphics||[];let e=wo().Util.isArray(t)?[].concat(t):[t];this.graphics=this.graphics.concat(e),this.update()},getGraphicBy(t,e){let r=null;for(let i in this.graphics)if(this.graphics[i][t]===e){r=this.graphics[i];break}return r},getGraphicById(t){return this.getGraphicBy("id",t)},getGraphicsByAttribute(t,e){var r,i=[];for(let s in this.graphics)(r=this.graphics[s])&&r.attributes&&r.attributes[t]===e&&i.push(r);return i},removeGraphics(t=null){if(!t||0===t.length||t===this.graphics)return this.graphics.length=0,void this.update();rt.isArray(t)||(t=[t]);for(let e=t.length-1;e>=0;e--){let r=t[e],i=rt.indexOf(this.graphics,r);-1!==i&&this.graphics.splice(i,1)}this.update()},setStyle:function(t){let e=this.options,r={color:e.color,radius:e.radius,opacity:e.opacity,highlightColor:e.highlightColor,radiusScale:e.radiusScale,radiusMinPixels:e.radiusMinPixels,radiusMaxPixels:e.radiusMaxPixels,strokeWidth:e.strokeWidth,outline:e.outline};this.options=wo().Util.extend(this.options,r,t),this.defaultStyle=this._getDefaultStyle(this.options),this.update()},update:function(){this._layerRenderer.update(this.graphics)},clear:function(){this.removeGraphics()},getRenderer:function(){return this._renderer},getState:function(){let t=this._map,e=t.getSize().x,r=t.getSize().y,i=t.getCenter(),s=i.lng,n=i.lat,a=Ed[this._crs.code]||0;Td[this._crs.code]&&this._crs.resolutions&&this._crs.resolutions.length>0&&(a=Math.round(Math.log2(Td[this._crs.code]/this._crs.resolutions[0])));let o={longitude:s,latitude:n,zoom:t.getZoom()+a,maxZoom:t.getMaxZoom()+a,pitch:0,bearing:0},l={};for(let t in o)l[t]=o[t];l.width=e,l.height=r;let h=this.options;return l.color=h.color,l.radius=h.radius,l.opacity=h.opacity,l.highlightColor=h.highlightColor,l.radiusScale=h.radiusScale,l.radiusMinPixels=h.radiusMinPixels,l.radiusMaxPixels=h.radiusMaxPixels,l.strokeWidth=h.strokeWidth,l.outline=h.outline,l},_resize:function(){let t=this._map.getSize();this._container.width=t.x,this._container.height=t.y,this._container.style.width=t.x+"px",this._container.style.height=t.y+"px";let e=this._map.containerPointToLayerPoint([0,0]);wo().DomUtil.setPosition(this._container,e),this._update()},_moveEnd:function(){this._layerRenderer instanceof Cd&&this._update()},_createRenderer:function(){let t,e=this._map,r=e.getSize().x,i=e.getSize().y;if(this.options.render===Md[0])t=new _d(this,{width:r,height:i,renderer:e.getRenderer(this)});else{let s=wo().Util.setOptions({},Ad),n=wo().Util.setOptions({options:s},this.options);(n=wo().Util.setOptions(this,n)).container=e.getPane("overlayPane"),n.width=r,n.height=i,t=new Cd(this,n)}return t.defaultStyle=this.defaultStyle,this._layerRenderer=t,this._layerRenderer.getRenderer()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){let t=this._getGraphicsInBounds();this._renderer.drawGraphics(t,this.defaultStyle)},_project:function(){let t=this;t._getGraphicsInBounds().map(function(e){let r=t._map.latLngToLayerPoint(e.getLatLng()),i=t._clickTolerance(),s=[e._anchor+i,e._anchor+i];return e._pxBounds=new(wo().Bounds)(r.subtract(s),r.add(s)),e}),t._pxBounds=wo().bounds(wo().point(0,0),wo().point(this._container.width,this._container.height))},_getDefaultStyle:function(t){const e={};if(t.color){e.fill=!0;const r=this.toRGBA(t.color);e.color=r,e.fillColor=r}return t.opacity&&(e.opacity=t.opacity,e.fillOpacity=t.opacity),t.radius&&(e.radius=t.radius),t.strokeWidth&&(e.weight=t.strokeWidth),t.outline&&(e.stroke=t.outline),new vd(e).getStyle()},toRGBA:t=>`rgba(${t[0]},${t[1]},${t[2]},${(t[3]||255)/255})`,_getGraphicsInBounds:function(){let t=[],e=this._map.getBounds();return this.graphics.map(function(r){return e.contains(r.getLatLng())&&t.push(r),r}),t},_handleClick:function(t){this._layerRenderer._handleClick(t)},beforeAdd:wo().Util.falseFn,_containsPoint:function(t){return this._layerRenderer.containsPoint(t)}});var Ld=Jc.extend({options:{isOverLay:!0},initialize:function(t,e,r){var i=[];i.push(t),i.push(r),Jc.prototype.initialize.apply(this,i),this.chartsType=e,this.themeFields=r&&r.themeFields?r.themeFields:null,this.charts=r&&r.charts?r.charts:[],this.cache=r&&r.cache?r.cache:{},this.chartsSetting=r&&r.chartsSetting?r.chartsSetting:{}},setChartsType:function(t){this.chartsType=t,this.redraw()},addFeatures:function(t){var e=this;e.fire("beforefeaturesadded",{features:t}),this.features=this.toiClientFeature(t),e.renderer&&(e._map?e.redrawThematicFeatures(e._map.getBounds()):e.redrawThematicFeatures())},redrawThematicFeatures:function(t){var e=this;e.renderer.clearAll();var r=e.features;if(this.options.alwaysMapCRS&&t&&t instanceof wo().LatLngBounds){var i=this._map.options.crs;t=wo().bounds(i.project(t.getSouthWest()),i.project(t.getNorthEast()))}t=nc.toSuperMapBounds(t);for(var s=0,n=r.length;s<n;s++){var a=r[s],o=a.geometry.getBounds();if(!t||t.intersectsBounds(o)){var l=e.cache,h=a.id;if(!l[h]){l[h]=h;var u=e.createThematicFeature(a),c=e.overlayWeightField&&a.attributes[e.overlayWeightField]&&!isNaN(a.attributes[e.overlayWeightField]);u&&c&&(u.__overlayWeight=a.attributes[e.overlayWeightField]),u&&e.charts.push(u)}}}e.drawCharts()},createThematicFeature:function(t){var e,r=this;return Sa[r.chartsType]&&r.themeFields&&r.chartsSetting&&(e=new Sa[r.chartsType](t,r,r.themeFields,r.chartsSetting)),!!e&&(e.assembleShapes(),e)},drawCharts:function(){var t=this;t.renderer&&(t.overlayWeightField&&t._sortChart(),t.options&&!t.options.isOverLay?t._addOverlayShape():t._addNoOverlayShape(),t.renderer.render())},getShapesByFeatureID:function(t){var e=[],r=this.renderer.getAllShapes();if(!t)return r;for(var i=0,s=r.length;i<s;i++){var n=r[i];n.refDataID&&t===n.refDataID&&e.push(n)}return e},isQuadrilateralOverLap:function(t,e){var r=t.length,i=e.length;if(5!==r||5!==i)return null;for(var s=!1,n=0;n<r;n++)if(this.isPointInPoly(t[n],e)){s=!0;break}for(let r=0;r<i;r++)if(this.isPointInPoly(e[r],t)){s=!0;break}for(let n=0;n<r-1&&!s;n++)for(let r=0;r<i-1;r++){if("SuperMap.Geometry.Point"===rt.lineIntersection(t[n],t[n+1],e[r],e[r+1]).CLASS_NAME){s=!0;break}}return s},isPointInPoly:function(t,e){for(var r=!1,i=-1,s=e.length,n=s-1;++i<s;n=i)(e[i].y<=t.y&&t.y<e[n].y||e[n].y<=t.y&&t.y<e[i].y)&&t.x<(e[n].x-e[i].x)*(t.y-e[i].y)/(e[n].y-e[i].y)+e[i].x&&(r=!r);return r},isChartInMap:function(t,e){for(var r=t,i=!1,s=0,n=e.length;s<n;s++){var a=e[s];if(a.x>=r.left&&a.x<=r.right&&a.y>=r.top&&a.y<=r.bottom){i=!0;break}}return i},clearCache:function(){this.cache={},this.charts=[]},removeFeatures:function(t){this.clearCache(),Jc.prototype.removeFeatures.call(this,t)},removeAllFeatures:function(){this.clearCache(),Jc.prototype.removeAllFeatures.apply(this,arguments)},redraw:function(){return this.clearCache(),Jc.prototype.redraw.apply(this,arguments)},clear:function(){var t=this;t.renderer&&(t.renderer.clearAll(),t.renderer.refresh()),t.removeAllFeatures(),t.clearCache()},getWeightFieldValue:function(t,e,r){if((void 0===r||isNaN(r))&&(r=0),!t.attributes)return r;var i=t.attributes[e];return(void 0===i||isNaN(i))&&(i=r),i},_sortChart:function(){this.charts&&this.charts.sort(function(t,e){return void 0===t.__overlayWeight&&void 0===e.__overlayWeight?0:void 0!==t.__overlayWeight&&void 0===e.__overlayWeight?-1:void 0===t.__overlayWeight&&void 0!==e.__overlayWeight?1:void 0!==t.__overlayWeight&&void 0!==e.__overlayWeight?parseFloat(t.__overlayWeight)<parseFloat(e.__overlayWeight)?1:-1:0})},_addOverlayShape:function(){for(var t=this.charts,e=0,r=t.length;e<r;e++)for(var i=t[e],s=i.resetLocation(),n=i.shapes,a=0,o=n.length;a<o;a++)n[a].refOriginalPosition=s,this.renderer.addShape(n[a])},_addNoOverlayShape:function(){var t=this,e=t._map.getBounds(),r=this._map.options.crs;this.options.alwaysMapCRS&&(e=wo().bounds(r.project(e.getSouthWest()),r.project(e.getNorthEast()))),e=nc.toSuperMapBounds(e);for(var i=t.charts,s=[],n=t.getLocalXY(new nt(e.left,e.top)),a=t.getLocalXY(new nt(e.right,e.bottom)),o=new at(n[0],a[1],a[0],n[1]),l=0,h=i.length;l<h;l++){var u=i[l],c=u.resetLocation(),d=u.chartBounds,p=[{x:d.left,y:d.top},{x:d.left,y:d.bottom},{x:d.right,y:d.bottom},{x:d.right,y:d.top},{x:d.left,y:d.top}];if(!o||t.isChartInMap(o,p)){var f=!1;for(let e=0;e<s.length;e++)if(t.isQuadrilateralOverLap(p,s[e])){f=!0;break}if(!f){s.push(p);var m=u.shapes;for(let e=0,r=m.length;e<r;e++)m[e].refOriginalPosition=c,t.renderer.addShape(m[e])}}}}}),Pd=Ld.extend({initialize:function(t,e,r){Ld.prototype.initialize.apply(this,arguments),this.symbolType=e,this.symbolSetting={}},setSymbolType:function(t){this.symbolType=t,this.redraw()},createThematicFeature:function(t){var e,r=this;return Sa[r.symbolType]&&r.themeField&&r.symbolSetting&&(e=new Sa[r.symbolType](t,r,[r.themeField],r.symbolSetting)),!!e&&(e.assembleShapes(),e)}}),Nd=wo().SVG.extend({initialize:function(t,e,r){wo().SVG.prototype.initialize.call(this,r),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._container.setAttribute("viewBox",[0,0,this._size.x,this._size.y].join(" ")),this._layers={}},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},onAdd:wo().Util.falseFn,addTo:function(t){if(this._map=t,this.options.interactive)for(var e in this._layers){var r=this._layers[e];r._path.style.pointerEvents="auto",this._map._targets[wo().stamp(r._path)]=r}},removeFrom:function(t){var e=t||this._map;if(this.options.interactive)for(var r in this._layers){var i=this._layers[r];delete e._targets[wo().stamp(i._path)]}delete this._map},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup||(this._rootGroup=this._container),this._rootGroup.appendChild(t._path),this._layers[wo().stamp(t)]=t},_updateIcon:function(t){var e=t._path=wo().SVG.create("image"),r=t.options,i=r.iconUrl;if(r.iconSize){var s=wo().point(r.iconSize),n=s&&s.divideBy(2,!0),a=t._point.subtract(n);e.setAttribute("x",a.x),e.setAttribute("y",a.y),e.setAttribute("width",s.x+"px"),e.setAttribute("height",s.y+"px")}else{var o=new Image;o.src=i,wo().DomEvent.on(o,"load",function(){var r=wo().point([o.width,o.height]),i=r&&r.divideBy(2,!0),s=t._point.subtract(i);e.setAttribute("x",s.x),e.setAttribute("y",s.y),e.setAttribute("width",r.x+"px"),e.setAttribute("height",r.y+"px")})}e.setAttribute("href",i)}}),Id=wo().Canvas.extend({initialize:function(t,e,r){wo().Canvas.prototype.initialize.call(this,r),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._layers={},this._drawnLayers={},this._drawing=!0,r.interactive&&(this._container.style.pointerEvents="auto")},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},getOffset:function(){return this._tileCoord.scaleBy(this._size).subtract(this._map.getPixelOrigin())},onAdd:wo().Util.falseFn,addTo:function(t){this._map=t},removeFrom:function(t){delete this._map},_updateDashArray:function(t){var e=t.options.dashArray;if(e&&"string"==typeof e){var r,i=e.split(","),s=[];for(r=0;r<i.length;r++)s.push(Number(i[r]));t.options._dashArray=s}else t.options._dashArray=e},_onClick:function(t){var e,r,i=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());for(var s in this._layers)(e=this._layers[s]).options.interactive&&e._containsPoint(i)&&!this._map._draggableMoved(e)&&(r=e);r&&(wo().DomEvent.stop(t),this._fireEvent([r],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());this._handleMouseHover(t,e)}},_updateIcon:function(t){if(this._drawing){var e=t.options,r=this._ctx,i=t._getImage();if(e.iconSize&&i.complete){var s=wo().point(e.iconSize),n=s&&s.divideBy(2,!0),a=t._point.subtract(n);r.drawImage(i,a.x,a.y,s.x,s.y)}else wo().DomEvent.on(i,"load",function(){var e=wo().point([i.width,i.height]),s=e&&e.divideBy(2,!0),n=t._point.subtract(s);r.drawImage(i,n.x,n.y,e.x,e.y)});this._drawnLayers[t._leaflet_id]=t}}}),Fd="LABEL",kd="TEXT",Dd="POINT",Rd="LINE",Bd="REGION",Gd=wo().Class.extend({initialize:function(t){this.properties=t.properties,this.type=t.type,this.layerName=t.layerName},render:function(t,e){this._renderer=t,this._container=t._container,this.options=e,t._initPath(this),t._updateStyle(this);var r=this.getElement();r&&this.layerName&&wo().DomUtil.addClass(r,this.layerName)},updateStyle:function(t,e){this.options=e,t._updateStyle(this)},getElement:function(){return this._path||this._renderer._container},_getPixelBounds:function(){for(var t=this._parts,e=wo().bounds([]),r=0;r<t.length;r++)for(var i=t[r],s=0;s<i.length;s++)e.extend(i[s]);var n=this._clickTolerance(),a=new(wo().Point)(n,n);return e.min._subtract(a),e.max._add(a),e},_clickTolerance:wo().Path.prototype._clickTolerance}),Ud=wo().Path.extend({includes:Gd.prototype,options:{color:"white",fillColor:"black",fill:!0,fillOpacity:1,opacity:.6,weight:1,rotation:0,stroke:!0,fontFamily:"Arial Unicode MS Regular",fontSize:14,fontWeight:"normal",textAlign:"center",offsetX:1,offsetY:1},initialize:function(t,e){Gd.prototype.initialize.call(this,t),this._makeFeatureParts(t,e),this.options.offsetX=e||1,this.options.offsetY=e||1},render:function(t,e){if(this.properties.texts&&(this._text=this.properties.texts[0]),!this._text){var r=this.properties.attributes;this._text=r&&this.properties.textField&&r[this.properties.textField]||""}var i=this.options;this._pxBounds=wo().bounds(this._point,this._point),Gd.prototype.render.apply(this,[t,e]),this.options=wo().Util.extend(i,e),this._updatePath()},_makeFeatureParts:function(t,e){e=e||{x:1,y:1};var r=t.geometry[0];"object"==typeof r[0]&&"x"in r[0]?(this._point=wo().point(r[0]).scaleBy(e),this._empty=wo().Util.falseFn):(this._point=wo().point(r).scaleBy(e),this._empty=wo().Util.falseFn)},makeInteractive:function(){this._updateBounds()},updateStyle:function(t,e){return this._updateBounds(),Gd.prototype.updateStyle.call(this,t,e)},_updateBounds:function(){var t=this._renderer._getTextWidth(this),e=[t/2,t/2];this._pxBounds=wo().bounds(this._point.subtract(e),this._point.add(e))},_updatePath:function(){this._renderer._updateText(this)},_containsPoint:function(t){return!1}});Id.include({_getTextWidth:function(t){return this._ctx.measureText(t._text).width},_updateText:function(t){if(this._drawing&&!t._empty()){var e=this.getContainer(),r=this._map.getSize();e.width=r.x,e.height=r.y,e.style.width=r.x+"px",e.style.height=r.y+"px";var i=this._ctx,s=t.options,n=s.offsetX||1,a=s.offsetY||1,o=t._point.subtract(wo().point(n,a));s.fill&&(this._drawnLayers[t._leaflet_id]=t,i.fillRect(0,0,r.x,r.y),i.font=[s.fontWeight?s.fontWeight:"normal",s.fontSize?s.fontSize:"14px",s.fontFamily?s.fontFamily:"Arial Unicode MS Regular,Microsoft Yahei"].join(" "),i.textAlign=s.textAlign,i.lineWidth=s.weight,i.fillStyle=s.fillColor,i.fillText(t._text,o.x,o.y),i.strokeStyle=s.color,i.strokeText(t._text,o.x,o.y),i.rotate(s.rotation))}}}),Nd.include({_getTextWidth:function(t){return t._path.getComputedTextLength()||0},_initPath:function(t){var e;Ud&&t instanceof Ud?(e=t._path=wo().SVG.create("text")).textContent=t._text:e=t._path=wo().SVG.create("path"),t.options.className&&wo().DomUtil.addClass(e,t.options.className),t.options.interactive&&wo().DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[wo().stamp(t)]=t},_updateText:function(t){var e=t._path,r=t.options,i=r.offsetX||1,s=r.offsetY||1,n=t._point.subtract(wo().point(i,s));e.setAttribute("x",n.x),e.setAttribute("y",n.y),r.rotation=r.rotation||0,e.setAttribute("transform","rotate("+r.rotation/Math.PI*180+" "+n.x+" "+n.y+")"),e.setAttribute("text-anchor","center"===r.textAlign?"middle":r.textAlign),e.style.fontSize=r.fontSize,e.style.fontFamily=r.fontFamily,e.style.fontWeight=r.fontWeight||"normal",e.style.glyphOrientationVertical=r.rotation||"",r.stroke?(e.setAttribute("stroke",r.color),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-opacity",r.opacity),e.setAttribute("stroke-width",r.weight>1?r.weight/10:r.weight)):e.setAttribute("stroke","none"),r.fill?(e.setAttribute("fill",r.fillColor||r.color),e.setAttribute("fill-opacity",r.fillOpacity)):e.setAttribute("fill","none")}});var jd=wo().CircleMarker.extend({includes:Gd.prototype,statics:{iconCache:{}},initialize:function(t,e){Gd.prototype.initialize.call(this,t),this._makeFeatureParts(t,e)},getLatLng:void 0,render:function(t,e){Gd.prototype.render.call(this,t,e),this._radius=e.radius||wo().CircleMarker.prototype.options.radius,this._updatePath()},_makeFeatureParts:function(t,e){e=e||{x:1,y:1};var r=t.geometry[0];"object"==typeof r[0]&&"x"in r[0]?(this._point=wo().point(r[0]).scaleBy(e),this._empty=wo().Util.falseFn):(this._point=wo().point(r).scaleBy(e),this._empty=wo().Util.falseFn)},makeInteractive:function(){this._updateBounds()},updateStyle:function(t,e){return this._radius=e.radius||this._radius,this._updateBounds(),Gd.prototype.updateStyle.call(this,t,e)},_updateBounds:function(){if(this.options.iconUrl&&this.options.iconSize){var t=wo().point(this.options.iconSize),e=t&&t.divideBy(2,!0),r=this._point.subtract(e);this._pxBounds=new(wo().Bounds)(r,r.add(t))}else wo().CircleMarker.prototype._updateBounds.call(this)},_updatePath:function(){this.options.iconUrl?this._renderer._updateIcon(this):wo().CircleMarker.prototype._updatePath.call(this)},_getImage:function(){if(!this.options.iconUrl)return null;var t=this.options.iconUrl,e=jd.iconCache[t];if(!e){var r=this.options.iconSize||[50,50];e=jd.iconCache[t]=this._createIcon(t,r)}return e},_createIcon:function(t,e){var r=t;if(!r)throw new Error("iconUrl not set in Icon options (see the docs).");var i=document.createElement("img");i.src=r,i.className="leaflet-marker-icon "+(this.layerName||"");var s=e;if("number"==typeof s&&(s=[s,s]),s){var n=wo().point(s),a=wo().point(n&&n.divideBy(2,!0));n&&(i.style.width=n.x+"px",i.style.height=n.y+"px"),a&&(i.style.marginLeft=-a.x+"px",i.style.marginTop=-a.y+"px")}return i.onload=function(){s||(i.style.width=this.width+"px",i.style.height=this.height+"px")},i},_containsPoint:function(t){return this.options.iconUrl?this._pxBounds.contains(t):wo().CircleMarker.prototype._containsPoint.call(this,t)}}),zd={_makeFeatureParts:function(t,e){e=e||{x:1,y:1};var r,i=t.geometry;this._parts=[];for(var s=0;s<i.length;s++){for(var n=i[s],a=[],o=0;o<n.length;o++)r=n[o],a.push(wo().point(r).scaleBy(e));this._parts.push(a)}},makeInteractive:function(){this._pxBounds=this._getPixelBounds()}},Vd=wo().Polyline.extend({includes:[Gd.prototype,zd],initialize:function(t,e){Gd.prototype.initialize.call(this,t),this._makeFeatureParts(t,e)},render:function(t,e){e.fill=!1,Gd.prototype.render.call(this,t,e),this._updatePath()},updateStyle:function(t,e){e.fill=!1,Gd.prototype.updateStyle.call(this,t,e)}}),Jd=wo().Polygon.extend({includes:[Gd.prototype,zd],initialize:function(t,e){Gd.prototype.initialize.call(this,t),this._makeFeatureParts(t,e)},render:function(t,e){Gd.prototype.render.call(this,t,e),this._updatePath()}}),qd=r(614),Hd=r.n(qd),Wd=r(929),Yd=wo().Class.extend({initialize:function(t){this.url=t},getTile:function(){var t=this;return zt.get(t.url,null,{timeout:1e4}).then(function(t){return t.ok?t.blob().then(function(t){var e=new FileReader;return new Promise(function(r){e.addEventListener("loadend",function(){var t=new(Hd())(e.result);return r(new Wd.VectorTile(t))}),e.readAsArrayBuffer(t)})}):{layers:[]}}).then(function(e){return t._processVectorTileSpec(e)})},_processVectorTileSpec:function(t){var e=[];for(var r in t.layers){for(var i=[],s=0;s<t.layers[r].length;s++){var n=t.layers[r].feature(s);switch(n.geometry=n.loadGeometry(),n.layerName=r,n.properties={attributes:wo().Util.extend({},n.properties),id:n.id},n.type){case 1:n.type=Dd;break;case 2:n.type=Rd;break;case 3:n.type=Bd}i.push(n)}var a={};a.features=i,a.layerName=r,a.extent=t.layers[r].extent,e.push(a)}return e}}),Xd=wo().Class.extend({initialize:function(t){this.url=t},getTile:function(){var t=this;return zt.get(t.url,null,{timeout:1e4}).then(function(t){return t.json()}).then(function(e){return t._processRecordSets(e,t)})},_processRecordSets:function(t,e){var r=t.recordsets;if(!(r=e._convertToGeoJSON(r)))return null;for(var i=0;i<r.length;i++){for(var s=r[i],n=0;n<s.features.length;n++){var a=s.features[n];(a=e._convertToVectorLayerFeature(a,e)).layerName=s.layerName,s.features[n]=a}s.extent=256,delete s.fieldTypes,delete s.fields}return r},_convertToVectorLayerFeature:function(t,e){if(t.geometry){var r,i,s,n,a={},o=t.geometry,l=o.type,h=o.coordinates,u=t.properties,c=u.id;if("Point"===l)a=u&&u.texts?e._createFeature(c,kd,[h],u):e._createFeature(c,Dd,[h],u);else if("MultiPoint"===l)a=e._createFeature(c,Dd,h,u);else if("LineString"===l)a=e._createFeature(c,Rd,[h],u);else if("MultiLineString"===l||"Polygon"===l){for(s=[],r=0;r<h.length;r++)n=h[r],"Polygon"===l&&(n.outer=0===r),s.push(n);var d="Polygon"===l?Bd:Rd;a=e._createFeature(c,d,s,u)}else{if("MultiPolygon"!==l)throw new Error("Illegal GeoJSON object");for(s=[],r=0;r<h.length;r++)for(i=0;i<h[r].length;i++)(n=h[r][i]).outer=0===i,s.push(n);a=e._createFeature(c,Bd,s,u)}return a}},_convertToGeoJSON:function(t){if(t){for(var e=0;e<t.length;e++){for(var r=t[e],i=0;i<r.features.length;i++){for(var s=r.features[i],n=[],a=0,o=0;o<s.geometry.parts.length;o++){for(var l=2*s.geometry.parts[o],h=0,u=a;h<l;h+=2,u+=2){var c=s.geometry.points[u],d=s.geometry.points[u+1];n.push({x:c,y:d})}a+=l}s.geometry.points=n}r.features=gc(r.features).features}return t}},_createFeature:function(t,e,r,i){return{id:t,type:e,geometry:r,properties:i}}}),Qd={JSON:"JSON",MVT:"MVT",PBF:"PBF"},Zd=wo().Class.extend({initialize:function(t,e){this.layer=t.layer,this.tileSize=t.layer.getTileSize(),this.format=t.format,this.coords=t.coords,this.renderer=t.renderer,this.done=e,this.layer._textVectorTiles={}},renderTile:function(){var t=this,e=t.layer,r=t.coords,i=e._getTileUrl(r);([Qd.MVT,Qd.PBF].indexOf(t.format.toUpperCase())>-1?new Yd(i):new Xd(i)).getTile().then(function(e){t.render(e,r)})},render:function(t,e){if(t){for(var r=this,i=r.renderer,s=r.layer,n=0;n<t.length;n++){var a=t[n],o=a.layerName;s._dataLayerNames[o]=!0;for(var l=r.tileSize.divideBy(a.extent),h=s.getLayerStyleInfo(a.layerName),u=0;u<a.features.length;u++){var c=a.features[u];if(c){h&&h.type===Fd&&c.type===Dd&&c.properties.attributes&&(c.type=kd);var d=r._getStyleOptions(e,c,o,r);if(d.length){var p=r._createFeatureLayer(c,l);if(p){var f={scope:r,coords:e,renderer:i};if(!r._extractTextLayer(c,p,d,f)){for(var m=0;m<d.length;m++){var y=r._validateStyle(d[m],c.type);p.render(i,y),i._addPath(p)}s.options.interactive&&p.makeInteractive();var g=s._getFeatureKey(c.id,o);i._features[g]={layerName:o,feature:p}}}}}}}s._map&&i.addTo(s._map),wo().Util.requestAnimFrame(r.done.bind(e,null,r.layer._vectorTiles[r.layer._tileCoordsToKey(e)]))}},_extractTextLayer:function(t,e,r,i){if(t.type!==kd)return!1;var s=i.scope,n=i.coords,a=s.layer,o=a._tileCoordsToKey(n),l=t.id,h=t.layerName,u=a._textVectorTiles[o];return u||(u={layers:{},coords:n,renderer:i.renderer}),u.layers[l]={layer:e,style:r,layerName:h},a._textVectorTiles[o]=u,!0},_getStyleOptions:function(t,e,r,i){var s=i,n=s.layer,a=n.getVectorTileLayerStyle(t,e)||s._defaultStyle(e.type),o=e.id,l=n._getFeatureKey(o,r),h=n._overriddenStyles[l];return a=(a=(a=h||a)instanceof Function?a(e.properties,t.z):a)instanceof Array?a:[a]},_createFeatureLayer:function(t,e){var r;switch(t.type){case Dd:r=new jd(t,e);break;case Rd:r=new Vd(t,e);break;case Bd:r=new Jd(t,e);break;case kd:r=new Ud(t,e)}var i=this.layer;return r&&i.options.interactive&&r.addEventParent(i),r},_validateStyle:function(t,e){switch(wo().Path.prototype.options.weight=1,wo().Path.prototype.options.fillOpacity=1,e){case Dd:return wo().extend({},wo().CircleMarker.prototype.options,t);case Rd:return wo().extend({},wo().Polyline.prototype.options,t);case Bd:return wo().extend({},wo().Polygon.prototype.options,t);case kd:return wo().extend({},Ud.prototype.options,t)}},_defaultStyle:function(t){var e=wo().Path.prototype.options;switch(e.weight=1,e.fillOpacity=1,e.radius=3,t){case Dd:return wo().extend({},e,wo().CircleMarker.prototype.options);case Rd:return wo().extend({},e,wo().Polyline.prototype.options);case Bd:return wo().extend({},e,wo().Polygon.prototype.options);case kd:return wo().extend({},e,Ud.prototype.options)}}}),Kd=wo().GridLayer.extend({options:{vectorTileLayerStyles:null,renderer:"SVG",format:Qd.JSON,interactive:!0,maxZoom:23},initialize:function(t){var e=this;wo().setOptions(e,t),wo().GridLayer.prototype.initialize.call(e,t),e._vectorTiles={},e._overriddenStyles={},e.vectorTileLayerStyles=e.options.vectorTileLayerStyles,e.on("tileunload",function(t){var r=e._tileCoordsToKey(t.coords),i=e._vectorTiles[r];i&&e._map&&i.removeFrom(e._map),delete e._vectorTiles[r]},e),e.on("tileerror ",e._renderText,e),e.on("load",e._renderText,e),e._dataLayerNames={}},createTile:function(t,e){var r=this,i=r.getTileSize(),s=null;return s="Canvas"===r.options.renderer?new Id(t,i,r.options):new Nd(t,i,r.options),r._vectorTiles[r._tileCoordsToKey(t)]=s,s._features={},new Zd({layer:r,format:r.options.format,coords:t,renderer:s},e).renderTile(),s.getContainer()},getStyles:function(){return this.vectorTileLayerStyles},getStyle:function(t){return this.vectorTileLayerStyles&&this.vectorTileLayerStyles[t]},setFeatureStyle:function(t,e,r){var i=this._getFeatureKey(t,e);for(var s in this._overriddenStyles[i]=r,this._vectorTiles){var n=this._vectorTiles[s],a=n._features[i];if(a){var o=a.feature;this._updateStyles(o,n,r)}}return this},resetFeatureStyle:function(t,e){var r=this._getFeatureKey(t,e);for(var i in delete this._overriddenStyles[r],this._vectorTiles){var s=this._vectorTiles[i],n=s._features[r];if(n){var a=n.feature,o=this.vectorTileLayerStyles[n.layerName];this._updateStyles(a,s,o)}}return this},getDataLayerNames:function(){return Object.keys(this._dataLayerNames)},_removeAllTiles:function(){wo().GridLayer.prototype._removeAllTiles.call(this),this._textVectorTiles={}},_renderText:function(){var t=this._textVectorTiles;for(var e in t){var r=t[e],i=r.renderer;for(var s in r.layers){for(var n=r.layers[s],a=n.style,o=n.layer,l=0;l<a.length;l++)o.render(i,a[l]),i._addPath(o);this.options.interactive&&o.makeInteractive()}}},_getFeatureKey:function(t,e){return(t=t||0)+"_"+(e=e||"null")},_updateStyles:function(t,e,r){(r=r instanceof Function?r(t.properties,e.getCoord().z):r)instanceof Array||(r=[r]);for(var i=0;i<r.length;i++){var s=this._extendStyle(r[i],t.type);t.updateStyle(e,s)}},_extendStyle:function(t,e){switch(e){case Dd:return wo().extend({},wo().CircleMarker.prototype.options,t);case Rd:return wo().extend({},wo().Polyline.prototype.options,t);case Bd:return wo().extend({},wo().Polygon.prototype.options,t);case kd:return wo().extend({},Ud.prototype.options,t)}}}),$d=Kd.extend({options:{crs:null,cartoCSS:null,layerNames:null,layersID:null,serverCartoCSSStyle:!0,processCharacters:!1,returnAttributes:!1,expands:null,cacheEnabled:!1,tileTemplate:null,subdomains:"abc",timeout:1e4,attribution:$u.Common.attribution},initialize:function(t,e){(e=e||{}).noWrap=null==e.noWrap||e.noWrap,wo().setOptions(this,e),Kd.prototype.initialize.call(this,e),wo().stamp(this);var r=this;if(!t||t.indexOf("http")<0)return t="",this;r.url=t,t.indexOf("/")===t.length-1&&(t=t.substr(0,t.length-1),r.url=t),this.cartoCSSToLeaflet=new jc(r.url),r.initLayersInfo(),!r.options.serverCartoCSSStyle&&r.options.cartoCSS&&r.setClientCartoCSS(r.options.cartoCSS)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._map=t,this._initLayerUrl(),!this.options.tileTemplate&&this.options.serverCartoCSSStyle||this._initGrid()},initLayersInfo:function(){var t=this,e=rt.urlPathAppend(t.url,"layers");zt.get(Vt.appendCredential(e),null,{timeout:t.options.timeout}).then(function(t){return t.json()}).then(function(e){if(t.layersInfoInitialized=!0,t.layersInfo=e,t.layersInfo){for(var r={},i=0,s=t.layersInfo.length;i<s;i++)for(var n=t.layersInfo[i].subLayers.layers,a=0,o=n.length;a<o;a++)n[a].layerIndex=o-a,r[n[a].name]=n[a];t.layersInfo=r,t.cartoCSSToLeaflet.layersInfo=r,t.options.serverCartoCSSStyle&&t.getVectorStylesFromServer()}}).catch(function(t){console.error("error",t)})},getLayerStyleInfo:function(t){var e,r=this;if(r.layersStyles=r.layersStyles||{},e=r.layersStyles[t])return e;if(!r.layersInfo)return{};var i=r.layersInfo[t];if(!i)return null;switch(e={layerIndex:i.layerIndex,ugcLayerType:i.ugcLayerType},i.ugcLayerType){case"VECTOR":e.layerStyle=i.style?i.style:null;break;case"THEME":var s=i.theme;e.layerStyle=s?s.defaultStyle:null,s&&"LABEL"===s.type&&(e.type=s.type,e.textField=s.labelExpression);break;default:i.style&&(e.layerStyle=i.style)}return r.layersStyles[t]=e,e},getVectorStylesFromServer:function(){var t=this,e=rt.urlPathAppend(t.url,"tileFeature/vectorstyles");zt.get(Vt.appendCredential(e),null,{timeout:t.options.timeout}).then(function(t){return t.json()}).then(function(e){if(!e||!e.style)return null;e.style&&"cartoCSS"===e.type&&t.setServerCartoCSS(e.style),t.options&&t.setClientCartoCSS(t.options.cartoCSS),t._initGrid()}).catch(function(t){console.error("error",t)})},setServerCartoCSS:function(t){this.cartoCSSToLeaflet.pretreatedCartoCSS(t,!0)},setClientCartoCSS:function(t){let e=!1;this.options.processCharacters&&(e=this.options.processCharacters),this.cartoCSSToLeaflet.pretreatedCartoCSS(t,e)},getVectorTileLayerStyle:function(t,e){if(!e)return null;var r=this,i=e.layerName,s=r.getLayerStyleInfo(i);if(s&&s.textField){var n=s.textField;if(n&&n.indexOf(".")){var a=n.split(".");n=a&&a.length>0&&a[a.length-1]}e.properties.textField=n}r.vectorTileLayerStyles=r.vectorTileLayerStyles||{};var o=r.vectorTileLayerStyles[i];if(o)return e=this._mergeFeatureTextField(e,o),o;var l=this.getScaleFromCoords(t),h=this.cartoCSSToLeaflet.pickShader(i)||[];for(var u in o=[],h)for(var c=h[u],d=0;d<c.length;d++){var p=this.cartoCSSToLeaflet.getValidStyleFromCarto(t.z,l,c[d],e,this.options.serverCartoCSSStyle);p&&o.push(p)}return"TEXT"!==(e=this._mergeFeatureTextField(e,o)).type&&0!==o.length||(o=this.cartoCSSToLeaflet.getValidStyleFromLayerInfo(e,s),"TEXT"===e.type&&(o.textName="["+e.properties.textField+"]")),r.vectorTileLayerStyles[i]=o,o},getScale:function(t){var e=t||this._map.getZoom();return this.scales[e]},getScaleFromCoords:function(t){var e,r=this;return r.scales&&r.scales[t.z]?r.scales[t.z]:(r.scales=r.scales||{},e=r.getDefaultScale(t),r.scales[t.z]=e,e)},getDefaultScale:function(t){var e=this._crs;if(e.scales)return e.scales[t.z];var r=this._tileCoordsToBounds(t),i=e.project(r.getNorthEast()),s=e.project(r.getSouthWest()),n=this.options.tileSize,a=Math.max(Math.abs(i.x-s.x)/n,Math.abs(i.y-s.y)/n),o=l.METER;if(e.code){var h=e.code.split(":");if(h&&h.length>1){var u=parseInt(h[1]);o=u&&u>=4e3&&u<=5e3?l.DEGREE:l.METER}}return Sc(a,96,o)},_mergeFeatureTextField:function(t,e){if(!this.options.serverCartoCSSStyle||!e||"TEXT"!==t.type)return t;var r=e;wo().Util.isArray(e)||(r=[e]);for(var i=0;i<r.length;i++){var s=r[i].textName;s&&t.properties&&(t.properties.textField=s.substring(1,s.length-1))}return t},_getTileUrl:function(t){return this.options.tileTemplate?this._getTileTemplateUrl(t):this._getDefaultTileUrl(t)},_getTileTemplateUrl:function(t){var e=this,r=e.options.tileTemplate,i={s:e._getSubdomain(t),x:t.x,y:t.y,z:t.z};if(e._map&&!e._map.options.crs.infinite){var s=e._globalTileRange.max.y-t.y;e.options.tms&&(i.y=s),i["-y"]=s}return wo().Util.template(r,wo().extend(i,e.options))},_initGrid:function(){Kd.prototype.onAdd.call(this,this._map)},_getSubdomain:wo().TileLayer.prototype._getSubdomain,_getDefaultTileUrl:function(t){var e=t.x,r=t.y,i=this._tileUrl+"&x="+e+"&y="+r;return i+="&scale="+this.getScaleFromCoords(t)},_initLayerUrl:function(){var t=this.options;if(this.url){var e=t.format.toString().toLowerCase();this._tileUrl=rt.urlPathAppend(this.url,"tileFeature."+e),this._tileUrl=rt.urlAppend(this._tileUrl,encodeURI(this._createURLParam(t)))}},_createURLParam:function(t){var e=[],r=this._getCredential(this._tileUrl);if(r&&e.push(r),t.layersID&&e.push("layersID="+t.layersID),t.layerNames){wo().Util.isArray(t.layerNames)||(t.layerNames=[t.layerNames]);var i="["+t.layerNames.join(",")+"]";e.push("layerNames="+i)}var s=this._crs;if(s.options&&s.options.origin)e.push("origin="+JSON.stringify({x:s.options.origin[0],y:s.options.origin[1]}));else if(s.projection&&s.projection.bounds){var n=s.projection.bounds,a=wo().point(n.min.x,n.max.y);e.push("origin="+JSON.stringify({x:a.x,y:a.y}))}t.expands&&e.push("expands="+t.expands),e.push("returnAttributes="+t.returnAttributes),e.push("cacheEnabled="+t.cacheEnabled);var o=this.options.tileSize;return e.push("width="+o),e.push("height="+o),e.join("&")},_getCredential:function(t){var e=Vt.getToken(t),r=e?new vt(e,"token")||new vt(e,"key"):null;return r?r.getUrlParameters():null}});const tp=function(){try{return turf}catch(t){return{}}}();var ep,rp=wo().GeoJSON.extend({turfMap:{"Measurement.along":["line","distance","units"],"Measurement.area":["geojson"],"Measurement.bbox":["geojson"],"Measurement.bboxPolygon":["bbox"],"Measurement.bearing":["start","end","final"],"Measurement.center":["geojson","properties"],"Measurement.centerOfMass":["geojson","properties"],"Measurement.centroid":["geojson","properties"],"Measurement.destination":["origin","distance","bearing","units"],"Measurement.distance":["from","to","units"],"Measurement.envelope":["geojson"],"Measurement.length":["geojson","units"],"Measurement.midpoint":["point1","point2"],"Measurement.pointOnFeature":["geojson"],"Measurement.polygonTangents":["point","polygon"],"Measurement.rhumbBearing":["start","end","final"],"Measurement.rhumbDestination":["origin","distance","bearing","units"],"Measurement.rhumbDistance":["from","to","units"],"Measurement.square":["bbox"],"Measurement.greatCircle":["start","end","properties","npoints","offset"],"CoordinateMutation.cleanCoords":["geojson","mutate"],"CoordinateMutation.flip":["geojson","mutate"],"CoordinateMutation.rewind":["geojson","reverse","mutate"],"CoordinateMutation.round":["num","precision"],"CoordinateMutation.truncate":["geojson","precision","coordinates","mutate"],"Transformation.bboxClip":["feature","bbox"],"Transformation.bezierSpline":["line","resolution","sharpness"],"Transformation.buffer":["geojson","radius","units","steps"],"Transformation.circle":["center","radius","steps","units","properties"],"Transformation.clone":["geojson"],"Transformation.concave":["points","maxEdge","units"],"Transformation.convex":["geojson","concavity"],"Transformation.difference":["polygon1","polygon2"],"Transformation.dissolve":["featureCollection","propertyName"],"Transformation.intersect":["poly1","poly2"],"Transformation.lineOffset":["geojson","distance","units"],"Transformation.simplify":["feature","tolerance","highQuality"],"Transformation.tesselate":["poly"],"Transformation.transformRotate":["geojson","angle","pivot","mutate"],"Transformation.transformTranslate":["geojson","distance","direction","units","zTranslation","mutate"],"Transformation.transformScale":["geojson","factor","origin","mutate"],"Transformation.union":["A"],"Transformation.voronoi":["points","bbox"],"featureConversion.combine":["fc"],"featureConversion.explode":["geojson"],"featureConversion.flatten":["geojson"],"featureConversion.lineStringToPolygon":["lines","properties","autoComplete","orderCoords"],"featureConversion.polygonize":["geojson"],"featureConversion.polygonToLineString":["polygon","properties"],"Misc.kinks":["featureIn"],"Misc.lineArc":["center","radius","bearing1","bearing2","steps","units"],"Misc.lineChunk":["geojson","segmentLength","units","reverse"],"Misc.lineIntersect":["line1","line2"],"Misc.lineOverlap":["line1","line2"],"Misc.lineSegment":["geojson"],"Misc.lineSlice":["startPt","stopPt","line"],"Misc.lineSliceAlong":["line","startDist","stopDist","units"],"Misc.lineSplit":["line","splitter"],"Misc.mask":["polygon","mask"],"Misc.pointOnLine":["lines","pt","units"],"Misc.sector":["center","radius","bearing1","bearing2","steps","units"],"Misc.shortestPath":["start","end","obstacles","units","resolution"],"Misc.unkinkPolygon":["geojson"],"Helper.featureCollection":["features","bbox","id"],"Helper.feature":["geometry","properties","bbox","id"],"Helper.geometryCollection":["geometries","properties","bbox","id"],"Helper.lineString":["coordinates","properties","bbox","id"],"Helper.multiLineString":["coordinates","properties","bbox","id"],"Helper.multiPoint":["coordinates","properties","bbox","id"],"Helper.multiPolygon":["coordinates","properties","bbox","id"],"Helper.point":["coordinates","properties","bbox","id"],"Helper.polygon":["coordinates","properties","bbox","id"],"Data.sample":["featurecollection","num"],"Interpolation.interpolate":["points","cellSize","gridType","property","units","weight"],"Interpolation.isobands":["pointGrid","breaks","zProperty","commonProperties","breaksProperties"],"Interpolation.isolines":["pointGrid","breaks","zProperty","commonProperties","breaksProperties"],"Interpolation.planepoint":["point","triangle"],"Interpolation.tin":["points","z"],"Joins.pointsWithinPolygon":["points","polygons"],"Joins.tag":["points","polygons","field","outField","mask","properties"],"Grids.hexGrid":["bbox","cellSide","units","triangles"],"Grids.pointGrid":["bbox","cellSide","units","mask","properties"],"Grids.squareGrid":["bbox","cellSide","units","mask","properties"],"Grids.triangleGrid":["bbox","cellSide","units","mask","properties"],"Classification.nearestPoint":["targetPoint","points"],"Aggregation.collect":["polygons","points","inProperty","outProperty"],"Aggregation.clustersDbscan":["points","maxDistance","units","minPoints","mutate"],"Aggregation.clustersKmeans":["points","numberOfClusters","mutate"],"Meta.coordAll":["geojson"],"Meta.coordEach":["geojson","callback","excludeWrapCoord"],"Meta.coordReduce":["geojson","callback","initialValue","excludeWrapCoord"],"Meta.featureEach":["geojson","callback"],"Meta.featureReduce":["geojson","callback","initialValue"],"Meta.flattenEach":["geojson","callback"],"Meta.flattenReduce":["geojson","callback","initialValue"],"Meta.getCoord":["coord"],"Meta.getCoords":["coords"],"Meta.getGeom":["geojson"],"Meta.getGeomType":["geojson","name"],"Meta.geomEach":["geojson","callback"],"Meta.geomReduce":["geojson","callback","initialValue"],"Meta.propEach":["geojson","callback"],"Meta.propReduce":["geojson","callback","initialValue"],"Meta.segmentEach":["geojson","callback"],"Meta.segmentReduce":["geojson","callback","initialValue"],"Meta.getCluster":["geojson","filter"],"Meta.clusterEach":["geojson","property","callback"],"Meta.clusterReduce":["geojson","property","callback","initialValue"],"Assertions.collectionOf":["featureCollection","type","name"],"Assertions.containsNumber":["coordinates"],"Assertions.geojsonType":["value","type","name"],"Assertions.featureOf":["feature","type","name"],"Booleans.booleanClockwise":["line"],"Booleans.booleanContains":["feature1","feature2"],"Booleans.booleanCrosses":["feature1","feature2"],"Booleans.booleanDisjoint":["feature1","feature2"],"Booleans.booleanEqual":["feature1","feature2"],"Booleans.booleanOverlap":["feature1","feature2"],"Booleans.booleanParallel":["feature1","feature2"],"Booleans.booleanPointInPolygon":["point","polygon","ignoreBoundary"],"Booleans.booleanPointOnLine":["point","linestring","ignoreEndVertices"],"UnitConversion.bearingToAngle":["bearing"],"UnitConversion.convertArea":["area","originalUnit","finalUnit"],"UnitConversion.convertLength":["length","originalUnit","finalUnit"],"UnitConversion.degreesToradians":["degrees"],"UnitConversion.lengthToRadians":["distance","units"],"UnitConversion.lengthToDegrees":["distance","units"],"UnitConversion.radiansToLength":["radians","units"],"UnitConversion.radiansToDegrees":["radians"],"UnitConversion.toMercator":["geojson","mutate"],"UnitConversion.toWgs84":["geojson","mutate"]},options:{attribution:$u.Turf.attribution},initialize:function(t){t=t||{},wo().Util.setOptions(this,t),wo().stamp(this),this._layers={}},turfOptionMap:{"Measurement.along":["line","distance",{units:""}],"Measurement.bboxPolygon":["bbox",{properties:"",id:""}],"Measurement.bearing":["start","end",{final:""}],"Measurement.center":["geojson",{properties:""}],"Measurement.destination":["origin","distance","bearing",{units:"",properties:""}],"Measurement.distance":["from","to",{units:""}],"Measurement.length":["geojson",{units:""}],"Measurement.rhumbBearing":["start","end",{final:""}],"Measurement.rhumbDestination":["origin","distance","bearing",{units:"",properties:""}],"Measurement.rhumbDistance":["from","to",{units:""}],"Measurement.greatCircle":["start","end",{properties:"",npoints:"",offset:""}],"CoordinateMutation.cleanCoords":["geojson",{mutate:""}],"CoordinateMutation.flip":["geojson",{mutate:""}],"CoordinateMutation.rewind":["geojson",{mutate:"",reverse:""}],"CoordinateMutation.truncate":["geojson",{precision:"",coordinates:"",mutate:""}],"Transformation.bezierSpline":["line",{resolution:"",sharpness:""}],"Transformation.buffer":["geojson","radius",{units:"",steps:""}],"Transformation.circle":["center","radius",{units:"",steps:"",properties:""}],"Transformation.concave":["points",{maxEdge:"",units:""}],"Transformation.convex":["geojson",{concavity:""}],"Transformation.dissolve":["featureCollection",{propertyName:""}],"Transformation.lineOffset":["geojson","distance",{units:""}],"Transformation.simplify":["geojson",{tolerance:"",highQuality:""}],"Transformation.transformRotate":["geojson","angle",{pivot:"",mutate:""}],"Transformation.transformTranslate":["geojson","distance","direction",{units:"",zTranslation:"",mutate:""}],"Transformation.transformScale":["geojson","factor",{origin:"",mutate:""}],"Transformation.voronoi":["points",{bbox:""}],"featureConversion.lineStringToPolygon":["lines",{properties:"",autoComplete:"",orderCoords:""}],"featureConversion.polygonToLineString":["polygon",{properties:""}],"Misc.lineArc":["center","radius","bearing1","bearing2",{steps:"",units:""}],"Misc.lineChunk":["geojson","segmentLength",{units:"",reverse:""}],"Misc.lineOverlap":["line1","line2",{tolerance:""}],"Misc.lineSliceAlong":["line","startDist","stopDist",{units:""}],"Misc.pointOnLine":["lines","pt",{units:""}],"Misc.sector":["center","radius","bearing1","bearing2",{units:"",steps:"",properties:""}],"Misc.shortestPath":["start","end",{obstacles:"",units:"",resolution:""}],"Helper.feature":["geometry","properties",{bbox:"",id:""}],"Helper.geometryCollection":["geometries","properties",{bbox:"",id:""}],"Helper.lineString":["coordinates","properties",{bbox:"",id:""}],"Helper.multiLineString":["coordinates","properties",{bbox:"",id:""}],"Helper.multiPoint":["coordinates","properties",{bbox:"",id:""}],"Helper.multiPolygon":["coordinates","properties",{bbox:"",id:""}],"Helper.point":["coordinates","properties",{bbox:"",id:""}],"Helper.polygon":["coordinates","properties",{bbox:"",id:""}],"Interpolation.interpolate":["points","cellSize",{gridType:"",property:"",units:"",weight:""}],"Interpolation.isobands":["pointGrid","breaks",{zProperty:"",commonProperties:"",breaksProperties:""}],"Interpolation.isolines":["pointGrid","breaks",{zProperty:"",commonProperties:"",breaksProperties:""}],"Grids.hexGrid":["bbox","cellSide",{units:"",triangles:"",properties:"",mask:""}],"Grids.pointGrid":["bbox","cellSide",{units:"",mask:"",properties:""}],"Grids.squareGrid":["bbox","cellSide",{units:"",mask:"",properties:""}],"Grids.triangleGrid":["bbox","cellSide",{units:"",mask:"",properties:""}],"Aggregation.clustersDbscan":["points","maxDistance",{units:"",minPoints:"",mutate:""}],"Aggregation.clustersKmeans":["points",{numberOfClusters:"",mutate:""}],"Booleans.booleanPointInPolygon":["point","polygon",{ignoreBoundary:""}],"Booleans.booleanPointOnLine":["point","linestring",{ignoreEndVertices:""}],"UnitConversion.toMercator":["geojson",{mutate:""}],"UnitConversion.toWgs84":["geojson",{mutate:""}]},process:function(t,e,r,i){var s;try{s=tp[t.split(".")[1]].apply(this,this.parse(t,e))}catch(r){s=tp[t.split(".")[1]].apply(this,this.parseOption(t,e))}(i=null==i||i)&&this.addData([s]),r&&r(s)},parse:function(t,e){if("Transformation.union"===t)return e.A;var r=[],i=this.turfMap[t];return i&&i.map(function(t){return r.push(e[t]),e[t]}),r},parseOption(t,e){var r=[];return this.turfOptionMap[t].map(function(t){if(t instanceof Object){var i=t;Object.keys(i).forEach(function(t){i[t]=e[t]}),r.push(i)}else r.push(e[t]);return e}),r}}),ip=wo().Class.extend({initialize:function(t,e){this.geometry=t,this.attributes=e},toFeature:function(){var t=this.geometry,e=[];if(t instanceof wo().LatLng)e=[t.lng,t.lat];else if(t instanceof wo().Point)e=[t.x,t.y];else if(t instanceof wo().CircleMarker){var r=t.getLatLng();e=[r.lng,r.lat]}else e=t;return 2===e.length&&(t=new ut(e[0],e[1])),new Ot(t,this.attributes)}}),sp=wo().Layer.extend({options:{alwaysMapCRS:!1,id:rt.createUniqueID("heatMapLayer_"),featureWeight:null,opacity:1,colors:["blue","cyan","lime","yellow","red"],useGeoUnit:!1,radius:50,attribution:$u.Common.attribution},initialize:function(t,e){wo().Util.setOptions(this,e),this.name=t,this.features=[],this.maxWeight=null,this.minWeight=null,this.rootCanvas=null,this.canvasContext=null,this.maxWidth=null,this.maxHeight=null,this.id=this.options.id,this.featureWeight=this.options.featureWeight,this.colors=this.options.colors,this.useGeoUnit=this.options.useGeoUnit,this.opacity=this.options.opacity,this.radius=this.options.radius,this.blur=this.options.blur,this.movingOffset=[0,0]},onRemove:function(t){wo().DomUtil.remove(this.rootCanvas),t.off("mousemove",this.mouseMoveHandler)},onAdd:function(t){var e=this;if(e._map=t,e._createCanvasContainer(),e.rootCanvas){var r=t.getSize();e.rootCanvas.width=e.maxWidth=r.x,e.rootCanvas.height=e.maxHeight=r.y,e._updateOpacity(),e.mouseMoveHandler=function(t){var r=t.layerPoint;e.currentMousePosition=wo().point(r.x+e.movingOffset[0],r.y+e.movingOffset[1])},t.on("mousemove",e.mouseMoveHandler),e.update()}else t.removeLayer(e)},addFeatures:function(t){this.features=this.toiClientFeature(t),this.refresh()},refresh:function(){if(0!==this.features.length&&this._map){var t=this._map.getBounds();this.updateHeatPoints(t)}},updateHeatPoints:function(t){this.features&&this.features.length>0?this.convertFastToPixelPoints(t):this.canvasContext.clearRect(0,0,this.maxWidth,this.maxWidth)},convertFastToPixelPoints:function(t){var e,r,i,s,n,a,o,l=[],h=t.getEast()-t.getWest(),u=t.getNorth()-t.getSouth(),c=this._map.getSize();s=h/c.x>u/c.y?h/c.x:u/c.y,this.useRadius=this.useGeoUnit?parseInt(this.radius/s):this.radius;for(var d=0;d<this.features.length;d++){var p=this.features[d],f=p.geometry,m=this.getLocalXY(new nt(f.x,f.y));this.featureWeight?(m.weight=p.attributes[this.featureWeight],this.maxWeight||(n=n||m.weight,a=a||m.weight,n=Math.max(n,m.weight),a=Math.min(a,m.weight))):m.weight=1,e=Math.floor(m[0]),r=Math.floor(m[1]),i=m.weight,l.push([e,r,i])}this.maxWeight?this.draw(l,this.maxWeight):(o=n&&a?(n+a)/2:1,this.draw(l,o))},draw:function(t,e){if(!(this.maxHeight>0&&this.maxWidth>0))return!1;var r=this.canvasContext;this.canvasContext.clearRect(0,0,this.maxWidth,this.maxHeight),this.drawCircle(this.useRadius),this.createGradient();for(var i=0;i<t.length;i++){var s=t[i];this.canvasContext.globalAlpha=Math.max(s[2]/e,.05),this.canvasContext.drawImage(this.circle,s[0]-this.useRadius,s[1]-this.useRadius)}var n=r.getImageData(0,0,this.maxWidth,this.maxHeight);this.colorize(n.data,this.grad),r.putImageData(n,0,0)},colorize:function(t,e){for(var r,i=0;i<t.length;i+=4)(r=4*t[i+3])&&(t[i]=e[r],t[i+1]=e[r+1],t[i+2]=e[r+2])},drawCircle:function(t){var e=this.blur||t/2,r=this.circle=document.createElement("canvas"),i=r.getContext("2d");r.height=2*t,r.width=2*t,i.shadowOffsetX=i.shadowOffsetY=2*t,i.shadowBlur=e,i.shadowColor="#000000",i.beginPath(),i.arc(-t,-t,t/2,0,2*Math.PI,!0),i.closePath(),i.fill()},createGradient:function(){var t=this.colors,e=document.createElement("canvas"),r=e.getContext("2d"),i=r.createLinearGradient(0,0,0,256);e.height=256,e.width=1;for(var s=1,n=0,a=t.length;n<a;n++)i.addColorStop(s/a,t[n]),s++;r.fillStyle=i,r.fillRect(0,0,1,256),this.grad=r.getImageData(0,0,1,256).data},update:function(){var t=this._map.containerPointToLayerPoint([0,0]);wo().DomUtil.setPosition(this.rootCanvas,t);var e=this;e.refresh(),e.currentMousePosition&&(e.currentMousePosition=wo().point(e.currentMousePosition.x-e.movingOffset[0],e.currentMousePosition.y-e.movingOffset[1])),e.movingOffset=[0,0],e._zoom=e._map.getZoom(),e._center=e._map.getCenter()},getLocalXY:function(t){if(!this._map)return t;var e=t;wo().Util.isArray(t)&&(e=wo().point(t[0],t[1])),t instanceof wo().Point||(e=t instanceof ut||t instanceof dt?wo().point(t.x,t.y):wo().point(t.lon,t.lat));var r=this._map.latLngToContainerPoint(this.options.alwaysMapCRS?this._map.options.crs.unproject(e):wo().latLng(e.y,e.x));return[r.x,r.y]},setOpacity:function(t){t!==this.options.opacity&&(t&&(this.options.opacity=t),this._updateOpacity())},removeFeatures:function(t){if(t&&0!==t.length&&this.features&&0!==this.features.length){if(t===this.features)return this.removeAllFeatures();rt.isArray(t)||(t=[t]);for(var e,r,i=[],s=0,n=t.length;s<n;s++)e=t[s],-1!==(r=rt.indexOf(this.features,e))?this.features.splice(r,1):i.push(e);var a=0==i.length;this._map.fire("featuresremoved",{features:i,succeed:a}),this.refresh()}},removeAllFeatures:function(){this.features=[],this.refresh()},_createCanvasContainer:function(){var t=this.getPane(),e="heatMapLayer leaflet-layer leaflet-zoom-"+(this._map.options.zoomAnimation&&wo().Browser.any3d?"animated":"hide");this.rootCanvas=wo().DomUtil.create("canvas",e,t);var r=wo().DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this.rootCanvas.id=this.id,this.rootCanvas.style[r]="50% 50%",this.rootCanvas.style.position="absolute",this.rootCanvas.style.zIndex=200,rt.modifyDOMElement(this.rootCanvas,null,null,null,null,null,null,this.opacity),this.canvasContext=this.rootCanvas.getContext("2d")},_updateOpacity:function(){var t=this;rt.modifyDOMElement(t.rootCanvas,null,null,null,null,null,null,t.options.opacity),null!==t._map&&t._map.fire("changelayer",{layer:t,property:"opacity"})},getEvents:function(){var t={zoomend:this._reset,moveend:this._reset,resize:this._resize};return this._map._zoomAnimated&&(t.zoomanim=this._zoomAnim),t},toiClientFeature:function(t){wo().Util.isArray(t)||(t=[t]);let e=[];for(let r=0,i=t.length;r<i;r++)if(t[r]instanceof ip)e.push(t[r].toFeature());else if(-1!=["FeatureCollection","Feature","Geometry"].indexOf(t[r].type)){const i=new Nt;e=e.concat(i.read(t[r]))}else{if(!t[r].geometry||!t[r].geometry.parts)throw new Error("Features's type does not match, please check.");e.push(Ss.fromJson(t[r]).toFeature())}return e},_zoomAnim:function(t){var e=this._map.getZoomScale(t.zoom),r=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());wo().DomUtil.setTransform?wo().DomUtil.setTransform(this.rootCanvas,r,e):this.rootCanvas.style[wo().DomUtil.TRANSFORM]=wo().DomUtil.getTranslateString(r)+" scale("+e+")"},_reset:function(){var t=this;t.update();var e=t._map.getSize(),r=this._map.containerPointToLayerPoint([0,0]);wo().DomUtil.setPosition(this.rootCanvas,r),parseFloat(t.rootCanvas.width)!==parseFloat(e.x)&&(t.rootCanvas.width=e.x),parseFloat(t.rootCanvas.height)!==parseFloat(e.y)&&(t.rootCanvas.height=e.y),t.refresh()},_resize:function(){var t=this._map.getSize();this.maxWidth=t.x,this.maxHeight=t.y}}),np=r(510),ap=r.n(np);!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.MultiPoint=4]="MultiPoint",t[t.MultiLineString=5]="MultiLineString",t[t.MultiPolygon=6]="MultiPolygon",t[t.GeometryCollection=7]="GeometryCollection",t[t.CircularString=8]="CircularString",t[t.CompoundCurve=9]="CompoundCurve",t[t.CurvePolygon=10]="CurvePolygon",t[t.MultiCurve=11]="MultiCurve",t[t.MultiSurface=12]="MultiSurface",t[t.Curve=13]="Curve",t[t.Surface=14]="Surface",t[t.PolyhedralSurface=15]="PolyhedralSurface",t[t.TIN=16]="TIN",t[t.Triangle=17]="Triangle"}(ep||(ep={}));const op=4,lp=4,hp=new Int32Array(2),up=new Float32Array(hp.buffer),cp=new Float64Array(hp.buffer),dp=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var pp;!function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}(pp||(pp={}));class fp{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new fp(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return hp[0]=this.readInt32(t),up[0]}readFloat64(t){return hp[dp?0:1]=this.readInt32(t),hp[dp?1:0]=this.readInt32(t+4),cp[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){up[0]=e,this.writeInt32(t,hp[0])}writeFloat64(t,e){cp[0]=e,this.writeInt32(t,hp[dp?0:1]),this.writeInt32(t+4,hp[dp?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+op+lp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<lp;e++)t+=String.fromCharCode(this.readInt8(this.position_+op+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);let i="",s=0;if(t+=op,e===pp.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;s<r;){let e;const r=this.readUint8(t+s++);if(r<192)e=r;else{const i=this.readUint8(t+s++);if(r<224)e=(31&r)<<6|63&i;else{const n=this.readUint8(t+s++);if(r<240)e=(15&r)<<12|(63&i)<<6|63&n;else{e=(7&r)<<18|(63&i)<<12|(63&n)<<6|63&this.readUint8(t+s++)}}}e<65536?i+=String.fromCharCode(e):(e-=65536,i+=String.fromCharCode(55296+(e>>10),56320+(1023&e)))}return i}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+op}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=lp)throw new Error("FlatBuffers: file identifier must be length "+lp);for(let e=0;e<lp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+op+e))return!1;return!0}createScalarList(t,e){const r=[];for(let i=0;i<e;++i)null!==t(i)&&r.push(t(i));return r}createObjList(t,e){const r=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&r.push(e.unpack())}return r}}function mp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var yp,gp=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}var e,r,i;return e=t,i=[{key:"getRootAsGeometry",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsGeometry",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startGeometry",value:function(t){t.startObject(8)}},{key:"addEnds",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"createEndsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}},{key:"startEndsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"addXy",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createXyVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startXyVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addZ",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"createZVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startZVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addM",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"createMVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startMVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addT",value:function(t,e){t.addFieldOffset(4,e,0)}},{key:"createTVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startTVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addTm",value:function(t,e){t.addFieldOffset(5,e,0)}},{key:"createTmVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}},{key:"startTmVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addType",value:function(t,e){t.addFieldInt8(6,e,ep.Unknown)}},{key:"addParts",value:function(t,e){t.addFieldOffset(7,e,0)}},{key:"createPartsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startPartsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"endGeometry",value:function(t){return t.endObject()}},{key:"createGeometry",value:function(e,r,i,s,n,a,o,l,h){return t.startGeometry(e),t.addEnds(e,r),t.addXy(e,i),t.addZ(e,s),t.addM(e,n),t.addT(e,a),t.addTm(e,o),t.addType(e,l),t.addParts(e,h),t.endGeometry(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"ends",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}},{key:"endsLength",value:function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"endsArray",value:function(){var t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"xy",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"xyLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"xyArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"z",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"zLength",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"zArray",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"m",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"mLength",value:function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"mArray",value:function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"t",value:function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"tLength",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"tArray",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"tm",value:function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}},{key:"tmLength",value:function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"type",value:function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):ep.Unknown}},{key:"parts",value:function(e,r){var i=this.bb.__offset(this.bb_pos,18);return i?(r||new t).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}},{key:"partsLength",value:function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}}])&&mp(e.prototype,r),i&&mp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function vp(t,e){for(var r=[],i=0;i<t.length;i+=2){var s=[t[i],t[i+1]];e&&s.push(e[i>>1]),r.push(s)}return r}function bp(t,e,r){if(!r||0===r.length)return[vp(t,e)];var i,s=0,n=Array.from(r).map(function(e){return t.slice(s,s=e<<1)});return e&&(s=0,i=Array.from(r).map(function(t){return e.slice(s,s=t)})),n.map(function(t,e){return vp(t,i?i[e]:void 0)})}function Sp(t,e){var r=e;if(r===ep.Unknown&&(r=t.type()),r===ep.GeometryCollection){for(var i=[],s=0;s<t.partsLength();s++){var n=t.parts(s),a=n.type();i.push(Sp(n,a))}return{type:ep[r],geometries:i}}if(r===ep.MultiPolygon){for(var o=[],l=0;l<t.partsLength();l++)o.push(Sp(t.parts(l),ep.Polygon));return{type:ep[r],coordinates:o.map(function(t){return t.coordinates})}}var h=function(t,e){var r=t.xyArray(),i=t.zArray();switch(e){case ep.Point:var s=Array.from(r);return i&&s.push(i[0]),s;case ep.MultiPoint:case ep.LineString:return vp(r,i);case ep.MultiLineString:case ep.Polygon:return bp(r,i,t.endsArray())}}(t,r);return{type:ep[r],coordinates:h}}function _p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}!function(t){t[t.Byte=0]="Byte",t[t.UByte=1]="UByte",t[t.Bool=2]="Bool",t[t.Short=3]="Short",t[t.UShort=4]="UShort",t[t.Int=5]="Int",t[t.UInt=6]="UInt",t[t.Long=7]="Long",t[t.ULong=8]="ULong",t[t.Float=9]="Float",t[t.Double=10]="Double",t[t.String=11]="String",t[t.Json=12]="Json",t[t.DateTime=13]="DateTime",t[t.Binary=14]="Binary"}(yp||(yp={}));var xp=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}var e,r,i;return e=t,i=[{key:"getRootAsColumn",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsColumn",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startColumn",value:function(t){t.startObject(11)}},{key:"addName",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addType",value:function(t,e){t.addFieldInt8(1,e,yp.Byte)}},{key:"addTitle",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"addWidth",value:function(t,e){t.addFieldInt32(4,e,-1)}},{key:"addPrecision",value:function(t,e){t.addFieldInt32(5,e,-1)}},{key:"addScale",value:function(t,e){t.addFieldInt32(6,e,-1)}},{key:"addNullable",value:function(t,e){t.addFieldInt8(7,+e,1)}},{key:"addUnique",value:function(t,e){t.addFieldInt8(8,+e,0)}},{key:"addPrimaryKey",value:function(t,e){t.addFieldInt8(9,+e,0)}},{key:"addMetadata",value:function(t,e){t.addFieldOffset(10,e,0)}},{key:"endColumn",value:function(t){var e=t.endObject();return t.requiredField(e,4),e}},{key:"createColumn",value:function(e,r,i,s,n,a,o,l,h,u,c,d){return t.startColumn(e),t.addName(e,r),t.addType(e,i),t.addTitle(e,s),t.addDescription(e,n),t.addWidth(e,a),t.addPrecision(e,o),t.addScale(e,l),t.addNullable(e,h),t.addUnique(e,u),t.addPrimaryKey(e,c),t.addMetadata(e,d),t.endColumn(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"type",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):yp.Byte}},{key:"title",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"width",value:function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"precision",value:function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"scale",value:function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}},{key:"nullable",value:function(){var t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}},{key:"unique",value:function(){var t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"primaryKey",value:function(){var t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"metadata",value:function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&_p(e.prototype,r),i&&_p(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function wp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Cp=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}var e,r,i;return e=t,i=[{key:"getRootAsFeature",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsFeature",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startFeature",value:function(t){t.startObject(3)}},{key:"addGeometry",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addProperties",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createPropertiesVector",value:function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}},{key:"startPropertiesVector",value:function(t,e){t.startVector(1,e,1)}},{key:"addColumns",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"createColumnsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startColumnsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"endFeature",value:function(t){return t.endObject()}},{key:"finishFeatureBuffer",value:function(t,e){t.finish(e)}},{key:"finishSizePrefixedFeatureBuffer",value:function(t,e){t.finish(e,void 0,!0)}},{key:"createFeature",value:function(e,r,i,s){return t.startFeature(e),t.addGeometry(e,r),t.addProperties(e,i),t.addColumns(e,s),t.endFeature(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"geometry",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?(t||new gp).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}},{key:"properties",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}},{key:"propertiesLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"propertiesArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"columns",value:function(t,e){var r=this.bb.__offset(this.bb_pos,8);return r?(e||new xp).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}},{key:"columnsLength",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}}])&&wp(e.prototype,r),i&&wp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Mp=(new TextEncoder,new TextDecoder);function Ap(t,e){var r={};if(!e||0===e.length)return r;var i=t.propertiesArray();if(!i)return r;for(var s=new DataView(i.buffer,i.byteOffset),n=t.propertiesLength(),a=0;a<n;){var o=s.getUint16(a,!0);a+=2;var l=e[o],h=l.name;switch(l.type){case yp.Bool:r[h]=!!s.getUint8(a),a+=1;break;case yp.Byte:r[h]=s.getInt8(a),a+=1;break;case yp.UByte:r[h]=s.getUint8(a),a+=1;break;case yp.Short:r[h]=s.getInt16(a,!0),a+=2;break;case yp.UShort:r[h]=s.getUint16(a,!0),a+=2;break;case yp.Int:r[h]=s.getInt32(a,!0),a+=4;break;case yp.UInt:r[h]=s.getUint32(a,!0),a+=4;break;case yp.Long:r[h]=Number(s.getBigInt64(a,!0)),a+=8;break;case yp.ULong:r[h]=Number(s.getBigUint64(a,!0)),a+=8;break;case yp.Float:r[h]=s.getFloat32(a,!0),a+=4;break;case yp.Double:r[h]=s.getFloat64(a,!0),a+=8;break;case yp.DateTime:case yp.String:var u=s.getUint32(a,!0);a+=4,r[h]=Mp.decode(i.subarray(a,a+u)),a+=u;break;case yp.Json:var c=s.getUint32(a,!0);a+=4;var d=Mp.decode(i.subarray(a,a+c));r[h]=JSON.parse(d),a+=c;break;default:throw new Error("Unknown type "+l.type)}}return r}function Tp(t,e){var r=e.columns;return{type:"Feature",geometry:Sp(t.geometry(),e.geometryType),properties:Ap(t,r)}}const Ep=new Uint8Array(0);function Op(t){this._source=t,this._array=Ep,this._index=0}function Lp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Op.prototype.read=function(){var t=this,e=t._array.subarray(t._index);return t._source.read().then(function(r){return t._array=Ep,t._index=0,r.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:function(t,e){if(!t.length)return e;if(!e.length)return t;var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}(e,r.value)}})},Op.prototype.slice=function(t){if((t|=0)<0)throw new Error("invalid length");var e=this,r=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var i=new Uint8Array(t);return i.set(this._array.subarray(this._index)),function s(){return e._source.read().then(function(n){return n.done?(e._array=Ep,e._index=0,r>0?i.subarray(0,r):null):r+n.value.length>=t?(e._array=n.value,e._index=t-r,i.set(n.value.subarray(0,t-r),r),i):(i.set(n.value,r),r+=n.value.length,s())})}()},Op.prototype.cancel=function(){return this._source.cancel()};var Pp=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}var e,r,i;return e=t,i=[{key:"getRootAsCrs",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsCrs",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startCrs",value:function(t){t.startObject(6)}},{key:"addOrg",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addCode",value:function(t,e){t.addFieldInt32(1,e,0)}},{key:"addName",value:function(t,e){t.addFieldOffset(2,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(3,e,0)}},{key:"addWkt",value:function(t,e){t.addFieldOffset(4,e,0)}},{key:"addCodeString",value:function(t,e){t.addFieldOffset(5,e,0)}},{key:"endCrs",value:function(t){return t.endObject()}},{key:"createCrs",value:function(e,r,i,s,n,a,o){return t.startCrs(e),t.addOrg(e,r),t.addCode(e,i),t.addName(e,s),t.addDescription(e,n),t.addWkt(e,a),t.addCodeString(e,o),t.endCrs(e)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"org",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"code",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"wkt",value:function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"codeString",value:function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&Lp(e.prototype,r),i&&Lp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Np(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ip=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bb=null,this.bb_pos=0}var e,r,i;return e=t,i=[{key:"getRootAsHeader",value:function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"getSizePrefixedRootAsHeader",value:function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)}},{key:"startHeader",value:function(t){t.startObject(14)}},{key:"addName",value:function(t,e){t.addFieldOffset(0,e,0)}},{key:"addEnvelope",value:function(t,e){t.addFieldOffset(1,e,0)}},{key:"createEnvelopeVector",value:function(t,e){t.startVector(8,e.length,8);for(var r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}},{key:"startEnvelopeVector",value:function(t,e){t.startVector(8,e,8)}},{key:"addGeometryType",value:function(t,e){t.addFieldInt8(2,e,ep.Unknown)}},{key:"addHasZ",value:function(t,e){t.addFieldInt8(3,+e,0)}},{key:"addHasM",value:function(t,e){t.addFieldInt8(4,+e,0)}},{key:"addHasT",value:function(t,e){t.addFieldInt8(5,+e,0)}},{key:"addHasTm",value:function(t,e){t.addFieldInt8(6,+e,0)}},{key:"addColumns",value:function(t,e){t.addFieldOffset(7,e,0)}},{key:"createColumnsVector",value:function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}},{key:"startColumnsVector",value:function(t,e){t.startVector(4,e,4)}},{key:"addFeaturesCount",value:function(t,e){t.addFieldInt64(8,e,BigInt("0"))}},{key:"addIndexNodeSize",value:function(t,e){t.addFieldInt16(9,e,16)}},{key:"addCrs",value:function(t,e){t.addFieldOffset(10,e,0)}},{key:"addTitle",value:function(t,e){t.addFieldOffset(11,e,0)}},{key:"addDescription",value:function(t,e){t.addFieldOffset(12,e,0)}},{key:"addMetadata",value:function(t,e){t.addFieldOffset(13,e,0)}},{key:"endHeader",value:function(t){return t.endObject()}},{key:"finishHeaderBuffer",value:function(t,e){t.finish(e)}},{key:"finishSizePrefixedHeaderBuffer",value:function(t,e){t.finish(e,void 0,!0)}}],(r=[{key:"__init",value:function(t,e){return this.bb_pos=t,this.bb=e,this}},{key:"name",value:function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"envelope",value:function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}},{key:"envelopeLength",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"envelopeArray",value:function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}},{key:"geometryType",value:function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):ep.Unknown}},{key:"hasZ",value:function(){var t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasM",value:function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasT",value:function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"hasTm",value:function(){var t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}},{key:"columns",value:function(t,e){var r=this.bb.__offset(this.bb_pos,18);return r?(e||new xp).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}},{key:"columnsLength",value:function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}},{key:"featuresCount",value:function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}},{key:"indexNodeSize",value:function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}},{key:"crs",value:function(t){var e=this.bb.__offset(this.bb_pos,24);return e?(t||new Pp).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}},{key:"title",value:function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"description",value:function(t){var e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}},{key:"metadata",value:function(t){var e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}}])&&Np(e.prototype,r),i&&Np(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Fp(t){for(var e=Ip.getRootAsHeader(t),r=e.featuresCount(),i=e.indexNodeSize(),s=[],n=0;n<e.columnsLength();n++){var a=e.columns(n);if(!a)throw new Error("Column unexpectedly missing");if(!a.name())throw new Error("Column name unexpectedly missing");s.push({name:a.name(),type:a.type(),title:a.title(),description:a.description(),width:a.width(),precision:a.precision(),scale:a.scale(),nullable:a.nullable(),unique:a.unique(),primary_key:a.primaryKey()})}var o=e.crs(),l=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:s,envelope:null,featuresCount:Number(r),indexNodeSize:i,crs:l,title:e.title(),description:e.description(),metadata:e.metadata()}}var kp=function(t,e){return(kp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Dp(t,e,r,i){return new(r||(r=Promise))(function(s,n){function a(t){try{l(i.next(t))}catch(t){n(t)}}function o(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,o)}l((i=i.apply(t,e||[])).next())})}function Rp(t,e){var r,i,s,n,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){a.label=n[1];break}if(6===n[0]&&a.label<s[1]){a.label=s[1],s=n;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(n);break}s[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function Bp(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gp(t){return this instanceof Gp?(this.v=t,this):new Gp(t)}function Up(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,s=r.apply(t,e||[]),n=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(t){s[t]&&(i[t]=function(e){return new Promise(function(r,i){n.push([t,e,r,i])>1||o(t,e)})})}function o(t,e){try{(r=s[t](e)).value instanceof Gp?Promise.resolve(r.value.v).then(l,h):u(n[0][2],r)}catch(t){u(n[0][3],t)}var r}function l(t){o("next",t)}function h(t){o("throw",t)}function u(t,e){t(e),n.shift(),n.length&&o(n[0][0],n[0][1])}}var jp=function(t){function e(e){var r=t.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,r.constructor),r}return function(t,e){function r(){this.constructor=t}kp(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error);(function(){function t(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),t.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();function zp(t){null!=t&&"function"==typeof t.then&&t.then(Xp,Xp)}var Vp=0,Jp=1,qp=2,Hp=3,Wp=4,Yp=1024,Xp=function(){};function Qp(t){var e=t.err,r=Promise.resolve(t.execution).then(function(t){if(null!=e)throw e;return t});return t.err=void 0,t.execution=r.then(function(){},function(){}),void 0===t.pending?r:t.pending.then(function(){return r})}function Zp(t,e){var r=t.state>=Hp;return Promise.resolve(e).then(function(e){return!r&&t.state>=Wp?Qp(t).then(function(t){return{value:t,done:!0}}):{value:e,done:r}})}function Kp(t,e){var r,i;if(!(t.state>=qp))if(t.state=qp,t.onnext(),t.onstop(),null==t.err&&(t.err=e),0!==t.pushes.length||void 0!==t.buffer&&!t.buffer.empty)try{for(var s=Bp(t.pushes),n=s.next();!n.done;n=s.next()){n.value.resolve()}}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}else $p(t)}function $p(t){var e,r;if(!(t.state>=Hp)){t.state<qp&&Kp(t),t.state=Hp,t.buffer=void 0;try{for(var i=Bp(t.nexts),s=i.next();!s.done;s=i.next()){var n=s.value,a=void 0===t.pending?Qp(t):t.pending.then(function(){return Qp(t)});n.resolve(Zp(t,a))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}t.pushes=[],t.nexts=[]}}function tf(t){t.state>=Wp||(t.state<Hp&&$p(t),t.state=Wp)}function ef(t){if(!(t.state>=Jp)){t.state=Jp;var e=function(t,e){if(zp(e),t.pushes.length>=Yp)throw new jp("No more than "+Yp+" pending calls to push are allowed on a single repeater.");if(t.state>=qp)return Promise.resolve(void 0);var r,i=void 0===t.pending?Promise.resolve(e):t.pending.then(function(){return e});i=i.catch(function(e){t.state<qp&&(t.err=e),tf(t)}),t.nexts.length?(t.nexts.shift().resolve(Zp(t,i)),r=t.nexts.length?Promise.resolve(t.nexts[0].value):new Promise(function(e){return t.onnext=e})):void 0===t.buffer||t.buffer.full?r=new Promise(function(e){return t.pushes.push({resolve:e,value:i})}):(t.buffer.add(i),r=Promise.resolve(void 0));var s=!0,n={},a=r.catch(function(t){if(s)throw t});return n.then=function(t,e){return s=!1,Promise.prototype.then.call(r,t,e)},n.catch=function(t){return s=!1,Promise.prototype.catch.call(r,t)},n.finally=r.finally.bind(r),t.pending=i.then(function(){return a}).catch(function(e){t.err=e,tf(t)}),n}.bind(null,t),r=function(t){var e=Kp.bind(null,t),r=new Promise(function(e){return t.onstop=e});return e.then=r.then.bind(r),e.catch=r.catch.bind(r),e.finally=r.finally.bind(r),e}(t);t.execution=new Promise(function(i){return i(t.executor(e,r))}),t.execution.catch(function(){return Kp(t)})}}var rf=new WeakMap,sf=function(){function t(t,e){rf.set(this,{executor:t,buffer:e,err:void 0,state:Vp,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Xp,onstop:Xp})}return t.prototype.next=function(t){zp(t);var e=rf.get(this);if(void 0===e)throw new Error("WeakMap error");if(e.nexts.length>=Yp)throw new jp("No more than "+Yp+" pending calls to next are allowed on a single repeater.");if(e.state<=Vp&&ef(e),e.onnext(t),void 0!==e.buffer&&!e.buffer.empty){var r=Zp(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return r}if(e.pushes.length){var s=e.pushes.shift();return e.onnext=s.resolve,Zp(e,s.value)}return e.state>=qp?($p(e),Zp(e,Qp(e))):new Promise(function(r){return e.nexts.push({resolve:r,value:t})})},t.prototype.return=function(t){zp(t);var e=rf.get(this);if(void 0===e)throw new Error("WeakMap error");return $p(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),Zp(e,Qp(e))},t.prototype.throw=function(t){var e=rf.get(this);if(void 0===e)throw new Error("WeakMap error");return e.state<=Vp||e.state>=qp||void 0!==e.buffer&&!e.buffer.empty?($p(e),null==e.err&&(e.err=t),Zp(e,Qp(e))):this.next(Promise.reject(t))},t.prototype[Symbol.asyncIterator]=function(){return this},t.race=af,t.merge=of,t.zip=lf,t.latest=hf,t}();function nf(t,e){var r,i,s=[],n=function(t){null!=t&&"function"==typeof t[Symbol.asyncIterator]?s.push(t[Symbol.asyncIterator]()):null!=t&&"function"==typeof t[Symbol.iterator]?s.push(t[Symbol.iterator]()):s.push(function(){return Up(this,arguments,function(){return Rp(this,function(r){switch(r.label){case 0:return e.yieldValues?[4,Gp(t)]:[3,3];case 1:return[4,r.sent()];case 2:r.sent(),r.label=3;case 3:return e.returnValues?[4,Gp(t)]:[3,5];case 4:return[2,r.sent()];case 5:return[2]}})})}())};try{for(var a=Bp(t),o=a.next();!o.done;o=a.next()){n(o.value)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s}function af(t){var e=this,r=nf(t,{returnValues:!0});return new sf(function(t,i){return Dp(e,void 0,void 0,function(){var e,s,n,a,o,l;return Rp(this,function(h){switch(h.label){case 0:if(!r.length)return i(),[2];s=!1,i.then(function(){e(),s=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),a=void 0,o=0,l=function(){var s,l,h,u,c,d;return Rp(this,function(p){switch(p.label){case 0:s=o;try{for(c=void 0,l=Bp(r),h=l.next();!h.done;h=l.next())u=h.value,Promise.resolve(u.next()).then(function(t){t.done?(i(),void 0===n&&(n=t)):o===s&&(o++,e(t))},function(t){return i(t)})}catch(t){c={error:t}}finally{try{h&&!h.done&&(d=l.return)&&d.call(l)}finally{if(c)throw c.error}}return[4,new Promise(function(t){return e=t})];case 1:return void 0===(a=p.sent())?[3,3]:[4,t(a.value)];case 2:p.sent(),p.label=3;case 3:return[2]}})},h.label=2;case 2:return s?[3,4]:[5,l()];case 3:return h.sent(),[3,2];case 4:return[2,n&&n.value];case 5:return i(),[4,Promise.race(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function of(t){var e=this,r=nf(t,{yieldValues:!0});return new sf(function(t,i){return Dp(e,void 0,void 0,function(){var e,s,n,a=this;return Rp(this,function(o){switch(o.label){case 0:if(!r.length)return i(),[2];e=[],s=!1,i.then(function(){var t,r;s=!0;try{for(var i=Bp(e),n=i.next();!n.done;n=i.next()){(0,n.value)()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,Promise.all(r.map(function(r,o){return Dp(a,void 0,void 0,function(){var a;return Rp(this,function(l){switch(l.label){case 0:l.trys.push([0,,6,9]),l.label=1;case 1:return s?[3,5]:(Promise.resolve(r.next()).then(function(t){return e[o](t)},function(t){return i(t)}),[4,new Promise(function(t){e[o]=t})]);case 2:return void 0===(a=l.sent())?[3,4]:a.done?(n=a,[2]):[4,t(a.value)];case 3:l.sent(),l.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return r.return?[4,r.return()]:[3,8];case 7:l.sent(),l.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return o.sent(),[2,n&&n.value];case 3:return i(),[7];case 4:return[2]}})})})}function lf(t){var e=this,r=nf(t,{returnValues:!0});return new sf(function(t,i){return Dp(e,void 0,void 0,function(){var e,s,n,a;return Rp(this,function(o){switch(o.label){case 0:if(!r.length)return i(),[2,[]];s=!1,i.then(function(){e(),s=!0}),o.label=1;case 1:o.trys.push([1,,6,8]),o.label=2;case 2:return s?[3,5]:(Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return i(t)}),[4,new Promise(function(t){return e=t})]);case 3:return void 0===(n=o.sent())?[2]:(a=n.map(function(t){return t.value}),n.some(function(t){return t.done})?[2,a]:[4,t(a)]);case 4:return o.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 7:return o.sent(),[7];case 8:return[2]}})})})}function hf(t){var e=this,r=nf(t,{yieldValues:!0,returnValues:!0});return new sf(function(t,i){return Dp(e,void 0,void 0,function(){var e,s,n,a,o,l=this;return Rp(this,function(h){switch(h.label){case 0:if(!r.length)return i(),[2,[]];s=[],n=!1,i.then(function(){var t,r;e();try{for(var i=Bp(s),a=i.next();!a.done;a=i.next()){(0,a.value)()}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}n=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return i(t)}),[4,new Promise(function(t){return e=t})];case 2:return void 0===(a=h.sent())?[2]:(o=a.map(function(t){return t.value}),a.every(function(t){return t.done})?[2,o]:[4,t(o.slice())]);case 3:return h.sent(),[4,Promise.all(r.map(function(e,r){return Dp(l,void 0,void 0,function(){var l;return Rp(this,function(h){switch(h.label){case 0:if(a[r].done)return[2,a[r].value];h.label=1;case 1:return n?[3,4]:(Promise.resolve(e.next()).then(function(t){return s[r](t)},function(t){return i(t)}),[4,new Promise(function(t){return s[r]=t})]);case 2:return void 0===(l=h.sent())?[2,a[r].value]:l.done?[2,l.value]:(o[r]=l.value,[4,t(o.slice())]);case 3:return h.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function uf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var cf,df=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._extraRequestThreshold=262144}var e,r,i;return e=t,(r=[{key:"extraRequestThreshold",value:function(){return this._extraRequestThreshold}},{key:"setExtraRequestThreshold",value:function(t){if(t<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}}])&&uf(e.prototype,r),i&&uf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}df.global=new df,function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error"}(cf||(cf={}));var ff=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,i;return e=t,i=[{key:"debug",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[cf.Debug].concat(e))}},{key:"info",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[cf.Info].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[cf.Warn].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log.apply(this,[cf.Error].concat(e))}},{key:"log",value:function(t){if(!(this.logLevel>t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];switch(t){case cf.Debug:var s;(s=console).debug.apply(s,r);break;case cf.Info:var n;(n=console).info.apply(n,r);break;case cf.Warn:var a;(a=console).warn.apply(a,r);break;case cf.Error:var o;(o=console).error.apply(o,r)}}}}],(r=null)&&pf(e.prototype,r),i&&pf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function mf(t){"@babel/helpers - typeof";return(mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yf(){yf=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,i){var s=e&&e.prototype instanceof c?e:c,n=Object.create(s.prototype),a=new w(i||[]);return n._invoke=function(t,e,r){var i="suspendedStart";return function(s,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===s)throw n;return M()}for(r.method=s,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var l=h(t,e,r);if("normal"===l.type){if(i=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,s,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==e&&r.call(y,s)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var i;this._invoke=function(s,n){function a(){return new e(function(i,a){!function i(s,n,a,o){var l=h(t[s],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==mf(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){i("next",t,a,o)},function(t){i("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return i("throw",t,a,o)})}o(l.arg)}(s,n,i,a)})}return i=i?i.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var s=i.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,i,s,n){void 0===n&&(n=Promise);var a=new b(l(e,r,i,s),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,s,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=C,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(r,i){return a.type="throw",a.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],a=n.completion;if("root"===n.tryLoc)return i("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return i(n.catchLoc,!0);if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return i(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return i(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var s=i.arg;x(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function gf(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var i,s,n=[],a=!0,o=!1;try{for(r=r.call(t);!(a=(i=r.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(t){o=!0,s=t}finally{try{a||null==r.return||r.return()}finally{if(o)throw s}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return vf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vf(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function bf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _f(t){var e,r;function i(e,r){try{var n=t[e](r),a=n.value,o=a instanceof xf;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return i(l,r);r=t[l](r).value}s(n.done?"return":"normal",r)},function(t){i("throw",t)})}catch(t){s("throw",t)}}function s(t,s){switch(t){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?i(e.key,e.arg):r=null}this._invoke=function(t,s){return new Promise(function(n,a){var o={key:t,arg:s,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,i(t,s))})},"function"!=typeof t.return&&(this.return=void 0)}function xf(t,e){this.v=t,this.k=e}ff.logLevel=cf.Info,_f.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},_f.prototype.next=function(t){return this._invoke("next",t)},_f.prototype.throw=function(t){return this._invoke("throw",t)},_f.prototype.return=function(t){return this._invoke("return",t)};var wf=40;function Cf(t,e){e=Math.min(Math.max(+e,2),65535);var r=t,i=r;do{i+=r=Math.ceil(r/e)}while(1!==r);return i*wf}function Mf(t,e){if(e<2)throw new Error("Node size must be at least 2");if(0===t)throw new Error("Number of items must be greater than 0");var r=t,i=r,s=[r];do{i+=r=Math.ceil(r/e),s.push(r)}while(1!==r);var n=[];r=i;for(var a=0,o=s;a<o.length;a++){var l=o[a];n.push(r-l),r-=l}n.reverse(),s.reverse();for(var h=[],u=0;u<s.length;u++)h.push([n[u],n[u]+s[u]]);return h.reverse(),h}function Af(t,e,r,i){return Tf.apply(this,arguments)}function Tf(){var t;return t=yf().mark(function t(e,r,i,s){var n,a,o,l,h,u,c,d,p,f;return yf().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=function(){function t(e,r){bf(this,t),this._level=r,this.nodes=e}var e,r,i;return e=t,(r=[{key:"level",value:function(){return this._level}},{key:"startNode",value:function(){return this.nodes[0]}},{key:"endNode",value:function(){return this.nodes[1]}},{key:"extendEndNodeToNewOffset",value:function(t){console.assert(t>this.nodes[1]),this.nodes[1]=t}},{key:"toString",value:function(){return"[NodeRange level: ".concat(this._level,", nodes: ").concat(this.nodes[0],"-").concat(this.nodes[1],"]")}}])&&Sf(e.prototype,r),i&&Sf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),a=i.minX,o=i.minY,l=i.maxX,h=i.maxY,ff.info("tree items: ".concat(e,", nodeSize: ").concat(r)),u=Mf(e,r),c=u[0][0],void 0,m=u.length-1,d=new n([0,1],m),p=[d],ff.debug("starting stream search with queue: ".concat(p,", numItems: ").concat(e,", nodeSize: ").concat(r,", levelBounds: ").concat(u)),f=yf().mark(function t(){var i,d,f,m,y,g,v,b,S,_,x,w;return yf().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=p.shift(),ff.debug("popped node: ".concat(i,", queueLength: ").concat(p.length)),d=i.startNode(),f=d>=c,m=gf(u[i.level()],2),y=m[1],g=Math.min(i.endNode()+r,y),v=g-d,t.next=9,new xf(s(d*wf,v*wf),0);case 9:b=t.sent,S=new Float64Array(b),_=new Uint32Array(b),x=yf().mark(function t(r){var s,u,m,y,g,v,b,x;return yf().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(l<S[(s=5*(r-d))+0])){t.next=3;break}return t.abrupt("return",0);case 3:if(!(h<S[s+1])){t.next=5;break}return t.abrupt("return",0);case 5:if(!(a>S[s+2])){t.next=7;break}return t.abrupt("return",0);case 7:if(!(o>S[s+3])){t.next=9;break}return t.abrupt("return",0);case 9:if(u=_[8+(s<<1)],m=_[9+(s<<1)],y=Ef(m,u),!f){t.next=17;break}return g=function(){if(r<e-1){var t=5*(r-d+1),i=_[8+(t<<1)];return Ef(_[9+(t<<1)],i)-y}return null}(),t.next=16,[y,r-c,g];case 16:return t.abrupt("return",0);case 17:if(v=df.global.extraRequestThreshold()/wf,!(void 0!==(b=p[p.length-1])&&b.level()==i.level()-1&&y<b.endNode()+v)){t.next=23;break}return ff.debug('Merging "nodeRange" request into existing range: '.concat(b,", newOffset: ").concat(b.endNode()," -> ").concat(y)),b.extendEndNodeToNewOffset(y),t.abrupt("return",0);case 23:void 0,w=i.level()-1,x=new n([y,y+1],w),void 0!==b&&b.level()==x.level()?ff.info("Same level, but too far away. Pushing new request at offset: ".concat(y," rather than merging with distant ").concat(b)):ff.info("Pushing new level for ".concat(x," onto queue with nearestNodeRange: ").concat(b," since there's not already a range for this level.")),p.push(x);case 26:case"end":return t.stop()}var w},t)}),w=d;case 14:if(!(w<g)){t.next=22;break}return t.delegateYield(x(w),"t0",16);case 16:if(0!==t.t0){t.next=19;break}return t.abrupt("continue",19);case 19:w++,t.next=14;break;case 22:case"end":return t.stop()}},t)});case 9:if(0==p.length){t.next=13;break}return t.delegateYield(f(),"t0",11);case 11:t.next=9;break;case 13:case"end":return t.stop()}var m},t)}),(Tf=function(){return new _f(t.apply(this,arguments))}).apply(this,arguments)}function Ef(t,e){if(0!=(4293918720&t))throw Error("integer is too large to be safely represented");return e+t*Math.pow(2,32)}var Of=new Uint8Array([102,103,98,3,102,103,98,0]),Lf=4;function Pf(t){"@babel/helpers - typeof";return(Pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nf(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Ff(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,s=function(){};return{s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){o=!0,n=t},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw n}}}}function If(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var i,s,n=[],a=!0,o=!1;try{for(r=r.call(t);!(a=(i=r.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(t){o=!0,s=t}finally{try{a||null==r.return||r.return()}finally{if(o)throw s}}return n}(t,e)||Ff(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ff(t,e){if(t){if("string"==typeof t)return kf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?kf(t,e):void 0}}function kf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Df(){Df=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,i){var s=e&&e.prototype instanceof c?e:c,n=Object.create(s.prototype),a=new w(i||[]);return n._invoke=function(t,e,r){var i="suspendedStart";return function(s,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===s)throw n;return M()}for(r.method=s,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var l=h(t,e,r);if("normal"===l.type){if(i=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,s,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==e&&r.call(y,s)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var i;this._invoke=function(s,n){function a(){return new e(function(i,a){!function i(s,n,a,o){var l=h(t[s],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==Pf(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){i("next",t,a,o)},function(t){i("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return i("throw",t,a,o)})}o(l.arg)}(s,n,i,a)})}return i=i?i.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var s=i.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,i,s,n){void 0===n&&(n=Promise);var a=new b(l(e,r,i,s),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,s,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=C,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(r,i){return a.type="throw",a.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],a=n.completion;if("root"===n.tryLoc)return i("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return i(n.catchLoc,!0);if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return i(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return i(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var s=i.arg;x(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function Rf(t,e,r,i,s,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(i,s)}function Bf(t){return function(){var e=this,r=arguments;return new Promise(function(i,s){var n=t.apply(e,r);function a(t){Rf(n,i,s,a,o,"next",t)}function o(t){Rf(n,i,s,a,o,"throw",t)}a(void 0)})}}function Gf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Uf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jf(t,e,r){return e&&Uf(t.prototype,e),r&&Uf(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function zf(t){return function(){return new Vf(t.apply(this,arguments))}}function Vf(t){var e,r;function i(e,r){try{var n=t[e](r),a=n.value,o=a instanceof Hf;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return i(l,r);r=t[l](r).value}s(n.done?"return":"normal",r)},function(t){i("throw",t)})}catch(t){s("throw",t)}}function s(t,s){switch(t){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?i(e.key,e.arg):r=null}this._invoke=function(t,s){return new Promise(function(n,a){var o={key:t,arg:s,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,i(t,s))})},"function"!=typeof t.return&&(this.return=void 0)}function Jf(t){return new Hf(t,0)}function qf(t){var e={},r=!1;function i(e,i){return r=!0,{done:!1,value:new Hf(i=new Promise(function(r){r(t[e](i))}),1)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(t){return r?(r=!1,t):i("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(r)throw r=!1,t;return i("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return r?(r=!1,t):i("return",t)}),e}function Hf(t,e){this.v=t,this.k=e}function Wf(t){var e,r,i,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);s--;){if(r&&null!=(e=t[r]))return e.call(t);if(i&&null!=(e=t[i]))return new Yf(e.call(t));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Yf(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(Yf=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new Yf(t)}Vf.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Vf.prototype.next=function(t){return this._invoke("next",t)},Vf.prototype.throw=function(t){return this._invoke("throw",t)},Vf.prototype.return=function(t){return this._invoke("return",t)};var Xf=function(){function t(e,r,i,s){Gf(this,t),this.headerClient=e,this.header=r,this.headerLength=i,this.indexLength=s}return jf(t,[{key:"selectBbox",value:function(t){var e=this;return zf(Df().mark(function r(){var i,s,n,a,o,l,h,u,c,d,p,f,m,y,g,v,b,S,_;return Df().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=e.lengthBeforeTree(),s=e.headerClient,n=function(){var t=Bf(Df().mark(function t(e,r){var n;return Df().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,t.abrupt("return",s.getRange(i+e,r,n,"index"));case 2:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}(),a=[],o=[],l=!1,h=!1,r.prev=7,c=Wf(Af(e.header.featuresCount,e.header.indexNodeSize,t,n));case 9:return r.next=11,Jf(c.next());case 11:if(!(l=!(d=r.sent).done)){r.next=26;break}if(p=d.value,f=If(p,2),m=f[0],y=If(p,3),(g=y[2])||(ff.info("final feature"),v=df.global.extraRequestThreshold(),g=v),0!=o.length){r.next=19;break}return o.push([m,g]),r.abrupt("continue",23);case 19:b=o[o.length-1],(S=m-(b[0]+b[1]))>df.global.extraRequestThreshold()&&(ff.info("Pushing new feature batch, since gap ".concat(S," was too large")),a.push(o),o=[]),o.push([m,g]);case 23:l=!1,r.next=9;break;case 26:r.next=32;break;case 28:r.prev=28,r.t0=r.catch(7),h=!0,u=r.t0;case 32:if(r.prev=32,r.prev=33,!l||null==c.return){r.next=37;break}return r.next=37,Jf(c.return());case 37:if(r.prev=37,!h){r.next=40;break}throw u;case 40:return r.finish(37);case 41:return r.finish(32);case 42:return e.headerClient.logUsage("header+index"),o.length>0&&a.push(o),_=a.flatMap(function(t){return e.readFeatureBatch(t)}),r.delegateYield(qf(Wf(sf.merge(_))),"t1",46);case 46:case"end":return r.stop()}},r,null,[[7,28,32,42],[33,,37,41]])}))()}},{key:"lengthBeforeTree",value:function(){return Of.length+Lf+this.headerLength}},{key:"lengthBeforeFeatures",value:function(){return this.lengthBeforeTree()+this.indexLength}},{key:"buildFeatureClient",value:function(){return new Qf(this.headerClient.httpClient)}},{key:"readFeatureBatch",value:function(t){var e=this;return zf(Df().mark(function r(){var i,s,n,a,o,l,h,u,c,d,p;return Df().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=If(t[0],1),s=i[0],n=If(t[t.length-1],2),a=n[0],o=n[1],l=a+o-s,h=e.buildFeatureClient(),u=Nf(t),r.prev=7,u.s();case 9:if((c=u.n()).done){r.next=17;break}return d=If(c.value,1),p=d[0],r.next=13,Jf(e.readFeature(h,p,l));case 13:return r.next=15,r.sent;case 15:r.next=9;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r.catch(7),u.e(r.t0);case 22:return r.prev=22,u.f(),r.finish(22);case 25:h.logUsage("feature");case 26:case"end":return r.stop()}},r,null,[[7,19,22,25]])}))()}},{key:"readFeature",value:function(){var t=Bf(Df().mark(function t(e,r,i){var s,n,a,o,l,h,u;return Df().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=r+this.lengthBeforeFeatures(),t.next=3,e.getRange(s,4,i,"feature length");case 3:return a=t.sent,n=new DataView(a).getUint32(0,!0),t.next=7,e.getRange(s+4,n,i,"feature data");case 7:return o=t.sent,l=new Uint8Array(o),(h=new Uint8Array(n+Lf)).set(l,Lf),(u=new fp(h)).setPosition(Lf),t.abrupt("return",Cp.getRootAsFeature(u));case 14:case"end":return t.stop()}},t,this)}));return function(e,r,i){return t.apply(this,arguments)}}()}],[{key:"open",value:function(){var e=Bf(Df().mark(function e(r){var i,s,n,a,o,l,h,u,c,d,p;return Df().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=2024,s=new Qf(r),n=function(){var t,e=0;for(t=0;t<3;t++){e+=Math.pow(16,t)*wf}return e}(),a=i+n,ff.debug("fetching header. minReqLength: ".concat(a," (assumedHeaderLength: ").concat(i,", assumedIndexLength: ").concat(n,")")),e.t0=Uint8Array,e.next=8,s.getRange(0,8,a,"header");case 8:if(e.t1=e.sent,(o=new e.t0(e.t1)).subarray(0,3).every(function(t,e){return Of[e]===t})){e.next=13;break}throw ff.error("bytes: ".concat(o," != ").concat(Of)),new Error("Not a FlatGeobuf file");case 13:return ff.debug("magic bytes look good"),e.next=16,s.getRange(8,4,a,"header");case 16:if(h=e.sent,!((l=new DataView(h).getUint32(0,!0))>10485760||l<8)){e.next=21;break}throw new Error("Invalid header size");case 21:return ff.debug("headerLength: ".concat(l)),e.next=24,s.getRange(12,l,a,"header");case 24:return u=e.sent,c=new fp(new Uint8Array(u)),d=Fp(c),p=Cf(d.featuresCount,d.indexNodeSize),ff.debug("completed: opening http reader"),e.abrupt("return",new t(s,d,l,p));case 30:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),t}(),Qf=function(){function t(e){Gf(this,t),this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,this.httpClient="string"==typeof e?new Zf(e):e}return jf(t,[{key:"getRange",value:function(){var t=Bf(Df().mark(function t(e,r,i,s){var n,a,o;return Df().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.bytesEverUsed+=r,n=e-this.head,a=n+r,!(n>=0&&a<=this.buffer.byteLength)){t.next=5;break}return t.abrupt("return",this.buffer.slice(n,a));case 5:return o=Math.max(r,i),this.bytesEverFetched+=o,ff.debug("requesting for new Range: ".concat(e,"-").concat(e+r-1)),t.next=10,this.httpClient.getRange(e,o,s);case 10:return this.buffer=t.sent,this.head=e,t.abrupt("return",this.buffer.slice(0,r));case 13:case"end":return t.stop()}},t,this)}));return function(e,r,i,s){return t.apply(this,arguments)}}()},{key:"logUsage",value:function(t){var e=t.split(" ")[0],r=this.bytesEverUsed,i=this.bytesEverFetched,s=(100*r/i).toFixed(2);ff.info("".concat(e," bytes used/requested: ").concat(r," / ").concat(i," = ").concat(s,"%"))}}]),t}(),Zf=function(){function t(e){Gf(this,t),this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e}return jf(t,[{key:"getRange",value:function(){var t=Bf(Df().mark(function t(e,r,i){var s,n;return Df().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.requestsEverMade+=1,this.bytesEverRequested+=r,s="bytes=".concat(e,"-").concat(e+r-1),ff.info("request: #".concat(this.requestsEverMade,", purpose: ").concat(i,"), bytes: (this_request: ").concat(r,", ever: ").concat(this.bytesEverRequested,"), Range: ").concat(s)),t.next=6,fetch(this.url,{headers:{Range:s}});case 6:return n=t.sent,t.abrupt("return",n.arrayBuffer());case 8:case"end":return t.stop()}},t,this)}));return function(e,r,i){return t.apply(this,arguments)}}()}]),t}();function Kf(t){"@babel/helpers - typeof";return(Kf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $f(){$f=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,i){var s=e&&e.prototype instanceof c?e:c,n=Object.create(s.prototype),a=new w(i||[]);return n._invoke=function(t,e,r){var i="suspendedStart";return function(s,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===s)throw n;return M()}for(r.method=s,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var l=h(t,e,r);if("normal"===l.type){if(i=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,s,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==e&&r.call(y,s)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var i;this._invoke=function(s,n){function a(){return new e(function(i,a){!function i(s,n,a,o){var l=h(t[s],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==Kf(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){i("next",t,a,o)},function(t){i("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return i("throw",t,a,o)})}o(l.arg)}(s,n,i,a)})}return i=i?i.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var s=i.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,i,s,n){void 0===n&&(n=Promise);var a=new b(l(e,r,i,s),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,s,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=C,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(r,i){return a.type="throw",a.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],a=n.completion;if("root"===n.tryLoc)return i("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return i(n.catchLoc,!0);if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return i(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return i(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var s=i.arg;x(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function tm(t,e,r,i,s,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(i,s)}function em(t){return function(){var e=this,r=arguments;return new Promise(function(i,s){var n=t.apply(e,r);function a(t){tm(n,i,s,a,o,"next",t)}function o(t){tm(n,i,s,a,o,"throw",t)}a(void 0)})}}function rm(t){var e,r,i,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);s--;){if(r&&null!=(e=t[r]))return e.call(t);if(i&&null!=(e=t[i]))return new im(e.call(t));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function im(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(im=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new im(t)}function sm(t){return new om(t,0)}function nm(t){return function(){return new am(t.apply(this,arguments))}}function am(t){var e,r;function i(e,r){try{var n=t[e](r),a=n.value,o=a instanceof om;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return i(l,r);r=t[l](r).value}s(n.done?"return":"normal",r)},function(t){i("throw",t)})}catch(t){s("throw",t)}}function s(t,s){switch(t){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?i(e.key,e.arg):r=null}this._invoke=function(t,s){return new Promise(function(n,a){var o={key:t,arg:s,resolve:n,reject:a,next:null};r?r=r.next=o:(e=r=o,i(t,s))})},"function"!=typeof t.return&&(this.return=void 0)}function om(t,e){this.v=t,this.k=e}function lm(){return(lm=nm($f().mark(function t(e,r,i){var s,n,a,o,l,h,u,c,d,p;return $f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s="function"==typeof(f=e).slice?f:new Op("function"==typeof f.read?f:f.getReader()),n=function(){var t=em($f().mark(function t(e){return $f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.slice(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),t.t0=Uint8Array,t.next=5,sm(n(8,"magic bytes"));case 5:if(t.t1=t.sent,(a=new t.t0(t.t1)).subarray(0,3).every(function(t,e){return Of[e]===t})){t.next=9;break}throw new Error("Not a FlatGeobuf file");case 9:return t.t2=Uint8Array,t.next=12,sm(n(4,"header length"));case 12:return t.t3=t.sent,a=new t.t2(t.t3),o=new fp(a),l=o.readUint32(0),t.t4=Uint8Array,t.next=19,sm(n(l,"header data"));case 19:if(t.t5=t.sent,a=new t.t4(t.t5),o=new fp(a),h=Fp(o),i&&i(h),u=h.indexNodeSize,c=h.featuresCount,!(u>0)){t.next=29;break}return d=Cf(c,u),t.next=29,sm(n(d,"entire index, w/o rect"));case 29:return t.next=31,sm(um(n,h,r));case 31:if(!(p=t.sent)){t.next=36;break}return t.next=34,p;case 34:t.next=29;break;case 36:case"end":return t.stop()}var f},t)}))).apply(this,arguments)}function hm(){return(hm=nm($f().mark(function t(e,r,i,s){var n,a,o,l,h,u,c;return $f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,sm(Xf.open(e));case 2:n=t.sent,ff.debug("opened reader"),s&&s(n.header),a=!1,o=!1,t.prev=7,h=rm(n.selectBbox(r));case 9:return t.next=11,sm(h.next());case 11:if(!(a=!(u=t.sent).done)){t.next=18;break}return c=u.value,t.next=15,i(c,n.header);case 15:a=!1,t.next=9;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(7),o=!0,l=t.t0;case 24:if(t.prev=24,t.prev=25,!a||null==h.return){t.next=29;break}return t.next=29,sm(h.return());case 29:if(t.prev=29,!o){t.next=32;break}throw l;case 32:return t.finish(29);case 33:return t.finish(24);case 34:case"end":return t.stop()}},t,null,[[7,20,24,34],[25,,29,33]])}))).apply(this,arguments)}function um(t,e,r){return cm.apply(this,arguments)}function cm(){return(cm=em($f().mark(function t(e,r,i){var s,n,a,o,l;return $f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,e(4,"feature length");case 3:if(t.t1=t.sent,0!==(s=new t.t0(t.t1)).byteLength){t.next=7;break}return t.abrupt("return");case 7:return n=new fp(s),a=n.readUint32(0),t.t2=Uint8Array,t.next=12,e(a,"feature data");case 12:return t.t3=t.sent,s=new t.t2(t.t3),(o=new Uint8Array(a+4)).set(s,4),(n=new fp(o)).setPosition(Lf),l=Cp.getRootAsFeature(n),t.abrupt("return",i(l,r));case 20:case"end":return t.stop()}},t)}))).apply(this,arguments)}function dm(t,e){return{type:"FeatureCollection",features:function(t,e,r){if(!t.subarray(0,3).every(function(t,e){return Of[e]===t}))throw new Error("Not a FlatGeobuf file");var i=new fp(t),s=i.readUint32(Of.length);i.setPosition(Of.length+Lf);var n=Fp(i);r&&r(n);var a=Of.length+Lf+s,o=n.indexNodeSize,l=n.featuresCount;o>0&&(a+=Cf(l,o));for(var h=[];a<i.capacity();){var u=i.readUint32(a);i.setPosition(a+Lf);var c=Cp.getRootAsFeature(i);h.push(e(c,n)),a+=Lf+u}return h}(t,Tp,e)}}function pm(t,e){return function(t,e,r){return lm.apply(this,arguments)}(t,Tp,e)}function fm(t,e,r){return function(t,e,r,i){return hm.apply(this,arguments)}(t,e,Tp,r)}function mm(t,e,r){return t instanceof Uint8Array?dm(t,r):t instanceof ReadableStream?pm(t,r):fm(t,e,r)}function ym(t){"@babel/helpers - typeof";return(ym="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gm(){gm=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,r){return t[e]=r}}function l(t,e,r,i){var s=e&&e.prototype instanceof c?e:c,n=Object.create(s.prototype),a=new w(i||[]);return n._invoke=function(t,e,r){var i="suspendedStart";return function(s,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===s)throw n;return M()}for(r.method=s,r.arg=n;;){var a=r.delegate;if(a){var o=S(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var l=h(t,e,r);if("normal"===l.type){if(i=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i="completed",r.method="throw",r.arg=l.arg)}}}(t,r,a),n}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function c(){}function d(){}function p(){}var f={};o(f,s,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==e&&r.call(y,s)&&(f=y);var g=p.prototype=c.prototype=Object.create(f);function v(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var i;this._invoke=function(s,n){function a(){return new e(function(i,a){!function i(s,n,a,o){var l=h(t[s],t,n);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==ym(c)&&r.call(c,"__await")?e.resolve(c.__await).then(function(t){i("next",t,a,o)},function(t){i("throw",t,a,o)}):e.resolve(c).then(function(t){u.value=t,a(u)},function(t){return i("throw",t,a,o)})}o(l.arg)}(s,n,i,a)})}return i=i?i.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var s=i.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=p,o(g,"constructor",p),o(p,"constructor",d),d.displayName=o(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),o(b.prototype,n,function(){return this}),t.AsyncIterator=b,t.async=function(e,r,i,s,n){void 0===n&&(n=Promise);var a=new b(l(e,r,i,s),n);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},v(g),o(g,a,"Generator"),o(g,s,function(){return this}),o(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=C,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(r,i){return a.type="throw",a.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],a=n.completion;if("root"===n.tryLoc)return i("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return i(n.catchLoc,!0);if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return i(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return i(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var s=i.arg;x(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function vm(t,e,r,i,s,n,a){try{var o=t[n](a),l=o.value}catch(t){return void r(t)}o.done?e(l):Promise.resolve(l).then(i,s)}function bm(t){return function(){var e=this,r=arguments;return new Promise(function(i,s){var n=t.apply(e,r);function a(t){vm(n,i,s,a,o,"next",t)}function o(t){vm(n,i,s,a,o,"throw",t)}a(void 0)})}}function Sm(t){var e,r,i,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);s--;){if(r&&null!=(e=t[r]))return e.call(t);if(i&&null!=(e=t[i]))return new _m(e.call(t));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function _m(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(_m=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new _m(t)}am.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},am.prototype.next=function(t){return this._invoke("next",t)},am.prototype.throw=function(t){return this._invoke("throw",t)},am.prototype.return=function(t){return this._invoke("return",t)};var xm=wo().FeatureGroup.extend({initialize:function(t,e){this.options=e||{},this.strategy=this.options.strategy||"bbox",this._layers={},this.url=t,this.previousLayer=null,this.loadedExtentsRtree_=new(ap()),this.extent=this.options.extent,this._cacheIds=[],this._validatedId=!1,this._checked=!1,this.idField=this.options.idField||"SmID",this._updateFeaturesFn=this._updateFeatures.bind(this),wo().Util.setOptions(this,e)},onAdd:function(t){this.map=t;var e=[];if("bbox"===this.strategy){var r=t.getBounds();e=[r.getWest(),r.getSouth(),r.getEast(),r.getNorth()],t.on("moveend",this._updateFeaturesFn)}if(this.extent){var i=function(t,e){const r=[];return function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(t,e)&&(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]),r}(this.extent,e);e=i&&i.length?i:this.extent}this._handleFeatures(e)},onRemove:function(t){this.loadedExtentsRtree_.clear(),this.loadedExtentsRtree_=null,"bbox"===this.strategy&&(t.off("moveend",this._updateFeaturesFn),this._cacheIds=[])},_updateFeatures:function(){var t=bm(gm().mark(function t(e){var r,i,s,n=this;return gm().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.target,i=[r.getBounds().getSouthWest(),r.getBounds().getNorthEast()],s=[i[0].lng,i[0].lat,i[1].lng,i[1].lat],this._forEachInExtent(s,function(t){return n._containsExtent(t.extent,s)})||this._handleFeatures(s);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),_handleFeatures:function(){var t=bm(gm().mark(function t(e){var r,i,s,n,a,o,l,h,u,c;return gm().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},e.length){t.next=7;break}return t.next=4,this._getStream(this.url);case 4:r=t.sent,t.next=9;break;case 7:i.value={extent:e.slice()},this.loadedExtentsRtree_.insert(i);case 9:s=mm(r&&r.body||this.url,i),this._validatedId||(this.curLayer=wo().geoJSON(null,this.options),this.previousLayer&&this.removeLayer(this.previousLayer),this.previousLayer=this.curLayer,this.curLayer.addTo(this)),n=!1,a=!1,t.prev=13,l=Sm(s);case 15:return t.next=17,l.next();case 17:if(!(n=!(h=t.sent).done)){t.next=31;break}if(u=h.value,"bbox"!==this.strategy){t.next=26;break}if((c=u.properties[this.idField])&&!this._validatedId&&(this._validatedId=!0,this._checked=!0),!c||!this._checked){t.next=26;break}if(!this._cacheIds.includes(c)){t.next=25;break}return t.abrupt("continue",28);case 25:this._cacheIds.push(c);case 26:this.options.featureLoader&&"function"==typeof this.options.featureLoader&&(u=this.options.featureLoader(u)),this.curLayer.addData(u);case 28:n=!1,t.next=15;break;case 31:t.next=37;break;case 33:t.prev=33,t.t0=t.catch(13),a=!0,o=t.t0;case 37:if(t.prev=37,t.prev=38,!n||null==l.return){t.next=42;break}return t.next=42,l.return();case 42:if(t.prev=42,!a){t.next=45;break}throw o;case 45:return t.finish(42);case 46:return t.finish(37);case 47:case"end":return t.stop()}},t,this,[[13,33,37,47],[38,,42,46]])}));return function(e){return t.apply(this,arguments)}}(),_getStream:function(t){return bm(gm().mark(function e(){return gm().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt.get(t,{},{withoutFormatSuffix:!0}).then(function(t){return t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))()},_containsExtent:function(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]},_getInExtent:function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.loadedExtentsRtree_.search(e).map(function(t){return t.value})},_forEachInExtent:function(t,e){return this._forEach(this._getInExtent(t),e)},_forEach:function(t,e){for(var r,i=0,s=t.length;i<s;i++)if(r=e(t[i]))return r;return r}}),wm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._knowledgeGraphService=new class extends ie{constructor(t,e){super(t,e),this.options=e||{},this.CLASS_NAME="SuperMap.KnowledgeGraphService"}destroy(){super.destroy()}query(t,e){const r=rt.urlAppend(this.url+"/query.json",`cypherQuery=${encodeURI(t)}`);this.processAsync({url:r,method:"GET",callback:e})}getGraphMaps(t){const e=this.url+"/graphmaps.json";this.processAsync({url:e,method:"GET",callback:t})}getGraphMap(t,e){const r=this.url+`/graphmaps/${t}.json`;this.processAsync({url:r,method:"GET",callback:e})}async getGraphMapData(t){let e=[];const r=await this._getGraphMapData(t);if(!r)return;const i=r.dataContent.queries&&r.dataContent.queries.query||[];let s=[];s="string"==typeof i?[i]:i;const n=this._getGraphMapExpandQuery(r);n.length&&s.push(...n);for(let t=0;t<s.length;t++){const r=s[t],i=await this._queryDataBySql(r);e=e.concat([],i)}return{data:e,graphMap:r}}_getGraphMapExpandQuery(t){const e=[];return(t.dataContent.expand&&JSON.parse(t.dataContent.expand)||[]).forEach(t=>{e.push(`match p=(n)-[]-(m) where id(n)=${t} return p;`)}),e}processAsync({url:t,params:e,method:r,callback:i}){const s={method:r,url:t,scope:this,success:i,failure:i};return e&&(s.params=e),this.request(s)}_getGraphMapData(t){return new Promise((e,r)=>{this.getGraphMap(t,t=>{"processFailed"===t.type?r(t.error):""===t.result.data?r("æ æ°æ®"):e(t.result.graphMap)})})}_queryDataBySql(t){return new Promise((e,r)=>{this.query(t,t=>{"processFailed"===t.type?r(t.error):e(t.result)})})}}(this.url,e)},query(t,e){return this._knowledgeGraphService.query(t,e)},getGraphMaps(t){return this._knowledgeGraphService.getGraphMaps(t)},getGraphMap(t,e){return this._knowledgeGraphService.getGraphMap(t,e)},async getGraphMapData(t){return await this._knowledgeGraphService.getGraphMapData(t)}});var Cm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e);this._addressMatchService=new ae(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},code:function(t,e){return this._addressMatchService.code(rt.urlPathAppend(this.url,"geocoding"),t,e)},decode:function(t,e){return this._addressMatchService.decode(rt.urlPathAppend(this.url,"geodecoding"),t,e)}});var Mm=tc.extend({initialize:function(t,r){tc.prototype.initialize.call(this,t,r),this._chartServiceBase=new class{constructor(t,e){this.url=t,this.options=e||{}}queryChart(t,e,r){var i=this,s=t,n=i._processFormat(r);return new Ie(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:n}).processAsync(s,e)}getChartFeatureInfo(t){var e=this,r=rt.urlPathAppend(e.url,"chartFeatureInfoSpecs");return new Oe(r,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}_processFormat(t){return t||e.GEOJSON}}(t,r)},queryChart:function(t,e,r){return t=this._processParams(t),this._chartServiceBase.queryChart(t,e,r)},getChartFeatureInfo:function(t){return this._chartServiceBase.getChartFeatureInfo(t)},_processParams:function(t){if(!t)return{};t.returnContent=null==t.returnContent||t.returnContent,t.chartQueryFilterParameters&&!wo().Util.isArray(t.chartQueryFilterParameters)&&(t.chartQueryFilterParameters=[t.chartQueryFilterParameters]),t.bounds&&(t.bounds=nc.toSuperMapBounds(t.bounds))},_processFormat:function(t){return t||e.GEOJSON}}),Am=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._datasetService=new kr(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getDatasets:function(t,e){if(t)return this._datasetService.getDatasetsService(t,e)},getDataset:function(t,e,r){if(t&&e)return this._datasetService.getDatasetService(t,e,r)},setDataset(t,e){if(t instanceof an||t instanceof un){if(t instanceof an)var r={datasetType:t.datasetType,datasourceName:t.datasourceName,datasetName:t.datasetName};else t instanceof un&&(r={datasetName:t.datasetName,datasourceName:t.datasourceName,isFileCache:t.isFileCache,description:t.description,prjCoordSys:t.prjCoordSys,charset:t.charset});return this._datasetService.setDatasetService(r,e)}},deleteDataset:function(t,e,r){return this._datasetService.deleteDatasetService(t,e,r)}}),Tm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._datasourceService=new Ye(this.url,{proxy:this.proxy,withCredentials:this.withCredentials,crossOrigin:this.crossOrigin,headers:this.headers})},getDatasources:function(t){return this._datasourceService.getDatasourcesService(t)},getDatasource:function(t,e){if(t)return this._datasourceService.getDatasourceService(t,e)},setDatasource:function(t,e){if(!(t instanceof _s))return;const r={description:t.description,coordUnit:t.coordUnit,distanceUnit:t.distanceUnit,datasourceName:t.datasourceName};return this._datasourceService.setDatasourceService(r,e)}});var Em=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._fieldService=new class{constructor(t,e){this.url=t,this.options=e||{}}getFields(t,e){var r=this;return new Yr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,datasource:t.datasource,dataset:t.dataset}).processAsync(e)}getFieldStatisticsInfo(t,e){if(t instanceof pr){var r=this,i=t.fieldName,s=t.statisticMode;s&&!Array.isArray(s)&&(s=[s]),r.currentStatisticResult={fieldName:i},r._statisticsCallback=e,s.forEach(e=>{r.currentStatisticResult[e]=null,r._fieldStatisticRequest(t.datasource,t.dataset,i,e)})}}_fieldStatisticRequest(t,e,r,i){var s=this;new fr(s.url,{datasource:t,dataset:e,field:r,statisticMode:i,crossOrigin:s.options.crossOrigin,headers:s.options.headers}).processAsync(s._processCompleted.bind(s))}_processCompleted(t){var e=this;if(t.error)e._statisticsCallback(t);else{var r=!0,i=t.result;for(var s in this.currentStatisticResult&&null==e.currentStatisticResult[i.mode]&&(this.currentStatisticResult[i.mode]=i.result),e.currentStatisticResult)if(null==e.currentStatisticResult[s]){r=!1;break}r&&e._statisticsCallback({result:e.currentStatisticResult})}}}(t,e)},getFields:function(t,e){return this._fieldService.getFields(t,e)},getFieldStatisticsInfo:function(t,e){return this._fieldService.getFieldStatisticsInfo(t,e)}}),Om=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._gridCellQueryService=new Qr(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getGridCellInfos:function(t,e){return t?this._gridCellQueryService.processAsync(t,e):null}});const Lm=tc.extend({initialize:function(t,e){e=e||{},wo().setOptions(this,e),tc.prototype.initialize.call(this,t,e),this.headers={},this.crossOrigin=!0,this.withCredentials=!0,this.proxy=!0,this._geoprocessingJobsService=new Nr(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getTools:function(t){return this._geoprocessingJobsService.getTools(t)},getTool:function(t,e){return this._geoprocessingJobsService.getTool(t,e)},execute:function(t,e,r,i){return this._geoprocessingJobsService.execute(t,e,r,i)},submitJob:function(t,e,r,i){return this._geoprocessingJobsService.submitJob(t,e,r,i)},waitForJobCompletion:function(t,e,r,i){return this._geoprocessingJobsService.waitForJobCompletion(t,e,r,i)},getJobInfo:function(t,e,r){return this._geoprocessingJobsService.getJobInfo(t,e,r)},cancelJob:function(t,e,r){return this._geoprocessingJobsService.cancelJob(t,e,r)},getJobs:function(t,e){return this._geoprocessingJobsService.getJobs(t,e)},getResults:function(t,e,r,i){return this._geoprocessingJobsService.getResults(t,e,r,i)}});var Pm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._layerInfoService=new class{constructor(t,e){this.url=t,this.options=e||{}}getLayersInfo(t){var e=this;return new Ai(e.url,{proxy:e.options.proxy,withCredentials:e.options.withCredentials,crossOrigin:e.options.crossOrigin,headers:e.options.headers}).processAsync(t)}getLayersLegendInfo(t,e){var r=this;return new fs(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}setLayerInfo(t,e){if(t){var r=this,i=t.resourceID,s=t.tempLayerName,n=t.layerInfo;if(i&&s){var a=rt.urlPathAppend(r.url,"tempLayersSet/"+i+"/"+s);return new xs(a,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(n,e)}}}setLayersInfo(t,e){if(t){var r=this,i=t.resourceID,s=!!t.isTempLayers&&t.isTempLayers,n=t.layersInfo;if((!s||i)&&n)return new ws(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,resourceID:i,isTempLayers:s}).processAsync(n,e)}}setLayerStatus(t,e){if(t){var r=this;return new Ms(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}}(t,e)},getLayersInfo:function(t){return this._layerInfoService.getLayersInfo(t)},getLayersLegendInfo(t,e){return this._layerInfoService.getLayersLegendInfo(t,e)},setLayerInfo:function(t,e){return this._layerInfoService.setLayerInfo(t,e)},setLayersInfo:function(t,e){return this._layerInfoService.setLayersInfo(t,e)},setLayerStatus:function(t,e){return this._layerInfoService.setLayerStatus(t,e)}}),Nm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e)},measureDistance:function(t,e){return this.measure(o.DISTANCE,t,e)},measureArea:function(t,e){return this.measure(o.AREA,t,e)},measure:function(t,e,r){if(e instanceof Gi){var i=this;return e.geometry&&(e.geometry=vc(e.geometry)),new Ui(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,measureMode:t}).processAsync(e,r)}}});var Im=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._networkAnalyst3DService=new class{constructor(t,e){this.url=t,this.options=e||{}}sinksFacilityAnalyst(t,e){var r=this;return new er(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}sourcesFacilityAnalyst(t,e){var r=this;return new ir(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}traceUpFacilityAnalyst(t,e){var r=this;return new hr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}traceDownFacilityAnalyst(t,e){var r=this;return new or(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}upstreamFacilityAnalyst(t,e){var r=this;return new cr(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}(t,e)},sinksFacilityAnalyst:function(t,e){return this._networkAnalyst3DService.sinksFacilityAnalyst(t,e)},sourcesFacilityAnalyst:function(t,e){return this._networkAnalyst3DService.sourcesFacilityAnalyst(t,e)},traceUpFacilityAnalyst:function(t,e){return this._networkAnalyst3DService.traceUpFacilityAnalyst(t,e)},traceDownFacilityAnalyst:function(t,e){return this._networkAnalyst3DService.traceDownFacilityAnalyst(t,e)},upstreamFacilityAnalyst:function(t,e){return this._networkAnalyst3DService.upstreamFacilityAnalyst(t,e)}});var Fm=tc.extend({initialize:function(t,r){tc.prototype.initialize.call(this,t,r),this._networkAnalystService=new class{constructor(t,e){this.url=t,this.options=e||{}}burstPipelineAnalyst(t,e){var r=this;return new Ee(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}computeWeightMatrix(t,e){var r=this;return new Be(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}findClosestFacilities(t,e,r){var i=this;return new yr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}traceAnalyst(t,e,r){var i=this;return new cs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}connectedEdgesAnalyst(t,e,r){var i=this;return new ps(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}streamFacilityAnalyst(t,e,r){var i=this;return new nr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}findLocation(t,e,r){var i=this;return new vr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}findPath(t,e,r){var i=this;return new xr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}findTSPPaths(t,e,r){var i=this;return new Ar(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}findMTSPPaths(t,e,r){var i=this;return new Sr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}findServiceAreas(t,e,r){var i=this;return new Cr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}updateEdgeWeight(t,e){var r=this;return new on(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}updateTurnNodeWeight(t,e){var r=this;return new hn(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}_processFormat(t){return t||e.GEOJSON}}(t,r)},burstPipelineAnalyst:function(t,e){return t=this._processParams(t),this._networkAnalystService.burstPipelineAnalyst(t,e)},computeWeightMatrix:function(t,e){return t=this._processParams(t),this._networkAnalystService.computeWeightMatrix(t,e)},findClosestFacilities:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findClosestFacilities(t,e,r)},traceAnalyst(t,e,r){return t=this._processParams(t),this._networkAnalystService.traceAnalyst(t,e,r)},connectedEdgesAnalyst(t,e,r){return t=this._processParams(t),this._networkAnalystService.connectedEdgesAnalyst(t,e,r)},streamFacilityAnalyst:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.streamFacilityAnalyst(t,e,r)},findLocation:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findLocation(t,e,r)},findPath:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findPath(t,e,r)},findTSPPaths:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findTSPPaths(t,e,r)},findMTSPPaths:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findMTSPPaths(t,e,r)},findServiceAreas:function(t,e,r){return t=this._processParams(t),this._networkAnalystService.findServiceAreas(t,e,r)},updateEdgeWeight:function(t,e){return this._networkAnalystService.updateEdgeWeight(t,e)},updateTurnNodeWeight:function(t,e){return this._networkAnalystService.updateTurnNodeWeight(t,e)},_processParams:function(t){if(!t)return{};if(t.centers&&wo().Util.isArray(t.centers)&&t.centers.map(function(e,r){return t.centers[r]=e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e,t.centers[r]}),t.nodes&&wo().Util.isArray(t.nodes)&&t.nodes.map(function(e,r){return t.nodes[r]=e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e,t.nodes[r]}),t.event&&t.event instanceof wo().LatLng&&(t.event={x:t.event.lng,y:t.event.lat}),t.facilities&&wo().Util.isArray(t.facilities)&&t.facilities.map(function(e,r){return t.facilities[r]=e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e,t.facilities[r]}),t.parameter&&t.parameter.barrierPoints){var e=t.parameter.barrierPoints;wo().Util.isArray(e)?e.map(function(e,r){return t.parameter.barrierPoints[r]=e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e,t.parameter.barrierPoints[r]}):t.parameter.barrierPoints=[e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e]}return t},_processFormat:function(t){return t||e.GEOJSON}});var km=tc.extend({initialize:function(t,r){r=r||{},wo().setOptions(this,r),tc.prototype.initialize.call(this,t,r),this._processingService=new class{constructor(t,e){this.url=t,this.options=e||{},this.kernelDensityJobs={},this.summaryMeshJobs={},this.queryJobs={},this.summaryRegionJobs={},this.vectorClipJobs={},this.overlayGeoJobs={},this.buffersJobs={},this.topologyValidatorJobs={},this.summaryAttributesJobs={}}getKernelDensityJobs(t,e){var r=this,i=r._processFormat(e);return new Fi(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getKernelDensityJobs(t)}getKernelDensityJob(t,e,r){var i=this,s=i._processFormat(r);return new Fi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getKernelDensityJob(t,e)}addKernelDensityJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Fi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addKernelDensityJob(t,r,e,function(t){s.kernelDensityJobs[t.id]=t.state})}getKernelDensityJobState(t){return this.kernelDensityJobs[t]}getSummaryMeshJobs(t,e){var r=this,i=r._processFormat(e);return new Is(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getSummaryMeshJobs(t)}getSummaryMeshJob(t,e,r){var i=this,s=i._processFormat(r);return new Is(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getSummaryMeshJob(t,e)}addSummaryMeshJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Is(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addSummaryMeshJob(t,r,e,function(t){s.summaryMeshJobs[t.id]=t.state})}getSummaryMeshJobState(t){return this.summaryMeshJobs[t]}getQueryJobs(t,e){var r=this,i=r._processFormat(e);return new Ts(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getQueryJobs(t)}getQueryJob(t,e,r){var i=this,s=i._processFormat(r);return new Ts(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getQueryJob(t,e)}addQueryJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Ts(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addQueryJob(t,r,e,function(t){s.queryJobs[t.id]=t.state})}getQueryJobState(t){return this.queryJobs[t]}getSummaryRegionJobs(t,e){var r=this,i=r._processFormat(e);return new ks(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getSummaryRegionJobs(t)}getSummaryRegionJob(t,e,r){var i=this,s=i._processFormat(r);return new ks(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getSummaryRegionJob(t,e)}addSummaryRegionJob(t,e,r,i){var s=this,n=s._processFormat(i);return new ks(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addSummaryRegionJob(t,r,e,function(t){s.summaryRegionJobs[t.id]=t.state})}getSummaryRegionJobState(t){return this.summaryRegionJobs[t]}getVectorClipJobs(t,e){var r=this,i=r._processFormat(e);return new dn(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getVectorClipJobs(t)}getVectorClipJob(t,e,r){var i=this,s=i._processFormat(r);return new dn(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getVectorClipJob(t,e)}addVectorClipJob(t,e,r,i){var s=this,n=s._processFormat(i);return new dn(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addVectorClipJob(t,r,e,function(t){s.vectorClipJobs[t.id]=t.state})}getVectorClipJobState(t){return this.vectorClipJobs[t]}getOverlayGeoJobs(t,e){var r=this,i=r._processFormat(e);return new Vi(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getOverlayGeoJobs(t)}getOverlayGeoJob(t,e,r){var i=this,s=i._processFormat(r);return new Vi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getOverlayGeoJob(t,e)}addOverlayGeoJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Vi(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addOverlayGeoJob(t,r,e,function(t){s.overlayGeoJobs[t.id]=t.state})}getoverlayGeoJobState(t){return this.overlayGeoJobs[t]}getBuffersJobs(t,e){var r=this,i=r._processFormat(e);return new Me(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getBuffersJobs(t)}getBuffersJob(t,e,r){var i=this,s=i._processFormat(r);return new Me(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getBuffersJob(t,e)}addBuffersJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Me(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addBuffersJob(t,r,e,function(t){s.buffersJobs[t.id]=t.state})}getBuffersJobState(t){return this.buffersJobs[t]}getTopologyValidatorJobs(t,e){var r=this,i=r._processFormat(e);return new Ks(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getTopologyValidatorJobs(t)}getTopologyValidatorJob(t,e,r){var i=this,s=i._processFormat(r);return new Ks(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getTopologyValidatorJob(t,e)}addTopologyValidatorJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Ks(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addTopologyValidatorJob(t,r,e,function(t){s.topologyValidatorJobs[t.id]=t.state})}getTopologyValidatorJobState(t){return this.topologyValidatorJobs[t]}getSummaryAttributesJobs(t,e){var r=this,i=r._processFormat(e);return new Ps(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers,format:i}).getSummaryAttributesJobs(t)}getSummaryAttributesJob(t,e,r){var i=this,s=i._processFormat(r);return new Ps(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:s}).getSummaryAttributesJob(t,e)}addSummaryAttributesJob(t,e,r,i){var s=this,n=s._processFormat(i);return new Ps(s.url,{proxy:s.options.proxy,withCredentials:s.options.withCredentials,crossOrigin:s.options.crossOrigin,headers:s.options.headers,format:n}).addSummaryAttributesJob(t,r,e,function(t){s.summaryAttributesJobs[t.id]=t.state})}getSummaryAttributesJobState(t){return this.summaryAttributesJobs[t]}_processFormat(t){return t||e.GEOJSON}}(t,r)},getKernelDensityJobs:function(t,e){return this._processingService.getKernelDensityJobs(t,e)},getKernelDensityJob:function(t,e,r){return this._processingService.getKernelDensityJob(t,e,r)},addKernelDensityJob:function(t,e,r,i){let s=this._processParams(t);return this._processingService.addKernelDensityJob(s,e,r,i)},getKernelDensityJobState:function(t){return this._processingService.getKernelDensityJobState(t)},getSummaryMeshJobs:function(t,e){return this._processingService.getSummaryMeshJobs(t,e)},getSummaryMeshJob:function(t,e,r){return this._processingService.getSummaryMeshJob(t,e,r)},addSummaryMeshJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addSummaryMeshJob(t,e,r,i)},getSummaryMeshJobState:function(t){return this._processingService.getSummaryMeshJobState(t)},getQueryJobs:function(t,e){return this._processingService.getQueryJobs(t,e)},getQueryJob:function(t,e,r){return this._processingService.getQueryJob(t,e,r)},addQueryJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addQueryJob(t,e,r,i)},getQueryJobState:function(t){return this._processingService.getQueryJobState(t)},getSummaryRegionJobs:function(t,e){return this._processingService.getSummaryRegionJobs(t,e)},getSummaryRegionJob:function(t,e,r){return this._processingService.getSummaryRegionJob(t,e,r)},addSummaryRegionJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addSummaryRegionJob(t,e,r,i)},getSummaryRegionJobState:function(t){return this._processingService.getSummaryRegionJobState(t)},getVectorClipJobs:function(t,e){return this._processingService.getVectorClipJobs(t,e)},getVectorClipJob:function(t,e,r){return this._processingService.getVectorClipJob(t,e,r)},addVectorClipJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addVectorClipJob(t,e,r,i)},getVectorClipJobState:function(t){return this._processingService.getVectorClipJobState(t)},getOverlayGeoJobs:function(t,e){return this._processingService.getOverlayGeoJobs(t,e)},getOverlayGeoJob:function(t,e,r){return this._processingService.getOverlayGeoJob(t,e,r)},addOverlayGeoJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addOverlayGeoJob(t,e,r,i)},getoverlayGeoJobState:function(t){return this._processingService.getoverlayGeoJobState(t)},getBuffersJobs:function(t,e){return this._processingService.getBuffersJobs(t,e)},getBuffersJob:function(t,e,r){return this._processingService.getBuffersJob(t,e,r)},addBuffersJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addBuffersJob(t,e,r,i)},getBuffersJobState:function(t){return this._processingService.getBuffersJobState(t)},getTopologyValidatorJobs:function(t,e){return this._processingService.getTopologyValidatorJobs(t,e)},getTopologyValidatorJob:function(t,e,r){return this._processingService.getTopologyValidatorJob(t,e,r)},addTopologyValidatorJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addTopologyValidatorJob(t,e,r,i)},getTopologyValidatorJobState:function(t){return this._processingService.getTopologyValidatorJobState(t)},getSummaryAttributesJobs:function(t,e){return this._processingService.getSummaryAttributesJobs(t,e)},getSummaryAttributesJob:function(t,e,r){return this._processingService.getSummaryAttributesJob(t,e,r)},addSummaryAttributesJob:function(t,e,r,i){return t=this._processParams(t),this._processingService.addSummaryAttributesJob(t,e,r,i)},getSummaryAttributesJobState:function(t){return this._processingService.getSummaryAttributesJobState(t)},_processParams:function(t){return t?(t.bounds&&(t.bounds=nc.toSuperMapBounds(t.bounds)),t.query&&(t.query=nc.toSuperMapBounds(t.query)),t.geometryQuery&&(t.geometryQuery=nc.toProcessingParam(t.geometryQuery)),t.geometryClip&&(t.geometryClip=nc.toProcessingParam(t.geometryClip)),t):{}}}),Dm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._queryService=new ms(t,e)},queryByBounds:function(t,e,r){return t=this._processParams(t),this._queryService.queryByBounds(t,e,r)},queryByDistance:function(t,e,r){return t=this._processParams(t),this._queryService.queryByDistance(t,e,r)},queryBySQL:function(t,e,r){return t=this._processParams(t),this._queryService.queryBySQL(t,e,r)},queryByGeometry:function(t,e,r){return t=this._processParams(t),this._queryService.queryByGeometry(t,e,r)},_processParams:function(t){return t?(t.returnContent=null==t.returnContent||t.returnContent,t.queryParams&&!wo().Util.isArray(t.queryParams)&&(t.queryParams=[t.queryParams]),t.bounds&&(t.bounds=nc.toSuperMapBounds(t.bounds)),t.geometry&&(t.geometry instanceof wo().Point?t.geometry=new ut(t.geometry.x,t.geometry.y):t.geometry=vc(t.geometry)),t):{}}});var Rm=tc.extend({initialize:function(t,r){tc.prototype.initialize.call(this,t,r),this._spatialAnalystService=new class{constructor(t,e){this.url=t,this.options=e||{}}getAreaSolarRadiationResult(t,e,r){var i=this;return new ce(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}bufferAnalysis(t,e,r){var i=this;return new be(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}densityAnalysis(t,e,r){var i=this;return new Qe(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}generateSpatialData(t,e,r){var i=this;return new Er(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}geoRelationAnalysis(t,e,r){var i=this;return new Fr(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}interpolationAnalysis(t,e,r){var i=this;return new Ni(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}mathExpressionAnalysis(t,e,r){var i=this;return new Bi(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}overlayAnalysis(t,e,r){var i=this;return new ji(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}routeCalculateMeasure(t,e,r){var i=this;return new gs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}routeLocate(t,e,r){var i=this;return new bs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}surfaceAnalysis(t,e,r){var i=this;return new Rs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}terrainCurvatureCalculate(t,e,r){var i=this;return new Gs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}terrainCutFillCalculate(t,e,r){var i=this;return new ss(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}terrainAspectCalculate(t,e,r){var i=this;return new as(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}terrainSlopeCalculate(t,e,r){var i=this;return new ls(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}thiessenAnalysis(t,e,r){var i=this;return new Ys(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}minDistanceAnalysis(t,e,r){var i=this;return new rs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}convexHullAnalysis(t,e,r){var i=this;return new hs(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,format:i._processFormat(r)}).processAsync(t,e)}geometrybatchAnalysis(t,e,r){for(var i=new Xs(this.url,{format:this._processFormat(r)}),s=[],n=0;n<t.length;n++){var a=t[n];s.push({analystName:a.analystName,param:a.param})}return i.processAsync(s,e)}_processFormat(t){return t||e.GEOJSON}}(t,r)},getAreaSolarRadiationResult:function(t,e,r){return this._spatialAnalystService.getAreaSolarRadiationResult(t,e,r)},bufferAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.bufferAnalysis(t,e,r)},densityAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.densityAnalysis(t,e,r)},generateSpatialData:function(t,e,r){return this._spatialAnalystService.generateSpatialData(t,e,r)},geoRelationAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.geoRelationAnalysis(t,e,r)},interpolationAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.interpolationAnalysis(t,e,r)},mathExpressionAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.mathExpressionAnalysis(t,e,r)},overlayAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.overlayAnalysis(t,e,r)},routeCalculateMeasure:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.routeCalculateMeasure(t,e,r)},routeLocate:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.routeLocate(t,e,r)},surfaceAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.surfaceAnalysis(t,e,r)},terrainCurvatureCalculate:function(t,e,r){return this._spatialAnalystService.terrainCurvatureCalculate(t,e,r)},terrainCutFillCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainCutFillCalculate(t,e,r)},terrainAspectCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainAspectCalculate(t,e,r)},terrainSlopeCalculate(t,e,r){return t=this._processParams(t),this._spatialAnalystService.terrainSlopeCalculate(t,e,r)},thiessenAnalysis:function(t,e,r){return t=this._processParams(t),this._spatialAnalystService.thiessenAnalysis(t,e,r)},minDistanceAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.minDistanceAnalysis(t,e,r)},convexHullAnalysis(t,e,r){return t=this._processParams(t),this._spatialAnalystService.convexHullAnalysis(t,e,r)},geometrybatchAnalysis:function(t,e,r){for(var i=0;i<t.length;i++)t[i].param=this._processParams(t[i].param);return this._spatialAnalystService.geometrybatchAnalysis(t,e,r)},_processParams:function(t){if(!t)return{};if(t.bounds&&(t.bounds=nc.toSuperMapBounds(t.bounds)),t.inputPoints)for(let e=0;e<t.inputPoints.length;e++){let r=t.inputPoints[e];wo().Util.isArray(r)&&(t.inputPoints[e]={x:r[0],y:r[1],tag:r[2]})}if(t.points)for(let e=0;e<t.points.length;e++){let r=t.points[e];wo().Util.isArray(r)?t.points[e]={x:r[0],y:r[1]}:r instanceof wo().LatLng?t.points[e]={x:r.lng,y:r.lat}:t.points[e]={x:r.x,y:r.y}}if(t.point&&(wo().Util.isArray(t.point)?t.point={x:t.point[0],y:t.point[1]}:t.point instanceof wo().LatLng?t.point={x:t.point.lng,y:t.point.lat}:t.point={x:t.point.x,y:t.point.y}),t.extractRegion&&(t.extractRegion=vc(t.extractRegion)),t.extractParameter&&t.extractParameter.clipRegion&&(t.extractParameter.clipRegion=vc(t.extractParameter.clipRegion)),t.clipParam&&t.clipParam.clipRegion&&(t.clipParam.clipRegion=vc(t.clipParam.clipRegion)),t.sourceGeometry){var e=null;t.sourceGeometrySRID&&(e=t.sourceGeometrySRID),t.sourceGeometry=vc(t.sourceGeometry),e&&(t.sourceGeometry.SRID=e),delete t.sourceGeometry.sourceGeometrySRID}if(t.operateGeometry&&(t.operateGeometry=vc(t.operateGeometry)),t.sourceGeometries){for(var r=[],i=0;i<t.sourceGeometries.length;i++)r.push(vc(t.sourceGeometries[i]));t.sourceGeometries=r}if(t.operateGeometries){for(var s=[],n=0;n<t.operateGeometries.length;n++)s.push(vc(t.operateGeometries[n]));t.operateGeometries=s}if(t.inputGeometries){for(var a=[],o=0;o<t.inputGeometries.length;o++)a.push(vc(t.inputGeometries[o]));t.inputGeometries=a}if(t.sourceRoute&&t.sourceRoute instanceof wo().Polyline){var l={type:"LINEM"};l.parts=[t.sourceRoute.getLatLngs().length],l.points=[];for(let e=0;e<t.sourceRoute.getLatLngs().length;e++){let r=t.sourceRoute.getLatLngs()[e];l.points=l.points.concat({x:r.lng,y:r.lat,measure:r.alt})}t.sourceRoute=l}return t.operateRegions&&wo().Util.isArray(t.operateRegions)&&t.operateRegions.map(function(e,r){return t.operateRegions[r]=vc(e),t.operateRegions[r]}),t},_processFormat:function(t){return t||e.GEOJSON}}),Bm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._themeService=new Ws(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getThemeInfo:function(t,e){return this._themeService.processAsync(t,e)}});var Gm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._commonTrafficTransferAnalystService=new class{constructor(t,e){this.url=t,this.options=e||{}}queryStop(t,e){var r=this;return new Os(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}analysisTransferPath(t,e){var r=this;return new en(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}analysisTransferSolution(t,e){var r=this;return new sn(r.url,{proxy:r.options.proxy,withCredentials:r.options.withCredentials,crossOrigin:r.options.crossOrigin,headers:r.options.headers}).processAsync(t,e)}}(t,e)},queryStop:function(t,e){return this._commonTrafficTransferAnalystService.queryStop(t,e)},analysisTransferPath:function(t,e){return t=this._processParams(t),this._commonTrafficTransferAnalystService.analysisTransferPath(t,e)},analysisTransferSolution:function(t,e){return t=this._processParams(t),this._commonTrafficTransferAnalystService.analysisTransferSolution(t,e)},_processParams:function(t){return t?(t.points&&wo().Util.isArray(t.points)&&t.points.map(function(e,r){return t.points[r]=e instanceof wo().LatLng?{x:e.lng,y:e.lat}:e,t.points[r]}),t):{}}}),Um=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._webPrintingService=new Cn(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},createWebPrintingJob(t,e){if(t)return this._webPrintingService.createWebPrintingJob(this._processParams(t),e)},getPrintingJob:function(t,e){this._webPrintingService.getPrintingJob(t,e)},getPrintingJobResult:function(t,e){return this._webPrintingService.getPrintingJobResult(t,e)},getLayoutTemplates:function(t){return this._webPrintingService.getLayoutTemplates(t)},_processParams(t){return t.layoutOptions&&t.layoutOptions.littleMapOptions&&(t.layoutOptions.littleMapOptions.center=this._toPointObject(t.layoutOptions.littleMapOptions.center)),t.exportOptions&&(t.exportOptions.center=this._toPointObject(t.exportOptions.center)),t},_toPointObject:t=>wo().Util.isArray(t)?{x:t[0],y:t[1]}:t instanceof ut||t instanceof wo().Point?{x:t.x,y:t.y}:t instanceof wo().LatLng?{x:t.lng,y:t.lat}:t}),jm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._imageService=new An(this.url,{proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getCollections:function(t){return this._imageService.getCollections(t)},getCollectionByID:function(t,e){return this._imageService.getCollectionByID(t,e)},search:function(t,e){return this._imageService.search(t,e)}}),zm=tc.extend({initialize:function(t,e){tc.prototype.initialize.call(this,t,e),this._imageCollectionService=new Mn(this.url,{collectionId:this.options.collectionId,proxy:this.options.proxy,withCredentials:this.options.withCredentials,crossOrigin:this.options.crossOrigin,headers:this.options.headers})},getLegend:function(t,e){return this._imageCollectionService.getLegend(t,e)},getStatistics:function(t){return this._imageCollectionService.getStatistics(t)},getTileInfo:function(t){return this._imageCollectionService.getTileInfo(t)},deleteItemByID(t,e){return this._imageCollectionService.deleteItemByID(t,e)},getItemByID(t,e){return this._imageCollectionService.getItemByID(t,e)}}),Vm=wo().Control.extend({options:{position:"topright",style:(t,e)=>e?wo().circleMarker(e,{fillColor:"blue",weight:1,opacity:1,color:"blue",fillOpacity:.6}):{fillColor:"blue",weight:1,opacity:1,color:"blue",fillOpacity:.6},onEachFeature:null},initialize(t){wo().setOptions(this,t),this._event=new(wo().Evented),this.rootContainer=null},onAdd(t){return this.map=t,this.rootContainer=this._initView(),this.rootContainer},on(t,e){this._event.on(t,e)},off(t,e){e?this._event.off(t,e):this._event.off(t)},_initView(){},_preventMapEvent(t,e){t&&e&&(t.addEventListener("mouseover",function(){e.dragging.disable(),e.scrollWheelZoom.disable(),e.doubleClickZoom.disable()}),t.addEventListener("mouseout",function(){e.dragging.enable(),e.scrollWheelZoom.enable(),e.doubleClickZoom.enable()}))}}),Jm=wo().Evented.extend({initialize(){this.fileModel=new class{constructor(t){this.FileTypes=Ra,this.FileConfig=Ba,this.loadFileObject=t&&t.loadFileObject?t.loadFileObject:[]}set(t,e){this[t]=e}get(t){return this[t]}}},readFile(t){let e=t.target,r=e.files[0];if(r.size>this.fileModel.FileConfig.fileMaxSize)return this.fire("filesizeexceed",{messageType:"warring",message:ja.i18n("msg_fileSizeExceeded")}),!1;let i=e.value,s=r.name,n=ro.getFileType(s);if(!n)return this.fire("errorfileformat",{messageType:"failure",message:ja.i18n("msg_fileTypeUnsupported")}),!1;""!==s&&(this.fileModel.set("loadFileObject",{file:r,filePath:i,fileName:s,fileType:n}),this._readData())},_readData(){const t=this,e=this.fileModel.loadFileObject.fileType;Va.readFile(e,{file:this.fileModel.loadFileObject.file,path:this.fileModel.loadFileObject.filePath},r=>{Va.processDataToGeoJson(e,r,t=>{t&&this.fire("openfilesucceeded",{result:t,layerName:this.fileModel.loadFileObject.fileName.split(".")[0]})},e=>{t.fire("openfilefailed",{messageType:"failure",message:e})},this)},()=>{t.fire("openfilefailed",{messageType:"failure",message:ja.i18n("msg_openFileFail")})},this)}}),qm=Vm.extend({options:{layer:null},initialize(t){Vm.prototype.initialize.apply(this,[t]),this.viewModel=new Jm},setViewStyle(t,e){this.rootContainer.style[t]=e},_initView(){const t=wo().DomUtil.create("div","component-openfile");return t.id="openFile",this.fileSelect=wo().DomUtil.create("div","",t),this.label=wo().DomUtil.create("label","component-openfile__span--select",this.fileSelect),this.label.htmlFor="input_file",wo().DomUtil.create("div","supermapol-icons-upload",this.label),wo().DomUtil.create("span","component-openfile__span",this.label).appendChild(document.createTextNode(ja.i18n("text_chooseFile"))),this.fileInput=wo().DomUtil.create("input","component-openfile__input",this.fileSelect),this.fileInput.id="input_file",this.fileInput.type="file",this.fileInput.accept=".json,.geojson,.csv,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel",this.fileInput.onchange=(t=>{this.messageBox.closeView(),this.viewModel.readFile(t)}),this.messageBox=new Ga,this.viewModel.on("filesizeexceed",t=>{this.messageBox.showView(t.message,t.messageType)}),this.viewModel.on("errorfileformat",t=>{this.messageBox.showView(t.message,t.messageType)}),this.viewModel.on("openfilefailed",t=>{this.messageBox.showView(t.message,t.messageType),this._event.fire("openfilefailed",t)}),this.viewModel.on("readdatafail",t=>{this.messageBox.showView(t.message,t.messageType)}),this.viewModel.on("openfilesucceeded",t=>{this._event.fire("openfilesucceeded",t)}),this._preventMapEvent(t,this.map),t}});class Hm{constructor(t){this.layers=[],t&&t.length>0&&this.addLayers(t),this.currentLayerDataModel=null}addLayers(t,e,r,i){for(let s=0;s<t.length;s++){let n=t[s].layerName;if(t[s].layer instanceof wo().GeoJSON){let r=new Wm(t[s].layer);this.layers[n]=r,e&&e.call(i,{layerName:n,layer:r})}else r&&r.call(i,"")}}setCurrentLayerDataModel(t){this.layers[t]&&(this.currentLayerDataModel=this.layers[t])}}class Wm{constructor(t){if(this.layer=t,this.features=t.getLayers(),this.attributeNames=[],this.features[0].feature.properties)for(let t in this.features[0].feature.properties)this.attributeNames.push(t);this.operatingAttributeNames=[],this.attributes={}}setOperatingAttributeNames(t){this.operatingAttributeNames=t}getAllAttributeNames(){return this.attributeNames}getAttributeNamesByType(t){if(this.features[0].feature.properties){let e=this.features[0].feature.properties,r=[];if("Num"===t)for(let t in e)isNaN(e[t])||r.push(t);else r=this.attributeNames;return r}}getAllFeatures(){return this.features}getAttributeValueByAttributeName(t){if(this.attributes[t])return this.attributes[t];this.attributes[t]=[];for(let e=0;e<this.features.length;e++)this.attributes[t].push([this.features[e].feature.properties[t]]);return this.attributes[t]}getFeaturesByKeyWord(t){let e=[],r=new RegExp(t.toLowerCase());const i=this;return this.features.forEach(function(t){if(!t.feature.properties)return null;let s,n=t.feature.properties;for(let a=0,o=(s=i.operatingAttributeNames.length>0?i.operatingAttributeNames:i.attributeNames).length;a<o;a++)if(n[s[a]]&&r.test(n[s[a]].toString().toLowerCase())){let r=s[a],i=n[s[a]];t.filterAttribute={filterAttributeName:r,filterAttributeValue:i},e.push(t);break}}),e}}var Ym=wo().Evented.extend({options:{cityGeoCodingConfig:{addressUrl:"https://www.supermapol.com/iserver/services/localsearch/rest/searchdatas/China/poiinfos",key:"fvV2osxwuZWlY0wJb8FEb2i5"}},initialize(t,e){if(!t)return new Error("Cannot find map, fileModel.map cannot be null.");this.map=t,wo().Util.setOptions(this,e),this.dataModel=new Hm,this.geoCodeParam={keyWords:"åäº¬å¸",city:"åäº¬å¸",pageSize:this.options.pageSize,pageNum:this.options.pageNum},this.searchCache={}},search(t,e){e?this.searchFromLayer(t,e):this.searchFromCityLocalSearchService(t)},searchFromLayer(t,e){if(this.dataModel.layers[e]){let r=this.dataModel.layers[e].getFeaturesByKeyWord(t);r&&r.length>0?this.fire("searchlayersucceeded",{result:r}):this.fire("searchfailed",{searchType:"searchLayersField"})}},searchFromCityLocalSearchService(t){if(this.searchCache[t])this.fire("geocodesucceeded",{result:this.searchCache[t]});else{this.geoCodeParam.keyWords=t||this.geoCodeParam.city;const e=this;let r=this._getSearchUrl(this.geoCodeParam);zt.get(r).then(t=>t.json()).then(t=>{if(t.error||0===t.poiInfos.length)e.fire("searchfailed",{searchType:"searchGeocodeField"});else if(t.poiInfos){const r=e._dataToGeoJson(t.poiInfos,e.geoCodeParam);e.fire("geocodesucceeded",{result:r})}})}},addSearchLayers(t){this.dataModel.addLayers(t,t=>{this.fire("newlayeradded",{layerName:t.layerName})},null,this)},panToLayer(t){this.dataModel.layers[t]&&this.map.flyToBounds(this.dataModel.layers[t].layer.getBounds())},panToCity(t){this.geoCodeParam.keyWords=t,this.geoCodeParam.city=t;const e=this;let r=this._getSearchUrl(this.geoCodeParam);zt.get(r).then(t=>t.json()).then(t=>{if(t.poiInfos.length>0){const r=wo().latLng(t.poiInfos[0].location.y,t.poiInfos[0].location.x);e.map.setView(r,8)}else e.fire("searchfailed",{searchType:"cityGeocodeField"})})},_dataToGeoJson(t,e){let r=[];for(let i=0;i<t.length;i++){let s={type:"Feature",geometry:{type:"Point",coordinates:[t[i].location.x,t[i].location.y]},properties:{name:t[i].name||e.keyWords,address:t[i].formatedAddress||t[i].address}};r.push(s)}return r},_getSearchUrl(t){return this.options.cityGeoCodingConfig.addressUrl+`.json?keywords=${t.keyWords}&city=${t.city}&pageSize=${t.pageSize}&pageNum=${t.pageNum}&key=${this.options.cityGeoCodingConfig.key}`}}),Xm=Vm.extend({options:{cityConfig:{HOT:{HOT:["åäº¬å¸","ä¸æµ·å¸","å¹¿å·å¸","æ·±å³å¸","åäº¬å¸","æ­å·å¸","å¤©æ´¥å¸","éåºå¸","æé½å¸","éå²å¸","èå·å¸","æ é¡å¸","å¸¸å·å¸","æ¸©å·å¸","æ­¦æ±å¸","é¿æ²å¸","åæå¸","ä¸äºå¸","åè¥å¸","ç³å®¶åºå¸"]},AB:{A:["é¿æåç","éå±±å¸","å®åºå¸","å®é³å¸","é¿åèæç¾æèªæ²»å·","å®é¡ºå¸","é¿éå°åº","å®åº·å¸","é¿åèå°åº","é¿åæ³°å°åº","é¿æå°å¸"],B:["åäº¬å¸","ä¿å®å¸","åå¤´å¸","å·´å½¦æ·å°å¸","æ¬æºªå¸","ç½å±±å¸","ç½åå¸","èå å¸","äº³å·å¸","æ»¨å·å¸","åæµ·å¸","ç¾è²å¸","ç½æ²é»æèªæ²»å¿","ä¿äº­é»æèæèªæ²»å¿","å·´ä¸­å¸","æ¯èå°åº","ä¿å±±å¸","å®é¸¡å¸","ç½é¶å¸","åå°å¡æèå¤èªæ²»å·","å·´é³é­æ¥èå¤èªæ²»å·","ååº"]},CD:{C:["éåºå¸","æé½å¸","å¸¸å·å¸","é¿æ²å¸","æ¿å¾·å¸","æ²§å·å¸","é¿æ²»å¸","èµ¤å³°å¸","æé³å¸","é¿æ¥å¸","æ»å·å¸","å·¢æ¹å¸","æ± å·å¸","å¸¸å¾·å¸","é´å·å¸","æ½®å·å¸","å´å·¦å¸","æ¾è¿å¿","ææ±é»æèªæ²»å¿","æ¥éå½æèªæ²»å·","æé½å°åº","æååæèªæ²»å·"],D:["å¤§åå¸","å¤§è¿å¸","ä¸¹ä¸å¸","å¤§åºå¸","å¤§å´å®å²­å°åº","ä¸è¥å¸","å¾·å·å¸","ä¸èå¸","åå·å¸","ä¸æ¹å¸","å®å®å¿","å¾·é³å¸","è¾¾å·å¸","å¤§çç½æèªæ²»å·","å¾·å®å£ææ¯é¢æèªæ²»å·","è¿ªåºèæèªæ²»å·","å®è¥¿å¸","ä¸åº","å¤§ååº","å¤§å åº"]},EFG:{E:["éå°å¤æ¯å¸","éå·å¸","æ©æ½åå®¶æèæèªæ²»å·"],F:["æé¡ºå¸","éæ°å¸","éé³å¸","ç¦å·å¸","æå·å¸","ä½å±±å¸","é²åæ¸¯å¸"],G:["å¹¿å·å¸","èµ£å·å¸","æ¡æå¸","è´µæ¸¯å¸","å¹¿åå¸","å¹¿å®å¸","è´µé³å¸","åºåå¸","é«éå¸","é«éå¿","çåèæèªæ²»å·","çå­èæèªæ²»å·"]},H:{H:["æ­å·å¸","åè¥å¸","é¯é¸å¸","è¡¡æ°´å¸","å¼åæµ©ç¹å¸","å¼ä¼¦è´å°å¸","è«è¦å²å¸","åå°æ»¨å¸","é¹¤å²å¸","é»æ²³å¸","æ·®å®å¸","æ¹å·å¸","æ·®åå¸","æ·®åå¸","é»å±±å¸","èæ³½å¸","é¹¤å£å¸","é»ç³å¸","é»åå¸","è¡¡é³å¸","æåå¸","æ å·å¸","æ²³æºå¸","è´ºå·å¸","æ²³æ± å¸","æµ·å£å¸","çº¢æ²³åå°¼æå½æèªæ²»å·","æ±ä¸­å¸","æµ·ä¸å°åº","æµ·åèæèªæ²»å·","é»åèæèªæ²»å·","æµ·åèæèªæ²»å·","ææ´èæèªæ²»å·","æµ·è¥¿èå¤æèæèªæ²»å·","åå¯å°åº","åç°å°åº","è±è²å¿","é»å¤§ä»åº","è±å°çå åº"]},J:{J:["æåå¸","æä¸­å¸","é¦å·å¸","åæå¸","é¸¡è¥¿å¸","ä½³æ¨æ¯å¸","åå´å¸","éåå¸","æ¯å¾·éå¸","ä¹æ±å¸","åå®å¸","æµåå¸","æµå®å¸","ç¦ä½å¸","æµæºå¸","èé¨å¸","èå·å¸","æ±é¨å¸","æ¹æ±å¸","æ­é³å¸","åå³ªå³å¸","éæå¸","éæ³å¸","åºéå¸","åä¹å¸","åä¹å¿","ä¹é¾ååº","åæ¨¡å åº"]},KL:{K:["å¼å°å¸","ææå¸","åæçä¾å¸","åå­åèæ¯å°åå­èªæ²»å·","åä»å°åº"],L:["å»åå¸","ä¸´æ±¾å¸","åæ¢å¸","è¾½é³å¸","è¾½æºå¸","è¿äºæ¸¯å¸","ä¸½æ°´å¸","å­å®å¸","é¾å²©å¸","è±èå¸","ä¸´æ²å¸","èåå¸","æ´é³å¸","æ¼¯æ²³å¸","å¨åºå¸","æ³å·å¸","æ¥å®¾å¸","ä¸´é«å¿","ä¹ä¸é»æèªæ²»å¿","éµæ°´é»æèªæ²»å¿","æ³¸å·å¸","ä¹å±±å¸","åå±±å½æèªæ²»å·","å­çæ°´å¸","ä¸½æ±å¸","ä¸´æ²§å¸","æè¨å¸","æèå°åº","å°å·å¸","éåå¸","ä¸´å¤åæèªæ²»å·"]},MNP:{M:["ç¡ä¸¹æ±å¸","é©¬éå±±å¸","èåå¸","æ¢å·å¸","ç»µé³å¸","çå±±å¸","èæ å¿"],N:["åäº¬å¸","åæå¸","åéå¸","å®æ³¢å¸","åå¹³å¸","å®å¾·å¸","åé³å¸","åå®å¸","åæ²ç¾¤å²","åæ±å¸","ååå¸","ææ±ååæèªæ²»å·","é£æ²å°åº","åæå¿"],P:["çé¦å¸","èç°å¸","èä¹¡å¸","å¹³é¡¶å±±å¸","æ¿®é³å¸","ææè±å¸","å¹³åå¸","å±ä¸å¿","æ¾æ¹å¿"]},QR:{Q:["éå²å¸","ç§¦çå²å¸","é½é½åå°å¸","é»è¥¿åå¸ä¾æèæèªæ²»å·","ä¸å°æ²³å¸","è¡¢å·å¸","æ³å·å¸","æ½æ±å¸","æ¸è¿å¸","é¦å·å¸","ç¼æµ·å¸","æ²éå¸","åºé³å¸","èæ¹¾åº","é»ä¸åèæä¾æèªæ²»å·","é»åå¸ä¾æèæèªæ²»å·","ç¼ä¸­é»æèæèªæ²»å¿"],R:["æ¥ç§å¸","æ¥ååå°åº"]},S:{S:["ä¸æµ·å¸","æ·±å³å¸","èå·å¸","ç³å®¶åºå¸","ä¸äºå¸","æå·å¸","æ²é³å¸","åå¹³å¸","æ¾åå¸","åé¸­å±±å¸","ç»¥åå¸","å®¿è¿å¸","ç»å´å¸","å®¿å·å¸","ä¸æå¸","ä¸é¥¶å¸","ä¸é¨å³¡å¸","åä¸å¸","åå °å¸","éå·å¸","éµé³å¸","é¶å³å¸","æ±å¤´å¸","æ±å°¾å¸","ä¸äºå¸","éå®å¸","æèå¸","å±±åå°åº","åæ´å¸","ç³å´å±±å¸","ç³æ²³å­å¸","æ·±æ°´ååº","æ²ç°åº","ç¥åæ¶æåº","å£å®å¤å°¼å åº","å£æ¹æµåå åº"]},T:{T:["å¤©æ´¥å¸","åå±±å¸","å¤ªåå¸","éè¾½å¸","éå²­å¸","éåå¸","æ³°å·å¸","å°å·å¸","ééµå¸","æ³°å®å¸","å¤©é¨å¸","å±¯æå¿","éä»å°åº","éå·å¸","å¤©æ°´å¸","åé²çªå°åº","å¡åå°åº","å¾æ¨èåå¸","å°åå¸","å°ä¸­å¸","å°åå¸","å°åå¿","æ¡å­å¿","å°ä¸­å¿","å°åå¿","å°ä¸å¿","å±¯é¨åº"]},W:{W:["æ é¡å¸","æ¸©å·å¸","æ­¦æ±å¸","ä¹æµ·å¸","ä¹å°å¯å¸å¸","èæ¹å¸","æ½åå¸","å¨æµ·å¸","æ¢§å·å¸","äºæå±±å¸","ææå¸","ä¸å®å¸","æå±±å£®æèæèªæ²»å·","æ¸­åå¸","æ­¦å¨å¸","å´å¿ å¸","ä¹é²æ¨é½å¸","äºå®¶æ¸ å¸","æ¹¾ä»åº","æå¾·å åº"]},X:{X:["é¢å°å¸","å¿»å·å¸","å´å®ç","å¾å·å¸","å®£åå¸","å¦é¨å¸","æ°ä½å¸","æ°ä¹¡å¸","è®¸æå¸","ä¿¡é³å¸","è¥æ¨å¸","å­æå¸","å¸å®å¸","ä»æ¡å¸","æ¹æ½­å¸","è¥¿å®å¸","å¸é³å¸","è¥¿å®å¸","æ°ç«¹å¸","æ°ç«¹å¿","è¥¿è´¡åº","é¡æé­åç","è¥¿æ²ç¾¤å²","æ¹è¥¿åå®¶æèæèªæ²»å·","è¥¿åççº³å£æèªæ²»å·"]},Y:{Y:["é³æ³å¸","è¿åå¸","è¥å£å¸","å»¶è¾¹æé²æèªæ²»å·","ä¼æ¥å¸","çåå¸","æ¬å·å¸","é¹°æ½­å¸","å®æ¥å¸","çå°å¸","å®æå¸","å²³é³å¸","çé³å¸","æ°¸å·å¸","é³æ±å¸","äºæµ®å¸","çæå¸","å®å®¾å¸","éå®å¸","çæºªå¸","å»¶å®å¸","æ¦æå¸","çæ èæèªæ²»å·","é¶å·å¸","ä¼çåè¨åèªæ²»å·","å®å°å¿","äºæå¿","æ²¹å°æºåº","åæåº"]},Z:{Z:["éå·å¸","å¼ å®¶å£å¸","éæ±å¸","èå±±å¸","æ¼³å·å¸","æ·åå¸","æ£åºå¸","å¨å£å¸","é©»é©¬åºå¸","æ ªæ´²å¸","å¼ å®¶çå¸","ç æµ·å¸","èåºå¸","ä¸­å±±å¸","èªè´¡å¸","èµé³å¸","éµä¹å¸","æ­éå¸","å¼ æå¸","ä¸­å«å¸","å½°åå¿","ä¸­è¥¿åº","ä¸­æ²ç¾¤å²çå²ç¤åå¶æµ·å"]}},cityGeoCodingConfig:{addressUrl:"https://www.supermapol.com/iserver/services/localsearch/rest/searchdatas/China/poiinfos",key:"fvV2osxwuZWlY0wJb8FEb2i5"},isGeoCoding:!0,pageSize:10,pageNum:1,perPageDataNum:8},initialize(t){Vm.prototype.initialize.apply(this,[t]),this.currentSearchLayerName="",this.isSearchLayer=!1,this.perPageDataNum=this.options.perPageDataNum},onAdd:function(t){return this.viewModel=new Ym(t,this.options),Vm.prototype.onAdd.apply(this,[t])},addSearchLayer(t){this.viewModel.addSearchLayers(t)},_initView(){const t=this,e=document.createElement("div");e.setAttribute("class","component-search-container");const r=document.createElement("div");r.setAttribute("class","component-search");const i=document.createElement("div");i.setAttribute("class","component-search__settings");const s=document.createElement("div");s.setAttribute("class","component-search__settings__name"),i.appendChild(s);const n=document.createElement("span");n.setAttribute("class","supermapol-icons-solid-down-triangle"),i.appendChild(n);let a=null;if(this.options.isGeoCoding){const t=new $a({config:this.options.cityConfig});a=t.getElement(),t.content.onclick=(t=>{"SPAN"===t.target.nodeName&&t.target.innerText&&(this.viewModel.panToCity(t.target.innerHTML),this.messageBox.closeView(),s.removeChild(s.firstChild),s.insertBefore(document.createTextNode(t.target.innerHTML),s.firstChild),this.isSearchLayer=!1)}),s.appendChild(document.createTextNode(t.content.getElementsByTagName("span")[0].innerText))}const o=function(){const e=document.createElement("div");e.setAttribute("class","component-search__layers");const r=document.createElement("div");r.setAttribute("class","component-search-layers-content"),e.appendChild(r);const i=document.createElement("div");i.setAttribute("class","component-search__layers__header");const n=document.createElement("div");n.setAttribute("class","load-btn"),i.appendChild(n);const a=document.createElement("span");a.setAttribute("class","supermapol-icons-poi-load"),n.appendChild(a);const o=document.createElement("span");o.appendChild(document.createTextNode(ja.i18n("text_loadSearchCriteria"))),n.appendChild(o);const l=document.createElement("div");l.setAttribute("class","save-btn"),i.appendChild(l);const h=document.createElement("span");h.setAttribute("class","supermapol-icons-poi-save"),l.appendChild(h);const u=document.createElement("span");u.appendChild(document.createTextNode(ja.i18n("text_saveSearchCriteria"))),l.appendChild(u);const c=document.createElement("div");return c.setAttribute("class","component-search__layers__body"),c.onclick=(e=>{t.clearSearchResult();let r=null;if("component-search__layers__itme__singleselect"===e.target.classList[0])r=e.target;else{if("component-single-default-img"!==e.target.classList[0]&&"single-label"!==e.target.classList[0])return;r=e.target.parentNode}document.getElementsByClassName("component-single-checked-img").length>0&&document.getElementsByClassName("component-single-checked-img")[0].setAttribute("class","component-single-default-img"),r.firstChild.setAttribute("class","component-single-checked-img"),t.currentSearchLayerName=r.lastChild.innerText,t.isSearchLayer=!0,s.removeChild(s.firstChild),s.insertBefore(document.createTextNode(t.currentSearchLayerName),s.firstChild),t.viewModel.panToLayer(t.currentSearchLayerName),t.messageBox.closeView()}),r.appendChild(c),e}();let l=[];a&&l.push({title:ja.i18n("title_searchCity"),content:a}),l.push({title:ja.i18n("title_searchLayer"),content:o});const h=new to({tabs:l}),u=h.getElement();h.closeView(),r.appendChild(u),i.onclick=(()=>{u.hidden?h.showView():h.closeView()}),r.appendChild(i),s.innerText||s.appendChild(document.createTextNode(ja.i18n("text_label_chooseSearchLayers")));const c=document.createElement("div");c.setAttribute("class","component-search__input");const d=document.createElement("input");d.type="text",d.placeholder=ja.i18n("text_label_searchTips"),c.appendChild(d),this.poiInput=d;const p=document.createElement("span");p.setAttribute("class","supermapol-icons-close"),p.hidden=!0,c.appendChild(p),r.appendChild(c);const f=document.createElement("div");f.setAttribute("class","component-search-icon supermapol-icons-search");const m=new eo;this._resultDomObj=m,f.onclick=(()=>{m.closeView(),this.clearSearchResult(),this.messageBox.closeView(),h.closeView();const t=this.poiInput.value.trim();""!==t?this.isSearchLayer?this.viewModel.search(t,this.currentSearchLayerName):this.viewModel.search(t):this.messageBox.showView(ja.i18n("msg_searchKeywords"))}),d.onkeypress=(t=>{if(13==t.which){var e=document.createEvent("HTMLEvents");e.initEvent("click",!1,!0),f.dispatchEvent(e)}}),r.appendChild(f);const y=function(){const e=m.getElement();return e.style.position="absolute",e.style.top="44px",e.style.right="0",m.closeView(),m.content.onclick=(e=>{let r=null;if("component-search-result-info"===e.target.parentNode.className)r=e.target.parentNode.parentNode;else if("component-search__resultitme"===e.target.parentNode.className)r=e.target.parentNode;else{if("component-search__resultitme"!==e.target.className)return;r=e.target}document.getElementsByClassName("component-search__resultitme-selected").length>0&&document.getElementsByClassName("component-search__resultitme-selected")[0].classList.remove("component-search__resultitme-selected"),r.firstChild.classList.add("component-search__resultitme-selected");let i=r.children[1].firstChild.innerText;t._linkageFeature(i)}),e}();return r.appendChild(y),p.onclick=(t=>{this.clearSearchResult(),d.value="",t.target.hidden=!0,m.closeView()}),d.oninput=(()=>{p.hidden=!1}),this.messageBox=new Ga,this._addViewModelListener(),e.appendChild(r),this._preventMapEvent(e,this.map),e},_createSearchLayerItem(t){const e=document.createElement("div");e.setAttribute("class","component-search__layers__itme");const r=document.createElement("div");r.setAttribute("class","component-search__layers__itme__singleselect");const i=document.createElement("div");i.setAttribute("class","component-single-default-img"),r.appendChild(i);const s=document.createElement("span");s.setAttribute("class","single-label"),s.innerHTML=t,r.appendChild(s),e.appendChild(r),document.getElementsByClassName("component-search__layers__body")[0].appendChild(e)},_createResultItem(t,e){const r=document.createElement("div");r.setAttribute("class","component-search__resultitme");let i=document.createElement("div");"Point"===t||"MultiPoint"===t?i.setAttribute("class","supermapol-icons-marker-layer component-search-result-icon"):"LineString"===t||"MultiLineString "===t?i.setAttribute("class","supermapol-icons-line-layer component-search-result-icon"):"Polygon"===t||"MultiPolygon"===t?i.setAttribute("class","supermapol-icons-polygon-layer component-search-result-icon"):i.setAttribute("class","supermapol-icons-point-layer component-search-result-icon"),r.appendChild(i);const s=document.createElement("div");s.setAttribute("class","component-search-result-info");const n=document.createElement("div");s.appendChild(n);const a=document.createElement("div");return e.name?(n.innerHTML=e.name,a.innerHTML=e.address,s.appendChild(a)):n.innerHTML=e.filterAttributeName+": "+e.filterAttributeValue,r.appendChild(s),document.createElement("div").setAttribute("class","component-checkbox component-checkbox-default-img"),r},_addViewModelListener(){this.viewModel.on("searchlayerschanged",t=>{for(let e=0;e<t.length;e++)this._createSearchLayerItem(t[e])}),this.viewModel.on("newlayeradded",t=>{this._createSearchLayerItem(t.layerName)}),this.viewModel.on("searchlayersucceeded",t=>{const e=t.result;this.clearSearchResult(),this.searchResultLayer=wo().featureGroup(e,{pointToLayer:this.options.style,style:this.options.style}).bindPopup(function(t){if(t.feature.properties)return new Za({attributes:t.feature.properties}).getElement()}).addTo(this.map),this.searchResultLayer.eachLayer(t=>{this.options.onEachFeature?this.options.onEachFeature(t.toGeoJSON(),t):this._featureOnclickEvent.bind(this)(t.toGeoJSON(),t)}),this.searchLayersData=e,this._prepareResultData(e),this._event.fire("searchlayersucceeded",{result:this.searchResultLayer.toGeoJSON()})}),this.viewModel.on("geocodesucceeded",t=>{const e=t.result;this.clearSearchResult(),this.searchResultLayer=wo().geoJSON(e,{pointToLayer:this.options.style,style:this.options.style,onEachFeature:this.options.onEachFeature||this._featureOnclickEvent.bind(this)}).bindPopup(function(t){if(t.feature.properties)return new Za({attributes:t.feature.properties}).getElement()}).addTo(this.map),this.searchLayersData=e,this._prepareResultData(e),this._event.fire("geocodesucceeded",{result:e})}),this.viewModel.on("searchfailed",t=>{let e="";e="searchGeocodeField"===t.searchType?ja.i18n("msg_searchGeocodeField"):"cityGeocodeField"===t.searchType?ja.i18n("msg_cityGeocodeField"):ja.i18n("msg_getFeatureField"),this.messageBox.showView(e),this._event.fire("searchfailed",{message:e})})},_prepareResultData(t){this.currentResult=t;let e=Math.ceil(t.length/this.perPageDataNum);this._resultDomObj.setPageLink(e),this._createResultListByPageNum(1,t),this._resultDomObj.showView(),this._resultDomObj.setLinkageEvent(function(t){r._createResultListByPageNum(t,r.currentResult)});const r=this},_createResultListByPageNum(t,e){let r,i=0;1===t&&e.length<this.perPageDataNum?r=e.length-1:t*this.perPageDataNum>e.length?(i=this.perPageDataNum*(t-1),r=e.length-1):(i=this.perPageDataNum*(t-1),r=t*this.perPageDataNum-1);const s=document.createElement("div");for(let t=i;t<=r;t++){let r,i="Point";e[t].filterAttribute?(i=e[t].feature.geometry.type,r=e[t].filterAttribute):r=e[t].properties,s.appendChild(this._createResultItem(i,r))}this._resultDomObj.setContent(s),this._resultDomObj.showView(),s.firstChild.getElementsByClassName("component-search-result-icon")[0].classList.add("component-search__resultitme-selected");const n=s.firstChild.getElementsByClassName("component-search-result-info")[0].firstChild.innerText;!this._selectMarkerFeature&&this._linkageFeature(n)},_flyToBounds(t){const e=t.getSouthWest(),r=t.getNorthEast();e.lat===r.lat&&e.lng===r.lng?this.map.flyTo(e):this.map.fitBounds(t)},_linkageFeature(t){let e="";e=this.isSearchLayer?t.split(":")[1].trim():t,this._selectFeature&&this._selectFeature.addTo(this.map),this.searchResultLayer.eachLayer(t=>{(!e||t.filterAttribute&&t.filterAttribute.filterAttributeValue===e||t.feature.properties&&t.feature.properties.name===e)&&(t.remove(),this._setSelectedLayerStyle(t))})},clearSearchResult(){this.searchResultLayer&&(this.map.closePopup(),!this.isSearchLayer&&this.map.removeLayer(this.searchResultLayer),this._selectMarkerFeature&&this.map.removeLayer(this._selectMarkerFeature),this._selectFeaturethis&&this.map.removeLayer(this._selectFeature),this._selectMarkerFeature=null,this._selectFeature=null,this.searchResultLayer=null,this.currentResult=null)},_featureOnclickEvent(t,e){e.on("click",()=>{let r,i,s=document.getElementsByClassName("component-pagination__link")[0];this._resultDomObj._changePageEvent({target:s.children[0].children[0]}),this._selectFeature&&this._selectFeature.addTo(this.map),e.remove();for(let s=0;s<this.searchLayersData.length;s++){let n=this.searchLayersData[s];if(n.properties&&n.properties.name===t.properties.name||n.filterAttribute&&n.filterAttribute.filterAttributeName+": "+n.filterAttribute.filterAttributeValue==e.filterAttribute.filterAttributeName+": "+e.filterAttribute.filterAttributeValue){i=s%this.perPageDataNum,r=parseInt(s/this.perPageDataNum)+1;break}}if(r>1)for(let t=1;t<r;t++){let t;t=document.getElementsByClassName("component-pagination__link")[0],this._resultDomObj._changePageEvent({target:t.children[t.children.length-2].children[0]})}let n=document.getElementsByClassName("component-search-result-info"),a=n[i].children[0];if(a.innerHTML===t.properties.name||a.innerHTML===e.filterAttribute.filterAttributeName+": "+e.filterAttribute.filterAttributeValue){let t=n[i].parentNode;document.getElementsByClassName("component-search__resultitme-selected").length>0&&document.getElementsByClassName("component-search__resultitme-selected")[0].classList.remove("component-search__resultitme-selected"),t.firstChild.classList.add("component-search__resultitme-selected"),this._setSelectedLayerStyle(e)}},this)},_setSelectedLayerStyle(t){let e;this._selectMarkerFeature&&this._selectMarkerFeature.remove(),this._selectMarkerFeature=null,this._selectFeature=t,this._selectMarkerFeature=wo().geoJSON(t.toGeoJSON(),{pointToLayer:(t,e)=>wo().marker(e,{icon:wo().divIcon({className:"component-select-marker-icon",iconAnchor:[15,0]})}),style:{fillColor:"red",weight:1,opacity:1,color:"red",fillOpacity:.2}}).addTo(this.map),this._selectMarkerFeature.bindPopup(function(){return new Za({attributes:t.feature.properties}).getElement()},{closeOnClick:!1}).openPopup().addTo(this.map),this._flyToBounds(this.searchResultLayer.getBounds()),t.getLatLng?e=t.getLatLng():t.getCenter&&(e=t.getCenter()),this.map.setView(e)}}),Qm=wo().Evented.extend({options:{_defaultLayerOptions:{style:null,onEachFeature:function(t,e){let r="å±æ§ä¿¡æ¯å¦ä¸ï¼<br>";for(let e in t.properties)r+=e+": "+t.properties[e]+"<br>";e.bindPopup(r)}}},initialize(t,e=null){if(!t)return new Error("Cannot find map, fileModel.map cannot be null.");this.map=t,wo().Util.extend(this.options._defaultLayerOptions,e),this.options._defaultLayerOptions.pointToLayer=this.options._defaultLayerOptions.style,this.popupsStatus=!0,this.dataFlowStatus=!1,this.dataFlowUrl="",this.currentFeatures=[],this.dataFlowLayer=null},subscribe(t){if(this.dataFlowUrl===t){if(this.dataFlowStatus)return void this.fire("dataflowservicesubscribed")}else this.dataFlowUrl=t;this.dataFlowStatus=!0,this.dataFlowLayer&&(this.dataFlowLayer.remove(),this.dataFlowLayer=null);const e=new cd(t,this.options._defaultLayerOptions);e.on("subscribesucceeded",t=>{this.fire("subscribesucceeded",{result:t})}),e.on("subscribefailed",t=>{this.fire("subscribefailed",{result:t})}),e.on("dataupdated",t=>{this.fire("dataupdated",{result:t});let e=t.layer.getBounds(),r=nc.toSuperMapBounds(this.map.getBounds()),i=nc.toSuperMapBounds(e);r.intersectsBounds(i)||(i.left===i.right&&i.top===i.bottom?this.map.setView(e.getCenter()):this.map.flyToBounds(e)),this.popupsStatus&&this.openPopups()}),e.addTo(this.map),this.dataFlowLayer=e},cancelSubscribe(){this.dataFlowLayer&&(this.dataFlowStatus=!1,this.dataFlowLayer.dataService.unSubscribe(),this.dataFlowLayer.remove(),this.dataFlowLayer=null)},openPopups(){if(this.popupsStatus=!0,this.dataFlowLayer){const t=this.dataFlowLayer.getLayers();for(let e=0;e<t.length;e++)for(let r=0;r<t[e].getLayers().length;r++)t[e].getLayers()[r].openPopup()}},closePopups(){if(this.popupsStatus=!1,this.dataFlowLayer){const t=this.dataFlowLayer.getLayers();for(let e=0;e<t.length;e++)for(let r=0;r<t[e].getLayers().length;r++)t[e].getLayers()[r].closePopup()}}}),Zm=Vm.extend({initialize(t){Vm.prototype.initialize.apply(this,[t])},onAdd(t){let e={};return this.options.style&&(e.style=this.options.style),this.options.onEachFeature&&(e.style=this.options.onEachFeature),this.viewModel=new Qm(t,e),Vm.prototype.onAdd.apply(this,[t])},_initView(){const t=new Wa({title:ja.i18n("title_dataFlowService")}),e=t.getElement(),r=t.getContentElement();r.style.padding="10px 18px";const i=document.createElement("div");i.setAttribute("class","component-dataflow__container");const s=document.createElement("div");s.setAttribute("class","component-input-default");const n=document.createElement("input");n.setAttribute("class","component-input-default"),n.type="text",n.placeholder=ja.i18n("text_input_value_inputDataFlowUrl"),n.title=ja.i18n("text_input_value_inputDataFlowUrl"),s.appendChild(n);const a=document.createElement("span");a.setAttribute("class","supermapol-icons-close"),a.hidden=!0,a.onclick=(t=>{n.value="",t.target.hidden=!0}),n.oninput=(()=>{a.hidden=!1}),s.appendChild(a),i.appendChild(s),r.appendChild(i);const o=document.createElement("div");o.setAttribute("class","component-dataflow__container");const l=document.createElement("div");l.setAttribute("class","component-checkbox-container");const h=document.createElement("div");h.setAttribute("class","component-checkbox-default component-checkbox-selected-img"),h.checked=!0,l.appendChild(h);const u=document.createElement("div");u.setAttribute("class","component-label component-label-selected"),u.innerHTML=ja.i18n("text_displayFeaturesInfo"),l.appendChild(u),h.onclick=(t=>{t.target.checked=!t.target.checked,t.target.checked?(u.setAttribute("class","component-label component-label-selected"),t.target.setAttribute("class","component-checkbox-default component-checkbox-selected-img"),this.viewModel.openPopups()):(u.setAttribute("class","component-label"),t.target.setAttribute("class","component-checkbox-default component-checkbox-default-img"),this.viewModel.closePopups())}),o.appendChild(l),r.appendChild(o);const c=document.createElement("div");c.setAttribute("class","component-dataflow__container component-init-center");const d=document.createElement("button");d.setAttribute("class","component-button-default"),d.innerHTML=ja.i18n("text_subscribe"),d.onclick=(()=>{const t=n.value;""!==t?this.viewModel.subscribe(t):this.messageBox.showView(ja.i18n("msg_inputDataFlowUrlFirst"))}),c.appendChild(d);const p=document.createElement("button");return p.setAttribute("class","component-button-default"),p.innerHTML=ja.i18n("text_cancelSubscribe"),p.onclick=(()=>{this.viewModel.cancelSubscribe()}),c.appendChild(p),r.appendChild(c),this.messageBox=new Ga,this.viewModel.on("dataflowservicesubscribed",()=>{this.messageBox.showView(ja.i18n("msg_dataflowservicesubscribed"))}),this.viewModel.on("subscribesucceeded",()=>{this.messageBox.showView(ja.i18n("msg_subscribesucceeded"))}),this.viewModel.on("dataupdated",t=>{this.messageBox.closeView(),this._event.fire("dataupdated",t)}),this._preventMapEvent(e,this.map),e}});class Km{constructor(t,e){this.layerName=t,this.layer=e}}class $m extends wo().Evented{initialize(t){this.workerUrl=t,this.turfLayers=[]}getLayersData(t){let e={},r={},i={},s={};for(let e=0;e<t;e++)t[e]=new Km(t[e].layerName,t[e].layer);this.geoJsonLayersDataModel=new Hm(t);let n=[];for(let e=0;e<t.length;e++)n[t[e].layerName]={fields:t[e].fields,layer:t[e].layer.toGeoJSON()};for(let t in this.geoJsonLayersDataModel.layers){let e;e=n[t].fields?n[t].fields:this.geoJsonLayersDataModel.layers[t].getAttributeNamesByType("Num");let o=[];for(let r=0;r<e.length;r++){o[e[r]]=this.geoJsonLayersDataModel.layers[t].getAttributeValueByAttributeName(e[r]);let i=o[e[r]];for(var a=0;a<i.length;a++)""!=i[a]&&void 0!==i[a]||(i.splice(a,1),a-=1),i[a]=parseFloat(i[a]);o[e[r]]=Array.from(new Set(i.sort(function(t,e){return t-e})))}let l={layerName:t,fields:e,fieldsValue:o,features:n[t].layer},h=n[t].layer.features[0].geometry.type;"Point"===h?r[t]=l:"LineString"===h?i[t]=l:"Polygon"===h&&(s[t]=l)}return e.point=r,e.lineString=i,e.polygon=s,e}analysis(t,e){this.geoJsonLayersDataModel.setCurrentLayerDataModel(t.analysisLayers),this.worker=new Worker(this.workerUrl);let r=this.geoJsonLayersDataModel.currentLayerDataModel.layer.toGeoJSON();if("isolines"===t.analysisMethod){let i=t.analysisFieldsValue.split(","),s=r;for(let t=0;t<i.length;t++)i[t]=parseFloat(i[t]);let n=this,a={pointGrid:s,analysisMethod:t.analysisMethod,breaks:i,zProperty:t.analysisFields,analysisCellSize:t.analysisCellSize,options:{gridType:"point",property:t.analysisFields,weight:Number(t.analysisBreaks)}};this.worker.postMessage(a),this.worker.onmessage=(r=>{if(0===r.data.features.length)n.fire("analysisfailed");else{n.fire("analysissucceeded",{data:r.data});let i=wo().geoJSON(r.data,{style:{color:"#1060C2",weight:3},onEachFeature:function(t,e){t.properties&&e.bindPopup(new Za(t.properties).getElement()),e.on({mouseover:function(){e.setStyle({color:"#ffffff",weight:5})},mouseout:function(){e.setStyle({color:"#1060C2",weight:3})},click:function(){e.setStyle({color:"#ffffff",weight:5})}})}}).addTo(e);n.turfLayers.push(i),n.fire("layerloaded",{layer:i,name:t.resultLayersName}),n.worker.terminate()}})}else if("buffer"===t.analysisMethod){let i=this,s={analysisMethod:"buffer",radius:t.radius,unit:t.unit,isSave:t.isSaveStatus,isUnion:t.isUnion,geoJson:r};this.worker.postMessage(s),this.worker.onmessage=(r=>{let s=wo().geoJSON(r.data,{style:{color:"#ffffff",fillColor:"#1060C2",fillOpacity:.5,weight:1.5},onEachFeature:function(t,e){t.properties&&e.bindPopup(new Za(t.properties).getElement()),e.on({mouseover:function(){e.setStyle({color:"#ffffff",fillColor:"rgb(46,40,79)",fillOpacity:.5,weight:5})},mouseout:function(){e.setStyle({color:"#ffffff",fillColor:"#1060C2",fillOpacity:.5,weight:1.5})},click:function(){e.setStyle({color:"#ffffff",fillColor:"rgb(46,40,79)",fillOpacity:.5,weight:2})}})}}).addTo(e);i.turfLayers.push(s),i.fire("layerloaded",{layer:s,name:t.resultLayersName}),i.worker.terminate()})}}clearLayers(){for(let t in this.turfLayers)this.turfLayers[t].clearLayers();this.fire("layersremoved",{layers:this.turfLayers})}cancelAnalysis(){this.worker.terminate()}}var ty=Vm.extend({initialize:function(t,e){if(!t)throw new Error("workerUrl is required");this.workerUrl=t,Vm.prototype.initialize.apply(this,[e])},onAdd:function(t){return this.map=t,Vm.prototype.onAdd.apply(this,[t])},addLayer:function(t){this.layers=this.layers||[],this.layers.push(t);let e=this.viewModel.getLayersData(this.layers);this.fillDataToView(e)},fillDataToView:function(t){if(!t)return;this.fillData=t;let e={};switch(document.getElementById("dropDownTop").getAttribute("data-value")){case"isolines":case"buffer":e=t.point}if("{}"==JSON.stringify(e))return;let r=[];for(let t in e)r.push(t);let i=document.getElementById("layersSelect"),s=document.getElementById("layerSelectName");i.innerHTML="",s.title=r[0],s.innerHTML=r[0],this._createOptions(i,r),this.layerSelectObj.optionClickEvent(i,s,this.layersSelectOnchange);let n=e[s.title],a=n.fields,o=n.fieldsValue;this.currentData=n,this.currentFillData=e;let l=document.getElementById("fieldsSelect");l.innerHTML="";let h=document.getElementById("fieldsSelectName");h.innerHTML=a[0],h.title=a[0],this._createOptions(l,a),this.fieldsSelectObj.optionClickEvent(l,h,this.fieldsSelectOnchange);let u=h.title,c=document.getElementById("getValueTextArea");c.value=o[u].toString().replace(/,/g,",\r\n"),c.setAttribute("data-value",o[u]);let d=document.getElementById("resultLayersName");switch(document.getElementById("dropDownTop").getAttribute("data-value")){case"isolines":d.value=ja.i18n("text_label_isolines")+s.title;break;case"buffer":d.value=ja.i18n("text_label_buffer")+s.title}},_initView:function(){this.workerUrl&&(this.viewModel=new $m(this.workerUrl));let t=new Wa({title:ja.i18n("title_clientComputing")}).getElement();t.classList.add("component-analysis"),t.children[0].style.fontSize="12px";let e=[{title:ja.i18n("text_isoline"),dataValue:"isolines",remark:ja.i18n("text_extractDiscreteValue"),icon:{className:"component-analyst-isoline-img"}},{title:ja.i18n("text_buffer"),dataValue:"buffer",remark:ja.i18n("text_specifyTheDistance"),icon:{className:"component-analyst-buffer-img"}}],r=t.children[1];r.classList.add("component-content--scroll"),r.classList.add("component-content--analysis");let i=new Xa(e).getElement();r.appendChild(i);let s=i.children[0].children[0],n=i.children[0].children[2].children[0];s.children[0].id="dropDownTop";let a=wo().DomUtil.create("div","component-analysis__container",r),o=wo().DomUtil.create("div","component-analysis__container__analysisLayer",a),l=wo().DomUtil.create("div","component-analysis__selecttool",o);l.id="layerSelectControl";let h={optionsArr:[""],labelName:ja.i18n("text_label_analysisLayer")},u=new Ya(h),c=u.getElement();this.layerSelectObj=u,l.appendChild(c);let d=c.children[1].children[0];d.id="layerSelectName",c.children[1].children[2].children[0].children[0].id="layersSelect";let p=wo().DomUtil.create("div","component-analysis__container__analysistype",a),f=wo().DomUtil.create("div","component-clientcomputation__isoline",p),m={optionsArr:[""],labelName:ja.i18n("text_label_extractField"),optionsClickCb:this.fieldsSelectOnchange},y=wo().DomUtil.create("div","component-analysis__selecttool",f),g=new Ya(m),v=g.getElement();this.fieldsSelectObj=g;let b=v.children[1].children[0];b.id="fieldsSelectName";let S=v.children[1].children[2].children[0].children[0];S.id="fieldsSelect",y.appendChild(v);let _=wo().DomUtil.create("div","component-analysis__container",f);wo().DomUtil.create("span","component-textarea__name",_).innerHTML=ja.i18n("text_label_extractedValue");let x=wo().DomUtil.create("div","component-textarea",_);x.id="getValueText";let w=wo().DomUtil.create("div","",x),C=wo().DomUtil.create("div","component-scrollarea-content",w);C.setAttribute("tabindex","1");let M=wo().DomUtil.create("textarea","component-textarea__content",C);M.id="getValueTextArea",M.setAttribute("rows","20");let A=wo().DomUtil.create("div","",f);wo().DomUtil.create("span","",A).innerHTML=ja.i18n("text_label_distanceAttenuation");let T=wo().DomUtil.create("input","",A);T.value="3";let E=wo().DomUtil.create("div","",f);wo().DomUtil.create("span","",E).innerHTML=ja.i18n("text_label_gridSize");let O=wo().DomUtil.create("input","",E);O.value="30";let L=wo().DomUtil.create("div","component-clientcomputation__buffer hidden",p),P=wo().DomUtil.create("div","component-clientcomputation__buffer--radius",L);wo().DomUtil.create("span","",P).innerHTML=ja.i18n("text_label_bufferRadius");let N=wo().DomUtil.create("div","",P),I=wo().DomUtil.create("input","buffer-radius-input",N);I.id="bufferRadiusInput",I.value="10",I.setAttribute("placeholder",ja.i18n("text_label_defaultkilometers"));let F=wo().DomUtil.create("div","component-clientcomputation__buffer--unit",N);F.id="bufferUnit";let k={optionsArr:[ja.i18n("text_option_kilometer")],labelName:ja.i18n("text_label_unit")},D=new Ya(k).getElement(),R=D.children[1].children[0];R.id="bufferUnitSelectName",D.children[1].children[2].children[0].children[0].id="bufferUnitSelect",D.children[0].style.display="none",F.appendChild(D);let B=wo().DomUtil.create("div","",P),G=wo().DomUtil.create("div","component-clientcomputation__buffer--issaveattrs",B);G.id="saveAttrsContainer";let U=wo().DomUtil.create("div","checkbox checkbox-fault",G);U.id="saveAttrsCheckbox";let j=wo().DomUtil.create("div","lable",G);j.id="saveAttrsLabel",j.innerHTML=ja.i18n("text_retainOriginal");let z=wo().DomUtil.create("div","component-clientcomputation__buffer--isunion",B);z.id="isUnionContainer";let V=wo().DomUtil.create("div","checkbox checkbox-fault",z);V.id="isUnionCheckbox";let J=wo().DomUtil.create("div","lable",z);J.innerHTML=ja.i18n("text_mergeBuffer"),J.id="isUnionLabel";let q=wo().DomUtil.create("div","component-analysis__container__resultLayersName",a);wo().DomUtil.create("span","",q).innerHTML=ja.i18n("text_label_resultLayerName");let H=wo().DomUtil.create("input","",q);H.id="resultLayersName";let W=wo().DomUtil.create("div","component-analysis__container__analysisbtn",a),Y=wo().DomUtil.create("div","component-analysis__analysisbtn",W),X=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis",Y);X.innerHTML=ja.i18n("btn_analyze");let Q=wo().DomUtil.create("div","component-analysis__analysisbtn--analysing-container hidden",Y),Z=wo().DomUtil.create("div","component-analysis__analysisbtn--analysising",Q),K=wo().DomUtil.create("div","component-analysis__svg-container",Z);K.id="analyse_background",K.innerHTML='<svg class="component-analysis__svg-rotate" width="16px" height="16px" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path id="ring" fill="#FFF" transform="translate(8,8)" d="M 0 0 v -8 A 8 8 0 1 1 -8.00 0 z"></path>\n            <circle cx="8" cy="8" r="6" fill="#38ADF5"></circle>\n            <rect class="svg-top" x="8" y="0" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n            <rect class="svg-left" x="0" y="8" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n        </svg>',wo().DomUtil.create("span","",Z).innerHTML=ja.i18n("btn_analyzing");let $=wo().DomUtil.create("button","component-analysis__analysisbtn--cancel",Q);$.innerHTML=ja.i18n("btn_cancelAnalysis");let tt=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis component-analysis__analysisbtn--deletelayers",Y);tt.innerHTML=ja.i18n("btn_emptyTheAnalysisLayer");for(let t=0;t<n.children.length;t++)n.children[t].onclick=(()=>{s.innerHTML=n.children[t].outerHTML,s.children[0].id="dropDownTop";let e=document.getElementById("layersSelect"),i=document.getElementById("layerSelectName"),a=n.children[t].getAttribute("data-value"),o={};switch(a){case"buffer":f.classList.add("hidden"),L.classList.remove("hidden"),r.style.height="422px",H.value=ja.i18n("text_label_buffer")+i.title,o=this.fillData.point;break;case"isolines":f.classList.remove("hidden"),L.classList.add("hidden"),r.style.height="712px",H.value=ja.i18n("text_label_isolines")+i.title,o=this.fillData.point}if(this.currentFillData===o)return;if(e.innerHTML="","{}"==JSON.stringify(o))return H.value="",i.title="",void(i.innerHTML="");let l=[];for(let t in o)l.push(t);i.title=l[0],i.innerHTML=l[0],this._createOptions(e,l),this.layerSelectObj.optionClickEvent(e,i,this.layersSelectOnchange),"buffer"===a?H.value=ja.i18n("text_label_buffer")+l[0]:"isolines"===a&&(H.value=ja.i18n("text_label_isolines")+l[0]),this.currentData=o[i.title],this.currentFillData=o});this.fieldsSelectOnchange=function(t){if(this.currentData){let e=this.currentData,r=t.title;M.value=e.fieldsValue[r].toString().replace(/,/g,",\r\n"),M.setAttribute("data-value",e.fieldsValue[r])}}.bind(this),this.layersSelectOnchange=function(t){if(this.currentData){let e=t.title,r=this.currentFillData[e];this.currentData=r,S.innerHTML="",this._createOptions(S,r.fields);let i=document.getElementById("fieldsSelectName"),s=r.fields[0];i.title=s,i.innerHTML=s;let n=s;this.fieldsSelectObj.optionClickEvent(S,i,this.fieldsSelectOnchange),M.value=r.fieldsValue[n].toString().replace(/,/g,",\r\n"),M.setAttribute("data-value",r.fieldsValue[n]);let a=document.getElementById("dropDownTop").getAttribute("data-value");switch(a){case"buffer":H.value=ja.i18n("text_label_buffer")+e;break;case"isolines":H.value=ja.i18n("text_label_isolines")+e}}}.bind(this);let et=!0,rt=!1;return j.classList.add("selected"),U.classList.add("checkbox-active"),G.onclick=(()=>{et?(U.classList.add("checkbox-fault"),U.classList.remove("checkbox-active"),j.classList.remove("selected"),et=!1):(U.classList.add("checkbox-active"),U.classList.remove("checkbox-fault"),j.classList.add("selected"),et=!0,rt&&(V.classList.add("checkbox-fault"),V.classList.remove("checkbox-active"),rt=!1))}),z.onclick=(()=>{rt?(V.classList.add("checkbox-fault"),V.classList.remove("checkbox-active"),J.classList.remove("selected"),rt=!1):(V.classList.add("checkbox-active"),V.classList.remove("checkbox-fault"),J.classList.add("selected"),rt=!0,et&&(U.classList.add("checkbox-fault"),U.classList.remove("checkbox-active"),et=!1))}),this.messageBox=new Ga,X.onclick=(()=>{let t;switch(Q.style.display="block",X.style.display="none",document.getElementById("dropDownTop").getAttribute("data-value")){case"isolines":t=function(){let t=document.getElementById("dropDownTop").getAttribute("data-value"),e=document.getElementById("resultLayersName").value,r=d.title,i=b.title,s=M.value.replace(/[\r\n]/g,"").split(",").toString(),n=T.value,a=O.value;return{analysisMethod:t,analysisLayers:r,analysisFields:i,analysisFieldsValue:s,analysisBreaks:n,analysisCellSize:a,resultLayersName:e}}();break;case"buffer":t=function(){let t=document.getElementById("dropDownTop"),e=document.getElementById("resultLayersName").value,r=d.title,i=t.getAttribute("data-value"),s=I.value,n=R.title;return{analysisMethod:i,analysisLayers:r,radius:s,unit:n,resultLayersName:e,isSaveStatus:et,isUnion:rt}}()}this.viewModel.analysis(t,this.map),this.viewModel.on("layerloaded",t=>{Q.style.display="none",X.style.display="block",this._event.fire("analysissucceeded",{layer:t.layer,name:t.name})}),this.viewModel.on("analysisfailed",()=>{Q.style.display="none",X.style.display="block",this.messageBox.showView(ja.i18n("msg_resultIsEmpty"),"failure"),this._event.fire("analysisfailed")})}),$.onclick=(()=>{Q.style.display="none",X.style.display="block",this.viewModel.cancelAnalysis()}),tt.onclick=(()=>{this.viewModel.on("layersremoved",t=>{this._event.fire("layersremoved",{layers:t.layers})}),this.viewModel.clearLayers()}),this._preventMapEvent(t,this.map),t},_createOptions(t,e){for(let r in e){let i=document.createElement("div"),s=e[r];i.className="component-selecttool__option",i.title=s,i.innerHTML=s,i.setAttribute("data-value",s),t.appendChild(i)}}});class ey{constructor(t){this.layerName=t.layerName,this.layer=t.layer,this.fields=t.fields||null}}class ry extends wo().Evented{initialize(t){this.processingUrl=t}getDatasetsName(){let t=this.processingUrl;this.dataset=[],this.dataset.datasetNames=[],this.dataset.childUrl=[];let e="http://"+t.split("/")[2],r=e+"/iserver/services/datacatalog/rest/datacatalog/sharefile.json",i=e+"/iserver/services/datacatalog/rest/datacatalog/relationship/datasets.json",s=this;zt.get(r).then(function(t){return t.json()}).then(function(t){s.dataset.datasetNames=s.dataset.datasetNames.concat(t.datasetNames),s.dataset.childUrl=s.dataset.childUrl.concat(t.childUriList);let e=s;zt.get(i).then(function(t){return t.json()}).then(function(t){e.dataset.datasetNames=e.dataset.datasetNames.concat(t.datasetNames),e.dataset.childUrl=e.dataset.childUrl.concat(t.childUriList);let r=[];for(let t in e.dataset.datasetNames)r[e.dataset.datasetNames[t]]=e.dataset.childUrl[t];e.fire("datasetsloaded",{result:{dataset:e.dataset,datasetHash:r}})})})}getDatasetInfo(t){let e,r=this;zt.get(t).then(function(t){return t.json()}).then(function(t){let i=t.datasetInfo;"LINE"===i.datasetType||"LINE"===i.type?e="LINE":"POINT"===i.datasetType||"POINT"===i.type||"CSV"===i.type?e="POINT":"REGION"!==i.datasetType&&"REGION"!==i.type||(e="REGION");let s=[],n=i.fieldInfos||i.fieldInfo||null;if(n){for(let t in n)s.push(n[t].name);r.fire("datasetinfoloaded",{result:{type:e,fields:s}})}else{let i=t.childUriList[0].replace("//fields","/fields");zt.get(i).then(function(t){return t.json()}).then(function(t){let i=t.fieldNames,s=[];for(let t in i)s.push(i[t]);r.fire("datasetinfoloaded",{result:{type:e,fields:s}})})}})}}class iy extends wo().Evented{initialize(t){this.processingUrl=t}getDatasetsName(){let t=this.processingUrl;this.resultLayers=[],this.datasetNames=[],this.distributedAnalysisModel=new ry(t),this.distributedAnalysisModel.getDatasetsName();let e=this;this.distributedAnalysisModel.on("datasetsloaded",function(t){e.fire("datasetsloaded",{result:t.result})})}getDatasetInfo(t){this.distributedAnalysisModel.getDatasetInfo(t);let e=this;this.distributedAnalysisModel.on("datasetinfoloaded",function(t){let r=t.result.type,i=t.result.fields;e.fire("datasetinfoloaded",{result:{type:r,fields:i}})})}analysis(t,e){let r=new km(this.processingUrl);if(t.analysisParam instanceof Ii){let i=t.analysisParam,s=this;r.addKernelDensityJob(i,function(r){r.error?s.fire("analysisfailed",{error:r.error}):r.result.setting.serviceInfo.targetServiceInfos.map(function(r){return"RESTMAP"===r.serviceType&&zt.get(r.serviceAddress+"/maps").then(function(t){return t.json()}).then(function(r){let i=r[0].path;s.fire("analysissucceed",{result:r});let n=Fc(i,{noWrap:!0,transparent:!0});s.resultLayers.push(n),n.addTo(e);let a=new Date,o=t.resultLayerName||a.getTime();s.fire("layerloaded",{layer:n,name:o})}),r})})}}clearLayers(){for(let t in this.resultLayers)this.resultLayers[t].remove();this.fire("layersremoved",{layers:this.resultLayers}),this.resultLayers=[]}}var sy=Vm.extend({initialize:function(t,e){Vm.prototype.initialize.apply(this,[e]),this.viewModel=new iy(t)},onAdd:function(t){return this._fillDataToView(),Vm.prototype.onAdd.apply(this,[t])},_fillDataToView:function(){this.viewModel.on("datasetsloaded",t=>{let e=t.result.dataset.datasetNames;this.datasetSelect.innerHTML="",this._createOptions(this.datasetSelect,e),this.datasetSelectObj.optionClickEvent(this.datasetSelect,this.datasetSelectName,this.datasetSelectOnchange),this.dataHash=t.result.datasetHash}),this.viewModel.getDatasetsName()},_initView:function(){let t=new Wa({title:ja.i18n("title_distributedAnalysis")}).getElement();t.classList.add("component-analysis"),t.children[0].style.fontSize="12px";let e=wo().DomUtil.create("div","component-content component-content--scroll component-content--analysis",t),r=[{title:ja.i18n("text_densityAnalysis"),dataValue:"density",remark:ja.i18n("text_CalculateTheValuePerUnitArea"),icon:{className:"component-analyst-density-img"}}],i=new Xa(r).getElement();e.appendChild(i);let s=i.children[0].children[0].children[0],n=wo().DomUtil.create("div","component-analysis__container",e),a=wo().DomUtil.create("div","analysistype",n),o=wo().DomUtil.create("div","component-analysis__container__analysisLayer",a),l=wo().DomUtil.create("div","component-analysis__selecttool",o),h={optionsArr:[ja.i18n("text_option_selectDataset")],labelName:ja.i18n("text_label_dataset"),optionsClickCb:et.bind(this)},u=new Ya(h),c=u.getElement();this.datasetSelectObj=u,l.appendChild(c);let d=c.children[1].children[0];this.datasetSelectName=d;let p=c.children[1].children[2].children[0].children[0];p.children[0].style.display="none",this.datasetSelect=p;let f=wo().DomUtil.create("div","component-analysis__idw",o),m=[{optionsArr:[ja.i18n("text_option_simplePointDensityAnalysis"),ja.i18n("text_option_nuclearDensityAnalysis")],labelName:ja.i18n("text_label_analyticalMethod")},{optionsArr:[ja.i18n("text_option_quadrilateral"),ja.i18n("text_option_hexagon")],labelName:ja.i18n("text_label_meshType")}],y=wo().DomUtil.create("div","component-analysis__idw__selecttool",f);for(let t in m){let e=new Ya(m[t]).getElement();y.appendChild(e)}let g={optionsArr:[ja.i18n("text_option_notSet")],labelName:ja.i18n("text_label_weightField")},v=new Ya(g),b=v.getElement();y.appendChild(b),this.weightFieldsSelectObj=v;let S=y.children[0].children[1].children[0];S.setAttribute("data-value","0");let _=y.children[0].children[1].children[2].children[0].children[0];this._setEleAtribute(["0","1"],"data-value",_.children);let x=y.children[1].children[1].children[0];x.setAttribute("data-value","0");let w=y.children[1].children[1].children[2].children[0].children[0];this._setEleAtribute(["0","1"],"data-value",w.children);let C=y.children[2].children[1].children[0],M=y.children[2].children[1].children[2].children[0].children[0],A=[{spanName:ja.i18n("text_label_queryRange"),value:""}];for(let t in A)this._creatInputBox(A[t],y);let T=y.children[3].children[1];T.setAttribute("placeholder",ja.i18n("text_label_queryRangeTips")),T.title=ja.i18n("text_label_queryRangeTips");let E={labelName:ja.i18n("text_label_gridSizeInMeters"),selectOptions:{optionsArr:["Meter","Kilometer","Yard","Foot","Mile"]}},O=this._creatUnitSelectBox(E,y),L=O.children[1].children[0];L.value="1000";let P=O.children[1].children[1].children[0].children[0].children[0],N={labelName:ja.i18n("text_label_searchRadius"),selectOptions:{optionsArr:["Meter","Kilometer","Yard","Foot","Mile"]}},I=this._creatUnitSelectBox(N,y),F=I.children[1].children[0];F.value="300";let k=I.children[1].children[1].children[0].children[0].children[0],D={labelName:ja.i18n("text_label_areaUnit"),optionsArr:["SquareMile","SquareMeter","Hectare","Acre","SquareFoot","SquareYard"]},R=new Ya(D).getElement();y.appendChild(R);let B=R.children[1].children[0],G=wo().DomUtil.create("div","range-content",a),U={optionsArr:[ja.i18n("text_option_notSet"),ja.i18n("text_option_equidistantSegmentation"),ja.i18n("text_option_logarithm"),ja.i18n("text_option_equalCountingSegment"),ja.i18n("text_option_squareRootSegmentation")],labelName:ja.i18n("text_label_thematicMapSegmentationMode"),optionsClickCb:function(t){"NOTSET"!==t.getAttribute("data-value")?(V.classList.remove("hidden"),J.classList.remove("hidden")):(V.classList.add("hidden"),J.classList.add("hidden"))}};G.appendChild(new Ya(U).getElement());let j=G.children[0].children[1].children[0];j.setAttribute("data-value","NOTSET");let z=G.children[0].children[1].children[2].children[0].children[0];this._setEleAtribute(["NOTSET","EQUALINTERVAL","LOGARITHM","QUANTILE","SQUAREROOT"],"data-value",z.children);let V=this._creatInputBox({spanName:ja.i18n("text_label_thematicMapSegmentationParameters"),value:"20"},G);V.classList.add("hidden");let J=new Ya({optionsArr:[ja.i18n("text_option_greenOrangePurpleGradient"),ja.i18n("text_option_greenOrangeRedGradient"),ja.i18n("text_option_rainbowGradient"),ja.i18n("text_option_spectralGradient"),ja.i18n("text_option_terrainGradient")],labelName:ja.i18n("text_label_thematicMapColorGradientMode")}).getElement();G.appendChild(J),J.classList.add("hidden");let q=J.children[1].children[2].children[0].children[0],H=J.children[1].children[0];H.setAttribute("data-value","GREENORANGEVIOLET");this._setEleAtribute(["GREENORANGEVIOLET","GREENORANGERED","RAINBOW","SPECTRUM","TERRAIN"],"data-value",q.children);let W=wo().DomUtil.create("div","",a);wo().DomUtil.create("span","",W).innerHTML=ja.i18n("text_label_resultLayerName");let Y=wo().DomUtil.create("input","component-distributeanalysis__input",W),X=wo().DomUtil.create("div","component-analysis__container__analysisbtn",n),Q=wo().DomUtil.create("div","component-analysis__analysisbtn",X),Z=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis",Q);Z.innerHTML=ja.i18n("btn_analyze");let K=wo().DomUtil.create("div","component-analysis__analysisbtn--analysing-container hidden",Q),$=wo().DomUtil.create("div","component-analysis__analysisbtn--analysising",K);$.style.width="200px",wo().DomUtil.create("div","component-analysis__svg-container",$).innerHTML='<svg class="component-analysis__svg-rotate" width="16px" height="16px" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path id="ring" fill="#FFF" transform="translate(8,8)" d="M 0 0 v -8 A 8 8 0 1 1 -8.00 0 z"></path>\n            <circle cx="8" cy="8" r="6" fill="#38ADF5"></circle>\n            <rect class="svg-top" x="8" y="0" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n            <rect class="svg-left" x="0" y="8" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n        </svg>',wo().DomUtil.create("span","",$).innerHTML=ja.i18n("btn_analyzing");let tt=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis component-analysis__analysisbtn--deletelayers",Q);function et(t){if(this.messageBox.closeView(),this.dataHash){M.innerHTML="";let e=this.dataHash[t.title],r=this;this.viewModel.on("datasetinfoloaded",function(t){C.title=ja.i18n("text_option_notSet"),C.innerHTML=ja.i18n("text_option_notSet"),M.innerHTML="";let e=s.getAttribute("data-value"),i=t.result.type,n=t.result.fields;"density"===e&&("REGION"===i||"LINE"===i?r.messageBox.showView(ja.i18n("msg_datasetOrMethodUnsupport"),"failure"):(r.messageBox.closeView(),r._createOptions(M,n),r.weightFieldsSelectObj.optionClickEvent(M,C)))}),this.viewModel.getDatasetInfo(e)}}return tt.id="deleteLayersBtn",tt.innerHTML=ja.i18n("btn_emptyTheAnalysisLayer"),this.messageBox=new Ga,this.datasetSelectOnchange=et.bind(this),Z.onclick=(()=>{this.messageBox.closeView();let t=function(){let t,e,r=s.getAttribute("data-value"),i=S.getAttribute("data-value"),n=x.getAttribute("data-value"),a=T.value,o=P.title,l=k.title,h=B.title,u=H.getAttribute("data-value"),c=j.getAttribute("data-value"),p=new Date,f=Y.value||p.getTime();t="NOTSET"===c?"":{rangeMode:c,rangeCount:V.value,colorGradientType:u};"density"===r&&(e=new Ii({datasetName:d.title,method:i,meshType:n,resolution:L.value,fields:C.title,radius:F.value,meshSizeUnit:o,radiusUnit:l,areaUnit:h,query:a,mappingParameters:new xe({rangeMode:t.rangeMode,rangeCount:t.rangeCount,colorGradientType:t.colorGradientType})}));return{analysisParam:e,resultLayerName:f}}();d.title===ja.i18n("text_option_selectDataset")?this.messageBox.showView(ja.i18n("msg_selectDataset"),"failure"):C.title===ja.i18n("text_option_notSet")?this.messageBox.showView(ja.i18n("msg_setTheWeightField"),"failure"):(this.messageBox.closeView(),K.style.display="block",Z.style.display="none",this.viewModel.on("layerloaded",t=>{K.style.display="none",Z.style.display="block",this._event.fire("analysissucceeded",{layer:t.layer,name:t.name})}),this.viewModel.on("analysisfailed",t=>{this.messageBox.showView(ja.i18n("msg_theFieldNotSupportAnalysis"),"failure"),K.style.display="none",Z.style.display="block",this._event.fire("analysisfailed",{error:t.error})}),this.viewModel.analysis(t,this.map))}),tt.onclick=(()=>{this.viewModel.on("layersremoved",t=>{this._event.fire("layersremoved",{layers:t.layers})}),this.viewModel.clearLayers()}),this._preventMapEvent(t,this.map),t},_createOptions(t,e){for(let r in e){let i=document.createElement("div");i.className="component-selecttool__option",i.title=e[r],i.innerHTML=e[r],i.setAttribute("data-value",e[r]),t.appendChild(i)}},_creatInputBox(t,e){let r=wo().DomUtil.create("div","",e);wo().DomUtil.create("span","",r).innerHTML=t.spanName;let i=wo().DomUtil.create("input","",r);return i.value=t.value,i.className="component-distributeanalysis__input",r},_creatUnitSelectBox(t,e){let r=wo().DomUtil.create("div","component-clientcomputation__buffer--radius",e);wo().DomUtil.create("span","",r).innerHTML=t.labelName;let i=wo().DomUtil.create("div","",r);wo().DomUtil.create("input","buffer-radius-input",i);let s=wo().DomUtil.create("div","component-clientcomputation__buffer--unit",i),n=t.selectOptions,a=new Ya(n).getElement();return s.appendChild(a),r},_setEleAtribute(t,e,r){for(let i=0;i<r.length;i++)r[i].setAttribute(e,t[i])}});class ny extends wo().Evented{initialize(t){this.dataserviceUrl=t,this.resultLayers=[]}getFeatures(t,e){let r=this.dataserviceUrl,i=this,s=Qc(r);t instanceof Jr?s.getFeaturesByIDs(t,function(t){i._getQureyResult(t,e)}):t instanceof Hr?s.getFeaturesBySQL(t,function(t){i._getQureyResult(t,e)}):t instanceof Rr?s.getFeaturesByBounds(t,function(t){i._getQureyResult(t,e)}):t instanceof Ur?s.getFeaturesByBuffer(t,function(t){i._getQureyResult(t,e)}):t instanceof zr&&s.getFeaturesByGeometry(t,function(t){i._getQureyResult(t,e)})}_getQureyResult(t,e){if(t.error)return void this.fire("getfeaturesfailed",{error:t.error});let r=wo().geoJSON(t.result.features,{onEachFeature:function(t,e){e.bindPopup("ID: "+t.properties.SMID)},pointToLayer:function(t,e){return wo().circleMarker(e,{radius:6})}}).addTo(e);this.resultLayers.push(r),this.fire("getfeaturessucceeded",{result:t.result.features})}clearLayers(){for(let t in this.resultLayers)this.resultLayers[t].remove();this.resultLayers=[]}}var ay=function(t){return new ay(t)},oy=Vm.extend({initialize:function(t,e,r){if(Vm.prototype.initialize.apply(this,[r]),this.dataServiceUrl=t,!e||0===e.length)throw new Error("Please configure the dataset of the queryï¼");e instanceof Array?this.dataSetNames=e:this.dataSetNames=e.split(" ")},onAdd:function(t){return Vm.prototype.onAdd.apply(this,[t])},onRemove:function(){this.map.off("pm:create")},setDataSetNames(t){t instanceof Array?this.dataSetNames=t:this.dataSetNames=t.split(" ")},setGetFeatureMode(t){this.getFeatureMode=t,this._getFeatureModeOnchange(this.getFeatureMode)},setDataServiceUrl(t){this.dataServiceUrl=t,this.viewModel=new ny(this.dataServiceUrl)},_getFeatureModeOnchange(t){let e;e=t&&"{}"!=JSON.stringify(t)?t:["ID","SQL","BOUNDS","BUFFER","SPATIAL"];let r=document.getElementById("queryModelControl");r.innerHTML="",this.creatQueryModeSelect(e,r)},_initView:function(){this.viewModel=new ny(this.dataServiceUrl),this.messageBox=new Ga;let t=new Wa({title:ja.i18n("title_dataServiceQuery")}).getElement();t.classList.add("component-servicequery__container"),t.children[0].classList.add("component-servicequery__title");let e=t.children[1];e.classList.add("component-content--scroll"),e.classList.add("data-services");let r,i=wo().DomUtil.create("div","component-analysis__container",e),s=wo().DomUtil.create("div","component-servicequery__analysistype",i),n=wo().DomUtil.create("div","component-analysis__container__analysisLayer",s),a=this.options.getFeatureMode;r=a&&"{}"!=JSON.stringify(a)?a:["ID","SQL","BOUNDS","BUFFER","SPATIAL"];let o=wo().DomUtil.create("div","",n);o.id="queryModelContainer";let l=wo().DomUtil.create("div","component-analysis__selecttool",o);l.id="queryModelControl",this.creatQueryModeSelect=function(t,e){let r;if(t instanceof Array&&t.length>1){let i={optionsArr:t,labelName:ja.i18n("text_label_queryMode"),optionsClickCb:this.queryModeltOnchange},s=new Ya(i).getElement();e.appendChild(s),r=s.children[1].children[0],s.children[1].classList.add("dataservice-select");let n=s.children[1];n.classList.add("dataservice-select"),n.classList.add("querymodel-select")}else{let e=wo().DomUtil.create("span","",o);e.innerHTML=ja.i18n("text_label_queryMode"),r=wo().DomUtil.create("div","component-servicequery__querymode-selectname",o);let i=wo().DomUtil.create("span","",r);t instanceof Array?i.innerHTML=t[0]:i.innerHTML=t,r.title=i.innerHTML,this.queryModeltOnchange(r)}return r.id="queryModelSelectName",r}.bind(this),this.queryModeltOnchange=H.bind(this),this.creatQueryModeSelect(r,l);let h=wo().DomUtil.create("div","component-analysis__container component-textarea--dataservice__container",n),u=wo().DomUtil.create("span","textarea-name",h);u.innerHTML=ja.i18n("text_label_IDArrayOfFeatures");let c=wo().DomUtil.create("div","component-textarea component-textarea--dataservice",h);c.id="getfeaturesIdArr";let d=wo().DomUtil.create("div","scrollarea",c),p=wo().DomUtil.create("div","component-scrollarea-content",d);p.setAttribute("tabindex","1");let f=wo().DomUtil.create("textarea","component-textarea__content",p);f.value="[1,2,3]",f.id="getValueTextArea";let m=wo().DomUtil.create("div","component-servicequery__maxfeatures-container hidden",n),y={spanName:ja.i18n("text_label_maxFeatures"),value:"1000"},g=this._creatInputBox(y,m).children[1];g.classList.add("max-features-input");let v=wo().DomUtil.create("div","component-servicequery__distance-container hidden",n),b={spanName:ja.i18n("text_label_bufferDistance"),value:"10"},S=this._creatInputBox(b,v).children[1],_=wo().DomUtil.create("div","component-analysis__container component-textarea--dataservice__container hidden",n),x=wo().DomUtil.create("span","textarea-name",_),w=wo().DomUtil.create("div","",_),C=wo().DomUtil.create("div","component-servicequery__rangeicon-container",w);x.innerHTML=ja.i18n("text_label_queryRange1");let M=wo().DomUtil.create("div","component-servicequery__rangeicon supermapol-icons-polygon-layer bounds",C),A=wo().DomUtil.create("div","component-servicequery__rangeicon supermapol-icons-line-layer hidden",C),T=wo().DomUtil.create("div","component-servicequery__rangeicon supermapol-icons-point-layer hidden",C),E=wo().DomUtil.create("div","component-textarea component-textarea--rangequery",w);E.id="getfeaturesIdArr";let O=wo().DomUtil.create("div","",E),L=wo().DomUtil.create("div","component-scrollarea-content",O);L.setAttribute("tabindex","1");let P=wo().DomUtil.create("textarea","component-textarea__content component-textarea--rangequery__content",L);P.value='{"leftBottom":{"x":-5,"y":-5},"rightTop":{"x":5,"y":5}}';let N=wo().DomUtil.create("div","component-servicequery__spatialquerymode-container hidden",n),I={optionsArr:["CONTAIN","CROSS","DISJOINT","IDENTITY","INTERSECT","NONE","OVERLAP","TOUCH","WITHIN"],labelName:ja.i18n("text_label_spatialQueryMode")},F=wo().DomUtil.create("div","component-analysis__selecttool",N),k=new Ya(I).getElement();k.children[1].classList.add("dataservice-select"),F.appendChild(k);let D=k.children[1].children[0];D.id="spatialQueryModeSelectName",k.children[1].children[2].classList.add("component-servicequery__spatialquerymode__selectcontent");let R=wo().DomUtil.create("div","component-analysis__container__analysisbtn",n),B=wo().DomUtil.create("div","component-analysis__analysisbtn",R),G=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis",B);G.innerHTML=ja.i18n("btn_query");let U=wo().DomUtil.create("div","component-analysis__analysisbtn--analysing-container hidden",B),j=wo().DomUtil.create("div","component-analysis__analysisbtn--analysising component-servicequery__querybtn--querying",U);wo().DomUtil.create("div","component-analysis__svg-container",j).innerHTML='<svg class="component-analysis__svg-rotate" width="16px" height="16px" version="1.1" xmlns="http://www.w3.org/2000/svg">\n             <path id="ring" fill="#FFF" transform="translate(8,8)" d="M 0 0 v -8 A 8 8 0 1 1 -8.00 0 z"></path>\n             <circle cx="8" cy="8" r="6" fill="#38ADF5"></circle>\n             <rect class="svg-top" x="8" y="0" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n             <rect class="svg-left" x="0" y="8" rx="2" ry="2" width="2" height="2" style="fill: rgb(255, 255, 255); stroke-width: 0;"></rect>\n         </svg>',wo().DomUtil.create("span","",j).innerHTML=ja.i18n("btn_querying");let z=wo().DomUtil.create("button","component-analysis__analysisbtn--analysis component-analysis__analysisbtn--deletelayers",B);z.innerHTML=ja.i18n("btn_emptyTheRresultLayer"),H(r[0]);let V,J,q=this;function H(t){let e;switch(e=t.title?t.title:t,m.classList.add("hidden"),_.classList.add("hidden"),v.classList.add("hidden"),A.classList.add("hidden"),T.classList.add("hidden"),M.classList.remove("bounds"),N.classList.add("hidden"),u.innerHTML=ja.i18n("text_label_featureFilter"),f.value="SMID<10","BUFFER"!==e&&"SPATIAL"!==e||(_.classList.remove("hidden"),x.innerHTML=ja.i18n("text_label_geometricObject"),P.value='{"type":"Feature","properties":{},"geometry":{"type":"Point","coordinates":[84.90234375,40.25390625]}}',A.classList.remove("hidden"),T.classList.remove("hidden")),e){case"ID":u.innerHTML=ja.i18n("text_label_IDArrayOfFeatures"),f.value="[1,2,3]";break;case"SQL":m.classList.remove("hidden");break;case"BOUNDS":_.classList.remove("hidden"),x.innerHTML=ja.i18n("text_label_queryRange"),P.value='{"leftBottom":{"x":-5,"y":-5},"rightTop":{"x":5,"y":5}}',M.classList.add("bounds");break;case"BUFFER":v.classList.remove("hidden");break;case"SPATIAL":N.classList.remove("hidden")}}return G.onclick=(()=>{this.messageBox.closeView(),U.style.display="block",G.style.display="none";let t=function(){let t,e=q.dataSetNames,r=document.getElementById("queryModelSelectName").title,i=f.value;if("ID"===r){let r=f.value,i=r.substring(1,r.length-1).split(",");t=new Jr({IDs:i,datasetNames:e})}else if("SQL"===r){let r=g.value;t=new Hr({queryParameter:{attributeFilter:i},datasetNames:e,maxFeatures:r})}else if("BOUNDS"===r){if(!V){let t=JSON.parse(P.value);V=wo().bounds([t.leftBottom.x,t.leftBottom.y],[t.rightTop.x,t.rightTop.y])}t=new Rr({attributeFilter:i,datasetNames:e,bounds:V})}else if("BUFFER"===r){let r=S.value,s=JSON.parse(P.value),n=J||s;t=new Ur({attributeFilter:i,datasetNames:e,bufferDistance:r,geometry:n})}else if("SPATIAL"===r){let r=D.title,s=JSON.parse(P.value),n=J||s;t=new zr({attributeFilter:i,datasetNames:e,spatialQueryMode:r,geometry:n})}return t}();this.viewModel.on("getfeaturessucceeded",t=>{U.style.display="none",G.style.display="block",0===t.result.features.length&&this.messageBox.showView(ja.i18n("msg_dataReturnedIsEmpty"),"success"),this._event.fire("getfeaturessucceeded",{result:t.result})}),this.viewModel.on("getfeaturesfailed",t=>{U.style.display="none",G.style.display="block",this.messageBox.showView(t.error.errorMsg,"failure"),this._event.fire("getfeaturesfailed",{error:t.error})}),this.viewModel.getFeatures(t,this.map)}),M.onclick=(t=>{let e=document.getElementById("queryModelSelectName").title;J&&J.remove(),"BOUNDS"===e?this.map.pm.enableDraw("Rectangle"):this.map.pm.enableDraw("Poly"),t.stopPropagation(),t.preventDefault()}),A.onclick=(t=>{J&&J.remove(),this.map.pm.enableDraw("Line"),t.stopPropagation(),t.preventDefault()}),T.onclick=(t=>{J&&J.remove(),this.map.pm.enableDraw("Marker"),t.stopPropagation(),t.preventDefault()}),this.map.on("pm:create",t=>{if("Rectangle"===t.shape){let e=(J=t.layer).getBounds();V=wo().bounds([e._southWest.lng,e._southWest.lat],[e._northEast.lng,e._northEast.lat]);let r={leftBottom:{x:e._southWest.lng,y:e._southWest.lat},rightTop:{x:e._northEast.lng,y:e._northEast.lat}};P.value=JSON.stringify(r)}"Marker"===t.shape&&(J=t.layer,P.value=JSON.stringify(t.layer.toGeoJSON()),this.map.pm.disableDraw("Marker")),"Line"===t.shape&&(J=t.layer,P.value=JSON.stringify(t.layer.toGeoJSON())),"Polygon"===t.shape&&(J=t.layer,P.value=JSON.stringify(t.layer.toGeoJSON()))}),z.onclick=(()=>{this.viewModel.clearLayers()}),this._preventMapEvent(t,this.map),t},_creatInputBox(t,e){let r=wo().DomUtil.create("div","",e);return wo().DomUtil.create("span","",r).innerHTML=t.spanName,wo().DomUtil.create("input","",r).value=t.value,r}});wo().supermap={...t,Components:{...t.Components},...wo().supermap},wo().supermap.components=wo().supermap.components||{},wo().supermap.Components=wo().supermap.Components||{},wo().supermap.control=wo().supermap.control||{},wo().supermap.Util={},wo().Util.toGeoJSON=gc,wo().supermap.Util.toGeoJSON=gc,wo().Util.toSuperMapGeometry=vc,wo().supermap.Util.toSuperMapGeometry=vc,wo().Util.resolutionToScale=Sc,wo().supermap.Util.resolutionToScale=Sc,wo().Util.scaleToResolution=_c,wo().supermap.Util.scaleToResolution=_c,wo().Util.getMeterPerMapUnit=bc,wo().supermap.Util.getMeterPerMapUnit=bc,wo().Util.GetResolutionFromScaleDpi=wc,wo().supermap.Util.getResolutionFromScaleDpi=wc,wo().supermap.Util.GetResolutionFromScaleDpi=wc,wo().Util.NormalizeScale=xc,wo().supermap.Util.normalizeScale=xc,wo().supermap.Util.NormalizeScale=xc,wo().Util.transform=Cc,wo().supermap.Util.transform=Cc,wo().Proj=wo().Proj||{},wo().supermap.Proj=wo().supermap.Proj||{},wo().Proj.CRS=Ku,wo().supermap.Proj.crs=Ku,wo().supermap.Proj.CRS=Zu,wo().Projection={},wo().supermap.Projection=wo().supermap.Projection||{},wo().Projection.NonProjection=fc,wo().supermap.Projection.nonProjection=fc,wo().supermap.Projection.NonProjection=pc,wo().supermap.CRS=wo().supermap.CRS||{},wo().CRS.NonEarthCRS=yc,wo().supermap.CRS.NonEarthCRS=mc,wo().supermap.CRS.nonEarthCRS=yc,wo().CRS.BaiduCRS=ac,wo().supermap.CRS.BaiduCRS=ac,wo().CRS.TianDiTu_WGS84CRS=lc,wo().supermap.CRS.TianDiTu_WGS84CRS=lc,wo().CRS.TianDiTu_MercatorCRS=dc,wo().supermap.CRS.TianDiTu_MercatorCRS=dc,wo().CRS.TianDiTu_Mercator=dc,wo().supermap.CRS.TianDiTu_Mercator=dc,wo().CRS.TianDiTu_WGS84=lc,wo().supermap.CRS.TianDiTu_WGS84=lc,wo().CRS.Baidu=ac,wo().supermap.CRS.Baidu=ac,wo().supermap.CommontypesConversion=nc,wo().supermap.components.clientComputationLayer=function(t){return new ey(t)},wo().supermap.Components.ClientComputationLayer=ey,wo().supermap.components.clientComputation=function(t){return new ty(t)},wo().supermap.Components.ClientComputation=ty,wo().supermap.components.clientComputationViewModel=function(t){return new $m(t)},wo().supermap.Components.ClientComputationViewModel=$m,wo().supermap.components.geoJSONLayerWithName=function(t,e){return new Km(t,e)},wo().supermap.Components.GeoJSONLayerWithName=Km,wo().supermap.components.GeoJsonLayersDataModel=Hm,wo().supermap.Components.GeoJsonLayersDataModel=Hm,wo().supermap.components.dataFlow=function(t){return new Zm(t)},wo().supermap.Components.DataFlow=Zm,wo().supermap.components.dataFlowViewModel=function(t){return new Qm(t)},wo().supermap.Components.DataFlowViewModel=Qm,wo().supermap.components.dataServiceQuery=function(t,e,r){return new oy(t,e,r)},wo().supermap.Components.DataServiceQuery=oy,wo().supermap.components.dataServiceQueryViewModel=ay,wo().supermap.Components.DataServiceQueryViewModel=ny,wo().supermap.components.DistributedAnalysisModel=ry,wo().supermap.Components.DistributedAnalysisModel=ry,wo().supermap.components.distributedAnalysis=function(t){return new sy(t)},wo().supermap.Components.DistributedAnalysis=sy,wo().supermap.components.distributedAnalysisViewModel=function(t){return new iy(t)},wo().supermap.Components.DistributedAnalysisViewModel=iy,wo().supermap.components.openFile=function(t){return new qm(t)},wo().supermap.Components.OpenFile=qm,wo().supermap.components.openFileViewModel=function(t){return new Jm(t)},wo().supermap.Components.OpenFileViewModel=Jm,wo().supermap.components.search=function(t){return new Xm(t)},wo().supermap.Components.Search=Xm,wo().supermap.components.searchViewModel=function(t){return new Ym(t)},wo().supermap.Components.SearchViewModel=Ym,wo().supermap.components.componentsViewBase=function(t){return new Vm(t)},wo().supermap.Components.ComponentsViewBase=Vm,wo().supermap.control.changeTileVersion=function(t){return new rc(t)},wo().supermap.control.ChangeTileVersion=rc,wo().supermap.control.logo=function(t){return new ic(t)},wo().supermap.control.Logo=ic,wo().supermap.baiduTileLayer=Ac,wo().supermap.BaiduTileLayer=Mc,wo().supermap.cloudTileLayer=Ec,wo().supermap.CloudTileLayer=Tc,wo().supermap.imageMapLayer=function(t,e){return new Oc(t,e)},wo().supermap.ImageMapLayer=Oc,wo().supermap.imageTileLayer=function(t,e){return new $c(t,e)},wo().supermap.ImageTileLayer=$c,wo().supermap.tiandituTileLayer=function(t){return new Nc(t)},wo().supermap.TiandituTileLayer=Nc,wo().supermap.tiledMapLayer=Fc,wo().supermap.TiledMapLayer=Ic,wo().supermap.wmtsLayer=Pc,wo().supermap.WMTSLayer=Lc,wo().supermap.webmap=function(t,e){return new Kc(t,e)},wo().supermap.WebMap=Kc,wo().supermap.initMap=function(t,e){const r=(e=e||{}).mapOptions||{},i=e.layerOptions||{},s=new td(ec,t,e);return s.getMapInfo(async(e,n,a)=>{if("processCompleted"===e.type){const{prjCoordSys:a}=e.result;if(!ed(a.type)){const t=rd(a);await async function(t,e){if(!sd(t,!1)){const r=await e.getWKT();r&&Qu.defs(t,r)}}(t,s)}const o=function(t,e){const{bounds:r,center:i,scale:s,visibleScales:n,prjCoordSys:a,dpi:o,coordUnit:l}=t,{maxZoom:h=22}=e,u=zn(n,r,o,l,h),c=id({prjCoordSys:a,bounds:r,dpi:o,visibleScales:n,coordUnit:l},{maxZoom:h}),d=c.resolutions||u;return{crs:c,center:function(t,{center:e,bounds:r}){const i="string"==typeof t?t:t.code;return"number"!=typeof e.x&&"number"!=typeof e.y&&(e={lat:(r.bottom+r.top)/2,lng:(r.left+r.right)/2}),"EPSG:4326"===i?{lat:e.y,lng:e.x}:t.unproject(wo().point(e.x,e.y))}(c,{center:i,bounds:r}),zoom:function({scale:t,dpi:e,coordUnit:r},i){return function(t,e){let r,i=0;for(let s=0;s<e.length;s++)0===s&&(r=Math.abs(t-e[s])),r>Math.abs(t-e[s])&&(r=Math.abs(t-e[s]),i=s);return i}(_c(t,e,r),i)}({scale:s,dpi:o,coordUnit:l},d),maxZoom:(p=u,p.length>0?p.length-1:22)};var p}(e.result,r),l=wo().map("map",{...o,...r}),h=new Ic(t,{...{noWrap:!0},...i});return h.addTo(l),void n({map:l,layer:h})}a()})},wo().supermap.crsFromMapJSON=id,wo().supermap.CartoCSSToLeaflet=jc,wo().supermap.DefaultStyle=Rc,wo().supermap.CartoStyleMap=Bc,wo().supermap.ServerStyleMap=Gc,wo().supermap.CompOpMap=Uc,wo().supermap.circleStyle=function(t){return new vd(t)},wo().supermap.CircleStyle=vd,wo().supermap.cloverStyle=function(t){return new gd(t)},wo().supermap.CloverStyle=gd,wo().supermap.graphic=function(t){return new zc(t)},wo().supermap.Graphic=zc,wo().supermap.imageStyle=function(t){return new bd(t)},wo().supermap.ImageStyle=bd,wo().supermap.themeFeature=function(t,e){return new Vc(t,e)},wo().supermap.ThemeFeature=Vc,wo().supermap.dataFlowLayer=function(t,e){return new cd(t,e)},wo().supermap.DataFlowLayer=cd,wo().supermap.echartsLayer=function(t,e){return new dd(t,e)},wo().supermap.EchartsLayer=dd,wo().supermap.graphicLayer=function(t,e){return new Od(t,e)},wo().supermap.GraphicLayer=Od,wo().supermap.graphThemeLayer=function(t,e,r){return new Ld(t,e,r)},wo().supermap.GraphThemeLayer=Ld,wo().supermap.heatMapFeature=function(t,e){return new ip(t,e)},wo().supermap.HeatMapFeature=ip,wo().supermap.heatMapLayer=function(t,e){return new sp(t,e)},wo().supermap.HeatMapLayer=sp,wo().supermap.labelThemeLayer=function(t,e){return new Yc(t,e)},wo().supermap.LabelThemeLayer=Yc,wo().supermap.mapVLayer=function(t,e,r){return new ld(t,e,r)},wo().supermap.MapVLayer=ld,wo().supermap.rangeThemeLayer=function(t,e){return new Wc(t,e)},wo().supermap.RangeThemeLayer=Wc,wo().supermap.rankSymbolThemeLayer=function(t,e,r){return new Pd(t,e,r)},wo().supermap.RankSymbolThemeLayer=Pd,wo().supermap.tiledVectorLayer=function(t,e){return new $d(t,e)},wo().supermap.TileVectorLayer=$d,wo().supermap.TiledVectorLayer=$d,wo().supermap.turfLayer=function(t){return new rp(t)},wo().supermap.TurfLayer=rp,wo().supermap.FGBLayer=xm,wo().supermap.FGBLayer=function(t,e){return new xm(t,e)},wo().supermap.unicodeMarker=function(t,e){return new Zc(t,e)},wo().supermap.UnicodeMarker=Zc,wo().supermap.uniqueThemeLayer=function(t,e){return new Hc(t,e)},wo().supermap.UniqueThemeLayer=Hc,wo().supermap.VectorTileFormat=Qd,wo().supermap.addressMatchService=function(t,e){return new Cm(t,e)},wo().supermap.AddressMatchService=Cm,wo().supermap.chartService=function(t,e){return new Mm(t,e)},wo().supermap.ChartService=Mm,wo().supermap.dataFlowService=function(t,e){return new nd(t,e)},wo().supermap.DataFlowService=nd,wo().supermap.datasetService=function(t,e){return new Am(t,e)},wo().supermap.DatasetService=Am,wo().supermap.datasourceService=function(t,e){return new Tm(t,e)},wo().supermap.DatasourceService=Tm,wo().supermap.featureService=Qc,wo().supermap.FeatureService=Xc,wo().supermap.fieldService=function(t,e){return new Em(t,e)},wo().supermap.FieldService=Em,wo().supermap.geoprocessingService=function(t,e){return new Lm(t,e)},wo().supermap.GeoprocessingService=Lm,wo().supermap.gridCellInfosService=function(t,e){return new Om(t,e)},wo().supermap.GridCellInfosService=Om,wo().supermap.imageCollectionService=function(t,e){return new zm(t,e)},wo().supermap.ImageCollectionService=zm,wo().supermap.imageService=function(t,e){return new jm(t,e)},wo().supermap.ImageService=jm,wo().supermap.layerInfoService=function(t,e){return new Pm(t,e)},wo().supermap.LayerInfoService=Pm,wo().supermap.mapService=function(t,e){return new ec(t,e)},wo().supermap.MapService=ec,wo().supermap.measureService=function(t,e){return new Nm(t,e)},wo().supermap.MeasureService=Nm,wo().supermap.networkAnalyst3DService=function(t,e){return new Im(t,e)},wo().supermap.NetworkAnalyst3DService=Im,wo().supermap.networkAnalystService=function(t,e){return new Fm(t,e)},wo().supermap.NetworkAnalystService=Fm,wo().supermap.processingService=function(t,e){return new km(t,e)},wo().supermap.ProcessingService=km,wo().supermap.queryService=function(t,e){return new Dm(t,e)},wo().supermap.QueryService=Dm,wo().supermap.ServiceBase=tc,wo().supermap.spatialAnalystService=function(t,e){return new Rm(t,e)},wo().supermap.SpatialAnalystService=Rm,wo().supermap.themeService=function(t,e){return new Bm(t,e)},wo().supermap.ThemeService=Bm,wo().supermap.trafficTransferAnalystService=function(t,e){return new Gm(t,e)},wo().supermap.TrafficTransferAnalystService=Gm,wo().supermap.webPrintingJobService=function(t,e){return new Um(t,e)},wo().supermap.WebPrintingJobService=Um,wo().supermap.KnowledgeGraphService=wm,wo().supermap.GraphMap=class extends wo().Evented{initialize(t,e){if(!t)return;this.graph=null,this.EVENT_TYPES=["loaded"];const r=t.split("/").pop();this.url=t.replace(`/graphmaps/${r}`,""),this.createGraphMap(r,e)}async createGraphMap(t,e){this.knowledgeGraphService=this.createKnowledgeGraphService(this.url,e);const r=await this.knowledgeGraphService.getGraphMapData(t),i=_o.dataFromGraphMap(r.data,r.graphMap);this.graph=new _o(e&&e.config),this.graph.on("beforelayout",()=>{this.fire(this.EVENT_TYPES[0])}),this.graph.setData(i),this.graph.handleNodeStatus(function(t){const{expand:e,collapse:r,hidden:i}=t.dataContent;return{expand:e&&JSON.parse(e),collapse:r&&JSON.parse(r),hidden:i&&JSON.parse(i)}}(r.graphMap))}createKnowledgeGraphService(t,e){return new wm(t,e)}},wo().supermap.CommonUtil=rt})(),(()=>{"use strict"})()})();