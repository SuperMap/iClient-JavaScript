/*!
  *     forked from antvis/L7
  *     Copyright (c) 2018 AntV team
  *     CopyrightÂ© 2000-2024 SuperMap Software Co. Ltdnpm
  *     license: MIT
  *     version: 20240927
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maplibre-gl")):"function"==typeof define&&define.amd?define(["exports","maplibre-gl"],t):t((e=e||self).L7={},e.maplibregl)}(this,(function(e,t){"use strict";function n(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,u,"next",e)}function u(e){i(a,r,o,s,u,"throw",e)}s(void 0)}))}}function a(e,t,n){return t=d(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,m()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t,n){if(m())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&S(i,n.prototype),i}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,w(r.key),r)}}function l(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function f(e,t,n){return(t=w(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=A(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(null,arguments)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}function g(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(m=function(){return!!e})()}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function x(){x=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new P(r||[]);return i(a,"_invoke",{value:w(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",p="executing",d="completed",v={};function g(){}function m(){}function y(){}var _={};c(_,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(I([])));S&&S!==n&&r.call(S,a)&&(_=S);var E=y.prototype=g.prototype=Object.create(_);function A(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function w(t,n,r){var i=f;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===d){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=C(s,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var c=h(t,n,r);if("normal"===c.type){if(i=r.done?d:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=d,r.method="throw",r.arg=c.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=y,i(E,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:m,configurable:!0}),m.displayName=c(y,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},A(T.prototype),c(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new T(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},A(E),c(E,u,"Generator"),c(E,a,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function T(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function M(e){var t="function"==typeof Map?new Map:void 0;return(M=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,d(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),S(n,e)})(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var P,I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function O(e,t){return e(t={exports:{}},t.exports),t.exports
/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */}!function(e){!function(t){var n="object"==typeof I?I:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:r=i(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return R(Object.create(null))}:a?function(){return R({__proto__:null})}:function(){return R({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,f=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(e,t,n){var r=p.get(e);if(b(r)){if(!n)return;r=new h,p.set(e,r)}var i=r.get(t);if(b(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){var r=d(t,n,!1);return!b(r)&&!!r.has(e)}function g(e,t,n){var r=d(t,n,!1);if(!b(r))return r.get(e)}function m(e,t,n,r){d(n,r,!0).set(e,t)}function y(e,t){var n=[],r=d(e,t,!1);if(b(r))return n;for(var o=function(e){var t=k(e,i);if(!w(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=M(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{P(o)}finally{throw e}}a++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function b(e){return void 0===e}function x(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function E(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=k(e,r);if(void 0!==i){var o=i.call(e,n);if(S(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(w(n))if(!S(i=n.call(e)))return i;if(w(r=e.valueOf))if(!S(i=r.call(e)))return i}else{var r;if(w(r=e.valueOf))if(!S(i=r.call(e)))return i;var i,o=e.toString;if(w(o))if(!S(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=E(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function T(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function w(e){return"function"==typeof e}function C(e){return"function"==typeof e}function k(e,t){var n=e[t];if(null!=n){if(!w(n))throw new TypeError;return n}}function M(e){var t=e.next();return!t.done&&t}function P(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function R(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(b(n)){if(!T(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!b(r)&&!x(r)){if(!C(r))throw new TypeError;t=r}}return t}(e,t)}if(!T(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!b(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!b(o)&&!x(o)){if(!S(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!b(r)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return b(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=I(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=I(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),function e(t,n){var r=y(t,n),i=I(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new f,s=[],u=0,c=r;u<c.length;u++){var l=c[u];a.has(l)||(a.add(l),s.push(l))}for(var h=0,p=o;h<p.length;h++){l=p[h];a.has(l)||(a.add(l),s.push(l))}return s}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;b(n)||(n=A(n));var r=d(t,n,!1);if(b(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}))}(r)}()}(P||(P={}));var L=O((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),N=L.EventEmitter,D=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}));R(D);D.NON_CUSTOM_TAG_KEYS,D.POST_CONSTRUCT,D.DESIGN_PARAM_TYPES,D.PARAM_TYPES,D.TAGGED_PROP,D.TAGGED,D.MULTI_INJECT_TAG,D.INJECT_TAG,D.OPTIONAL_TAG,D.UNMANAGED_TAG,D.NAME_TAG,D.NAMED_TAG;var F=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));R(F);F.TargetTypeEnum,F.BindingTypeEnum,F.BindingScopeEnum;var z=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}}));R(z);z.id;var B=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var n=function(){function e(e,t){this.id=z.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=F.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===F.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));R(B);B.Binding;var j=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));R(j);j.STACK_OVERFLOW,j.CIRCULAR_DEPENDENCY_IN_FACTORY,j.POST_CONSTRUCT_ERROR,j.MULTIPLE_POST_CONSTRUCT_METHODS,j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,j.ARGUMENTS_LENGTH_MISMATCH,j.INVALID_DECORATOR_OPERATION,j.INVALID_TO_SELF_VALUE,j.INVALID_FUNCTION_BINDING,j.INVALID_MIDDLEWARE_RETURN,j.NO_MORE_SNAPSHOTS_AVAILABLE,j.INVALID_BINDING_TYPE,j.NOT_IMPLEMENTED,j.CIRCULAR_DEPENDENCY,j.UNDEFINED_INJECT_ANNOTATION,j.MISSING_INJECT_ANNOTATION,j.MISSING_INJECTABLE_ANNOTATION,j.NOT_REGISTERED,j.CANNOT_UNBIND,j.AMBIGUOUS_MATCH,j.KEY_NOT_FOUND,j.NULL_ARGUMENT,j.DUPLICATED_METADATA,j.DUPLICATED_INJECTABLE_DECORATOR;var U=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(D.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(D.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(D.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));R(U);U.MetadataReader;var V=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));R(V);V.BindingCount;var G=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0,t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===j.STACK_OVERFLOW}}));R(G);G.isStackOverflowExeption;var H=O((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0,t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",o=n(e,t);return 0!==o.length&&(i="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(j.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));R(H);H.circularDependencyToException,H.listMetadataForTarget,H.listRegisteredBindingsForServiceIdentifier,H.getServiceIdentifierAsString,H.getFunctionName;var W=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var n=function(){function e(e){this.id=z.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));R(W);W.Context;var Y=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===D.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));R(Y);Y.Metadata;var X=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));R(X);X.Plan;var Z=O((function(e,t){function n(e,t,n,r,i){var o={},a="number"==typeof i,s=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(j.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var u=o[s];if(Array.isArray(u))for(var c=0,l=u;c<l.length;c++){var h=l[c];if(h.key===r.key)throw new Error(j.DUPLICATED_METADATA+" "+h.key.toString())}else u=[];u.push(r),o[s]=u,Reflect.defineMetadata(e,o,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0,t.tagParameter=function(e,t,r,i){n(D.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(D.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));R(Z);Z.tagProperty,Z.tagParameter,Z.decorate;var q=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(j.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new Y.Metadata(D.INJECT_TAG,e);"number"==typeof r?Z.tagParameter(t,n,r,i):Z.tagProperty(t,n,i)}}}));R(q);q.inject,q.LazyServiceIdentifer;var K=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));R(K);K.QueryableString;var Q=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var n=function(){function e(e,t,n,r){this.id=z.id(),this.type=e,this.serviceIdentifier=n,this.name=new K.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new Y.Metadata(D.NAMED_TAG,r):r instanceof Y.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(D.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(D.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(D.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return D.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(D.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===D.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return D.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(D.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=n}));R(Q);Q.Target;var $=O((function(e,t){var n=I&&I.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function r(e,t,r,a){var s=e.getConstructorMetadata(r),u=s.compilerGeneratedMetadata;if(void 0===u){var c=j.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(c)}var l=s.userGeneratedMetadata,h=Object.keys(l),f=0===r.length&&h.length>0,p=h.length>r.length,d=function(e,t,n,r,o){for(var a=[],s=0;s<o;s++){var u=i(s,e,t,n,r);null!==u&&a.push(u)}return a}(a,t,u,l,f||p?h.length:r.length),v=function e(t,r){for(var i=t.getPropertiesMetadata(r),a=[],s=Object.keys(i),u=0,c=s;u<c.length;u++){var l=c[u],h=i[l],f=o(i[l]),p=f.targetName||l,d=f.inject||f.multiInject,v=new Q.Target(F.TargetTypeEnum.ClassProperty,p,d);v.metadata=h,a.push(v)}var g=Object.getPrototypeOf(r.prototype).constructor;if(g!==Object){var m=e(t,g);a=n(n([],a),m)}return a}(e,r);return n(n([],d),v)}function i(e,t,n,r,i){var a=i[e.toString()]||[],s=o(a),u=!0!==s.unmanaged,c=r[e],l=s.inject||s.multiInject;if((c=l||c)instanceof q.LazyServiceIdentifer&&(c=c.unwrap()),u){if(!t&&(c===Object||c===Function||void 0===c)){var h=j.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(h)}var f=new Q.Target(F.TargetTypeEnum.ConstructorArgument,s.targetName,c);return f.metadata=a,f}return null}function o(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[D.INJECT_TAG],multiInject:t[D.MULTI_INJECT_TAG],targetName:t[D.NAME_TAG],unmanaged:t[D.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0,Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return H.getFunctionName}}),t.getDependencies=function(e,t){return r(e,H.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var i=Object.getPrototypeOf(n.prototype).constructor;if(i!==Object){var o=r(t,H.getFunctionName(i),i,!0),a=o.map((function(e){return e.metadata.filter((function(e){return e.key===D.UNMANAGED_TAG}))})),s=[].concat.apply([],a).length,u=o.length-s;return u>0?u:e(t,i)}return 0}}));R($);$.getFunctionName,$.getBaseClassDependencyCount,$.getDependencies;var J=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var n=function(){function e(e,t,n,r,i){this.id=z.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));R(J);J.Request;var ee=O((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,o){var a=e?D.MULTI_INJECT_TAG:D.INJECT_TAG,s=new Y.Metadata(a,n),u=new Q.Target(t,r,n,s);if(void 0!==i){var c=new Y.Metadata(i,o);u.metadata.push(c)}return u}function i(e,t,n,r,i){var a=o(n.container,i.serviceIdentifier),s=[];return a.length===V.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=o(n.container,i.serviceIdentifier)),s=t?a:a.filter((function(e){var t=new J.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case V.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=H.getServiceIdentifierAsString(e),a=j.NOT_REGISTERED;throw a+=H.listMetadataForTarget(i,n),a+=H.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a);case V.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case V.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=H.getServiceIdentifierAsString(e),a=j.AMBIGUOUS_MATCH+" "+i;throw a+=H.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a)}}(i.serviceIdentifier,s,i,n.container),s}function o(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=o(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0,t.getBindingDictionary=n,t.plan=function(e,t,n,o,a,s,u,c){void 0===c&&(c=!1);var l=new W.Context(t),h=r(n,o,a,"",s,u);try{return function e(t,n,r,o,a,s){var u,c;if(null===a){u=i(t,n,o,null,s),c=new J.Request(r,o,null,u,s);var l=new X.Plan(o,c);o.addPlan(l)}else u=i(t,n,o,a,s),c=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=c.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=c}if(n.type===F.BindingTypeEnum.Instance&&null!==n.implementationType){var i=$.getDependencies(t,n.implementationType);if(!o.container.options.skipBaseClassChecks){var a=$.getBaseClassDependencyCount(t,n.implementationType);if(i.length<a){var u=j.ARGUMENTS_LENGTH_MISMATCH($.getFunctionName(n.implementationType));throw new Error(u)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,o,r,n)}))}}))}(e,c,a,l,null,h),l}catch(e){throw G.isStackOverflowExeption(e)&&l.plan&&H.circularDependencyToException(l.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new Q.Target(F.TargetTypeEnum.Variable,"",t,new Y.Metadata(n,r)),o=new W.Context(e);return new J.Request(t,o,null,[],i)}}));R(ee);ee.getBindingDictionary,ee.createMockRequest,ee.plan;var te=O((function(e,t){var n=I&&I.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0,t.resolveInstance=function(e,t,r){var i,o,a=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===F.TargetTypeEnum.ConstructorArgument})).map(r);o=s,a=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===F.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(a=new((i=e).bind.apply(i,n([void 0],o))),t,r)}else a=new e;return function(e,t){if(Reflect.hasMetadata(D.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(D.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(j.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,a),a}}));R(te);te.resolveInstance;var ne=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var n=function(e,t,n){try{return n()}catch(n){throw G.isStackOverflowExeption(n)?new Error(j.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,o=t.childRequests,a=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(a&&s)return o.map((function(t){return r(e)(t)}));var u=null;if(!t.target.isOptional()||0!==i.length){var c=i[0],l=c.scope===F.BindingScopeEnum.Singleton,h=c.scope===F.BindingScopeEnum.Request;if(l&&c.activated)return c.cache;if(h&&null!==e&&e.has(c.id))return e.get(c.id);if(c.type===F.BindingTypeEnum.ConstantValue)u=c.cache,c.activated=!0;else if(c.type===F.BindingTypeEnum.Function)u=c.cache,c.activated=!0;else if(c.type===F.BindingTypeEnum.Constructor)u=c.implementationType;else if(c.type===F.BindingTypeEnum.DynamicValue&&null!==c.dynamicValue)u=n("toDynamicValue",c.serviceIdentifier,(function(){return c.dynamicValue(t.parentContext)}));else if(c.type===F.BindingTypeEnum.Factory&&null!==c.factory)u=n("toFactory",c.serviceIdentifier,(function(){return c.factory(t.parentContext)}));else if(c.type===F.BindingTypeEnum.Provider&&null!==c.provider)u=n("toProvider",c.serviceIdentifier,(function(){return c.provider(t.parentContext)}));else{if(c.type!==F.BindingTypeEnum.Instance||null===c.implementationType){var f=H.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(j.INVALID_BINDING_TYPE+" "+f)}u=te.resolveInstance(c.implementationType,o,r(e))}return"function"==typeof c.onActivation&&(u=c.onActivation(t.parentContext,u)),l&&(c.cache=u,c.activated=!0),h&&null!==e&&!e.has(c.id)&&e.set(c.id,u),u}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));R(ne);ne.resolve;var re=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new Y.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(D.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));R(re);re.typeConstraint,re.namedConstraint,re.taggedConstraint,re.traverseAncerstors;var ie=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new oe.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=re.namedConstraint(e),new oe.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new oe.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=re.taggedConstraint(e)(t),new oe.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return re.typeConstraint(e)(t.parentRequest)},new oe.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return re.namedConstraint(e)(t.parentRequest)},new oe.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return re.taggedConstraint(e)(t)(n.parentRequest)},new oe.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return re.traverseAncerstors(t,re.typeConstraint(e))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!re.traverseAncerstors(t,re.typeConstraint(e))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return re.traverseAncerstors(t,re.namedConstraint(e))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!re.traverseAncerstors(t,re.namedConstraint(e))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return re.traverseAncerstors(n,re.taggedConstraint(e)(t))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!re.traverseAncerstors(n,re.taggedConstraint(e)(t))},new oe.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return re.traverseAncerstors(t,e)},new oe.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!re.traverseAncerstors(t,e)},new oe.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));R(ie);ie.BindingWhenSyntax;var oe=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new ie.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));R(oe);oe.BindingOnSyntax;var ae=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new ie.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new oe.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));R(ae);ae.BindingWhenOnSyntax;var se=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=F.BindingScopeEnum.Request,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=F.BindingScopeEnum.Transient,new ae.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));R(se);se.BindingInSyntax;var ue=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new ie.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new oe.BindingOnSyntax(this._binding),this._bindingInSyntax=new se.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));R(ue);ue.BindingInWhenOnSyntax;var ce=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=F.BindingTypeEnum.Instance,this._binding.implementationType=e,new ue.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+j.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=F.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=F.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new ue.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=F.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=F.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(j.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=F.BindingTypeEnum.Function,this._binding.scope=F.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=F.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=F.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=F.BindingScopeEnum.Singleton,new ae.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));R(ce);ce.BindingToSyntax;var le=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));R(le);le.ContainerSnapshot;var he=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(j.NULL_ARGUMENT);if(null==t)throw new Error(j.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(j.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(j.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(j.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(j.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(j.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));R(he);he.Lookup;var fe=O((function(e,t){var n=I&&I.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},r=I&&I.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=I&&I.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var o=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=F.BindingScopeEnum.Transient;else if(t.defaultScope!==F.BindingScopeEnum.Singleton&&t.defaultScope!==F.BindingScopeEnum.Transient&&t.defaultScope!==F.BindingScopeEnum.Request)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=z.id(),this._bindingDictionary=new he.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new U.MetadataReader}return e.merge=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var a=new e,s=i([t,n],r).map((function(e){return ee.getBindingDictionary(e)})),u=ee.getBindingDictionary(a);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,i,o,a;return r(this,(function(r){switch(r.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,i=e,r.label=1;case 1:return n<i.length?(o=i[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||F.BindingScopeEnum.Transient,n=new B.Binding(e,t);return this._bindingDictionary.add(e,n),new ce.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(j.CANNOT_UNBIND+" "+H.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new he.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,D.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=ee.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(le.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(j.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,F.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,F.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,D.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,F.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,F.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,D.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(j.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=ee.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),ne.resolve(n)}},e}();t.Container=o}));R(fe);fe.Container;var pe=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var n=function(e){this.id=z.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=z.id(),this.registry=e};t.AsyncContainerModule=r}));R(pe);pe.AsyncContainerModule,pe.ContainerModule;var de=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0,t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(D.PARAM_TYPES,e))throw new Error(j.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(D.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(D.PARAM_TYPES,t,e),e}}}));R(de);de.injectable;var ve=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0,t.tagged=function(e,t){return function(n,r,i){var o=new Y.Metadata(e,t);"number"==typeof i?Z.tagParameter(n,r,i,o):Z.tagProperty(n,r,o)}}}));R(ve);ve.tagged;var ge=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0,t.named=function(e){return function(t,n,r){var i=new Y.Metadata(D.NAMED_TAG,e);"number"==typeof r?Z.tagParameter(t,n,r,i):Z.tagProperty(t,n,i)}}}));R(ge);ge.named;var me=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0,t.optional=function(){return function(e,t,n){var r=new Y.Metadata(D.OPTIONAL_TAG,!0);"number"==typeof n?Z.tagParameter(e,t,n,r):Z.tagProperty(e,t,r)}}}));R(me);me.optional;var ye=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0,t.unmanaged=function(){return function(e,t,n){var r=new Y.Metadata(D.UNMANAGED_TAG,!0);Z.tagParameter(e,t,n,r)}}}));R(ye);ye.unmanaged;var _e=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0,t.multiInject=function(e){return function(t,n,r){var i=new Y.Metadata(D.MULTI_INJECT_TAG,e);"number"==typeof r?Z.tagParameter(t,n,r,i):Z.tagProperty(t,n,i)}}}));R(_e);_e.multiInject;var be=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0,t.targetName=function(e){return function(t,n,r){var i=new Y.Metadata(D.NAME_TAG,e);Z.tagParameter(t,n,r,i)}}}));R(be);be.targetName;var xe=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0,t.postConstruct=function(){return function(e,t,n){var r=new Y.Metadata(D.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(D.POST_CONSTRUCT,e.constructor))throw new Error(j.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(D.POST_CONSTRUCT,r,e.constructor)}}}));R(xe);xe.postConstruct;var Se=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));R(Se);Se.multiBindToService;var Ee=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0,t.METADATA_KEY=D,Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return fe.Container}}),Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return F.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return F.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return F.TargetTypeEnum}}),Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return pe.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return pe.ContainerModule}}),Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return de.injectable}}),Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return ve.tagged}}),Object.defineProperty(t,"named",{enumerable:!0,get:function(){return ge.named}}),Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return q.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return q.LazyServiceIdentifer}}),Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return me.optional}}),Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return ye.unmanaged}}),Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return _e.multiInject}}),Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return be.targetName}}),Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return xe.postConstruct}}),Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return U.MetadataReader}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return z.id}}),Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return Z.decorate}}),Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return re.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return re.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return re.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return re.typeConstraint}}),Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return H.getServiceIdentifierAsString}}),Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return Se.multiBindToService}})}));R(Ee);Ee.multiBindToService,Ee.getServiceIdentifierAsString,Ee.typeConstraint,Ee.namedConstraint,Ee.taggedConstraint,Ee.traverseAncerstors;var Ae=Ee.decorate,Te=(Ee.id,Ee.MetadataReader,Ee.postConstruct),we=(Ee.targetName,Ee.multiInject,Ee.unmanaged,Ee.optional,Ee.LazyServiceIdentifer,Ee.inject),Ce=(Ee.named,Ee.tagged,Ee.injectable),ke=(Ee.ContainerModule,Ee.AsyncContainerModule,Ee.TargetTypeEnum,Ee.BindingTypeEnum,Ee.BindingScopeEnum,Ee.Container),Me=(Ee.METADATA_KEY,O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}})));R(Me);Me.makePropertyInjectDecorator,Me.makePropertyInjectNamedDecorator,Me.makePropertyInjectTaggedDecorator,Me.makePropertyMultiInjectDecorator;var Pe,Ie,Re=R(O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:Me.makePropertyInjectDecorator(e,t),lazyInjectNamed:Me.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:Me.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:Me.makePropertyMultiInjectDecorator(e,t)}}}))),Oe={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Le=function(e){return e&&e.Math===Math&&e},Ne=Le("object"==typeof globalThis&&globalThis)||Le("object"==typeof window&&window)||Le("object"==typeof self&&self)||Le("object"==typeof I&&I)||Le("object"==typeof I&&I)||function(){return this}()||Function("return this")(),De=function(e){try{return!!e()}catch(e){return!0}},Fe=!De((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),ze=!De((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Be=Function.prototype.call,je=ze?Be.bind(Be):function(){return Be.apply(Be,arguments)},Ue={}.propertyIsEnumerable,Ve=Object.getOwnPropertyDescriptor,Ge={f:Ve&&!Ue.call({1:2},1)?function(e){var t=Ve(this,e);return!!t&&t.enumerable}:Ue},He=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},We=Function.prototype,Ye=We.call,Xe=ze&&We.bind.bind(Ye,Ye),Ze=ze?Xe:function(e){return function(){return Ye.apply(e,arguments)}},qe=Ze({}.toString),Ke=Ze("".slice),Qe=function(e){return Ke(qe(e),8,-1)},$e=Object,Je=Ze("".split),et=De((function(){return!$e("z").propertyIsEnumerable(0)}))?function(e){return"String"===Qe(e)?Je(e,""):$e(e)}:$e,tt=function(e){return null==e},nt=TypeError,rt=function(e){if(tt(e))throw new nt("Can't call method on "+e);return e},it=function(e){return et(rt(e))},ot="object"==typeof document&&document.all,at=void 0===ot&&void 0!==ot?function(e){return"function"==typeof e||e===ot}:function(e){return"function"==typeof e},st=function(e){return"object"==typeof e?null!==e:at(e)},ut=function(e){return at(e)?e:void 0},ct=function(e,t){return arguments.length<2?ut(Ne[e]):Ne[e]&&Ne[e][t]},lt=Ze({}.isPrototypeOf),ht="undefined"!=typeof navigator&&String(navigator.userAgent)||"",ft=Ne.process,pt=Ne.Deno,dt=ft&&ft.versions||pt&&pt.version,vt=dt&&dt.v8;vt&&(Ie=(Pe=vt.split("."))[0]>0&&Pe[0]<4?1:+(Pe[0]+Pe[1])),!Ie&&ht&&(!(Pe=ht.match(/Edge\/(\d+)/))||Pe[1]>=74)&&(Pe=ht.match(/Chrome\/(\d+)/))&&(Ie=+Pe[1]);var gt=Ie,mt=Ne.String,yt=!!Object.getOwnPropertySymbols&&!De((function(){var e=Symbol("symbol detection");return!mt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&gt&&gt<41})),_t=yt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,bt=Object,xt=_t?function(e){return"symbol"==typeof e}:function(e){var t=ct("Symbol");return at(t)&&lt(t.prototype,bt(e))},St=String,Et=function(e){try{return St(e)}catch(e){return"Object"}},At=TypeError,Tt=function(e){if(at(e))return e;throw new At(Et(e)+" is not a function")},wt=function(e,t){var n=e[t];return tt(n)?void 0:Tt(n)},Ct=TypeError,kt=Object.defineProperty,Mt=function(e,t){try{kt(Ne,e,{value:t,configurable:!0,writable:!0})}catch(n){Ne[e]=t}return t},Pt=O((function(e){var t=e.exports=Ne["__core-js_shared__"]||Mt("__core-js_shared__",{});(t.versions||(t.versions=[])).push({version:"3.37.1",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),It=function(e,t){return Pt[e]||(Pt[e]=t||{})},Rt=Object,Ot=function(e){return Rt(rt(e))},Lt=Ze({}.hasOwnProperty),Nt=Object.hasOwn||function(e,t){return Lt(Ot(e),t)},Dt=0,Ft=Math.random(),zt=Ze(1..toString),Bt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+zt(++Dt+Ft,36)},jt=Ne.Symbol,Ut=It("wks"),Vt=_t?jt.for||jt:jt&&jt.withoutSetter||Bt,Gt=function(e){return Nt(Ut,e)||(Ut[e]=yt&&Nt(jt,e)?jt[e]:Vt("Symbol."+e)),Ut[e]},Ht=TypeError,Wt=Gt("toPrimitive"),Yt=function(e,t){if(!st(e)||xt(e))return e;var n,r=wt(e,Wt);if(r){if(void 0===t&&(t="default"),n=je(r,e,t),!st(n)||xt(n))return n;throw new Ht("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&at(n=e.toString)&&!st(r=je(n,e)))return r;if(at(n=e.valueOf)&&!st(r=je(n,e)))return r;if("string"!==t&&at(n=e.toString)&&!st(r=je(n,e)))return r;throw new Ct("Can't convert object to primitive value")}(e,t)},Xt=function(e){var t=Yt(e,"string");return xt(t)?t:t+""},Zt=Ne.document,qt=st(Zt)&&st(Zt.createElement),Kt=function(e){return qt?Zt.createElement(e):{}},Qt=!Fe&&!De((function(){return 7!==Object.defineProperty(Kt("div"),"a",{get:function(){return 7}}).a})),$t=Object.getOwnPropertyDescriptor,Jt={f:Fe?$t:function(e,t){if(e=it(e),t=Xt(t),Qt)try{return $t(e,t)}catch(e){}if(Nt(e,t))return He(!je(Ge.f,e,t),e[t])}},en=Fe&&De((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),tn=String,nn=TypeError,rn=function(e){if(st(e))return e;throw new nn(tn(e)+" is not an object")},on=TypeError,an=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,un={f:Fe?en?function(e,t,n){if(rn(e),t=Xt(t),rn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=sn(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return an(e,t,n)}:an:function(e,t,n){if(rn(e),t=Xt(t),rn(n),Qt)try{return an(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new on("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},cn=Fe?function(e,t,n){return un.f(e,t,He(1,n))}:function(e,t,n){return e[t]=n,e},ln=Function.prototype,hn=Fe&&Object.getOwnPropertyDescriptor,fn=Nt(ln,"name"),pn={EXISTS:fn,PROPER:fn&&"something"===function(){}.name,CONFIGURABLE:fn&&(!Fe||Fe&&hn(ln,"name").configurable)},dn=Ze(Function.toString);at(Pt.inspectSource)||(Pt.inspectSource=function(e){return dn(e)});var vn,gn,mn,yn=Pt.inspectSource,_n=Ne.WeakMap,bn=at(_n)&&/native code/.test(String(_n)),xn=It("keys"),Sn=function(e){return xn[e]||(xn[e]=Bt(e))},En={},An=Ne.TypeError,Tn=Ne.WeakMap;if(bn||Pt.state){var wn=Pt.state||(Pt.state=new Tn);wn.get=wn.get,wn.has=wn.has,wn.set=wn.set,vn=function(e,t){if(wn.has(e))throw new An("Object already initialized");return t.facade=e,wn.set(e,t),t},gn=function(e){return wn.get(e)||{}},mn=function(e){return wn.has(e)}}else{var Cn=Sn("state");En[Cn]=!0,vn=function(e,t){if(Nt(e,Cn))throw new An("Object already initialized");return t.facade=e,cn(e,Cn,t),t},gn=function(e){return Nt(e,Cn)?e[Cn]:{}},mn=function(e){return Nt(e,Cn)}}var kn={set:vn,get:gn,has:mn,enforce:function(e){return mn(e)?gn(e):vn(e,{})},getterFor:function(e){return function(t){var n;if(!st(t)||(n=gn(t)).type!==e)throw new An("Incompatible receiver, "+e+" required");return n}}},Mn=O((function(e){var t=pn.CONFIGURABLE,n=kn.enforce,r=kn.get,i=String,o=Object.defineProperty,a=Ze("".slice),s=Ze("".replace),u=Ze([].join),c=Fe&&!De((function(){return 8!==o((function(){}),"length",{value:8}).length})),l=String(String).split("String"),h=e.exports=function(e,r,h){"Symbol("===a(i(r),0,7)&&(r="["+s(i(r),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),h&&h.getter&&(r="get "+r),h&&h.setter&&(r="set "+r),(!Nt(e,"name")||t&&e.name!==r)&&(Fe?o(e,"name",{value:r,configurable:!0}):e.name=r),c&&h&&Nt(h,"arity")&&e.length!==h.arity&&o(e,"length",{value:h.arity});try{h&&Nt(h,"constructor")&&h.constructor?Fe&&o(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var f=n(e);return Nt(f,"source")||(f.source=u(l,"string"==typeof r?r:"")),e};Function.prototype.toString=h((function(){return at(this)&&r(this).source||yn(this)}),"toString")})),Pn=function(e,t,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:t;if(at(n)&&Mn(n,o,r),r.global)i?e[t]=n:Mt(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:un.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},In=Math.ceil,Rn=Math.floor,On=Math.trunc||function(e){var t=+e;return(t>0?Rn:In)(t)},Ln=function(e){var t=+e;return t!=t||0===t?0:On(t)},Nn=Math.max,Dn=Math.min,Fn=function(e,t){var n=Ln(e);return n<0?Nn(n+t,0):Dn(n,t)},zn=Math.min,Bn=function(e){var t=Ln(e);return t>0?zn(t,9007199254740991):0},jn=function(e){return Bn(e.length)},Un=function(e){return function(t,n,r){var i=it(t),o=jn(i);if(0===o)return!e&&-1;var a,s=Fn(r,o);if(e&&n!=n){for(;o>s;)if((a=i[s++])!=a)return!0}else for(;o>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},Vn={includes:Un(!0),indexOf:Un(!1)},Gn=Vn.indexOf,Hn=Ze([].push),Wn=function(e,t){var n,r=it(e),i=0,o=[];for(n in r)!Nt(En,n)&&Nt(r,n)&&Hn(o,n);for(;t.length>i;)Nt(r,n=t[i++])&&(~Gn(o,n)||Hn(o,n));return o},Yn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xn=Yn.concat("length","prototype"),Zn={f:Object.getOwnPropertyNames||function(e){return Wn(e,Xn)}},qn={f:Object.getOwnPropertySymbols},Kn=Ze([].concat),Qn=ct("Reflect","ownKeys")||function(e){var t=Zn.f(rn(e)),n=qn.f;return n?Kn(t,n(e)):t},$n=function(e,t,n){for(var r=Qn(t),i=un.f,o=Jt.f,a=0;a<r.length;a++){var s=r[a];Nt(e,s)||n&&Nt(n,s)||i(e,s,o(t,s))}},Jn=/#|\.prototype\./,er=function(e,t){var n=nr[tr(e)];return n===ir||n!==rr&&(at(t)?De(t):!!t)},tr=er.normalize=function(e){return String(e).replace(Jn,".").toLowerCase()},nr=er.data={},rr=er.NATIVE="N",ir=er.POLYFILL="P",or=er,ar=Jt.f,sr=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,c=e.stat;if(n=u?Ne:c?Ne[s]||Mt(s,{}):Ne[s]&&Ne[s].prototype)for(r in t){if(o=t[r],i=e.dontCallGetSet?(a=ar(n,r))&&a.value:n[r],!or(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;$n(o,i)}(e.sham||i&&i.sham)&&cn(o,"sham",!0),Pn(n,r,o,e)}},ur=Array.isArray||function(e){return"Array"===Qe(e)},cr=TypeError,lr=function(e){if(e>9007199254740991)throw cr("Maximum allowed index exceeded");return e},hr=function(e,t,n){Fe?un.f(e,t,He(0,n)):e[t]=n},fr={};fr[Gt("toStringTag")]="z";var pr="[object z]"===String(fr),dr=Gt("toStringTag"),vr=Object,gr="Arguments"===Qe(function(){return arguments}()),mr=pr?Qe:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=vr(e),dr))?n:gr?Qe(t):"Object"===(r=Qe(t))&&at(t.callee)?"Arguments":r},yr=function(){},_r=ct("Reflect","construct"),br=/^\s*(?:class|function)\b/,xr=Ze(br.exec),Sr=!br.test(yr),Er=function(e){if(!at(e))return!1;try{return _r(yr,[],e),!0}catch(e){return!1}},Ar=function(e){if(!at(e))return!1;switch(mr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Sr||!!xr(br,yn(e))}catch(e){return!0}};Ar.sham=!0;var Tr=!_r||De((function(){var e;return Er(Er.call)||!Er(Object)||!Er((function(){e=!0}))||e}))?Ar:Er,wr=Gt("species"),Cr=Array,kr=function(e,t){return new(function(e){var t;return ur(e)&&(t=e.constructor,(Tr(t)&&(t===Cr||ur(t.prototype))||st(t)&&null===(t=t[wr]))&&(t=void 0)),void 0===t?Cr:t}(e))(0===t?0:t)},Mr=Gt("species"),Pr=function(e){return gt>=51||!De((function(){var t=[];return(t.constructor={})[Mr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Ir=Gt("isConcatSpreadable"),Rr=gt>=51||!De((function(){var e=[];return e[Ir]=!1,e.concat()[0]!==e})),Or=function(e){if(!st(e))return!1;var t=e[Ir];return void 0!==t?!!t:ur(e)},Lr=!Rr||!Pr("concat");sr({target:"Array",proto:!0,arity:1,forced:Lr},{concat:function(e){var t,n,r,i,o,a=Ot(this),s=kr(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Or(o=-1===t?a:arguments[t]))for(i=jn(o),lr(u+i),n=0;n<i;n++,u++)n in o&&hr(s,u,o[n]);else lr(u+1),hr(s,u++,o);return s.length=u,s}});var Nr,Dr=Object.keys||function(e){return Wn(e,Yn)},Fr={f:Fe&&!en?Object.defineProperties:function(e,t){rn(e);for(var n,r=it(t),i=Dr(t),o=i.length,a=0;o>a;)un.f(e,n=i[a++],r[n]);return e}},zr=ct("document","documentElement"),Br=Sn("IE_PROTO"),jr=function(){},Ur=function(e){return"<script>"+e+"<\/script>"},Vr=function(e){e.write(Ur("")),e.close();var t=e.parentWindow.Object;return e=null,t},Gr=function(){try{Nr=new ActiveXObject("htmlfile")}catch(e){}var e,t;Gr="undefined"!=typeof document?document.domain&&Nr?Vr(Nr):((t=Kt("iframe")).style.display="none",zr.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ur("document.F=Object")),e.close(),e.F):Vr(Nr);for(var n=Yn.length;n--;)delete Gr.prototype[Yn[n]];return Gr()};En[Br]=!0;var Hr=Object.create||function(e,t){var n;return null!==e?(jr.prototype=rn(e),n=new jr,jr.prototype=null,n[Br]=e):n=Gr(),void 0===t?n:Fr.f(n,t)},Wr=un.f,Yr=Gt("unscopables"),Xr=Array.prototype;void 0===Xr[Yr]&&Wr(Xr,Yr,{configurable:!0,value:Hr(null)});var Zr,qr,Kr,Qr=function(e){Xr[Yr][e]=!0},$r={},Jr=!De((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),ei=Sn("IE_PROTO"),ti=Object,ni=ti.prototype,ri=Jr?ti.getPrototypeOf:function(e){var t=Ot(e);if(Nt(t,ei))return t[ei];var n=t.constructor;return at(n)&&t instanceof n?n.prototype:t instanceof ti?ni:null},ii=Gt("iterator"),oi=!1;[].keys&&("next"in(Kr=[].keys())?(qr=ri(ri(Kr)))!==Object.prototype&&(Zr=qr):oi=!0),(!st(Zr)||De((function(){var e={};return Zr[ii].call(e)!==e})))&&(Zr={}),at(Zr[ii])||Pn(Zr,ii,(function(){return this}));var ai={IteratorPrototype:Zr,BUGGY_SAFARI_ITERATORS:oi},si=un.f,ui=Gt("toStringTag"),ci=function(e,t,n){e&&!n&&(e=e.prototype),e&&!Nt(e,ui)&&si(e,ui,{configurable:!0,value:t})},li=ai.IteratorPrototype,hi=function(){return this},fi=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Hr(li,{next:He(+!r,n)}),ci(e,i,!1),$r[i]=hi,e},pi=String,di=TypeError,vi=function(e){if(function(e){return st(e)||null===e}(e))return e;throw new di("Can't set "+pi(e)+" as a prototype")},gi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return Ze(Tt(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return rt(n),vi(r),st(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),mi=pn.PROPER,yi=pn.CONFIGURABLE,_i=ai.IteratorPrototype,bi=ai.BUGGY_SAFARI_ITERATORS,xi=Gt("iterator"),Si=function(){return this},Ei=function(e,t,n,r,i,o,a){fi(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!bi&&e&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},h=t+" Iterator",f=!1,p=e.prototype,d=p[xi]||p["@@iterator"]||i&&p[i],v=!bi&&d||l(i),g="Array"===t&&p.entries||d;if(g&&(s=ri(g.call(new e)))!==Object.prototype&&s.next&&(ri(s)!==_i&&(gi?gi(s,_i):at(s[xi])||Pn(s,xi,Si)),ci(s,h,!0)),mi&&"values"===i&&d&&"values"!==d.name&&(yi?cn(p,"name","values"):(f=!0,v=function(){return je(d,this)})),i)if(u={values:l("values"),keys:o?v:l("keys"),entries:l("entries")},a)for(c in u)(bi||f||!(c in p))&&Pn(p,c,u[c]);else sr({target:t,proto:!0,forced:bi||f},u);return p[xi]!==v&&Pn(p,xi,v,{name:i}),$r[t]=v,u},Ai=function(e,t){return{value:e,done:t}},Ti=un.f,wi=kn.set,Ci=kn.getterFor("Array Iterator"),ki=Ei(Array,"Array",(function(e,t){wi(this,{type:"Array Iterator",target:it(e),index:0,kind:t})}),(function(){var e=Ci(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,Ai(void 0,!0);switch(e.kind){case"keys":return Ai(n,!1);case"values":return Ai(t[n],!1)}return Ai([n,t[n]],!1)}),"values"),Mi=$r.Arguments=$r.Array;if(Qr("keys"),Qr("values"),Qr("entries"),Fe&&"values"!==Mi.name)try{Ti(Mi,"name",{value:"values"})}catch(e){}var Pi=function(e,t,n){return n.get&&Mn(n.get,t,{getter:!0}),n.set&&Mn(n.set,t,{setter:!0}),un.f(e,t,n)},Ii=pn.EXISTS,Ri=Function.prototype,Oi=Ze(Ri.toString),Li=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Ni=Ze(Li.exec);Fe&&!Ii&&Pi(Ri,"name",{configurable:!0,get:function(){try{return Ni(Li,Oi(this))[1]}catch(e){return""}}});var Di=Ze([].slice),Fi=Zn.f,zi="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Bi={f:function(e){return zi&&"Window"===Qe(e)?function(e){try{return Fi(e)}catch(e){return Di(zi)}}(e):Fi(it(e))}},ji=De((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Ui=Object.isExtensible,Vi=De((function(){Ui(1)}))||ji?function(e){return!!st(e)&&((!ji||"ArrayBuffer"!==Qe(e))&&(!Ui||Ui(e)))}:Ui,Gi=!De((function(){return Object.isExtensible(Object.preventExtensions({}))})),Hi=O((function(e){var t=un.f,n=!1,r=Bt("meta"),i=0,o=function(e){t(e,r,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},n=!0;var e=Zn.f,t=Ze([].splice),i={};i[r]=1,e(i).length&&(Zn.f=function(n){for(var i=e(n),o=0,a=i.length;o<a;o++)if(i[o]===r){t(i,o,1);break}return i},sr({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Bi.f}))},fastKey:function(e,t){if(!st(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Nt(e,r)){if(!Vi(e))return"F";if(!t)return"E";o(e)}return e[r].objectID},getWeakData:function(e,t){if(!Nt(e,r)){if(!Vi(e))return!0;if(!t)return!1;o(e)}return e[r].weakData},onFreeze:function(e){return Gi&&n&&Vi(e)&&!Nt(e,r)&&o(e),e}};En[r]=!0})),Wi=(Hi.enable,Hi.fastKey,Hi.getWeakData,Hi.onFreeze,function(e){if("Function"===Qe(e))return Ze(e)}),Yi=Wi(Wi.bind),Xi=function(e,t){return Tt(e),void 0===t?e:ze?Yi(e,t):function(){return e.apply(t,arguments)}},Zi=Gt("iterator"),qi=Array.prototype,Ki=function(e){return void 0!==e&&($r.Array===e||qi[Zi]===e)},Qi=Gt("iterator"),$i=function(e){if(!tt(e))return wt(e,Qi)||wt(e,"@@iterator")||$r[mr(e)]},Ji=TypeError,eo=function(e,t){var n=arguments.length<2?$i(e):t;if(Tt(n))return rn(je(n,e));throw new Ji(Et(e)+" is not iterable")},to=function(e,t,n){var r,i;rn(e);try{if(!(r=wt(e,"return"))){if("throw"===t)throw n;return n}r=je(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return rn(r),n},no=TypeError,ro=function(e,t){this.stopped=e,this.result=t},io=ro.prototype,oo=function(e,t,n){var r,i,o,a,s,u,c,l=n&&n.that,h=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),v=Xi(t,l),g=function(e){return r&&to(r,"normal",e),new ro(!0,e)},m=function(e){return h?(rn(e),d?v(e[0],e[1],g):v(e[0],e[1])):d?v(e,g):v(e)};if(f)r=e.iterator;else if(p)r=e;else{if(!(i=$i(e)))throw new no(Et(e)+" is not iterable");if(Ki(i)){for(o=0,a=jn(e);a>o;o++)if((s=m(e[o]))&&lt(io,s))return s;return new ro(!1)}r=eo(e,i)}for(u=f?e.next:r.next;!(c=je(u,r)).done;){try{s=m(c.value)}catch(e){to(r,"throw",e)}if("object"==typeof s&&s&&lt(io,s))return s}return new ro(!1)},ao=TypeError,so=function(e,t){if(lt(t,e))return e;throw new ao("Incorrect invocation")},uo=Gt("iterator"),co=!1;try{var lo=0,ho={next:function(){return{done:!!lo++}},return:function(){co=!0}};ho[uo]=function(){return this},Array.from(ho,(function(){throw 2}))}catch(e){}var fo=function(e,t){try{if(!t&&!co)return!1}catch(e){return!1}var n=!1;try{var r={};r[uo]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},po=function(e,t,n){var r,i;return gi&&at(r=t.constructor)&&r!==n&&st(i=r.prototype)&&i!==n.prototype&&gi(e,i),e},vo=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=Ne[e],s=a&&a.prototype,u=a,c={},l=function(e){var t=Ze(s[e]);Pn(s,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(i&&!st(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return i&&!st(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(i&&!st(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(or(e,!at(a)||!(i||s.forEach&&!De((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),Hi.enable();else if(or(e,!0)){var h=new u,f=h[o](i?{}:-0,1)!==h,p=De((function(){h.has(1)})),d=fo((function(e){new a(e)})),v=!i&&De((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));d||((u=t((function(e,t){so(e,s);var n=po(new a,e,u);return tt(t)||oo(t,n[o],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=u),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||f)&&l(o),i&&s.clear&&delete s.clear}return c[e]=u,sr({global:!0,constructor:!0,forced:u!==a},c),ci(u,e),i||n.setStrong(u,e,r),u},go=function(e,t,n){for(var r in t)Pn(e,r,t[r],n);return e},mo=Gt("species"),yo=function(e){var t=ct(e);Fe&&t&&!t[mo]&&Pi(t,mo,{configurable:!0,get:function(){return this}})},_o=Hi.fastKey,bo=kn.set,xo=kn.getterFor,So={getConstructor:function(e,t,n,r){var i=e((function(e,i){so(e,o),bo(e,{type:t,index:Hr(null),first:void 0,last:void 0,size:0}),Fe||(e.size=0),tt(i)||oo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=xo(t),s=function(e,t,n){var r,i,o=a(e),s=u(e,t);return s?s.value=n:(o.last=s={index:i=_o(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=s),r&&(r.next=s),Fe?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},u=function(e,t){var n,r=a(e),i=_o(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key===t)return n};return go(o,{clear:function(){for(var e=a(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=void 0),t=t.next;e.first=e.last=void 0,e.index=Hr(null),Fe?e.size=0:this.size=0},delete:function(e){var t=a(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first===n&&(t.first=r),t.last===n&&(t.last=i),Fe?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=a(this),r=Xi(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),go(o,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Fe&&Pi(o,"size",{configurable:!0,get:function(){return a(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=xo(t),o=xo(r);Ei(e,t,(function(e,t){bo(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?Ai("keys"===t?n.key:"values"===t?n.value:[n.key,n.value],!1):(e.target=void 0,Ai(void 0,!0))}),n?"entries":"values",!n,!0),yo(t)}};vo("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),So);var Eo=De((function(){Dr(1)}));sr({target:"Object",stat:!0,forced:Eo},{keys:function(e){return Dr(Ot(e))}});var Ao=pr?{}.toString:function(){return"[object "+mr(this)+"]"};pr||Pn(Object.prototype,"toString",Ao,{unsafe:!0});var To=String,wo=function(e){if("Symbol"===mr(e))throw new TypeError("Cannot convert a Symbol value to a string");return To(e)},Co=function(){var e=rn(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},ko=Ne.RegExp,Mo=De((function(){var e=ko("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),Po=Mo||De((function(){return!ko("a","y").sticky})),Io={BROKEN_CARET:Mo||De((function(){var e=ko("^r","gy");return e.lastIndex=2,null!==e.exec("str")})),MISSED_STICKY:Po,UNSUPPORTED_Y:Mo},Ro=Ne.RegExp,Oo=De((function(){var e=Ro(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})),Lo=Ne.RegExp,No=De((function(){var e=Lo("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Do=kn.get,Fo=It("native-string-replace",String.prototype.replace),zo=RegExp.prototype.exec,Bo=zo,jo=Ze("".charAt),Uo=Ze("".indexOf),Vo=Ze("".replace),Go=Ze("".slice),Ho=function(){var e=/a/,t=/b*/g;return je(zo,e,"a"),je(zo,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Wo=Io.BROKEN_CARET,Yo=void 0!==/()??/.exec("")[1];(Ho||Yo||Wo||Oo||No)&&(Bo=function(e){var t,n,r,i,o,a,s,u=this,c=Do(u),l=wo(e),h=c.raw;if(h)return h.lastIndex=u.lastIndex,t=je(Bo,h,l),u.lastIndex=h.lastIndex,t;var f=c.groups,p=Wo&&u.sticky,d=je(Co,u),v=u.source,g=0,m=l;if(p&&(d=Vo(d,"y",""),-1===Uo(d,"g")&&(d+="g"),m=Go(l,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==jo(l,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,g++),n=new RegExp("^(?:"+v+")",d)),Yo&&(n=new RegExp("^"+v+"$(?!\\s)",d)),Ho&&(r=u.lastIndex),i=je(zo,p?n:u,m),p?i?(i.input=Go(i.input,g),i[0]=Go(i[0],g),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Ho&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),Yo&&i&&i.length>1&&je(Fo,i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&f)for(i.groups=a=Hr(null),o=0;o<f.length;o++)a[(s=f[o])[0]]=i[s[1]];return i});var Xo=Bo;sr({target:"RegExp",proto:!0,forced:/./.exec!==Xo},{exec:Xo}),vo("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),So);var Zo=Ze("".charAt),qo=Ze("".charCodeAt),Ko=Ze("".slice),Qo=function(e){return function(t,n){var r,i,o=wo(rt(t)),a=Ln(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=qo(o,a))<55296||r>56319||a+1===s||(i=qo(o,a+1))<56320||i>57343?e?Zo(o,a):r:e?Ko(o,a,a+2):i-56320+(r-55296<<10)+65536}},$o={codeAt:Qo(!1),charAt:Qo(!0)},Jo=$o.charAt,ea=kn.set,ta=kn.getterFor("String Iterator");Ei(String,"String",(function(e){ea(this,{type:"String Iterator",string:wo(e),index:0})}),(function(){var e,t=ta(this),n=t.string,r=t.index;return r>=n.length?Ai(void 0,!0):(e=Jo(n,r),t.index+=e.length,Ai(e,!1))}));var na=Function.prototype,ra=na.apply,ia=na.call,oa="object"==typeof Reflect&&Reflect.apply||(ze?ia.bind(ra):function(){return ia.apply(ra,arguments)}),aa=Gt("species"),sa=RegExp.prototype,ua=function(e,t,n,r){var i=Gt(e),o=!De((function(){var t={};return t[i]=function(){return 7},7!==""[e](t)})),a=o&&!De((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[aa]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===Xo||a===sa.exec?o&&!i?{done:!0,value:je(s,t,n,r)}:{done:!0,value:je(e,n,t,r)}:{done:!1}}));Pn(String.prototype,e,u[0]),Pn(sa,i,u[1])}r&&cn(sa[i],"sham",!0)},ca=$o.charAt,la=function(e,t,n){return t+(n?ca(e,t).length:1)},ha=Math.floor,fa=Ze("".charAt),pa=Ze("".replace),da=Ze("".slice),va=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,ga=/\$([$&'`]|\d{1,2})/g,ma=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=ga;return void 0!==i&&(i=Ot(i),u=va),pa(o,u,(function(o,u){var c;switch(fa(u,0)){case"$":return"$";case"&":return e;case"`":return da(t,0,n);case"'":return da(t,a);case"<":c=i[da(u,1,-1)];break;default:var l=+u;if(0===l)return o;if(l>s){var h=ha(l/10);return 0===h?o:h<=s?void 0===r[h-1]?fa(u,1):r[h-1]+fa(u,1):o}c=r[l-1]}return void 0===c?"":c}))},ya=TypeError,_a=function(e,t){var n=e.exec;if(at(n)){var r=je(n,e,t);return null!==r&&rn(r),r}if("RegExp"===Qe(e))return je(Xo,e,t);throw new ya("RegExp#exec called on incompatible receiver")},ba=Gt("replace"),xa=Math.max,Sa=Math.min,Ea=Ze([].concat),Aa=Ze([].push),Ta=Ze("".indexOf),wa=Ze("".slice),Ca="$0"==="a".replace(/./,"$0"),ka=!!/./[ba]&&""===/./[ba]("a","$0");ua("replace",(function(e,t,n){var r=ka?"$":"$0";return[function(e,n){var r=rt(this),i=tt(e)?void 0:wt(e,ba);return i?je(i,e,r,n):je(t,wo(r),e,n)},function(e,i){var o=rn(this),a=wo(e);if("string"==typeof i&&-1===Ta(i,r)&&-1===Ta(i,"$<")){var s=n(t,o,a,i);if(s.done)return s.value}var u=at(i);u||(i=wo(i));var c,l=o.global;l&&(c=o.unicode,o.lastIndex=0);for(var h,f=[];null!==(h=_a(o,a))&&(Aa(f,h),l);){""===wo(h[0])&&(o.lastIndex=la(a,Bn(o.lastIndex),c))}for(var p,d="",v=0,g=0;g<f.length;g++){for(var m,y=wo((h=f[g])[0]),_=xa(Sa(Ln(h.index),a.length),0),b=[],x=1;x<h.length;x++)Aa(b,void 0===(p=h[x])?p:String(p));var S=h.groups;if(u){var E=Ea([y],b,_,a);void 0!==S&&Aa(E,S),m=wo(oa(i,void 0,E))}else m=ma(y,a,_,b,S,i);_>=v&&(d+=wa(a,v,_)+m,v=_+y.length)}return d+wa(a,v)}]}),!!De((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Ca||ka);var Ma={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Pa=Kt("span").classList,Ia=Pa&&Pa.constructor&&Pa.constructor.prototype,Ra=Ia===Object.prototype?void 0:Ia,Oa=Ze([].push),La=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,o=6===e,a=7===e,s=5===e||o;return function(u,c,l,h){for(var f,p,d=Ot(u),v=et(d),g=jn(v),m=Xi(c,l),y=0,_=h||kr,b=t?_(u,g):n||a?_(u,0):void 0;g>y;y++)if((s||y in v)&&(p=m(f=v[y],y,d),e))if(t)b[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:Oa(b,f)}else switch(e){case 4:return!1;case 7:Oa(b,f)}return o?-1:r||i?i:b}},Na={forEach:La(0),map:La(1),filter:La(2),some:La(3),every:La(4),find:La(5),findIndex:La(6),filterReject:La(7)},Da=function(e,t){var n=[][e];return!!n&&De((function(){n.call(null,t||function(){return 1},1)}))},Fa=Na.forEach,za=Da("forEach")?[].forEach:function(e){return Fa(this,e,arguments.length>1?arguments[1]:void 0)},Ba=function(e){if(e&&e.forEach!==za)try{cn(e,"forEach",za)}catch(t){e.forEach=za}};for(var ja in Ma)Ma[ja]&&Ba(Ne[ja]&&Ne[ja].prototype);Ba(Ra);var Ua=Gt("iterator"),Va=ki.values,Ga=function(e,t){if(e){if(e[Ua]!==Va)try{cn(e,Ua,Va)}catch(t){e[Ua]=Va}if(ci(e,t,!0),Ma[t])for(var n in ki)if(e[n]!==ki[n])try{cn(e,n,ki[n])}catch(t){e[n]=ki[n]}}};for(var Ha in Ma)Ga(Ne[Ha]&&Ne[Ha].prototype,Ha);Ga(Ra,"DOMTokenList");var Wa,Ya,Xa,Za,qa="process"===Qe(Ne.process),Ka=TypeError,Qa=function(e){if(Tr(e))return e;throw new Ka(Et(e)+" is not a constructor")},$a=Gt("species"),Ja=function(e,t){var n,r=rn(e).constructor;return void 0===r||tt(n=rn(r)[$a])?t:Qa(n)},es=TypeError,ts=function(e,t){if(e<t)throw new es("Not enough arguments");return e},ns=/(?:ipad|iphone|ipod).*applewebkit/i.test(ht),rs=Ne.setImmediate,is=Ne.clearImmediate,os=Ne.process,as=Ne.Dispatch,ss=Ne.Function,us=Ne.MessageChannel,cs=Ne.String,ls=0,hs={};De((function(){Wa=Ne.location}));var fs=function(e){if(Nt(hs,e)){var t=hs[e];delete hs[e],t()}},ps=function(e){return function(){fs(e)}},ds=function(e){fs(e.data)},vs=function(e){Ne.postMessage(cs(e),Wa.protocol+"//"+Wa.host)};rs&&is||(rs=function(e){ts(arguments.length,1);var t=at(e)?e:ss(e),n=Di(arguments,1);return hs[++ls]=function(){oa(t,void 0,n)},Ya(ls),ls},is=function(e){delete hs[e]},qa?Ya=function(e){os.nextTick(ps(e))}:as&&as.now?Ya=function(e){as.now(ps(e))}:us&&!ns?(Za=(Xa=new us).port2,Xa.port1.onmessage=ds,Ya=Xi(Za.postMessage,Za)):Ne.addEventListener&&at(Ne.postMessage)&&!Ne.importScripts&&Wa&&"file:"!==Wa.protocol&&!De(vs)?(Ya=vs,Ne.addEventListener("message",ds,!1)):Ya="onreadystatechange"in Kt("script")?function(e){zr.appendChild(Kt("script")).onreadystatechange=function(){zr.removeChild(this),fs(e)}}:function(e){setTimeout(ps(e),0)});var gs={set:rs,clear:is},ms=Object.getOwnPropertyDescriptor,ys=function(e){if(!Fe)return Ne[e];var t=ms(Ne,e);return t&&t.value},_s=function(){this.head=null,this.tail=null};_s.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var bs,xs,Ss,Es,As,Ts=_s,ws=/ipad|iphone|ipod/i.test(ht)&&"undefined"!=typeof Pebble,Cs=/web0s(?!.*chrome)/i.test(ht),ks=gs.set,Ms=Ne.MutationObserver||Ne.WebKitMutationObserver,Ps=Ne.document,Is=Ne.process,Rs=Ne.Promise,Os=ys("queueMicrotask");if(!Os){var Ls=new Ts,Ns=function(){var e,t;for(qa&&(e=Is.domain)&&e.exit();t=Ls.get();)try{t()}catch(e){throw Ls.head&&bs(),e}e&&e.enter()};ns||qa||Cs||!Ms||!Ps?!ws&&Rs&&Rs.resolve?((Es=Rs.resolve(void 0)).constructor=Rs,As=Xi(Es.then,Es),bs=function(){As(Ns)}):qa?bs=function(){Is.nextTick(Ns)}:(ks=Xi(ks,Ne),bs=function(){ks(Ns)}):(xs=!0,Ss=Ps.createTextNode(""),new Ms(Ns).observe(Ss,{characterData:!0}),bs=function(){Ss.data=xs=!xs}),Os=function(e){Ls.head||bs(),Ls.add(e)}}var Ds,Fs,zs,Bs=Os,js=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Us=Ne.Promise,Vs="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Gs=!Vs&&!qa&&"object"==typeof window&&"object"==typeof document,Hs=(Us&&Us.prototype,Gt("species")),Ws=!1,Ys=at(Ne.PromiseRejectionEvent),Xs={CONSTRUCTOR:or("Promise",(function(){var e=yn(Us),t=e!==String(Us);if(!t&&66===gt)return!0;if(!gt||gt<51||!/native code/.test(e)){var n=new Us((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[Hs]=r,!(Ws=n.then((function(){}))instanceof r))return!0}return!t&&(Gs||Vs)&&!Ys})),REJECTION_EVENT:Ys,SUBCLASSING:Ws},Zs=TypeError,qs=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new Zs("Bad Promise constructor");t=e,n=r})),this.resolve=Tt(t),this.reject=Tt(n)},Ks={f:function(e){return new qs(e)}},Qs=gs.set,$s=Xs.CONSTRUCTOR,Js=Xs.REJECTION_EVENT,eu=Xs.SUBCLASSING,tu=kn.getterFor("Promise"),nu=kn.set,ru=Us&&Us.prototype,iu=Us,ou=ru,au=Ne.TypeError,su=Ne.document,uu=Ne.process,cu=Ks.f,lu=cu,hu=!!(su&&su.createEvent&&Ne.dispatchEvent),fu=function(e){var t;return!(!st(e)||!at(t=e.then))&&t},pu=function(e,t){var n,r,i,o=t.value,a=1===t.state,s=a?e.ok:e.fail,u=e.resolve,c=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&yu(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),i=!0)),n===e.promise?c(new au("Promise-chain cycle")):(r=fu(n))?je(r,n,u,c):u(n)):c(o)}catch(e){l&&!i&&l.exit(),c(e)}},du=function(e,t){e.notified||(e.notified=!0,Bs((function(){for(var n,r=e.reactions;n=r.get();)pu(n,e);e.notified=!1,t&&!e.rejection&&gu(e)})))},vu=function(e,t,n){var r,i;hu?((r=su.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ne.dispatchEvent(r)):r={promise:t,reason:n},!Js&&(i=Ne["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}("Unhandled promise rejection",n)},gu=function(e){je(Qs,Ne,(function(){var t,n=e.facade,r=e.value;if(mu(e)&&(t=js((function(){qa?uu.emit("unhandledRejection",r,n):vu("unhandledrejection",n,r)})),e.rejection=qa||mu(e)?2:1,t.error))throw t.value}))},mu=function(e){return 1!==e.rejection&&!e.parent},yu=function(e){je(Qs,Ne,(function(){var t=e.facade;qa?uu.emit("rejectionHandled",t):vu("rejectionhandled",t,e.value)}))},_u=function(e,t,n){return function(r){e(t,r,n)}},bu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,du(e,!0))},xu=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new au("Promise can't be resolved itself");var r=fu(t);r?Bs((function(){var n={done:!1};try{je(r,t,_u(xu,n,e),_u(bu,n,e))}catch(t){bu(n,t,e)}})):(e.value=t,e.state=1,du(e,!1))}catch(t){bu({done:!1},t,e)}}};if($s&&(ou=(iu=function(e){so(this,ou),Tt(e),je(Ds,this);var t=tu(this);try{e(_u(xu,t),_u(bu,t))}catch(e){bu(t,e)}}).prototype,(Ds=function(e){nu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Ts,rejection:!1,state:0,value:void 0})}).prototype=Pn(ou,"then",(function(e,t){var n=tu(this),r=cu(Ja(this,iu));return n.parent=!0,r.ok=!at(e)||e,r.fail=at(t)&&t,r.domain=qa?uu.domain:void 0,0===n.state?n.reactions.add(r):Bs((function(){pu(r,n)})),r.promise})),Fs=function(){var e=new Ds,t=tu(e);this.promise=e,this.resolve=_u(xu,t),this.reject=_u(bu,t)},Ks.f=cu=function(e){return e===iu||void 0===e?new Fs(e):lu(e)},at(Us)&&ru!==Object.prototype)){zs=ru.then,eu||Pn(ru,"then",(function(e,t){var n=this;return new iu((function(e,t){je(zs,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete ru.constructor}catch(e){}gi&&gi(ru,ou)}sr({global:!0,constructor:!0,wrap:!0,forced:$s},{Promise:iu}),ci(iu,"Promise",!1),yo("Promise");var Su=Xs.CONSTRUCTOR||!fo((function(e){Us.all(e).then(void 0,(function(){}))}));sr({target:"Promise",stat:!0,forced:Su},{all:function(e){var t=this,n=Ks.f(t),r=n.resolve,i=n.reject,o=js((function(){var n=Tt(t.resolve),o=[],a=0,s=1;oo(e,(function(e){var u=a++,c=!1;s++,je(n,t,e).then((function(e){c||(c=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise}});var Eu=Xs.CONSTRUCTOR,Au=Us&&Us.prototype;if(sr({target:"Promise",proto:!0,forced:Eu,real:!0},{catch:function(e){return this.then(void 0,e)}}),at(Us)){var Tu=ct("Promise").prototype.catch;Au.catch!==Tu&&Pn(Au,"catch",Tu,{unsafe:!0})}sr({target:"Promise",stat:!0,forced:Su},{race:function(e){var t=this,n=Ks.f(t),r=n.reject,i=js((function(){var i=Tt(t.resolve);oo(e,(function(e){je(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),sr({target:"Promise",stat:!0,forced:Xs.CONSTRUCTOR},{reject:function(e){var t=Ks.f(this);return(0,t.reject)(e),t.promise}});var wu=Xs.CONSTRUCTOR;ct("Promise");sr({target:"Promise",stat:!0,forced:wu},{resolve:function(e){return function(e,t){if(rn(e),st(t)&&t.constructor===e)return t;var n=Ks.f(e);return(0,n.resolve)(t),n.promise}(this,e)}});var Cu=RegExp.prototype,ku=function(e){var t=e.flags;return void 0!==t||"flags"in Cu||Nt(e,"flags")||!lt(Cu,e)?t:je(Co,e)},Mu=pn.PROPER,Pu=RegExp.prototype,Iu=Pu.toString,Ru=De((function(){return"/a/b"!==Iu.call({source:"a",flags:"b"})})),Ou=Mu&&"toString"!==Iu.name;(Ru||Ou)&&Pn(Pu,"toString",(function(){var e=rn(this);return"/"+wo(e.source)+"/"+wo(ku(e))}),{unsafe:!0});var Lu,Nu,Du,Fu="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,zu=kn.enforce,Bu=kn.get,ju=Ne.Int8Array,Uu=ju&&ju.prototype,Vu=Ne.Uint8ClampedArray,Gu=Vu&&Vu.prototype,Hu=ju&&ri(ju),Wu=Uu&&ri(Uu),Yu=Object.prototype,Xu=Ne.TypeError,Zu=Gt("toStringTag"),qu=Bt("TYPED_ARRAY_TAG"),Ku=Fu&&!!gi&&"Opera"!==mr(Ne.opera),Qu=!1,$u={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ju={BigInt64Array:8,BigUint64Array:8},ec=function(e){var t=ri(e);if(st(t)){var n=Bu(t);return n&&Nt(n,"TypedArrayConstructor")?n.TypedArrayConstructor:ec(t)}},tc=function(e){if(!st(e))return!1;var t=mr(e);return Nt($u,t)||Nt(Ju,t)};for(Lu in $u)(Du=(Nu=Ne[Lu])&&Nu.prototype)?zu(Du).TypedArrayConstructor=Nu:Ku=!1;for(Lu in Ju)(Du=(Nu=Ne[Lu])&&Nu.prototype)&&(zu(Du).TypedArrayConstructor=Nu);if((!Ku||!at(Hu)||Hu===Function.prototype)&&(Hu=function(){throw new Xu("Incorrect invocation")},Ku))for(Lu in $u)Ne[Lu]&&gi(Ne[Lu],Hu);if((!Ku||!Wu||Wu===Yu)&&(Wu=Hu.prototype,Ku))for(Lu in $u)Ne[Lu]&&gi(Ne[Lu].prototype,Wu);if(Ku&&ri(Gu)!==Wu&&gi(Gu,Wu),Fe&&!Nt(Wu,Zu))for(Lu in Qu=!0,Pi(Wu,Zu,{configurable:!0,get:function(){return st(this)?this[qu]:void 0}}),$u)Ne[Lu]&&cn(Ne[Lu],qu,Lu);var nc={NATIVE_ARRAY_BUFFER_VIEWS:Ku,TYPED_ARRAY_TAG:Qu&&qu,aTypedArray:function(e){if(tc(e))return e;throw new Xu("Target is not a typed array")},aTypedArrayConstructor:function(e){if(at(e)&&(!gi||lt(Hu,e)))return e;throw new Xu(Et(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(Fe){if(n)for(var i in $u){var o=Ne[i];if(o&&Nt(o.prototype,e))try{delete o.prototype[e]}catch(n){try{o.prototype[e]=t}catch(e){}}}Wu[e]&&!n||Pn(Wu,e,n?t:Ku&&Uu[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Fe){if(gi){if(n)for(r in $u)if((i=Ne[r])&&Nt(i,e))try{delete i[e]}catch(e){}if(Hu[e]&&!n)return;try{return Pn(Hu,e,n?t:Ku&&Hu[e]||t)}catch(e){}}for(r in $u)!(i=Ne[r])||i[e]&&!n||Pn(i,e,t)}},getTypedArrayConstructor:ec,isView:function(e){if(!st(e))return!1;var t=mr(e);return"DataView"===t||Nt($u,t)||Nt(Ju,t)},isTypedArray:tc,TypedArray:Hu,TypedArrayPrototype:Wu},rc=nc.NATIVE_ARRAY_BUFFER_VIEWS,ic=Ne.ArrayBuffer,oc=Ne.Int8Array,ac=!rc||!De((function(){oc(1)}))||!De((function(){new oc(-1)}))||!fo((function(e){new oc,new oc(null),new oc(1.5),new oc(e)}),!0)||De((function(){return 1!==new oc(new ic(2),1,void 0).length})),sc=RangeError,uc=function(e){if(void 0===e)return 0;var t=Ln(e),n=Bn(t);if(t!==n)throw new sc("Wrong length or index");return n},cc=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1},lc=Math.abs,hc=Math.fround||function(e){return function(e,t,n,r){var i=+e,o=lc(i),a=cc(i);if(o<r)return a*function(e){return e+4503599627370496-4503599627370496}(o/r/t)*r*t;var s=(1+t/2220446049250313e-31)*o,u=s-(s-o);return u>n||u!=u?a*(1/0):a*u}(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)},fc=Array,pc=Math.abs,dc=Math.pow,vc=Math.floor,gc=Math.log,mc=Math.LN2,yc=function(e,t,n){var r,i,o,a=fc(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?dc(2,-24)-dc(2,-77):0,h=e<0||0===e&&1/e<0?1:0,f=0;for((e=pc(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=vc(gc(e)/mc),e*(o=dc(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*dc(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*dc(2,t),r+=c):(i=e*dc(2,c-1)*dc(2,t),r=0));t>=8;)a[f++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)a[f++]=255&r,r/=256,s-=8;return a[--f]|=128*h,a},_c=function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;)l=256*l+e[u--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[u--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=dc(2,t),l-=a}return(c?-1:1)*n*dc(2,l-t)},bc=function(e){for(var t=Ot(this),n=jn(t),r=arguments.length,i=Fn(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:Fn(o,n);a>i;)t[i++]=e;return t},xc=pn.PROPER,Sc=pn.CONFIGURABLE,Ec=kn.getterFor("ArrayBuffer"),Ac=kn.getterFor("DataView"),Tc=kn.set,wc=Ne.ArrayBuffer,Cc=wc,kc=Cc&&Cc.prototype,Mc=Ne.DataView,Pc=Mc&&Mc.prototype,Ic=Object.prototype,Rc=Ne.Array,Oc=Ne.RangeError,Lc=Ze(bc),Nc=Ze([].reverse),Dc=yc,Fc=_c,zc=function(e){return[255&e]},Bc=function(e){return[255&e,e>>8&255]},jc=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Uc=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Vc=function(e){return Dc(hc(e),23,4)},Gc=function(e){return Dc(e,52,8)},Hc=function(e,t,n){Pi(e.prototype,t,{configurable:!0,get:function(){return n(this)[t]}})},Wc=function(e,t,n,r){var i=Ac(e),o=uc(n),a=!!r;if(o+t>i.byteLength)throw new Oc("Wrong index");var s=i.bytes,u=o+i.byteOffset,c=Di(s,u,u+t);return a?c:Nc(c)},Yc=function(e,t,n,r,i,o){var a=Ac(e),s=uc(n),u=r(+i),c=!!o;if(s+t>a.byteLength)throw new Oc("Wrong index");for(var l=a.bytes,h=s+a.byteOffset,f=0;f<t;f++)l[h+f]=u[c?f:t-f-1]};if(Fu){var Xc=xc&&"ArrayBuffer"!==wc.name;De((function(){wc(1)}))&&De((function(){new wc(-1)}))&&!De((function(){return new wc,new wc(1.5),new wc(NaN),1!==wc.length||Xc&&!Sc}))?Xc&&Sc&&cn(wc,"name","ArrayBuffer"):((Cc=function(e){return so(this,kc),po(new wc(uc(e)),this,Cc)}).prototype=kc,kc.constructor=Cc,$n(Cc,wc)),gi&&ri(Pc)!==Ic&&gi(Pc,Ic);var Zc=new Mc(new Cc(2)),qc=Ze(Pc.setInt8);Zc.setInt8(0,2147483648),Zc.setInt8(1,2147483649),!Zc.getInt8(0)&&Zc.getInt8(1)||go(Pc,{setInt8:function(e,t){qc(this,e,t<<24>>24)},setUint8:function(e,t){qc(this,e,t<<24>>24)}},{unsafe:!0})}else kc=(Cc=function(e){so(this,kc);var t=uc(e);Tc(this,{type:"ArrayBuffer",bytes:Lc(Rc(t),0),byteLength:t}),Fe||(this.byteLength=t,this.detached=!1)}).prototype,Pc=(Mc=function(e,t,n){so(this,Pc),so(e,kc);var r=Ec(e),i=r.byteLength,o=Ln(t);if(o<0||o>i)throw new Oc("Wrong offset");if(o+(n=void 0===n?i-o:Bn(n))>i)throw new Oc("Wrong length");Tc(this,{type:"DataView",buffer:e,byteLength:n,byteOffset:o,bytes:r.bytes}),Fe||(this.buffer=e,this.byteLength=n,this.byteOffset=o)}).prototype,Fe&&(Hc(Cc,"byteLength",Ec),Hc(Mc,"buffer",Ac),Hc(Mc,"byteLength",Ac),Hc(Mc,"byteOffset",Ac)),go(Pc,{getInt8:function(e){return Wc(this,1,e)[0]<<24>>24},getUint8:function(e){return Wc(this,1,e)[0]},getInt16:function(e){var t=Wc(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Wc(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return Uc(Wc(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return Uc(Wc(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return Fc(Wc(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return Fc(Wc(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){Yc(this,1,e,zc,t)},setUint8:function(e,t){Yc(this,1,e,zc,t)},setInt16:function(e,t){Yc(this,2,e,Bc,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){Yc(this,2,e,Bc,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){Yc(this,4,e,jc,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){Yc(this,4,e,jc,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){Yc(this,4,e,Vc,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){Yc(this,8,e,Gc,t,arguments.length>2&&arguments[2])}});ci(Cc,"ArrayBuffer"),ci(Mc,"DataView");var Kc={ArrayBuffer:Cc,DataView:Mc},Qc=Math.floor,$c=Number.isInteger||function(e){return!st(e)&&isFinite(e)&&Qc(e)===e},Jc=RangeError,el=RangeError,tl=function(e,t){var n=function(e){var t=Ln(e);if(t<0)throw new Jc("The argument can't be less than 0");return t}(e);if(n%t)throw new el("Wrong offset");return n},nl=Math.round,rl=function(e){var t=mr(e);return"BigInt64Array"===t||"BigUint64Array"===t},il=TypeError,ol=function(e){var t=Yt(e,"number");if("number"==typeof t)throw new il("Can't convert number to bigint");return BigInt(t)},al=nc.aTypedArrayConstructor,sl=function(e){var t,n,r,i,o,a,s,u,c=Qa(this),l=Ot(e),h=arguments.length,f=h>1?arguments[1]:void 0,p=void 0!==f,d=$i(l);if(d&&!Ki(d))for(u=(s=eo(l,d)).next,l=[];!(a=je(u,s)).done;)l.push(a.value);for(p&&h>2&&(f=Xi(f,arguments[2])),n=jn(l),r=new(al(c))(n),i=rl(r),t=0;n>t;t++)o=p?f(l[t],t):l[t],r[t]=i?ol(o):+o;return r},ul=function(e,t,n){for(var r=0,i=arguments.length>2?n:jn(t),o=new e(i);i>r;)o[r]=t[r++];return o},cl=O((function(e){var t=Zn.f,n=Na.forEach,r=kn.get,i=kn.set,o=kn.enforce,a=un.f,s=Jt.f,u=Ne.RangeError,c=Kc.ArrayBuffer,l=c.prototype,h=Kc.DataView,f=nc.NATIVE_ARRAY_BUFFER_VIEWS,p=nc.TYPED_ARRAY_TAG,d=nc.TypedArray,v=nc.TypedArrayPrototype,g=nc.isTypedArray,m=function(e,t){Pi(e,t,{configurable:!0,get:function(){return r(this)[t]}})},y=function(e){var t;return lt(l,e)||"ArrayBuffer"===(t=mr(e))||"SharedArrayBuffer"===t},_=function(e,t){return g(e)&&!xt(t)&&t in e&&$c(+t)&&t>=0},b=function(e,t){return t=Xt(t),_(e,t)?He(2,e[t]):s(e,t)},x=function(e,t,n){return t=Xt(t),!(_(e,t)&&st(n)&&Nt(n,"value"))||Nt(n,"get")||Nt(n,"set")||n.configurable||Nt(n,"writable")&&!n.writable||Nt(n,"enumerable")&&!n.enumerable?a(e,t,n):(e[t]=n.value,e)};Fe?(f||(Jt.f=b,un.f=x,m(v,"buffer"),m(v,"byteOffset"),m(v,"byteLength"),m(v,"length")),sr({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:b,defineProperty:x}),e.exports=function(e,s,l){var m=e.match(/\d+/)[0]/8,_=e+(l?"Clamped":"")+"Array",b="get"+e,x="set"+e,S=Ne[_],E=S,A=E&&E.prototype,T={},w=function(e,t,n){var i=r(e);i.view[x](t*m+i.byteOffset,l?function(e){var t=nl(e);return t<0?0:t>255?255:255&t}(n):n,!0)},C=function(e,t){a(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[b](t*m+n.byteOffset,!0)}(this,t)},set:function(e){return w(this,t,e)},enumerable:!0})};f?ac&&(E=s((function(e,t,n,r){return so(e,A),po(st(t)?y(t)?void 0!==r?new S(t,tl(n,m),r):void 0!==n?new S(t,tl(n,m)):new S(t):g(t)?ul(E,t):je(sl,E,t):new S(uc(t)),e,E)})),gi&&gi(E,d),n(t(S),(function(e){e in E||cn(E,e,S[e])})),E.prototype=A):(E=s((function(e,t,n,r){so(e,A);var o,a,s,l=0,f=0;if(st(t)){if(!y(t))return g(t)?ul(E,t):je(sl,E,t);o=t,f=tl(n,m);var p=t.byteLength;if(void 0===r){if(p%m)throw new u("Wrong length");if((a=p-f)<0)throw new u("Wrong length")}else if((a=Bn(r)*m)+f>p)throw new u("Wrong length");s=a/m}else s=uc(t),o=new c(a=s*m);for(i(e,{buffer:o,byteOffset:f,byteLength:a,length:s,view:new h(o)});l<s;)C(e,l++)})),gi&&gi(E,d),A=E.prototype=Hr(v)),A.constructor!==E&&cn(A,"constructor",E),o(A).TypedArrayConstructor=E,p&&cn(A,p,_);var k=E!==S;T[_]=E,sr({global:!0,constructor:!0,forced:k,sham:!f},T),"BYTES_PER_ELEMENT"in E||cn(E,"BYTES_PER_ELEMENT",m),"BYTES_PER_ELEMENT"in A||cn(A,"BYTES_PER_ELEMENT",m),yo(_)}):e.exports=function(){}}));cl("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ll=TypeError,hl=function(e,t){if(!delete e[t])throw new ll("Cannot delete property "+Et(t)+" of "+Et(e))},fl=Math.min,pl=Ze([].copyWithin||function(e,t){var n=Ot(this),r=jn(n),i=Fn(e,r),o=Fn(t,r),a=arguments.length>2?arguments[2]:void 0,s=fl((void 0===a?r:Fn(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:hl(n,i),i+=u,o+=u;return n}),dl=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("copyWithin",(function(e,t){return pl(dl(this),e,t,arguments.length>2?arguments[2]:void 0)}));var vl=Na.every,gl=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("every",(function(e){return vl(gl(this),e,arguments.length>1?arguments[1]:void 0)}));var ml=nc.aTypedArray,yl=nc.exportTypedArrayMethod,_l=Ze("".slice);yl("fill",(function(e){var t=arguments.length;ml(this);var n="Big"===_l(mr(this),0,3)?ol(e):+e;return je(bc,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),De((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var bl=nc.aTypedArrayConstructor,xl=nc.getTypedArrayConstructor,Sl=function(e){return bl(Ja(e,xl(e)))},El=function(e,t){return ul(Sl(e),t)},Al=Na.filter,Tl=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("filter",(function(e){var t=Al(Tl(this),e,arguments.length>1?arguments[1]:void 0);return El(this,t)}));var wl=Na.find,Cl=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("find",(function(e){return wl(Cl(this),e,arguments.length>1?arguments[1]:void 0)}));var kl=Na.findIndex,Ml=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("findIndex",(function(e){return kl(Ml(this),e,arguments.length>1?arguments[1]:void 0)}));var Pl=Na.forEach,Il=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("forEach",(function(e){Pl(Il(this),e,arguments.length>1?arguments[1]:void 0)}));var Rl=Vn.includes,Ol=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("includes",(function(e){return Rl(Ol(this),e,arguments.length>1?arguments[1]:void 0)}));var Ll=Vn.indexOf,Nl=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("indexOf",(function(e){return Ll(Nl(this),e,arguments.length>1?arguments[1]:void 0)}));var Dl=Gt("iterator"),Fl=Ne.Uint8Array,zl=Ze(ki.values),Bl=Ze(ki.keys),jl=Ze(ki.entries),Ul=nc.aTypedArray,Vl=nc.exportTypedArrayMethod,Gl=Fl&&Fl.prototype,Hl=!De((function(){Gl[Dl].call([1])})),Wl=!!Gl&&Gl.values&&Gl[Dl]===Gl.values&&"values"===Gl.values.name,Yl=function(){return zl(Ul(this))};Vl("entries",(function(){return jl(Ul(this))}),Hl),Vl("keys",(function(){return Bl(Ul(this))}),Hl),Vl("values",Yl,Hl||!Wl,{name:"values"}),Vl(Dl,Yl,Hl||!Wl,{name:"values"});var Xl=nc.aTypedArray,Zl=nc.exportTypedArrayMethod,ql=Ze([].join);Zl("join",(function(e){return ql(Xl(this),e)}));var Kl=Math.min,Ql=[].lastIndexOf,$l=!!Ql&&1/[1].lastIndexOf(1,-0)<0,Jl=Da("lastIndexOf"),eh=$l||!Jl?function(e){if($l)return oa(Ql,this,arguments)||0;var t=it(this),n=jn(t);if(0===n)return-1;var r=n-1;for(arguments.length>1&&(r=Kl(r,Ln(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Ql,th=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return oa(eh,th(this),t>1?[e,arguments[1]]:[e])}));var nh=Na.map,rh=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("map",(function(e){return nh(rh(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Sl(e))(t)}))}));var ih=TypeError,oh="Reduce of empty array with no initial value",ah=function(e){return function(t,n,r,i){var o=Ot(t),a=et(o),s=jn(o);if(Tt(n),0===s&&r<2)throw new ih(oh);var u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw new ih(oh)}for(;e?u>=0:s>u;u+=c)u in a&&(i=n(i,a[u],u,o));return i}},sh={left:ah(!1),right:ah(!0)},uh=sh.left,ch=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return uh(ch(this),e,t,t>1?arguments[1]:void 0)}));var lh=sh.right,hh=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return lh(hh(this),e,t,t>1?arguments[1]:void 0)}));var fh=nc.aTypedArray,ph=nc.exportTypedArrayMethod,dh=Math.floor;ph("reverse",(function(){for(var e,t=fh(this).length,n=dh(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var vh=Ne.RangeError,gh=Ne.Int8Array,mh=gh&&gh.prototype,yh=mh&&mh.set,_h=nc.aTypedArray,bh=nc.exportTypedArrayMethod,xh=!De((function(){var e=new Uint8ClampedArray(2);return je(yh,e,{length:1,0:3},1),3!==e[1]})),Sh=xh&&nc.NATIVE_ARRAY_BUFFER_VIEWS&&De((function(){var e=new gh(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));bh("set",(function(e){_h(this);var t=tl(arguments.length>1?arguments[1]:void 0,1),n=Ot(e);if(xh)return je(yh,this,n,t);var r=this.length,i=jn(n),o=0;if(i+t>r)throw new vh("Wrong length");for(;o<i;)this[t+o]=n[o++]}),!xh||Sh);var Eh=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("slice",(function(e,t){for(var n=Di(Eh(this),e,t),r=Sl(this),i=0,o=n.length,a=new r(o);o>i;)a[i]=n[i++];return a}),De((function(){new Int8Array(1).slice()})));var Ah=Na.some,Th=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("some",(function(e){return Ah(Th(this),e,arguments.length>1?arguments[1]:void 0)}));var wh=Math.floor,Ch=function(e,t){var n=e.length;if(n<8)for(var r,i,o=1;o<n;){for(i=o,r=e[o];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==o++&&(e[i]=r)}else for(var a=wh(n/2),s=Ch(Di(e,0,a),t),u=Ch(Di(e,a),t),c=s.length,l=u.length,h=0,f=0;h<c||f<l;)e[h+f]=h<c&&f<l?t(s[h],u[f])<=0?s[h++]:u[f++]:h<c?s[h++]:u[f++];return e},kh=Ch,Mh=ht.match(/firefox\/(\d+)/i),Ph=!!Mh&&+Mh[1],Ih=/MSIE|Trident/.test(ht),Rh=ht.match(/AppleWebKit\/(\d+)\./),Oh=!!Rh&&+Rh[1],Lh=nc.aTypedArray,Nh=nc.exportTypedArrayMethod,Dh=Ne.Uint16Array,Fh=Dh&&Wi(Dh.prototype.sort),zh=!(!Fh||De((function(){Fh(new Dh(2),null)}))&&De((function(){Fh(new Dh(2),{})}))),Bh=!!Fh&&!De((function(){if(gt)return gt<74;if(Ph)return Ph<67;if(Ih)return!0;if(Oh)return Oh<602;var e,t,n=new Dh(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(Fh(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));Nh("sort",(function(e){return void 0!==e&&Tt(e),Bh?Fh(this,e):kh(Lh(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!Bh||zh);var jh=nc.aTypedArray;(0,nc.exportTypedArrayMethod)("subarray",(function(e,t){var n=jh(this),r=n.length,i=Fn(e,r);return new(Sl(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,Bn((void 0===t?r:Fn(t,r))-i))}));var Uh=Ne.Int8Array,Vh=nc.aTypedArray,Gh=nc.exportTypedArrayMethod,Hh=[].toLocaleString,Wh=!!Uh&&De((function(){Hh.call(new Uh(1))}));Gh("toLocaleString",(function(){return oa(Hh,Wh?Di(Vh(this)):Vh(this),Di(arguments))}),De((function(){return[1,2].toLocaleString()!==new Uh([1,2]).toLocaleString()}))||!De((function(){Uh.prototype.toLocaleString.call([1,2])})));var Yh=nc.exportTypedArrayMethod,Xh=Ne.Uint8Array,Zh=Xh&&Xh.prototype||{},qh=[].toString,Kh=Ze([].join);De((function(){qh.call({})}))&&(qh=function(){return Kh(this)});var Qh=Zh.toString!==qh;Yh("toString",qh,Qh);var $h=Pr("slice"),Jh=Gt("species"),ef=Array,tf=Math.max;sr({target:"Array",proto:!0,forced:!$h},{slice:function(e,t){var n,r,i,o=it(this),a=jn(o),s=Fn(e,a),u=Fn(void 0===t?a:t,a);if(ur(o)&&(n=o.constructor,(Tr(n)&&(n===ef||ur(n.prototype))||st(n)&&null===(n=n[Jh]))&&(n=void 0),n===ef||void 0===n))return Di(o,s,u);for(r=new(void 0===n?ef:n)(tf(u-s,0)),i=0;s<u;s++,i++)s in o&&hr(r,i,o[s]);return r.length=i,r}});var nf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function rf(e){this.message=e}function of(e){for(var t,n,r,i,o="",a=0,s=(e=String(e)).length%3;a<e.length;){if((n=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=nf.charAt((t=n<<16|r<<8|i)>>18&63)+nf.charAt(t>>12&63)+nf.charAt(t>>6&63)+nf.charAt(63&t)}return s?o.slice(0,s-3)+"===".substring(s):o}rf.prototype=new Error,rf.prototype.name="InvalidCharacterError";var af,sf=function(){return l((function e(t,n){s(this,e),this.buffers=t,this.type=n}),[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(e,t,n){throw new Error("not implemented")}}])}();sr({global:!0,forced:Ne.globalThis!==Ne},{globalThis:Ne}),af="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(e){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(e){return!0},Event:function(e,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var uf="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:af.devicePixelRatio,cf=TypeError,lf=Object.getOwnPropertyDescriptor,hf=Fe&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(ur(e)&&!lf(e,"length").writable)throw new cf("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},ff=Pr("splice"),pf=Math.max,df=Math.min;sr({target:"Array",proto:!0,forced:!ff},{splice:function(e,t){var n,r,i,o,a,s,u=Ot(this),c=jn(u),l=Fn(e,c),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=c-l):(n=h-2,r=df(pf(Ln(t),0),c-l)),lr(c+n-r),i=kr(u,r),o=0;o<r;o++)(a=l+o)in u&&hr(i,o,u[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:hl(u,s);for(o=c;o>c-r+n;o--)hl(u,o-1)}else if(n>r)for(o=c-r;o>l;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:hl(u,s);for(o=0;o<n;o++)u[o+l]=arguments[o+2];return hf(u,c-r+n),i}});var vf=l((function e(t,n){s(this,e),f(this,"cancelBubble",void 0),f(this,"cancelable",void 0),f(this,"target",void 0),f(this,"currentTarget",void 0),f(this,"preventDefault",void 0),f(this,"stopPropagation",void 0),f(this,"type",void 0),f(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()})),gf=Na.findIndex,mf=!0;"findIndex"in[]&&Array(1).findIndex((function(){mf=!1})),sr({target:"Array",proto:!0,forced:mf},{findIndex:function(e){return gf(this,e,arguments.length>1?arguments[1]:void 0)}}),Qr("findIndex");var yf=Object.assign,_f=Object.defineProperty,bf=Ze([].concat),xf=!yf||De((function(){if(Fe&&1!==yf({b:1},yf(_f({},"a",{enumerable:!0,get:function(){_f(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection");return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!==yf({},e)[n]||"abcdefghijklmnopqrst"!==Dr(yf({},t)).join("")}))?function(e,t){for(var n=Ot(e),r=arguments.length,i=1,o=qn.f,a=Ge.f;r>i;)for(var s,u=et(arguments[i++]),c=o?bf(Dr(u),o(u)):Dr(u),l=c.length,h=0;l>h;)s=c[h++],Fe&&!je(a,u,s)||(n[s]=u[s]);return n}:yf;sr({target:"Object",stat:!0,arity:2,forced:Object.assign!==xf},{assign:xf});var Sf=Hi.getWeakData,Ef=kn.set,Af=kn.getterFor,Tf=Na.find,wf=Na.findIndex,Cf=Ze([].splice),kf=0,Mf=function(e){return e.frozen||(e.frozen=new Pf)},Pf=function(){this.entries=[]},If=function(e,t){return Tf(e.entries,(function(e){return e[0]===t}))};Pf.prototype={get:function(e){var t=If(this,e);if(t)return t[1]},has:function(e){return!!If(this,e)},set:function(e,t){var n=If(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=wf(this.entries,(function(t){return t[0]===e}));return~t&&Cf(this.entries,t,1),!!~t}};var Rf,Of={getConstructor:function(e,t,n,r){var i=e((function(e,i){so(e,o),Ef(e,{type:t,id:kf++,frozen:void 0}),tt(i)||oo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=Af(t),s=function(e,t,n){var r=a(e),i=Sf(rn(t),!0);return!0===i?Mf(r).set(t,n):i[r.id]=n,e};return go(o,{delete:function(e){var t=a(this);if(!st(e))return!1;var n=Sf(e);return!0===n?Mf(t).delete(e):n&&Nt(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!st(e))return!1;var n=Sf(e);return!0===n?Mf(t).has(e):n&&Nt(n,t.id)}}),go(o,n?{get:function(e){var t=a(this);if(st(e)){var n=Sf(e);return!0===n?Mf(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},Lf=kn.enforce,Nf=Object,Df=Array.isArray,Ff=Nf.isExtensible,zf=Nf.isFrozen,Bf=Nf.isSealed,jf=Nf.freeze,Uf=Nf.seal,Vf=!Ne.ActiveXObject&&"ActiveXObject"in Ne,Gf=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Hf=vo("WeakMap",Gf,Of),Wf=Hf.prototype,Yf=Ze(Wf.set);if(bn)if(Vf){Rf=Of.getConstructor(Gf,"WeakMap",!0),Hi.enable();var Xf=Ze(Wf.delete),Zf=Ze(Wf.has),qf=Ze(Wf.get);go(Wf,{delete:function(e){if(st(e)&&!Ff(e)){var t=Lf(this);return t.frozen||(t.frozen=new Rf),Xf(this,e)||t.frozen.delete(e)}return Xf(this,e)},has:function(e){if(st(e)&&!Ff(e)){var t=Lf(this);return t.frozen||(t.frozen=new Rf),Zf(this,e)||t.frozen.has(e)}return Zf(this,e)},get:function(e){if(st(e)&&!Ff(e)){var t=Lf(this);return t.frozen||(t.frozen=new Rf),Zf(this,e)?qf(this,e):t.frozen.get(e)}return qf(this,e)},set:function(e,t){if(st(e)&&!Ff(e)){var n=Lf(this);n.frozen||(n.frozen=new Rf),Zf(this,e)?Yf(this,e,t):n.frozen.set(e,t)}else Yf(this,e,t);return this}})}else Gi&&De((function(){var e=jf([]);return Yf(new Hf,e,1),!zf(e)}))&&go(Wf,{set:function(e,t){var n;return Df(e)&&(zf(e)?n=jf:Bf(e)&&(n=Uf)),Yf(this,e,t),n&&n(e),this}});var Kf,Qf,$f,Jf,ep=new WeakMap,tp=function(){return l((function e(){s(this,e),ep.set(this,{})}),[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ep.get(this);r||(r={}),r[e]||(r[e]=[]),r[e].push(t),ep.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(e,t){var n=ep.get(this);if(n){var r=n[e];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===t){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(e){var t=ep.get(this)[e.type];if(t){var n,r=h(t);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e)}}catch(e){r.e(e)}finally{r.f()}}}}])}(),np=function(e){function t(){var e;return s(this,t),f(e=a(this,t),"childNodes",void 0),e.childNodes=[],e}return v(t,e),l(t,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex((function(t){return t===e}));return t>-1?this.childNodes.splice(t,1):null}}])}(tp),rp=function(e){function t(){var e;return s(this,t),f(e=a(this,t),"className",void 0),f(e,"children",void 0),e.className="",e.children=[],e}return v(t,e),l(t,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,t){this[e]=t}},{key:"getAttributeNS",value:function(e){return this[e]}}])}(np);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var ip=my.getSystemInfoSync();Kf=ip.screenWidth,Qf=ip.screenHeight,$f=ip.windowWidth,Jf=ip.windowHeight}else{var op=af.innerWidth,ap=af.innerHeight;Kf=op,Qf=ap,$f=op,Jf=ap}var sp={width:Kf,height:Qf,availWidth:$f,availHeight:Jf,availLeft:0,availTop:0},up=sp.availWidth,cp=sp.availHeight,lp={style:[]};function hp(e,t){var n,r;"parentNode"in e||(n=0===t?function(){return null}:1===t?function(){return lp}:function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:n}));"parentElement"in e||(r=0===t?function(){return null}:1===t?function(){return lp}:function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:r}))}function fp(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:up+"px",height:cp+"px",margin:"0px",padding:"0px"})}function pp(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=up,e.clientHeight=cp),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function dp(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=up,e.offsetHeight=cp)}function vp(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=up,e.scrollHeight=cp)}function gp(e){var t=function(){return!0};e.classList=[],e.classList.add=t,e.classList.remove=t,e.classList.contains=t,e.classList.toggle=t}function mp(){}var yp=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;return s(this,t),f(e=a(this,t),"className",void 0),f(e,"children",void 0),f(e,"focus",void 0),f(e,"blur",void 0),f(e,"insertBefore",void 0),f(e,"appendChild",void 0),f(e,"removeChild",void 0),f(e,"remove",void 0),f(e,"innerHTML",void 0),f(e,"tagName",void 0),e.className="",e.children=[],e.focus=mp,e.blur=mp,e.insertBefore=mp,e.appendChild=mp,e.removeChild=mp,e.remove=mp,e.innerHTML="",e.tagName=n.toUpperCase(),hp(e,r),fp(e),gp(e),pp(e),dp(e),vp(e),e}return v(t,e),l(t)}(rp),_p=function(e){function t(e){return s(this,t),a(this,t,[e])}return v(t,e),l(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}])}(yp),bp=function(e){function t(){return s(this,t),a(this,t,["video"])}return v(t,e),l(t)}(_p),xp={};function Sp(){return xp}var Ep=l((function e(){s(this,e);var t=Sp(),n=t.createImage&&t.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=e.prototype),hp(n),gp(n),Object.assign(n,{addEventListener:function(e,t){n["on".concat(e)]=t.bind(n)},removeEventListener:function(e){n["on".concat(e)]=null}}),n})),Ap={href:"",protocol:"",host:""},Tp=function(e){function t(){return s(this,t),a(this,t,["body",0])}return v(t,e),l(t,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t,n){}},{key:"dispatchEvent",value:function(e){}}])}(yp),wp=function(e){function t(){return s(this,t),a(this,t,["html",0])}return v(t,e),l(t,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t){}},{key:"dispatchEvent",value:function(e){}}])}(yp),Cp={},kp={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ap,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(e){return"canvas"===(e=e.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===e?new Ep:"video"===e?new bp:new yp(e)},createElementNS:function(e,t){return this.createElement(t)},createTextNode:function(e){return e},getElementById:function(e){return null},getElementsByTagName:function(e){return e=e.toLowerCase(),[]},getElementsByTagNameNS:function(e,t){return this.getElementsByTagName(t)},getElementsByName:function(e){return[]},querySelector:function(e){return null},querySelectorAll:function(e){return[]},addEventListener:function(e,t,n){Cp[e]||(Cp[e]=[]),Cp[e].push(t)},removeEventListener:function(e,t){var n=Cp[e];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=e.type,n=Cp[t];if(n)for(var r=0;r<n.length;r++)n[r](e);e.target&&"function"==typeof e.target["on"+t]&&e.target["on"+t](e)},createEvent:function(e){return new vf(e)}};kp.documentElement=new wp,kp.head=new yp("head"),kp.body=new Tp;var Mp=Object;cl("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var Pp,Ip,Rp,Op,Lp=function(){return l((function e(){s(this,e),f(this,"_w",void 0),f(this,"_h",void 0),f(this,"_data",void 0);var t=arguments.length;if(2===t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===t&&"object"===C(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}),[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}])}();if(ua("match",(function(e,t,n){return[function(t){var n=rt(this),r=tt(t)?void 0:wt(t,e);return r?je(r,t,n):new RegExp(t)[e](wo(n))},function(e){var r=rn(this),i=wo(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return _a(r,i);var a=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=_a(r,i));){var l=wo(s[0]);u[c]=l,""===l&&(r.lastIndex=la(i,Bn(r.lastIndex),a)),c++}return 0===c?null:u}]})),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Np=my.getSystemInfoSync();Pp=Np.system,Ip=Np.platform,Rp=Np.language}else{var Dp={versions:(Op=af.navigator.userAgent,{trident:Op.indexOf("Trident")>-1,presto:Op.indexOf("Presto")>-1,webKit:Op.indexOf("AppleWebKit")>-1,gecko:Op.indexOf("Gecko")>-1&&-1===Op.indexOf("KHTML"),mobile:!!Op.match(/AppleWebKit.*Mobile.*/),ios:!!Op.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Op.indexOf("Android")>-1||Op.indexOf("Linux")>-1,iPhone:Op.indexOf("iPhone")>-1,iPad:Op.indexOf("iPad")>-1,webApp:-1===Op.indexOf("Safari"),weixin:Op.indexOf("MicroMessenger")>-1,qq:" qq"===Op.match(/\sQQ/i)}),language:(af.navigator.browserLanguage||af.navigator.language).toLowerCase()};Dp.versions.android?Ip="android":Dp.versions.trident?Ip="IE":Dp.versions.presto?Ip="Opera":Dp.versions.webKit?Ip="webKit":Dp.versions.gecko?Ip="Firefox":Dp.versions.mobile?Ip="mobile":Dp.versions.ios?Ip="ios":Dp.versions.iPhone?Ip="iPhone":Dp.versions.iPad?Ip="ipad":Dp.versions.webApp?Ip="webApp":Dp.versions.weixin?Ip="weixin":Dp.versions.qq&&(Ip="qq"),Pp=af.navigator.userAgent,Rp=Dp.language}var Fp=-1!==Pp.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",zp="Mozilla/5.0 (".concat(Fp,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Rp),Bp={platform:Ip,language:Rp,appVersion:"5.0 (".concat(Fp,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:zp},jp=0;var Up=function(){return l((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";s(this,e),f(this,"href",void 0),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?this.href=n+t:this.href=t}),null,[{key:"createObjectURL",value:function(e){var t=e.buffers[0],n=e.type,r=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return of(t)}(t);return"data:".concat(n,";base64, ")+r}}])}();var Vp=Ze([].join),Gp=et!==Object||!Da("join",",");sr({target:"Array",proto:!0,forced:Gp},{join:function(e){return Vp(it(this),void 0===e?",":e)}});var Hp=Na.map,Wp=Pr("map");sr({target:"Array",proto:!0,forced:!Wp},{map:function(e){return Hp(this,e,arguments.length>1?arguments[1]:void 0)}});var Yp=new Map,Xp=new Map,Zp=new Map,qp=function(e){function t(){var e;return s(this,t),f(e=a(this,t),"onabort",void 0),f(e,"onerror",void 0),f(e,"onload",void 0),f(e,"onloadstart",void 0),f(e,"onprogress",void 0),f(e,"ontimeout",void 0),f(e,"onloadend",void 0),f(e,"onreadystatechange",void 0),f(e,"readyState",void 0),f(e,"response",void 0),f(e,"responseText",void 0),f(e,"_responseType",void 0),f(e,"responseXML",void 0),f(e,"status",void 0),f(e,"statusText",void 0),f(e,"upload",void 0),f(e,"withCredentials",void 0),f(e,"timeout",void 0),f(e,"_url",void 0),f(e,"_method",void 0),e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e._responseType="text",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,Yp.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),e}return v(t,e),l(t,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=Zp.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=Xp.get("responseHeader");return Object.keys(e).map((function(t){return"".concat(t,": ").concat(e[t])})).join("\n")}},{key:"getResponseHeader",value:function(e){return Xp.get("responseHeader")[e]}},{key:"open",value:function(e,t,n){this._method=e,this._url=t}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(e,t){var n=Yp.get("requestHeader");n[e]=t,Yp.set("requestHeader",n)}},{key:"addEventListener",value:function(e,t){var n=this;"function"==typeof t&&(this["on"+e]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.target=e.target||n,t.call(n,e)})}},{key:"removeEventListener",value:function(e,t){this["on"+e]===t&&(this["on"+e]=null)}}])}(tp);function Kp(e){return function(t){t.type=e,kp.dispatchEvent(t)}}f(qp,"UNSEND",void 0),f(qp,"OPENED",void 0),f(qp,"HEADERS_RECEIVED",void 0),f(qp,"LOADING",void 0),f(qp,"DONE",void 0),qp.UNSEND=0,qp.OPENED=1,qp.HEADERS_RECEIVED=2,qp.LOADING=3,qp.DONE=4;var Qp=Kp("mousedown"),$p=Kp("mousemove"),Jp=Kp("mouseup"),ed=function(e){function t(e){var n;return s(this,t),f(n=a(this,t,[e]),"buttons",void 0),f(n,"which",void 0),f(n,"pointerId",void 0),f(n,"bubbles",void 0),f(n,"button",void 0),f(n,"width",void 0),f(n,"height",void 0),f(n,"pressure",void 0),f(n,"isPrimary",void 0),f(n,"pointerType",void 0),f(n,"altKey",void 0),f(n,"ctrlKey",void 0),f(n,"metaKey",void 0),f(n,"shiftKey",void 0),n.target=Sp(),n.currentTarget=Sp(),n}return v(t,e),l(t)}(vf),td=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],nd=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function rd(e,t,n){for(var r=new ed(e),i=0;i<td.length;i++){var o=td[i];r[o]=t[o]||nd[i]}return r.type=e,r.target=Sp(),r.currentTarget=Sp(),r.buttons=function(e){var t=0;"touchstart"!==e&&"touchmove"!==e&&"pointerdown"!==e&&"pointermove"!==e||(t=1);return t}(e),r.which=r.buttons,r.pointerId=(t.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(t.radiusX||.5),r.height=2*(t.radiusY||.5),r.pressure=t.force||.5,r.isPrimary=function(e){return id===e.identifier}(t),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var id=null;function od(e){null===id&&(id=e.identifier)}function ad(e){id===e.identifier&&(id=null)}function sd(e){return function(t){for(var n=t.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===e?od(i):"pointerup"!==e&&"pointercancel"!==e||ad(i);var o=rd(e,i,t);kp.dispatchEvent(o)}}}var ud=sd("pointerdown"),cd=sd("pointermove"),ld=sd("pointerup"),hd=function(e){function t(e){var n;return s(this,t),f(n=a(this,t,[e]),"touches",void 0),f(n,"targetTouches",void 0),f(n,"changedTouches",void 0),n.touches=[],n.targetTouches=[],n.changedTouches=[],n.target=Sp(),n.currentTarget=Sp(),n}return v(t,e),l(t)}(vf);function fd(e){var t=e||{},n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,a=t.clientX,s=void 0===a?0:a,u=t.clientY,c=void 0===u?0:u;-1!==Object.keys(e).indexOf("x")?(e.pageX=e.clientX=r,e.pageY=e.clientY=o):(e.x=s,e.y=c)}function pd(e){return function(t){var n=new hd(e);n.changedTouches=t.changedTouches,n.touches=t.touches,n.targetTouches=Array.prototype.slice.call(t.touches),n.timeStamp=t.timeStamp,n.changedTouches.forEach((function(e){return fd(e)})),n.touches.forEach((function(e){return fd(e)})),n.targetTouches.forEach((function(e){return fd(e)})),kp.dispatchEvent(n)}}var dd,vd=pd("touchstart"),gd=pd("touchmove"),md=pd("touchend"),yd=(dd="mapCameaParams",function(e){e.type=dd,kp.dispatchEvent(e)});function _d(t){e.isMiniScene=t}e.isMiniScene=!1;var bd="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,xd="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Sd=(bd||xd)&&e.isMiniScene,Ed={atob:function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new rf("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=t.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=nf.indexOf(r);return i},btoa:of,devicePixelRatio:uf,Blob:sf,document:kp,Element:rp,Event:vf,EventTarget:tp,HTMLCanvasElement:Mp,HTMLElement:yp,HTMLMediaElement:_p,HTMLVideoElement:bp,Image:Ep,ImageData:Lp,navigator:Bp,Node:np,requestAnimationFrame:function(e){var t=Sp();return t.requestAnimationFrame?t.requestAnimationFrame(e):function(e){var t=Date.now(),n=Math.max(jp+23,t);return setTimeout((function(){e(jp=n)}),n-t)}(e)},cancelAnimationFrame:function(e){var t=Sp();return t.cancelAnimationFrame?t.cancelAnimationFrame(e):clearTimeout(e)},screen:sp,XMLHttpRequest:qp,performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){}},URL:Up,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};kp.addEventListener(e,t,n)},removeEventListener:function(e,t,n){kp.removeEventListener(e,t)},dispatchEvent:function(e){kp.dispatchEvent(e)},innerWidth:sp.availWidth,innerHeight:sp.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},Ad=Sd?Ed:af,Td=Sd?qp:af.XMLHttpRequest,wd=Sd?Ap:af.location,Cd=function(e){function t(e,n,r,i){var o;return s(this,t),f(o=a(this,t,["AJAXError: ".concat(n," (").concat(e,"): ").concat(r)]),"status",void 0),f(o,"statusText",void 0),f(o,"url",void 0),f(o,"body",void 0),o.status=e,o.statusText=n,o.url=r,o.body=i,o}return v(t,e),l(t)}(M(Error));function kd(e,t){var n=new Td,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new Cd(n.status,n.statusText,r.toString(),o))}},n.send(e.body),n}function Md(e){return new Promise((function(t,n){kd(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function Pd(e,t){return kd(e,t)}var Id=function(e,t){return Pd(_(_({},e),{},{type:"json"}),t)},Rd=function(e,t){return Pd(_(_({},e),{},{type:"arrayBuffer"}),t)};var Od="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ld(e,t){var n=new Ad.Image,r=Ad.URL||Ad.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=Od}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):Od}function Nd(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var Dd=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?Nd(o,t):Ld(o,t)}};return"json"===e.type?Id(e,r):Rd(e,r)},Fd=function(e,t){"function"==typeof createImageBitmap?Nd(e,t):Ld(e,t)},zd=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Bd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jd(e,t,n){var r=e.classList;for(var i in Bd)Bd.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}function Ud(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Vd(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Gd(){}sr({target:"Array",proto:!0},{fill:bc}),Qr("fill");var Hd="\\s*([+-]?\\d+)\\s*",Wd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Xd=/^#([0-9a-f]{3,8})$/,Zd=new RegExp("^rgb\\("+[Hd,Hd,Hd]+"\\)$"),qd=new RegExp("^rgb\\("+[Yd,Yd,Yd]+"\\)$"),Kd=new RegExp("^rgba\\("+[Hd,Hd,Hd,Wd]+"\\)$"),Qd=new RegExp("^rgba\\("+[Yd,Yd,Yd,Wd]+"\\)$"),$d=new RegExp("^hsl\\("+[Wd,Yd,Yd]+"\\)$"),Jd=new RegExp("^hsla\\("+[Wd,Yd,Yd,Wd]+"\\)$"),ev={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tv(){return this.rgb().formatHex()}function nv(){return this.rgb().formatRgb()}function rv(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Xd.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?iv(t):3===n?new uv(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ov(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ov(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Zd.exec(e))?new uv(t[1],t[2],t[3],1):(t=qd.exec(e))?new uv(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Kd.exec(e))?ov(t[1],t[2],t[3],t[4]):(t=Qd.exec(e))?ov(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=$d.exec(e))?fv(t[1],t[2]/100,t[3]/100,1):(t=Jd.exec(e))?fv(t[1],t[2]/100,t[3]/100,t[4]):ev.hasOwnProperty(e)?iv(ev[e]):"transparent"===e?new uv(NaN,NaN,NaN,0):null}function iv(e){return new uv(e>>16&255,e>>8&255,255&e,1)}function ov(e,t,n,r){return r<=0&&(e=t=n=NaN),new uv(e,t,n,r)}function av(e){return e instanceof Gd||(e=rv(e)),e?new uv((e=e.rgb()).r,e.g,e.b,e.opacity):new uv}function sv(e,t,n,r){return 1===arguments.length?av(e):new uv(e,t,n,null==r?1:r)}function uv(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function cv(){return"#"+hv(this.r)+hv(this.g)+hv(this.b)}function lv(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function hv(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function fv(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new dv(e,t,n,r)}function pv(e){if(e instanceof dv)return new dv(e.h,e.s,e.l,e.opacity);if(e instanceof Gd||(e=rv(e)),!e)return new dv;if(e instanceof dv)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new dv(a,s,u,e.opacity)}function dv(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function vv(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function gv(e){var t=rv(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function mv(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function yv(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function _v(e){var t=Ad.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=null,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}if(n.fillStyle=i,n.fillRect(0,0,256,1),Sd)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),l=0;l<c.data.length;l+=4)c.data[l+0]=r[l+0],c.data[l+1]=r[l+1],c.data[l+2]=r[l+2],c.data[l+3]=r[l+3];return t=null,n=null,c}function bv(e,t){var n=Ad.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,c=Av(r,u);return n=null,r=null,c}function xv(e){var t=Ad.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=gv(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}function Sv(e){var t=Ad.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=Av(n,o);return t=null,n=null,a}function Ev(e,t){var n=Ad.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions çæ°å­ä¸ªæ°åºå½æ¯ colors çæ ·å¼å¤ä¸ä¸ª,poisitions çé¦å°¾å¼ä¸è¬ä¸ºæ°æ®çæå¤§ææ°å¼");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=Av(r,a);return n=null,r=null,s}function Av(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function Tv(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}Ud(Gd,rv,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:tv,formatHex:tv,formatHsl:function(){return pv(this).formatHsl()},formatRgb:nv,toString:nv}),Ud(uv,sv,Vd(Gd,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new uv(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new uv(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cv,formatHex:cv,formatRgb:lv,toString:lv})),Ud(dv,(function(e,t,n,r){return 1===arguments.length?pv(e):new dv(e,t,n,null==r?1:r)}),Vd(Gd,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new dv(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new dv(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new uv(vv(e>=240?e-240:e+120,i,r),vv(e,i,r),vv(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var wv=1029,Cv=1028;function kv(e){switch(e){case"GAODE1.x":case"GAODE2.x":return wv;case"MAPBOX":case"MAPLIBRE":case"SIMPLE":return Cv;case"GLOBEL":return wv;case"DEBAULT":default:return Cv}}var Mv=function(e){return e};var Pv=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Iv=Math.max;var Rv=function(e,t,n){return t=Iv(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Iv(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),Pv(e,this,s)}};var Ov=function(e){return function(){return e}},Lv="object"==typeof I&&I&&I.Object===Object&&I,Nv="object"==typeof self&&self&&self.Object===Object&&self,Dv=Lv||Nv||Function("return this")(),Fv=Dv.Symbol,zv=Object.prototype,Bv=zv.hasOwnProperty,jv=zv.toString,Uv=Fv?Fv.toStringTag:void 0;var Vv=function(e){var t=Bv.call(e,Uv),n=e[Uv];try{e[Uv]=void 0;var r=!0}catch(e){}var i=jv.call(e);return r&&(t?e[Uv]=n:delete e[Uv]),i},Gv=Object.prototype.toString;var Hv=function(e){return Gv.call(e)},Wv=Fv?Fv.toStringTag:void 0;var Yv=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Wv&&Wv in Object(e)?Vv(e):Hv(e)};var Xv=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Zv=function(e){if(!Xv(e))return!1;var t=Yv(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},qv=Dv["__core-js_shared__"],Kv=function(){var e=/[^.]+$/.exec(qv&&qv.keys&&qv.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Qv=function(e){return!!Kv&&Kv in e},$v=Function.prototype.toString;var Jv=function(e){if(null!=e){try{return $v.call(e)}catch(e){}try{return e+""}catch(e){}}return""},eg=/^\[object .+?Constructor\]$/,tg=Function.prototype,ng=Object.prototype,rg=tg.toString,ig=ng.hasOwnProperty,og=RegExp("^"+rg.call(ig).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ag=function(e){return!(!Xv(e)||Qv(e))&&(Zv(e)?og:eg).test(Jv(e))};var sg=function(e,t){return null==e?void 0:e[t]};var ug=function(e,t){var n=sg(e,t);return ag(n)?n:void 0},cg=function(){try{var e=ug(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),lg=cg?function(e,t){return cg(e,"toString",{configurable:!0,enumerable:!1,value:Ov(t),writable:!0})}:Mv,hg=Date.now;var fg=function(e){var t=0,n=0;return function(){var r=hg(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(lg);var pg=function(e,t){return fg(Rv(e,t,Mv),e+"")};var dg=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var vg=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var gg=function(e){return e!=e};var mg=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var yg=function(e,t,n){return t==t?mg(e,t,n):vg(e,gg,n)};var _g=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1};var bg=function(e){return function(t){return e(t)}};var xg=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Sg=Array.prototype.splice;var Eg=function(e,t,n,r){var i=r?_g:yg,o=-1,a=t.length,s=e;for(e===t&&(t=xg(t)),n&&(s=dg(e,bg(n)));++o<a;)for(var u=0,c=t[o],l=n?n(c):c;(u=i(s,l,u,r))>-1;)s!==e&&Sg.call(s,u,1),Sg.call(e,u,1);return e};var Ag=pg((function(e,t){return e&&e.length&&t&&t.length?Eg(e,t):e})),Tg=Na.filter,wg=Pr("filter");sr({target:"Array",proto:!0,forced:!wg},{filter:function(e){return Tg(this,e,arguments.length>1?arguments[1]:void 0)}});var Cg=Na.find,kg=!0;"find"in[]&&Array(1).find((function(){kg=!1})),sr({target:"Array",proto:!0,forced:kg},{find:function(e){return Cg(this,e,arguments.length>1?arguments[1]:void 0)}}),Qr("find");var Mg=Ze(Ge.f),Pg=Ze([].push),Ig=Fe&&De((function(){var e=Object.create(null);return e[2]=2,!Mg(e,2)})),Rg=function(e){return function(t){for(var n,r=it(t),i=Dr(r),o=Ig&&null===ri(r),a=i.length,s=0,u=[];a>s;)n=i[s++],Fe&&!(o?n in r:Mg(r,n))||Pg(u,e?[n,r[n]]:r[n]);return u}},Og={entries:Rg(!0),values:Rg(!1)},Lg=Og.entries;sr({target:"Object",stat:!0},{entries:function(e){return Lg(e)}});var Ng=Gt("match"),Dg=function(e){var t;return st(e)&&(void 0!==(t=e[Ng])?!!t:"RegExp"===Qe(e))},Fg=un.f,zg=function(e,t,n){n in e||Fg(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},Bg=Zn.f,jg=kn.enforce,Ug=Gt("match"),Vg=Ne.RegExp,Gg=Vg.prototype,Hg=Ne.SyntaxError,Wg=Ze(Gg.exec),Yg=Ze("".charAt),Xg=Ze("".replace),Zg=Ze("".indexOf),qg=Ze("".slice),Kg=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Qg=/a/g,$g=/a/g,Jg=new Vg(Qg)!==Qg,em=Io.MISSED_STICKY,tm=Io.UNSUPPORTED_Y,nm=Fe&&(!Jg||em||Oo||No||De((function(){return $g[Ug]=!1,Vg(Qg)!==Qg||Vg($g)===$g||"/a/i"!==String(Vg(Qg,"i"))})));if(or("RegExp",nm)){for(var rm=function(e,t){var n,r,i,o,a,s,u=lt(Gg,this),c=Dg(e),l=void 0===t,h=[],f=e;if(!u&&c&&l&&e.constructor===rm)return e;if((c||lt(Gg,e))&&(e=e.source,l&&(t=ku(f))),e=void 0===e?"":wo(e),t=void 0===t?"":wo(t),f=e,Oo&&"dotAll"in Qg&&(r=!!t&&Zg(t,"s")>-1)&&(t=Xg(t,/s/g,"")),n=t,em&&"sticky"in Qg&&(i=!!t&&Zg(t,"y")>-1)&&tm&&(t=Xg(t,/y/g,"")),No&&(e=(o=function(e){for(var t,n=e.length,r=0,i="",o=[],a=Hr(null),s=!1,u=!1,c=0,l="";r<=n;r++){if("\\"===(t=Yg(e,r)))t+=Yg(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:Wg(Kg,qg(e,r+1))&&(r+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||Nt(a,l))throw new Hg("Invalid capture group name");a[l]=!0,o[o.length]=[l,c],u=!1,l="";continue}u?l+=t:i+=t}return[i,o]}(e))[0],h=o[1]),a=po(Vg(e,t),u?this:Gg,rm),(r||i||h.length)&&(s=jg(a),r&&(s.dotAll=!0,s.raw=rm(function(e){for(var t,n=e.length,r=0,i="",o=!1;r<=n;r++)"\\"!==(t=Yg(e,r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+Yg(e,++r);return i}(e),n)),i&&(s.sticky=!0),h.length&&(s.groups=h)),e!==f)try{cn(a,"source",""===f?"(?:)":f)}catch(e){}return a},im=Bg(Vg),om=0;im.length>om;)zg(rm,Vg,im[om++]);Gg.constructor=rm,rm.prototype=Gg,Pn(Ne,"RegExp",rm,{constructor:!0})}yo("RegExp");var am=Io.UNSUPPORTED_Y,sm=Math.min,um=Ze([].push),cm=Ze("".slice),lm=!De((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),hm="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length;ua("split",(function(e,t,n){var r="0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:je(t,this,e,n)}:t;return[function(t,n){var i=rt(this),o=tt(t)?void 0:wt(t,e);return o?je(o,t,i,n):je(r,wo(i),t,n)},function(e,i){var o=rn(this),a=wo(e);if(!hm){var s=n(r,o,a,i,r!==t);if(s.done)return s.value}var u=Ja(o,RegExp),c=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(am?"g":"y"),h=new u(am?"^(?:"+o.source+")":o,l),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===a.length)return null===_a(h,a)?[a]:[];for(var p=0,d=0,v=[];d<a.length;){h.lastIndex=am?0:d;var g,m=_a(h,am?cm(a,d):a);if(null===m||(g=sm(Bn(h.lastIndex+(am?d:0)),a.length))===p)d=la(a,d,c);else{if(um(v,cm(a,p,d)),v.length===f)return v;for(var y=1;y<=m.length-1;y++)if(um(v,m[y]),v.length===f)return v;d=p=g}}return um(v,cm(a,p)),v}]}),hm||!lm,am);var fm,pm="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",dm=Ze("".replace),vm=RegExp("^["+pm+"]+"),gm=RegExp("(^|[^"+pm+"])["+pm+"]+$"),mm=function(e){return function(t){var n=wo(rt(t));return 1&e&&(n=dm(n,vm,"")),2&e&&(n=dm(n,gm,"$1")),n}},ym={start:mm(1),end:mm(2),trim:mm(3)},_m=pn.PROPER,bm=ym.trim;function xm(e){var t=e;return"string"==typeof e&&(t=Ad.document.getElementById(e)),t}function Sm(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Em(e){return Sm(e).split(/\s+/)}function Am(e,t,n){var r=Ad.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function Tm(e){var t=e.parentNode;t&&t.removeChild(e)}function wm(e,t){if(void 0!==e.classList)for(var n=Em(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!km(e,t)){var o=Pm(e);Mm(e,(o?o+" ":"")+t)}}function Cm(e,t){void 0!==e.classList?Em(t).forEach((function(t){e.classList.remove(t)})):Mm(e,Sm((" "+Pm(e)+" ").replace(" "+t+" "," ")))}function km(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Pm(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Mm(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Pm(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}sr({target:"String",proto:!0,forced:(fm="trim",De((function(){return!!pm[fm]()||"âÂá "!=="âÂá "[fm]()||_m&&pm[fm].name!==fm})))},{trim:function(){return bm(this)}});var Im=function(e){var t,n,r=null==Ad||null===(t=Ad.document)||void 0===t||null===(n=t.documentElement)||void 0===n?void 0:n.style;if(!r)return e[0];for(var i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}(["transform","WebkitTransform"]);function Rm(e,t){e.style[Im]=t}function Om(){if("function"==typeof Event)Ad.dispatchEvent(new Event("resize"));else{var e=Ad.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ad,0),Ad.dispatchEvent(e)}}function Lm(){var e,t=Ad.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){return"initial-scale"===E(e.split("="),1)[0]}));return n?1*n.split("=")[1]:1}var Nm=Lm()<1?1:Ad.devicePixelRatio;function Dm(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function Fm(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function zm(e){return Object.entries(e).map((function(e){var t=E(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function Bm(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function jm(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Um(e){e.innerHTML=""}function Vm(e){e.setAttribute("draggable","false")}function Gm(e,t){if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append.apply(e,T(t)):e.append(t)}var Hm,Wm=Object.freeze({__proto__:null,getContainer:xm,trim:Sm,splitWords:Em,create:Am,remove:Tm,addClass:wm,removeClass:Cm,hasClass:km,setClass:Mm,getClass:Pm,empty:function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},setTransform:Rm,triggerResize:Om,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))},getViewPortScale:Lm,DPR:Nm,addStyle:Dm,getStyleList:Fm,removeStyle:function(e,t){var n,r=Fm(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=Fm(t),o=Ag.apply(void 0,[r].concat(T(i)));e.setAttribute("style",o.join(";"))},css2Style:zm,getDiffRect:Bm,setChecked:jm,clearChildren:Um,setUnDraggable:Vm,appendElementType:Gm});function Ym(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function Xm(){return"function"==typeof importScripts}var Zm=Xm()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},qm=null===(Hm=navigator)||void 0===Hm?void 0:Hm.userAgent,Km=!!qm.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Qm=qm.indexOf("Android")>-1||qm.indexOf("Adr")>-1;function $m(){for(var e=qm,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}function Jm(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var ey=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;s(this,e),f(this,"duration",16),f(this,"timestamp",(new Date).getTime()),this.duration=t}),[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}])}(),ty=Ne,ny=Ze(1..valueOf),ry=Zn.f,iy=Jt.f,oy=un.f,ay=ym.trim,sy=Ne.Number,uy=(ty.Number,sy.prototype),cy=Ne.TypeError,ly=Ze("".slice),hy=Ze("".charCodeAt),fy=function(e){var t=Yt(e,"number");return"bigint"==typeof t?t:py(t)},py=function(e){var t,n,r,i,o,a,s,u,c=Yt(e,"number");if(xt(c))throw new cy("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=ay(c),43===(t=hy(c,0))||45===t){if(88===(n=hy(c,2))||120===n)return NaN}else if(48===t){switch(hy(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=ly(c,2)).length,s=0;s<a;s++)if((u=hy(o,s))<48||u>i)return NaN;return parseInt(o,r)}return+c},dy=or("Number",!sy(" 0o1")||!sy("0b1")||sy("+0x1")),vy=function(e){return lt(uy,e)&&De((function(){ny(e)}))},gy=function(e){var t=arguments.length<1?0:sy(fy(e));return vy(this)?po(Object(t),this,gy):t};gy.prototype=uy,dy&&(uy.constructor=gy),sr({global:!0,constructor:!0,wrap:!0,forced:dy},{Number:gy});dy&&function(e,t){for(var n,r=Fe?ry(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)Nt(t,n=r[i])&&!Nt(e,n)&&oy(e,n,iy(t,n))}(ty.Number,sy);var yy=RangeError,_y=function(e){var t=wo(rt(this)),n="",r=Ln(e);if(r<0||r===1/0)throw new yy("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},by=RangeError,xy=String,Sy=Math.floor,Ey=Ze(_y),Ay=Ze("".slice),Ty=Ze(1..toFixed),wy=function(e,t,n){return 0===t?n:t%2==1?wy(e,t-1,n*e):wy(e*e,t/2,n)},Cy=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=Sy(i/1e7)},ky=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=Sy(r/t),r=r%t*1e7},My=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=xy(e[t]);n=""===n?r:n+Ey("0",7-r.length)+r}return n},Py=De((function(){return"0.000"!==Ty(8e-5,3)||"1"!==Ty(.9,0)||"1.25"!==Ty(1.255,2)||"1000000000000000128"!==Ty(0xde0b6b3a7640080,0)}))||!De((function(){Ty({})}));sr({target:"Number",proto:!0,forced:Py},{toFixed:function(e){var t,n,r,i,o=ny(this),a=Ln(e),s=[0,0,0,0,0,0],u="",c="0";if(a<0||a>20)throw new by("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return xy(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*wy(2,69,1))-69)<0?o*wy(2,-t,1):o/wy(2,t,1),n*=4503599627370496,(t=52-t)>0){for(Cy(s,0,n),r=a;r>=7;)Cy(s,1e7,0),r-=7;for(Cy(s,wy(10,r,1),0),r=t-1;r>=23;)ky(s,1<<23),r-=23;ky(s,1<<r),Cy(s,1,1),ky(s,2),c=My(s)}else Cy(s,0,n),Cy(s,1<<-t,0),c=My(s)+Ey("0",a);return c=a>0?u+((i=c.length)<=a?"0."+Ey("0",a-i)+c:Ay(c,0,i-a)+"."+Ay(c,i-a)):u+c}});var Iy={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function Ry(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function Oy(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return Ry({type:"Polygon",coordinates:e},t,n)}function Ly(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Ry({type:"LineString",coordinates:e},t,n)}function Ny(e){return 180*(e%(2*Math.PI))/Math.PI}function Dy(e){return e%360*Math.PI/180}function Fy(e,t){!function(e,t){var n,r,i,o,a,s,u,c,l,h,f=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,c=p?e.features[n].properties:d?e.properties:{},l=p?e.features[n].bbox:d?e.bbox:void 0,h=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,c,l,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,c,l,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,c,l,h))return!1;f++}}(e,(function(e,n,r,i,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Ry(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var c=e.coordinates[u];if(!1===t(Ry({type:a,coordinates:c},r),n,u))return!1}}))}function zy(e){var t=[1/0,1/0,-1/0,-1/0];return function e(t,n,r){if(null!==t)for(var i,o,a,s,u,c,l,h,f=0,p=0,d=t.type,v="FeatureCollection"===d,g="Feature"===d,m=v?t.features.length:1,y=0;y<m;y++){u=(h=!!(l=v?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var _=0;_<u;_++){var b=0,x=0;if(null!==(s=h?l.geometries[_]:l)){c=s.coordinates;var S=s.type;switch(f=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===n(c,p,y,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(!1===n(c[i],p,y,b,x))return!1;p++,"MultiPoint"===S&&b++}"LineString"===S&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-f;o++){if(!1===n(c[i][o],p,y,b,x))return!1;p++}"MultiLineString"===S&&b++,"Polygon"===S&&x++}"Polygon"===S&&b++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(x=0,o=0;o<c[i].length;o++){for(a=0;a<c[i][o].length-f;a++){if(!1===n(c[i][o][a],p,y,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===e(s.geometries[i],n,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function By(e){return"number"==typeof e}zy.default=zy;var jy=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Uy={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",MultiCoor:"u_isMultiCoor",Mvp:"u_Mvp"},Vy=Hi.onFreeze,Gy=Object.freeze,Hy=De((function(){Gy(1)}));sr({target:"Object",stat:!0,forced:Hy,sham:!Gi},{freeze:function(e){return Gy&&st(e)?Gy(Vy(e)):e}});var Wy=Ne.isFinite,Yy=Number.isFinite||function(e){return"number"==typeof e&&Wy(e)};sr({target:"Number",stat:!0},{isFinite:Yy});var Xy="undefined"!=typeof Float32Array?Float32Array:Array,Zy=Math.random;function qy(){var e=new Xy(4);return Xy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ky(e,t,n,r){var i=new Xy(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Qy(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var $y;$y=qy();function Jy(e,t){var n,r,i,o=Qy([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}var e_=Math.log,t_=Math.LN2;function n_(){var e=new Xy(16);return Xy!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r_(e){var t=new Xy(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i_(e,t,n,r,i,o,a,s,u,c,l,h,f,p,d,v){var g=new Xy(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=c,g[10]=l,g[11]=h,g[12]=f,g[13]=p,g[14]=d,g[15]=v,g}function o_(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a_(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,_=n*u-i*a,b=n*c-o*a,x=r*u-i*s,S=r*c-o*s,E=i*c-o*u,A=l*v-h*d,T=l*g-f*d,w=l*m-p*d,C=h*g-f*v,k=h*m-p*v,M=f*m-p*g,P=y*M-_*k+b*C+x*w-S*T+E*A;return P?(P=1/P,e[0]=(s*M-u*k+c*C)*P,e[1]=(i*k-r*M-o*C)*P,e[2]=(v*E-g*S+m*x)*P,e[3]=(f*S-h*E-p*x)*P,e[4]=(u*w-a*M-c*T)*P,e[5]=(n*M-i*w+o*T)*P,e[6]=(g*b-d*E-m*_)*P,e[7]=(l*E-f*b+p*_)*P,e[8]=(a*k-s*w+c*A)*P,e[9]=(r*w-n*k-o*A)*P,e[10]=(d*S-v*b+m*y)*P,e[11]=(h*b-l*S-p*y)*P,e[12]=(s*T-a*C-u*A)*P,e[13]=(n*C-r*T+i*A)*P,e[14]=(v*_-d*x-g*y)*P,e[15]=(l*x-h*_+f*y)*P,e):null}function s_(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],b=n[1],x=n[2],S=n[3];return e[0]=_*r+b*s+x*h+S*v,e[1]=_*i+b*u+x*f+S*g,e[2]=_*o+b*c+x*p+S*m,e[3]=_*a+b*l+x*d+S*y,_=n[4],b=n[5],x=n[6],S=n[7],e[4]=_*r+b*s+x*h+S*v,e[5]=_*i+b*u+x*f+S*g,e[6]=_*o+b*c+x*p+S*m,e[7]=_*a+b*l+x*d+S*y,_=n[8],b=n[9],x=n[10],S=n[11],e[8]=_*r+b*s+x*h+S*v,e[9]=_*i+b*u+x*f+S*g,e[10]=_*o+b*c+x*p+S*m,e[11]=_*a+b*l+x*d+S*y,_=n[12],b=n[13],x=n[14],S=n[15],e[12]=_*r+b*s+x*h+S*v,e[13]=_*i+b*u+x*f+S*g,e[14]=_*o+b*c+x*p+S*m,e[15]=_*a+b*l+x*d+S*y,e}function u_(e,t,n){var r,i,o,a,s,u,c,l,h,f,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=r*v+s*g+h*m+t[12],e[13]=i*v+u*g+f*m+t[13],e[14]=o*v+c*g+p*m+t[14],e[15]=a*v+l*g+d*m+t[15]),e}function c_(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function l_(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function h_(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function f_(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+l*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=c*i-o*r,e[5]=l*i-a*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function p_(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function d_(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,c=o+o,l=r*s,h=r*u,f=r*c,p=i*u,d=i*c,v=o*c,g=a*s,m=a*u,y=a*c;return e[0]=1-(p+v),e[1]=h+y,e[2]=f-m,e[3]=0,e[4]=h-y,e[5]=1-(l+v),e[6]=d+g,e[7]=0,e[8]=f+m,e[9]=d-g,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function v_(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function g_(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}sr({target:"Math",stat:!0},{log2:function(e){return e_(e)/t_}});var m_=g_;function y_(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1,e}var __=y_;function b_(e,t,n,r){var i,o,a,s,u,c,l,h,f,p,d=t[0],v=t[1],g=t[2],m=r[0],y=r[1],_=r[2],b=n[0],x=n[1],S=n[2];return Math.abs(d-b)<1e-6&&Math.abs(v-x)<1e-6&&Math.abs(g-S)<1e-6?o_(e):(l=d-b,h=v-x,f=g-S,i=y*(f*=p=1/Math.hypot(l,h,f))-_*(h*=p),o=_*(l*=p)-m*f,a=m*h-y*l,(p=Math.hypot(i,o,a))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-l*a,c=l*o-h*i,(p=Math.hypot(s,u,c))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(i*d+o*v+a*g),e[13]=-(s*d+u*v+c*g),e[14]=-(l*d+h*v+f*g),e[15]=1,e)}function x_(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function S_(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=t[0],_=t[1],b=t[2],x=t[3],S=t[4],E=t[5],A=t[6],T=t[7],w=t[8],C=t[9],k=t[10],M=t[11],P=t[12],I=t[13],R=t[14],O=t[15];return Math.abs(n-y)<=1e-6*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=1e-6*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=1e-6*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=1e-6*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-E)<=1e-6*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-A)<=1e-6*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-T)<=1e-6*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-w)<=1e-6*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-C)<=1e-6*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-k)<=1e-6*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-M)<=1e-6*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-P)<=1e-6*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(v-I)<=1e-6*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-R)<=1e-6*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-O)<=1e-6*Math.max(1,Math.abs(m),Math.abs(O))}var E_=s_,A_=x_,T_=Object.freeze({__proto__:null,create:n_,clone:r_,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:i_,set:function(e,t,n,r,i,o,a,s,u,c,l,h,f,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e},identity:o_,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:a_,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(f*m-p*g)-h*(u*m-c*g)+v*(u*p-c*f),e[1]=-(r*(f*m-p*g)-h*(i*m-o*g)+v*(i*p-o*f)),e[2]=r*(u*m-c*g)-s*(i*m-o*g)+v*(i*c-o*u),e[3]=-(r*(u*p-c*f)-s*(i*p-o*f)+h*(i*c-o*u)),e[4]=-(a*(f*m-p*g)-l*(u*m-c*g)+d*(u*p-c*f)),e[5]=n*(f*m-p*g)-l*(i*m-o*g)+d*(i*p-o*f),e[6]=-(n*(u*m-c*g)-a*(i*m-o*g)+d*(i*c-o*u)),e[7]=n*(u*p-c*f)-a*(i*p-o*f)+l*(i*c-o*u),e[8]=a*(h*m-p*v)-l*(s*m-c*v)+d*(s*p-c*h),e[9]=-(n*(h*m-p*v)-l*(r*m-o*v)+d*(r*p-o*h)),e[10]=n*(s*m-c*v)-a*(r*m-o*v)+d*(r*c-o*s),e[11]=-(n*(s*p-c*h)-a*(r*p-o*h)+l*(r*c-o*s)),e[12]=-(a*(h*g-f*v)-l*(s*g-u*v)+d*(s*f-u*h)),e[13]=n*(h*g-f*v)-l*(r*g-i*v)+d*(r*f-i*h),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*f-u*h)-a*(r*f-i*h)+l*(r*u-i*s),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*a-n*o)*(h*g-f*v)-(t*s-r*o)*(l*g-f*d)+(t*u-i*o)*(l*v-h*d)+(n*s-r*a)*(c*g-f*p)-(n*u-i*a)*(c*v-h*p)+(r*u-i*s)*(c*d-l*p)},multiply:s_,translate:u_,scale:c_,rotate:function(e,t,n,r){var i,o,a,s,u,c,l,h,f,p,d,v,g,m,y,_,b,x,S,E,A,T,w,C,k=r[0],M=r[1],P=r[2],I=Math.hypot(k,M,P);return I<1e-6?null:(k*=I=1/I,M*=I,P*=I,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],c=t[2],l=t[3],h=t[4],f=t[5],p=t[6],d=t[7],v=t[8],g=t[9],m=t[10],y=t[11],_=k*k*a+o,b=M*k*a+P*i,x=P*k*a-M*i,S=k*M*a-P*i,E=M*M*a+o,A=P*M*a+k*i,T=k*P*a+M*i,w=M*P*a-k*i,C=P*P*a+o,e[0]=s*_+h*b+v*x,e[1]=u*_+f*b+g*x,e[2]=c*_+p*b+m*x,e[3]=l*_+d*b+y*x,e[4]=s*S+h*E+v*A,e[5]=u*S+f*E+g*A,e[6]=c*S+p*E+m*A,e[7]=l*S+d*E+y*A,e[8]=s*T+h*w+v*C,e[9]=u*T+f*w+g*C,e[10]=c*T+p*w+m*C,e[11]=l*T+d*w+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:l_,rotateY:h_,rotateZ:f_,fromTranslation:p_,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<1e-6?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:d_,fromQuat2:function(e,t){var n=new Xy(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+l*r+u*o-c*i)/h,n[1]=2*(u*a+l*i+c*r-s*o)/h,n[2]=2*(c*a+l*o+s*i-u*r)/h):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),n[2]=2*(c*a+l*o+s*i-u*r)),d_(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:v_,getRotation:function(e,t){var n=new Xy(3);v_(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,c=t[4]*r,l=t[5]*i,h=t[6]*o,f=t[8]*r,p=t[9]*i,d=t[10]*o,v=a+l+d,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(f-u)/g,e[2]=(s-c)/g):a>l&&a>d?(g=2*Math.sqrt(1+a-l-d),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(f+u)/g):l>d?(g=2*Math.sqrt(1+l-a-d),e[3]=(f-u)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+d-a-l),e[3]=(s-c)/g,e[0]=(f+u)/g,e[1]=(h+p)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,c=o+o,l=a+a,h=i*u,f=i*c,p=i*l,d=o*c,v=o*l,g=a*l,m=s*u,y=s*c,_=s*l,b=r[0],x=r[1],S=r[2];return e[0]=(1-(d+g))*b,e[1]=(f+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(h+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(p+y)*S,e[9]=(v-m)*S,e[10]=(1-(h+d))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,h=s+s,f=o*c,p=o*l,d=o*h,v=a*l,g=a*h,m=s*h,y=u*c,_=u*l,b=u*h,x=r[0],S=r[1],E=r[2],A=i[0],T=i[1],w=i[2],C=(1-(v+m))*x,k=(p+b)*x,M=(d-_)*x,P=(p-b)*S,I=(1-(f+m))*S,R=(g+y)*S,O=(d+_)*E,L=(g-y)*E,N=(1-(f+v))*E;return e[0]=C,e[1]=k,e[2]=M,e[3]=0,e[4]=P,e[5]=I,e[6]=R,e[7]=0,e[8]=O,e[9]=L,e[10]=N,e[11]=0,e[12]=n[0]+A-(C*A+P*T+O*w),e[13]=n[1]+T-(k*A+I*T+L*w),e[14]=n[2]+w-(M*A+R*T+N*w),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,h=r*s,f=i*a,p=i*s,d=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-h-d,e[1]=l+m,e[2]=f-g,e[3]=0,e[4]=l-m,e[5]=1-c-d,e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},perspectiveNO:g_,perspective:m_,perspectiveZO:function(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e},perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},orthoNO:y_,ortho:__,orthoZO:function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*c,e[15]=1,e},lookAt:b_,targetTo:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],h=o-n[1],f=a-n[2],p=l*l+h*h+f*f;p>0&&(l*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-c*h,v=c*l-s*f,g=s*h-u*l;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=h*g-f*v,e[5]=f*d-l*g,e[6]=l*v-h*d,e[7]=0,e[8]=l,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:x_,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:S_,mul:E_,sub:A_});function w_(){var e=new Xy(2);return Xy!=Float32Array&&(e[0]=0,e[1]=0),e}function C_(e,t){var n=new Xy(2);return n[0]=e,n[1]=t,n}function k_(e,t){return e[0]=t[0],e[1]=t[1],e}function M_(e,t,n){return e[0]=t,e[1]=n,e}function P_(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function I_(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function R_(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function O_(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function L_(e,t){return e[0]*t[0]+e[1]*t[1]}function N_(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}function D_(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}var F_=I_;!function(){var e=w_()}();function z_(){var e=new Xy(3);return Xy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function B_(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function j_(e,t,n){var r=new Xy(3);return r[0]=e,r[1]=t,r[2]=n,r}function U_(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function V_(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function G_(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function H_(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function W_(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Y_(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function X_(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Z_(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function q_(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function K_(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Q_(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function $_(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function J_(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&K_(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}var eb=U_,tb=V_,nb=G_,rb=W_,ib=Y_,ob=B_,ab=X_,sb=function(){var e=z_();return function(t,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),ub=Object.freeze({__proto__:null,create:z_,clone:function(e){var t=new Xy(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:B_,fromValues:j_,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:U_,multiply:V_,divide:G_,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:H_,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:W_,squaredDistance:Y_,squaredLength:X_,negate:Z_,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:q_,dot:K_,cross:Q_,lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e},hermite:function(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e},bezier:function(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,h=3*u*a,f=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*h+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*h+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*h+i[2]*f,e},random:function(e,t){t=t||1;var n=2*Zy()*Math.PI,r=2*Zy()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:$_,transformMat3:function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,p=i*f-o*h,d=o*l-r*f,v=r*h-i*l,g=2*a;return l*=g,h*=g,f*=g,p*=2,d*=2,v*=2,e[0]=s+l+p,e[1]=u+h+d,e[2]=c+f+v,e},rotateX:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},angle:J_,zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))},sub:eb,mul:tb,div:nb,dist:rb,sqrDist:ib,len:ob,sqrLen:ab,forEach:sb});function cb(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var lb=Math.PI,hb=lb/4,fb=lb/180,pb=180/lb;function db(e){return Math.pow(2,e)}function vb(e,t){var n=E(e,2),r=n[0],i=n[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0;cb(Number.isFinite(r)&&Number.isFinite(t)),cb(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var s,u=r*fb,c=i*fb,l=(t*=512)*(u+lb)/(2*lb);if(!0===o){var h=Pb([r,i],a,t);l=h[0],s=h[1]}else s=t*(lb-Math.log(Math.tan(hb+.5*c)))/(2*lb);return[l,s]}function gb(e){var t=db(e);return cb(Number.isFinite(t)),512*t}function mb(e,t,n){var r,i=E(e,2),o=i[0],a=i[1],s=o/(t*=512)*(2*lb)-lb;return r=!0===n?lb-2*a*lb/t:2*(Math.atan(Math.exp(lb-a/t*(2*lb)))-hb),[s*pb,r*pb]}function yb(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.lngLatExtent,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.coordinateSystem,c=e.epsgCode;o=void 0!==o?o:db(r),cb(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(o));var l={},h=512*o,f=Math.cos(t*fb),p=h/(i[2]-i[0]),d=p;u&&u===jy.LNGLAT_OFFSET&&"EPSG:3857"===c&&(d/=f);var v=h/4003e4;if(l.pixelsPerMeter=[v,-v,v],l.metersPerPixel=[1/v,-1/v,1/v],l.pixelsPerDegree=[p,-d,v],l.degreesPerPixel=[1/p,-1/d,1/v],s){var g=fb*Math.tan(t*fb)/f,m=p*g/2,y=h/4003e4*g,_=y/d*v;l.pixelsPerDegree2=[0,-m,y],l.pixelsPerMeter2=[_,0,_]}return l}function _b(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u_(c,c,[0,0,-i]),c_(c,c,[1,1,1/t]),l_(c,c,-n*fb),f_(c,c,r*fb),u&&c_(c,c,[1,-1,1]),a&&u_(c,c,Z_([],a)),c}function bb(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,c=e.farZMultiplier,l=void 0===c?1:c,h=a*fb,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*l}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return m_([],o,a,s,u)}function xb(e,t){var n=E(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return cb(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),Jy(t,[r,i,a,1])}function Sb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=E(e,3),i=r[0],o=r[1],a=r[2];if(cb(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=Jy(t,[i,o,a,1]);return s}var u=Jy(t,[i,o,0,1]),c=Jy(t,[i,o,1,1]),l=u[2],h=c[2],f=l===h?0:((n||0)-l)/(h-l);return N_([],u,c,f)}var Eb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ab(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,c=void 0===u?0:u,l=e.offset,h=void 0===l?[0,0]:l,f=E(r,2),p=E(f[0],2),d=p[0],v=p[1],g=E(f[1],2),m=g[0],y=g[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else cb(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var _=new Tb({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,v]),S=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],A=[t-c.left-c.right-2*Math.abs(h[0]),n-c.top-c.bottom-2*Math.abs(h[1])];cb(A[0]>0&&A[1]>0);var T=A[0]/S[0],w=A[1]/S[1],C=(c.right-c.left)/2/T,k=(c.bottom-c.top)/2/w,M=[(x[0]+b[0])/2+C,(x[1]+b[1])/2+k],P=_.unproject(M),I=_.zoom+Math.log2(Math.abs(Math.min(T,w)));return{longitude:P[0],latitude:P[1],zoom:Math.min(I,s)}}var Tb=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,u=void 0===o?0:o,c=n.longitude,l=void 0===c?0:c,h=n.zoom,f=void 0===h?0:h,p=n.pitch,d=void 0===p?0:p,v=n.bearing,g=void 0===v?0:v,m=n.altitude,y=void 0===m?1.5:m,_=n.nearZMultiplier,b=n.farZMultiplier,x=n.isGeographicCoordinateSystem,S=n.coordinateSystem,E=n.map;s(this,t),r=r||1,i=i||1;var A=db(f);y=Math.max(.75,y);var T=vb([l,u],A,x,E);T[2]=0;var w=bb({width:r,height:i,pitch:d,bearing:g,altitude:y,nearZMultiplier:_||1/i,farZMultiplier:b||1.01}),C=_b({height:i,center:T,pitch:d,bearing:g,altitude:y,flipY:!0});return(e=a(this,t,[{width:r,height:i,viewMatrix:C,projectionMatrix:w}])).latitude=u,e.longitude=l,e.zoom=f,e.pitch=d,e.bearing=g,e.altitude=y,e.scale=A,e.center=T,e.lngLatExtent=x?"degree"===E.getCRS().unit?E.getCRS().extent:E.getCRS().getLngLatExtent():[],e.coordinateSystem=S,e.pixelsPerMeter=yb(e).pixelsPerMeter[2],Object.freeze(e),e}return v(t,e),l(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return vb(e,t,n,r)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return mb(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=Sb(e.pos,this.pixelUnprojectionMatrix),o=P_([],vb(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return mb(P_([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Ab(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}])}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?Eb:i,a=t.projectionMatrix,u=void 0===a?Eb:a;s(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];s_(c,c,this.projectionMatrix),s_(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c_(l,l,[this.width/2,-this.height/2,1]),u_(l,l,[1,-1,0]),s_(l,l,this.viewProjectionMatrix);var h=a_([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!h)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=h,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return l(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&S_(t.projectionMatrix,this.projectionMatrix)&&S_(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=xb(i,this.pixelProjectionMatrix),a=E(o,2),s=a[0],u=a[1],c=r?u:this.height-u;return 2===e.length?[s,c]:[s,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=E(e,3),a=o[0],s=o[1],u=o[2],c=r?s:this.height-s,l=i&&i*this.pixelsPerMeter,h=Sb([a,c,u],this.pixelUnprojectionMatrix,l),f=this.unprojectPosition(h),p=E(f,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=E(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=E(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}])}());function wb(e,t){if(e){var n=E(e||[],2),r=n[0],i=n[1];return t.getCRS().fromWGS84([r,i])}}function Cb(e,t){if(e){var n=E(e||[],2),r=n[0],i=n[1];return t.getCRS().toWGS84([r,i])}}function kb(e,t){if(e){var n=E(e||[],2),r=n[0],i=n[1],o=t.getCRS().toLngLat(r,i);return[o.lng,o.lat]}}function Mb(e){return e.getCRS().getExtent()}function Pb(e,t,n){return Ib(e,t,n)}function Ib(e,t,n,r){var i=[e[0],e[1]],o=e.slice(2);if(!t)return e;var a=t.getZoom(),s=wb(i,t),u=Mb(t),c=n||gb(a),l=u[2]-u[0],h=u[3]-u[1],f=r?wb(r,t):[u[0],u[3]],p=(s[0]-f[0])/l;return i[0]>180&&(p+=1),i[0]<-180&&(p-=1),[p*c,(f[1]-s[1])/h*c].concat(T(o))}function Rb(e,t,n,r){if(!t)return e;var i=t.getZoom(),o=n||gb(i),a=Mb(t),s=a[2]-a[0],u=a[3]-a[1],c=r?wb(r,t):[a[0],a[3]],l=c[1]-e[1]/o*u,h=e[0]/o,f=Cb([h*s+c[0],l],t);return h>1&&(f[0]+=360),h<0&&(f[0]-=360),f}function Ob(e){return!!e}function Lb(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;if(e.getZoom()>12&&t){var n=e.getCRS();return!n||"degrees"!==n.unit&&"degree"!==n.unit&&"EPSG:3857"!==n.epsgCode?jy.METER_OFFSET:jy.LNGLAT_OFFSET}return jy.LNGLAT}function Nb(e){return e?e.getCRS().epsgCode:""}function Db(e,t){var n=Mb(t),r=n[2]-n[0],i=n[3]-n[1];return 512*(Math.max(r,i)/512/Math.pow(2,e))}function Fb(e,t,n){var r=Db(t,n),i=Mb(n),o=E(wb(e,n),2),a=o[0],s=o[1],u=(a-i[0])/r,c=(i[3]-s)/r;return[Math.floor(u),Math.floor(c)]}function zb(e,t,n,r){var i=Db(n,r),o=Mb(r);return Cb([e*i+o[0],o[3]-t*i],r)}var Bb={};function jb(e){Bb.map=e}var Ub=2*Math.PI*6378137/2;function Vb(e,t){var n=E(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return e.lng>r&&e.lng<=o&&e.lat>i&&e.lat<=a}function Gb(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function Hb(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Xb(e,t))[0],i=e[1],o=r*Ub/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Ub/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Wb(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Yb(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Xb(e,t){if(!1===t)return e;var n=Wb(e[0]),r=Yb(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function Zb(e){return Ib(e,Bb.map,256*Math.pow(2,20))}function qb(e,t){var n=85.0511287798,r=Math.PI/180;return t=Math.max(Math.min(n,t),-n),t*=r,[6378137*(e*=r),6378137*(t=Math.log(Math.tan(Math.PI/4+t/2)))]}function Kb(e,t){var n=Math.PI/180;return[e/6378137/n,2*(Math.atan(Math.exp(t/6378137))-Math.PI/4)/n]}function Qb(e,t,n){var r=Dy(t[1]-e[1]),i=Dy(t[0]-e[0]),o=Dy(e[1]),a=Dy(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(e,t){void 0===t&&(t="kilometers");var n=Iy[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function $b(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function Jb(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function ex(e){return[[e[0],e[1]],[e[2],e[3]]]}function tx(e){var t=nx(e,[0,0]);return[e[0]/t,e[1]/t]}function nx(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function rx(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ix(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function ox(e){if(By(e[0]))return e;if(By(e[0][0]))throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨");if(By(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨")}function ax(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var c=e[u],l=e[u+1];c&&l&&(t=Math.max(c,t),n=Math.max(l,n),r=Math.min(c,r),i=Math.min(l,i),o+=c,a+=l,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function sx(e){return zy(function(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}([Ly(e)]))}function ux(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var cx=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function lx(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),px(e,t,s,r||.314,i)}function hx(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function fx(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),c=s+n;return[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]]}function px(e,t,n,r,i){if(i===cx["GAODE2.x"]){var o=qb(e[0],e[1]),a=qb(t[0],t[1]),s=fx(o,a,r),u=[o[0],s[0],a[0]],c=[o[1],s[1],a[1]];return[].concat(T(Kb(hx(u,n),hx(c,n))),[0])}var l=fx(e,t,r),h=[e[0],l[0],t[0]],f=[e[1],l[1],t[1]];return[hx(h,n),hx(f,n),0]}function dx(e,t,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),gx(e,t,a,i)}function vx(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function gx(e,t,n,r){var i=[Dy(e[0]),Dy(e[1])],o=[Dy(t[0]),Dy(t[1])];if("GAODE2.x"===r){var a=function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=nx(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+e[0],o*Math.sin(a)+e[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[vx(s,n),vx(u,n),0]}var c=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(c-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var l=Math.sin((1-n)*c)/Math.sin(c),h=Math.sin(n*c)/Math.sin(c),f=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],g=l*p[1]*p[0]+h*v[1]*v[0],m=l*p[1]*f[0]+h*v[1]*d[0],y=l*f[1]+h*d[1];return[Ny(Math.atan2(m,g)),Ny(Math.atan2(y,Math.sqrt(g*g+m*m)))]}function mx(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function yx(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function _x(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e.id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.mapVersion,a=t.segmentNumber,s=void 0===a?30:a,u=t.autoFit,c=void 0===u||u,l=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=yx(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var c,l,h=n*t,f=0,p=r;f<p.length;f++){var d=p[f];if(d.totalDistance>h){var v=d.p1,g=mx(d.p2,v,(h-d.lastTotalDistance)/d.distance);c=g[0],l=g[1];break}}return{lng:c,lat:l,height:0}}(l,n);var h,f=l[0],p=l[1],d="string"==typeof i?e[i]||0:i;switch(r){case"arc":h=lx;break;case"greatcircle":h=dx;break;default:h=lx}var v=E(h(f,p,n,d,o,s,c),3),g=v[0],m=v[1],y=v[2];return{lng:g,lat:m,height:y}}(e,t);return _(_({},e),n)}))}var bx=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;s(this,e),f(this,"limit",void 0),f(this,"cache",void 0),f(this,"destroy",void 0),f(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}),[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}])}(),xx=[],Sx=Ze(xx.sort),Ex=Ze(xx.push),Ax=De((function(){xx.sort(void 0)})),Tx=De((function(){xx.sort(null)})),Cx=Da("sort"),kx=!De((function(){if(gt)return gt<70;if(!(Ph&&Ph>3)){if(Ih)return!0;if(Oh)return Oh<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)xx.push({k:t+r,v:n})}for(xx.sort((function(e,t){return t.v-e.v})),r=0;r<xx.length;r++)t=xx[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));function Mx(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function Px(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function Ix(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Rx(e){if(0===e.length)throw new Error("mean requires at least one data point");return Ix(e)/e.length}function Ox(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}sr({target:"Array",proto:!0,forced:Ax||!Tx||!Cx||!kx},{sort:function(e){void 0!==e&&Tt(e);var t=Ot(this);if(kx)return void 0===e?Sx(t):Sx(t,e);var n,r,i=[],o=jn(t);for(r=0;r<o;r++)r in t&&Ex(i,t[r]);for(kh(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:wo(t)>wo(n)?1:-1}}(e)),n=jn(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)hl(t,r++);return t}});var Lx={min:Px,max:Mx,mean:Rx,sum:Ix,mode:Ox};function Nx(e,t){return e.map((function(e){return e[t]}))}function Dx(e,t){return Lx[e](t)}var Fx=Object.freeze({__proto__:null,sum:Ix,max:Mx,min:Px,mean:Rx,mode:Ox,statMap:Lx,getColumn:Nx,getSatByColumn:Dx}),zx=Vn.includes,Bx=De((function(){return!Array(1).includes()}));sr({target:"Array",proto:!0,forced:Bx},{includes:function(e){return zx(this,e,arguments.length>1?arguments[1]:void 0)}}),Qr("includes");var jx=TypeError,Ux=function(e){if(Dg(e))throw new jx("The method doesn't accept regular expressions");return e},Vx=Gt("match"),Gx=Ze("".indexOf);function Hx(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return Oy([[a,[i,r],[i,o],[n,o],a]],t.properties,{bbox:e,id:t.id})}sr({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Vx]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Gx(wo(rt(this)),wo(Ux(e)),arguments.length>1?arguments[1]:void 0)}});var Wx=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Yx=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({});function Xx(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function Zx(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:Zx(e)}))}var qx=[-1/0,-1/0,1/0,1/0],Kx=f(f(f({},Wx.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),Wx.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!Xx(e)&&Zx(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),Wx.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&Xx(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&Zx(e)}))})),Qx=function(){};function $x(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}var Jx=function(e,t,n,r){if(!r)return[];var i=E(zb(e,t,n,r),2),o=i[0],a=i[1],s=E(zb(e+1,t+1,n,r),2),u=s[0];return[o,s[1],u,a]};function eS(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,c=e.extent,l=void 0===c?qx:c,h=e.map,f=Math.ceil(t)+u;if(Number.isFinite(a)&&f<a)return[];Number.isFinite(i)&&f>i&&(f=i);for(var p=E(n,4),d=p[0],v=p[1],g=p[2],m=p[3],y=[Math.max(d,l[0]),Math.max(v,l[1]),Math.min(g,l[2]),Math.min(m,l[3])],_=[],b=E(Fb([y[0],y[1]],f,h),2),x=b[0],S=b[1],A=E(Fb([y[2],y[3]],f,h),2),T=A[0],w=A[1],C=x;C<=T;C++)for(var k=w;k<=S;k++)_.push({x:C,y:k,z:f});var M=(T+x)/2,P=(S+w)/2,I=function(e,t){return Math.abs(e-M)+Math.abs(t-P)};return _.sort((function(e,t){return I(e.x,e.y)-I(t.x,t.y)})),_}var tS=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=e;return r&&(a<0?a+=i:a>o&&(a%=i)),{warpX:a,warpY:t}},nS=function(e){function t(e){var n;s(this,t),f(n=a(this,t),"x",void 0),f(n,"y",void 0),f(n,"z",void 0),f(n,"version",void 0),f(n,"warp",void 0),f(n,"tileSize",256),f(n,"isVisible",!1),f(n,"isCurrent",!1),f(n,"isVisibleChange",!1),f(n,"loadedLayers",0),f(n,"isLayerLoaded",!1),f(n,"isLoad",!1),f(n,"isChildLoad",!1),f(n,"parent",null),f(n,"children",[]),f(n,"data",null),f(n,"properties",{}),f(n,"xhrCancel",void 0),f(n,"loadStatus",void 0),f(n,"abortController",void 0),f(n,"loadDataId",0);var r=e.x,i=e.y,o=e.z,u=e.tileSize,c=e.warp,l=void 0===c||c,h=e.map;return n.x=r,n.y=i,n.z=o,n.warp=l||!0,n.tileSize=u,n.map=h,n}return v(t,e),l(t,[{key:"isLoading",get:function(){return this.loadStatus===Yx.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Yx.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Yx.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Yx.Cancelled}},{key:"isDone",get:function(){return[Yx.Loaded,Yx.Cancelled,Yx.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Jx(this.x,this.y,this.z,this.map)}},{key:"bboxPolygon",get:function(){var e=E(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2];return Hx(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(n=o(x().mark((function e(t){var n,r,i,o,a,s,u,c,l,h,f,p,d,v,g,m,y,_;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,o=t.version,this.loadDataId++,a=this.loadDataId,this.isLoading&&this.abortLoad(),this.version=o,this.abortController=new AbortController,this.loadStatus=Yx.Loading,s=null,e.prev=8,c=this.x,l=this.y,h=this.z,f=this.bounds,p=this.tileSize,d=this.warp,v=tS(c,l,h,d),g=v.warpX,m=v.warpY,y=this.abortController.signal,_={x:g,y:m,z:h,bounds:f,tileSize:p,signal:y,warp:d},e.next=15,n(_,this);case 15:s=e.sent,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(8),u=e.t0;case 21:if(a===this.loadDataId){e.next=23;break}return e.abrupt("return");case 23:if(!this.isCancelled||s){e.next=25;break}return e.abrupt("return");case 25:if(!u&&s){e.next=29;break}return this.loadStatus=Yx.Failure,i(u,this),e.abrupt("return");case 29:this.loadStatus=Yx.Loaded,this.data=s,r(this);case 32:case"end":return e.stop()}}),e,this,[[8,18]])}))),function(e){return n.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Yx.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]);var n}(N),rS=function(){return Dv.Date.now()},iS=/\s/;var oS=function(e){for(var t=e.length;t--&&iS.test(e.charAt(t)););return t},aS=/^\s+/;var sS=function(e){return e?e.slice(0,oS(e)+1).replace(aS,""):e};var uS=function(e){return null!=e&&"object"==typeof e};var cS=function(e){return"symbol"==typeof e||uS(e)&&"[object Symbol]"==Yv(e)},lS=/^[-+]0x[0-9a-f]+$/i,hS=/^0b[01]+$/i,fS=/^0o[0-7]+$/i,pS=parseInt;var dS=function(e){if("number"==typeof e)return e;if(cS(e))return NaN;if(Xv(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xv(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=sS(e);var n=hS.test(e);return n||fS.test(e)?pS(e.slice(2),n?2:8):lS.test(e)?NaN:+e},vS=Math.max,gS=Math.min;var mS=function(e,t,n){var r,i,o,a,s,u,c=0,l=!1,h=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,o=i;return r=i=void 0,c=t,a=e.apply(o,n)}function d(e){return c=e,s=setTimeout(g,t),l?p(e):a}function v(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-c>=o}function g(){var e=rS();if(v(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-u);return h?gS(n,o-(e-c)):n}(e))}function m(e){return s=void 0,f&&r?p(e):(r=i=void 0,a)}function y(){var e=rS(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return d(u);if(h)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=dS(t)||0,Xv(n)&&(l=!!n.leading,o=(h="maxWait"in n)?vS(dS(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},y.flush=function(){return void 0===s?a:m(rS())},y};var yS=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Xv(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),mS(e,t,{leading:r,maxWait:t,trailing:i})},_S=function(e,t,n,r){try{return r?t(rn(n)[0],n[1]):t(n)}catch(t){to(e,"throw",t)}},bS=Array,xS=function(e){var t=Ot(e),n=Tr(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Xi(i,r>2?arguments[2]:void 0));var a,s,u,c,l,h,f=$i(t),p=0;if(!f||this===bS&&Ki(f))for(a=jn(t),s=n?new this(a):bS(a);a>p;p++)h=o?i(t[p],p):t[p],hr(s,p,h);else for(s=n?new this:[],l=(c=eo(t,f)).next;!(u=je(l,c)).done;p++)h=o?_S(c,i,[u.value,p],!0):u.value,hr(s,p,h);return s.length=p,s},SS=!fo((function(e){Array.from(e)}));sr({target:"Array",stat:!0,forced:SS},{from:xS});var ES=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),AS=function(e){function t(e){var n;return s(this,t),f(n=a(this,t),"currentZoom",void 0),f(n,"currentTiles",[]),f(n,"options",void 0),f(n,"cacheTiles",new Map),f(n,"lastViewStates",void 0),f(n,"map",void 0),f(n,"throttleUpdate",yS((function(e,t){n.update(e,t)}),16)),f(n,"onTileLoad",(function(e){n.emit(ES.TileLoaded,e),n.updateTileVisible(),n.loadFinished()})),f(n,"onTileError",(function(e,t){n.emit(ES.TileError,{error:e,tile:t}),n.updateTileVisible(),n.loadFinished()})),f(n,"onTileUnload",(function(e){n.emit(ES.TileUnload,e),n.loadFinished()})),n.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:qx,getTileData:Qx,warp:!0,updateStrategy:Wx.Overlap},n.updateOptions(e),n}return v(t,e),l(t,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=_(_(_({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t,n,r){var i=this,o=Math.max(0,Math.ceil(e));if(n&&(this.map=n,this.version=r),!this.lastViewStates||this.lastViewStates.zoom!==o||!function(e,t){return Jb(ex(e),ex(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var a=function(e,t){var n=$b(ex(e),t);return[Math.max(n[0][0],-900),Math.max(n[0][1],-85.0511287798065),Math.min(n[1][0],900),Math.min(n[1][1],85.0511287798065)]}(t,.2);this.lastViewStates={zoom:o,latLonBounds:t,latLonBoundsBuffer:a},this.currentZoom=o;var s=!1,u=this.getTileIndices(o,a).filter((function(e){return i.options.warp||e.x>=0&&e.x<Math.pow(2,o)}));this.emit(ES.TilesLoadStart),this.currentTiles=u.map((function(e){var t,n,r=e.x,o=e.y,a=e.z,u=i.getTile(r,o,a);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(n=u)||void 0===n?void 0:n.isCancelled))&&u.loadData({getData:i.options.getTileData,onLoad:i.onTileLoad,onError:i.onTileError,version:i.version}),u):(u=i.createTile(r,o,a),s=!0,u)})),s&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=h(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=E(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError,version:this.version})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError,version:this.version}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=h(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=$x(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=h(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=h(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=h(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):Kx[t](u);var c=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,c=!0):e.isVisibleChange=!1})),c&&this.emit(ES.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return eS({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i,map:this.map})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(ES.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new nS({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp,map:this.map});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError,version:this.version}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=h(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=E(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=h(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=h(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}])}(L);function TS(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function wS(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=TS(e);return o[Math.abs(n+r)%o.length].replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Jx(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function CS(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,c=void 0===u?"default":u,l=t.format,h=t.service,f=void 0===h?"WMTS":h,p=t.tileMatrixset;return"".concat(e,"&SERVICE=").concat(f,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(c,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(l,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function kS(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var MS="undefined"!=typeof window&&void 0!==window.orientation,PS=function(){function e(e,t){var n=this;this.name=e,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return e.prototype.postMessage=function(e,t){this.workerThread.postMessage({source:"Main thread",type:e,payload:t})},e.prototype.done=function(e){kS(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(e)},e.prototype.error=function(e){kS(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(e)},e}(),IS=new Map;function RS(e){kS(e.source&&!e.url||!e.source&&e.url);var t=IS.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return OS((t=e,"try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"));var t}(e.url),IS.set(e.url,t)),e.source&&(t=OS(e.source),IS.set(e.source,t))),kS(t),t}function OS(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function LS(e,t,n){void 0===t&&(t=!0);var r=n||new Set;if(e){if(NS(e))r.add(e);else if(NS(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(var i in e)LS(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function NS(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var DS=function(){},FS=function(){function e(e){this.terminated=!1,this.loadableURL="";var t=e.name,n=e.source,r=e.url;kS(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=DS,this.onError=function(e){return console.log(e)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return"undefined"!=typeof Worker},e.prototype.destroy=function(){this.onMessage=DS,this.onError=DS,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){t=t||LS(e),this.worker.postMessage(e,t)},e.prototype.getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",e.message&&(t+=e.message+" in "),e.lineno&&(t+=":"+e.lineno+":"+e.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var e=this;this.loadableURL=RS({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e.getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(t){return console.error("worker "+e.name+", message error: "+t)},t},e}(),zS=function(){return(zS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},BS=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},jS=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},US=function(){function e(e){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}return e.prototype.destroy=function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0},e.prototype.setProps=function(e){this.props=zS(zS({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},e.prototype.startJob=function(e,t,n){return void 0===t&&(t=function(e,t,n){return e.done(n)}),void 0===n&&(n=function(e,t){return e.error(t)}),BS(this,void 0,void 0,(function(){var r,i=this;return jS(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},e.prototype.startQueuedJob=function(){return BS(this,void 0,void 0,(function(){var e,t,n;return jS(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(e=this.getAvailableWorker()))return[2];if(!(t=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:e}),n=new PS(t.name,e),e.onMessage=function(e){return t.onMessage(n,e.type,e.payload)},e.onError=function(e){return t.onError(n,e)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(e),[7];case 4:return[2]}}))}))},e.prototype.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var e=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new FS({name:e,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return MS?this.maxMobileConcurrency:this.maxConcurrency},e}(),VS=function(){return(VS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},GS=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},HS={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},WS=function(){function e(e){this.workerPools=new Map,this.props=VS({},HS),this.setProps(e),this.workerPools=new Map}return e.isSupported=function(){return FS.isSupported()},e.getWorkerFarm=function(t){return void 0===t&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var e,t;try{for(var n=GS(this.workerPools.values()),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setProps=function(e){var t,n;this.props=VS(VS({},this.props),e);try{for(var r=GS(this.workerPools.values()),i=r.next();!i.done;i=r.next()){i.value.setProps(this.getWorkerPoolProps())}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new US({name:t,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(t,i)),i},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),YS=new Map,XS=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(e){self.onmessage=function(t){if(ZS(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(e){var t=YS.get(e);t||(t=function(t){if(ZS(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}),self.addEventListener("message",t)},e.removeEventListener=function(e){var t=YS.get(e);YS.delete(e),self.removeEventListener("message",t)},e.postMessage=function(e,t){if(self){var n={source:"Worker thread",type:e,payload:t},r=LS(t);self.postMessage(n,r)}},e}();function ZS(e){var t=e.type,n=e.data;return"message"===t&&n&&"string"==typeof n.source&&"Main thread"===n.source}var qS,KS,QS=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(e){return this.enqueue(e)},e.prototype.enqueue=function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)},e.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,n){e._settlers.push({resolve:t,reject:n})}))},e}(),$S=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},JS=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},eE=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},tE=0;function nE(e,t){return void 0===t&&(t={}),new Promise((function(n,r){var i=tE++,o=function(e,t){if(t.id===i)switch(e){case"done":XS.removeEventListener(o),n(t.result);break;case"error":XS.removeEventListener(o),r(t.error)}};XS.addEventListener(o);var a={id:i,input:e,options:t};XS.postMessage("process",a)}))}function rE(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}function iE(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function oE(e){return e.filter?[1]:[0]}function aE(e,t){return[t]}var sE=cE,uE=cE;function cE(e,t,n){n=n||2;var r,i,o,a,s,u,c,l=t&&t.length,h=l?t[0]*n:e.length,f=lE(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(l&&(f=function(e,t,n,r){var i,o,a,s,u,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=lE(e,a,s,r,!1))===u.next&&(u.steiner=!0),c.push(xE(u));for(c.sort(mE),i=0;i<c.length;i++)n=yE(c[i],n);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?32767/c:0}return fE(f,p,n,r,i,c,0),p}function lE(e,t,n,r,i){var o,a;if(i===LE(e,t,n,r)>0)for(o=t;o<n;o+=r)a=IE(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=IE(o,e[o],e[o+1],a);return a&&TE(a,a.next)&&(RE(a),a=a.next),a}function hE(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!TE(r,r.next)&&0!==AE(r.prev,r,r.next))r=r.next;else{if(RE(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function fE(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=bE(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?dE(e,r,i,o):pE(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),RE(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?fE(e=vE(hE(e),t,n),t,n,r,i,o,2):2===a&&gE(e,t,n,r,i,o):fE(hE(e),t,n,r,i,o,1);break}}}function pE(e){var t=e.prev,n=e,r=e.next;if(AE(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,c=r.y,l=i<o?i<a?i:a:o<a?o:a,h=s<u?s<c?s:c:u<c?u:c,f=i>o?i>a?i:a:o>a?o:a,p=s>u?s>c?s:c:u>c?u:c,d=r.next;d!==t;){if(d.x>=l&&d.x<=f&&d.y>=h&&d.y<=p&&SE(i,s,o,u,a,c,d.x,d.y)&&AE(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function dE(e,t,n,r){var i=e.prev,o=e,a=e.next;if(AE(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,c=a.x,l=i.y,h=o.y,f=a.y,p=s<u?s<c?s:c:u<c?u:c,d=l<h?l<f?l:f:h<f?h:f,v=s>u?s>c?s:c:u>c?u:c,g=l>h?l>f?l:f:h>f?h:f,m=bE(p,d,t,n,r),y=bE(v,g,t,n,r),_=e.prevZ,b=e.nextZ;_&&_.z>=m&&b&&b.z<=y;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&SE(s,l,u,h,c,f,_.x,_.y)&&AE(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&SE(s,l,u,h,c,f,b.x,b.y)&&AE(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=m;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&SE(s,l,u,h,c,f,_.x,_.y)&&AE(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&SE(s,l,u,h,c,f,b.x,b.y)&&AE(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function vE(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!TE(i,o)&&wE(i,r,r.next,o)&&ME(i,o)&&ME(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),RE(r),RE(r.next),r=e=o),r=r.next}while(r!==e);return hE(r)}function gE(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&EE(a,s)){var u=PE(a,s);return a=hE(a,a.next),u=hE(u,u.next),fE(a,t,n,r,i,o,0),void fE(u,t,n,r,i,o,0)}s=s.next}a=a.next}while(a!==e)}function mE(e,t){return e.x-t.x}function yE(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&SE(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),ME(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&_E(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var r=PE(n,e);return hE(r,r.next),hE(n,n.next)}function _E(e,t){return AE(e.prev,e,t.prev)<0&&AE(t.next,e,e.next)<0}function bE(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xE(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function SE(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function EE(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&wE(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(ME(e,t)&&ME(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(AE(e.prev,e,t.prev)||AE(e,t.prev,t))||TE(e,t)&&AE(e.prev,e,e.next)>0&&AE(t.prev,t,t.next)>0)}function AE(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function TE(e,t){return e.x===t.x&&e.y===t.y}function wE(e,t,n,r){var i=kE(AE(e,t,n)),o=kE(AE(e,t,r)),a=kE(AE(n,r,e)),s=kE(AE(n,r,t));return i!==o&&a!==s||(!(0!==i||!CE(e,n,t))||(!(0!==o||!CE(e,r,t))||(!(0!==a||!CE(n,e,r))||!(0!==s||!CE(n,t,r)))))}function CE(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function kE(e){return e>0?1:e<0?-1:0}function ME(e,t){return AE(e.prev,e,e.next)<0?AE(e,t,e.next)>=0&&AE(e,e.prev,t)>=0:AE(e,t,e.prev)<0||AE(e,e.next,t)<0}function PE(e,t){var n=new OE(e.i,e.x,e.y),r=new OE(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function IE(e,t,n,r){var i=new OE(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function RE(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function OE(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function LE(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}cE.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(LE(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(LE(e,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[d+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},cE.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},sE.default=uE;var NE=/"/g,DE=Ze("".replace),FE=function(e,t,n,r){var i=wo(rt(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+DE(wo(r),NE,"&quot;")+'"'),o+">"+i+"</"+t+">"},zE=function(e){return De((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};function BE(){var e=new Xy(4);return Xy!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function jE(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u,e}sr({target:"String",proto:!0,forced:zE("sub")},{sub:function(){return FE(this,"sub","","")}});var UE=w_(),VE=(w_(),w_()),GE=w_(),HE=w_();function WE(e,t,n,r,i){return P_(e,n,r),O_(e,e),[i/L_(t=C_(-e[1],e[0]),C_(-n[1],n[0])),t]}function YE(e,t){return M_(e,-t[1],t[0])}function XE(e,t,n){return F_(e,t,n),O_(e,e),e}function ZE(e,t){return e[0]===t[0]&&e[1]===t[1]}var qE=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),f(this,"complex",void 0),f(this,"join",void 0),f(this,"cap",void 0),f(this,"miterLimit",void 0),f(this,"thickness",void 0),f(this,"normal",void 0),f(this,"lastFlip",-1),f(this,"miter",C_(0,0)),f(this,"started",!1),f(this,"dash",!1),f(this,"totalDistance",0),f(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}),[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(T(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(T(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,c=e.indices,l=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=Zb([a[0],a[1]]),v=Zb([o[0],o[1]]);XE(VE,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=w_(),YE(this.normal,VE)),!this.started)if(this.started=!0,f){var m=w_(),y=w_();P_(m,this.normal,VE),P_(y,this.normal,VE),h.push(y[0],y[1],0),h.push(m[0],m[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-g);if(c.push(t+0,t+1,t+2),i){ZE(r,i)&&P_(i,r,O_(i,I_(i,r,n))),XE(GE,i,r);var _=E(WE(HE,w_(),VE,GE,this.thickness),2),b=_[0],x=_[1],S=L_(HE,this.normal)<0?-1:1,A=p;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,T(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),c.push(t+2,t+3,t+4),YE(UE,GE),k_(this.normal,UE),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,x,b,this.totalDistance),c.push.apply(c,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,k_(this.normal,x),u+=2),this.lastFlip=S}else{if(YE(this.normal,VE),f){var w=w_(),C=w_();F_(C,VE,this.normal),P_(w,VE,this.normal),h.push(C[0],C[1],0),h.push(w[0],w[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c=Zb([r[0],r[1]]),l=Zb([n[0],n[1]]);XE(VE,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=w_(),YE(this.normal,VE)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=Zb([i[0],i[1]]);ZE(c,f)&&P_(f,c,O_(f,I_(f,c,l))),XE(GE,f,c);var p=E(WE(HE,w_(),VE,GE,this.thickness),2),d=p[0],v=p[1];L_(HE,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,k_(this.normal,v),o+=2,this.lastFlip=-1}else YE(this.normal,VE),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c="square"===this.cap,l="bevel"===this.join,h=Zb([r[0],r[1]]),f=Zb([n[0],n[1]]);XE(VE,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=w_(),YE(this.normal,VE)),!this.started)if(this.started=!0,c){var d=w_(),v=w_();P_(d,this.normal,VE),P_(v,this.normal,VE),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=Zb([i[0],i[1]]);ZE(h,g)&&P_(g,h,O_(g,I_(g,h,f))),XE(GE,g,h);var m=E(WE(HE,w_(),VE,GE,this.thickness),2),y=m[0],_=m[1],b=L_(HE,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,T(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),YE(UE,GE),k_(this.normal,UE),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,k_(this.normal,_),o+=2),this.lastFlip=b}else{if(YE(this.normal,VE),c){var S=w_(),A=w_();F_(A,VE,this.normal),P_(S,VE,this.normal),u.push(A[0],A[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}])}();function KE(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new qE({dash:!0,join:"bevel"});if("GAODE2.x"===r||"MAPBOX"===r||"MAPLIBRE"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=t;l[0]&&!Array.isArray(l[0][0])&&(l=[t]),l.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function QE(e){var t=ox(e.coordinates);return{vertices:[].concat(T(t),T(t),T(t),T(t)),indices:[0,1,2,2,3,0],size:t.length}}function $E(e){var t=e.coordinates,n=sE.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:sE(r,o,i),vertices:r,size:i}}var JE=function(){var e=o(x().mark((function e(t){var n,r,i,o,a,s,u,c,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.iconMap,a={a_Color:rE,a_Position:iE,filter:oE,a_vertexId:aE,a_PickingColor:function(e){var t=e.id;return i?yv(t):[0,0,0]},a_DistanceAndIndex:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(e,t,n){return[n[5]]},a_Size:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(e,t,n,r,i){return i},a_Miter:function(e,t,n){return[n[4]]},a_iconMapUV:function(e){var t=e.texture,n=o[t]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(e,t){var r=KE(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){c.push(e+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,T(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),eA={pointFill:function(){var e=o(x().mark((function e(t){var n,r,i,o,a,s,u,c,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.shape2d,a={a_Color:rE,a_Position:iE,filter:oE,a_vertexId:aE,a_PickingColor:function(e){var t=e.id;return i?yv(t):[0,0,0]},a_Shape:function(e){var t=e.shape,n=void 0===t?2:t;return[o.indexOf(n)]},a_Extrude:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(e,t){var r=QE(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){c.push(e+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,T(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),line:JE,polygonFill:function(){var e=o(x().mark((function e(t){var n,r,i,o,a,s,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o={a_Color:rE,a_Position:iE,filter:oE,a_vertexId:aE,a_PickingColor:function(e){var t=e.id;return i?yv(t):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],c=3,r.forEach((function(e,t){var r=$E(e),i=r.indices,l=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){u.push(e+s)})),c=f;var d=l.length/f;a.sizePerElement=c,a.elements.push({featureIdx:t,vertices:l,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],a=l.slice(r*f,r*f+f),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,T(o[n.name](e,t,a,r,i,s)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},tA=_({},eA);function nA(){return(nA=o(x().mark((function e(t){var n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.workerType,r=t.data,!tA[n]){e.next=3;break}return e.abrupt("return",tA[n](r));case 3:return e.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e,t){var n=this;if("undefined"!=typeof self){var r={process:nE};XS.onmessage=function(i,o){return $S(n,void 0,void 0,(function(){var n,a,s,u,c,l,h,f,p,d;return JS(this,(function(v){switch(v.label){case 0:switch(v.trys.push([0,19,,20]),i){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},r)];case 2:return n=v.sent(),XS.postMessage("done",{result:n}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");qS=new QS,KS=o.options||{},a=t(qS,KS,r),v.label=4;case 4:v.trys.push([4,9,10,15]),s=eE(a),v.label=5;case 5:return[4,s.next()];case 6:if((u=v.sent()).done)return[3,8];c=u.value,XS.postMessage("output-batch",{result:c}),v.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return l=v.sent(),p={error:l},[3,15];case 10:return v.trys.push([10,,13,14]),u&&!u.done&&(d=s.return)?[4,d.call(s)]:[3,12];case 11:v.sent(),v.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return XS.postMessage("done",{}),[3,18];case 16:return qS.push(o.input),[3,18];case 17:return qS.close(),[3,18];case 18:return[3,20];case 19:return h=v.sent(),f=h instanceof Error?h.message:"",XS.postMessage("error",{error:f}),[3,20];case 20:return[2]}}))}))}}}((function(e){return nA.apply(this,arguments)}));var rA=new Map;function iA(e){!function(e,t){rA.set(e,t)}("l7-worker",e)}function oA(){var e,t=(e="l7-worker",rA.get(e));if(!t)throw new Error("get worker failed by workerName: ".concat("l7-worker","."));return t}function aA(){return(aA=o(x().mark((function e(t,n){var r,i,o,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=oA(),i=WS.getWorkerFarm({maxConcurrency:3,reuseWorkers:!0}),o=i.getWorkerPool({name:"l7-worker",source:r}),e.next=5,o.startJob("l7-worker",(function(e,t,n){return e.done(n)}));case 5:return(a=e.sent).postMessage("process",{input:{workerType:t,data:n}}),e.next=9,a.result;case 9:return s=e.sent,e.abrupt("return",s.result);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}iA('var L7=function(t){"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function r(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function u(t){r(a,o,i,u,s,"next",t)}function s(t){r(a,o,i,u,s,"throw",t)}u(void 0)}))}}function o(t,e,r){return e=c(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,r||[],c(t).constructor):e.apply(t,r))}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=y(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(){h=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",v="executing",d="completed",y={};function g(){}function m(){}function b(){}var x={};c(x,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(_([])));E&&E!==r&&n.call(E,a)&&(x=E);var A=b.prototype=g.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=p;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var s=k(u,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?d:"suspendedYield",c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=d,n.method="throw",n.arg=c.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a \'"+n+"\' method")),y;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(typeof e+" is not iterable")}return m.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=c(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,s,"GeneratorFunction")),t.prototype=Object.create(A),t},e.awrap=function(t){return{__await:t}},O(S.prototype),c(S.prototype,u,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(A),c(A,s,"Generator"),c(A,a,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function p(t,e){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function g(t,r){if(t){if("string"==typeof t)return e(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}var m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var x,w,E=function(t){return t&&t.Math===Math&&t},A=E("object"==typeof globalThis&&globalThis)||E("object"==typeof window&&window)||E("object"==typeof self&&self)||E("object"==typeof m&&m)||E("object"==typeof m&&m)||function(){return this}()||Function("return this")(),O=Object.defineProperty,S=function(t,e){try{O(A,t,{value:e,configurable:!0,writable:!0})}catch(r){A[t]=e}return e},T=b((function(t){var e=t.exports=A["__core-js_shared__"]||S("__core-js_shared__",{});(e.versions||(e.versions=[])).push({version:"3.37.1",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),k=function(t,e){return T[t]||(T[t]=e||{})},I=function(t){try{return!!t()}catch(t){return!0}},j=!I((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),P=Function.prototype,_=P.call,M=j&&P.bind.bind(_,_),L=j?M:function(t){return function(){return _.apply(t,arguments)}},R=function(t){return null==t},N=TypeError,C=function(t){if(R(t))throw new N("Can\'t call method on "+t);return t},D=Object,F=function(t){return D(C(t))},W=L({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return W(F(t),e)},z=0,U=Math.random(),G=L(1..toString),V=function(t){return"Symbol("+(void 0===t?"":t)+")_"+G(++z+U,36)},q="undefined"!=typeof navigator&&String(navigator.userAgent)||"",H=A.process,Z=A.Deno,Y=H&&H.versions||Z&&Z.version,$=Y&&Y.v8;$&&(w=(x=$.split("."))[0]>0&&x[0]<4?1:+(x[0]+x[1])),!w&&q&&(!(x=q.match(/Edge\\/(\\d+)/))||x[1]>=74)&&(x=q.match(/Chrome\\/(\\d+)/))&&(w=+x[1]);var K=w,Q=A.String,X=!!Object.getOwnPropertySymbols&&!I((function(){var t=Symbol("symbol detection");return!Q(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&K&&K<41})),J=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,tt=A.Symbol,et=k("wks"),rt=J?tt.for||tt:tt&&tt.withoutSetter||V,nt=function(t){return B(et,t)||(et[t]=X&&B(tt,t)?tt[t]:rt("Symbol."+t)),et[t]},ot={};ot[nt("toStringTag")]="z";var it="[object z]"===String(ot),at="object"==typeof document&&document.all,ut=void 0===at&&void 0!==at?function(t){return"function"==typeof t||t===at}:function(t){return"function"==typeof t},st=!I((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),ct=function(t){return"object"==typeof t?null!==t:ut(t)},ft=A.document,lt=ct(ft)&&ct(ft.createElement),ht=function(t){return lt?ft.createElement(t):{}},pt=!st&&!I((function(){return 7!==Object.defineProperty(ht("div"),"a",{get:function(){return 7}}).a})),vt=st&&I((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),dt=String,yt=TypeError,gt=function(t){if(ct(t))return t;throw new yt(dt(t)+" is not an object")},mt=Function.prototype.call,bt=j?mt.bind(mt):function(){return mt.apply(mt,arguments)},xt=function(t){return ut(t)?t:void 0},wt=function(t,e){return arguments.length<2?xt(A[t]):A[t]&&A[t][e]},Et=L({}.isPrototypeOf),At=Object,Ot=J?function(t){return"symbol"==typeof t}:function(t){var e=wt("Symbol");return ut(e)&&Et(e.prototype,At(t))},St=String,Tt=function(t){try{return St(t)}catch(t){return"Object"}},kt=TypeError,It=function(t){if(ut(t))return t;throw new kt(Tt(t)+" is not a function")},jt=function(t,e){var r=t[e];return R(r)?void 0:It(r)},Pt=TypeError,_t=TypeError,Mt=nt("toPrimitive"),Lt=function(t,e){if(!ct(t)||Ot(t))return t;var r,n=jt(t,Mt);if(n){if(void 0===e&&(e="default"),r=bt(n,t,e),!ct(r)||Ot(r))return r;throw new _t("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&ut(r=t.toString)&&!ct(n=bt(r,t)))return n;if(ut(r=t.valueOf)&&!ct(n=bt(r,t)))return n;if("string"!==e&&ut(r=t.toString)&&!ct(n=bt(r,t)))return n;throw new Pt("Can\'t convert object to primitive value")}(t,e)},Rt=function(t){var e=Lt(t,"string");return Ot(e)?e:e+""},Nt=TypeError,Ct=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,Ft={f:st?vt?function(t,e,r){if(gt(t),e=Rt(e),gt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Dt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ct(t,e,r)}:Ct:function(t,e,r){if(gt(t),e=Rt(e),gt(r),pt)try{return Ct(t,e,r)}catch(t){}if("get"in r||"set"in r)throw new Nt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Wt=Function.prototype,Bt=st&&Object.getOwnPropertyDescriptor,zt=B(Wt,"name"),Ut={EXISTS:zt,PROPER:zt&&"something"===function(){}.name,CONFIGURABLE:zt&&(!st||st&&Bt(Wt,"name").configurable)},Gt=L(Function.toString);ut(T.inspectSource)||(T.inspectSource=function(t){return Gt(t)});var Vt,qt,Ht,Zt=T.inspectSource,Yt=A.WeakMap,$t=ut(Yt)&&/native code/.test(String(Yt)),Kt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Qt=st?function(t,e,r){return Ft.f(t,e,Kt(1,r))}:function(t,e,r){return t[e]=r,t},Xt=k("keys"),Jt=function(t){return Xt[t]||(Xt[t]=V(t))},te={},ee=A.TypeError,re=A.WeakMap;if($t||T.state){var ne=T.state||(T.state=new re);ne.get=ne.get,ne.has=ne.has,ne.set=ne.set,Vt=function(t,e){if(ne.has(t))throw new ee("Object already initialized");return e.facade=t,ne.set(t,e),e},qt=function(t){return ne.get(t)||{}},Ht=function(t){return ne.has(t)}}else{var oe=Jt("state");te[oe]=!0,Vt=function(t,e){if(B(t,oe))throw new ee("Object already initialized");return e.facade=t,Qt(t,oe,e),e},qt=function(t){return B(t,oe)?t[oe]:{}},Ht=function(t){return B(t,oe)}}var ie={set:Vt,get:qt,has:Ht,enforce:function(t){return Ht(t)?qt(t):Vt(t,{})},getterFor:function(t){return function(e){var r;if(!ct(e)||(r=qt(e)).type!==t)throw new ee("Incompatible receiver, "+t+" required");return r}}},ae=b((function(t){var e=Ut.CONFIGURABLE,r=ie.enforce,n=ie.get,o=String,i=Object.defineProperty,a=L("".slice),u=L("".replace),s=L([].join),c=st&&!I((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\).*$/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(st?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&B(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&B(l,"constructor")&&l.constructor?st&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return B(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return ut(this)&&n(this).source||Zt(this)}),"toString")})),ue=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(ut(r)&&ae(r,i,n),n.global)o?t[e]=r:S(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ft.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},se=L({}.toString),ce=L("".slice),fe=function(t){return ce(se(t),8,-1)},le=nt("toStringTag"),he=Object,pe="Arguments"===fe(function(){return arguments}()),ve=it?fe:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=he(t),le))?r:pe?fe(e):"Object"===(n=fe(e))&&ut(e.callee)?"Arguments":n},de=it?{}.toString:function(){return"[object "+ve(this)+"]"};it||ue(Object.prototype,"toString",de,{unsafe:!0});var ye={}.propertyIsEnumerable,ge=Object.getOwnPropertyDescriptor,me={f:ge&&!ye.call({1:2},1)?function(t){var e=ge(this,t);return!!e&&e.enumerable}:ye},be=Object,xe=L("".split),we=I((function(){return!be("z").propertyIsEnumerable(0)}))?function(t){return"String"===fe(t)?xe(t,""):be(t)}:be,Ee=function(t){return we(C(t))},Ae=Object.getOwnPropertyDescriptor,Oe={f:st?Ae:function(t,e){if(t=Ee(t),e=Rt(e),pt)try{return Ae(t,e)}catch(t){}if(B(t,e))return Kt(!bt(me.f,t,e),t[e])}},Se=Math.ceil,Te=Math.floor,ke=Math.trunc||function(t){var e=+t;return(e>0?Te:Se)(e)},Ie=function(t){var e=+t;return e!=e||0===e?0:ke(e)},je=Math.max,Pe=Math.min,_e=function(t,e){var r=Ie(t);return r<0?je(r+e,0):Pe(r,e)},Me=Math.min,Le=function(t){var e=Ie(t);return e>0?Me(e,9007199254740991):0},Re=function(t){return Le(t.length)},Ne=function(t){return function(e,r,n){var o=Ee(e),i=Re(o);if(0===i)return!t&&-1;var a,u=_e(n,i);if(t&&r!=r){for(;i>u;)if((a=o[u++])!=a)return!0}else for(;i>u;u++)if((t||u in o)&&o[u]===r)return t||u||0;return!t&&-1}},Ce={includes:Ne(!0),indexOf:Ne(!1)},De=Ce.indexOf,Fe=L([].push),We=function(t,e){var r,n=Ee(t),o=0,i=[];for(r in n)!B(te,r)&&B(n,r)&&Fe(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~De(i,r)||Fe(i,r));return i},Be=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ze=Be.concat("length","prototype"),Ue={f:Object.getOwnPropertyNames||function(t){return We(t,ze)}},Ge={f:Object.getOwnPropertySymbols},Ve=L([].concat),qe=wt("Reflect","ownKeys")||function(t){var e=Ue.f(gt(t)),r=Ge.f;return r?Ve(e,r(t)):e},He=function(t,e,r){for(var n=qe(e),o=Ft.f,i=Oe.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Ze=/#|\\.prototype\\./,Ye=function(t,e){var r=Ke[$e(t)];return r===Xe||r!==Qe&&(ut(e)?I(e):!!e)},$e=Ye.normalize=function(t){return String(t).replace(Ze,".").toLowerCase()},Ke=Ye.data={},Qe=Ye.NATIVE="N",Xe=Ye.POLYFILL="P",Je=Ye,tr=Oe.f,er=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?A:c?A[u]||S(u,{}):A[u]&&A[u].prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=tr(r,n))&&a.value:r[n],!Je(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;He(i,o)}(t.sham||o&&o.sham)&&Qt(i,"sham",!0),ue(r,n,i,t)}},rr="process"===fe(A.process),nr=String,or=TypeError,ir=function(t){if(function(t){return ct(t)||null===t}(t))return t;throw new or("Can\'t set "+nr(t)+" as a prototype")},ar=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return L(It(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return C(r),ir(n),ct(r)?(e?t(r,n):r.__proto__=n,r):r}}():void 0),ur=Ft.f,sr=nt("toStringTag"),cr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,sr)&&ur(t,sr,{configurable:!0,value:e})},fr=function(t,e,r){return r.get&&ae(r.get,e,{getter:!0}),r.set&&ae(r.set,e,{setter:!0}),Ft.f(t,e,r)},lr=nt("species"),hr=function(t){var e=wt(t);st&&e&&!e[lr]&&fr(e,lr,{configurable:!0,get:function(){return this}})},pr=TypeError,vr=function(t,e){if(Et(e,t))return t;throw new pr("Incorrect invocation")},dr=function(){},yr=wt("Reflect","construct"),gr=/^\\s*(?:class|function)\\b/,mr=L(gr.exec),br=!gr.test(dr),xr=function(t){if(!ut(t))return!1;try{return yr(dr,[],t),!0}catch(t){return!1}},wr=function(t){if(!ut(t))return!1;switch(ve(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return br||!!mr(gr,Zt(t))}catch(t){return!0}};wr.sham=!0;var Er,Ar,Or,Sr,Tr=!yr||I((function(){var t;return xr(xr.call)||!xr(Object)||!xr((function(){t=!0}))||t}))?wr:xr,kr=TypeError,Ir=function(t){if(Tr(t))return t;throw new kr(Tt(t)+" is not a constructor")},jr=nt("species"),Pr=function(t,e){var r,n=gt(t).constructor;return void 0===n||R(r=gt(n)[jr])?e:Ir(r)},_r=Function.prototype,Mr=_r.apply,Lr=_r.call,Rr="object"==typeof Reflect&&Reflect.apply||(j?Lr.bind(Mr):function(){return Lr.apply(Mr,arguments)}),Nr=function(t){if("Function"===fe(t))return L(t)},Cr=Nr(Nr.bind),Dr=function(t,e){return It(t),void 0===e?t:j?Cr(t,e):function(){return t.apply(e,arguments)}},Fr=wt("document","documentElement"),Wr=L([].slice),Br=TypeError,zr=function(t,e){if(t<e)throw new Br("Not enough arguments");return t},Ur=/(?:ipad|iphone|ipod).*applewebkit/i.test(q),Gr=A.setImmediate,Vr=A.clearImmediate,qr=A.process,Hr=A.Dispatch,Zr=A.Function,Yr=A.MessageChannel,$r=A.String,Kr=0,Qr={};I((function(){Er=A.location}));var Xr=function(t){if(B(Qr,t)){var e=Qr[t];delete Qr[t],e()}},Jr=function(t){return function(){Xr(t)}},tn=function(t){Xr(t.data)},en=function(t){A.postMessage($r(t),Er.protocol+"//"+Er.host)};Gr&&Vr||(Gr=function(t){zr(arguments.length,1);var e=ut(t)?t:Zr(t),r=Wr(arguments,1);return Qr[++Kr]=function(){Rr(e,void 0,r)},Ar(Kr),Kr},Vr=function(t){delete Qr[t]},rr?Ar=function(t){qr.nextTick(Jr(t))}:Hr&&Hr.now?Ar=function(t){Hr.now(Jr(t))}:Yr&&!Ur?(Sr=(Or=new Yr).port2,Or.port1.onmessage=tn,Ar=Dr(Sr.postMessage,Sr)):A.addEventListener&&ut(A.postMessage)&&!A.importScripts&&Er&&"file:"!==Er.protocol&&!I(en)?(Ar=en,A.addEventListener("message",tn,!1)):Ar="onreadystatechange"in ht("script")?function(t){Fr.appendChild(ht("script")).onreadystatechange=function(){Fr.removeChild(this),Xr(t)}}:function(t){setTimeout(Jr(t),0)});var rn={set:Gr,clear:Vr},nn=Object.getOwnPropertyDescriptor,on=function(){this.head=null,this.tail=null};on.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var an,un,sn,cn,fn,ln=on,hn=/ipad|iphone|ipod/i.test(q)&&"undefined"!=typeof Pebble,pn=/web0s(?!.*chrome)/i.test(q),vn=rn.set,dn=A.MutationObserver||A.WebKitMutationObserver,yn=A.document,gn=A.process,mn=A.Promise,bn=function(t){if(!st)return A[t];var e=nn(A,t);return e&&e.value}("queueMicrotask");if(!bn){var xn=new ln,wn=function(){var t,e;for(rr&&(t=gn.domain)&&t.exit();e=xn.get();)try{e()}catch(t){throw xn.head&&an(),t}t&&t.enter()};Ur||rr||pn||!dn||!yn?!hn&&mn&&mn.resolve?((cn=mn.resolve(void 0)).constructor=mn,fn=Dr(cn.then,cn),an=function(){fn(wn)}):rr?an=function(){gn.nextTick(wn)}:(vn=Dr(vn,A),an=function(){vn(wn)}):(un=!0,sn=yn.createTextNode(""),new dn(wn).observe(sn,{characterData:!0}),an=function(){sn.data=un=!un}),bn=function(t){xn.head||an(),xn.add(t)}}var En,An,On,Sn=bn,Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=A.Promise,In="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,jn=!In&&!rr&&"object"==typeof window&&"object"==typeof document,Pn=(kn&&kn.prototype,nt("species")),_n=!1,Mn=ut(A.PromiseRejectionEvent),Ln={CONSTRUCTOR:Je("Promise",(function(){var t=Zt(kn),e=t!==String(kn);if(!e&&66===K)return!0;if(!K||K<51||!/native code/.test(t)){var r=new kn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Pn]=n,!(_n=r.then((function(){}))instanceof n))return!0}return!e&&(jn||In)&&!Mn})),REJECTION_EVENT:Mn,SUBCLASSING:_n},Rn=TypeError,Nn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw new Rn("Bad Promise constructor");e=t,r=n})),this.resolve=It(e),this.reject=It(r)},Cn={f:function(t){return new Nn(t)}},Dn=rn.set,Fn=Ln.CONSTRUCTOR,Wn=Ln.REJECTION_EVENT,Bn=Ln.SUBCLASSING,zn=ie.getterFor("Promise"),Un=ie.set,Gn=kn&&kn.prototype,Vn=kn,qn=Gn,Hn=A.TypeError,Zn=A.document,Yn=A.process,$n=Cn.f,Kn=$n,Qn=!!(Zn&&Zn.createEvent&&A.dispatchEvent),Xn=function(t){var e;return!(!ct(t)||!ut(e=t.then))&&e},Jn=function(t,e){var r,n,o,i=e.value,a=1===e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&oo(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(new Hn("Promise-chain cycle")):(n=Xn(r))?bt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},to=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)Jn(r,t);t.notified=!1,e&&!t.rejection&&ro(t)})))},eo=function(t,e,r){var n,o;Qn?((n=Zn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),A.dispatchEvent(n)):n={promise:e,reason:r},!Wn&&(o=A["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},ro=function(t){bt(Dn,A,(function(){var e,r=t.facade,n=t.value;if(no(t)&&(e=Tn((function(){rr?Yn.emit("unhandledRejection",n,r):eo("unhandledrejection",r,n)})),t.rejection=rr||no(t)?2:1,e.error))throw e.value}))},no=function(t){return 1!==t.rejection&&!t.parent},oo=function(t){bt(Dn,A,(function(){var e=t.facade;rr?Yn.emit("rejectionHandled",e):eo("rejectionhandled",e,t.value)}))},io=function(t,e,r){return function(n){t(e,n,r)}},ao=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,to(t,!0))},uo=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw new Hn("Promise can\'t be resolved itself");var n=Xn(e);n?Sn((function(){var r={done:!1};try{bt(n,e,io(uo,r,t),io(ao,r,t))}catch(e){ao(r,e,t)}})):(t.value=e,t.state=1,to(t,!1))}catch(e){ao({done:!1},e,t)}}};if(Fn&&(qn=(Vn=function(t){vr(this,qn),It(t),bt(En,this);var e=zn(this);try{t(io(uo,e),io(ao,e))}catch(t){ao(e,t)}}).prototype,(En=function(t){Un(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new ln,rejection:!1,state:0,value:void 0})}).prototype=ue(qn,"then",(function(t,e){var r=zn(this),n=$n(Pr(this,Vn));return r.parent=!0,n.ok=!ut(t)||t,n.fail=ut(e)&&e,n.domain=rr?Yn.domain:void 0,0===r.state?r.reactions.add(n):Sn((function(){Jn(n,r)})),n.promise})),An=function(){var t=new En,e=zn(t);this.promise=t,this.resolve=io(uo,e),this.reject=io(ao,e)},Cn.f=$n=function(t){return t===Vn||void 0===t?new An(t):Kn(t)},ut(kn)&&Gn!==Object.prototype)){On=Gn.then,Bn||ue(Gn,"then",(function(t,e){var r=this;return new Vn((function(t,e){bt(On,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Gn.constructor}catch(t){}ar&&ar(Gn,qn)}er({global:!0,constructor:!0,wrap:!0,forced:Fn},{Promise:Vn}),cr(Vn,"Promise",!1),hr("Promise");var so={},co=nt("iterator"),fo=Array.prototype,lo=function(t){return void 0!==t&&(so.Array===t||fo[co]===t)},ho=nt("iterator"),po=function(t){if(!R(t))return jt(t,ho)||jt(t,"@@iterator")||so[ve(t)]},vo=TypeError,yo=function(t,e){var r=arguments.length<2?po(t):e;if(It(r))return gt(bt(r,t));throw new vo(Tt(t)+" is not iterable")},go=function(t,e,r){var n,o;gt(t);try{if(!(n=jt(t,"return"))){if("throw"===e)throw r;return r}n=bt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return gt(n),r},mo=TypeError,bo=function(t,e){this.stopped=t,this.result=e},xo=bo.prototype,wo=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Dr(e,f),y=function(t){return n&&go(n,"normal",t),new bo(!0,t)},g=function(t){return l?(gt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=po(t)))throw new mo(Tt(t)+" is not iterable");if(lo(o)){for(i=0,a=Re(t);a>i;i++)if((u=g(t[i]))&&Et(xo,u))return u;return new bo(!1)}n=yo(t,o)}for(s=h?t.next:n.next;!(c=bt(s,n)).done;){try{u=g(c.value)}catch(t){go(n,"throw",t)}if("object"==typeof u&&u&&Et(xo,u))return u}return new bo(!1)},Eo=nt("iterator"),Ao=!1;try{var Oo=0,So={next:function(){return{done:!!Oo++}},return:function(){Ao=!0}};So[Eo]=function(){return this},Array.from(So,(function(){throw 2}))}catch(t){}var To=function(t,e){try{if(!e&&!Ao)return!1}catch(t){return!1}var r=!1;try{var n={};n[Eo]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},ko=Ln.CONSTRUCTOR||!To((function(t){kn.all(t).then(void 0,(function(){}))}));er({target:"Promise",stat:!0,forced:ko},{all:function(t){var e=this,r=Cn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=It(e.resolve),i=[],a=0,u=1;wo(t,(function(t){var s=a++,c=!1;u++,bt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Io=Ln.CONSTRUCTOR,jo=kn&&kn.prototype;if(er({target:"Promise",proto:!0,forced:Io,real:!0},{catch:function(t){return this.then(void 0,t)}}),ut(kn)){var Po=wt("Promise").prototype.catch;jo.catch!==Po&&ue(jo,"catch",Po,{unsafe:!0})}er({target:"Promise",stat:!0,forced:ko},{race:function(t){var e=this,r=Cn.f(e),n=r.reject,o=Tn((function(){var o=It(e.resolve);wo(t,(function(t){bt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),er({target:"Promise",stat:!0,forced:Ln.CONSTRUCTOR},{reject:function(t){var e=Cn.f(this);return(0,e.reject)(t),e.promise}});var _o=Ln.CONSTRUCTOR;wt("Promise");function Mo(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}er({target:"Promise",stat:!0,forced:_o},{resolve:function(t){return function(t,e){if(gt(t),ct(e)&&e.constructor===t)return e;var r=Cn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Lo="undefined"!=typeof window&&void 0!==window.orientation,Ro=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Mo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Mo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),No=new Map;function Co(t){Mo(t.source&&!t.url||!t.source&&t.url);var e=No.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Do((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),No.set(t.url,e)),t.source&&(e=Do(t.source),No.set(t.source,e))),Mo(e),e}function Do(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Fo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Wo(t))n.add(t);else if(Wo(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Fo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Wo(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Bo=function(){},zo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Mo(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Bo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Bo,this.onError=Bo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Fo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Co({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Uo=self&&self.__assign||function(){return(Uo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Go=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Vo=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},qo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Uo(Uo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Go(this,void 0,void 0,(function(){var n,o=this;return Vo(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Go(this,void 0,void 0,(function(){var t,e,r;return Vo(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Ro(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new zo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Lo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Ho=self&&self.__assign||function(){return(Ho=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Zo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Yo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},$o=(function(){function t(t){this.workerPools=new Map,this.props=Ho({},Yo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return zo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Zo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Ho(Ho({},this.props),t);try{for(var n=Zo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new qo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),Ko=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(Qo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=$o.get(t);e||(e=function(e){if(Qo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=$o.get(t);$o.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Fo(e);self.postMessage(r,n)}},t}();function Qo(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var Xo,Jo,ti=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ei=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ri=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ni=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},oi=0;function ii(t,e){var r=this;if("undefined"!=typeof self){var n={process:ai};Ko.onmessage=function(o,i){return ei(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ri(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),Ko.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");Xo=new ti,Jo=i.options||{},a=e(Xo,Jo,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ni(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,Ko.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return Ko.postMessage("done",{}),[3,18];case 16:return Xo.push(i.input),[3,18];case 17:return Xo.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",Ko.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function ai(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=oi++,i=function(t,e){if(e.id===o)switch(t){case"done":Ko.removeEventListener(i),r(e.result);break;case"error":Ko.removeEventListener(i),n(e.error)}};Ko.addEventListener(i);var a={id:o,input:t,options:e};Ko.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var ui=Array.isArray||function(t){return"Array"===fe(t)},si=function(t,e,r){st?Ft.f(t,e,Kt(0,r)):t[e]=r},ci=nt("species"),fi=function(t){return K>=51||!I((function(){var e=[];return(e.constructor={})[ci]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},li=fi("slice"),hi=nt("species"),pi=Array,vi=Math.max;er({target:"Array",proto:!0,forced:!li},{slice:function(t,e){var r,n,o,i=Ee(this),a=Re(i),u=_e(t,a),s=_e(void 0===e?a:e,a);if(ui(i)&&(r=i.constructor,(Tr(r)&&(r===pi||ui(r.prototype))||ct(r)&&null===(r=r[hi]))&&(r=void 0),r===pi||void 0===r))return Wr(i,u,s);for(n=new(void 0===r?pi:r)(vi(s-u,0)),o=0;u<s;u++,o++)u in i&&si(n,o,i[u]);return n.length=o,n}});var di=Ut.EXISTS,yi=Function.prototype,gi=L(yi.toString),mi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,bi=L(mi.exec);st&&!di&&fr(yi,"name",{configurable:!0,get:function(){try{return bi(mi,gi(this))[1]}catch(t){return""}}});var xi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},wi=ht("span").classList,Ei=wi&&wi.constructor&&wi.constructor.prototype,Ai=Ei===Object.prototype?void 0:Ei,Oi=nt("species"),Si=Array,Ti=function(t,e){return new(function(t){var e;return ui(t)&&(e=t.constructor,(Tr(e)&&(e===Si||ui(e.prototype))||ct(e)&&null===(e=e[Oi]))&&(e=void 0)),void 0===e?Si:e}(t))(0===e?0:e)},ki=L([].push),Ii=function(t){var e=1===t,r=2===t,n=3===t,o=4===t,i=6===t,a=7===t,u=5===t||i;return function(s,c,f,l){for(var h,p,v=F(s),d=we(v),y=Re(d),g=Dr(c,f),m=0,b=l||Ti,x=e?b(s,y):r||a?b(s,0):void 0;y>m;m++)if((u||m in d)&&(p=g(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:ki(x,h)}else switch(t){case 4:return!1;case 7:ki(x,h)}return i?-1:n||o?o:x}},ji={forEach:Ii(0),map:Ii(1),filter:Ii(2),some:Ii(3),every:Ii(4),find:Ii(5),findIndex:Ii(6),filterReject:Ii(7)},Pi=function(t,e){var r=[][t];return!!r&&I((function(){r.call(null,e||function(){return 1},1)}))},_i=ji.forEach,Mi=Pi("forEach")?[].forEach:function(t){return _i(this,t,arguments.length>1?arguments[1]:void 0)},Li=function(t){if(t&&t.forEach!==Mi)try{Qt(t,"forEach",Mi)}catch(e){t.forEach=Mi}};for(var Ri in xi)xi[Ri]&&Li(A[Ri]&&A[Ri].prototype);Li(Ai);var Ni,Ci=function(t){for(var e=F(this),r=Re(e),n=arguments.length,o=_e(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:_e(i,r);a>o;)e[o++]=t;return e},Di=Object.keys||function(t){return We(t,Be)},Fi={f:st&&!vt?Object.defineProperties:function(t,e){gt(t);for(var r,n=Ee(e),o=Di(e),i=o.length,a=0;i>a;)Ft.f(t,r=o[a++],n[r]);return t}},Wi=Jt("IE_PROTO"),Bi=function(){},zi=function(t){return"<script>"+t+"<\\/script>"},Ui=function(t){t.write(zi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Gi=function(){try{Ni=new ActiveXObject("htmlfile")}catch(t){}var t,e;Gi="undefined"!=typeof document?document.domain&&Ni?Ui(Ni):((e=ht("iframe")).style.display="none",Fr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(zi("document.F=Object")),t.close(),t.F):Ui(Ni);for(var r=Be.length;r--;)delete Gi.prototype[Be[r]];return Gi()};te[Wi]=!0;var Vi=Object.create||function(t,e){var r;return null!==t?(Bi.prototype=gt(t),r=new Bi,Bi.prototype=null,r[Wi]=t):r=Gi(),void 0===e?r:Fi.f(r,e)},qi=Ft.f,Hi=nt("unscopables"),Zi=Array.prototype;void 0===Zi[Hi]&&qi(Zi,Hi,{configurable:!0,value:Vi(null)});var Yi=function(t){Zi[Hi][t]=!0};er({target:"Array",proto:!0},{fill:Ci}),Yi("fill");var $i,Ki,Qi,Xi=!I((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Ji=Jt("IE_PROTO"),ta=Object,ea=ta.prototype,ra=Xi?ta.getPrototypeOf:function(t){var e=F(t);if(B(e,Ji))return e[Ji];var r=e.constructor;return ut(r)&&e instanceof r?r.prototype:e instanceof ta?ea:null},na=nt("iterator"),oa=!1;[].keys&&("next"in(Qi=[].keys())?(Ki=ra(ra(Qi)))!==Object.prototype&&($i=Ki):oa=!0),(!ct($i)||I((function(){var t={};return $i[na].call(t)!==t})))&&($i={}),ut($i[na])||ue($i,na,(function(){return this}));var ia={IteratorPrototype:$i,BUGGY_SAFARI_ITERATORS:oa},aa=ia.IteratorPrototype,ua=function(){return this},sa=Ut.PROPER,ca=Ut.CONFIGURABLE,fa=ia.IteratorPrototype,la=ia.BUGGY_SAFARI_ITERATORS,ha=nt("iterator"),pa=function(){return this},va=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Vi(aa,{next:Kt(+!n,r)}),cr(t,o,!1),so[o]=ua}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!la&&t&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ha]||p["@@iterator"]||o&&p[o],d=!la&&v||f(o),y="Array"===e&&p.entries||v;if(y&&(u=ra(y.call(new t)))!==Object.prototype&&u.next&&(ra(u)!==fa&&(ar?ar(u,fa):ut(u[ha])||ue(u,ha,pa)),cr(u,l,!0)),sa&&"values"===o&&v&&"values"!==v.name&&(ca?Qt(p,"name","values"):(h=!0,d=function(){return bt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(la||h||!(c in p))&&ue(p,c,s[c]);else er({target:e,proto:!0,forced:la||h},s);return p[ha]!==d&&ue(p,ha,d,{name:o}),so[e]=d,s},da=function(t,e){return{value:t,done:e}},ya=Ft.f,ga=ie.set,ma=ie.getterFor("Array Iterator"),ba=va(Array,"Array",(function(t,e){ga(this,{type:"Array Iterator",target:Ee(t),index:0,kind:e})}),(function(){var t=ma(this),e=t.target,r=t.index++;if(!e||r>=e.length)return t.target=void 0,da(void 0,!0);switch(t.kind){case"keys":return da(r,!1);case"values":return da(e[r],!1)}return da([r,e[r]],!1)}),"values"),xa=so.Arguments=so.Array;if(Yi("keys"),Yi("values"),Yi("entries"),st&&"values"!==xa.name)try{ya(xa,"name",{value:"values"})}catch(t){}var wa,Ea,Aa,Oa="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Sa=ie.enforce,Ta=ie.get,ka=A.Int8Array,Ia=ka&&ka.prototype,ja=A.Uint8ClampedArray,Pa=ja&&ja.prototype,_a=ka&&ra(ka),Ma=Ia&&ra(Ia),La=Object.prototype,Ra=A.TypeError,Na=nt("toStringTag"),Ca=V("TYPED_ARRAY_TAG"),Da=Oa&&!!ar&&"Opera"!==ve(A.opera),Fa=!1,Wa={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ba={BigInt64Array:8,BigUint64Array:8},za=function(t){var e=ra(t);if(ct(e)){var r=Ta(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:za(e)}},Ua=function(t){if(!ct(t))return!1;var e=ve(t);return B(Wa,e)||B(Ba,e)};for(wa in Wa)(Aa=(Ea=A[wa])&&Ea.prototype)?Sa(Aa).TypedArrayConstructor=Ea:Da=!1;for(wa in Ba)(Aa=(Ea=A[wa])&&Ea.prototype)&&(Sa(Aa).TypedArrayConstructor=Ea);if((!Da||!ut(_a)||_a===Function.prototype)&&(_a=function(){throw new Ra("Incorrect invocation")},Da))for(wa in Wa)A[wa]&&ar(A[wa],_a);if((!Da||!Ma||Ma===La)&&(Ma=_a.prototype,Da))for(wa in Wa)A[wa]&&ar(A[wa].prototype,Ma);if(Da&&ra(Pa)!==Ma&&ar(Pa,Ma),st&&!B(Ma,Na))for(wa in Fa=!0,fr(Ma,Na,{configurable:!0,get:function(){return ct(this)?this[Ca]:void 0}}),Wa)A[wa]&&Qt(A[wa],Ca,wa);var Ga={NATIVE_ARRAY_BUFFER_VIEWS:Da,TYPED_ARRAY_TAG:Fa&&Ca,aTypedArray:function(t){if(Ua(t))return t;throw new Ra("Target is not a typed array")},aTypedArrayConstructor:function(t){if(ut(t)&&(!ar||Et(_a,t)))return t;throw new Ra(Tt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(st){if(r)for(var o in Wa){var i=A[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Ma[t]&&!r||ue(Ma,t,r?e:Da&&Ia[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(st){if(ar){if(r)for(n in Wa)if((o=A[n])&&B(o,t))try{delete o[t]}catch(t){}if(_a[t]&&!r)return;try{return ue(_a,t,r?e:Da&&_a[t]||e)}catch(t){}}for(n in Wa)!(o=A[n])||o[t]&&!r||ue(o,t,e)}},getTypedArrayConstructor:za,isView:function(t){if(!ct(t))return!1;var e=ve(t);return"DataView"===e||B(Wa,e)||B(Ba,e)},isTypedArray:Ua,TypedArray:_a,TypedArrayPrototype:Ma},Va=Ga.NATIVE_ARRAY_BUFFER_VIEWS,qa=A.ArrayBuffer,Ha=A.Int8Array,Za=!Va||!I((function(){Ha(1)}))||!I((function(){new Ha(-1)}))||!To((function(t){new Ha,new Ha(null),new Ha(1.5),new Ha(t)}),!0)||I((function(){return 1!==new Ha(new qa(2),1,void 0).length})),Ya=function(t,e,r){for(var n in e)ue(t,n,e[n],r);return t},$a=RangeError,Ka=function(t){if(void 0===t)return 0;var e=Ie(t),r=Le(e);if(e!==r)throw new $a("Wrong length or index");return r},Qa=Math.sign||function(t){var e=+t;return 0===e||e!=e?e:e<0?-1:1},Xa=Math.abs,Ja=Math.fround||function(t){return function(t,e,r,n){var o=+t,i=Xa(o),a=Qa(o);if(i<n)return a*function(t){return t+4503599627370496-4503599627370496}(i/n/e)*n*e;var u=(1+e/2220446049250313e-31)*i,s=u-(u-i);return s>r||s!=s?a*(1/0):a*s}(t,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)},tu=Array,eu=Math.abs,ru=Math.pow,nu=Math.floor,ou=Math.log,iu=Math.LN2,au=function(t,e,r){var n,o,i,a=tu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?ru(2,-24)-ru(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=eu(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=nu(ou(t)/iu),t*(i=ru(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*ru(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*ru(2,e),n+=c):(o=t*ru(2,c-1)*ru(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},uu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=ru(2,e),f-=a}return(c?-1:1)*r*ru(2,f-e)},su=function(t,e,r){var n,o;return ar&&ut(n=e.constructor)&&n!==r&&ct(o=n.prototype)&&o!==r.prototype&&ar(t,o),t},cu=Ut.PROPER,fu=Ut.CONFIGURABLE,lu=ie.getterFor("ArrayBuffer"),hu=ie.getterFor("DataView"),pu=ie.set,vu=A.ArrayBuffer,du=vu,yu=du&&du.prototype,gu=A.DataView,mu=gu&&gu.prototype,bu=Object.prototype,xu=A.Array,wu=A.RangeError,Eu=L(Ci),Au=L([].reverse),Ou=au,Su=uu,Tu=function(t){return[255&t]},ku=function(t){return[255&t,t>>8&255]},Iu=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},ju=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Pu=function(t){return Ou(Ja(t),23,4)},_u=function(t){return Ou(t,52,8)},Mu=function(t,e,r){fr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Lu=function(t,e,r,n){var o=hu(t),i=Ka(r),a=!!n;if(i+e>o.byteLength)throw new wu("Wrong index");var u=o.bytes,s=i+o.byteOffset,c=Wr(u,s,s+e);return a?c:Au(c)},Ru=function(t,e,r,n,o,i){var a=hu(t),u=Ka(r),s=n(+o),c=!!i;if(u+e>a.byteLength)throw new wu("Wrong index");for(var f=a.bytes,l=u+a.byteOffset,h=0;h<e;h++)f[l+h]=s[c?h:e-h-1]};if(Oa){var Nu=cu&&"ArrayBuffer"!==vu.name;I((function(){vu(1)}))&&I((function(){new vu(-1)}))&&!I((function(){return new vu,new vu(1.5),new vu(NaN),1!==vu.length||Nu&&!fu}))?Nu&&fu&&Qt(vu,"name","ArrayBuffer"):((du=function(t){return vr(this,yu),su(new vu(Ka(t)),this,du)}).prototype=yu,yu.constructor=du,He(du,vu)),ar&&ra(mu)!==bu&&ar(mu,bu);var Cu=new gu(new du(2)),Du=L(mu.setInt8);Cu.setInt8(0,2147483648),Cu.setInt8(1,2147483649),!Cu.getInt8(0)&&Cu.getInt8(1)||Ya(mu,{setInt8:function(t,e){Du(this,t,e<<24>>24)},setUint8:function(t,e){Du(this,t,e<<24>>24)}},{unsafe:!0})}else yu=(du=function(t){vr(this,yu);var e=Ka(t);pu(this,{type:"ArrayBuffer",bytes:Eu(xu(e),0),byteLength:e}),st||(this.byteLength=e,this.detached=!1)}).prototype,mu=(gu=function(t,e,r){vr(this,mu),vr(t,yu);var n=lu(t),o=n.byteLength,i=Ie(e);if(i<0||i>o)throw new wu("Wrong offset");if(i+(r=void 0===r?o-i:Le(r))>o)throw new wu("Wrong length");pu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),st||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,st&&(Mu(du,"byteLength",lu),Mu(gu,"buffer",hu),Mu(gu,"byteLength",hu),Mu(gu,"byteOffset",hu)),Ya(mu,{getInt8:function(t){return Lu(this,1,t)[0]<<24>>24},getUint8:function(t){return Lu(this,1,t)[0]},getInt16:function(t){var e=Lu(this,2,t,arguments.length>1&&arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Lu(this,2,t,arguments.length>1&&arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return ju(Lu(this,4,t,arguments.length>1&&arguments[1]))},getUint32:function(t){return ju(Lu(this,4,t,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(t){return Su(Lu(this,4,t,arguments.length>1&&arguments[1]),23)},getFloat64:function(t){return Su(Lu(this,8,t,arguments.length>1&&arguments[1]),52)},setInt8:function(t,e){Ru(this,1,t,Tu,e)},setUint8:function(t,e){Ru(this,1,t,Tu,e)},setInt16:function(t,e){Ru(this,2,t,ku,e,arguments.length>2&&arguments[2])},setUint16:function(t,e){Ru(this,2,t,ku,e,arguments.length>2&&arguments[2])},setInt32:function(t,e){Ru(this,4,t,Iu,e,arguments.length>2&&arguments[2])},setUint32:function(t,e){Ru(this,4,t,Iu,e,arguments.length>2&&arguments[2])},setFloat32:function(t,e){Ru(this,4,t,Pu,e,arguments.length>2&&arguments[2])},setFloat64:function(t,e){Ru(this,8,t,_u,e,arguments.length>2&&arguments[2])}});cr(du,"ArrayBuffer"),cr(gu,"DataView");var Fu={ArrayBuffer:du,DataView:gu},Wu=Math.floor,Bu=Number.isInteger||function(t){return!ct(t)&&isFinite(t)&&Wu(t)===t},zu=RangeError,Uu=RangeError,Gu=function(t,e){var r=function(t){var e=Ie(t);if(e<0)throw new zu("The argument can\'t be less than 0");return e}(t);if(r%e)throw new Uu("Wrong offset");return r},Vu=Math.round,qu=function(t){var e=ve(t);return"BigInt64Array"===e||"BigUint64Array"===e},Hu=TypeError,Zu=function(t){var e=Lt(t,"number");if("number"==typeof e)throw new Hu("Can\'t convert number to bigint");return BigInt(e)},Yu=Ga.aTypedArrayConstructor,$u=function(t){var e,r,n,o,i,a,u,s,c=Ir(this),f=F(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=po(f);if(v&&!lo(v))for(s=(u=yo(f,v)).next,f=[];!(a=bt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Dr(h,arguments[2])),r=Re(f),n=new(Yu(c))(r),o=qu(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?Zu(i):+i;return n},Ku=function(t,e,r){for(var n=0,o=arguments.length>2?r:Re(e),i=new t(o);o>n;)i[n]=e[n++];return i},Qu=b((function(t){var e=Ue.f,r=ji.forEach,n=ie.get,o=ie.set,i=ie.enforce,a=Ft.f,u=Oe.f,s=A.RangeError,c=Fu.ArrayBuffer,f=c.prototype,l=Fu.DataView,h=Ga.NATIVE_ARRAY_BUFFER_VIEWS,p=Ga.TYPED_ARRAY_TAG,v=Ga.TypedArray,d=Ga.TypedArrayPrototype,y=Ga.isTypedArray,g=function(t,e){fr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},m=function(t){var e;return Et(f,t)||"ArrayBuffer"===(e=ve(t))||"SharedArrayBuffer"===e},b=function(t,e){return y(t)&&!Ot(e)&&e in t&&Bu(+e)&&e>=0},x=function(t,e){return e=Rt(e),b(t,e)?Kt(2,t[e]):u(t,e)},w=function(t,e,r){return e=Rt(e),!(b(t,e)&&ct(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};st?(h||(Oe.f=x,Ft.f=w,g(d,"buffer"),g(d,"byteOffset"),g(d,"byteLength"),g(d,"length")),er({target:"Object",stat:!0,forced:!h},{getOwnPropertyDescriptor:x,defineProperty:w}),t.exports=function(t,u,f){var g=t.match(/\\d+/)[0]/8,b=t+(f?"Clamped":"")+"Array",x="get"+t,w="set"+t,E=A[b],O=E,S=O&&O.prototype,T={},k=function(t,e,r){var o=n(t);o.view[w](e*g+o.byteOffset,f?function(t){var e=Vu(t);return e<0?0:e>255?255:255&e}(r):r,!0)},I=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[x](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return k(this,e,t)},enumerable:!0})};h?Za&&(O=u((function(t,e,r,n){return vr(t,S),su(ct(e)?m(e)?void 0!==n?new E(e,Gu(r,g),n):void 0!==r?new E(e,Gu(r,g)):new E(e):y(e)?Ku(O,e):bt($u,O,e):new E(Ka(e)),t,O)})),ar&&ar(O,v),r(e(E),(function(t){t in O||Qt(O,t,E[t])})),O.prototype=S):(O=u((function(t,e,r,n){vr(t,S);var i,a,u,f=0,h=0;if(ct(e)){if(!m(e))return y(e)?Ku(O,e):bt($u,O,e);i=e,h=Gu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw new s("Wrong length");if((a=p-h)<0)throw new s("Wrong length")}else if((a=Le(n)*g)+h>p)throw new s("Wrong length");u=a/g}else u=Ka(e),i=new c(a=u*g);for(o(t,{buffer:i,byteOffset:h,byteLength:a,length:u,view:new l(i)});f<u;)I(t,f++)})),ar&&ar(O,v),S=O.prototype=Vi(d)),S.constructor!==O&&Qt(S,"constructor",O),i(S).TypedArrayConstructor=O,p&&Qt(S,p,b);var j=O!==E;T[b]=O,er({global:!0,constructor:!0,forced:j,sham:!h},T),"BYTES_PER_ELEMENT"in O||Qt(O,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in S||Qt(S,"BYTES_PER_ELEMENT",g),hr(b)}):t.exports=function(){}}));Qu("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var Xu=TypeError,Ju=function(t,e){if(!delete t[e])throw new Xu("Cannot delete property "+Tt(e)+" of "+Tt(t))},ts=Math.min,es=L([].copyWithin||function(t,e){var r=F(this),n=Re(r),o=_e(t,n),i=_e(e,n),a=arguments.length>2?arguments[2]:void 0,u=ts((void 0===a?n:_e(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:Ju(r,o),o+=s,i+=s;return r}),rs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("copyWithin",(function(t,e){return es(rs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ns=ji.every,os=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("every",(function(t){return ns(os(this),t,arguments.length>1?arguments[1]:void 0)}));var is=Ga.aTypedArray,as=Ga.exportTypedArrayMethod,us=L("".slice);as("fill",(function(t){var e=arguments.length;is(this);var r="Big"===us(ve(this),0,3)?Zu(t):+t;return bt(Ci,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),I((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ss=Ga.aTypedArrayConstructor,cs=Ga.getTypedArrayConstructor,fs=function(t){return ss(Pr(t,cs(t)))},ls=function(t,e){return Ku(fs(t),e)},hs=ji.filter,ps=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("filter",(function(t){var e=hs(ps(this),t,arguments.length>1?arguments[1]:void 0);return ls(this,e)}));var vs=ji.find,ds=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("find",(function(t){return vs(ds(this),t,arguments.length>1?arguments[1]:void 0)}));var ys=ji.findIndex,gs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("findIndex",(function(t){return ys(gs(this),t,arguments.length>1?arguments[1]:void 0)}));var ms=ji.forEach,bs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("forEach",(function(t){ms(bs(this),t,arguments.length>1?arguments[1]:void 0)}));var xs=Ce.includes,ws=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("includes",(function(t){return xs(ws(this),t,arguments.length>1?arguments[1]:void 0)}));var Es=Ce.indexOf,As=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("indexOf",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=nt("iterator"),Ss=A.Uint8Array,Ts=L(ba.values),ks=L(ba.keys),Is=L(ba.entries),js=Ga.aTypedArray,Ps=Ga.exportTypedArrayMethod,_s=Ss&&Ss.prototype,Ms=!I((function(){_s[Os].call([1])})),Ls=!!_s&&_s.values&&_s[Os]===_s.values&&"values"===_s.values.name,Rs=function(){return Ts(js(this))};Ps("entries",(function(){return Is(js(this))}),Ms),Ps("keys",(function(){return ks(js(this))}),Ms),Ps("values",Rs,Ms||!Ls,{name:"values"}),Ps(Os,Rs,Ms||!Ls,{name:"values"});var Ns=Ga.aTypedArray,Cs=Ga.exportTypedArrayMethod,Ds=L([].join);Cs("join",(function(t){return Ds(Ns(this),t)}));var Fs=Math.min,Ws=[].lastIndexOf,Bs=!!Ws&&1/[1].lastIndexOf(1,-0)<0,zs=Pi("lastIndexOf"),Us=Bs||!zs?function(t){if(Bs)return Rr(Ws,this,arguments)||0;var e=Ee(this),r=Re(e);if(0===r)return-1;var n=r-1;for(arguments.length>1&&(n=Fs(n,Ie(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Ws,Gs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Rr(Us,Gs(this),e>1?[t,arguments[1]]:[t])}));var Vs=ji.map,qs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("map",(function(t){return Vs(qs(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(fs(t))(e)}))}));var Hs=TypeError,Zs="Reduce of empty array with no initial value",Ys=function(t){return function(e,r,n,o){var i=F(e),a=we(i),u=Re(i);if(It(r),0===u&&n<2)throw new Hs(Zs);var s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw new Hs(Zs)}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},$s={left:Ys(!1),right:Ys(!0)},Ks=$s.left,Qs=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return Ks(Qs(this),t,e,e>1?arguments[1]:void 0)}));var Xs=$s.right,Js=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return Xs(Js(this),t,e,e>1?arguments[1]:void 0)}));var tc=Ga.aTypedArray,ec=Ga.exportTypedArrayMethod,rc=Math.floor;ec("reverse",(function(){for(var t,e=tc(this).length,r=rc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var nc=A.RangeError,oc=A.Int8Array,ic=oc&&oc.prototype,ac=ic&&ic.set,uc=Ga.aTypedArray,sc=Ga.exportTypedArrayMethod,cc=!I((function(){var t=new Uint8ClampedArray(2);return bt(ac,t,{length:1,0:3},1),3!==t[1]})),fc=cc&&Ga.NATIVE_ARRAY_BUFFER_VIEWS&&I((function(){var t=new oc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));sc("set",(function(t){uc(this);var e=Gu(arguments.length>1?arguments[1]:void 0,1),r=F(t);if(cc)return bt(ac,this,r,e);var n=this.length,o=Re(r),i=0;if(o+e>n)throw new nc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!cc||fc);var lc=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Wr(lc(this),t,e),n=fs(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),I((function(){new Int8Array(1).slice()})));var hc=ji.some,pc=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("some",(function(t){return hc(pc(this),t,arguments.length>1?arguments[1]:void 0)}));var vc=Math.floor,dc=function(t,e){var r=t.length;if(r<8)for(var n,o,i=1;i<r;){for(o=i,n=t[i];o&&e(t[o-1],n)>0;)t[o]=t[--o];o!==i++&&(t[o]=n)}else for(var a=vc(r/2),u=dc(Wr(t,0,a),e),s=dc(Wr(t,a),e),c=u.length,f=s.length,l=0,h=0;l<c||h<f;)t[l+h]=l<c&&h<f?e(u[l],s[h])<=0?u[l++]:s[h++]:l<c?u[l++]:s[h++];return t},yc=dc,gc=q.match(/firefox\\/(\\d+)/i),mc=!!gc&&+gc[1],bc=/MSIE|Trident/.test(q),xc=q.match(/AppleWebKit\\/(\\d+)\\./),wc=!!xc&&+xc[1],Ec=Ga.aTypedArray,Ac=Ga.exportTypedArrayMethod,Oc=A.Uint16Array,Sc=Oc&&Nr(Oc.prototype.sort),Tc=!(!Sc||I((function(){Sc(new Oc(2),null)}))&&I((function(){Sc(new Oc(2),{})}))),kc=!!Sc&&!I((function(){if(K)return K<74;if(mc)return mc<67;if(bc)return!0;if(wc)return wc<602;var t,e,r=new Oc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Sc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Ac("sort",(function(t){return void 0!==t&&It(t),kc?Sc(this,t):yc(Ec(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!kc||Tc);var Ic=Ga.aTypedArray;(0,Ga.exportTypedArrayMethod)("subarray",(function(t,e){var r=Ic(this),n=r.length,o=_e(t,n);return new(fs(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Le((void 0===e?n:_e(e,n))-o))}));var jc=A.Int8Array,Pc=Ga.aTypedArray,_c=Ga.exportTypedArrayMethod,Mc=[].toLocaleString,Lc=!!jc&&I((function(){Mc.call(new jc(1))}));_c("toLocaleString",(function(){return Rr(Mc,Lc?Wr(Pc(this)):Pc(this),Wr(arguments))}),I((function(){return[1,2].toLocaleString()!==new jc([1,2]).toLocaleString()}))||!I((function(){jc.prototype.toLocaleString.call([1,2])})));var Rc=Ga.exportTypedArrayMethod,Nc=A.Uint8Array,Cc=Nc&&Nc.prototype||{},Dc=[].toString,Fc=L([].join);I((function(){Dc.call({})}))&&(Dc=function(){return Fc(this)});var Wc=Cc.toString!==Dc;Rc("toString",Dc,Wc);var Bc,zc,Uc=String,Gc=function(t){if("Symbol"===ve(t))throw new TypeError("Cannot convert a Symbol value to a string");return Uc(t)},Vc=function(){var t=gt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},qc=A.RegExp,Hc=I((function(){var t=qc("a","y");return t.lastIndex=2,null!==t.exec("abcd")})),Zc=Hc||I((function(){return!qc("a","y").sticky})),Yc={BROKEN_CARET:Hc||I((function(){var t=qc("^r","gy");return t.lastIndex=2,null!==t.exec("str")})),MISSED_STICKY:Zc,UNSUPPORTED_Y:Hc},$c=A.RegExp,Kc=I((function(){var t=$c(".","s");return!(t.dotAll&&t.test("\\n")&&"s"===t.flags)})),Qc=A.RegExp,Xc=I((function(){var t=Qc("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),Jc=ie.get,tf=k("native-string-replace",String.prototype.replace),ef=RegExp.prototype.exec,rf=ef,nf=L("".charAt),of=L("".indexOf),af=L("".replace),uf=L("".slice),sf=(zc=/b*/g,bt(ef,Bc=/a/,"a"),bt(ef,zc,"a"),0!==Bc.lastIndex||0!==zc.lastIndex),cf=Yc.BROKEN_CARET,ff=void 0!==/()??/.exec("")[1];(sf||ff||cf||Kc||Xc)&&(rf=function(t){var e,r,n,o,i,a,u,s=this,c=Jc(s),f=Gc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=bt(rf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=cf&&s.sticky,v=bt(Vc,s),d=s.source,y=0,g=f;if(p&&(v=af(v,"y",""),-1===of(v,"g")&&(v+="g"),g=uf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==nf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),ff&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),sf&&(n=s.lastIndex),o=bt(ef,p?r:s,g),p?o?(o.input=uf(o.input,y),o[0]=uf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:sf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),ff&&o&&o.length>1&&bt(tf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Vi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var lf=rf;er({target:"RegExp",proto:!0,forced:/./.exec!==lf},{exec:lf});var hf,pf=nt("species"),vf=RegExp.prototype,df=function(t,e,r,n){var o=nt(t),i=!I((function(){var e={};return e[o]=function(){return 7},7!==""[t](e)})),a=i&&!I((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[pf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=/./[o],s=e(o,""[t],(function(t,e,r,n,o){var a=e.exec;return a===lf||a===vf.exec?i&&!o?{done:!0,value:bt(u,e,r,n)}:{done:!0,value:bt(t,r,e,n)}:{done:!1}}));ue(String.prototype,t,s[0]),ue(vf,o,s[1])}n&&Qt(vf[o],"sham",!0)},yf=L("".charAt),gf=L("".charCodeAt),mf=L("".slice),bf=function(t){return function(e,r){var n,o,i=Gc(C(e)),a=Ie(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=gf(i,a))<55296||n>56319||a+1===u||(o=gf(i,a+1))<56320||o>57343?t?yf(i,a):n:t?mf(i,a,a+2):o-56320+(n-55296<<10)+65536}},xf={codeAt:bf(!1),charAt:bf(!0)},wf=xf.charAt,Ef=function(t,e,r){return e+(r?wf(t,e).length:1)},Af=Math.floor,Of=L("".charAt),Sf=L("".replace),Tf=L("".slice),kf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,If=/\\$([$&\'`]|\\d{1,2})/g,jf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=If;return void 0!==o&&(o=F(o),s=kf),Sf(i,s,(function(i,s){var c;switch(Of(s,0)){case"$":return"$";case"&":return t;case"`":return Tf(e,0,r);case"\'":return Tf(e,a);case"<":c=o[Tf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Af(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Of(s,1):n[l-1]+Of(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Pf=TypeError,_f=function(t,e){var r=t.exec;if(ut(r)){var n=bt(r,t,e);return null!==n&&gt(n),n}if("RegExp"===fe(t))return bt(lf,t,e);throw new Pf("RegExp#exec called on incompatible receiver")},Mf=nt("replace"),Lf=Math.max,Rf=Math.min,Nf=L([].concat),Cf=L([].push),Df=L("".indexOf),Ff=L("".slice),Wf="$0"==="a".replace(/./,"$0"),Bf=!!/./[Mf]&&""===/./[Mf]("a","$0");function zf(t){this.message=t}df("replace",(function(t,e,r){var n=Bf?"$":"$0";return[function(t,r){var n=C(this),o=R(t)?void 0:jt(t,Mf);return o?bt(o,t,n,r):bt(e,Gc(n),t,r)},function(t,o){var i=gt(this),a=Gc(t);if("string"==typeof o&&-1===Df(o,n)&&-1===Df(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=ut(o);s||(o=Gc(o));var c,f=i.global;f&&(c=i.unicode,i.lastIndex=0);for(var l,h=[];null!==(l=_f(i,a))&&(Cf(h,l),f);){""===Gc(l[0])&&(i.lastIndex=Ef(a,Le(i.lastIndex),c))}for(var p,v="",d=0,y=0;y<h.length;y++){for(var g,m=Gc((l=h[y])[0]),b=Lf(Rf(Ie(l.index),a.length),0),x=[],w=1;w<l.length;w++)Cf(x,void 0===(p=l[w])?p:String(p));var E=l.groups;if(s){var A=Nf([m],x,b,a);void 0!==E&&Cf(A,E),g=Gc(Rr(o,void 0,A))}else g=jf(m,a,b,x,E,o);b>=d&&(v+=Ff(a,d,b)+g,d=b+m.length)}return v+Ff(a,d)}]}),!!I((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Wf||Bf),zf.prototype=new Error,zf.prototype.name="InvalidCharacterError",er({global:!0,forced:A.globalThis!==A},{globalThis:A}),hf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:hf.devicePixelRatio;var Uf=TypeError,Gf=Object.getOwnPropertyDescriptor,Vf=st&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(ui(t)&&!Gf(t,"length").writable)throw new Uf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},qf=TypeError,Hf=function(t){if(t>9007199254740991)throw qf("Maximum allowed index exceeded");return t},Zf=fi("splice"),Yf=Math.max,$f=Math.min;er({target:"Array",proto:!0,forced:!Zf},{splice:function(t,e){var r,n,o,i,a,u,s=F(this),c=Re(s),f=_e(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=$f(Yf(Ie(e),0),c-f)),Hf(c+r-n),o=Ti(s,n),i=0;i<n;i++)(a=f+i)in s&&si(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:Ju(s,u);for(i=c;i>c-n+r;i--)Ju(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:Ju(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Vf(s,c-n+r),o}});var Kf=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),Qf=ji.findIndex,Xf=!0;"findIndex"in[]&&Array(1).findIndex((function(){Xf=!1})),er({target:"Array",proto:!0,forced:Xf},{findIndex:function(t){return Qf(this,t,arguments.length>1?arguments[1]:void 0)}}),Yi("findIndex");var Jf=Object.assign,tl=Object.defineProperty,el=L([].concat),rl=!Jf||I((function(){if(st&&1!==Jf({b:1},Jf(tl({},"a",{enumerable:!0,get:function(){tl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol("assign detection");return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!==Jf({},t)[r]||"abcdefghijklmnopqrst"!==Di(Jf({},e)).join("")}))?function(t,e){for(var r=F(t),n=arguments.length,o=1,i=Ge.f,a=me.f;n>o;)for(var u,s=we(arguments[o++]),c=i?el(Di(s),i(s)):Di(s),f=c.length,l=0;f>l;)u=c[l++],st&&!bt(a,s,u)||(r[u]=s[u]);return r}:Jf;er({target:"Object",stat:!0,arity:2,forced:Object.assign!==rl},{assign:rl});var nl=xf.charAt,ol=ie.set,il=ie.getterFor("String Iterator");va(String,"String",(function(t){ol(this,{type:"String Iterator",string:Gc(t),index:0})}),(function(){var t,e=il(this),r=e.string,n=e.index;return n>=r.length?da(void 0,!0):(t=nl(r,n),e.index+=t.length,da(t,!1))}));var al=!I((function(){return Object.isExtensible(Object.preventExtensions({}))})),ul=Ue.f,sl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],cl={f:function(t){return sl&&"Window"===fe(t)?function(t){try{return ul(t)}catch(t){return Wr(sl)}}(t):ul(Ee(t))}},fl=I((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),ll=Object.isExtensible,hl=I((function(){ll(1)}))||fl?function(t){return!!ct(t)&&((!fl||"ArrayBuffer"!==fe(t))&&(!ll||ll(t)))}:ll,pl=b((function(t){var e=Ft.f,r=!1,n=V("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ue.f,e=L([].splice),o={};o[n]=1,t(o).length&&(Ue.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},er({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:cl.f}))},fastKey:function(t,e){if(!ct(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!hl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!hl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return al&&r&&hl(t)&&!B(t,n)&&i(t),t}};te[n]=!0})),vl=(pl.enable,pl.fastKey,pl.getWeakData,pl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=A[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=L(u[t]);ue(u,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(o&&!ct(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return o&&!ct(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(o&&!ct(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(Je(t,!ut(a)||!(o||u.forEach&&!I((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),pl.enable();else if(Je(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!==l,p=I((function(){l.has(1)})),v=To((function(t){new a(t)})),d=!o&&I((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){vr(t,u);var r=su(new a,t,s);return R(e)||wo(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,er({global:!0,constructor:!0,forced:s!==a},c),cr(s,t),o||r.setStrong(s,t,n),s}),dl=pl.getWeakData,yl=ie.set,gl=ie.getterFor,ml=ji.find,bl=ji.findIndex,xl=L([].splice),wl=0,El=function(t){return t.frozen||(t.frozen=new Al)},Al=function(){this.entries=[]},Ol=function(t,e){return ml(t.entries,(function(t){return t[0]===e}))};Al.prototype={get:function(t){var e=Ol(this,t);if(e)return e[1]},has:function(t){return!!Ol(this,t)},set:function(t,e){var r=Ol(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=bl(this.entries,(function(e){return e[0]===t}));return~e&&xl(this.entries,e,1),!!~e}};var Sl,Tl={getConstructor:function(t,e,r,n){var o=t((function(t,o){vr(t,i),yl(t,{type:e,id:wl++,frozen:void 0}),R(o)||wo(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=gl(e),u=function(t,e,r){var n=a(t),o=dl(gt(e),!0);return!0===o?El(n).set(e,r):o[n.id]=r,t};return Ya(i,{delete:function(t){var e=a(this);if(!ct(t))return!1;var r=dl(t);return!0===r?El(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!ct(t))return!1;var r=dl(t);return!0===r?El(e).has(t):r&&B(r,e.id)}}),Ya(i,r?{get:function(t){var e=a(this);if(ct(t)){var r=dl(t);return!0===r?El(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},kl=ie.enforce,Il=Object,jl=Array.isArray,Pl=Il.isExtensible,_l=Il.isFrozen,Ml=Il.isSealed,Ll=Il.freeze,Rl=Il.seal,Nl=!A.ActiveXObject&&"ActiveXObject"in A,Cl=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Dl=vl("WeakMap",Cl,Tl),Fl=Dl.prototype,Wl=L(Fl.set);if($t)if(Nl){Sl=Tl.getConstructor(Cl,"WeakMap",!0),pl.enable();var Bl=L(Fl.delete),zl=L(Fl.has),Ul=L(Fl.get);Ya(Fl,{delete:function(t){if(ct(t)&&!Pl(t)){var e=kl(this);return e.frozen||(e.frozen=new Sl),Bl(this,t)||e.frozen.delete(t)}return Bl(this,t)},has:function(t){if(ct(t)&&!Pl(t)){var e=kl(this);return e.frozen||(e.frozen=new Sl),zl(this,t)||e.frozen.has(t)}return zl(this,t)},get:function(t){if(ct(t)&&!Pl(t)){var e=kl(this);return e.frozen||(e.frozen=new Sl),zl(this,t)?Ul(this,t):e.frozen.get(t)}return Ul(this,t)},set:function(t,e){if(ct(t)&&!Pl(t)){var r=kl(this);r.frozen||(r.frozen=new Sl),zl(this,t)?Wl(this,t,e):r.frozen.set(t,e)}else Wl(this,t,e);return this}})}else al&&I((function(){var t=Ll([]);return Wl(new Dl,t,1),!_l(t)}))&&Ya(Fl,{set:function(t,e){var r;return jl(t)&&(_l(t)?r=Ll:Ml(t)&&(r=Rl)),Wl(this,t,e),r&&r(t),this}});var Gl=nt("iterator"),Vl=ba.values,ql=function(t,e){if(t){if(t[Gl]!==Vl)try{Qt(t,Gl,Vl)}catch(e){t[Gl]=Vl}if(cr(t,e,!0),xi[e])for(var r in ba)if(t[r]!==ba[r])try{Qt(t,r,ba[r])}catch(e){t[r]=ba[r]}}};for(var Hl in xi)ql(A[Hl]&&A[Hl].prototype,Hl);ql(Ai,"DOMTokenList");var Zl,Yl,$l,Kl,Ql=new WeakMap,Xl=function(){return u((function t(){i(this,t),Ql.set(this,{})}),[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Ql.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),Ql.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=Ql.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=Ql.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}])}(),Jl=function(t){function e(){var t;return i(this,e),s(t=o(this,e),"className",void 0),s(t,"children",void 0),t.className="",t.children=[],t}return f(e,t),u(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}])}(function(t){function e(){var t;return i(this,e),s(t=o(this,e),"childNodes",void 0),t.childNodes=[],t}return f(e,t),u(e,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}])}(Xl));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var th=my.getSystemInfoSync();Zl=th.screenWidth,Yl=th.screenHeight,$l=th.windowWidth,Kl=th.windowHeight}else{var eh=hf.innerWidth,rh=hf.innerHeight;Zl=eh,Yl=rh,$l=eh,Kl=rh}var nh={width:Zl,height:Yl,availWidth:$l,availHeight:Kl,availLeft:0,availTop:0},oh=nh.availWidth,ih=nh.availHeight,ah={style:[]};function uh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ah}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ah}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function sh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:oh+"px",height:ih+"px",margin:"0px",padding:"0px"})}function ch(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=oh,t.clientHeight=ih),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function fh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=oh,t.offsetHeight=ih)}function lh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=oh,t.scrollHeight=ih)}function hh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function ph(){}var vh=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return i(this,e),s(t=o(this,e),"className",void 0),s(t,"children",void 0),s(t,"focus",void 0),s(t,"blur",void 0),s(t,"insertBefore",void 0),s(t,"appendChild",void 0),s(t,"removeChild",void 0),s(t,"remove",void 0),s(t,"innerHTML",void 0),s(t,"tagName",void 0),t.className="",t.children=[],t.focus=ph,t.blur=ph,t.insertBefore=ph,t.appendChild=ph,t.removeChild=ph,t.remove=ph,t.innerHTML="",t.tagName=r.toUpperCase(),uh(t,n),sh(t),hh(t),ch(t),fh(t),lh(t),t}return f(e,t),u(e)}(Jl),dh=function(t){function e(){return i(this,e),o(this,e,["video"])}return f(e,t),u(e)}(function(t){function e(t){return i(this,e),o(this,e,[t])}return f(e,t),u(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}])}(vh)),yh={};function gh(){return yh}var mh=u((function t(){i(this,t);var e=gh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),uh(r),hh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),bh={href:"",protocol:"",host:""},xh=function(t){function e(){return i(this,e),o(this,e,["body",0])}return f(e,t),u(e,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}])}(vh),wh=function(t){function e(){return i(this,e),o(this,e,["html",0])}return f(e,t),u(e,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}])}(vh),Eh={},Ah={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:bh,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new mh:"video"===t?new dh:new vh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Eh[t]||(Eh[t]=[]),Eh[t].push(e)},removeEventListener:function(t,e){var r=Eh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Eh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new Kf(t)}};Ah.documentElement=new wh,Ah.head=new vh("head"),Ah.body=new xh;var Oh,Sh,Th=nt("isConcatSpreadable"),kh=K>=51||!I((function(){var t=[];return t[Th]=!1,t.concat()[0]!==t})),Ih=function(t){if(!ct(t))return!1;var e=t[Th];return void 0!==e?!!e:ui(t)},jh=!kh||!fi("concat");if(er({target:"Array",proto:!0,arity:1,forced:jh},{concat:function(t){var e,r,n,o,i,a=F(this),u=Ti(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Ih(i=-1===e?a:arguments[e]))for(o=Re(i),Hf(s+o),r=0;r<o;r++,s++)r in i&&si(u,s,i[r]);else Hf(s+1),si(u,s++,i);return u.length=s,u}}),df("match",(function(t,e,r){return[function(e){var r=C(this),n=R(e)?void 0:jt(e,t);return n?bt(n,e,r):new RegExp(e)[t](Gc(r))},function(t){var n=gt(this),o=Gc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return _f(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=_f(n,o));){var f=Gc(u[0]);s[c]=f,""===f&&(n.lastIndex=Ef(o,Le(n.lastIndex),a)),c++}return 0===c?null:s}]})),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Ph=my.getSystemInfoSync();Oh=Ph.system,Ph.platform,Ph.language}else{var _h={versions:(Sh=hf.navigator.userAgent,{trident:Sh.indexOf("Trident")>-1,presto:Sh.indexOf("Presto")>-1,webKit:Sh.indexOf("AppleWebKit")>-1,gecko:Sh.indexOf("Gecko")>-1&&-1===Sh.indexOf("KHTML"),mobile:!!Sh.match(/AppleWebKit.*Mobile.*/),ios:!!Sh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Sh.indexOf("Android")>-1||Sh.indexOf("Linux")>-1,iPhone:Sh.indexOf("iPhone")>-1,iPad:Sh.indexOf("iPad")>-1,webApp:-1===Sh.indexOf("Safari"),weixin:Sh.indexOf("MicroMessenger")>-1,qq:" qq"===Sh.match(/\\sQQ/i)}),language:(hf.navigator.browserLanguage||hf.navigator.language).toLowerCase()};_h.versions.android?"android":_h.versions.trident?"IE":_h.versions.presto?"Opera":_h.versions.webKit?"webKit":_h.versions.gecko?"Firefox":_h.versions.mobile?"mobile":_h.versions.ios?"ios":_h.versions.iPhone?"iPhone":_h.versions.iPad?"ipad":_h.versions.webApp?"webApp":_h.versions.weixin?"weixin":_h.versions.qq&&"qq",Oh=hf.navigator.userAgent,_h.language}Oh.toLowerCase().indexOf("android");Qu("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Mh=L([].join),Lh=we!==Object||!Pi("join",",");er({target:"Array",proto:!0,forced:Lh},{join:function(t){return Mh(Ee(this),void 0===t?",":t)}});var Rh=ji.map,Nh=fi("map");er({target:"Array",proto:!0,forced:!Nh},{map:function(t){return Rh(this,t,arguments.length>1?arguments[1]:void 0)}});var Ch=pl.fastKey,Dh=ie.set,Fh=ie.getterFor;vl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){vr(t,i),Dh(t,{type:e,index:Vi(null),first:void 0,last:void 0,size:0}),st||(t.size=0),R(o)||wo(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Fh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Ch(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),st?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Ch(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key===e)return r};return Ya(i,{clear:function(){for(var t=a(this),e=t.first;e;)e.removed=!0,e.previous&&(e.previous=e.previous.next=void 0),e=e.next;t.first=t.last=void 0,t.index=Vi(null),st?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first===r&&(e.first=n),e.last===r&&(e.last=o),st?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Dr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Ya(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),st&&fr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Fh(e),i=Fh(n);va(t,e,(function(t,e){Dh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?da("keys"===e?r.key:"values"===e?r.value:[r.key,r.value],!1):(t.target=void 0,da(void 0,!0))}),r?"entries":"values",!r,!0),hr(e)}});var Wh=I((function(){Di(1)}));er({target:"Object",stat:!0,forced:Wh},{keys:function(t){return Di(F(t))}});var Bh=new Map,zh=new Map,Uh=new Map,Gh=function(t){function e(){var t;return i(this,e),s(t=o(this,e),"onabort",void 0),s(t,"onerror",void 0),s(t,"onload",void 0),s(t,"onloadstart",void 0),s(t,"onprogress",void 0),s(t,"ontimeout",void 0),s(t,"onloadend",void 0),s(t,"onreadystatechange",void 0),s(t,"readyState",void 0),s(t,"response",void 0),s(t,"responseText",void 0),s(t,"_responseType",void 0),s(t,"responseXML",void 0),s(t,"status",void 0),s(t,"statusText",void 0),s(t,"upload",void 0),s(t,"withCredentials",void 0),s(t,"timeout",void 0),s(t,"_url",void 0),s(t,"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Bh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return f(e,t),u(e,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=Uh.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=zh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return zh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Bh.get("requestHeader");r[t]=e,Bh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}])}(Xl);s(Gh,"UNSEND",void 0),s(Gh,"OPENED",void 0),s(Gh,"HEADERS_RECEIVED",void 0),s(Gh,"LOADING",void 0),s(Gh,"DONE",void 0),Gh.UNSEND=0,Gh.OPENED=1,Gh.HEADERS_RECEIVED=2,Gh.LOADING=3,Gh.DONE=4;var Vh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,qh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Hh=(Vh||qh)&&!1;Hh||hf.XMLHttpRequest,Hh||hf.location;function Zh(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var Yh=ji.filter,$h=fi("filter");function Kh(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function Qh(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Xh(t){return t.filter?[1]:[0]}function Jh(t,e){return[e]}er({target:"Array",proto:!0,forced:!$h},{filter:function(t){return Yh(this,t,arguments.length>1?arguments[1]:void 0)}});var tp=rp,ep=rp;function rp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=np(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=np(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(vp(s));for(c.sort(fp),o=0;o<c.length;o++)r=lp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return ip(h,p,r,n,o,c,0),p}function np(t,e,r,n,o){var i,a;if(o===kp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Op(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Op(i,t[i],t[i+1],a);return a&&mp(a,a.next)&&(Sp(a),a=a.next),a}function op(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!mp(n,n.next)&&0!==gp(n.prev,n,n.next))n=n.next;else{if(Sp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function ip(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=pp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?up(t,n,o,i):ap(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Sp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?ip(t=sp(op(t),e,r),e,r,n,o,i,2):2===a&&cp(t,e,r,n,o,i):ip(op(t),e,r,n,o,i,1);break}}}function ap(t){var e=t.prev,r=t,n=t.next;if(gp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&dp(o,u,i,s,a,c,v.x,v.y)&&gp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function up(t,e,r,n){var o=t.prev,i=t,a=t.next;if(gp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=pp(p,v,e,r,n),m=pp(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&dp(u,f,s,l,c,h,b.x,b.y)&&gp(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&dp(u,f,s,l,c,h,x.x,x.y)&&gp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&dp(u,f,s,l,c,h,b.x,b.y)&&gp(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&dp(u,f,s,l,c,h,x.x,x.y)&&gp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function sp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!mp(o,i)&&bp(o,n,n.next,i)&&Ep(o,i)&&Ep(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Sp(n),Sp(n.next),n=t=i),n=n.next}while(n!==t);return op(n)}function cp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&yp(a,u)){var s=Ap(a,u);return a=op(a,a.next),s=op(s,s.next),ip(a,e,r,n,o,i,0),void ip(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function fp(t,e){return t.x-e.x}function lp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&dp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Ep(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&hp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Ap(r,t);return op(n,n.next),op(r,r.next)}function hp(t,e){return gp(t.prev,t,e.prev)<0&&gp(e.next,t,t.next)<0}function pp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function dp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function yp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&bp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Ep(t,e)&&Ep(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(gp(t.prev,t,e.prev)||gp(t,e.prev,e))||mp(t,e)&&gp(t.prev,t,t.next)>0&&gp(e.prev,e,e.next)>0)}function gp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function mp(t,e){return t.x===e.x&&t.y===e.y}function bp(t,e,r,n){var o=wp(gp(t,e,r)),i=wp(gp(t,e,n)),a=wp(gp(r,n,t)),u=wp(gp(r,n,e));return o!==i&&a!==u||(!(0!==o||!xp(t,r,e))||(!(0!==i||!xp(t,n,e))||(!(0!==a||!xp(r,t,n))||!(0!==u||!xp(r,e,n)))))}function xp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function wp(t){return t>0?1:t<0?-1:0}function Ep(t,e){return gp(t.prev,t,t.next)<0?gp(t,e,t.next)>=0&&gp(t,t.prev,e)>=0:gp(t,e,t.prev)<0||gp(t,t.next,e)<0}function Ap(t,e){var r=new Tp(t.i,t.x,t.y),n=new Tp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Op(t,e,r,n){var o=new Tp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Sp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Tp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}rp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(kp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(kp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},rp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},tp.default=ep;var Ip=A,jp=L(1..valueOf),Pp="\\t\\n\\v\\f\\r Â áââââââââââââ¯âã\\u2028\\u2029\\ufeff",_p=L("".replace),Mp=RegExp("^["+Pp+"]+"),Lp=RegExp("(^|[^"+Pp+"])["+Pp+"]+$"),Rp=function(t){return function(e){var r=Gc(C(e));return 1&t&&(r=_p(r,Mp,"")),2&t&&(r=_p(r,Lp,"$1")),r}},Np={start:Rp(1),end:Rp(2),trim:Rp(3)},Cp=Ue.f,Dp=Oe.f,Fp=Ft.f,Wp=Np.trim,Bp=A.Number,zp=(Ip.Number,Bp.prototype),Up=A.TypeError,Gp=L("".slice),Vp=L("".charCodeAt),qp=function(t){var e=Lt(t,"number");return"bigint"==typeof e?e:Hp(e)},Hp=function(t){var e,r,n,o,i,a,u,s,c=Lt(t,"number");if(Ot(c))throw new Up("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Wp(c),43===(e=Vp(c,0))||45===e){if(88===(r=Vp(c,2))||120===r)return NaN}else if(48===e){switch(Vp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=Gp(c,2)).length,u=0;u<a;u++)if((s=Vp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},Zp=Je("Number",!Bp(" 0o1")||!Bp("0b1")||Bp("+0x1")),Yp=function(t){return Et(zp,t)&&I((function(){jp(t)}))},$p=function(t){var e=arguments.length<1?0:Bp(qp(t));return Yp(this)?su(Object(e),this,$p):e};$p.prototype=zp,Zp&&(zp.constructor=$p),er({global:!0,constructor:!0,wrap:!0,forced:Zp},{Number:$p});Zp&&function(t,e){for(var r,n=st?Cp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)B(e,r=n[o])&&!B(t,r)&&Fp(t,r,Dp(e,r))}(Ip.Number,Bp);var Kp=RangeError,Qp=RangeError,Xp=String,Jp=Math.floor,tv=L((function(t){var e=Gc(C(this)),r="",n=Ie(t);if(n<0||n===1/0)throw new Kp("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),ev=L("".slice),rv=L(1..toFixed),nv=function(t,e,r){return 0===e?r:e%2==1?nv(t,e-1,r*t):nv(t*t,e/2,r)},ov=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=Jp(o/1e7)},iv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=Jp(n/e),n=n%e*1e7},av=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=Xp(t[e]);r=""===r?n:r+tv("0",7-n.length)+n}return r},uv=I((function(){return"0.000"!==rv(8e-5,3)||"1"!==rv(.9,0)||"1.25"!==rv(1.255,2)||"1000000000000000128"!==rv(0xde0b6b3a7640080,0)}))||!I((function(){rv({})}));function sv(t){return"number"==typeof t}er({target:"Number",proto:!0,forced:uv},{toFixed:function(t){var e,r,n,o,i=jp(this),a=Ie(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw new Qp("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return Xp(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*nv(2,69,1))-69)<0?i*nv(2,-e,1):i/nv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(ov(u,0,r),n=a;n>=7;)ov(u,1e7,0),n-=7;for(ov(u,nv(10,n,1),0),n=e-1;n>=23;)iv(u,1<<23),n-=23;iv(u,1<<n),ov(u,1,1),iv(u,2),c=av(u)}else ov(u,0,r),ov(u,1<<-e,0),c=av(u)+tv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+tv("0",a-o)+c:ev(c,0,o-a)+"."+ev(c,o-a)):s+c}});var cv=A.isFinite,fv=Number.isFinite||function(t){return"number"==typeof t&&cv(t)};er({target:"Number",stat:!0},{isFinite:fv});var lv="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var hv=Math.log,pv=Math.LN2;function vv(){var t=new lv(2);return lv!=Float32Array&&(t[0]=0,t[1]=0),t}function dv(t,e){var r=new lv(2);return r[0]=t,r[1]=e,r}function yv(t,e){return t[0]=e[0],t[1]=e[1],t}function gv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function mv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function bv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function xv(t,e){return t[0]*e[0]+t[1]*e[1]}er({target:"Math",stat:!0},{log2:function(t){return hv(t)/pv}});var wv,Ev=mv;wv=vv();function Av(t){var e=function(t){return Math.pow(2,t)}(t);return function(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}(Number.isFinite(e)),512*e}function Ov(t,e){if(t){var r=v(t||[],2),n=r[0],o=r[1];return e.getCRS().fromWGS84([n,o])}}var Sv={};function Tv(t){return function(t,e,r,n){var o=[t[0],t[1]],i=t.slice(2);if(!e)return t;var a=e.getZoom(),u=Ov(o,e),s=function(t){return t.getCRS().getExtent()}(e),c=r||Av(a),f=s[2]-s[0],l=s[3]-s[1],h=n?Ov(n,e):[s[0],s[3]],p=(u[0]-h[0])/f;return o[0]>180&&(p+=1),o[0]<-180&&(p-=1),[p*c,(h[1]-u[1])/l*c].concat(d(i))}(t,Sv.map,256*Math.pow(2,20))}var kv=RegExp.prototype,Iv=Ut.PROPER,jv=RegExp.prototype,Pv=jv.toString,_v=I((function(){return"/a/b"!==Pv.call({source:"a",flags:"b"})})),Mv=Iv&&"toString"!==Pv.name;(_v||Mv)&&ue(jv,"toString",(function(){var t=gt(this);return"/"+Gc(t.source)+"/"+Gc(function(t){var e=t.flags;return void 0!==e||"flags"in kv||B(t,"flags")||!Et(kv,t)?e:bt(Vc,t)}(t))}),{unsafe:!0});var Lv,Rv=/"/g,Nv=L("".replace);er({target:"String",proto:!0,forced:(Lv="sub",I((function(){var t=""[Lv](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=Gc(C(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+Nv(Gc(r),Rv,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Cv=vv(),Dv=(vv(),vv()),Fv=vv(),Wv=vv();function Bv(t,e,r,n,o){return gv(t,r,n),bv(t,t),[o/xv(e=dv(-t[1],t[0]),dv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Uv(t,e,r){return Ev(t,e,r),bv(t,t),t}function Gv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Vv=function(){return u((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",dv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}),[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(d(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var y=0;y<r.positions.length/6;y++)r.positions[6*y+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(d(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var y=0;y<r.positions.length/6;y++)r.positions[6*y+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,y=Tv([a[0],a[1]]),g=Tv([i[0],i[1]]);Uv(Dv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(y,g),this.totalDistance+=m),this.normal||(this.normal=vv(),zv(this.normal,Dv)),!this.started)if(this.started=!0,h){var b=vv(),x=vv();gv(b,this.normal,Dv),gv(x,this.normal,Dv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Gv(n,o)&&gv(o,n,bv(o,mv(o,n,r))),Uv(Fv,o,n);var w=v(Bv(Wv,vv(),Dv,Fv,this.thickness),2),E=w[0],A=w[1],O=xv(Wv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,d(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Fv),yv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,yv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Dv),h){var T=vv(),k=vv();Ev(k,Dv,this.normal),gv(T,Dv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=Tv([n[0],n[1]]),f=Tv([r[0],r[1]]);Uv(Dv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=vv(),zv(this.normal,Dv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=Tv([o[0],o[1]]);Gv(c,h)&&gv(h,c,bv(h,mv(h,c,f))),Uv(Fv,h,c);var p=v(Bv(Wv,vv(),Dv,Fv,this.thickness),2),y=p[0],g=p[1];xv(Wv,this.normal);this.extrusions(u,s,n,g,y,this.totalDistance),a.push.apply(a,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,yv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Dv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=Tv([n[0],n[1]]),h=Tv([r[0],r[1]]);Uv(Dv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=vv(),zv(this.normal,Dv)),!this.started)if(this.started=!0,c){var y=vv(),g=vv();gv(y,this.normal,Dv),gv(g,this.normal,Dv),s.push(g[0],g[1],0),s.push(y[0],y[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=Tv([o[0],o[1]]);Gv(l,m)&&gv(m,l,bv(m,mv(m,l,h))),Uv(Fv,m,l);var b=v(Bv(Wv,vv(),Dv,Fv,this.thickness),2),x=b[0],w=b[1],E=xv(Wv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,d(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Fv),yv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,yv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Dv),c){var O=vv(),S=vv();Ev(S,Dv,this.normal),gv(O,Dv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,d(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}])}();function qv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Vv({dash:!0,join:"bevel"});if("GAODE2.x"===n||"MAPBOX"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Hv(t){var e=function(t){if(sv(t[0]))return t;if(sv(t[0][0]))throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨");if(sv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨")}(t.coordinates);return{vertices:[].concat(d(e),d(e),d(e),d(e)),indices:[0,1,2,2,3,0],size:e.length}}function Zv(t){var e=t.coordinates,r=tp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:tp(n,i,o),vertices:n,size:o}}var Yv=function(){var t=n(h().mark((function t(e){var r,n,o,i,a,u,s,c,f;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.descriptors,n=e.features,o=e.enablePicking,i=e.iconMap,a={a_Color:Kh,a_Position:Qh,filter:Xh,a_vertexId:Jh,a_PickingColor:function(t){var e=t.id;return o?Zh(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=i[e]||{x:0,y:0};return[r.x,r.y]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,n.forEach((function(t,e){var n=qv(t),o=n.indices,i=n.vertices,l=n.normals,h=n.size,p=n.indexes;o.forEach((function(t){c.push(t+s)})),f=h;var v=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=v;for(var y=function(n){var o=(null==l?void 0:l.slice(3*n,3*n+3))||[],u=i.slice(n*h,n*h+h),s=0;p&&void 0!==p[n]&&(s=p[n]),r.forEach((function(r){var i;r&&a[r.name]&&(i=r.buffer.data).push.apply(i,d(a[r.name](t,e,u,n,o,s)))}))},g=0;g<v;g++)y(g)})),t.abrupt("return",{descriptors:r,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),$v={pointFill:function(){var t=n(h().mark((function t(e){var r,n,o,i,a,u,s,c,f;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.descriptors,n=e.features,o=e.enablePicking,i=e.shape2d,a={a_Color:Kh,a_Position:Qh,filter:Xh,a_vertexId:Jh,a_PickingColor:function(t){var e=t.id;return o?Zh(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[i.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,n.forEach((function(t,e){var n=Hv(t),o=n.indices,i=n.vertices,l=n.normals,h=n.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(n){var o=[],u=i.slice(n*h,n*h+h);r.forEach((function(r){var i;r&&a[r.name]&&(i=r.buffer.data).push.apply(i,d(a[r.name](t,e,u,n,o,0)))}))},y=0;y<p;y++)v(y)})),t.abrupt("return",{descriptors:r,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Yv,polygonFill:function(){var t=n(h().mark((function t(e){var r,n,o,i,a,u,s,c;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.descriptors,n=e.features,o=e.enablePicking,i={a_Color:Kh,a_Position:Qh,filter:Xh,a_vertexId:Jh,a_PickingColor:function(t){var e=t.id;return o?Zh(e):[0,0,0]}},a={sizePerElement:0,elements:[]},u=0,s=[],c=3,n.forEach((function(t,e){var n=Zv(t),o=n.indices,f=n.vertices,l=n.normals,h=n.size;o.forEach((function(t){s.push(t+u)})),c=h;var p=f.length/h;a.sizePerElement=c,a.elements.push({featureIdx:e,vertices:f,normals:l,offset:u}),u+=p;for(var v=function(n){var o=[],a=f.slice(n*h,n*h+h);r.forEach((function(r){var u;r&&i[r.name]&&(u=r.buffer.data).push.apply(u,d(i[r.name](t,e,a,n,o,0)))}))},y=0;y<p;y++)v(y)})),t.abrupt("return",{descriptors:r,featureLayout:a,indices:s});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Kv=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},$v);function Qv(t){return Xv.apply(this,arguments)}function Xv(){return(Xv=n(h().mark((function t(e){var r,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.workerType,n=e.data,!Kv[r]){t.next=3;break}return t.abrupt("return",Kv[r](n));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(r,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return ii(Qv),t.WorkerSourceMap=$v,t.createWorker=ii,t.worker=Qv,t}({});\n');var sA=lA,uA=lA,cA=1e20;function lA(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function hA(e,t,n,r,i,o){for(var a=0;a<t;a++)fA(e,a,t,n,r,i,o);for(var s=0;s<n;s++)fA(e,s*t,1,t,r,i,o)}function fA(e,t,n,r,i,o,a){var s,u,c,l;for(o[0]=0,a[0]=-cA,a[1]=cA,s=0;s<r;s++)i[s]=e[t+s*n];for(s=1,u=0,c=0;s<r;s++){do{l=o[u],c=(i[s]-i[l]+s*s-l*l)/(s-l)/2}while(c<=a[u]&&--u>-1);o[++u]=s,a[u]=c,a[u+1]=cA}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;l=o[u],e[t+s*n]=i[l]+(s-l)*(s-l)}}lA.prototype._draw=function(e,t){var n,r,i,o,a,s,u,c,l,h=this.ctx.measureText(e),f=h.width,p=2*this.buffer;t&&this.useMetrics?(a=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,i=(o=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=o=this.size,a=19*this.fontSize/24,s=u=0,c=this.middle,this.ctx.textBaseline="middle"),r&&o&&(this.ctx.clearRect(u,s,r,o),this.ctx.fillText(e,this.buffer,c),l=this.ctx.getImageData(u,s,r,o));var d=new Uint8ClampedArray(n*i);return function(e,t,n,r,i,o,a){o.fill(cA,0,t*n),a.fill(0,0,t*n);for(var s=(t-r)/2,u=0;u<i;u++)for(var c=0;c<r;c++){var l=(u+s)*t+c+s,h=e.data[4*(u*r+c)+3]/255;if(1===h)o[l]=0,a[l]=cA;else if(0===h)o[l]=cA,a[l]=0;else{var f=Math.max(0,.5-h),p=Math.max(0,h-.5);o[l]=f*f,a[l]=p*p}}}(l,n,i,r,o,this.gridOuter,this.gridInner),hA(this.gridOuter,n,i,this.f,this.v,this.z),hA(this.gridInner,n,i,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(d,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:r,height:o,sdfWidth:n,sdfHeight:i,top:a,left:0,advance:f}}},lA.prototype.draw=function(e){return this._draw(e,!1).data},lA.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},sA.default=uA;var pA;function dA(e,t,n){var r,i=h(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=_(_({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function vA(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var gA=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function mA(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function yA(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var _A=Ce()(pA=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"fontAtlas",void 0),f(e,"iconFontMap",void 0),f(e,"iconFontGlyphs",{}),f(e,"fontOptions",void 0),f(e,"key",void 0),f(e,"cache",new bx(3)),e}return v(t,e),l(t,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:gA,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=_(_({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("å½åç¯å¢ä¸æ¯æ document.fonts !"),console.warn("å½åç¯å¢ä¸æ¯æ iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,l=r.cutoff,f=r.iconfont,p=n&&n.data;p||((p=Ad.document.createElement("canvas")).width=1024);var d=p.getContext("2d",{willReadFrequently:!0});mA(d,i,a,o);var v=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,c=void 0===u?0:u,l=e.yOffset,h=void 0===l?0:l,f=0,p=c;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,f++),s[e]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:vA(h+(f+1)*d)}}(_({getFontWidth:function(e){return d.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=v.mapping,m=v.canvasHeight,y=v.xOffset,b=v.yOffset,x=d.getImageData(0,0,p.width,p.height);if(p.height=m,d.putImageData(x,0,0),mA(d,i,a,o),u){var S,E=new sA(a,s,c,l,i,o),A=d.getImageData(0,0,E.size,E.size),T=h(t);try{for(T.s();!(S=T.n()).done;){var w=S.value;if(f){var C=String.fromCharCode(parseInt(w.replace("&#x","").replace(";",""),16));yA(E.draw(C),A)}else yA(E.draw(w),A);d.putImageData(A,g[w].x,g[w].y)}}catch(e){T.e(e)}finally{T.f()}}else{var k,M=h(t);try{for(M.s();!(k=M.n()).done;){var P=k.value;d.fillText(P,g[P].x,g[P].y+1*a)}}catch(e){M.e(e)}finally{M.f()}}return{xOffset:y,yOffset:b,mapping:g,data:p,width:p.width,height:p.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}])}(N))||pA,bA=Gt("iterator"),xA=!De((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),!t.size&&!Fe||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[bA]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),SA=/[^\0-\u007E]/,EA=/[.\u3002\uFF0E\uFF61]/g,AA="Overflow: input needs wider integers to process",TA=RangeError,wA=Ze(EA.exec),CA=Math.floor,kA=String.fromCharCode,MA=Ze("".charCodeAt),PA=Ze([].join),IA=Ze([].push),RA=Ze("".replace),OA=Ze("".split),LA=Ze("".toLowerCase),NA=function(e){return e+22+75*(e<26)},DA=function(e,t,n){var r=0;for(e=n?CA(e/700):e>>1,e+=CA(e/t);e>455;)e=CA(e/35),r+=36;return CA(r+36*e/(e+38))},FA=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=MA(e,n++);if(i>=55296&&i<=56319&&n<r){var o=MA(e,n++);56320==(64512&o)?IA(t,((1023&i)<<10)+(1023&o)+65536):(IA(t,i),n--)}else IA(t,i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&IA(r,kA(n));var u=r.length,c=u;for(u&&IA(r,"-");c<i;){var l=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var h=c+1;if(l-o>CA((2147483647-a)/h))throw new TA(AA);for(a+=(l-o)*h,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw new TA(AA);if(n===o){for(var f=a,p=36;;){var d=p<=s?1:p>=s+26?26:p-s;if(f<d)break;var v=f-d,g=36-d;IA(r,kA(NA(d+v%g))),f=CA(v/g),p+=36}IA(r,kA(NA(f))),s=DA(a,h,c===u),a=0,c++}}a++,o++}return PA(r,"")},zA=Gt("iterator"),BA=kn.set,jA=kn.getterFor("URLSearchParams"),UA=kn.getterFor("URLSearchParamsIterator"),VA=ys("fetch"),GA=ys("Request"),HA=ys("Headers"),WA=GA&&GA.prototype,YA=HA&&HA.prototype,XA=Ne.RegExp,ZA=Ne.TypeError,qA=Ne.decodeURIComponent,KA=Ne.encodeURIComponent,QA=Ze("".charAt),$A=Ze([].join),JA=Ze([].push),eT=Ze("".replace),tT=Ze([].shift),nT=Ze([].splice),rT=Ze("".split),iT=Ze("".slice),oT=/\+/g,aT=Array(4),sT=function(e){return aT[e-1]||(aT[e-1]=XA("((?:%[\\da-f]{2}){"+e+"})","gi"))},uT=function(e){try{return qA(e)}catch(t){return e}},cT=function(e){var t=eT(e,oT," "),n=4;try{return qA(t)}catch(e){for(;n;)t=eT(t,sT(n--),uT);return t}},lT=/[!'()~]|%20/g,hT={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},fT=function(e){return hT[e]},pT=function(e){return eT(KA(e),lT,fT)},dT=fi((function(e,t){BA(this,{type:"URLSearchParamsIterator",target:jA(e).entries,index:0,kind:t})}),"URLSearchParams",(function(){var e=UA(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,Ai(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Ai(r.key,!1);case"values":return Ai(r.value,!1)}return Ai([r.key,r.value],!1)}),!0),vT=function(e){this.entries=[],this.url=null,void 0!==e&&(st(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===QA(e,0)?iT(e,1):e:wo(e)))};vT.prototype={type:"URLSearchParams",bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,u=this.entries,c=$i(e);if(c)for(n=(t=eo(e,c)).next;!(r=je(n,t)).done;){if(o=(i=eo(rn(r.value))).next,(a=je(o,i)).done||(s=je(o,i)).done||!je(o,i).done)throw new ZA("Expected sequence with length 2");JA(u,{key:wo(a.value),value:wo(s.value)})}else for(var l in e)Nt(e,l)&&JA(u,{key:l,value:wo(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=rT(e,"&"),o=0;o<i.length;)(t=i[o++]).length&&(n=rT(t,"="),JA(r,{key:cT(tT(n)),value:cT($A(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],JA(n,pT(e.key)+"="+pT(e.value));return $A(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var gT=function(){so(this,mT);var e=arguments.length>0?arguments[0]:void 0,t=BA(this,new vT(e));Fe||(this.size=t.entries.length)},mT=gT.prototype;if(go(mT,{append:function(e,t){var n=jA(this);ts(arguments.length,2),JA(n.entries,{key:wo(e),value:wo(t)}),Fe||this.length++,n.updateURL()},delete:function(e){for(var t=jA(this),n=ts(arguments.length,1),r=t.entries,i=wo(e),o=n<2?void 0:arguments[1],a=void 0===o?o:wo(o),s=0;s<r.length;){var u=r[s];if(u.key!==i||void 0!==a&&u.value!==a)s++;else if(nT(r,s,1),void 0!==a)break}Fe||(this.size=r.length),t.updateURL()},get:function(e){var t=jA(this).entries;ts(arguments.length,1);for(var n=wo(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=jA(this).entries;ts(arguments.length,1);for(var n=wo(e),r=[],i=0;i<t.length;i++)t[i].key===n&&JA(r,t[i].value);return r},has:function(e){for(var t=jA(this).entries,n=ts(arguments.length,1),r=wo(e),i=n<2?void 0:arguments[1],o=void 0===i?i:wo(i),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var n=jA(this);ts(arguments.length,1);for(var r,i=n.entries,o=!1,a=wo(e),s=wo(t),u=0;u<i.length;u++)(r=i[u]).key===a&&(o?nT(i,u--,1):(o=!0,r.value=s));o||JA(i,{key:a,value:s}),Fe||(this.size=i.length),n.updateURL()},sort:function(){var e=jA(this);kh(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=jA(this).entries,r=Xi(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new dT(this,"keys")},values:function(){return new dT(this,"values")},entries:function(){return new dT(this,"entries")}},{enumerable:!0}),Pn(mT,zA,mT.entries,{name:"entries"}),Pn(mT,"toString",(function(){return jA(this).serialize()}),{enumerable:!0}),Fe&&Pi(mT,"size",{get:function(){return jA(this).entries.length},configurable:!0,enumerable:!0}),ci(gT,"URLSearchParams"),sr({global:!0,constructor:!0,forced:!xA},{URLSearchParams:gT}),!xA&&at(HA)){var yT=Ze(YA.has),_T=Ze(YA.set),bT=function(e){if(st(e)){var t,n=e.body;if("URLSearchParams"===mr(n))return t=e.headers?new HA(e.headers):new HA,yT(t,"content-type")||_T(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Hr(e,{body:He(0,wo(n)),headers:He(0,t)})}return e};if(at(VA)&&sr({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return VA(e,arguments.length>1?bT(arguments[1]):{})}}),at(GA)){var xT=function(e){return so(this,WA),new GA(e,arguments.length>1?bT(arguments[1]):{})};WA.constructor=xT,xT.prototype=WA,sr({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:xT})}}var ST,ET={URLSearchParams:gT,getState:jA},AT=$o.codeAt,TT=kn.set,wT=kn.getterFor("URL"),CT=ET.URLSearchParams,kT=ET.getState,MT=Ne.URL,PT=Ne.TypeError,IT=Ne.parseInt,RT=Math.floor,OT=Math.pow,LT=Ze("".charAt),NT=Ze(/./.exec),DT=Ze([].join),FT=Ze(1..toString),zT=Ze([].pop),BT=Ze([].push),jT=Ze("".replace),UT=Ze([].shift),VT=Ze("".split),GT=Ze("".slice),HT=Ze("".toLowerCase),WT=Ze([].unshift),YT=/[a-z]/i,XT=/[\d+-.a-z]/i,ZT=/\d/,qT=/^0x/i,KT=/^[0-7]+$/,QT=/^\d+$/,$T=/^[\da-f]+$/i,JT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ew=/[\0\t\n\r #/:<>?@[\\\]^|]/,tw=/^[\u0000-\u0020]+/,nw=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,rw=/[\t\n\r]/g,iw=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)WT(t,e%256),e=RT(e/256);return DT(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=FT(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},ow={},aw=xf({},ow,{" ":1,'"':1,"<":1,">":1,"`":1}),sw=xf({},aw,{"#":1,"?":1,"{":1,"}":1}),uw=xf({},sw,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),cw=function(e,t){var n=AT(e,0);return n>32&&n<127&&!Nt(t,e)?e:encodeURIComponent(e)},lw={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hw=function(e,t){var n;return 2===e.length&&NT(YT,LT(e,0))&&(":"===(n=LT(e,1))||!t&&"|"===n)},fw=function(e){var t;return e.length>1&&hw(GT(e,0,2))&&(2===e.length||"/"===(t=LT(e,2))||"\\"===t||"?"===t||"#"===t)},pw=function(e){return"."===e||"%2e"===HT(e)},dw={},vw={},gw={},mw={},yw={},_w={},bw={},xw={},Sw={},Ew={},Aw={},Tw={},ww={},Cw={},kw={},Mw={},Pw={},Iw={},Rw={},Ow={},Lw={},Nw=function(e,t,n){var r,i,o,a=wo(e);if(t){if(i=this.parse(a))throw new PT(i);this.searchParams=null}else{if(void 0!==n&&(r=new Nw(n,!0)),i=this.parse(a,null,r))throw new PT(i);(o=kT(new CT)).bindURL(this),this.searchParams=o}};Nw.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,u=this,c=t||dw,l=0,h="",f=!1,p=!1,d=!1;for(e=wo(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=jT(e,tw,""),e=jT(e,nw,"$1")),e=jT(e,rw,""),r=xS(e);l<=r.length;){switch(i=r[l],c){case dw:if(!i||!NT(YT,i)){if(t)return"Invalid scheme";c=gw;continue}h+=HT(i),c=vw;break;case vw:if(i&&(NT(XT,i)||"+"===i||"-"===i||"."===i))h+=HT(i);else{if(":"!==i){if(t)return"Invalid scheme";h="",c=gw,l=0;continue}if(t&&(u.isSpecial()!==Nt(lw,h)||"file"===h&&(u.includesCredentials()||null!==u.port)||"file"===u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&lw[u.scheme]===u.port&&(u.port=null));h="","file"===u.scheme?c=Cw:u.isSpecial()&&n&&n.scheme===u.scheme?c=mw:u.isSpecial()?c=xw:"/"===r[l+1]?(c=yw,l++):(u.cannotBeABaseURL=!0,BT(u.path,""),c=Rw)}break;case gw:if(!n||n.cannotBeABaseURL&&"#"!==i)return"Invalid scheme";if(n.cannotBeABaseURL&&"#"===i){u.scheme=n.scheme,u.path=Di(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,c=Lw;break}c="file"===n.scheme?Cw:_w;continue;case mw:if("/"!==i||"/"!==r[l+1]){c=_w;continue}c=Sw,l++;break;case yw:if("/"===i){c=Ew;break}c=Iw;continue;case _w:if(u.scheme=n.scheme,i===ST)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Di(n.path),u.query=n.query;else if("/"===i||"\\"===i&&u.isSpecial())c=bw;else if("?"===i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Di(n.path),u.query="",c=Ow;else{if("#"!==i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Di(n.path),u.path.length--,c=Iw;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Di(n.path),u.query=n.query,u.fragment="",c=Lw}break;case bw:if(!u.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,c=Iw;continue}c=Ew}else c=Sw;break;case xw:if(c=Sw,"/"!==i||"/"!==LT(h,l+1))continue;l++;break;case Sw:if("/"!==i&&"\\"!==i){c=Ew;continue}break;case Ew:if("@"===i){f&&(h="%40"+h),f=!0,o=xS(h);for(var v=0;v<o.length;v++){var g=o[v];if(":"!==g||d){var m=cw(g,uw);d?u.password+=m:u.username+=m}else d=!0}h=""}else if(i===ST||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()){if(f&&""===h)return"Invalid authority";l-=xS(h).length+1,h="",c=Aw}else h+=i;break;case Aw:case Tw:if(t&&"file"===u.scheme){c=Mw;continue}if(":"!==i||p){if(i===ST||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()){if(u.isSpecial()&&""===h)return"Invalid host";if(t&&""===h&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(h))return a;if(h="",c=Pw,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),h+=i}else{if(""===h)return"Invalid host";if(a=u.parseHost(h))return a;if(h="",c=ww,t===Tw)return}break;case ww:if(!NT(ZT,i)){if(i===ST||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()||t){if(""!==h){var y=IT(h,10);if(y>65535)return"Invalid port";u.port=u.isSpecial()&&y===lw[u.scheme]?null:y,h=""}if(t)return;c=Pw;continue}return"Invalid port"}h+=i;break;case Cw:if(u.scheme="file","/"===i||"\\"===i)c=kw;else{if(!n||"file"!==n.scheme){c=Iw;continue}switch(i){case ST:u.host=n.host,u.path=Di(n.path),u.query=n.query;break;case"?":u.host=n.host,u.path=Di(n.path),u.query="",c=Ow;break;case"#":u.host=n.host,u.path=Di(n.path),u.query=n.query,u.fragment="",c=Lw;break;default:fw(DT(Di(r,l),""))||(u.host=n.host,u.path=Di(n.path),u.shortenPath()),c=Iw;continue}}break;case kw:if("/"===i||"\\"===i){c=Mw;break}n&&"file"===n.scheme&&!fw(DT(Di(r,l),""))&&(hw(n.path[0],!0)?BT(u.path,n.path[0]):u.host=n.host),c=Iw;continue;case Mw:if(i===ST||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&hw(h))c=Iw;else if(""===h){if(u.host="",t)return;c=Pw}else{if(a=u.parseHost(h))return a;if("localhost"===u.host&&(u.host=""),t)return;h="",c=Pw}continue}h+=i;break;case Pw:if(u.isSpecial()){if(c=Iw,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==ST&&(c=Iw,"/"!==i))continue}else u.fragment="",c=Lw;else u.query="",c=Ow;break;case Iw:if(i===ST||"/"===i||"\\"===i&&u.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=HT(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"===i||"\\"===i&&u.isSpecial()||BT(u.path,"")):pw(h)?"/"===i||"\\"===i&&u.isSpecial()||BT(u.path,""):("file"===u.scheme&&!u.path.length&&hw(h)&&(u.host&&(u.host=""),h=LT(h,0)+":"),BT(u.path,h)),h="","file"===u.scheme&&(i===ST||"?"===i||"#"===i))for(;u.path.length>1&&""===u.path[0];)UT(u.path);"?"===i?(u.query="",c=Ow):"#"===i&&(u.fragment="",c=Lw)}else h+=cw(i,sw);break;case Rw:"?"===i?(u.query="",c=Ow):"#"===i?(u.fragment="",c=Lw):i!==ST&&(u.path[0]+=cw(i,ow));break;case Ow:t||"#"!==i?i!==ST&&("'"===i&&u.isSpecial()?u.query+="%27":u.query+="#"===i?"%23":cw(i,ow)):(u.fragment="",c=Lw);break;case Lw:i!==ST&&(u.fragment+=cw(i,aw))}l++}},parseHost:function(e){var t,n,r;if("["===LT(e,0)){if("]"!==LT(e,e.length-1))return"Invalid host";if(!(t=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,h=0,f=function(){return LT(e,h)};if(":"===f()){if(":"!==LT(e,1))return;h+=2,l=++c}for(;f();){if(8===c)return;if(":"!==f()){for(t=n=0;n<4&&NT($T,f());)t=16*t+IT(f(),16),h++,n++;if("."===f()){if(0===n)return;if(h-=n,c>6)return;for(r=0;f();){if(i=null,r>0){if(!("."===f()&&r<4))return;h++}if(!NT(ZT,f()))return;for(;NT(ZT,f());){if(o=IT(f(),10),null===i)i=o;else{if(0===i)return;i=10*i+o}if(i>255)return;h++}u[c]=256*u[c]+i,2!==++r&&4!==r||c++}if(4!==r)return;break}if(":"===f()){if(h++,!f())return}else if(f())return;u[c++]=t}else{if(null!==l)return;h++,l=++c}}if(null!==l)for(a=c-l,c=7;0!==c&&a>0;)s=u[c],u[c--]=u[l+a-1],u[l+--a]=s;else if(8!==c)return;return u}(GT(e,1,-1))))return"Invalid host";this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=OA(RA(LA(e),EA,"."),".");for(t=0;t<i.length;t++)n=i[t],IA(r,wA(SA,n)?"xn--"+FA(n):n);return PA(r,".")}(e),NT(JT,e))return"Invalid host";if(null===(t=function(e){var t,n,r,i,o,a,s,u=VT(e,".");if(u.length&&""===u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=u[r]))return e;if(o=10,i.length>1&&"0"===LT(i,0)&&(o=NT(qT,i)?16:8,i=GT(i,8===o?1:2)),""===i)a=0;else{if(!NT(10===o?QT:8===o?KT:$T,i))return e;a=IT(i,o)}BT(n,a)}for(r=0;r<t;r++)if(a=n[r],r===t-1){if(a>=OT(256,5-t))return null}else if(a>255)return null;for(s=zT(n),r=0;r<n.length;r++)s+=n[r]*OT(256,3-r);return s}(e)))return"Invalid host";this.host=t}else{if(NT(ew,e))return"Invalid host";for(t="",n=xS(e),r=0;r<n.length;r++)t+=cw(n[r],ow);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return Nt(lw,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&hw(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=iw(i),null!==o&&(c+=":"+o)):"file"===t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+DT(a,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw new PT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Fw(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+iw(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(wo(e)+":",dw)},getUsername:function(){return this.username},setUsername:function(e){var t=xS(wo(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=cw(t[n],uw)}},getPassword:function(){return this.password},setPassword:function(e){var t=xS(wo(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=cw(t[n],uw)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?iw(e):iw(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Aw)},getHostname:function(){var e=this.host;return null===e?"":iw(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Tw)},getPort:function(){var e=this.port;return null===e?"":wo(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=wo(e))?this.port=null:this.parse(e,ww))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+DT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Pw))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=wo(e))?this.query=null:("?"===LT(e,0)&&(e=GT(e,1)),this.query="",this.parse(e,Ow)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=wo(e))?("#"===LT(e,0)&&(e=GT(e,1)),this.fragment="",this.parse(e,Lw)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Dw,Fw=function(e){var t=so(this,zw),n=ts(arguments.length,1)>1?arguments[1]:void 0,r=TT(t,new Nw(e,!1,n));Fe||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},zw=Fw.prototype,Bw=function(e,t){return{get:function(){return wT(this)[e]()},set:t&&function(e){return wT(this)[t](e)},configurable:!0,enumerable:!0}};if(Fe&&(Pi(zw,"href",Bw("serialize","setHref")),Pi(zw,"origin",Bw("getOrigin")),Pi(zw,"protocol",Bw("getProtocol","setProtocol")),Pi(zw,"username",Bw("getUsername","setUsername")),Pi(zw,"password",Bw("getPassword","setPassword")),Pi(zw,"host",Bw("getHost","setHost")),Pi(zw,"hostname",Bw("getHostname","setHostname")),Pi(zw,"port",Bw("getPort","setPort")),Pi(zw,"pathname",Bw("getPathname","setPathname")),Pi(zw,"search",Bw("getSearch","setSearch")),Pi(zw,"searchParams",Bw("getSearchParams")),Pi(zw,"hash",Bw("getHash","setHash"))),Pn(zw,"toJSON",(function(){return wT(this).serialize()}),{enumerable:!0}),Pn(zw,"toString",(function(){return wT(this).serialize()}),{enumerable:!0}),MT){var jw=MT.createObjectURL,Uw=MT.revokeObjectURL;jw&&Pn(Fw,"createObjectURL",Xi(jw,MT)),Uw&&Pn(Fw,"revokeObjectURL",Xi(Uw,MT))}ci(Fw,"URL"),sr({global:!0,constructor:!0,forced:!xA,sham:!Fe},{URL:Fw}),sr({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return je(URL.prototype.toString,this)}});var Vw,Gw=Ce()(Dw=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"canvasHeight",128),f(e,"texture",void 0),f(e,"canvas",void 0),f(e,"iconData",void 0),f(e,"iconMap",void 0),f(e,"ctx",void 0),f(e,"loadingImageCount",0),e}return v(t,e),l(t,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ad.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(n=o(x().mark((function e(t,n){var r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,c=void 0===u?64:u,l=Math.max(s,c)/64,h=c/l,f=s/l;o&&e.ctx.drawImage(o,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},c=h(e);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!u[l.id]){var f=l.size;i+f+t>n&&(dA(u,s,o),i=0,o=a+o+t,a=0,s=[]),s.push({icon:l,xOffset:i}),i=i+f+t,a=Math.max(a,f)}}}catch(e){c.e(e)}finally{c.f()}return s.length>0&&dA(u,s,o),{mapping:u,canvasHeight:vA(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]);var n}(N))||Dw,Hw=Ce()(Vw=function(){return l((function e(){s(this,e),f(this,"viewport",void 0),f(this,"overridedViewProjectionMatrix",void 0),f(this,"jitteredViewProjectionMatrix",void 0),f(this,"jitteredProjectionMatrix",void 0),f(this,"viewMatrixInverse",void 0),f(this,"cameraPosition",void 0)}),[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=n_(),a_(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=E(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=p_(n_(),[e,t,0]);this.jitteredProjectionMatrix=s_(n_(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=s_(n_(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}])}())||Vw,Ww=Og.values;sr({target:"Object",stat:!0},{values:function(e){return Ww(e)}});var Yw,Xw,Zw,qw=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Kw={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Qw=Ce()(Yw=function(){return l((function e(){s(this,e),f(this,"container",void 0),f(this,"controlCorners",void 0),f(this,"controlContainer",void 0),f(this,"scene",void 0),f(this,"mapsService",void 0),f(this,"controls",[]),f(this,"unAddControls",[])}),[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(Oe.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(Oe.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=h(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=Am("div","l7-control-container",this.container);Object.values(qw).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.filter((function(e){return!["row","column"].includes(e)})).join("")]=Am("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(T(o),[Kw[i]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&Tm(this.controlCorners[e]);this.controlContainer&&Tm(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=E(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=E(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}])}())||Yw,$w=Ce()(Xw=function(){return l((function e(){s(this,e),f(this,"container",void 0),f(this,"scene",void 0),f(this,"mapsService",void 0),f(this,"markers",[]),f(this,"markerLayers",[]),f(this,"unAddMarkers",[]),f(this,"unAddMarkerLayers",[])}),[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Oe.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}])}())||Xw,Jw=Ce()(Zw=function(){return l((function e(){s(this,e),f(this,"scene",void 0),f(this,"mapsService",void 0),f(this,"popups",[]),f(this,"unAddPopups",[])}),[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(T(this.popups),T(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Oe.IMapService)}}])}())||Zw;var eC=function(){this.__data__=[],this.size=0};var tC=function(e,t){return e===t||e!=e&&t!=t};var nC=function(e,t){for(var n=e.length;n--;)if(tC(e[n][0],t))return n;return-1},rC=Array.prototype.splice;var iC=function(e){var t=this.__data__,n=nC(t,e);return!(n<0)&&(n==t.length-1?t.pop():rC.call(t,n,1),--this.size,!0)};var oC=function(e){var t=this.__data__,n=nC(t,e);return n<0?void 0:t[n][1]};var aC=function(e){return nC(this.__data__,e)>-1};var sC=function(e,t){var n=this.__data__,r=nC(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function uC(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}uC.prototype.clear=eC,uC.prototype.delete=iC,uC.prototype.get=oC,uC.prototype.has=aC,uC.prototype.set=sC;var cC=uC;var lC=function(){this.__data__=new cC,this.size=0};var hC=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var fC=function(e){return this.__data__.get(e)};var pC=function(e){return this.__data__.has(e)},dC=ug(Dv,"Map"),vC=ug(Object,"create");var gC=function(){this.__data__=vC?vC(null):{},this.size=0};var mC=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},yC=Object.prototype.hasOwnProperty;var _C=function(e){var t=this.__data__;if(vC){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return yC.call(t,e)?t[e]:void 0},bC=Object.prototype.hasOwnProperty;var xC=function(e){var t=this.__data__;return vC?void 0!==t[e]:bC.call(t,e)};var SC=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=vC&&void 0===t?"__lodash_hash_undefined__":t,this};function EC(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}EC.prototype.clear=gC,EC.prototype.delete=mC,EC.prototype.get=_C,EC.prototype.has=xC,EC.prototype.set=SC;var AC=EC;var TC=function(){this.size=0,this.__data__={hash:new AC,map:new(dC||cC),string:new AC}};var wC=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var CC=function(e,t){var n=e.__data__;return wC(t)?n["string"==typeof t?"string":"hash"]:n.map};var kC=function(e){var t=CC(this,e).delete(e);return this.size-=t?1:0,t};var MC=function(e){return CC(this,e).get(e)};var PC=function(e){return CC(this,e).has(e)};var IC=function(e,t){var n=CC(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function RC(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}RC.prototype.clear=TC,RC.prototype.delete=kC,RC.prototype.get=MC,RC.prototype.has=PC,RC.prototype.set=IC;var OC=RC;var LC=function(e,t){var n=this.__data__;if(n instanceof cC){var r=n.__data__;if(!dC||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new OC(r)}return n.set(e,t),this.size=n.size,this};function NC(e){var t=this.__data__=new cC(e);this.size=t.size}NC.prototype.clear=lC,NC.prototype.delete=hC,NC.prototype.get=fC,NC.prototype.has=pC,NC.prototype.set=LC;var DC=NC;var FC=function(e,t,n){"__proto__"==t&&cg?cg(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var zC=function(e,t,n){(void 0!==n&&!tC(e[t],n)||void 0===n&&!(t in e))&&FC(e,t,n)};var BC=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}(),jC=O((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Dv.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),UC=Dv.Uint8Array;var VC=function(e){var t=new e.constructor(e.byteLength);return new UC(t).set(new UC(e)),t};var GC=function(e,t){var n=t?VC(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},HC=Object.create,WC=function(){function e(){}return function(t){if(!Xv(t))return{};if(HC)return HC(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var YC=function(e,t){return function(n){return e(t(n))}},XC=YC(Object.getPrototypeOf,Object),ZC=Object.prototype;var qC=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ZC)};var KC=function(e){return"function"!=typeof e.constructor||qC(e)?{}:WC(XC(e))};var QC=function(e){return uS(e)&&"[object Arguments]"==Yv(e)},$C=Object.prototype,JC=$C.hasOwnProperty,ek=$C.propertyIsEnumerable,tk=QC(function(){return arguments}())?QC:function(e){return uS(e)&&JC.call(e,"callee")&&!ek.call(e,"callee")},nk=Array.isArray;var rk=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ik=function(e){return null!=e&&rk(e.length)&&!Zv(e)};var ok=function(e){return uS(e)&&ik(e)};var ak=function(){return!1},sk=O((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Dv.Buffer:void 0,o=(i?i.isBuffer:void 0)||ak;e.exports=o})),uk=Function.prototype,ck=Object.prototype,lk=uk.toString,hk=ck.hasOwnProperty,fk=lk.call(Object);var pk=function(e){if(!uS(e)||"[object Object]"!=Yv(e))return!1;var t=XC(e);if(null===t)return!0;var n=hk.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&lk.call(n)==fk},dk={};dk["[object Float32Array]"]=dk["[object Float64Array]"]=dk["[object Int8Array]"]=dk["[object Int16Array]"]=dk["[object Int32Array]"]=dk["[object Uint8Array]"]=dk["[object Uint8ClampedArray]"]=dk["[object Uint16Array]"]=dk["[object Uint32Array]"]=!0,dk["[object Arguments]"]=dk["[object Array]"]=dk["[object ArrayBuffer]"]=dk["[object Boolean]"]=dk["[object DataView]"]=dk["[object Date]"]=dk["[object Error]"]=dk["[object Function]"]=dk["[object Map]"]=dk["[object Number]"]=dk["[object Object]"]=dk["[object RegExp]"]=dk["[object Set]"]=dk["[object String]"]=dk["[object WeakMap]"]=!1;var vk=function(e){return uS(e)&&rk(e.length)&&!!dk[Yv(e)]},gk=O((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&Lv.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),mk=gk&&gk.isTypedArray,yk=mk?bg(mk):vk;var _k=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},bk=Object.prototype.hasOwnProperty;var xk=function(e,t,n){var r=e[t];bk.call(e,t)&&tC(r,n)&&(void 0!==n||t in e)||FC(e,t,n)};var Sk=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?FC(n,s,u):xk(n,s,u)}return n};var Ek=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},Ak=/^(?:0|[1-9]\d*)$/;var Tk=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ak.test(e))&&e>-1&&e%1==0&&e<t},wk=Object.prototype.hasOwnProperty;var Ck=function(e,t){var n=nk(e),r=!n&&tk(e),i=!n&&!r&&sk(e),o=!n&&!r&&!i&&yk(e),a=n||r||i||o,s=a?Ek(e.length,String):[],u=s.length;for(var c in e)!t&&!wk.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Tk(c,u))||s.push(c);return s};var kk=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Mk=Object.prototype.hasOwnProperty;var Pk=function(e){if(!Xv(e))return kk(e);var t=qC(e),n=[];for(var r in e)("constructor"!=r||!t&&Mk.call(e,r))&&n.push(r);return n};var Ik=function(e){return ik(e)?Ck(e,!0):Pk(e)};var Rk=function(e){return Sk(e,Ik(e))};var Ok=function(e,t,n,r,i,o,a){var s=_k(e,n),u=_k(t,n),c=a.get(u);if(c)zC(e,n,c);else{var l=o?o(s,u,n+"",e,t,a):void 0,h=void 0===l;if(h){var f=nk(u),p=!f&&sk(u),d=!f&&!p&&yk(u);l=u,f||p||d?nk(s)?l=s:ok(s)?l=xg(s):p?(h=!1,l=jC(u,!0)):d?(h=!1,l=GC(u,!0)):l=[]:pk(u)||tk(u)?(l=s,tk(s)?l=Rk(s):Xv(s)&&!Zv(s)||(l=KC(u))):h=!1}h&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),zC(e,n,l)}};var Lk=function e(t,n,r,i,o){t!==n&&BC(n,(function(a,s){if(o||(o=new DC),Xv(a))Ok(t,n,s,r,e,i,o);else{var u=i?i(_k(t,s),a,s+"",t,n,o):void 0;void 0===u&&(u=a),zC(t,s,u)}}),Ik)};var Nk=function(e,t,n){if(!Xv(n))return!1;var r=typeof t;return!!("number"==r?ik(n)&&Tk(t,n.length):"string"==r&&t in n)&&tC(n[t],e)};var Dk,Fk=function(e){return pg((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&Nk(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))},zk=Fk((function(e,t,n){Lk(e,t,n)})),Bk=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),jk=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Uk=function(e){return e.AND="and",e.OR="or",e}({}),Vk=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Gk={MapToken:"æ¨æ­£å¨ä½¿ç¨ Demo æµè¯ Token, çäº§ç¯å¢å¡å¿èªè¡æ³¨å Token ç¡®ä¿æå¡ç¨³å®",SDK:"è¯·ç¡®è®¤å¼å¥äºmapbox-gl apiä¸å¨L7ä¹åå¼å¥"},Hk={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Wk={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Uk.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Yk=Ce()(Dk=function(){return l((function e(){s(this,e),f(this,"sceneConfigCache",{}),f(this,"layerConfigCache",{}),f(this,"layerAttributeConfigCache",{})}),[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return Gk[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=_(_({},Hk),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=_({},zk({},this.sceneConfigCache[e],Wk,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=_(_({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}])}())||Dk;sr({target:"Math",stat:!0},{fround:hc});var Xk,Zk,qk,Kk,Qk,$k=Math.PI/180;function Jk(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.lngLatExtent,a=void 0===o?[]:o,s=e.scale,u=e.highPrecision,c=void 0!==u&&u,l=e.flipY,h=void 0!==l&&l,f=e.coordinateSystem,p=e.epsgCode,d={},v=512*(s=void 0!==s?s:Math.pow(2,i)),g=Math.cos(n*$k),m=v/(a[2]-a[0]),y=m;f&&f===jy.LNGLAT_OFFSET&&"EPSG:3857"===p&&(y/=g);var _=v/4003e4;if(d.pixelsPerMeter=[_,-_,_],d.metersPerPixel=[1/_,-1/_,1/_],d.pixelsPerDegree=[m,-y,_],d.degreesPerPixel=[1/m,-1/y,1/_],c){var b=$k*Math.tan(n*$k)/g,x=m*b/2,S=v/4003e4*b,E=S/y*_;d.pixelsPerDegree2=[0,-x,S],d.pixelsPerMeter2=[E,0,E],h&&(d.pixelsPerDegree2[1]=-d.pixelsPerDegree2[1],d.pixelsPerMeter2[1]=-d.pixelsPerMeter2[1])}return h&&(d.pixelsPerMeter[1]=-d.pixelsPerMeter[1],d.metersPerPixel[1]=-d.metersPerPixel[1],d.pixelsPerDegree[1]=-d.pixelsPerDegree[1],d.degreesPerPixel[1]=-d.degreesPerPixel[1]),d}var eM,tM,nM,rM,iM,oM,aM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],sM=(Xk=Ce(),Zk=we(Oe.ICameraService),Xk((Qk=n((Kk=function(){return l((function e(){s(this,e),f(this,"needRefresh",!0),g(this,"cameraService",Qk,this),f(this,"coordinateSystem",void 0),f(this,"viewportCenter",void 0),f(this,"viewportCenterProjection",void 0),f(this,"pixelsPerDegree",void 0),f(this,"pixelsPerDegree2",void 0),f(this,"pixelsPerMeter",void 0),f(this,"offsetCenterTransform",void 0),f(this,"offsetCenter",void 0),f(this,"epsgCode",void 0)}),[{key:"refresh",value:function(e,t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),i=e||this.cameraService.getCenter(),o=Jk({latitude:i[1],zoom:n,lngLatExtent:t,coordinateSystem:this.coordinateSystem,epsgCode:this.epsgCode}),a=o.pixelsPerMeter,s=o.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=a,this.pixelsPerDegree=s,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===jy.LNGLAT||this.coordinateSystem===jy.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===jy.LNGLAT_OFFSET||this.coordinateSystem===jy.METER_OFFSET?this.calculateLnglatOffset(i,n,t):this.coordinateSystem===jy.P20_OFFSET&&this.calculateLnglatOffset(i,n,t,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getEPSGCode",value:function(){return this.epsgCode}},{key:"setEPSGCode",value:function(e){this.epsgCode=e}},{key:"getViewportCenter",value:function(e){if(this.coordinateSystem===jy.METER_OFFSET&&this.offsetCenterTransform){var t=Ib([Math.fround(this.viewportCenter[0]),Math.fround(this.viewportCenter[1])],e,512);return[t[0]-this.offsetCenterTransform[0],t[1]-this.offsetCenterTransform[1]]}return[this.viewportCenter[0],this.viewportCenter[1]]}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r,i){var o=Jk({latitude:e[1],lngLatExtent:n,zoom:t,scale:r,flipY:i,highPrecision:!0,coordinateSystem:this.coordinateSystem,epsgCode:this.epsgCode}),a=o.pixelsPerMeter,s=o.pixelsPerDegree,u=o.pixelsPerDegree2,c=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),h=s_([],l,c),f=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=Qy([],[f[0],f[1],0,1],h),h=s_([],l,c=this.cameraService.getViewMatrixUncentered()||c),h=s_([],h,aM),this.cameraService.setViewProjectionMatrix(h),this.pixelsPerMeter=a,this.pixelsPerDegree=s,this.pixelsPerDegree2=u}}])}()).prototype,"cameraService",[Zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qk=Kk))||qk),uM=Ce()(eM=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"renderMap",new Map),f(e,"enable",!1),f(e,"renderEnable",!1),f(e,"cacheLogs",{}),e}return v(t,e),l(t,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),i=null;r.forEach((function(e,o){null!==i?(i[e]||(i[e]={}),o!==r.length-1&&(i=i[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),o!==r.length-1&&(i=n.cacheLogs[e])),o===r.length-1&&(i[e]=_(_({time:Date.now()},i[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(C(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?ux():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,_(_({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",_(_({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}])}(N))||eM,cM=O((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
!function(t,n,r,i){var o,a="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,s="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),u=a||s,c=["","webkit","Moz","MS","ms","o"],l=u?"":n.createElement("div"),h=Math.round,f=Math.abs,p=Date.now;function d(e,t,n){return setTimeout(x(e,n),t)}function v(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function m(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,i,r),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=m((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),_=m((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&o(r,n)}function x(e,t){return function(){return e.apply(t,arguments)}}function S(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function E(e,t){return void 0===e?t:e}function A(e,t,n){g(k(t),(function(t){e.addEventListener(t,n,!1)}))}function T(e,t,n){g(k(t),(function(t){e.removeEventListener(t,n,!1)}))}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function k(e){return e.trim().split(/\s+/g)}function M(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];M(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function R(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}}var O=1;function L(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var N="ontouchstart"in t,D=void 0!==R(t,"PointerEvent"),F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z=["x","y"],B=["clientX","clientY"];function j(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){S(e.options.enable,[e])&&n.handler(t)},this.init()}function U(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=V(t));i>1&&!n.firstMultiple?n.firstMultiple=V(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=t.center=G(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=X(s,u),t.distance=Y(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=W(t.deltaX,t.deltaY);var c=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=f(c.x)>f(c.y)?c.x:c.y,t.scale=a?(l=a.pointers,h=r,Y(h[0],h[1],B)/Y(l[0],l[1],B)):1,t.rotation=a?function(e,t){return X(t[1],t[0],B)+X(e[1],e[0],B)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||void 0===a.velocity)){var u=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,l=H(s,u,c);r=l.x,i=l.y,n=f(l.x)>f(l.y)?l.x:l.y,o=W(u,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var l,h;var d=e.element;w(t.srcEvent.target,d)&&(d=t.srcEvent.target);t.target=d}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function V(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:G(t),deltaX:e.deltaX,deltaY:e.deltaY}}function G(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function H(e,t,n){return{x:t/e||0,y:n/e||0}}function W(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function Y(e,t,n){n||(n=z);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function X(e,t,n){n||(n=z);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}j.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(L(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,j.apply(this,arguments)}b(q,j,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:"touch",3:"pen",4:"mouse",5:"kinect"},$="pointerdown",J="pointermove pointerup pointercancel";function ee(){this.evEl=$,this.evWin=J,j.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}u||!t.MSPointerEvent||t.PointerEvent||($="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),b(ee,j,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=K[r],o=Q[e.pointerType]||e.pointerType,a="touch"==o,s=M(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,j.apply(this,arguments)}function re(e,t){var n=P(e.touches),r=P(e.changedTouches);return 12&t&&(n=I(n.concat(r),"identifier",!0)),[n,r]}b(ne,j,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function oe(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},j.apply(this,arguments)}function ae(e,t){var n=P(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=P(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return w(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[I(o.concat(s),"identifier",!0),s]:void 0}b(oe,j,{handler:function(e){var t=ie[e.type],n=ae.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function se(){j.apply(this,arguments);var e=x(this.handler,this);this.touch=new oe(this.manager,e),this.mouse=new q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ue(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ce.call(this,t)):12&e&&ce.call(this,t)}function ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function le(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(se,j,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ue.call(this,t,n);else if(i&&le.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=u?void 0:R(l.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={};if(u)return e;var n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function de(e,t){this.manager=e,this.set(t)}de.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){S(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,"none"))return"none";var t=C(e,"pan-x"),n=C(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(C(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,"none")&&!pe.none,o=C(r,"pan-y")&&!pe["pan-y"],a=C(r,"pan-x")&&!pe["pan-x"];if(i){var s=1===e.pointers.length,u=e.distance<2,c=e.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ve(e){this.options=o({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function me(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ye(e,t){var n=t.manager;return n?n.get(e):e}function _e(){ve.apply(this,arguments)}function be(){_e.apply(this,arguments),this.pX=null,this.pY=null}function xe(){_e.apply(this,arguments)}function Se(){ve.apply(this,arguments),this._timer=null,this._input=null}function Ee(){_e.apply(this,arguments)}function Ae(){_e.apply(this,arguments)}function Te(){ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function we(e,t){return(t=t||{}).recognizers=E(t.recognizers,we.defaults.preset),new Ce(e,t)}ve.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ye(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)||(e=ye(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===M(t,e=ye(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ge(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ge(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!S(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(_e,ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),b(be,_e,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return _e.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=me(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(xe,_e,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Se,ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),b(Ee,_e,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ae,_e,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=me(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Te,ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||Y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),we.VERSION="2.0.7",we.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ee,{enable:!1}],[xe,{enable:!1},["rotate"]],[Ae,{direction:6}],[be,{direction:6},["swipe"]],[Te],[Te,{event:"doubletap",taps:2},["tap"]],[Se]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ce(e,t){var n;this.options=o({},we.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?ee:F?oe:N?se:q))(n,U),this.touchAction=new de(this,this.options.touchAction),ke(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ke(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=R(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}(Ce.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=M(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return g(k(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return g(k(e),(function(e){t?n[e]&&n[e].splice(M(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){if(u)return;var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&ke(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u)||(o(we,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ce,Input:j,TouchAction:de,TouchInput:oe,MouseInput:q,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:ve,AttrRecognizer:_e,Tap:Te,Pan:be,Swipe:Ae,Pinch:xe,Rotate:Ee,Press:Se,on:A,off:T,each:g,merge:_,extend:y,assign:o,inherit:b,bindFn:x,prefixed:R}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=we,e.exports?e.exports=we:t.Hammer=we)}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)})),lM=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),hM={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},fM=(tM=Ce(),nM=we(Oe.IMapService),tM((oM=n((iM=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"indragging",!1),g(e,"mapService",oM,e),f(e,"hammertime",void 0),f(e,"lastClickTime",0),f(e,"lastClickXY",[-1,-1]),f(e,"clickTimer",void 0),f(e,"$containter",void 0),f(e,"onDrag",(function(t){var n=e.interactionEvent(t);n.type=hM[n.type],"dragging"===n.type?e.indragging=!0:e.indragging=!1,e.emit(lM.Drag,n)})),f(e,"onHammer",(function(t){t.srcEvent.stopPropagation();var n=e.interactionEvent(t);e.emit(lM.Hover,n)})),f(e,"onTouch",(function(t){var n=t.touches[0];e.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),f(e,"onHover",(function(t){var n=t.clientX,r=t.clientY,i=t.type,o=e.mapService.getMapContainer();if(o)if(Sd)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=e.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&e.emit(lM.Hover,{x:n,y:r,lngLat:u,type:i,target:t}):e.isDoubleTap(n,r,u);else{if(!Sd&&"ontouchstart"in document.documentElement==!0)return;e.isDoubleTap(n,r,u)}})),e}return v(t,e),l(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(lM.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(lM.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(lM.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(lM.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapCanvasContainer&&this.mapService.getMapCanvasContainer()||this.mapService.getMapContainer();if(e)if(Sd)Ad.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=new cM.Manager(e);t.add(new cM.Tap({event:"dblclick",taps:2})),t.add(new cM.Tap({event:"click"})),t.add(new cM.Pan({threshold:0,pointers:0})),t.add(new cM.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){if(Sd)Ad.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(lM.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(lM.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}])}(L)).prototype,"mapService",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rM=iM))||rM);var pM=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},dM=YC(Object.keys,Object),vM=Object.prototype.hasOwnProperty;var gM=function(e){if(!qC(e))return dM(e);var t=[];for(var n in Object(e))vM.call(e,n)&&"constructor"!=n&&t.push(n);return t};var mM=function(e){return ik(e)?Ck(e):gM(e)};var yM=function(e,t){return e&&Sk(t,mM(t),e)};var _M=function(e,t){return e&&Sk(t,Ik(t),e)};var bM=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var xM=function(){return[]},SM=Object.prototype.propertyIsEnumerable,EM=Object.getOwnPropertySymbols,AM=EM?function(e){return null==e?[]:(e=Object(e),bM(EM(e),(function(t){return SM.call(e,t)})))}:xM;var TM=function(e,t){return Sk(e,AM(e),t)};var wM=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},CM=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)wM(t,AM(e)),e=XC(e);return t}:xM;var kM=function(e,t){return Sk(e,CM(e),t)};var MM=function(e,t,n){var r=t(e);return nk(e)?r:wM(r,n(e))};var PM=function(e){return MM(e,mM,AM)};var IM=function(e){return MM(e,Ik,CM)},RM=ug(Dv,"DataView"),OM=ug(Dv,"Promise"),LM=ug(Dv,"Set"),NM=ug(Dv,"WeakMap"),DM=Jv(RM),FM=Jv(dC),zM=Jv(OM),BM=Jv(LM),jM=Jv(NM),UM=Yv;(RM&&"[object DataView]"!=UM(new RM(new ArrayBuffer(1)))||dC&&"[object Map]"!=UM(new dC)||OM&&"[object Promise]"!=UM(OM.resolve())||LM&&"[object Set]"!=UM(new LM)||NM&&"[object WeakMap]"!=UM(new NM))&&(UM=function(e){var t=Yv(e),n="[object Object]"==t?e.constructor:void 0,r=n?Jv(n):"";if(r)switch(r){case DM:return"[object DataView]";case FM:return"[object Map]";case zM:return"[object Promise]";case BM:return"[object Set]";case jM:return"[object WeakMap]"}return t});var VM=UM,GM=Object.prototype.hasOwnProperty;var HM=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&GM.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var WM=function(e,t){var n=t?VC(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},YM=/\w*$/;var XM=function(e){var t=new e.constructor(e.source,YM.exec(e));return t.lastIndex=e.lastIndex,t},ZM=Fv?Fv.prototype:void 0,qM=ZM?ZM.valueOf:void 0;var KM=function(e){return qM?Object(qM.call(e)):{}};var QM=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return VC(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return WM(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return GC(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return XM(e);case"[object Set]":return new r;case"[object Symbol]":return KM(e)}};var $M=function(e){return uS(e)&&"[object Map]"==VM(e)},JM=gk&&gk.isMap,eP=JM?bg(JM):$M;var tP=function(e){return uS(e)&&"[object Set]"==VM(e)},nP=gk&&gk.isSet,rP=nP?bg(nP):tP,iP={};iP["[object Arguments]"]=iP["[object Array]"]=iP["[object ArrayBuffer]"]=iP["[object DataView]"]=iP["[object Boolean]"]=iP["[object Date]"]=iP["[object Float32Array]"]=iP["[object Float64Array]"]=iP["[object Int8Array]"]=iP["[object Int16Array]"]=iP["[object Int32Array]"]=iP["[object Map]"]=iP["[object Number]"]=iP["[object Object]"]=iP["[object RegExp]"]=iP["[object Set]"]=iP["[object String]"]=iP["[object Symbol]"]=iP["[object Uint8Array]"]=iP["[object Uint8ClampedArray]"]=iP["[object Uint16Array]"]=iP["[object Uint32Array]"]=!0,iP["[object Error]"]=iP["[object Function]"]=iP["[object WeakMap]"]=!1;var oP=function e(t,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!Xv(t))return t;var h=nk(t);if(h){if(s=HM(t),!u)return xg(t,s)}else{var f=VM(t),p="[object Function]"==f||"[object GeneratorFunction]"==f;if(sk(t))return jC(t,u);if("[object Object]"==f||"[object Arguments]"==f||p&&!o){if(s=c||p?{}:KC(t),!u)return c?kM(t,_M(s,t)):TM(t,yM(s,t))}else{if(!iP[f])return o?t:{};s=QM(t,f,u)}}a||(a=new DC);var d=a.get(t);if(d)return d;a.set(t,s),rP(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,a))})):eP(t)&&t.forEach((function(i,o){s.set(o,e(i,n,r,o,t,a))}));var v=h?void 0:(l?c?IM:PM:c?Ik:mM)(t);return pM(v||t,(function(i,o){v&&(i=t[o=i]),xk(s,o,e(i,n,r,o,t,a))})),s};var aP=function(e){return oP(e,5)},sP=0;function uP(e){if(Sd)return null;var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(sP++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var cP,lP,hP,fP,pP,dP,vP,gP,mP,yP,_P,bP,xP,SP,EP,AP,TP,wP,CP,kP,MP,PP,IP=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),RP=(cP=Ce(),lP=we(Oe.IMapService),hP=we(Oe.IRendererService),fP=we(Oe.IGlobalConfigService),pP=we(Oe.IInteractionService),dP=we(Oe.ILayerService),cP((mP=n((gP=function(){return l((function e(){var t=this;s(this,e),f(this,"pickedColors",void 0),f(this,"pickedTileLayers",[]),g(this,"mapService",mP,this),g(this,"rendererService",yP,this),g(this,"configService",_P,this),g(this,"interactionService",bP,this),g(this,"layerService",xP,this),f(this,"pickingFBO",void 0),f(this,"width",0),f(this,"height",0),f(this,"alreadyInPicking",!1),f(this,"pickBufferScale",1),f(this,"pickFromPickingFBO",(function(e,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,c=t.rendererService,l=c.readPixels,h=c.getContainer,f=t.getContainerSize(h()),p=f.width,d=f.height;p*=Nm,d*=Nm;var v=e.getLayerConfig(),g=v.enableHighlight,m=v.enableSelect,y=r*Nm,b=i*Nm;if(y>p-1*Nm||y<0||b>d-1*Nm||b<0)return!1;var x=l({x:Math.floor(y/t.pickBufferScale),y:Math.floor((d-(i+1)*Nm)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO});if(t.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var S=mv(x),E=e.layerPickService.getFeatureById(S);E=t.handleRawFeature(E,e)[0],S!==e.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var A={x:r,y:i,type:a,lngLat:o,featureId:S,feature:E,target:s};E&&(u=!0,e.setCurrentPickId(S),t.triggerHoverOnLayer(e,A))}else{var T={x:r,y:i,lngLat:o,type:null!==e.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};t.triggerHoverOnLayer(e,_(_({},T),{},{type:"unpick"})),t.triggerHoverOnLayer(e,T),e.setCurrentPickId(null)}if(g&&e.layerPickService.highlightPickedFeature(x),m&&"click"===a&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()){var w=mv(x);null===e.getCurrentSelectedId()||w!==e.getCurrentSelectedId()?(e.layerPickService.selectFeature(x),e.setCurrentSelectedId(w)):(e.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null))}return u}))}),[{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=t.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=Nm,s*=Nm,this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.interactionService.on(lM.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(n=o(x().mark((function e(t,n,r){var i,o,a,s=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),"function"==typeof t.layerPickService.pickBoxSelectTiles?t.layerPickService.pickBoxSelectTiles(n,s.mapService.map):(t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call());var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n=this,r=E(t.map((function(e){var t=e<0?0:e;return Math.floor(t*Nm/n.pickBufferScale)})),4),i=r[0],o=r[1],a=r[2],s=r[3],u=this.rendererService,c=u.readPixels,l=u.getContainer,h=this.getContainerSize(l()),f=h.width,p=h.height;if(p*=Nm,i>((f*=Nm)-1)*Nm/this.pickBufferScale||a<0||o>(p-1)*Nm/this.pickBufferScale||s<0)return[];for(var d=Math.min(f/this.pickBufferScale,a)-i,v=Math.min(p/this.pickBufferScale,s)-o,g=c({x:i,y:Math.floor(p/this.pickBufferScale-(s+1)),width:d,height:v,data:new Uint8Array(d*v*4),framebuffer:this.pickingFBO}),m=[],y={},_=e.getLayerConfig().featureId,b=0;b<g.length/4;b+=1){var x=mv(g.slice(4*b,4*b+4));if(-1!==x&&!y[x]){var S=e.layerPickService.getFeatureById(x,_);S=this.handleRawFeature(S,e),m.push.apply(m,T(S)),y[x]=!0}}return m}},{key:"handleRawFeature",value:function(e,t){var n=this;return(e=e instanceof Array?e:[e]).map((function(e){if("null"===e)return e;if("Feature"===e.type)return e;var r={type:"Feature",properties:aP(e),geometry:{type:"",coordinates:[]}};if(e.coordinates){var i=r.properties.coordinates;delete r.properties.coordinates,r.geometry={type:n.determineGeometryType(i,t),coordinates:i}}return r}))}},{key:"determineGeometryType",value:function(e,t){switch(t.type){case"PointLayer":case"HeatmapLayer":return this.determinePointType(e);case"LineLayer":return this.determineLineStringType(e);case"PolygonLayer":return this.determinePointType(e);default:return""}}},{key:"determinePointType",value:function(e){return Array.isArray(e)&&e.every((function(e){return Array.isArray(e)&&(2===e.length||3===e.length)}))?"MultiPoint":"Point"}},{key:"determineLineStringType",value:function(e){return Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])?"MultiLineString":"LineString"}},{key:"determinePolygonType",value:function(e){return Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])&&Array.isArray(e[0][0][0])?"MultiPolygon":"Polygon"}},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/Nm,height:e.height/Nm}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(t=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=Nm,r*=Nm,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(e=o(x().mark((function e(t){var n,r,i,o=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.layerPickService.pickRender(t);var n=o.pickFromPickingFBO(e,t);return o.layerService.pickedLayerId=n?+e.id:-1,n&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]);var e,t,n}()).prototype,"mapService",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yP=n(gP.prototype,"rendererService",[hP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_P=n(gP.prototype,"configService",[fP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=n(gP.prototype,"interactionService",[pP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xP=n(gP.prototype,"layerService",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=gP))||vP),OP=function(){return l((function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];s(this,e),f(this,"autoStart",void 0),f(this,"startTime",0),f(this,"oldTime",0),f(this,"running",!1),f(this,"elapsedTime",0),this.autoStart=t}),[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}])}(),LP=(SP=Ce(),EP=we(Oe.IRendererService),AP=we(Oe.IMapService),TP=we(Oe.IDebugService),SP((kP=n((CP=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"pickedLayerId",-1),f(e,"clock",new OP),f(e,"alreadyInRendering",!1),f(e,"layers",[]),f(e,"layerList",[]),f(e,"layerRenderID",{}),f(e,"sceneInited",!1),f(e,"animateInstanceCount",0),f(e,"shaderPicking",!0),f(e,"enableRender",!0),g(e,"renderService",kP,e),g(e,"mapService",MP,e),g(e,"debugService",PP,e),f(e,"reRender",yS((function(){e.renderLayers()}),32)),f(e,"throttleRenderLayers",yS((function(){}),16)),e}return v(t,e),l(t,[{key:"needPick",value:function(e){return this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(d=o(x().mark((function e(){var t=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=o(x().mark((function e(n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(p=o(x().mark((function e(t,n){var r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?(r=n.layerChildren.indexOf(t))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(t))>-1&&this.layers.splice(i,1),this.updateLayerRenderList(),this.emit("layerChange",this.layers);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"removeAllLayers",value:function(){this.destroy(),this.stopAllRender(),this.layerList=[]}},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(c=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"renderAllLayers",value:(u=o(x().mark((function e(){var t,n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=h(this.layerList);try{for(t.s();!(n=t.n()).done;)r=n.value,this.renderLayer(r.id)}catch(e){t.e(e)}finally{t.f()}case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"renderLayer",value:(i=o(x().mark((function e(t){var n,r,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.enableRender){e.next=2;break}return e.abrupt("return");case 2:if(this.updateLayerRenderList(),n=this.layerList.find((function(e){return e.id===t}))){e.next=6;break}return e.abrupt("return");case 6:if(r=this.debugService.generateRenderUid(),this.debugService.renderStart(r),i=n.getLayerConfig(),o=i.enableMask,n.masks.filter((function(e){return e.inited})).length>0&&o&&this.renderMask(n.masks),!n.getLayerConfig().enableMultiPassRenderer){e.next=15;break}return e.next=13,n.renderMultiPass();case 13:e.next=17;break;case 15:return e.next=17,n.render();case 17:this.debugService.renderEnd(r);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?jk.MULTIPLE:jk.SINGLE,i=h(e);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(r=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayer(t.id);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),a=(i+=r?o.length:1)>1?jk.MULTIPLE:jk.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=h(o);try{for(u.s();!(s=u.n()).done;){s.value.render({isStencil:!0,stencilType:a,stencilIndex:t++})}}catch(e){u.e(e)}finally{u.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:t++,stencilOperation:Uk.OR})}},{key:"renderTileLayer",value:(n=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=gv(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){var e=this;this.renderAllLayers(),this.layerRenderID=Ad.requestAnimationFrame((function(){e.runRender()}))}},{key:"stopRender",value:function(){Ad.cancelAnimationFrame(this.layerRenderID)}},{key:"stopAllRender",value:function(){this.stopRender(),this.animateInstanceCount=0}}]);var n,r,i,u,c,p,d}(N)).prototype,"renderService",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MP=n(CP.prototype,"mapService",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PP=n(CP.prototype,"debugService",[TP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=CP))||wP),NP=sh.left,DP=!qa&&gt>79&&gt<83||!Da("reduce");sr({target:"Array",proto:!0,forced:DP},{reduce:function(e){var t=arguments.length;return NP(this,e,t,t>1?arguments[1]:void 0)}});var FP,zP,BP,jP,UP,VP=function(e){return null==e},GP=function(){return l((function e(t){var n=this;s(this,e),f(this,"name",void 0),f(this,"type",void 0),f(this,"scale",void 0),f(this,"descriptor",void 0),f(this,"featureBufferLayout",[]),f(this,"needRescale",!1),f(this,"needRemapping",!1),f(this,"needRegenerateVertices",!1),f(this,"featureRange",{startIndex:0,endIndex:1/0}),f(this,"vertexAttribute",void 0),f(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}),[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,T(e));if(!VP(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}])}(),HP=["buffer","update","name"],WP=["buffer","update","name"],YP=f(f(f({},IP.FLOAT,4),IP.UNSIGNED_BYTE,1),IP.UNSIGNED_SHORT,2),XP=(FP=Ce(),zP=we(Oe.IRendererService),FP((UP=n((jP=function(){return l((function e(){s(this,e),f(this,"attributesAndIndices",void 0),g(this,"rendererService",UP,this),f(this,"attributes",[]),f(this,"triangulation",void 0),f(this,"featureLayout",{sizePerElement:0,elements:[]})}),[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new GP(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(_(_({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,c=a.size,l=void 0===c?0:c,h=YP[u.type||IP.FLOAT];if(s){var f=this.featureLayout,p=f.elements,d=f.sizePerElement,v=p.slice(n,r);if(!v.length)return;var g=v[0].offset,m=g*l*h,y=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];u.push.apply(u,T(s(t[r],r,i.slice(c*d,c*d+d),n,l)))}return u})).reduce((function(e,t){return e.push.apply(e,T(t)),e}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m}),null==i||i.emit("legend:".concat(e),{type:e,attr:o})}}}},{key:"createAttributesAndIndices",value:function(e,t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=0,s=[],u=3;e.forEach((function(e,t){var c=r.triangulation(e,n),l=c.indices,h=c.vertices,f=c.normals,p=c.size,d=c.indexes,v=c.count;"number"==typeof v&&(a+=v),l.forEach((function(e){s.push(e+o)})),u=p;var g=h.length/p;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:t,vertices:h,normals:f,offset:o}),o+=g;for(var m=function(n){var r=(null==f?void 0:f.slice(3*n,3*n+3))||[],o=h.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,T(i.update(e,t,o,n,r,a)))}))},y=0;y<g;y++)m(y)}));var c=this.rendererService,l=c.createAttribute,h=c.createBuffer,f=c.createElements,p={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,b(e,HP)),o=l(_({buffer:h(n)},i));p[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var d=f({data:s,type:IP.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),i=0,o=3;e.forEach((function(e,t){var a=n.triangulation(e),s=a.indices,u=a.vertices,c=a.normals,l=a.size,h=a.indexes;s.forEach((function(e){})),o=l;var f=u.length/l;n.featureLayout.sizePerElement=o,n.featureLayout.elements.push({featureIdx:t,vertices:u,normals:c,offset:i}),i+=f;for(var p=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=u.slice(n*l,n*l+l),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,T(r.update(e,t,o,n,i,a)))}))},d=0;d<f;d++)p(d)}));var a=this.rendererService,s=a.createAttribute,u=a.createBuffer,c={};return r.forEach((function(e,t){if(e){var r=e.buffer,i=(e.update,e.name,b(e,WP)),o=s(_({buffer:u(r)},i));c[e.name||""]=o,n.attributes[t].vertexAttribute=o}})),{attributes:c}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}])}()).prototype,"rendererService",[zP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=jP))||BP);function ZP(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function qP(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function KP(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function QP(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function $P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var JP={exports:{}},eI={exports:{}},tI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(tI,tI.exports);var nI={},rI={exports:{}},iI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(iI,iI.exports);var oI={};Object.defineProperty(oI,"__esModule",{value:!0}),oI.fallback=lI,oI.wrap=hI;var aI,sI=oI.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,uI=oI.hasSetImmediate="function"==typeof setImmediate&&setImmediate,cI=oI.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function lI(e){setTimeout(e,0)}function hI(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}aI=sI?queueMicrotask:uI?setImmediate:cI?process.nextTick:lI,oI.default=hI(aI),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(iI.exports),r=o(oI),i=nI;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(rI,rI.exports),Object.defineProperty(nI,"__esModule",{value:!0}),nI.isAsyncIterable=nI.isAsyncGenerator=nI.isAsync=void 0;var fI,pI=(fI=rI.exports)&&fI.__esModule?fI:{default:fI};function dI(e){return"AsyncFunction"===e[Symbol.toStringTag]}nI.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return dI(e)?(0,pI.default)(e):e},nI.isAsync=dI,nI.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},nI.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var vI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(vI,vI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(tI.exports),r=o(nI),i=o(vI.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(eI,eI.exports);var gI={exports:{}},mI={exports:{}},yI={exports:{}},_I={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(_I,_I.exports);var bI={exports:{}},xI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(xI,xI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(tI.exports),r=i(xI.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(bI,bI.exports);var SI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(SI,SI.exports);var EI={exports:{}},AI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(AI,AI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,c=0;function l(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,c,h),c++,l()}})).catch(f))}function h(e,t){if(u-=1,!a)return e?f(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void l()}function f(e){a||(s=!1,o=!0,i(e))}l()};var n=function(e){return e&&e.__esModule?e:{default:e}}(AI.exports);e.exports=t.default}(EI,EI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(_I.exports),r=u(bI.exports),i=u(SI.exports),o=nI,a=u(EI.exports),s=u(AI.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,c){if(c=(0,n.default)(c),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return c(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,c);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,c);var l=(0,r.default)(t),h=!1,f=!1,p=0,d=!1;function v(e,t){if(!f)if(p-=1,e)h=!0,c(e);else if(!1===e)h=!0,f=!0;else{if(t===s.default||h&&p<=0)return h=!0,c(null);d||g()}}function g(){for(d=!0;p<e&&!h;){var t=l();if(null===t)return h=!0,void(p<=0&&c(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}g()}},e.exports=t.default}(yI,yI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(yI.exports),r=o(nI),i=o(vI.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(mI,mI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(mI.exports),r=i(vI.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(gI,gI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(eI.exports),r=i(gI.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(JP,JP.exports);var TI=$P(JP.exports),wI=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,TI(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,QP([],KP(n.args),!1)),r(null,e)}))},e}(),CI={exports:{}},kI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(tI.exports),r=c(AI.exports),i=c(mI.exports),o=c(_I.exports),a=c(SI.exports),s=c(nI),u=c(vI.exports);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,c=!1;function l(e,t){!1===e&&(c=!0),!0!==c&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(l))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?l:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(kI,kI.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(kI.exports),r=i(eI.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(CI,CI.exports);var MI={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(_I.exports),r=a(SI.exports),i=a(nI),o=a(vI.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(MI,MI.exports);var PI=$P(MI.exports),II=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return TI(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}(),RI=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,TI(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return ZP(n,void 0,void 0,(function(){return qP(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,QP([],KP(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),OI=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,TI(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return ZP(n,void 0,void 0,(function(){var n;return qP(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,QP([],KP(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),LI=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return PI(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}();function NI(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var DI,FI,zI,BI,jI,UI,VI,GI,HI,WI,YI,XI,ZI,qI,KI,QI,$I,JI,eR,tR,nR,rR,iR,oR,aR,sR,uR,cR,lR,hR,fR,pR,dR,vR,gR,mR=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",NI);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var o=e.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.setAttribute("title",""),o.__resizeElement__=e,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",NI)},o.type="text/html",n&&e.appendChild(o),o.data="about:blank",n||e.appendChild(o)}e.__resizeListeners__.push(t)},yR="undefined"==typeof window?mR:mR.bind(window),_R=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",NI);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",NI),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};yR.unbind=_R;var bR=(DI=Ce(),FI=we(Oe.SceneID),zI=we(Oe.IIconService),BI=we(Oe.IFontService),jI=we(Oe.IControlService),UI=we(Oe.IGlobalConfigService),VI=we(Oe.IMapService),GI=we(Oe.ICoordinateSystemService),HI=we(Oe.IRendererService),WI=we(Oe.ILayerService),YI=we(Oe.IDebugService),XI=we(Oe.ICameraService),ZI=we(Oe.IInteractionService),qI=we(Oe.IPickingService),KI=we(Oe.IShaderModuleService),QI=we(Oe.IMarkerService),$I=we(Oe.IPopupService),DI((tR=n((eR=function(e){function t(){var e;return s(this,t),f(e=a(this,t),"destroyed",!1),f(e,"loaded",!1),g(e,"id",tR,e),g(e,"iconService",nR,e),g(e,"fontService",rR,e),g(e,"controlService",iR,e),g(e,"configService",oR,e),g(e,"map",aR,e),g(e,"coordinateSystemService",sR,e),g(e,"rendererService",uR,e),g(e,"layerService",cR,e),g(e,"debugService",lR,e),g(e,"cameraService",hR,e),g(e,"interactionService",fR,e),g(e,"pickingService",pR,e),g(e,"shaderModuleService",dR,e),g(e,"markerService",vR,e),g(e,"popupService",gR,e),f(e,"inited",!1),f(e,"initPromise",void 0),f(e,"rendering",!1),f(e,"$container",void 0),f(e,"canvas",void 0),f(e,"markerContainer",void 0),f(e,"hooks",void 0),f(e,"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),Om(),e.coordinateSystemService.needRefresh=!0,e.render())})),f(e,"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.layerService.layerList.forEach((function(t){e.layerService.renderLayer(t.id)}))})),e.hooks={init:new RI},e}return v(t,e),l(t,[{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(lM.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",o(x().mark((function n(){var r,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.map.getOverlayContainer(),t.$container=r||uP(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=12;break}return t.canvas=t.map.map._canvas,n.next=6,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 6:t.registerContextLost(),t.initContainer(),yR(t.$container,t.handleWindowResized),Ad.matchMedia&&(null===(i=Ad.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(t.handleWindowResized)),n.next=13;break;case 12:console.error("å®¹å¨ id ä¸å­å¨");case 13:t.pickingService.init(t.id);case 14:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),"GAODE2.x"!==t.map.version&&e()})),t.map.initMiniMap()}));case 2:t.map.onCameraChanged(t.handleMapCameraChanged),t.interactionService.init(),t.interactionService.on(lM.Drag,t.addSceneEvent.bind(t));case 5:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",o(x().mark((function n(){var r;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.canvas,t.$container=r||null,!t.$container){n.next=7;break}return n.next=5,t.rendererService.init(e.canvas,t.configService.getSceneConfig(t.id),void 0);case 5:n.next=8;break;case 7:console.error("å®¹å¨ id ä¸å­å¨");case 8:t.pickingService.init(t.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(n=o(x().mark((function e(t){var n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=Am("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n=this;if(this.inited){var r;if(_R(this.$container,this.handleWindowResized),Ad.matchMedia)null===(r=Ad.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===r||r.removeListener(this.handleWindowResized);this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=n.$container)||void 0===e||e.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$container),this.emit("destroy")}else this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=Nm,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=Nm,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]);var n,r}(N)).prototype,"id",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nR=n(eR.prototype,"iconService",[zI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rR=n(eR.prototype,"fontService",[BI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iR=n(eR.prototype,"controlService",[jI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oR=n(eR.prototype,"configService",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aR=n(eR.prototype,"map",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sR=n(eR.prototype,"coordinateSystemService",[GI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uR=n(eR.prototype,"rendererService",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cR=n(eR.prototype,"layerService",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=n(eR.prototype,"debugService",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hR=n(eR.prototype,"cameraService",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fR=n(eR.prototype,"interactionService",[ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pR=n(eR.prototype,"pickingService",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=n(eR.prototype,"shaderModuleService",[KI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=n(eR.prototype,"markerService",[QI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gR=n(eR.prototype,"popupService",[$I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=eR))||JI);var xR=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var SR=function(e){return this.__data__.has(e)};function ER(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new OC;++t<n;)this.add(e[t])}ER.prototype.add=ER.prototype.push=xR,ER.prototype.has=SR;var AR=ER;var TR=function(e,t){return!!(null==e?0:e.length)&&yg(e,t,0)>-1};var wR=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var CR=function(e,t){return e.has(t)};var kR=function(){};var MR=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},PR=LM&&1/MR(new LM([,-0]))[1]==1/0?function(e){return new LM(e)}:kR;var IR=function(e,t,n){var r=-1,i=TR,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=wR;else if(o>=200){var c=t?null:PR(e);if(c)return MR(c);a=!1,i=CR,u=new AR}else u=t?[]:s;e:for(;++r<o;){var l=e[r],h=t?t(l):l;if(l=n||0!==l?l:0,a&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue e;t&&u.push(h),s.push(l)}else i(u,h,n)||(u!==s&&u.push(h),s.push(l))}return s};var RR=function(e){return e&&e.length?IR(e):[]};var OR=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function LR(e){var t={};return{content:e=e.replace(OR,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var NR,DR,FR,zR,BR,jR,UR,VR,GR,HR="#define PI 3.14159265359",WR=/precision\s+(high|low|medium)p\s+float/,YR=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,XR=/void\s+main\s*\([^)]*\)\s*\{\n?/,ZR=Ce()(NR=function(){return l((function e(){s(this,e),f(this,"moduleCache",{}),f(this,"rawContentCache",{})}),[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:HR,fs:HR}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform bool u_isMultiCoor: false;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit , offset.w);\n}\nvec4 project_offset_meter(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz  , offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n \n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x ;\n    float Y = position.y - u_ViewportCenter.y ;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    float X = (position.x - u_ViewportCenter.x)* u_ZoomScale ;\n    float Y = ( position.y - u_ViewportCenter.y)* u_ZoomScale ;\n    return project_offset_meter(vec4(X, Y, project_scale(position.z), position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n     if (u_isMultiCoor) {\n      return vec4(\n        position.xy * u_ZoomScale,\n        project_scale(position.z),\n        position.w\n      );\n    }\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: ç¦çåæ ç³» & å¸¸è§ä¸çåæ ç³»\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// ééçº¹çè´´å¾çç­åç´ å¤§å°\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// å¨ä¸è®ºä»ä¹åºå¾ä¸éè¦ç»ä¸å¤ççæ¶åä½¿ç¨\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    // mapbox P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // ç»çº¬åº¦ => å¹³é¢åæ \n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // å¹³é¢åæ  => ç»çº¬åº¦\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// å¤æ­å½åç¹æ¯å¦å·²ç»è¢« select éä¸­\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // éä¸­æ\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // é«äº®æ\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // ç¹å»éä¸­ç¶æ\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover é«äº®ç¶æ\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // è¿æ»¤å¤ä½ç shader è®¡ç®\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // ææ¶å»é¤ ç´æ¥åæ¶è®¡ç®å¨éä¸­æ¶ææ½å°å¾ä¼æé®é¢\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // è¿æ»¤å¤ä½ç shader è®¡ç®\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // ææ¶å»é¤ ç´æ¥åæ¶è®¡ç®å¨éä¸­æ¶ææ½å°å¾ä¼æé®é¢\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n"}),this.registerModule("commom_attr_vert",{vs:"#ifdef USE_ATTRIBUTE_OPACITY\n  attribute float a_Opacity;\n#endif\n\n#ifdef USE_ATTRIBUTE_OFFSETS\n  attribute vec2 a_Offsets;\n#endif\n\n#ifdef USE_ATTRIBUTE_STROKE\n  attribute vec4 a_Stroke;\n#endif",fs:""}),this.registerModule("opacity_attr_vert",{vs:"float opacity = u_opacity;\n\n#ifdef USE_ATTRIBUTE_OPACITY\n    opacity = a_Opacity;\n#endif",fs:""})}},{key:"registerModule",value:function(e,t){var n=t.vs,r=t.fs,i=t.uniforms,o=t.inject,a=LR(n),s=a.content,u=a.uniforms,c=LR(r),l=c.content,h=c.uniforms;this.rawContentCache[e]={fs:l,inject:o,uniforms:_(_(_({},u),h),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.rawContentCache[e].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=LR(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(XR,(function(e){return e+(null==i?void 0:i["vs:#main-start"])})));var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,c=this.processModule(r,[],"fs"),l=c.content,h=c.includeList,f="",p=RR(u.concat(h).concat(e)).reduce((function(e,n){return _(_({},e),t.rawContentCache[n].uniforms)}),_({},o));return WR.test(l)||(f+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"),f+=l,this.moduleCache[e]={fs:f.trim(),uniforms:p,vs:s.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(YR,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}},{key:"injectDefines",value:function(e){return Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],";\n")}),"\n")}}])}())||NR,qR=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),KR=Ce()(DR=function(){return l((function e(){s(this,e),f(this,"shaderModuleService",void 0),f(this,"rendererService",void 0),f(this,"cameraService",void 0),f(this,"mapService",void 0),f(this,"interactionService",void 0),f(this,"layerService",void 0),f(this,"config",void 0)}),[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return qR.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(Oe.IRendererService),this.cameraService=e.getContainer().get(Oe.ICameraService),this.mapService=e.getContainer().get(Oe.IMapService),this.interactionService=e.getContainer().get(Oe.IInteractionService),this.layerService=e.getContainer().get(Oe.ILayerService),this.shaderModuleService=e.getContainer().get(Oe.IShaderModuleService)}},{key:"render",value:function(e){}}])}())||DR,QR=Ce()(FR=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,n){p(d(t.prototype),"init",this).call(this,e,n)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}])}(KR))||FR,$R=(zR=Ce(),BR=we(Oe.IPostProcessor),zR((VR=n((UR=function(){return l((function e(){s(this,e),f(this,"passes",[]),g(this,"postProcessor",VR,this),f(this,"layer",void 0),f(this,"renderFlag",void 0),f(this,"width",0),f(this,"height",0)}),[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(e=o(x().mark((function e(){var t,n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=h(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return e.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===qR.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]);var e}()).prototype,"postProcessor",[BR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jR=UR))||jR),JR=Ce()(GR=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"pickingFBO",void 0),f(e,"layer",void 0),f(e,"width",0),f(e,"height",0),f(e,"alreadyInRendering",!1),f(e,"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,c=s.readPixels,l=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=e.layer.getLayerConfig(),v=d.enableHighlight,g=d.enableSelect,m=n*Nm,y=r*Nm;if(!(m>f||m<0||y>p||y<0))l(e.pickingFBO,(function(){var t;if(0!==(a=c({x:Math.round(m),y:Math.round(p-(r+1)*Nm),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=mv(a),u=e.layer.getSource().getFeatureById(s),l={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(l))}else{var h={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(_(_({},h),{},{type:"unpick"})),e.triggerHoverOnLayer(h),e.layer.setCurrentPickId(null)}v&&e.highlightPickedFeature(a),g&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return v(t,e),l(t,[{key:"getType",value:function(){return qR.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,n){p(d(t.prototype),"init",this).call(this,e,n),this.layer=e;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:i({width:s,height:u,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.interactionService.on(lM.Hover,this.pickFromPickingFBO),this.interactionService.on(lM.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(lM.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=E(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"selectFeature",value:function(e){var t=E(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i])}},{key:"selectFeatureHandle",value:function(e){var t=yv(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=yv(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}])}(KR))||GR,eO="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}";var tO=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var nO=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:tO(e,t,n)},rO=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var iO=function(e){return rO.test(e)};var oO=function(e){return e.split("")},aO="[\\ud800-\\udfff]",sO="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",uO="\\ud83c[\\udffb-\\udfff]",cO="[^\\ud800-\\udfff]",lO="(?:\\ud83c[\\udde6-\\uddff]){2}",hO="[\\ud800-\\udbff][\\udc00-\\udfff]",fO="(?:"+sO+"|"+uO+")"+"?",pO="[\\ufe0e\\ufe0f]?"+fO+("(?:\\u200d(?:"+[cO,lO,hO].join("|")+")[\\ufe0e\\ufe0f]?"+fO+")*"),dO="(?:"+[cO+sO+"?",sO,lO,hO,aO].join("|")+")",vO=RegExp(uO+"(?="+uO+")|"+dO+pO,"g");var gO=function(e){return e.match(vO)||[]};var mO=function(e){return iO(e)?gO(e):oO(e)},yO=Fv?Fv.prototype:void 0,_O=yO?yO.toString:void 0;var bO=function e(t){if("string"==typeof t)return t;if(nk(t))return dg(t,e)+"";if(cS(t))return _O?_O.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var xO=function(e){return null==e?"":bO(e)};var SO=function(e){return function(t){t=xO(t);var n=iO(t)?mO(t):void 0,r=n?n[0]:t.charAt(0),i=n?nO(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var EO=function(e){return SO(xO(e).toLowerCase())};var AO=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n};var TO=function(e){return function(t){return null==e?void 0:e[t]}}({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),wO=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,CO=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var kO=function(e){return(e=xO(e))&&e.replace(wO,TO).replace(CO,"")},MO=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var PO=function(e){return e.match(MO)||[]},IO=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var RO=function(e){return IO.test(e)},OO="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",LO="["+OO+"]",NO="\\d+",DO="[\\u2700-\\u27bf]",FO="[a-z\\xdf-\\xf6\\xf8-\\xff]",zO="[^\\ud800-\\udfff"+OO+NO+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",BO="(?:\\ud83c[\\udde6-\\uddff]){2}",jO="[\\ud800-\\udbff][\\udc00-\\udfff]",UO="[A-Z\\xc0-\\xd6\\xd8-\\xde]",VO="(?:"+FO+"|"+zO+")",GO="(?:"+UO+"|"+zO+")",HO="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",WO="[\\ufe0e\\ufe0f]?"+HO+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",BO,jO].join("|")+")[\\ufe0e\\ufe0f]?"+HO+")*"),YO="(?:"+[DO,BO,jO].join("|")+")"+WO,XO=RegExp([UO+"?"+FO+"+(?:['â](?:d|ll|m|re|s|t|ve))?(?="+[LO,UO,"$"].join("|")+")",GO+"+(?:['â](?:D|LL|M|RE|S|T|VE))?(?="+[LO,UO+VO,"$"].join("|")+")",UO+"?"+VO+"+(?:['â](?:d|ll|m|re|s|t|ve))?",UO+"+(?:['â](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",NO,YO].join("|"),"g");var ZO=function(e){return e.match(XO)||[]};var qO=function(e,t,n){return e=xO(e),void 0===(t=n?void 0:t)?RO(e)?ZO(e):PO(e):e.match(t)||[]},KO=RegExp("['â]","g");var QO,$O,JO,eL,tL,nL,rL,iL,oL,aL,sL,uL,cL,lL,hL,fL,pL,dL,vL,gL,mL=function(e){return function(t){return AO(qO(kO(t).replace(KO,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?EO(t):t)})),yL=(QO=Ce(),$O=we(Oe.IShaderModuleService),QO((tL=n((eL=function(){return l((function e(){s(this,e),g(this,"shaderModuleService",tL,this),f(this,"rendererService",void 0),f(this,"config",void 0),f(this,"quad",eO),f(this,"enabled",!0),f(this,"renderToScreen",!1),f(this,"model",void 0),f(this,"name",void 0),f(this,"optionsToUpdate",{})}),[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return qR.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(Oe.IRendererService),this.shaderModuleService=e.getContainer().get(Oe.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,c=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:IP.FLOAT}),size:2})},uniforms:_(_({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),c=u.width,l=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=_({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,l]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=_(_({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){VP(e[n])||(t["u_".concat(SO(mL(n)))]=e[n])})),t}}])}()).prototype,"shaderModuleService",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JO=eL))||JO),_L=Ce()(nL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:eO,fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return VP(e.bloomRadius)||(t.u_radius=e.bloomRadius),VP(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),VP(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}])}(yL))||nL,bL="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",xL=Ce()(rL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:eO,fs:bL});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return VP(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}])}(yL))||rL,SL=Ce()(iL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:eO,fs:bL});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return VP(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}])}(yL))||iL,EL=Ce()(oL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:eO,fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}}])}(yL))||oL,AL="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",TL=Ce()(aL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:eO,fs:AL}),this.shaderModuleService.getModule("copy-pass")}}])}(yL))||aL,wL=Ce()(sL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:eO,fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}}])}(yL))||sL,CL=Ce()(uL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:eO,fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:_(_({},r),{},{u_ViewportSize:[o,a]})}}}])}(yL))||uL,kL=Ce()(cL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:eO,fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}])}(yL))||cL,ML=Ce()(lL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:eO,fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}])}(yL))||lL,PL=Jt.f,IL=!Fe||De((function(){PL(1)}));sr({target:"Object",stat:!0,forced:IL,sham:!Fe},{getOwnPropertyDescriptor:function(e,t){return PL(it(e),t)}});var RL,OL,LL,NL,DL,FL,zL=(hL=Ce(),fL=we(Oe.IRendererService),pL=Te(),hL((gL=n((vL=function(){return l((function e(){s(this,e),g(this,"rendererService",gL,this),f(this,"passes",[]),f(this,"readFBO",void 0),f(this,"writeFBO",void 0)}),[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,o(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(t=o(x().mark((function e(t,n){var r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"render",value:(e=o(x().mark((function e(t){var n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]);var e,t}()).prototype,"rendererService",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(vL.prototype,"init",[pL],Object.getOwnPropertyDescriptor(vL.prototype,"init"),vL.prototype),dL=vL))||dL),BL=Ce()(RL=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getType",value:function(){return qR.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,n){p(d(t.prototype),"init",this).call(this,e,n)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}])}(KR))||RL;function jL(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var UL=1,VL=(OL=Ce(),LL=we(Oe.IShaderModuleService),OL((FL=n((DL=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return g(e=a(this,t,[].concat(r)),"shaderModuleService",FL,e),f(e,"haltonSequence",[]),f(e,"accumulatingId",0),f(e,"frame",0),f(e,"timer",void 0),f(e,"sampleRenderTarget",void 0),f(e,"prevRenderTarget",void 0),f(e,"outputRenderTarget",void 0),f(e,"copyRenderTarget",void 0),f(e,"blendModel",void 0),f(e,"outputModel",void 0),f(e,"copyModel",void 0),e}return v(t,e),l(t,[{key:"getType",value:function(){return qR.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,n){p(d(t.prototype),"init",this).call(this,e,n);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([jL(a,2),jL(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",AL,{blend:{enable:!0,func:{srcRGB:IP.ONE,dstRGB:IP.ONE_MINUS_SRC_ALPHA,srcAlpha:IP.ONE,dstAlpha:IP.ONE_MINUS_SRC_ALPHA},equation:{rgb:IP.FUNC_ADD,alpha:IP.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",AL)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var c=e.multiPassRenderer.getPostProcessor().getReadFBO();o(c,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=UL++,this.timer=Ad.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),Ad.requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,c=e.getLayerConfig().jitterScale,l=void 0===c?1:c,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*l,(2*h[1]-1)/u*l),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var f=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ad.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,t,n){this.shaderModuleService.registerModule(e,{vs:eO,fs:t});var r=this.shaderModuleService.getModule(e),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createBuffer;return(0,s.createModel)(_({vs:i,fs:o,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:IP.FLOAT}),size:2})},uniforms:_({},a),depth:{enable:!1},count:3},n))}}])}(KR)).prototype,"shaderModuleService",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NL=DL))||NL),GL=new ke;GL.bind(Oe.IGlobalConfigService).to(Yk).inSingletonScope(),Ae(Ce(),N),GL.bind(Oe.IEventEmitter).to(N);var HL=Re(GL,!1),WL=function(e){var t=HL.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},YL=0;function XL(){var e=new ke;return e.parent=GL,e.bind(Oe.SceneID).toConstantValue("".concat(YL++)),e.bind(Oe.IShaderModuleService).to(ZR).inSingletonScope(),e.bind(Oe.ILayerService).to(LP).inSingletonScope(),e.bind(Oe.IDebugService).to(uM).inSingletonScope(),e.bind(Oe.ISceneService).to(bR).inSingletonScope(),e.bind(Oe.ICameraService).to(Hw).inSingletonScope(),e.bind(Oe.ICoordinateSystemService).to(sM).inSingletonScope(),e.bind(Oe.IInteractionService).to(fM).inSingletonScope(),e.bind(Oe.IPickingService).to(RP).inSingletonScope(),e.bind(Oe.IControlService).to(Qw).inSingletonScope(),e.bind(Oe.IMarkerService).to($w).inSingletonScope(),e.bind(Oe.IIconService).to(Gw).inSingletonScope(),e.bind(Oe.IFontService).to(_A).inSingletonScope(),e.bind(Oe.IPopupService).to(Jw).inSingletonScope(),e.bind(Oe.INormalPass).to(QR).whenTargetNamed("clear"),e.bind(Oe.INormalPass).to(JR).whenTargetNamed("pixelPicking"),e.bind(Oe.INormalPass).to(BL).whenTargetNamed("render"),e.bind(Oe.INormalPass).to(VL).whenTargetNamed("taa"),e.bind(Oe.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(Oe.INormalPass,t)}})),e.bind(Oe.IPostProcessingPass).to(TL).whenTargetNamed("copy"),e.bind(Oe.IPostProcessingPass).to(_L).whenTargetNamed("bloom"),e.bind(Oe.IPostProcessingPass).to(xL).whenTargetNamed("blurH"),e.bind(Oe.IPostProcessingPass).to(SL).whenTargetNamed("blurV"),e.bind(Oe.IPostProcessingPass).to(kL).whenTargetNamed("noise"),e.bind(Oe.IPostProcessingPass).to(ML).whenTargetNamed("sepia"),e.bind(Oe.IPostProcessingPass).to(EL).whenTargetNamed("colorHalftone"),e.bind(Oe.IPostProcessingPass).to(wL).whenTargetNamed("hexagonalPixelate"),e.bind(Oe.IPostProcessingPass).to(CL).whenTargetNamed("ink"),e.bind(Oe.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(Oe.IPostProcessingPass,t);return n.setName(t),n}})),e}function ZL(e){var t=new ke;return t.parent=e,t.bind(Oe.IStyleAttributeService).to(XP).inSingletonScope(),t.bind(Oe.IMultiPassRenderer).to($R).inSingletonScope(),t.bind(Oe.IPostProcessor).to(zL).inSingletonScope(),t}var qL=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e};var KL=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=dS(n))==n?n:0),void 0!==t&&(t=(t=dS(t))==t?t:0),qL(dS(e),t,n)},QL=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function $L(e){return QL.indexOf(e)}function JL(e,t){return 256*(e=KL(Math.floor(e),0,255))+(t=KL(Math.floor(t),0,255))}var eN={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};const tN={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};var nN,rN,iN,oN=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),aN=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),sN=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),uN=["mapload","mapchange","mapAfterFrameChange"],cN=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],lN=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),hN=(nN=WL(Oe.IGlobalConfigService),iN=n((rN=function(){return l((function e(t){s(this,e),g(this,"configService",iN,this),f(this,"config",void 0),this.config=t}),[{key:"setContainer",value:function(e,t,n,r){e.bind(Oe.MapConfig).toConstantValue(_(_({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(Oe.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}])}()).prototype,"configService",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN);function fN(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}fN(".maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}}@keyframes maplibregl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.35);box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:rgba(0,0,0,.4);color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}");var pN,dN,vN,gN,mN,yN,_N,bN,xN,SN,EN,AN,TN=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.MAPLIBRE="MAPLIBRE",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),wN=function(){return l((function e(t){s(this,e),f(this,"size",1e4),this.size=t||1e4}),[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}])}(),CN={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},kN={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},MN=(pN=Ce(),dN=we(Oe.MapConfig),vN=we(Oe.IGlobalConfigService),gN=we(Oe.ICoordinateSystemService),mN=we(Oe.IEventEmitter),pN((bN=n((_N=function(){return l((function e(){var t=this;s(this,e),f(this,"version",TN.DEFUALT),f(this,"map",void 0),f(this,"simpleMapCoord",new wN),f(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),f(this,"viewport",void 0),g(this,"config",bN,this),g(this,"configService",xN,this),g(this,"coordinateSystemService",SN,this),g(this,"eventEmitter",EN,this),f(this,"markerContainer",void 0),f(this,"cameraChangedCallback",void 0),f(this,"$mapContainer",void 0),f(this,"handleCameraChanged",(function(e){var n=t.map.getCenter(),r=n.lat,i=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[i,r],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0,map:t.map}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}))}),[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=Am("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(e,t){-1!==uN.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(kN[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(kN[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===TN.SIMPLE)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"isMapBoxMapLibre",value:function(){return this.version===TN.MAPLIBRE||this.version===TN.MAPBOX}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return CN}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0,map:this.map}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.coordinateSystemService.setCoordinateSystem(Lb(this.map,t)),this.coordinateSystemService.setEPSGCode(Nb(this.map))}}])}()).prototype,"config",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=n(_N.prototype,"configService",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=n(_N.prototype,"coordinateSystemService",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=n(_N.prototype,"eventEmitter",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yN=_N))||yN),PN=function(){return l((function e(){s(this,e),f(this,"viewport",void 0),f(this,"map",void 0)}),[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=e.map;this.map=s,this.viewport=new Tb({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i,isGeographicCoordinateSystem:Ob(s),coordinateSystem:Lb(s),epsgCode:Nb(s),map:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t,Ob(this.map),this.map)}}])}(),IN=["id","attributionControl","style","token","rotation","mapInstance"];window.maplibregl=t;var RN=0,ON=Ce()(AN=function(e){function n(){var e;s(this,n);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return f(e=a(this,n,[].concat(r)),"version",TN.MAPLIBRE),f(e,"viewport",void 0),e}return v(n,e),l(n,[{key:"getType",value:function(){return"maplibre"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=n_();return u_(s,s,j_(o.x-i.x,o.y-i.y,o.z||0-i.z)),c_(s,s,j_(a*r[0],-a*r[1],a*r[2])),l_(s,s,n[0]),h_(s,s,n[1]),f_(s,s,n[2]),s}},{key:"init",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,t.token,u=t.rotation,c=void 0===u?0:u,l=t.mapInstance,h=b(t,IN),this.viewport=new PN,l||window.maplibregl||console.error(this.configService.getSceneWarninfo("SDK")),l?(this.map=l,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.maplibregl.Map(_({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:c},h))),jb(this.map),this.map.on("load",(function(){f.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getMapCanvasContainer",value:function(){return this.$mapContainer?this.$mapContainer.getElementsByClassName("maplibregl-canvas-container")[0]:this.$mapContainer}},{key:"meterToCoord",value:function(e,n){var r=new t.LngLat(e[0],e[1]),i=new t.LngLat(n[0],n[1]),o=r.distanceTo(i),a=t.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=t.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),u=a.x,c=a.y,l=s.x,h=s.y;return 4194304*Math.sqrt(Math.pow(u-l,2)+Math.pow(c-h,2))*2/o}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+RN++,t.appendChild(n),n}}]);var r}(MN))||AN,LN=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getServiceConstructor",value:function(){return ON}}])}(hN),NN={},DN={},FN=function(e){return DN[e]},zN=function(e,t){DN[e]=t},BN=function(e,t){NN[e]=t},jN={},UN={};function VN(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function GN(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function HN(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function WN(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+HN(-e,6):e>9999?"+"+HN(e,6):HN(e,4)}(e.getUTCFullYear())+"-"+HN(e.getUTCMonth()+1,2)+"-"+HN(e.getUTCDate(),2)+(i?"T"+HN(t,2)+":"+HN(n,2)+":"+HN(r,2)+"."+HN(i,3)+"Z":r?"T"+HN(t,2)+":"+HN(n,2)+":"+HN(r,2)+"Z":n||t?"T"+HN(t,2)+":"+HN(n,2)+"Z":"")}var YN=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,u=o<=0,c=!1;function l(){if(u)return UN;if(c)return c=!1,jN;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?u=!0:10===(r=e.charCodeAt(a++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=l())!==UN;){for(var h=[];r!==jN&&r!==UN;)h.push(r),r=l();t&&null==(h=t(h,s++))||i.push(h)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?WN(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=VN(e);return function(r,i){return t(n(r),i,e)}}(e,t):VN(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=GN(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=GN(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(",").parse,XN=function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)ZN(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)ZN(t.coordinates[r],n);return t};function ZN(e,t){if(0!==e.length){qN(e[0],t);for(var n=1;n<e.length;n++)qN(e[n],!t)}}function qN(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}function KN(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function QN(e){return"Feature"===e.type?e.geometry:e}function $N(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){Fy(XN(_({},e[s]),!0),(function(n){var r=KN(n),i=_(_({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var c=0;c<e.length;c++){var l=e[c],h=[];if(a){var f="Polygon";Array.isArray(a[0])||(f="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(f="LineString"),h=XN({type:f,coordinates:T(l[a])},!0).coordinates}else if(n&&r&&i&&o){h=[[parseFloat(l[n]),parseFloat(l[r])],[parseFloat(l[i]),parseFloat(l[o])]]}else n&&r&&(h=[parseFloat(l[n]),parseFloat(l[r])]);var p=_(_({},l),{},{_id:c,coordinates:h});u.push(p)}return{dataArray:u}}function JN(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function eD(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)tD(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)tD(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)tD(e,t[r][i])}(i),i}function tD(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function nD(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)rD(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)rD(i[c],s);else if("LineString"===o)iD(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)s=[],iD(i[c],s,a,!1),e.push(eD(u,"LineString",s,t.properties));return}oD(i,s,a,!1)}else if("Polygon"===o)oD(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)nD(e,{id:u,geometry:t.geometry.geometries[c],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<i.length;c++){var l=[];oD(i[c],l,a,!0),s.push(l)}}e.push(eD(u,o,s,t.properties))}}function rD(e,t){t.push(aD(e[0])),t.push(sD(e[1])),t.push(0)}function iD(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=aD(e[s][0]),c=sD(e[s][1]);t.push(u),t.push(c),t.push(0),s>0&&(a+=r?(i*c-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=t.length-3;t[2]=1,function e(t,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,c=t[n],l=t[n+1],h=t[r],f=t[r+1],p=n+3;p<r;p+=3){var d=JN(t[p],t[p+1],c,l,h,f);if(d>a)o=p,a=d;else if(d===a){var v=Math.abs(p-s);v<u&&(o=p,u=v)}}a>i&&(o-n>3&&e(t,n,o,i),t[o+2]=a,r-o>3&&e(t,o,r,i))}(t,0,l,n),t[l+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function oD(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];iD(e[i],o,n,r),t.push(o)}}function aD(e){return e/360+.5}function sD(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function uD(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],c=0;c<e.length;c++){var l=e[c],h=l.geometry,f=l.type,p=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(p>=n&&d<r)u.push(l);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)cD(h,v,n,r,i);else if("LineString"===f)lD(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)fD(h,v,n,r,i,!1);else if("Polygon"===f)fD(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var g=0;g<h.length;g++){var m=[];fD(h[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<v.length;g++)u.push(eD(l.id,f,v[g],l.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(eD(l.id,f,v,l.tags))}}}return u.length?u:null}function cD(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function lD(e,t,n,r,i,o,a){for(var s,u,c=hD(e),l=0===i?dD:vD,h=e.start,f=0;f<e.length-3;f+=3){var p=e[f],d=e[f+1],v=e[f+2],g=e[f+3],m=e[f+4],y=0===i?p:d,_=0===i?g:m,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=l(c,p,d,g,m,n),a&&(c.start=h+s*u)):y>r?_<r&&(u=l(c,p,d,g,m,r),a&&(c.start=h+s*u)):pD(c,p,d,v),_<n&&y>=n&&(u=l(c,p,d,g,m,n),b=!0),_>r&&y<=r&&(u=l(c,p,d,g,m,r),b=!0),!o&&b&&(a&&(c.end=h+s*u),t.push(c),c=hD(e)),a&&(h+=s)}var x=e.length-3;p=e[x],d=e[x+1],v=e[x+2],(y=0===i?p:d)>=n&&y<=r&&pD(c,p,d,v),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&pD(c,c[0],c[1],c[2]),c.length&&t.push(c)}function hD(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function fD(e,t,n,r,i,o){for(var a=0;a<e.length;a++)lD(e[a],t,n,r,i,o,!1)}function pD(e,t,n,r){e.push(t),e.push(n),e.push(r)}function dD(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function vD(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function gD(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=mD(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(mD(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(mD(o.geometry[s][c],t));i.push(u)}n.push(eD(o.id,a,i,o.tags))}return n}function mD(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function yD(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(r=0;r<c.length;r+=2)u.geometry.push(_D(c[r],c[r+1],t,o,a,s));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(_D(c[r][i],c[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function _D(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function bD(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,xD(a,e[s],o,i);var u=e[s].minX,c=e[s].minY,l=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function xD(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)SD(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)SD(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)SD(a,c[s],e,n,!0,0===s)}if(a.length){var l=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in l={},t.tags)l[h]=t.tags[h];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==t.id&&(f.id=t.id),e.features.push(f)}}function SD(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ED(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)nD(n,e.features[r],t,r);else"Feature"===e.type?nD(n,e,t):nD(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=uD(e,1,-1-n,n,0,-1,2,t),o=uD(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=uD(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=gD(i,1).concat(r)),o&&(r=r.concat(gD(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function AD(e,t,n){return 32*((1<<e)*n+t)+e}ED.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ED.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,c=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var l=1<<t,h=AD(t,n,r),f=this.tiles[h];if(!f&&(c>1&&console.time("creation"),f=this.tiles[h]=bD(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){c>1&&console.time("clipping");var v,g,m,y,_,b,x=.5*u.buffer/u.extent,S=.5-x,E=.5+x,A=1+x;v=g=m=y=null,_=uD(e,l,n-x,n+E,0,f.minX,f.maxX,u),b=uD(e,l,n+S,n+A,0,f.minX,f.maxX,u),e=null,_&&(v=uD(_,l,r-x,r+E,1,f.minY,f.maxY,u),g=uD(_,l,r+S,r+A,1,f.minY,f.maxY,u),_=null),b&&(m=uD(b,l,r-x,r+E,1,f.minY,f.maxY,u),y=uD(b,l,r+S,r+A,1,f.minY,f.maxY,u),b=null),c>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},ED.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=AD(e,t=(t%a+a)%a,n);if(this.tiles[s])return yD(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,c=e,l=t,h=n;!u&&c>0;)c--,l=Math.floor(l/2),h=Math.floor(h/2),u=this.tiles[AD(c,l,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,l,h),o>1&&console.time("drilling down"),this.splitTile(u.source,c,l,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?yD(this.tiles[s],i):null):null};var TD=function(){return l((function e(t,n,r,i){s(this,e),f(this,"vectorTile",void 0),f(this,"vectorLayerCache",{}),f(this,"x",void 0),f(this,"y",void 0),f(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=t}),[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}])}(),wD={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function CD(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var kD=["Unknown","Point","LineString","Polygon"];function MD(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,c=i.tags,l=i.id,h=e*Math.pow(2,r),f=e*t,p=e*n,d=kD[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/h,i=360*(n[0]+f)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];v(s=g);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=CD(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:c,id:l,tileOrigin:[0,0],coord:""}}var PD=function(){var e=o(x().mark((function e(t,n,r,i){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return MD(i,r.x,r.y,r.z,e)})):[];e(new TD({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();function ID(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){e instanceof HTMLImageElement||Ym(e)?t([e]):function(e,t){var n=e,r=[];if("string"==typeof n)Dd({url:n},(function(e,n){n&&(r.push(n),t(r))}));else{var i=n.length,o=0;n.forEach((function(e){Dd({url:e},(function(e,n){o++,n&&r.push(n),o===i&&t(r)}))}))}}
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */(e,(function(e){t(e)}))}));return{originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}var RD=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+h],h+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},OD=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+p]=255&a,p+=d,a/=256,c-=8);e[n+p-d]|=128*v},LD=ND;function ND(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ND.Varint=0,ND.Fixed64=1,ND.Bytes=2,ND.Fixed32=5;var DD="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function FD(e){return e.type===ND.Bytes?e.readVarint()+e.pos:e.pos+1}function zD(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function BD(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function jD(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function UD(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function VD(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function GD(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function HD(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function WD(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function YD(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function XD(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function ZD(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function qD(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function KD(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function QD(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}ND.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=qD(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=QD(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=qD(this.buf,this.pos)+4294967296*qD(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=qD(this.buf,this.pos)+4294967296*QD(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=RD(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=RD(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return zD(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return zD(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return zD(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return zD(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return zD(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return zD(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&DD?function(e,t,n){return DD.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>n)break;1===l?u<128&&(c=u):2===l?128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=l}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ND.Bytes)return e.push(this.readVarint(t));var n=FD(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ND.Bytes)return e.push(this.readSVarint());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ND.Bytes)return e.push(this.readBoolean());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ND.Bytes)return e.push(this.readFloat());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ND.Bytes)return e.push(this.readDouble());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ND.Bytes)return e.push(this.readFixed32());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ND.Bytes)return e.push(this.readSFixed32());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ND.Bytes)return e.push(this.readFixed64());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ND.Bytes)return e.push(this.readSFixed64());var t=FD(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ND.Varint)for(;this.buf[this.pos++]>127;);else if(t===ND.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ND.Fixed32)this.pos+=4;else{if(t!==ND.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),KD(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),KD(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),KD(this.buf,-1&e,this.pos),KD(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),KD(this.buf,-1&e,this.pos),KD(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&BD(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),OD(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),OD(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&BD(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,ND.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,jD,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,UD,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,HD,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,VD,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,GD,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,WD,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,YD,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,XD,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ZD,t)},writeBytesField:function(e,t){this.writeTag(e,ND.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ND.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ND.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ND.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ND.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ND.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ND.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ND.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ND.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ND.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var $D=function(){return l((function e(t,n,r,i,o){s(this,e),f(this,"vectorTile",void 0),f(this,"vectorLayerCache",{}),f(this,"x",void 0),f(this,"y",void 0),f(this,"z",void 0),f(this,"version",void 0),this.x=n,this.y=r,this.z=i,this.version=o;var a=("MAPLIBRE"===this.version?window.maplibregl:window.mapboxgl).mapbox.VectorTile;this.vectorTile=new a(new LD(t))}),[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z,(function(e,t){return kb([e,t],Bb.map)}));n.push(_(_({},i),{},{properties:_({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}])}(),JD={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},eF=function(){var e=o(x().mark((function e(t,n,r,i,o){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=wS(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new $D(n,r.x,r.y,r.z,r.version);e(i)}}));else{var t=Rd(_(_({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new $D(n,r.x,r.y,r.z,r.version);e(i)}}));r.xhrCancel=function(){return t.abort()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function tF(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),c=0;c<a;c++){var l=JSON.parse(u),h=nF(l,o,c);if("number"==typeof h)s.push(h);else{var f=rF(l);s.push(f)}}return s}function nF(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)switch(r[0]){case"band":try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}break;default:nF(r,t,n)}}))}function rF(e){var t=function(e){var t=E(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=rF(e[1])),Array.isArray(i)&&(i=rF(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var iF={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=E((null==t?void 0:t.countCut)||[2,98],2),s=a[0],u=a[1],c=(null==t?void 0:t.RMinMax)||oF(n,s,u),l=(null==t?void 0:t.GMinMax)||oF(r,s,u),h=(null==t?void 0:t.BMinMax)||oF(i,s,u),f=0;f<n.length;f++)o.push(Math.max(0,n[f]-c[0])),o.push(Math.max(0,r[f]-l[0])),o.push(Math.max(0,i[f]-h[0]));return{rasterData:o,rMinMax:c,gMinMax:l,bMinMax:h}}}};function oF(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function aF(e,t,n){return sF.apply(this,arguments)}function sF(){return(sF=o(x().mark((function e(t,n,r){var i,o,a,s,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,T(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=C(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return c=r(o),e.abrupt("break",16);case 13:return c=Array.isArray(r)?{rasterData:tF(r,o)}:uF(r,o),e.abrupt("break",16);case 15:c={rasterData:o[0].rasterData};case 16:return e.abrupt("return",_(_({},c),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function uF(e,t){var n=iF[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=tF(e.r||["band",0],t),r=tF(e.g||["band",0],t),i=tF(e.b||["band",0],t);return[n,r,i]}(n.expression,t):{rasterData:tF(n.expression,t)}:void 0}function cF(e,t,n,r){return lF.apply(this,arguments)}function lF(){return(lF=o(x().mark((function e(t,n,r,i){var o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,aF(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hF(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}var fF=Kc.ArrayBuffer,pF=Ne.ArrayBuffer;sr({global:!0,constructor:!0,forced:pF!==fF},{ArrayBuffer:fF}),yo("ArrayBuffer");var dF=function(){var e=o(x().mark((function e(t,n,r,i){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&cF([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),vF=function(){var e=o(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?Fd(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function gF(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return wS(e,t)})):e.map((function(e){return{url:wS(e.url,t),bands:e.bands||[0]}})):wS(e,t)}function mF(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var yF=function(){var e=o(x().mark((function e(t,n,r,i,o){var a,s,u,c,l,h;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.url,!((a="string"==typeof f?[{url:f,bands:[0]}]:"string"==typeof f[0]?f.map((function(e){return{url:e,bands:[0]}})):f).length>1)){e.next=15;break}return e.next=4,_F(a,n);case 4:if(s=e.sent,u=s.rasterFiles,c=s.xhrList,l=s.errList,mF(t,c),!(l.length>0)){e.next=12;break}return r(l,null),e.abrupt("return");case 12:cF(u,i,o,r),e.next=17;break;case 15:h=Rd(n,(function(e,t){if(e)r(e);else if(t){cF([{data:t,bands:a[0].bands}],i,o,r)}})),mF(t,[h]);case 17:case"end":return e.stop()}var f}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function _F(e,t){return bF.apply(this,arguments)}function bF(){return(bF=o(x().mark((function e(t,n){var r,i,o,a,s,u,c,l,h,f,p;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=_(_({},n),{},{url:s.url}),c=s.bands,e.next=10,Md(_(_({},u),{},{type:"arrayBuffer"}));case 10:l=e.sent,h=l.err,f=l.data,p=l.xhr,h&&o.push(h),i.push(p),r.push({data:f,bands:c});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xF=function(){var e=o(x().mark((function e(t,n,r,i,o){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:gF(t,n)},e.abrupt("return",new Promise((function(e,t){yF(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),SF=function(){var e=o(x().mark((function e(t,n,r,i){var o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||CS,o=s(a,_(_({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||wS,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=Dd({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.abort()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),EF=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},AF={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};lN.ARRAYBUFFER,lN.RGB;function TF(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!=typeof e}var wF=["extent","min","max","width","height","format","operation"];var CF={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},kF=function(){var e=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=E(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var MF=Fk((function(e,t,n,r){Lk(e,t,n,r)}));var PF=function(e){return"string"==typeof e||!nk(e)&&uS(e)&&"[object String]"==Yv(e)},IF=O((function(e,t){e.exports=function(){function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;!function e(n,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,c=i-o+1,l=Math.log(u),h=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*h*(u-h)/u)*(c-u/2<0?-1:1),p=Math.max(o,Math.floor(i-c*h/u+f)),d=Math.min(a,Math.floor(i+(u-c)*h/u+f));e(n,r,i,p,d,s)}var v=r[2*i+s],g=o,m=a;for(t(n,r,o,i),r[2*a+s]>v&&t(n,r,o,a);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+s]<v;)g++;for(;r[2*m+s]>v;)m--}r[2*o+s]===v?t(n,r,o,m):(m++,t(n,r,m,a)),m<=i&&(o=m+1),i<=m&&(a=m-1)}}(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var i=function(e){return e[0]},o=function(e){return e[1]},a=function(t,n,r,a,s){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===s&&(s=Float64Array),this.nodeSize=a,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new u(t.length),l=this.coords=new s(2*t.length),h=0;h<t.length;h++)c[h]=h,l[2*h]=n(t[h]),l[2*h+1]=r(t[h]);e(c,l,a,0,c.length-1,0)};a.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,c=[0,e.length-1,0],l=[];c.length;){var h=c.pop(),f=c.pop(),p=c.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[d]);else{var v=Math.floor((p+f)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[v]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(c.push(p),c.push(v-1),c.push(g)),(0===h?i>=s:o>=u)&&(c.push(v+1),c.push(f),c.push(g))}}return l}(this.ids,this.coords,e,t,n,r,this.nodeSize)},a.prototype.within=function(e,t,n){return function(e,t,n,i,o,a){for(var s=[0,e.length-1,0],u=[],c=o*o;s.length;){var l=s.pop(),h=s.pop(),f=s.pop();if(h-f<=a)for(var p=f;p<=h;p++)r(t[2*p],t[2*p+1],n,i)<=c&&u.push(e[p]);else{var d=Math.floor((f+h)/2),v=t[2*d],g=t[2*d+1];r(v,g,n,i)<=c&&u.push(e[d]);var m=(l+1)%2;(0===l?n-o<=v:i-o<=g)&&(s.push(f),s.push(d-1),s.push(m)),(0===l?n+o>=v:i+o>=g)&&(s.push(d+1),s.push(h),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},u=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),c=function(e){this.options=g(Object.create(s),e),this.trees=new Array(this.options.maxZoom+1)};function l(e,t,n,r,i){return{x:u(e),y:u(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function h(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:u(d(r)),y:u(v(i)),zoom:1/0,index:t,parentId:-1}}function f(e){return{type:"Feature",id:e.id,properties:p(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function p(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return g(g({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function d(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function g(e,t){for(var n in t)e[n]=t[n];return e}function m(e){return e.x}function y(e){return e.y}return c.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var s="prepare "+e.length+" points";n&&console.time(s),this.points=e;for(var u=[],c=0;c<e.length;c++)e[c].geometry&&u.push(h(e[c],c));this.trees[i+1]=new a(u,m,y,o,Float32Array),n&&console.timeEnd(s);for(var l=i;l>=r;l--){var f=+Date.now();u=this._cluster(u,l),this.trees[l]=new a(u,m,y,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},c.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],c=[],l=0,h=u.range(d(n),v(o),d(i),v(r));l<h.length;l+=1){var p=h[l],g=u.points[p];c.push(g.numPoints?f(g):this.points[g.index])}return c},c.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,c=i.within(o.x,o.y,a);u<c.length;u+=1){var l=c[u],h=i.points[l];h.parentId===e&&s.push(h.numPoints?f(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},c.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},c.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,c=(n+1+s)/i,l={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,c),r.points,t,n,i,l),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,c),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,c),r.points,-1,n,i,l),l.features.length?l:null},c.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},c.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},c.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],c=u.numPoints,l=void 0,h=void 0,f=void 0;if(c)l=p(u),h=u.x,f=u.y;else{var g=this.points[u.index];l=g.properties,h=d(g.geometry.coordinates[0]),f=v(g.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:l},y=void 0;c?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(m.id=y),o.features.push(m)}},c.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},c.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),c=0;c<e.length;c++){var h=e[c];if(!(h.zoom<=t)){h.zoom=t;for(var f=this.trees[t+1],p=f.within(h.x,h.y,u),d=h.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=h.x*d,x=h.y*d,S=a&&d>1?this._map(h,!0):null,E=(c<<5)+(t+1)+this.points.length,A=0,T=p;A<T.length;A+=1){var w=T[A],C=f.points[w];if(!(C.zoom<=t)){C.zoom=t;var k=C.numPoints||1;b+=C.x*k,x+=C.y*k,C.parentId=E,a&&(S||(S=this._map(h,!0)),a(S,this._map(C)))}}h.parentId=E,n.push(l(b/v,x/v,E,v,S))}else if(n.push(h),v>1)for(var M=0,P=p;M<P.length;M+=1){var I=P[M],R=f.points[I];R.zoom<=t||(R.zoom=t,n.push(R))}}}return n},c.prototype._getOriginId=function(e){return e-this.points.length>>5},c.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},c.prototype._map=function(e,t){if(e.numPoints)return t?g({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?g({},r):r},c}()}));function RF(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,c=void 0===u?2:u;if(e.pointIndex){var l=e.pointIndex.getClusters(e.extent,Math.floor(c));return e.dataArray=l.map((function(e,t){return _({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new IF({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:_({},e)}})),h.load(f.features),h}function OF(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var LF={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return OF(e)/e.length},sum:OF};function NF(e,t){if(Array.isArray(t))return t}var DF=function(e){function t(e,n){var r;return s(this,t),f(r=a(this,t),"type","source"),f(r,"isTile",!1),f(r,"inited",!1),f(r,"data",void 0),f(r,"center",void 0),f(r,"extent",void 0),f(r,"hooks",{init:new wI}),f(r,"parser",{type:"geojson"}),f(r,"transforms",[]),f(r,"cluster",!1),f(r,"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),f(r,"tileset",void 0),f(r,"invalidExtent",!1),f(r,"dataArrayChanged",!1),f(r,"originData",void 0),f(r,"rawData",void 0),f(r,"cfg",{autoRender:!0}),f(r,"clusterIndex",void 0),r.originData=e,r.initCfg(n),r.init().then((function(){r.inited=!0,r.emit("update",{type:"inited"})})),r}return v(t,e),l(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,a.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||Zv(i))&&(a=a.map((function(e){var n=e.id;if(n){var r,a=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(PF(i)&&o){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(a,o);r=LF[i](s)}Zv(i)&&(r=i(a)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=FN("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=aP(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?_(_({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(r=o(x().mark((function e(){var t=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=MF(this.cfg,e,NF);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=_(_({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=FN(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=Gb(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new AS(_({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return NN[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=RF(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=$b(ex(this.extent),e)),t[0].concat(t[1])}}]);var n,r}(N);var FF=Math.PI/3,zF=[0,FF,2*FF,3*FF,4*FF,5*FF];function BF(e){return e[0]}function jF(e){return e[1]}zN("rasterTile",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(TF(e))throw new Error("tile server url is error");var n=(null==t?void 0:t.dataType)||lN.IMAGE;n===lN.RGB&&(n=lN.ARRAYBUFFER);var r=function(r,i){switch(n){case lN.IMAGE:return SF(e,r,i,t);case lN.CUSTOMIMAGE:case lN.CUSTOMTERRAINRGB:return vF(i,null==t?void 0:t.getCustomData);case lN.ARRAYBUFFER:return xF(e,r,i,(null==t?void 0:t.format)||EF,null==t?void 0:t.operation);case lN.CUSTOMARRAYBUFFER:case lN.CUSTOMRGB:return dF(i,null==t?void 0:t.getCustomData,(null==t?void 0:t.format)||EF,null==t?void 0:t.operation);default:return SF(e,r,i,t)}},i=_(_(_({},AF),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),zN("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=_(_(_({},JD),t),{},{getTileData:function(e,r){return eF(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),zN("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:_(_({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new ED(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:_(_(_({},wD),t),{},{getTileData:function(e,t){return PD(t,i,e,r)}}),isTile:!0}})),zN("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:_(_(_({},CF),t),{},{getTileData:function(e){return kF(e)}}),isTile:!0}})),zN("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),XN(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(Fy(e,(function(e,r){var i=function(e,t){return void 0===t?null:1*C(e.properties[t])==="number"?1*e.properties[t]:e.properties&&e.properties[t]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(e.properties[t]+"")%1000019:null}(e,null==t?void 0:t.featureId);null===i&&(i=r);var o=i,a=KN(e),s=_(_({},e.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),zN("image",ID),zN("csv",(function(e,t){return $N(YN(e),t)})),zN("json",$N),zN("raster",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,c=t.max,l=t.format,h=t.operation;return void 0===l||hF(e)?(n=Array.from(e),r=a,i=s):n=aF(Array.isArray(e)?e:[e],l,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:c,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),zN("rasterRgb",(function(e,t){var n=t.extent,r=t.min,i=t.max,o=t.width,a=t.height,s=t.format,u=t.operation,c=b(t,wF);return{_id:1,dataArray:[_(_({_id:1,data:void 0===s||hF(e)?Array.from(e):aF(Array.isArray(e)?e:[e],s,u),width:o,height:a},c),{},{min:r,max:i,coordinates:[[n[0],n[1]],[n[2],n[3]]]})]}})),BN("cluster",RF),BN("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),BN("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return _(_({},e),o[t])})),e})),BN("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),BN("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*6378e3)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=h(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var u=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+o)/2);if(u.xOffset<=0||u.yOffset<=0)return{gridHash:{},gridOffset:u};var c,l={},f=h(e);try{for(f.s();!(c=f.n()).done;){var p=c.value,d=p.coordinates[1],v=p.coordinates[0];if(Number.isFinite(d)&&Number.isFinite(v)){var g=Math.floor((d+90)/u.yOffset),m=Math.floor((v+180)/u.xOffset),y="".concat(g,"-").concat(m);l[y]=l[y]||{count:0,points:[]},l[y].count+=1,l[y].points.push(p)}}}catch(e){f.e(e)}finally{f.f()}return{gridHash:l,gridOffset:u}}(n,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c={};if(n.field&&n.method){var l=Nx(e[i].points,n.field);c[n.method]=Lx[n.method](l)}return Object.assign(c,{_id:o,originCoordinates:[t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90],coordinates:Zb([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(c),r}),[])}(a.gridHash,a.gridOffset,t)}})),BN("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=e.coordinates,n=E(Zb(e.coordinates),2),r=n[0],i=n[1];return _(_({},e),{},{originCoordinates:t,coordinates:[r,i]})}));return{dataArray:function(){var e,t,n,r=0,i=0,o=1,a=1,s=BF,u=jF;function c(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(l=+s.call(null,c=e[r],r,e))&&!isNaN(h=+u.call(null,c,r,e))){var c,l,h,f=Math.round(h/=n),p=Math.round(l=l/t-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=l-p,g=p+(l<p?-1:1)/2,m=f+(h<f?-1:1),y=l-g,_=h-m;v*v+d*d>y*y+_*_&&(p=g+(1&f?1:-1)/2,f=m)}var b=p+"-"+f,x=i[b];x?x.push(c):(o.push(x=i[b]=[c]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return o}function l(e){var t=0,n=0;return zF.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return c.hexagon=function(t){return"m"+l(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(i/n),c=Math.round(r/t),l=u*n;l<a+e;l+=n,++u)for(var h=c*t+(1&u)*t/2;h<o+t/2;h+=t)s.push([h,l]);return s},c.mesh=function(){var t=l(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(s=e,c):s},c.y=function(e){return arguments.length?(u=e,c):u},c.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(FF),n=1.5*e,c):e},c.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],c):[o-r,a-i]},c.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],c):[[r,i],[o,a]]},c.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(u).map((function(e,n){if(t.field&&a){var r=Nx(e,t.field);e[a]=Lx[a](r)}return f(f(f(f(f(f({},t.method,e[a]),"count",e.length),"rawData",e),"originCoordinates",e[0]?e[0].originCoordinates:[e.x,e.y]),"coordinates",[e.x,e.y]),"_id",n)})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}})),sr({target:"String",proto:!0,forced:zE("anchor")},{anchor:function(e){return FE(this,"a","name",e)}});var UF=function(e){function t(e){var n;return s(this,t),f(n=a(this,t),"markerOption",void 0),f(n,"defaultMarker",void 0),f(n,"popup",void 0),f(n,"mapsService",void 0),f(n,"sceneSerive",void 0),f(n,"lngLat",void 0),f(n,"scene",void 0),f(n,"added",!1),f(n,"eventHandle",(function(e){n.polyfillEvent(e),n.emit(e.type,{target:e,data:n.markerOption.extData,lngLat:n.lngLat})})),f(n,"touchStartTime",void 0),n.markerOption=_(_({},n.getDefault()),e),Jm(["update","onMove","onMapClick"],n),n.init(),n}return v(t,e),l(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:zd.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(Oe.IMapService),this.sceneSerive=e.get(Oe.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&Tm(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&Tm(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),Rm(t,"".concat(Bd[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,c=s.containerWidth,l=s.bounds;if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>c){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);a.x=f.x}}(a.x>c||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=Am("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}wm(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),jd(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&($m()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}])}(N),VF=function(e){function t(e){var n,r;return s(this,t),f(r=a(this,t),"markers",[]),f(r,"markerLayerOption",void 0),f(r,"clusterIndex",void 0),f(r,"points",[]),f(r,"clusterMarkers",[]),f(r,"mapsService",void 0),f(r,"scene",void 0),f(r,"zoom",void 0),f(r,"bbox",void 0),f(r,"inited",void 0),f(r,"containerSize",void 0),r.markerLayerOption=zk(r.getDefault(),e),Jm(["update"],r),r.zoom=(null===(n=r.markerLayerOption.clusterOption)||void 0===n?void 0:n.zoom)||-99,r}return v(t,e),l(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(Oe.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=$b(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e),this.inited&&e.addTo(this.scene)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:_(_({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new IF({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=Dx(o,Nx(null==s?void 0:s.map((function(e){return f({},i,e.properties[i])})),i)),c="point_"+o;e.properties[c]=u.toFixed(2)}}var l=n.clusterMarker(e);n.clusterMarkers.push(l),l.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new UF({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!Jb(this.bbox,t))&&(this.bbox=$b(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=Am("div","l7-marker-cluster"),n=Am("div","",t),r=Am("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}])}(N);window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",n=n,(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(e){}}(window);fN(".l7-marker-container {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  pointer-events: none;\n}\n.l7-marker-container > *{\n  pointer-events: auto;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: flex;\n  align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: flex;\n  flex-wrap: wrap;\n  box-sizing: border-box;\n  align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-flex;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-flex-direction: column;\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-flex-direction: row;\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-flex-direction: row-reverse;\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var GF=function(e){function t(e){var n;return s(this,t),f(n=a(this,t),"controlOption",void 0),f(n,"container",void 0),f(n,"isShow",void 0),f(n,"sceneContainer",void 0),f(n,"scene",void 0),f(n,"mapsService",void 0),f(n,"renderService",void 0),f(n,"layerService",void 0),f(n,"controlService",void 0),f(n,"configService",void 0),t.controlCount++,n.controlOption=_(_({},n.getDefault(e)),e||{}),n}return v(t,e),l(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=E(n,2),i=r[0];void 0===r[1]&&(e[i]=t[i])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=_(_({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(Oe.IMapService),this.renderService=e.get(Oe.IRendererService),this.layerService=e.get(Oe.ILayerService),this.controlService=e.get(Oe.IControlService),this.configService=e.get(Oe.IGlobalConfigService),this.scene=e.get(Oe.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),wm(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Tm(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Am("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){Cm(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){wm(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:qw.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qw.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&Cm(t,n),e&&wm(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}])}(L);f(GF,"controlCount",0);var HF=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"isDisable",!1),f(e,"button",void 0),f(e,"buttonText",void 0),f(e,"buttonIcon",void 0),e}return v(t,e),l(t,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Am("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var n=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(n),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),p(d(t.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&Tm(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(Cm(this.button,"l7-button-control--row"),Cm(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=Am("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,wm(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(Tm(this.buttonText),this.buttonText=void 0)}}])}(GF),WF=function(e){function t(e,n){var r;return s(this,t),f(r=a(this,t),"popperDOM",void 0),f(r,"contentDOM",void 0),f(r,"button",void 0),f(r,"option",void 0),f(r,"isShow",!1),f(r,"content",void 0),f(r,"timeout",null),f(r,"show",(function(){return r.isShow||!r.contentDOM.innerHTML||(r.resetPopperPosition(),Cm(r.popperDOM,"l7-popper-hide"),r.isShow=!0,r.option.unique&&t.conflictPopperList.forEach((function(e){e!==r&&e.isShow&&e.hide()})),r.emit("show")),r})),f(r,"hide",(function(){return r.isShow?(wm(r.popperDOM,"l7-popper-hide"),r.isShow=!1,r.emit("hide"),r):r})),f(r,"setHideTimeout",(function(){r.timeout||(r.timeout=window.setTimeout((function(){r.isShow&&(r.hide(),r.timeout=null)}),300))})),f(r,"clearHideTimeout",(function(){r.timeout&&(window.clearTimeout(r.timeout),r.timeout=null)})),f(r,"onBtnClick",(function(){r.isShow?r.hide():r.show()})),f(r,"onBtnMouseLeave",(function(){r.setHideTimeout()})),f(r,"onBtnMouseMove",(function(){r.clearHideTimeout(),r.isShow||r.show()})),r.button=e,r.option=n,r.init(),n.unique&&t.conflictPopperList.push(r),r}return v(t,e),l(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(Um(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Tm(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=E(i,2),s=a[0],u=a[1],c=this.button.getBoundingClientRect(),l=Bm(c,n.getBoundingClientRect()),h=l.left,f=l.right,p=l.top,d=l.bottom,v=!1,g=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(c.width+f,"px"):o.includes("right")&&(e.left="".concat(c.width+h,"px")),o.includes("start")?e.top="".concat(p,"px"):o.includes("end")?e.bottom="".concat(d,"px"):(e.top="".concat(p+c.height/2,"px"),g=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(c.height+d,"px"):o.includes("bottom")&&(e.top="".concat(c.height+p,"px")),o.includes("start")?e.left="".concat(h,"px"):o.includes("end")?e.right="".concat(f,"px"):(e.left="".concat(h+c.width/2,"px"),v=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(v?"50%":"0%","), calc(").concat(u,"px - ").concat(g?"50%":"0%",")");var m=o.split("-");m.length&&wm(this.popperDOM,m.map((function(e){return"l7-popper-".concat(e)})).join(" ")),Dm(this.popperDOM,zm(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=Am("div","l7-popper l7-popper-hide ".concat(r)),a=Am("div","l7-popper-content"),s=Am("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}])}(N);f(WF,"conflictPopperList",[]);var YF={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},XF=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"popper",void 0),e}return v(t,e),l(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),p(d(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var n,r=p(d(t.prototype),"getDefault",this).call(this,e),i=null!==(n=null==e?void 0:e.position)&&void 0!==n?n:r.position;return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:i instanceof Element?"bottom":YF[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=p(d(t.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new WF(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(p(d(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var n=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(n)}}}])}(HF),ZF=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(ZF||{}),qF=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"selectValue",[]),f(e,"optionDOMList",void 0),f(e,"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=Am("div","l7-select-control-item ".concat(n?ZF.ActiveOptionClassName:""));e.getIsMultiple()&&r.appendChild(e.createCheckbox(n)),t.icon&&r.appendChild(t.icon);var i=Am("span");return i.innerText=t.text,r.appendChild(i),r})),f(e,"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(T(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return v(t,e),l(t,[{key:"setOptions",value:function(e){p(d(t.prototype),"setOptions",this).call(this,e);var n=e.options;n&&this.popper.setContent(this.getPopperContent(n))}},{key:"onAdd",value:function(){var e=p(d(t.prototype),"onAdd",this).call(this),n=this.controlOption.defaultValue;return n&&(this.selectValue=this.transSelectValue(n)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var n=e.getAttribute(ZF.OptionValueAttrKey),i=t.getIsMultiple()?e.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(wm(e,ZF.ActiveOptionClassName),i&&jm(i,!0)):(Cm(e,ZF.ActiveOptionClassName),i&&jm(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=Am("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&wm(r,"l7-select-control--multiple");var i=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(ZF.OptionValueAttrKey,e.value),i.setAttribute(ZF.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,T(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=Am("div","l7-select-control-item ".concat(t?ZF.ActiveOptionClassName:"")),r=Am("img");r.setAttribute("src",e.img),Vm(r),n.appendChild(r);var i=Am("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=Am("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=Am("input");return t.setAttribute("type","checkbox"),e&&jm(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}])}(XF),KF=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t},QF=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"onClick",o(x().mark((function t(){var n;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(n=e.controlOption.onExport)){t.next=5;break}t.next=10;break;case 5:return t.t0=n,t.next=8,e.getImage();case 8:t.t1=t.sent,(0,t.t0)(t.t1);case 10:case"end":return t.stop()}}),t)})))),f(e,"mergeImage",o(x().mark((function t(){var n,r,i,o,a,s,u,c,l,h,f,p,d,v=arguments;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,u=o.height,c=void 0===u?0:u,(l=document.createElement("canvas")).width=s,l.height=c,h=l.getContext("2d"),f=v.length,p=new Array(f),d=0;d<f;d++)p[d]=v[d];return t.next=9,Promise.all(p.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==h||h.drawImage(e,0,0,s,c)})),t.abrupt("return",l.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return v(t,e),l(t,[{key:"onAdd",value:function(){var e=p(d(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{title:"å¯¼åºå¾ç",btnIcon:KF("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(n=o(x().mark((function e(){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,T([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n}(HF),$F=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],JF=function(){if("undefined"==typeof document)return!1;for(var e=$F[0],t={},n=0,r=$F;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=h(i.entries());try{for(a.s();!(o=a.n()).done;){var s=E(o.value,2),u=s[0],c=s[1];t[e[u]]=c}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),ez={change:JF.fullscreenchange,error:JF.fullscreenerror},tz={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){tz.off("change",e),n()};tz.on("change",i);var o=e[JF.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(tz.isFullscreen){var n=function t(){tz.off("change",t),e()};tz.on("change",n);var r=document[JF.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return tz.isFullscreen?tz.exit():tz.request(e,t)},onchange:function(e){tz.on("change",e)},onerror:function(e){tz.on("error",e)},on:function(e,t){var n=ez[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=ez[e];n&&document.removeEventListener(n,t,!1)},raw:JF};Object.defineProperties(tz,{isFullscreen:{get:function(){return Boolean(document[JF.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[JF.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[JF.fullscreenEnabled])}}}),JF||(tz={isEnabled:!1});var nz=tz,rz=function(e){function t(e){var n;return s(this,t),f(n=a(this,t,[e]),"isFullscreen",!1),f(n,"mapContainer",void 0),f(n,"toggleFullscreen",o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!nz.isEnabled){e.next=3;break}return e.next=3,nz.toggle(n.mapContainer);case 3:case"end":return e.stop()}}),e)})))),f(n,"onClick",(function(){n.toggleFullscreen()})),f(n,"onFullscreenChange",(function(){n.isFullscreen=!!document.fullscreenElement;var e=n.controlOption,t=e.btnText,r=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;n.isFullscreen?(n.setBtnTitle(s),n.setBtnText(o),n.setBtnIcon(a)):(n.setBtnTitle(i),n.setBtnText(t),n.setBtnIcon(r)),n.emit("fullscreenChange",n.isFullscreen)})),nz.isEnabled||console.warn("å½åæµè§å¨ç¯å¢ä¸æ¯æå¯¹å°å¾å¨å±å"),n}return v(t,e),l(t,[{key:"setOptions",value:function(e){var n=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(n),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),p(d(t.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=p(d(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=xm(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){p(d(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{title:"å¨å±",btnIcon:KF("l7-icon-fullscreen"),exitTitle:"éåºå¨å±",exitBtnIcon:KF("l7-icon-exit-fullscreen")})}}])}(HF);var iz=function(e){return"number"==typeof e||uS(e)&&"[object Number]"==Yv(e)};var oz=function(e){return iz(e)&&e!=+e},az=function(e){function t(e){var n;return s(this,t),f(n=a(this,t,[e]),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;oz(o)||oz(a)?t():e([o,a])}),(function(e){t(e)}))}))})),f(n,"onClick",o(x().mark((function e(){var t,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=n.controlOption.transform,e.next=5,n.getGeoLocation();case 5:if(r=e.sent,i=n.mapsService.getZoom(),e.t0=n.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(r);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=r;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("å½åæµè§å¨ç¯å¢ä¸æ¯æè·åå°çå®ä½"),n}return v(t,e),l(t,[{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{title:"å®ä½",btnIcon:KF("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=p(d(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}])}(HF),sz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),f(e,"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),f(e,"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return v(t,e),l(t,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&n.push(t),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{title:"å¾å±æ§å¶",btnIcon:KF("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var n=this.checkUpdateOption(e,["layers"]);p(d(t.prototype),"setOptions",this).call(this,e),n&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),p(d(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}])}(qF),uz=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getDefault",value:function(){return{position:qw.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=Am("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){p(d(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(Um(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=Am("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),Vm(i),n){var o=Am("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}])}(GF),cz={normal:{text:"æ å",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"æåé¶",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"å¹»å½±é»",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"èè²é",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"éå£«ç°",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"æ¶é¸¦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"é©¬å¡é¾",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"æå¤è",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"é±ç±½",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},lz={normal:{text:"æ å",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"äº®",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"æ",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"å«æ",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"æ·å¤",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},hz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return v(t,e),l(t,[{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{title:"å°å¾æ ·å¼",btnIcon:KF("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?lz:cz;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=E(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=E(t,2),i=r[0],o=r[1],a=null!==(n=e[i])&&void 0!==n?n:{},s=a.text;return{text:null!=s?s:i,value:o,img:a.img,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,n=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=n.mapsService.getMapStyle();n.controlOption.defaultValue=e,n.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),p(d(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}])}(qF),fz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"location",[0,0]),f(e,"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return v(t,e),l(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{position:qw.BOTTOMLEFT,transform:function(e){var t=E(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=Am("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}])}(GF),pz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"mScale",void 0),f(e,"iScale",void 0),f(e,"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=Qb([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return v(t,e),l(t,[{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:qw.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=Am("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){p(d(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){Um(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&Dm(e,"width: ".concat(i,"px")),n&&(this.mScale=Am("div","l7-control-scale-line",e)),r&&(this.iScale=Am("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}])}(GF),dz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"disabled",void 0),f(e,"zoomInButton",void 0),f(e,"zoomOutButton",void 0),f(e,"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),f(e,"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),f(e,"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return v(t,e),l(t,[{key:"getDefault",value:function(e){return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{position:qw.BOTTOMRIGHT,name:"zoom",zoomInText:KF("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:KF("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){p(d(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=Am("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){Um(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=Am("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,o.addEventListener("click",i),o}}])}(GF),vz=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gz=/^\w*$/;var mz=function(e,t){if(nk(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!cS(e))||(gz.test(e)||!vz.test(e)||null!=t&&e in Object(t))};function yz(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(yz.Cache||OC),n}yz.Cache=OC;var _z=yz;var bz=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xz=/\\(\\)?/g,Sz=function(e){var t=_z(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(bz,(function(e,n,r,i){t.push(r?i.replace(xz,"$1"):n||e)})),t}));var Ez=function(e,t){return nk(e)?e:mz(e,t)?[e]:Sz(xO(e))};var Az=function(e){if("string"==typeof e||cS(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};var Tz=function(e,t){for(var n=0,r=(t=Ez(t,e)).length;null!=e&&n<r;)e=e[Az(t[n++])];return n&&n==r?e:void 0};var wz=function(e,t,n){var r=null==e?void 0:Tz(e,t);return void 0===r?n:r},Cz=function(e){function t(e){var n;s(this,t),f(n=a(this,t),"popupOption",void 0),f(n,"mapsService",void 0),f(n,"sceneService",void 0),f(n,"layerService",void 0),f(n,"scene",void 0),f(n,"closeButton",void 0),f(n,"container",void 0),f(n,"content",void 0),f(n,"contentTitle",void 0),f(n,"contentPanel",void 0),f(n,"tip",void 0),f(n,"isShow",!0),f(n,"onMouseMove",(function(e){var t,r=n.mapsService.getMapContainer(),i=null!==(t=null==r?void 0:r.getBoundingClientRect())&&void 0!==t?t:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;n.setPopupPosition(e.clientX-a,e.clientY-u)})),f(n,"updateLngLatPosition",(function(){if(n.mapsService&&!n.popupOption.followCursor){var e=n.lngLat,t=e.lng,r=e.lat,i=n.mapsService.lngLatToContainer([t,r]),o=i.x,a=i.y;n.setPopupPosition(o,a)}})),f(n,"onKeyDown",(function(e){27===e.keyCode&&n.remove()})),f(n,"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),n.hide()})),f(n,"update",(function(){var e=!!n.lngLat,t=n.popupOption,r=t.className,i=t.style,o=t.maxWidth,a=t.anchor,s=t.stopPropagation;if(n.mapsService&&e&&n.content){var u=n.mapsService.getMarkerContainer();if(!n.container&&u&&(n.container=Am("div","l7-popup ".concat(null!=r?r:""," ").concat(n.isShow?"":"l7-popup-hide"),u),i&&n.container.setAttribute("style",i),n.tip=Am("div","l7-popup-tip",n.container),n.container.appendChild(n.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){n.container.addEventListener(e,(function(e){e.stopPropagation()}))})),n.container.style.whiteSpace="nowrap"),n.updateLngLatPosition(),Rm(n.container,"".concat(Bd[a])),jd(n.container,a,"popup"),o)n.container.getBoundingClientRect().width>parseFloat(o)&&(n.container.style.width=o);else n.container.style.removeProperty("width")}})),n.popupOption=_(_({},n.getDefault(null!=e?e:{})),e);var r=n.popupOption.lngLat;return r&&(n.lngLat=r),n}return v(t,e),l(t,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(Oe.IMapService),this.sceneService=e.get(Oe.ISceneService),this.layerService=e.get(Oe.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!=this&&this.isOpen())return this.content&&Tm(this.content),this.container&&(Tm(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=_(_({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Tm(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Cm(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&wm(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=Am("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Um(this.contentTitle),Gm(this.contentTitle,e)):this.contentTitle&&(Tm(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:zd.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),Gm(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null==n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&Tm(this.content),this.contentTitle=void 0,this.content=Am("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=KF("l7-icon-guanbi");wm(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Am("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){if(this.container){var n=this.popupOption.offsets;this.container.style.left=e+n[0]+"px",this.container.style.top=t-n[1]+"px"}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}])}(N),kz=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"layerConfigMap",new WeakMap),f(e,"displayFeatureInfo",void 0),e}return v(t,e),l(t,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!=n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return p(d(t.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return p(d(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),p(d(t.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var n="click"===e.trigger;return _(_({},p(d(t.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!n,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var r,i=e.getLayerByConfig(n);if(i){var o=_({},n);if("hover"===t){var a=e.onLayerMouseMove.bind(e,i),s=e.onLayerMouseOut.bind(e,i);o.onMouseMove=a,o.onMouseOut=s,null==i||i.on("mousemove",a),null==i||i.on("mouseout",s)}else{var u=e.onLayerClick.bind(e,i);o.onClick=u,null==i||i.on("click",u)}var c=null==i||null===(r=i.getSource)||void 0===r?void 0:r.call(i),l=e.onSourceUpdate.bind(e,i);null==c||c.on("update",l),o.onSourceUpdate=l,e.layerConfigMap.set(i,o)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n=e.getLayerByConfig(t),r=n&&e.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u)null==n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,t){if(this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setLnglat(t.lngLat),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onSourceUpdate",value:function(e){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var o=t.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a)Gm(n=document.createDocumentFragment(),a instanceof Function?a(o):a);if(u){var c=u instanceof Function?u(o):u;Gm(i,c)}else null!=s&&s.length&&(null==s||s.forEach((function(e){var n,r,a="string"==typeof e?{field:e}:e,s=a.field,u=a.formatField,c=a.formatValue,l=a.getValue,h=Am("div","l7-layer-popup__row"),f=l?l(t.feature):wz(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=c instanceof Function?c(f,o):c)&&void 0!==r?r:f,v=Am("span","l7-layer-popup__key",h);Gm(v,p),Gm(v,document.createTextNode("ï¼"));var g=Am("span","l7-layer-popup__value",h);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),Gm(g,d),i.appendChild(h)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}}])}(Cz);var Mz=function(e){return void 0===e};var Pz=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var Iz=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(e),l=o.get(t);if(c&&l)return c==t&&l==e;var h=-1,f=!0,p=2&n?new AR:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var d=e[h],v=t[h];if(r)var g=a?r(v,d,h,t,e,o):r(d,v,h,e,t,o);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!Pz(t,(function(e,t){if(!CR(p,t)&&(d===e||i(d,e,n,r,o)))return p.push(t)}))){f=!1;break}}else if(d!==v&&!i(d,v,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f};var Rz=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},Oz=Fv?Fv.prototype:void 0,Lz=Oz?Oz.valueOf:void 0;var Nz=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new UC(e),new UC(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return tC(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Rz;case"[object Set]":var u=1&r;if(s||(s=MR),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var l=Iz(s(e),s(t),r,i,o,a);return a.delete(e),l;case"[object Symbol]":if(Lz)return Lz.call(e)==Lz.call(t)}return!1},Dz=Object.prototype.hasOwnProperty;var Fz=function(e,t,n,r,i,o){var a=1&n,s=PM(e),u=s.length;if(u!=PM(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:Dz.call(t,l)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++c<u;){var v=e[l=s[c]],g=t[l];if(r)var m=a?r(g,v,l,t,e,o):r(v,g,l,e,t,o);if(!(void 0===m?v===g||i(v,g,n,r,o):m)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=e.constructor,_=t.constructor;y==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return o.delete(e),o.delete(t),p},zz=Object.prototype.hasOwnProperty;var Bz=function(e,t,n,r,i,o){var a=nk(e),s=nk(t),u=a?"[object Array]":VM(e),c=s?"[object Array]":VM(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f=u==c;if(f&&sk(e)){if(!sk(t))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new DC),a||yk(e)?Iz(e,t,n,r,i,o):Nz(e,t,u,n,r,i,o);if(!(1&n)){var p=l&&zz.call(e,"__wrapped__"),d=h&&zz.call(t,"__wrapped__");if(p||d){var v=p?e.value():e,g=d?t.value():t;return o||(o=new DC),i(v,g,n,r,o)}}return!!f&&(o||(o=new DC),Fz(e,t,n,r,i,o))};var jz=function e(t,n,r,i,o){return t===n||(null==t||null==n||!uS(t)&&!uS(n)?t!=t&&n!=n:Bz(t,n,r,i,e,o))};var Uz=function(e,t){return jz(e,t)},Vz=f(f(f(f(f(f({},Bk.additive,{enable:!0,func:{srcRGB:IP.ONE,dstRGB:IP.ONE,srcAlpha:1,dstAlpha:1}}),Bk.none,{enable:!1}),Bk.normal,{enable:!0,func:{srcRGB:IP.SRC_ALPHA,dstRGB:IP.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),Bk.subtractive,{enable:!0,func:{srcRGB:IP.ONE,dstRGB:IP.ONE,srcAlpha:IP.ZERO,dstAlpha:IP.ONE_MINUS_SRC_COLOR},equation:{rgb:IP.FUNC_SUBTRACT,alpha:IP.FUNC_SUBTRACT}}),Bk.max,{enable:!0,func:{srcRGB:IP.ONE,dstRGB:IP.ONE},equation:{rgb:IP.MAX_EXT}}),Bk.min,{enable:!0,func:{srcRGB:IP.ONE,dstRGB:IP.ONE},equation:{rgb:IP.MIN_EXT}});sr({target:"Math",stat:!0},{sign:cc});var Gz,Hz=Wz;function Wz(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}function Yz(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function Xz(e,t,n){return Math.min(n,Math.max(t,e))}function Zz(e,t,n){return e*(1-n)+t*n}function qz(e,t,n,r){var i=new Hz(e,t,n,r);return function(e){return i.solve(e)}}Wz.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Wz.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Wz.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Wz.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},Wz.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Kz=qz(.25,.1,.25,1);function Qz(){return!(Sd||!Ad.matchMedia)&&(null==Gz&&(Gz=Ad.matchMedia("(prefers-reduced-motion: reduce)")),Gz.matches)}function $z(e,t){var n,r={},i=h(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var Jz=Sd?Date.now.bind(Date):Ad.performance&&Ad.performance.now?Ad.performance.now.bind(Ad.performance):Date.now.bind(Date),eB=Ad.requestAnimationFrame||Ad.mozRequestAnimationFrame||Ad.webkitRequestAnimationFrame||Ad.msRequestAnimationFrame,tB=Ad.cancelAnimationFrame||Ad.mozCancelAnimationFrame||Ad.webkitCancelAnimationFrame||Ad.msCancelAnimationFrame;function nB(e){var t=eB(e);return{cancel:function(){return tB(t)}}}var rB=function(){function e(t,n){if(s(this,e),f(this,"lng",void 0),f(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return l(e,[{key:"wrap",value:function(){return new e(Yz(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===C(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}])}(),iB=function(){function e(t,n){s(this,e),f(this,"ne",void 0),f(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return l(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof rB?new rB(e.lng,e.lat):rB.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof rB?new rB(e.lng,e.lat):rB.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof rB)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(rB.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new rB(n.lng,n.lat),this.ne=new rB(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new rB((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new rB(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new rB(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=rB.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}])}(),oB=function(){function e(t,n){s(this,e),f(this,"x",void 0),f(this,"y",void 0),this.x=t,this.y=n}return l(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}])}();cl("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),cl("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var aB=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(s(this,e),f(this,"top",void 0),f(this,"bottom",void 0),f(this,"left",void 0),f(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return l(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=Zz(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Zz(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=Zz(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=Zz(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=Xz((this.left+e-this.right)/2,0,e),r=Xz((this.top+t-this.bottom)/2,0,t);return new oB(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}])}(),sB=2*Math.PI*6371008.8;function uB(e){return sB*Math.cos(e*Math.PI/180)}function cB(e){return(180+e)/360}function lB(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function hB(e,t){return e/uB(t)}function fB(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var pB=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s(this,e),f(this,"x",void 0),f(this,"y",void 0),f(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return l(e,[{key:"toLngLat",value:function(){return new rB(360*this.x-180,fB(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*uB(fB(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/sB*(e=fB(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=rB.convert(t);return new e(cB(r.lng),lB(r.lat),hB(n,r.lat))}}])}(),dB=function(){function e(t,n,r,i,o){s(this,e),f(this,"tileSize",void 0),f(this,"tileZoom",void 0),f(this,"lngRange",void 0),f(this,"latRange",void 0),f(this,"maxValidLatitude",void 0),f(this,"scale",void 0),f(this,"width",void 0),f(this,"height",void 0),f(this,"angle",void 0),f(this,"rotationMatrix",void 0),f(this,"pixelsToGLUnits",void 0),f(this,"cameraToCenterDistance",void 0),f(this,"mercatorMatrix",void 0),f(this,"projMatrix",void 0),f(this,"invProjMatrix",void 0),f(this,"alignedProjMatrix",void 0),f(this,"pixelMatrix",void 0),f(this,"pixelMatrixInverse",void 0),f(this,"glCoordMatrix",void 0),f(this,"labelPlaneMatrix",void 0),f(this,"_fov",void 0),f(this,"_pitch",void 0),f(this,"_zoom",void 0),f(this,"_renderWorldCopies",void 0),f(this,"_minZoom",void 0),f(this,"_maxZoom",void 0),f(this,"_minPitch",void 0),f(this,"_maxPitch",void 0),f(this,"_center",void 0),f(this,"zoomFraction",void 0),f(this,"unmodified",void 0),f(this,"edgeInsets",void 0),f(this,"constraining",void 0),f(this,"posMatrixCache",void 0),f(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new rB(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new aB,this.posMatrixCache={},this.alignedPosMatrixCache={}}return l(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new oB(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t=-Yz(e,-180,180)*Math.PI/180;this.angle!==t&&(this.unmodified=!1,this.angle=t,this.calcMatrices(),this.rotationMatrix=BE(),jE(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=Xz(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=Xz(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new oB(cB(e.lng)*this.worldSize,lB(t)*this.worldSize)}},{key:"unproject",value:function(e){return new pB(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new pB(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);Qy(t,t,this.pixelMatrixInverse),Qy(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,c=t[2]/r,l=n[2]/i,h=c===l?0:(0-c)/(l-c);return new pB(Zz(o,a,h)/this.worldSize,Zz(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new iB).extend(this.pointLocation(new oB(0,0))).extend(this.pointLocation(new oB(this.width,0))).extend(this.pointLocation(new oB(this.width,this.height))).extend(this.pointLocation(new oB(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new iB([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new oB(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return Qy(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new oB(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=h(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new oB(r,i),new oB(o,i),new oB(o,a),new oB(r,a),new oB(r,i)]}},{key:"coordinatePoint",value:function(e){var t=Ky(e.x*this.worldSize,e.y*this.worldSize,0,1);return Qy(t,t,this.pixelMatrix),new oB(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return pB.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,c=this.unmodified;if(this.latRange){var l=this.latRange;i=lB(l[1])*this.worldSize,e=(o=lB(l[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=cB(h[0])*this.worldSize,t=(s=cB(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new oB(t?(s+a)/2:f.x,e?(o+i)/2:f.y)),Sd?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=c,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var g=f.x,m=u.x/2;g-m<a&&(n=a+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new oB(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=c,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Xz(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),c=this.height/50,l=new Float64Array(16);m_(l,this._fov,this.width/this.height,c,u),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,c_(l,l,[1,-1,1]),u_(l,l,[0,0,-this.cameraToCenterDistance]),l_(l,l,this._pitch),f_(l,l,this.angle),u_(l,l,[-a,-s,0]),this.mercatorMatrix=c_([],l,[this.worldSize,this.worldSize,this.worldSize]),c_(l,l,[1,1,hB(1,this.center.lat)*this.worldSize,1]),this.projMatrix=l,this.invProjMatrix=a_([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*h+d*f,g=s-Math.round(s)+p*f+d*h,m=new Float64Array(l);if(u_(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,c_(l=n_(),l,[this.width/2,-this.height/2,1]),u_(l,l,[1,-1,0]),this.labelPlaneMatrix=l,c_(l=n_(),l,[1,-1,1]),u_(l,l,[-1,-1,0]),c_(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=s_(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=a_(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}])}(),vB=l((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,e),f(this,"type",void 0),zk(this,n),this.type=t})),gB=function(e){function t(e){var n;s(this,t),f(n=a(this,t),"transform",void 0),f(n,"options",void 0),f(n,"moving",void 0),f(n,"zooming",void 0),f(n,"rotating",void 0),f(n,"pitching",void 0),f(n,"padding",void 0),f(n,"bearingSnap",void 0),f(n,"easeEndTimeoutID",void 0),f(n,"easeStart",void 0),f(n,"easeOptions",void 0),f(n,"easeId",void 0),f(n,"onEaseFrame",void 0),f(n,"onEaseEnd",void 0),f(n,"easeFrameId",void 0),f(n,"pitchEnabled",void 0),f(n,"rotateEnabled",void 0),f(n,"renderFrameCallback",(function(){var e=Math.min((Jz()-n.easeStart)/n.easeOptions.duration,1);n.onEaseFrame(n.easeOptions.easing(e)),e<1?n.easeFrameId=n.requestRenderFrame(n.renderFrameCallback):n.stop()})),n.options=e;var r=e.minZoom,i=e.maxZoom,o=e.minPitch,u=e.maxPitch,c=e.renderWorldCopies;return n.moving=!1,n.zooming=!1,n.bearingSnap=e.bearingSnap,n.pitchEnabled=e.pitchEnabled,n.rotateEnabled=e.rotateEnabled,n.transform=new dB(r,i,o,u,c),n}return v(t,e),l(t,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new rB(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(zk({center:e},t),n)}},{key:"panBy",value:function(e,t,n){return e=oB.convert(e).mult(-1),this.panTo(this.transform.center,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(e[s]=a[s])}return e}({offset:e},t||{}),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(zk({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(zk({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,zk({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(zk({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=iB.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=rB.convert(e.center)),void 0!==e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),void 0!==e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),void 0===e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new vB("movestart",t)),this.emit("move",new vB("move",t)),r&&(this.emit("zoomstart",new vB("zoomstart",t)),this.emit("zoom",new vB("zoom",t)),this.emit("zoomend",new vB("zoomend",t))),i&&(this.emit("rotatestart",new vB("rotatestart",t)),this.emit("rotate",new vB("rotate",t)),this.emit("rotateend",new vB("rotateend",t))),o&&(this.emit("pitchstart",new vB("pitchstart",t)),this.emit("pitch",new vB("pitch",t)),this.emit("pitchend",new vB("pitchend",t))),this.emit("moveend",new vB("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=zk({offset:[0,0],duration:500,easing:Kz},t)).animate||!t.essential&&Qz())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,c=t.bearing?this.normalizeBearing(t.bearing,o):o,l=t.pitch?+t.pitch:a,h=t.padding?t.padding:r.padding,f=oB.convert(t.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=rB.convert(t.center||d);this.normalizeCenter(v);var g,m,y=r.project(d),_=r.project(v).sub(y),b=r.zoomScale(u-i);t.around&&(g=rB.convert(t.around),m=r.locationPoint(g));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==c,this.pitching=this.pitching||l!==a,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=Zz(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=Zz(o,c,t)),e.pitching&&e.pitchEnabled&&(r.pitch=Zz(a,l,t)),e.padding&&(r.interpolatePadding(s,h,t),p=r.centerPoint.add(f)),g)r.setLocationAtPoint(g,m);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(v,1-t),S=r.unproject(y.add(_.mult(t*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&Qz()){var r=$z(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=zk({offset:[0,0],speed:1.2,curve:1.42,easing:Kz},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c=t.zoom?Xz(+t.zoom,i.minZoom,i.maxZoom):o,l=t.bearing?this.normalizeBearing(t.bearing,a):a,h=t.pitch?+t.pitch:s,f="padding"in t?t.padding:i.padding,p=i.zoomScale(c-o),d=oB.convert(t.offset),v=i.centerPoint.add(d),g=i.pointLocation(v),m=rB.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),_=i.project(m).sub(y),b=t.curve,x=Math.max(i.width,i.height),S=x/p,E=_.mag();if("minZoom"in t){var A=Xz(Math.min(t.minZoom,o,c),i.minZoom,i.maxZoom),T=x/i.zoomScale(A-o);b=Math.sqrt(T/E*2)}var w=b*b;function C(e){var t=(S*S-x*x+(e?-1:1)*w*w*E*E)/(2*(e?S:x)*w*E);return Math.log(Math.sqrt(t*t+1)-t)}function k(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}function P(e){return k(e)/M(e)}var I=C(0),R=function(e){return M(I)/M(I+b*e)},O=function(e){return x*((M(I)*P(I+b*e)-k(I))/w)/E},L=(C(1)-I)/b;if(Math.abs(E)<1e-6||!isFinite(L)){if(Math.abs(x-S)<1e-6)return this.easeTo(t,n);var N=S<x?-1:1;L=Math.abs(Math.log(S/x))/b,O=function(){return 0},R=function(e){return Math.exp(N*b*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*L/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==l,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(t){var r=t*L,p=1/R(r);i.zoom=1===t?c:o+i.scaleZoom(p),e.rotating&&(i.bearing=Zz(a,l,t)),e.pitching&&(i.pitch=Zz(s,h,t)),e.padding&&(i.interpolatePadding(u,f,t),v=i.centerPoint.add(d));var g=1===t?m:i.unproject(y.add(_.mult(O(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(oB.convert(e)),this.transform.pointLocation(oB.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=Yz(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new vB("move",e)),this.zooming&&this.emit("zoom",new vB("zoom",e)),this.rotating&&this.emit("rotate",new vB("rotate",e)),this.pitching&&this.emit("rotate",new vB("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new vB("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new vB("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new vB("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new vB("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new vB("zoomend",e)),r&&this.emit("rotateend",new vB("rotateend",e)),i&&this.emit("pitchend",new vB("pitchend",e)),this.emit("moveend",new vB("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=Jz(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=zk({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=zk(i,r.padding);var a=this.transform,s=a.padding,u=a.project(rB.convert(e)),c=a.project(rB.convert(t)),l=u.rotate(-n*Math.PI/180),h=c.rotate(-n*Math.PI/180),f=new oB(Math.max(l.x,h.x),Math.max(l.y,h.y)),p=new oB(Math.min(l.x,h.x),Math.min(l.y,h.y)),d=f.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||v<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(v,g)),r.maxZoom),y=oB.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new oB(y.x+_,y.y+b).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(c).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=zk(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}])}(N);fN(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var mB={create:function(e,t,n){var r=Ad.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},createNS:function(e,t){return Ad.document.createElementNS(e,t)}},yB=Ad.document&&Ad.document.documentElement.style;function _B(e){if(!yB)return e[0];var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in yB)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var bB,xB=_B(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);mB.disableDrag=function(){yB&&xB&&(bB=yB[xB],yB[xB]="none")},mB.enableDrag=function(){yB&&xB&&(yB[xB]=bB)};var SB=_B(["transform","WebkitTransform"]);mB.setTransform=function(e,t){e.style[SB]=t};var EB=!1;try{var AB=Object.defineProperty({},"passive",{get:function(){EB=!0}});Ad.addEventListener("test",AB,AB),Ad.removeEventListener("test",AB,AB)}catch(e){EB=!1}mB.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&EB?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},mB.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&EB?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var TB=function e(t){t.preventDefault(),t.stopPropagation(),Ad.removeEventListener("click",e,!0)};mB.suppressClick=function(){Sd||(Ad.addEventListener("click",TB,!0),setTimeout((function(){Ad.removeEventListener("click",TB,!0)}),0))},mB.mousePos=function(e,t){if(Sd)return new oB(t.clientX-e.left-0,t.clientY-e.top-0);var n=e.getBoundingClientRect();return new oB(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},mB.touchPos=function(e,t){if(Sd){var n,r=[],i=h(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new oB(o.clientX-e.left,o.clientY-e.top))}}catch(e){i.e(e)}finally{i.f()}return r}var a,s=e.getBoundingClientRect(),u=[],c=h(t);try{for(c.s();!(a=c.n()).done;){var l=a.value;u.push(new oB(l.clientX-s.left-e.clientLeft,l.clientY-s.top-e.clientTop))}}catch(e){c.e(e)}finally{c.f()}return u},mB.mouseButton=function(e){return Sd&&void 0!==Ad.InstallTrigger&&2===e.button&&e.ctrlKey&&Ad.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},mB.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var wB=function(e){function t(e,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s(this,t);var u=mB.mousePos(n.getCanvasContainer(),r),c=n.unproject(u);return f(i=a(this,t,[e,zk({point:u,lngLat:c,originalEvent:r},o)]),"type",void 0),f(i,"target",void 0),f(i,"originalEvent",void 0),f(i,"point",void 0),f(i,"lngLat",void 0),f(i,"defaultPrevented",void 0),i.defaultPrevented=!1,i.target=n,i}return v(t,e),l(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}])}(vB),CB=function(e){function t(e,n,r){var i;s(this,t);var o="touchend"===e?r.changedTouches:r.touches,u=mB.touchPos(n.getCanvasContainer(),o),c=u.map((function(e){return n.unproject(e)})),l=u.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new oB(0,0));return f(i=a(this,t,[e,{points:u,point:l,lngLats:c,lngLat:n.unproject(l),originalEvent:r}]),"type",void 0),f(i,"target",void 0),f(i,"originalEvent",void 0),f(i,"lngLat",void 0),f(i,"point",void 0),f(i,"points",void 0),f(i,"lngLats",void 0),f(i,"defaultPrevented",void 0),i.defaultPrevented=!1,i}return v(t,e),l(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}])}(vB),kB=function(e){function t(e,n,r){var i;return s(this,t),f(i=a(this,t,[e,{originalEvent:r}]),"type",void 0),f(i,"originalEvent",void 0),f(i,"defaultPrevented",void 0),f(i,"target",void 0),i.defaultPrevented=!1,i}return v(t,e),l(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}])}(vB),MB=function(){return l((function e(t){s(this,e),f(this,"map",void 0),f(this,"delayContextMenu",void 0),f(this,"contextMenuEvent",void 0),this.map=t}),[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new wB(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new wB("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new wB(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}])}(),PB=function(){return l((function e(t,n){s(this,e),f(this,"map",void 0),f(this,"el",void 0),f(this,"container",void 0),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"startPos",void 0),f(this,"lastPos",void 0),f(this,"box",void 0),f(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}),[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(mB.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=mB.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);mB.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),mB.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new vB("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(mB.remove(this.box),this.box=null),mB.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new vB(e,{originalEvent:t}))}}])}(),IB=function(){return l((function e(){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),this.reset()}),[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}])}(),RB=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","renderFrame"),f(e,"timeStamp",void 0),e}return v(t,e),l(t)}(vB),OB={linearity:.3,easing:qz(0,0,.3,1)},LB=zk({deceleration:2500,maxSpeed:1400},OB),NB=zk({deceleration:20,maxSpeed:1400},OB),DB=zk({deceleration:1e3,maxSpeed:360},OB),FB=zk({deceleration:1e3,maxSpeed:90},OB),zB=function(){return l((function e(t){s(this,e),f(this,"map",void 0),f(this,"inertiaBuffer",void 0),this.map=t,this.clear()}),[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Jz(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=Jz();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new oB(0,0),pinchAround:void 0,around:void 0},r=h(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=jB(n.pan.mag(),o,zk({},LB,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,BB(a,s)}if(n.zoom){var u=jB(n.zoom,o,NB);a.zoom=this.map.transform.zoom+u.amount,BB(a,u)}if(n.bearing){var c=jB(n.bearing,o,DB);a.bearing=this.map.transform.bearing+Xz(c.amount,-179,179),BB(a,c)}if(n.pitch){var l=jB(n.pitch,o,FB);a.pitch=this.map.transform.pitch+l.amount,BB(a,l)}if(a.zoom||a.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;a.around=f?this.map.unproject(f):this.map.getCenter()}return this.clear(),zk(a,{noMoveStart:!0})}}}])}();function BB(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function jB(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Xz(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var UB={panStep:100,bearingStep:15,pitchStep:10},VB=function(){return l((function e(){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"panStep",void 0),f(this,"bearingStep",void 0),f(this,"pitchStep",void 0);var t=UB;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}),[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:GB,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}])}();function GB(e){return e*(2-e)}var HB=function(){return l((function e(t,n){s(this,e),f(this,"mousedownPos",void 0),f(this,"clickTolerance",void 0),f(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}),[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new kB(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new wB(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new wB(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new wB(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new wB(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new wB(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new wB(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new CB(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new CB(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new CB(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new CB(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}])}(),WB=f(f({},0,1),2,2);var YB=function(){return l((function e(t){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"lastPoint",void 0),f(this,"eventButton",void 0),f(this,"moved",void 0),f(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}),[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=mB.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=WB[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(mB.mouseButton(e)===this.eventButton&&(this.moved&&mB.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}])}(),XB=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"mousedown",value:function(e,n){p(d(t.prototype),"mousedown",this).call(this,e,n),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}])}(YB),ZB=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}])}(YB),qB=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}])}(YB),KB=function(){return l((function e(t,n){var r=this;s(this,e),f(this,"map",void 0),f(this,"el",void 0),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"zooming",void 0),f(this,"aroundCenter",void 0),f(this,"around",void 0),f(this,"aroundPoint",void 0),f(this,"type",void 0),f(this,"lastValue",void 0),f(this,"timeout",void 0),f(this,"finishTimeout",void 0),f(this,"lastWheelEvent",void 0),f(this,"lastWheelEventTime",void 0),f(this,"startZoom",void 0),f(this,"targetZoom",void 0),f(this,"delta",void 0),f(this,"easing",void 0),f(this,"prevEase",void 0),f(this,"frameId",void 0),f(this,"handler",void 0),f(this,"defaultZoomRate",void 0),f(this,"wheelZoomRate",void 0),f(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,c=!1;if("wheel"===r.type&&s&&u){var l=Math.min((Jz()-r.lastWheelEventTime)/200,1);o=Zz(s,a,u(l)),l<1?r.frameId||(r.frameId=!0):c=!0}else o=a,c=!0;return r.active=!0,c&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=1/450}),[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=Jz(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%4.000244140625==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=mB.mousePos(this.el,e);this.around=rB.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=Kz;if(this.prevEase){var n=this.prevEase,r=(Jz()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=qz(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Jz(),duration:e,easing:t},t}}])}(),QB=function(){return l((function e(t,n){s(this,e),f(this,"clickZoom",void 0),f(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}),[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}])}(),$B=function(){return l((function e(t,n,r){s(this,e),f(this,"inertiaOptions",void 0),f(this,"el",void 0),f(this,"mousePan",void 0),f(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}),[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),Sd||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),Sd||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}])}(),JB=function(){return l((function e(t,n,r){s(this,e),f(this,"mouseRotate",void 0),f(this,"mousePitch",void 0),f(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}),[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}])}(),ej=function(){return l((function e(t,n,r,i){s(this,e),f(this,"el",void 0),f(this,"touchZoom",void 0),f(this,"touchRotate",void 0),f(this,"tapDragZoom",void 0),f(this,"rotationDisabled",void 0),f(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}),[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),Sd||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),Sd||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}])}();function tj(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var nj=function(){return l((function e(t){s(this,e),f(this,"numTouches",void 0),f(this,"centroid",void 0),f(this,"startTime",void 0),f(this,"aborted",void 0),f(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}),[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new oB(0,0),r=h(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=tj(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=tj(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}])}(),rj=function(){return l((function e(t){s(this,e),f(this,"singleTap",void 0),f(this,"numTaps",void 0),f(this,"lastTime",void 0),f(this,"lastTap",void 0),f(this,"count",void 0),this.singleTap=new nj(t),this.numTaps=t.numTaps,this.reset()}),[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}])}(),ij=function(){return l((function e(){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"swipePoint",void 0),f(this,"swipeTouch",void 0),f(this,"tapTime",void 0),f(this,"tap",void 0),this.tap=new rj({numTouches:1,numTaps:1}),this.reset()}),[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}])}(),oj=function(){return l((function e(){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"zoomIn",void 0),f(this,"zoomOut",void 0),this.zoomIn=new rj({numTouches:1,numTaps:2}),this.zoomOut=new rj({numTouches:2,numTaps:1}),this.reset()}),[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}])}(),aj=function(){return l((function e(t){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"touches",void 0),f(this,"minTouches",void 0),f(this,"clickTolerance",void 0),f(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}),[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new oB(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=tj(n,t),i=new oB(0,0),o=new oB(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],c=this.touches[s];c&&(i._add(u),o._add(u.sub(c)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var l=o.div(a);if(this.sum._add(l),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:l}}}}])}(),sj=function(){return l((function e(){s(this,e),f(this,"enabled",void 0),f(this,"active",void 0),f(this,"firstTwoTouches",void 0),f(this,"vector",void 0),f(this,"startVector",void 0),f(this,"aroundCenter",void 0),this.reset()}),[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=E(this.firstTwoTouches,2),i=r[0],o=r[1],a=uj(n,t,i),s=uj(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=E(this.firstTwoTouches,2),i=r[0],o=r[1],a=uj(n,t,i),s=uj(n,t,o);a&&s||(this.active&&mB.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}])}();function uj(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function cj(e){return Math.abs(e.y)>Math.abs(e.x)}var lj=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"valid",void 0),f(e,"firstMove",void 0),f(e,"lastPoints",void 0),e}return v(t,e),l(t,[{key:"reset",value:function(){p(d(t.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,cj(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return cj(e)&&cj(t)&&o}}}])}(sj);function hj(e,t){return 180*e.angleWith(t)/Math.PI}var fj=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"minDiameter",void 0),e}return v(t,e),l(t,[{key:"reset",value:function(){p(d(t.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:hj(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=hj(e,this.startVector);return Math.abs(n)<t}}])}(sj);function pj(e,t){return Math.log(e/t)/Math.LN2}var dj=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"distance",void 0),f(e,"startDistance",void 0),e}return v(t,e),l(t,[{key:"reset",value:function(){p(d(t.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(pj(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:pj(this.distance,n),pinchAround:t}}}])}(sj),vj=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function gj(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var mj,yj,_j=function(){return l((function e(t,n){var r=this;s(this,e),f(this,"map",void 0),f(this,"el",void 0),f(this,"handlers",void 0),f(this,"eventsInProgress",void 0),f(this,"frameId",void 0),f(this,"inertia",void 0),f(this,"bearingSnap",void 0),f(this,"handlersById",void 0),f(this,"updatingCamera",void 0),f(this,"changes",void 0),f(this,"previousActiveHandlers",void 0),f(this,"bearingChanged",void 0),f(this,"rotateEnabled",void 0),f(this,"pitchEnabled",void 0),f(this,"listeners",void 0),f(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),f(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,c=u?mB.touchPos(r.el,u):mB.mousePos(r.el,e),l=h(r.handlers);try{for(l.s();!(n=l.n()).done;){var f=n.value,p=f.handlerName,d=f.handler,v=f.allowed;if(d.isEnabled()){var g=void 0;if(r.blockedByActive(s,v,p))d.reset();else{var m=t||e.type;d&&d[m]&&(g=d[m](e,c,u),r.mergeIHandlerResult(o,a,g,p,i),g&&g.needsRenderFrame&&r.triggerRenderFrame())}(g||d.isActive())&&(s[p]=d)}}}catch(e){l.e(e)}finally{l.f()}var y={};for(var _ in r.previousActiveHandlers)s[_]||(y[_]=i);r.previousActiveHandlers=s,(Object.keys(y).length||gj(o))&&(r.changes.push([o,a,y]),r.triggerRenderFrame()),(Object.keys(s).length||gj(o))&&r.map.stop(!0),r.updatingCamera=!1;var b=o.cameraAnimation;b&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],b(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new zB(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],Sd)Ad.document.addEventListener("touchstart",(function(e){r.handleEvent(e)}),{}),Ad.document.addEventListener("touchmove",(function(e){r.handleEvent(e)}),{}),Ad.document.addEventListener("touchend",(function(e){r.handleEvent(e)}),{}),Ad.document.addEventListener("touchcancel",(function(e){r.handleEvent(e)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=h(this.listeners);try{for(a.s();!(o=a.n()).done;){var u=E(o.value,3),c=u[0],l=u[1],p=u[2];mB.addEventListener(c,l,c===window.document?this.handleWindowEvent:this.handleEvent,p)}}catch(e){a.e(e)}finally{a.f()}}}),[{key:"destroy",value:function(){var e,t=h(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=E(e.value,3),r=n[0],i=n[1],o=n[2];mB.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=h(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=h(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(vj(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){zk(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new RB("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new HB(t,e));var r=t.boxZoom=new PB(t,e);this.add("boxZoom",r);var i=new oj,o=new IB;t.doubleClickZoom=new QB(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new ij;this.add("tapDragZoom",a);var s=t.touchPitch=new lj;this.add("touchPitch",s);var u=new ZB(e),c=new qB(e);t.dragRotate=new JB(e,u,c),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",c,["mouseRotate"]);var l=new XB(e),h=new aj(e);t.dragPan=new $B(n,l,h),this.add("mousePan",l),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new fj,p=new dj;t.touchZoomRotate=new ej(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new KB(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new VB;this.add("keyboard",v),this.add("blockableMapEvent",new MB(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=h(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;(Sd||this.el.contains(o))&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=h(this.changes);try{for(i.s();!(e=i.n()).done;){var o=E(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new oB(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),zk(n,s),zk(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!gj(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,c=e.pinchAround,l=e.around;void 0!==c&&(l=c),r.stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=vj(this.eventsInProgress),i=vj(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var c in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[c]){var l=e[c].originalEvent;this.fireEvent(c,l)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,g=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=t[v]||g,f["".concat(p,"end")]=h)}for(var m in f)f[m]&&this.fireEvent(m,f[m]);var y=vj(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new vB("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new vB(e,t?{originalEvent:t}:{}))}}])}(),bj=null,xj=[],Sj=(Ad.performance,function(e){var t=e;if(null!=bj){var n=t-bj;xj.push(n)}bj=t}),Ej=function(){return l((function e(){s(this,e),f(this,"queue",void 0),f(this,"id",void 0),f(this,"cleared",void 0),f(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}),[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=h(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=h(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}])}(),Aj={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},Tj=function(e){function t(e){var n;return s(this,t),f(n=a(this,t,[zk({},Aj,e)]),"doubleClickZoom",void 0),f(n,"dragRotate",void 0),f(n,"dragPan",void 0),f(n,"touchZoomRotate",void 0),f(n,"scrollZoom",void 0),f(n,"keyboard",void 0),f(n,"touchPitch",void 0),f(n,"boxZoom",void 0),f(n,"handlers",void 0),f(n,"container",void 0),f(n,"canvas",void 0),f(n,"canvasContainer",void 0),f(n,"renderTaskQueue",new Ej),f(n,"frame",void 0),f(n,"trackResize",!0),f(n,"onWindowOnline",(function(){n.update()})),f(n,"onWindowResize",(function(e){n.trackResize&&n.resize({originalEvent:e}).update()})),n.initContainer(),n.resize(),n.handlers=new _j(n,n.options),"undefined"!=typeof window&&(window.addEventListener("online",n.onWindowOnline,!1),window.addEventListener("resize",n.onWindowResize,!1),window.addEventListener("orientationchange",n.onWindowResize,!1)),n}return v(t,e),l(t,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(rB.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(oB.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(iB.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=nB((function(t){Sj(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=nB((function(n){Sj(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=Am("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=Nm||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}])}(gB),wj=function(){return l((function e(t){var n=this;s(this,e),f(this,"map",void 0),f(this,"updateHash",void 0),f(this,"hashName",void 0),f(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),f(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),f(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=yS(this.updateHashUnthrottled,300)}),[{key:"addTo",value:function(e){return this.map=e,Ad.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return Ad.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),c="";if(c+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(c+="/".concat(Math.round(10*s)/10)),u&&(c+="/".concat(Math.round(u))),this.hashName){var l=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===l?(h=!0,"".concat(t,"=").concat(c)):e})).filter((function(e){return e}));return h||f.push("".concat(l,"=").concat(c)),"#".concat(f.join("&"))}return"#".concat(c)}}])}(),Cj={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},kj=function(e){function t(e){var n;if(s(this,t),f(n=a(this,t,[zk({},Cj,e)]),"doubleClickZoom",void 0),f(n,"dragRotate",void 0),f(n,"dragPan",void 0),f(n,"touchZoomRotate",void 0),f(n,"scrollZoom",void 0),f(n,"keyboard",void 0),f(n,"touchPitch",void 0),f(n,"boxZoom",void 0),f(n,"handlers",void 0),f(n,"container",void 0),f(n,"canvas",void 0),f(n,"canvasContainer",void 0),f(n,"renderTaskQueue",new Ej),f(n,"frame",void 0),f(n,"trackResize",!0),f(n,"hash",void 0),f(n,"onWindowOnline",(function(){n.update()})),f(n,"onWindowResize",(function(e){n.trackResize&&n.resize({originalEvent:e}).update()})),Sd?n.initMiniContainer():n.initContainer(),n.resize(),n.handlers=new _j(n,n.options),"undefined"!=typeof window&&(window.addEventListener("online",n.onWindowOnline,!1),window.addEventListener("resize",n.onWindowResize,!1),window.addEventListener("orientationchange",n.onWindowResize,!1)),!Sd){var r="string"==typeof e.hash&&e.hash||void 0;e.hash&&(n.hash=new wj(r).addTo(n))}return n.hash&&n.hash.onHashChange()||(n.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(n.resize(),n.fitBounds(e.bounds,zk({},e.fitBoundsOptions,{duration:0})))),n}return v(t,e),l(t,[{key:"resize",value:function(e){var t=E(this.containerDimensions(),2),n=t[0],r=t[1];if(this.transform.resize(n,r),Sd)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Ad.Event("movestart",e)),this.emit("move",new Ad.Event("move",e))),this.emit("resize",new Ad.Event("resize",e)),i&&this.emit("moveend",new Ad.Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(rB.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(oB.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(iB.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=nB((function(t){Sj(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=nB((function(n){Sj(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=Am("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(Sd?(e=this.container.width/Ad.devicePixelRatio,t=this.container.height/Ad.devicePixelRatio):(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t)),[e,t]}}])}(gB),Mj=function(){return l((function e(){s(this,e),f(this,"xzReg",.6*-Math.PI),f(this,"yReg",.2*Math.PI),f(this,"earthCameraRadius",200),f(this,"earthCameraZoom",1),f(this,"cameraPosition",z_()),f(this,"viewport",void 0),f(this,"projectionMatrix",n_()),f(this,"modelMatrix",n_()),f(this,"viewMatrix",n_()),f(this,"viewProjectionMatrix",n_()),f(this,"ViewProjectionMatrixUncentered",n_()),f(this,"viewUncenteredMatrix",n_())}),[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;m_(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=j_(o,s,a),q_(this.cameraPosition,this.cameraPosition),V_(this.cameraPosition,this.cameraPosition,j_(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),H_(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=z_();Q_(u,this.cameraPosition,j_(0,1,0));var c=j_(0,1,0);Q_(c,u,this.cameraPosition);var l=j_(0,0,0);b_(this.viewMatrix,this.cameraPosition,l,c),this.viewUncenteredMatrix=r_(this.viewMatrix),s_(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),s_(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}])}(),Pj=["id","style","rotation"],Ij={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Rj=Ce()(mj=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"version",TN.GLOBEL),f(e,"dragging",!1),f(e,"viewport",void 0),f(e,"cameraChangedCallback",void 0),f(e,"handleCameraChanging",void 0),f(e,"handleCameraTimer",void 0),f(e,"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(.02):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(.02):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var n=e.config.offsetCoordinate,r=void 0===n||n;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&r?e.coordinateSystemService.setCoordinateSystem(jy.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(jy.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return v(t,e),l(t,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==uN.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(Ij[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(Ij[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=b(t,Pj),this.viewport=new Mj,this.$mapContainer=this.creatMapContainer(r),this.map=new Tj(_({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]);var n}(MN))||mj,Oj=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getServiceConstructor",value:function(){return Rj}}])}(hN),Lj=function(){return l((function e(){s(this,e),f(this,"viewport",void 0)}),[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new Tb(_(_({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}])}(),Nj=["id","style","rotation","mapInstance","version","mapSize","interactive"],Dj=["id","style","rotation","mapInstance","canvas","hasBaseMap"],Fj=Ce()(yj=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"version",TN.DEFUALT),f(e,"viewport",void 0),f(e,"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(jy.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(jy.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return v(t,e),l(t,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=pB.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=pB.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=n_();return u_(s,s,j_(o.x-i.x,o.y-i.y,o.z||0-i.z)),c_(s,s,j_(a*r[0],-a*r[1],a*r[2])),l_(s,s,n[0]),h_(s,s,n[1]),f_(s,s,n[2]),s}},{key:"init",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,v,g=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,c=t.version,l=void 0===c?"DEFAULTMAP":c,h=t.mapSize,f=void 0===h?1e4:h,p=t.interactive,d=void 0===p||p,v=b(t,Nj),this.viewport=new Lj,this.version=l,this.simpleMapCoord.setSize(f),l===TN.SIMPLE&&v.center&&(v.center=this.simpleMapCoord.unproject(v.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new kj(_({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},v))),this.map.on("load",(function(){g.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){g.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initMiniMap",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.config).id,n=t.style,r=void 0===n?"light":n,i=t.rotation,o=void 0===i?0:i,t.mapInstance,a=t.canvas,s=void 0===a?null:a,u=t.hasBaseMap,c=void 0!==u&&u,l=b(t,Dj),this.viewport=new Lj,this.$mapContainer=s,this.map=new kj(_({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},l)),c?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),Ad.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,o=t.bearing,a=t.pitch;f.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}}]);var n,r}(MN))||yj,zj=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getServiceConstructor",value:function(){return Fj}}])}(hN);function Bj(e,t){e.length>0&&t.version===TN.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=function(e,t){if("number"==typeof e[0])return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),r}(e.coordinates,t),e.simpleCoordinate=!0)}))}function jj(e,t,n,r,i){var o=(null==i?void 0:i.getLayerConfig()).arrow,a=void 0===o?{enable:!1}:o,s=t.map((function(t){var r,i,o,s={id:t._id,coordinates:t.coordinates};if(e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var r=function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}(e,t);e.needRemapping=!1,"color"===e.name&&(r=r.map((function(e){return gv(e)}))),s[e.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===e.name&&(s.shape=n.getIconFontKey(s[e.name]))})),"line"===s.shape&&a.enable){var u=s.coordinates,c=(r=u[0],i=u[1],o=tx([i[0]-r[0],i[1]-r[1]]),[r[0]+1e-4*o[0],r[1]+1e-4*o[1]]);s.coordinates.splice(1,0,c,c)}return s}));return function(e,t,n){if(e.length>0&&t.version===TN["GAODE2.x"]){var r=n.coordCenter;e[0].coordinates[0],e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=TN["GAODE2.x"],e.originCoordinates=aP(e.coordinates),e.coordinates=t.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}(s,r,i),Bj(s,r),s}function Uj(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function Vj(e,t,n,r){var i=e.multiPassRenderer;return e.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),Uj(t).forEach((function(e){var t=E(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var Gj,Hj,Wj,Yj,Xj,Zj,qj=function(){return l((function e(t){s(this,e),f(this,"layer",void 0),this.layer=t}),[{key:"pickRender",value:function(e){var t=this.layer.getContainer().get(Oe.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(e,t){var n=this.layer.getContainer().get(Oe.IPickingService);return"RasterLayer"===e.type?this.pickRasterLayer(e,t):(this.pickRender(t),n.pickFromPickingFBO(e,t))}},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.get(Oe.IPickingService),o=r.get(Oe.IMapService),a=this.layer.getSource().extent,s=Vb(t.lngLat,a),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},c=n||e;if(s){var l=this.readRasterValue(e,a,o,t.x,t.y);return u.rasterValue=l,i.triggerHoverOnLayer(c,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(c,_(_({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(c,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=E(t,4),s=a[0],u=void 0===s?0:s,c=a[1],l=void 0===c?0:c,h=a[2],f=void 0===h?10:h,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,l]),g=n.lngLatToContainer([f,d]),m=g.x-v.x,y=v.y-g.y,_=[(r-v.x)/m,(i-g.y)/y],b=o.width||1,x=o.height||1,S=Math.floor(_[0]*b),A=Math.floor(_[1]*x),T=Math.max(0,A-1)*b+S;return o.data[T]}},{key:"selectFeature",value:function(e){var t=this.layer,n=E(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=E(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}])}(),Kj=function(){return l((function e(t){s(this,e),f(this,"layer",void 0),f(this,"rendererService",void 0),f(this,"colorTexture",void 0),f(this,"key",void 0),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.get(Oe.IRendererService)}),[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return xv(e);case"quantize":return Sv(e);case"custom":return Ev(e,t);case"linear":return bv(e,t);default:return _v(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}])}(),Qj=["passes"],$j=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],Jj=0,eU=(Gj=WL(Oe.IGlobalConfigService),Wj=n((Hj=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,t),f(e=a(this,t),"id","".concat(Jj++)),f(e,"name","".concat(Jj)),f(e,"parent",void 0),f(e,"coordCenter",void 0),f(e,"type",void 0),f(e,"visible",!0),f(e,"zIndex",0),f(e,"minZoom",void 0),f(e,"maxZoom",void 0),f(e,"inited",!1),f(e,"layerModelNeedUpdate",!1),f(e,"pickedFeatureID",null),f(e,"selectedFeatureID",null),f(e,"styleNeedUpdate",!1),f(e,"rendering",void 0),f(e,"forceRender",!1),f(e,"clusterZoom",0),f(e,"layerType",void 0),f(e,"triangulation",void 0),f(e,"layerPickService",void 0),f(e,"textureService",void 0),f(e,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),f(e,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),f(e,"hooks",{init:new OI,afterInit:new II,beforeRender:new II,beforeRenderData:new LI,afterRender:new wI,beforePickingEncode:new wI,afterPickingEncode:new wI,beforeHighlight:new wI(["pickedColor"]),afterHighlight:new wI,beforeSelect:new wI(["pickedColor"]),afterSelect:new wI,beforeDestroy:new wI,afterDestroy:new wI}),f(e,"models",[]),f(e,"multiPassRenderer",void 0),f(e,"plugins",void 0),f(e,"startInit",!1),f(e,"sourceOption",void 0),f(e,"layerModel",void 0),f(e,"shapeOption",void 0),f(e,"sceneContainer",void 0),f(e,"tileLayer",void 0),f(e,"layerChildren",[]),f(e,"masks",[]),g(e,"configService",Wj,e),f(e,"shaderModuleService",void 0),f(e,"cameraService",void 0),f(e,"coordinateService",void 0),f(e,"iconService",void 0),f(e,"fontService",void 0),f(e,"pickingService",void 0),f(e,"rendererService",void 0),f(e,"layerService",void 0),f(e,"debugService",void 0),f(e,"interactionService",void 0),f(e,"mapService",void 0),f(e,"styleAttributeService",void 0),f(e,"layerSource",void 0),f(e,"postProcessingPassFactory",void 0),f(e,"normalPassFactory",void 0),f(e,"animateOptions",{enable:!1}),f(e,"container",void 0),f(e,"encodedData",void 0),f(e,"currentPickId",null),f(e,"rawConfig",void 0),f(e,"needUpdateConfig",void 0),f(e,"encodeStyleAttribute",{}),f(e,"enableShaderEncodeStyles",[]),f(e,"enableDataEncodeStyles",[]),f(e,"enablg",[]),f(e,"pendingStyleAttributes",[]),f(e,"scaleOptions",{}),f(e,"animateStartTime",void 0),f(e,"animateStatus",!1),f(e,"isDestroyed",!1),f(e,"encodeDataLength",0),f(e,"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&e.reRender()})),e.name=n.name||e.id,e.zIndex=n.zIndex||0,e.rawConfig=n,e}return v(t,e),l(t,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.get(Oe.SceneID);this.configService.setLayerConfig(n,this.id,_(_(_({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=_(_({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(d=o(x().mark((function e(){var t,n,r,i,o,a,s=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.get(Oe.SceneID),this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Oe.IIconService),this.fontService=this.container.get(Oe.IFontService),this.rendererService=this.container.get(Oe.IRendererService),this.layerService=this.container.get(Oe.ILayerService),this.debugService=this.container.get(Oe.IDebugService),this.interactionService=this.container.get(Oe.IInteractionService),this.pickingService=this.container.get(Oe.IPickingService),this.mapService=this.container.get(Oe.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.cameraService=this.container.get(Oe.ICameraService),this.coordinateService=this.container.get(Oe.ICoordinateSystemService),this.shaderModuleService=this.container.get(Oe.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Oe.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Oe.IFactoryNormalPass),this.styleAttributeService=this.container.get(Oe.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(Oe.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:_({field:n},s.splitValuesAndCallbackInAttribute(r,s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Oe.ILayerPlugin),o=h(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new qj(this),this.textureService=new Kj(this),this.log(tN.LayerInitStart),e.next=31,this.hooks.init.promise();case 31:this.log(tN.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"createModelData",value:function(e,t){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(t);var r=this.calculateEncodeData(e,t),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"calculateEncodeData",value:function(e,t){return this.inited?function(e,t,n,r,i,o){var a=new DF(i,o),s=jj(r.getLayerStyleAttributes()||[],a.data.dataArray,t,n,e);return a.destroy(),s}(this,this.fontService,this.mapService,this.styleAttributeService,e,t):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return Xv(e)?(t.enable=!0,t=_(_({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.log(tN.SourceInitStart,Vk.UPDATE),this.layerSource.setData(e,t),this.log(tN.SourceInitEnd,Vk.UPDATE)):this.on("inited",(function(){n.log(tN.SourceInitStart,Vk.UPDATE),n.getSource()?n.layerSource.setData(e,t):n.source(new DF(e,t)),n.layerSource.once("update",(function(){n.log(tN.SourceInitEnd,Vk.UPDATE)}))})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=b(e,Qj);n&&Uj(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])}));var i=r;Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||iz(t[0])||iz(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i);var o=["segmentNumber","coverage","angle"];return Object.keys(r).some((function(e){return o.includes(e)}))&&this.hooks.init.promise(),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[t.enableShaderEncodeStyles].concat(T(t.enableDataEncodeStyles)).includes(n)&&pk(e[n])&&(e[n].field||e[n].value)&&!Uz(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=_({},this.scaleOptions);if(Xv(e)?this.scaleOptions=_(_({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!Uz(n,this.scaleOptions)){var r=Xv(e)?e:f({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(p=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!Xv(e)||e,Xv(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(Xv(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Xv(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Xv(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:Xv(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Xv(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(yv(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!Xv(e)||e,Xv(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(Xv(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Xv(t)?t.color:this.getLayerConfig().selectColor,selectMix:Xv(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:Xv(t)?t.color:this.getLayerConfig().selectColor,selectMix:Xv(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(yv(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=Vj(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var o=this.getLayerConfig(),a=o.maskfence;a&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return f({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return f({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!Mz(e)})).map((function(n){return f({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(c=o(x().mark((function e(t){var n,r,i,o,a,s,u,c,l,h,f,p,d=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.inject,a=t.triangulation,s=t.segmentNumber,u=b(t,$j),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),c=this.shaderModuleService.getModule(n),l=c.vs,h=c.fs,f=c.uniforms,p=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=d.styleAttributeService.createAttributesAndIndices(d.encodedData,a,s),n=t.attributes,r=t.elements,i=t.count,o=_({attributes:n,uniforms:f,fs:h,vs:l,elements:r,blend:Vz[Bk.normal]},u);i&&(o.count=i),e(p(o))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(u=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"rebuildModels",value:(i=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"renderMulPass",value:(r=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!Uz(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,f({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:_({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],e.next=4,this.layerModel.initModels();case 4:this.models=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:Zv(e)?void 0:e||t,callback:Zv(e)?e:void 0}}}]);var n,r,i,u,c,p,d}(N)).prototype,"configService",[Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hj);function tU(e){return e.maskOperation===Uk.OR?{enable:!0,mask:255,func:{cmp:IP.ALWAYS,ref:1,mask:255},opFront:{fail:IP.KEEP,zfail:IP.REPLACE,zpass:IP.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===jk.SINGLE||0===e.stencilIndex?IP.ALWAYS:IP.LESS,ref:e.stencilType===jk.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:IP.KEEP,zfail:IP.REPLACE,zpass:IP.REPLACE}}}var nU=(Yj=WL(Oe.IGlobalConfigService),Zj=n((Xj=function(){return l((function e(t){s(this,e),f(this,"triangulation",void 0),f(this,"createTexture2D",void 0),f(this,"preStyleAttribute",{}),f(this,"encodeStyleAttribute",{}),f(this,"layer",void 0),f(this,"dataTexture",void 0),f(this,"DATA_TEXTURE_WIDTH",void 0),f(this,"rowCount",void 0),f(this,"cacheStyleProperties",void 0),f(this,"cellLength",void 0),f(this,"cellProperties",void 0),f(this,"cellTypeLayout",void 0),f(this,"stylePropertiesExist",void 0),f(this,"dataTextureTest",void 0),g(this,"configService",Zj,this),f(this,"shaderModuleService",void 0),f(this,"rendererService",void 0),f(this,"iconService",void 0),f(this,"fontService",void 0),f(this,"styleAttributeService",void 0),f(this,"mapService",void 0),f(this,"coordinateSystemService",void 0),f(this,"cameraService",void 0),f(this,"layerService",void 0),f(this,"pickingService",void 0),this.layer=t,this.rendererService=t.getContainer().get(Oe.IRendererService),this.pickingService=t.getContainer().get(Oe.IPickingService),this.shaderModuleService=t.getContainer().get(Oe.IShaderModuleService),this.styleAttributeService=t.getContainer().get(Oe.IStyleAttributeService),this.mapService=t.getContainer().get(Oe.IMapService),this.coordinateSystemService=t.getContainer().get(Oe.ICoordinateSystemService),this.iconService=t.getContainer().get(Oe.IIconService),this.fontService=t.getContainer().get(Oe.IFontService),this.cameraService=t.getContainer().get(Oe.ICameraService),this.layerService=t.getContainer().get(Oe.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}),[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend;return Vz[Bk[void 0===e?"normal":e]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?Uk.AND:s;return"MaskLayer"===this.layer.type?tU({isStencil:!0,stencilType:jk.SINGLE}):e.isStencil?tU(_(_({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:IP.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"initModels",value:(e=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]&&(t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n      attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n    #else\n      uniform ").concat(n[r]," u_").concat(r,";\n    #endif\n\n    ")}));var r="";return this.layer.enableShaderEncodeStyles.forEach((function(e){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n  ").concat(n[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n#else\n  ").concat(n[e]," ").concat(e," = u_").concat(e,";\n#endif\n\n")})),{"vs:#decl":t,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var e=this,t={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableShaderEncodeStyles.forEach((function(r){if(!e.layer.encodeStyleAttribute[r]){var i=e.layer.getLayerConfig()[r],o=void 0===i?n[r]:i;"stroke"===r&&(o=gv(o)),t["u_"+r]=o}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=function(e){switch(e){case"stroke":return{name:"stroke",type:sN.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:sN.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"offsets":return{name:"offsets",type:sN.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){return e.offsets}}};default:return}}(t);n&&e.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}}]);var e,t,n}()).prototype,"configService",[Yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xj),rU=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),iU=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),oU=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),aU=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),sU=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({}),uU={canvas:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"updateMode",sU.ALWAYS),f(e,"canvas",void 0),f(e,"ctx",void 0),f(e,"prevSize",void 0),f(e,"renderUpdate",(function(){var t=e.layer.getLayerConfig(),n=t.zIndex,r=void 0===n?10:n,i=t.update,o=void 0===i?sU.ALWAYS:i,a=t.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+e.canvas.style.zIndex===r&&(e.canvas.style.zIndex=r+""),e.updateMode!==o&&(e.updateMode=o,e.unBindListener(),e.bindListener()),e.updateMode===sU.ALWAYS&&s.enable&&e.renderCanvas()})),f(e,"unBindListener",(function(){e.mapService.off("mapchange",e.renderCanvas),e.mapService.off("zoomstart",e.clearCanvas),e.mapService.off("zoomend",e.renderCanvas),e.mapService.off("movestart",e.clearCanvas),e.mapService.off("moveend",e.renderCanvas)})),f(e,"bindListener",(function(){e.updateMode===sU.ALWAYS?e.mapService.on("mapchange",e.renderCanvas):(e.mapService.on("zoomstart",e.clearCanvas),e.mapService.on("zoomend",e.renderCanvas),e.mapService.on("movestart",e.clearCanvas),e.mapService.on("moveend",e.renderCanvas))})),f(e,"clearCanvas",(function(){if(e.ctx){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.ctx.clearRect(0,0,n,r)}})),f(e,"renderCanvas",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;if(e.prevSize[0]!==n||e.prevSize[1]!==r){e.prevSize=[n,r];var i=E(e.mapService.getSize(),2),o=i[0],a=i[1];e.canvas.width=n,e.canvas.height=r,e.canvas.style.width=o+"px",e.canvas.style.height=a+"px"}var s=e.layer.getLayerConfig().drawingOnCanvas;e.ctx&&s({canvas:e.canvas,ctx:e.ctx,mapService:e.mapService,size:[n,r]})})),e}return v(t,e),l(t,[{key:"clearModels",value:function(){var e;this.canvas&&(null===(e=this.mapService.getContainer())||void 0===e||e.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.update,r=void 0===n?sU.ALWAYS:n,this.updateMode=r,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig().zIndex,n=E(this.mapService.getSize(),2),r=n[0],i=n[1],o=this.rendererService.getViewportSize(),a=o.width,s=o.height;this.prevSize=[a,s];var u=document.createElement("canvas");this.canvas=u,u.width=a,u.height=s,u.style.pointerEvents="none",u.style.width=r+"px",u.style.height=i+"px",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.zIndex=t+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(u);var c=u.getContext("2d");this.ctx=c}},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){}}]);var n,r}(nU)},cU=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","CanvasLayer"),f(e,"forceRender",!0),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new uU[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var e,t=this;return null!=this&&null!==(e=this.layerModel)&&void 0!==e&&e.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]);var n}(eU),lU=function(e,t,n,r,i,o,a,s){for(var u,c,l=i,h=0,f=!!a&&Xi(a,s);h<r;)h in n&&(u=f?f(n[h],h,t):n[h],o>0&&ur(u)?(c=jn(u),l=lU(e,t,u,c,l,o-1)-1):(lr(l+1),e[l]=u),l++),h++;return l},hU=lU;sr({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Ot(this),n=jn(t),r=kr(t,0);return r.length=hU(r,t,t,n,0,void 0===e?1:Ln(e)),r}}),Qr("flat");function fU(e){return e/180*Math.acos(-1)}function pU(e){var t=fU(e[0])+Math.PI/2,n=fU(e[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function dU(e,t){var n=n_(),r=n_(),i=j_(0,1,0),o=j_(0,0,0);e=void 0!==e?e:1;for(var a=2+(void 0!==(t=t||{}).segments?t.segments:32),s=2*a,u=[],c=[],l=[],h=[],f=[],p=[],d=0;d<=a;d++){for(var v=d/a,g=v*Math.PI,m=0;m<=s;m++){var y=m/s,_=y*Math.PI*2;o_(r),f_(r,r,-g),o_(n),h_(n,n,_),$_(o,i,r),$_(o,o,n),H_(o,o,-e),l.push(o.slice()),h.push.apply(h,T(o.slice())),q_(o,o),f.push.apply(f,T(o.slice())),p.push([y,1-v]),h.push(y,1-v)}if(d>0)for(var b=l.length,x=b-2*(s+1);x+s+2<b;x++)u.push([x,x+1,x+s+1]),c.push(x,x+1,x+s+1),u.push([x+s+1,x+1,x+s+2]),c.push(x+s+1,x+1,x+s+2)}return{cells:u,positions:l,uvs:p,positionsArr:h,indicesArr:c,normalArr:f}}var vU=w_(),gU=(w_(),w_()),mU=w_(),yU=w_();function _U(e,t,n,r,i){return P_(e,n,r),O_(e,e),[i/L_(t=C_(-e[1],e[0]),C_(-n[1],n[0])),t]}function bU(e,t){return M_(e,-t[1],t[0])}function xU(e,t,n){return F_(e,t,n),O_(e,e),e}function SU(e,t){return e[0]===t[0]&&e[1]===t[1]}var EU=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),f(this,"complex",void 0),f(this,"join",void 0),f(this,"cap",void 0),f(this,"miterLimit",void 0),f(this,"thickness",void 0),f(this,"normal",void 0),f(this,"lastFlip",-1),f(this,"miter",C_(0,0)),f(this,"started",!1),f(this,"dash",!1),f(this,"totalDistance",0),f(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}),[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(T(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(T(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c=Zb([r[0],r[1]]),l=Zb([n[0],n[1]]);xU(gU,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=w_(),bU(this.normal,gU)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=Zb([i[0],i[1]]);SU(c,f)&&P_(f,c,O_(f,I_(f,c,l))),xU(mU,f,c);var p=E(_U(yU,w_(),gU,mU,this.thickness),2),d=p[0],v=p[1];L_(yU,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,k_(this.normal,v),o+=2,this.lastFlip=-1}else bU(this.normal,gU),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,c=e.indices,l=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=Zb([a[0],a[1]]),v=Zb([o[0],o[1]]);xU(gU,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=w_(),bU(this.normal,gU)),!this.started)if(this.started=!0,f){var m=w_(),y=w_();P_(m,this.normal,gU),P_(y,this.normal,gU),h.push(y[0],y[1],0),h.push(m[0],m[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-g);if(c.push(t+0,t+1,t+2),i){SU(r,i)&&P_(i,r,O_(i,I_(i,r,n))),xU(mU,i,r);var _=E(_U(yU,w_(),gU,mU,this.thickness),2),b=_[0],x=_[1],S=L_(yU,this.normal)<0?-1:1,A=p;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,T(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),c.push(t+2,t+3,t+4),bU(vU,mU),k_(this.normal,vU),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,x,b,this.totalDistance),c.push.apply(c,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,k_(this.normal,x),u+=2),this.lastFlip=S}else{if(bU(this.normal,gU),f){var w=w_(),C=w_();F_(C,gU,this.normal),P_(w,gU,this.normal),h.push(C[0],C[1],0),h.push(w[0],w[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c="square"===this.cap,l="bevel"===this.join,h=Zb([r[0],r[1]]),f=Zb([n[0],n[1]]);xU(gU,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=w_(),bU(this.normal,gU)),!this.started)if(this.started=!0,c){var d=w_(),v=w_();P_(d,this.normal,gU),P_(v,this.normal,gU),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=Zb([i[0],i[1]]);SU(h,g)&&P_(g,h,O_(g,I_(g,h,f))),xU(mU,g,h);var m=E(_U(yU,w_(),gU,mU,this.thickness),2),y=m[0],_=m[1],b=L_(yU,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,T(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),bU(vU,mU),k_(this.normal,vU),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,k_(this.normal,_),o+=2),this.lastFlip=b}else{if(bU(this.normal,gU),c){var S=w_(),A=w_();F_(A,gU,this.normal),P_(S,gU,this.normal),u.push(A[0],A[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,T(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}])}();function AU(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=sE.flatten(e),a=o.vertices,s=o.dimensions,u=[],c=[],l=[],h=0;h<a.length/s;h++)u.push(a[h*s],a[h*s+1],1,-1,-1),l.push(0,0,1);var f=sE(o.vertices,o.holes,o.dimensions);c.push.apply(c,T(f));for(var p=function(){var e=o.vertices.slice(d*s,(d+1)*s),n=o.vertices.slice((d+1)*s,(d+2)*s);0===n.length&&(n=o.vertices.slice(0,s));var r=u.length/5;u.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=TU([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);l.push.apply(l,T(i).concat(T(i),T(i),T(i))),c.push.apply(c,T([1,2,0,3,2,1].map((function(e){return e+r}))))},d=0;d<i;d++)p();return{positions:u,index:c,normals:l}}function TU(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=z_(),o=z_(),a=z_();r&&(e=Hb(e),t=Hb(t),n=Hb(n));var s=j_.apply(ub,T(e)),u=j_.apply(ub,T(t)),c=j_.apply(ub,T(n));eb(i,c,u),eb(o,s,u),Q_(a,i,o);var l=z_();return q_(l,a),l}var wU=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),CU=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function kU(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function MU(){return kU(30)}function PU(){return kU(4)}function IU(){return kU(3)}function RU(){return kU(6,1)}function OU(){return kU(5)}var LU=f(f(f(f(f(f(f(f(f(f({},CU.CIRCLE,MU),CU.HEXAGON,RU),CU.TRIANGLE,IU),CU.SQUARE,PU),CU.PENTAGON,OU),wU.CYLINDER,MU),wU.HEXAGONCOLUMN,RU),wU.TRIANGLECOLUMN,IU),wU.SQUARECOLUMN,PU),wU.PENTAGONCOLUMN,OU),NU={};function DU(e){var t=ox(e.coordinates);return{vertices:[].concat(T(t),T(t),T(t),T(t)),indices:[0,1,2,2,3,0],size:t.length}}function FU(e){var t=pU(ox(e.coordinates));return{vertices:[].concat(T(t),T(t),T(t),T(t)),indices:[0,1,2,2,3,0],size:t.length}}function zU(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(NU&&NU[e])return NU[e];var n=LU[e]?LU[e]():LU.cylinder(),r=AU([n],t);return NU[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function BU(e){var t=ox(e.coordinates);return{vertices:T(t),indices:[0],size:t.length}}function jU(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new EU({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=t;l[0]&&!Array.isArray(l[0][0])&&(l=[t]),l.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function UU(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(T(t),[1,2,-3],T(t),[1,1,-3],T(t),[0,1,0],T(t),[0,0,0],T(t),[1,0,0],T(t),[1,2,-3],T(t),[1,1,-3],T(t),[0,1,0],T(t),[0,0,0],T(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function VU(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=HU(t[0],n);r.push(i);for(var o=1;o<t.length-1;o++){var a=GU(t[o-1],t[o]);n+=a;var s=HU(t[o],n);r.push(s),r.push(s)}var u=GU(t[t.length-2],t[t.length-1]);return n+=u,r.push(HU(t[t.length-1],n)),{results:r,totalDistance:n}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function GU(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function HU(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function WU(e){var t=e.coordinates,n=sE.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:sE(r,o,i),vertices:r,size:i}}function YU(e){var t=e.coordinates,n=sE.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:sE(r,o,i),vertices:XU(r),size:i+4}}function XU(e){for(var t=[],n=ax(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];t.push.apply(t,[a,s,0].concat(T(r),[i]))}return t}function ZU(e){var t=AU(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function qU(e){var t=function(e){var t=LU[e]?LU[e]():LU.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=sE.flatten(n),i=sE(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=sE.flatten(e),o=i.vertices,a=i.dimensions,s=[],u=[],c=0;c<o.length/a;c++)2===a?s.push(o[2*c],o[2*c+1],1):s.push(o[3*c],o[3*c+1],1);var l=sE(i.vertices,i.holes,i.dimensions);u.push.apply(u,T(l));for(var h=function(){var e=i.vertices.slice(f*a,(f+1)*a),t=i.vertices.slice((f+1)*a,(f+2)*a);0===t.length&&(t=i.vertices.slice(0,a));var n=s.length/3;s.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),u.push.apply(u,T([0,2,1,2,3,1].map((function(e){return e+n}))))},f=0;f<r;f++)h();return{positions:s,index:u}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function KU(e){var t=e.coordinates;return{vertices:[].concat(T(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],T(t[1]),[0,1,0],T(t[0]),[0,0,1],T(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function QU(e,t){for(var n=t||30,r=e.coordinates,i=[],o=[],a=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&o.push.apply(o,T([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function $U(e){var t=e.coordinates;2===t.length&&t.push(0);var n=JU(-1,1),r=JU(1,1),i=JU(-1,-1),o=JU(1,-1);return{vertices:[].concat(T(t),T(n),T(t),T(i),T(t),T(o),T(t),T(r)),indices:[0,1,2,3,0,2],size:5}}function JU(e,t){return[(e+1)/2,(t+1)/2]}function eV(){var e=dU(100,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function tV(){var e=dU(140,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}var nV,rV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"cityCenter",void 0),f(e,"cityMinSize",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,c=e.time,l=void 0===c?0:c,h=e.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:gv(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:gv(i),u_brightColor:gv(a),u_windowColor:gv(u),u_time:this.layer.getLayerAnimateTime()||l}}},{key:"calCityGeo",value:function(){var e=E(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //é¡¶é¨é¢è²\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // ä¾§é¢é¢è²\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // å°çªæ·é¢è²åå¢é¢é¢è²åºå«å¼æ¥\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // é¡¶é¨äº®çº¿\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ZU,depth:{enable:!0,range:[0,.9]},cull:{enable:!0,face:IP.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU),iV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","CityBuildingLayer"),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new rV(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]);var n}(eU),oV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"radian",0),f(e,"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(T(n),[1,1],T(n),[0,1],T(n),[0,0],T(n),[1,0])}})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:t||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),e.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // è®¡ç®ç»çº¬åº¦ç¹ä½åæ \n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // è®¡ç®ç» z è½´æè½¬åçåç§»\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // ç» z è½´æè½¬\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z è½´ä¸åä¸æè½¬\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:IP.TRIANGLES,depth:{enable:!0}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,o=n.canvasHeight,a=void 0===o?1:o,s=document.createElement("canvas");s.width=i,s.height=a,s.getContext("2d")&&(e(s),this.texture=t({data:s,width:s.width,height:s.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sN.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]);var n,r}(nU),aV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"terrainImage",void 0),f(e,"terrainImageLoaded",!1),f(e,"mapTexture",void 0),f(e,"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,c=n.heightSegments,l=void 0===c?1:c,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,a,u,l].concat(T(f))),v=d.indices,g=d.positions;return p&&e.loadTerrainTexture(g,v),{vertices:g,indices:v,size:5}})),e}return v(t,e),l(t,[{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=e/2,s=t/2,u=Math.floor(n),c=Math.floor(r),l=u+1,h=c+1,f=e/u,p=t/c,d=[],v=[],g=0;g<h;g++)for(var m=g*p-s,y=0;y<l;y++){var _=y*f-a;if(this.mapService.version===TN["GAODE2.x"]){var b=this.mapService.lngLatToCoord([_+i,-m+o]),x=E(b,2),S=x[0],A=x[1];v.push(S,A,0)}else v.push(_+i,-m+o,0);v.push(y/u),v.push(1-g/c)}for(var T=0;T<c;T++)for(var w=0;w<u;w++){var C=w+l*T,k=w+l*(T+1),M=w+1+l*(T+1),P=w+1+l*T;d.push(C,k,P),d.push(k,M,P)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),e.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:IP.TRIANGLES,depth:{enable:!0,range:[0,.9]},cull:{enable:!0,face:IP.BACK}});case 7:return i=e.sent,e.abrupt("return",[i]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,c=a.width,l=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==c?c:i,height:void 0!==l?l:o})}var h=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE}),t.layerService.updateLayerRenderList()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,c=Math.floor(r),l=Math.floor(i),h=c+1,f=l+1,p=a/c,d=s/l,v=0;v<f;v++)for(var g=Math.floor(v*d)*a,m=0;m<h;m++){var y=4*(g+Math.floor(m*p)),_=u[y],b=u[y+1],x=u[y+2];e[5*(v*h+m)+2]=o(_,b,x)}var S=this.layer.getEncodedData(),E=this.styleAttributeService.createAttributesAndIndices(S,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(E),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,c=r.rgb2height,l=void 0===c?function(e,t,n){return e+t+n}:c;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,o,s,l):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,o,s,l)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,h,o,s,l)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU),sV=function(e){return e.UP="up",e.DOWN="down",e}(sV||{}),uV={plane:aV,sprite:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"mapTexture",void 0),f(e,"positions",void 0),f(e,"indices",void 0),f(e,"timer",void 0),f(e,"spriteTop",void 0),f(e,"spriteUpdate",void 0),f(e,"spriteAnimate",void 0),f(e,"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-10:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===sV.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),f(e,"updateModel",(function(){var t=e.layer.createAttributes({triangulation:e.planeGeometryUpdateTriangulation});e.layer.models.map((function(e){e.updateAttributes(t)})),yS((function(){e.layerService.renderLayer(e.layer.id)}),168),e.timer=requestAnimationFrame(e.updateModel)})),f(e,"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,c=(t=e).initSprite.apply(t,[u,a].concat(T(i))),l=c.indices,h=c.positions;return e.positions=h,e.indices=l,{vertices:h,indices:l,size:5}})),e}return v(t,e),l(t,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.coordinateSystemService.getCoordinateSystem(),u=this.spriteAnimate===sV.UP?-this.spriteTop:this.spriteTop,c=0;c<t;c++){var l=Math.random()*u;o.push.apply(o,T(f(l)))}for(var h=0;h<t;h++)i.push(h);function f(t){var i=e*Math.random(),o=e*Math.random(),u=-e/2+i,c=-e/2+o;if(a.version===TN["GAODE2.x"]){var l=E(a.lngLatToCoord([u+n,-c+r]),2);return[l[0],l[1],t,0,0]}if(!a.isMapBoxMapLibre()||s!==jy.LNGLAT&&s!==jy.METER_OFFSET)return[u+n,-c+r,t,0,0];var h=E(Ib([u+n,-c+r],a.map,512),2);return[h[0],h[1],t,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,i=void 0===r?5e6:r,o=t.spriteUpdate,a=void 0===o?1e4:o,s=t.spriteAnimate,u=void 0===s?sV.DOWN:s,this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=a,this.spriteAnimate="up"===u?sV.UP:sV.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){h.updateModel()}),100),e.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,primitive:IP.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return l=e.sent,e.abrupt("return",[l]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]);var n,r}(nU),billboard:oV},cV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","GeometryLayer"),f(e,"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new uV[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]);var n}(eU),lV='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',hV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\r\n// å¤è¾¹å½¢é¡¶ç¹åæ \r\nattribute vec3 a_Position;\r\n// å¤è¾¹å½¢ç»çº¬åº¦åæ \r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // å°ç»çº¬åº¦è½¬æ¢ä¸ºé«å¾·2.0éè¦çå¹³é¢åæ \r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n    // vec2 lnglat = unProjectFlat(a_Pos.xy + offset)\r\n     vec2 lnglat = a_Pos.xy;\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:lV,triangulation:qU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"pos",type:sN.Attribute,descriptor:{name:"a_Pos",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(t,n,r){var i;if("GAODE2.x"===t.version)i=t.originCoordinates;else{var o=e.layer.getLayerConfig(),a=o.coverage,s=void 0===a?1:a,u=o.angle,c=e.layer.getSource().data,l=c.xOffset,h=c.yOffset,f=BE();jE(f,f,u);var p=w_();R_(p,C_(r[0],r[1]),C_(l,h)),R_(p,p,C_(s,s)),D_(p,p,f);var d=Rb([t.coordinates[0]+p[0],t.coordinates[1]+p[1]],e.mapService.map,256<<20);if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.LNGLAT_OFFSET)i=d;else if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){i=Ib(d,e.mapService.map,512);var v=e.mapService.coordinateSystemService.offsetCenterTransform;i=[i[0]-v[0],i[1]-v[1]]}else i=Ib(d,e.mapService.map,512)}return[i[0],i[1],0]}}})}}]);var n,r}(nU),fV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\n// å¤è¾¹å½¢é¡¶ç¹åæ \nattribute vec3 a_Position;\n// å¤è¾¹å½¢ç»çº¬åº¦åæ \nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // ç»çº¬åº¦\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // å°ç»çº¬åº¦è½¬æ¢ä¸ºé«å¾·2.0éè¦çå¹³é¢åæ \n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    //vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // å®éçç»çº¬åº¦\n    vec2 lnglat = a_Pos.xy;\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:lV,triangulation:zU,primitive:IP.TRIANGLES,depth:{enable:!0,range:[0,.9]}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:sN.Attribute,descriptor:{name:"a_Pos",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(t,n,r){var i;if("GAODE2.x"===t.version)i=t.originCoordinates;else{var o=e.layer.getLayerConfig(),a=o.coverage,s=void 0===a?1:a,u=o.angle,c=e.layer.getSource().data,l=c.xOffset,h=c.yOffset,f=BE();jE(f,f,u);var p=w_();R_(p,C_(r[0],r[1]),C_(l,h)),R_(p,p,C_(s,s)),D_(p,p,f);var d=Rb([t.coordinates[0]+p[0],t.coordinates[1]+p[1]],e.mapService.map,256<<20);if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.LNGLAT_OFFSET)i=d;else if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){i=Ib(d,e.mapService.map,512);var v=e.mapService.coordinateSystemService.offsetCenterTransform;i=[i[0]-v[0],i[1]-v[1]]}else i=Ib(d,e.mapService.map,512)}return[i[0],i[1],0]}}})}}]);var n,r}(nU);var pV=Ce()(nV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"colorTexture",void 0),f(e,"heatmapFramerBuffer",void 0),f(e,"intensityModel",void 0),f(e,"colorModel",void 0),f(e,"shapeType",void 0),f(e,"preRampColors",void 0),e}return v(t,e),l(t,[{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig().rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),Uz(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(i=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=s,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),c=u.width,l=u.height,this.heatmapFramerBuffer=r({color:o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE,min:IP.LINEAR,mag:IP.LINEAR}),depth:!1}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"buildModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:sN.Attribute,descriptor:{name:"a_Dir",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=$U,e.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:$U,depth:{enable:!1},cull:{enable:!0,face:kv(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // ç­åå¼ºåº¦å¾\nuniform sampler2D u_colorTexture;   // æ ¹æ®å¼ºåº¦åå¸çè²å¸¦\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:t,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:IP.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:IP.FLOAT}),size:2})},uniforms:_({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:IP.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,i=void 0===r?10:r,o=t.radius,a=void 0===o?5:o;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i},blend:{enable:!0,func:{srcRGB:IP.ONE,srcAlpha:1,dstRGB:IP.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(e){var t,n=this.layer.getLayerConfig().opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=n_();a_(r,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:T(r)},blend:{enable:!0,func:{srcRGB:IP.SRC_ALPHA,srcAlpha:1,dstRGB:IP.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,c=0;c<a;c++)for(var l=c-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-l/u,0),i.push(h/e),i.push(1-c/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,g=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // å°åæ¬ 0 -> 1 ç uv è½¬æ¢ä¸º -1 -> 1 çæ ååæ ç©ºé´ï¼NDCï¼\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y å¹³é¢ä¸çç¹ï¼z == 0ï¼å¯ä»¥è®¤ä¸ºæ¯ä¸ç»´ä¸çç¹è¢«æå½±å°å¹³é¢åçç¹\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // å¹³è¡äºx/yå¹³é¢ãz==1 çå¹³é¢ä¸çç¹\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // æ ¹æ®è§å¾æå½±ç©éµçéç©éµå¹³é¢ä¸çåç®åºä¸ç»´ç©ºé´ä¸­çç¹ï¼p1å¹³é¢ä¸çç¹ï¼\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // å½ä¸åæä½ï¼å½ä¸ååä¸ºä¸çåæ ï¼\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,c=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({buffer:c({data:t.vertices,type:IP.FLOAT}),size:3}),a_Uv:s({buffer:c({data:t.uvs,type:IP.FLOAT}),size:2})},primitive:IP.TRIANGLES,uniforms:_({},o),depth:{enable:!1},blend:{enable:!0,func:{srcRGB:IP.SRC_ALPHA,srcAlpha:1,dstRGB:IP.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:t.indices,type:IP.UNSIGNED_INT,count:t.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=_v(t);this.colorTexture=e({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE,min:IP.NEAREST,mag:IP.NEAREST,flipY:!1}),this.preRampColors=t}}]);var n,r,i}(nU))||nV,dV={heatmap:pV,heatmap3d:pV,grid:hV,grid3d:fV,hexagon:function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\n// å¤è¾¹å½¢é¡¶ç¹åæ \nattribute vec3 a_Position;\n// å¤è¾¹å½¢ç»çº¬åº¦åæ \nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n   // vec2 lnglat = unProjectFlat(a_Pos.xy + offset)\n   vec2 lnglat = a_Pos.xy;  \n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:lV,triangulation:qU,depth:{enable:!1},primitive:IP.TRIANGLES});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"pos",type:sN.Attribute,descriptor:{name:"a_Pos",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(t,n,r){var i;if("GAODE2.x"===t.version)i=t.originCoordinates;else{var o=e.layer.getLayerConfig(),a=o.coverage,s=void 0===a?1:a,u=o.angle,c=e.layer.getSource().data,l=c.xOffset,h=c.yOffset,f=BE();jE(f,f,u);var p=w_();R_(p,C_(r[0],r[1]),C_(l,h)),R_(p,p,C_(s,s)),D_(p,p,f);var d=Rb([t.coordinates[0]+p[0],t.coordinates[1]+p[1]],e.mapService.map,256<<20);if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.LNGLAT_OFFSET)i=d;else if(e.mapService.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){i=Ib(d,e.mapService.map,512);var v=e.mapService.coordinateSystemService.offsetCenterTransform;i=[i[0]-v[0],i[1]-v[1]]}else i=Ib(d,e.mapService.map,512)}return[i[0],i[1],0]}}})}}]);var n,r}(nU)},vV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","HeatMapLayer"),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new dV[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]);var n}(eU),gV={image:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),!Sd){e.next=11;break}r=this.layerService.sceneService.getSceneConfig().canvas,(i=r.createImage()).crossOrigin="anonymous",i.src=t.data.originData,i.onload=function(){s.texture=n({data:i,width:i.width,height:i.height}),s.layerService.reRender()},e.next=15;break;case 11:return e.next=13,t.data.images;case 13:o=e.sent,this.texture=n({data:o[0],width:o[0].width,height:o[0].height,mag:IP.LINEAR,min:IP.LINEAR});case 15:return e.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",triangulation:KU,primitive:IP.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return a=e.sent,e.abrupt("return",[a]);case 19:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU)},mV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","ImageLayer"),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new gV[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]);var n}(eU),yV={solid:0,dash:1},_V=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.forward,f=void 0===h||h,p=e.lineTexture,d=void 0!==p&&p,v=e.iconStep,g=void 0===v?100:v,m=e.segmentNumber,y=void 0===m?30:m,_=e.thetaOffset,b=void 0===_?.314:_;2===l.length&&l.push(0,0);var x=0,S=[0,0,0,0],E=[0,0,0,0];return r&&i&&(S=gv(r),E=gv(i),x=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:b,u_opacity:iz(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:y,u_line_type:yV[u||"solid"],u_dash_array:l,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:S,u_targetColor:E}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // æ­£å\n    return mid;\n  } else { // éå\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  \n  vec2 source = a_Instance.rg;  // èµ·å§ç¹\n  vec2 target =  a_Instance.ba; // ç»ç¹\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// å½åé¡¶ç¹å¨å¼§çº¿ä¸­æå¤çåæ®µä½ç½®\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // æ­£å\n    return mid;\n  } else { // éå\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // èµ·å§ç¹\n  vec2 target =  a_Instance.ba; // ç»ç¹\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // å½åé¡¶ç¹å¨å¼§çº¿ä¸­æå¤çåæ®µä½ç½®\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= u_opacity;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= u_opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // å½å­å¨è´´å¾æ¶å¨åºè²ä¸è´´ä¸è´´å¾\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // æ¨ªå v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // æ­£å\n    return mid;\n  } else { // éå\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // èµ·å§ç¹\n  vec2 target =  a_Instance.ba; // ç»ç¹\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // å½åé¡¶ç¹å¨å¼§çº¿ä¸­æå¤çåæ®µä½ç½®\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // å¼å¯è´´å¾æ¨¡å¼\n\n    float arcDistrance = length(source - target); // èµ·å§ç¹åç»ç¹çè·ç¦»\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // è´´å¾æ²¿å¼§çº¿æ¹åçé¿åº¦ - éå°å¾ç¼©æ¾æ¹å\n    float texCount = floor(arcDistrance/pixelLen); // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // çº¿æ¨ªååç§»çè·ç¦»\n    float linePixelSize = project_pixel(a_Size); // å®ç¹ä½ç½®åç§»\n    v_lineData.a = lineOffsetWidth/linePixelSize; // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:a,fragmentShader:o,triangulation:QU,depth:{enable:!1},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sN.Attribute,descriptor:{name:"a_Instance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]);var n,r}(nU),bV='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  float d_distance_ratio = v_line_data.g; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',xV='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 æ¯ä¸ºäºå¯¹é½åæ \n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // æå¨å¢å ä¸äºåç§»ï¼åè½»é¢çå²çª\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // å¼å¯è´´å¾æ¨¡å¼  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // çº¿æ¨ªååç§»çè·ç¦»\n    float linePixelSize = project_pixel(a_Size);  // å®ç¹ä½ç½®åç§»ï¼æå°å¾ç­çº§ç¼©æ¾åçè·ç¦»\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // å°çæ¨¡å¼\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // çº¿çåç§»\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // è®¡ç®èµ·å§ç¹åç»æ­¢ç¹çè·ç¦»\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // è®¡ç®é£çº¿åä¸ªèç¹ç¸åºçé«åº¦\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // å°çç¹ä½\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',SV='\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',EV='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 æ¯ä¸ºäºå¯¹é½åæ \n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // æå¨å¢å ä¸äºåç§»ï¼åè½»é¢çå²çª\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // å°çæ¨¡å¼\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // çº¿çåç§»\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // è®¡ç®èµ·å§ç¹åç»æ­¢ç¹çè·ç¦»\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // è®¡ç®é£çº¿åä¸ªèç¹ç¸åºçé«åº¦\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // å°çç¹ä½\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',AV={solid:0,dash:1},TV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.segmentNumber,d=void 0===p?30:p,v=e.globalArcHeight,g=void 0===v?10:v;2===u.length&&u.push(0,0);var m=0,y=[0,0,0,0],b=[0,0,0,0];return t&&n&&(y=gv(t),b=gv(n),m=1),this.rendererService.getDirty()&&this.texture.bind(),_({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:g,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:AV[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:l?1:0,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:b},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:SV,vert:EV,type:"Linear"}:{frag:bV,vert:xV,type:""}}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:QU,segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sN.Attribute,descriptor:{name:"a_Instance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]);var n,r}(nU),wV={solid:0,dash:1},CV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.lineTexture,f=void 0!==h&&h,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v,m=e.globalArcHeight,y=void 0===m?10:m;2===l.length&&l.push(0,0);var _=0,b=[0,0,0,0],x=[0,0,0,0];return r&&i&&(b=gv(r),x=gv(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:100,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:wV[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:b,u_targetColor:x}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:SV,vert:EV,type:"Linear"}:{frag:bV,vert:xV,type:""}}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:a,fragmentShader:o,triangulation:QU,depth:{enable:!0},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sN.Attribute,descriptor:{name:"a_Instance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]);var n,r}(nU),kV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.stroke,a=void 0===o?"#000":o,s=e.strokeOpacity,u=void 0===s?1:s;return _({u_gap_width:n,u_stroke_width:i,u_stroke:gv(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\n\nvoid main() {\n\n// #ifdef USE_ATTRIBUTE_OPACITY\n//   float opacity  = a_Opacity;\n// #else\n//   float opacity = u_opacity;\n// #endif\n\n\n// #ifdef USE_ATTRIBUTE_OFFSETS\n//   vec2 offsets  = a_Offsets;\n// #else\n//   vec2 offsets = u_offsets;\n// #endif\n\n  // float opacity = u_opacity;\n// éæåº¦è®¡ç®\n  vec2 source = a_Instance.rg;  // èµ·å§ç¹\n  vec2 target =  a_Instance.ba; // ç»ç¹\n  vec2 flowlineDir = normalize(target - source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n\n  vec2 position = mix(source, target, a_Position.x);\n\n  float lengthCommon = length(target - source);    \n  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\n\n  float gapCommon =  project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n  } else {\n     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'// #extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',inject:this.getInject(),triangulation:UU,primitive:IP.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sN.Attribute,descriptor:{name:"a_Instance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]);var n,r}(nU),MV={solid:0,dash:1},PV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.lineTexture,f=void 0!==h&&h,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],_=[0,0,0,0];return r&&i&&(y=gv(r),_=gv(i),m=1),{u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:MV[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getUninforms(),n=t.segmentNumber,e.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nattribute vec4 a_Position1;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  \n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 è°æ´é»è®¤çææ\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(a_Position1[0], a_Position1[1],0.0, 1.0));\n  vec4 next = project_position(vec4(a_Position1[2], a_Position1[3],0.0, 1.0));\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\nv_line_data.g = a_Position.x; // è¯¥é¡¶ç¹å¨å¼§çº¿ä¸çåæ®µæåº\n  if(LineTexture == u_line_texture) { // å¼å¯è´´å¾æ¨¡å¼  \n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // çº¿æ¨ªååç§»çè·ç¦»\n    float linePixelSize = project_pixel(a_Size);  // å®ç¹ä½ç½®åç§»ï¼æå°å¾ç­çº§ç¼©æ¾åçè·ç¦»\nv_line_data.a = lineOffsetWidth/linePixelSize;  // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // è®¾ç½®å¼§çº¿çåºè²\n  if(u_linearColor == 1.0) { // ä½¿ç¨æ¸åé¢è²\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // ä½¿ç¨ color æ¹æ³ä¼ å¥çé¢è²\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // å®çº¿é¨å\n    } else {\n      // èçº¿é¨å\n      discard;\n    };\n  }\n\n  // è®¾ç½®å¼§çº¿çå¨ç»æ¨¡å¼\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // è®¾ç½®å¼§çº¿çè´´å¾\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // è´´å¾å¨å¼§çº¿ä¸éå¤çæ°é\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = v_line_data.a; // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // è®¾ç½®è´´å¾ååºè²çå å æ¨¡å¼\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:QU,depth:{enable:!1},segmentNumber:n});case 3:return r=e.sent,e.abrupt("return",[r]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sN.Attribute,descriptor:{name:"a_Instance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(t,n,r){var i,o=t.originCoordinates;if(o&&null!==(i=e.mapService)&&void 0!==i&&i.isMapBoxMapLibre()){var a=E(o,2),s=a[0],u=a[1];return[s[0],s[1],u[0],u[1]]}return[r[3],r[4],r[5],r[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"Position1",type:sN.Attribute,descriptor:{name:"a_Position1",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(t,n,r){var i=t.coordinates,o=t.originCoordinates,a=E(o||i,2),s=a[0],u=a[1],c=[s[0],s[1],u[0],u[1]],l=e.getUninforms().segmentNumber,h=2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]],f=e.handleGLSL(c,h,l),p=f.currentDegree,d=f.nextDegree;return o&&e.mapService.isMapBoxMapLibre()?e.transformMapboxOffset(p,d):[].concat(T(p),T(d))}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}},{key:"handleGLSL",value:function(e,t,n){var r=function(e){return e/(n-1)},i=[e[0],e[1]],o=[e[2],e[3]],a=t[0],s=r(a),u=r(a+function(e,t,n){return e*(1-n)+t*n}(-1,1,0<a?0:1));return{currentDegree:gx(i,o,s,this.mapService.version),nextDegree:gx(i,o,u,this.mapService.version)}}},{key:"transformMapboxOffset",value:function(e,t){var n=Ib(e,this.mapService.map,512),r=Ib(t,this.mapService.map,512);if(this.mapService.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){var i=this.mapService.coordinateSystemService.offsetCenterTransform;n=[n[0]-i[0],n[1]-i[1]],r=[r[0]-i[0],r[1]-i[1]]}return[].concat(T(n),T(r))}}]);var n,r}(nU),IV='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV çº¿å¾å± - è´´å¾é¨åç v åæ ï¼çº¿çå®½åº¦æ¹åï¼\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * å¨æ¯æç®­å¤´çæ¶åï¼ç¬¬äºãç¬¬ä¸ç»é¡¶ç¹æ¯é¢å¤æå¥ç¨äºæå»ºé¡¶ç¹ç\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // é«å¾· 2.0 çæè½¬è§åº¦ä¸å\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // æ ¹æ®çº¿çä¸¤ä¾§åç§»ä¸åãæè½¬çæ¹åç¸å\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // è®¡ç®åç´ä¸çº¿æ¹åçæè½¬ç©éµ\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y ç¨äºæ è®°å½åé¡¶ç¹å±äºåªä¸ç»ï¼ä¸¤ä¸ªé¡¶ç¹ä¸ç»ï¼ææçº¿çå¶å®æ¯ç©å½¢ï¼æç®éè¦åä¸ªé¡¶ç¹ãä¸¤ç»é¡¶ç¹ææï¼\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // ç®­å¤´å°é¨\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // ç®­å¤´ä¸¤ä¾§\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // æ²¿çº¿åç§»\n    offset = offset * arrowWidth; // åç´çº¿åå¤åç§»ï¼æ¯æå»ºç®­å¤´ä¸¤ä¾§çé¡¶ç¹ï¼\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // åç§»å¶ä½çç¹ä½ï¼å°é¿åº¦è®©ä½ç»ç®­å¤´ï¼\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// æ²¿çº¿åç§»\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n\n  \n  float d_texPixelLen;    // è´´å¾çåç´ é¿åº¦ï¼æ ¹æ®å°å¾å±çº§ç¼©æ¾\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  è®¡ç®ç®­å¤´\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // çº¿æ¨ªååç§»çè·ç¦»ï¼åä¸¤ä¾§åç§»çåï¼\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // å®ç¹ä½ç½®åç§»ï¼æå°å¾ç­çº§ç¼©æ¾åçè·ç¦» åä¾§ * 2\n  float texV = lineOffsetWidth/linePixelSize; // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // è®¾ç½®æ°æ®éçåæ°\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // çº¿é¡¶ç¹çé«åº¦ - å¼å®¹ä¸å­å¨ç¬¬ä¸ä¸ªæ°å¼çæåµ vertex height\n  float lineHeight = a_Size.y; // size ç¬¬äºä¸ªåæ°ä»£è¡¨çé«åº¦ [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // ä¿æå amap/mapbox ä¸è´çææ\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // å¼å®¹ mapbox å¨çº¿é«åº¦ä¸çææè¡¨ç°åºæ¬ä¸è´\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n      // mapbox\n      // ä¿æé«åº¦ç¸å¯¹ä¸å\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight é¡¶ç¹åç§»é«åº¦\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',RV={solid:0,dash:1},OV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"textureEventFlag",!1),f(e,"texture",e.createTexture2D({data:[0,0,0,0],mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1,height:1})),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5,0,0]:s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.vertexHeightScale,d=void 0===p?20:p,v=e.borderWidth,g=void 0===v?0:v,m=e.borderColor,y=void 0===m?"#ccc":m,b=e.raisingHeight,x=void 0===b?0:b,S=e.heightfixed,E=void 0!==S&&S,A=e.linearDir,T=void 0===A?iU.VERTICAL:A,w=e.blur,C=void 0===w?[1,1,1]:w,k=e.arrow,M=void 0===k?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:k;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var P=0,I=[0,0,0,0],R=[0,0,0,0];return t&&n&&(I=gv(t),R=gv(n),P=1),_({u_textureBlend:i===oU.NORMAL?0:1,u_line_type:RV[a],u_dash_array:u,u_blur:C,u_texture:this.texture,u_line_texture:l?1:0,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:g,u_borderColor:gv(y),u_linearDir:T===iU.VERTICAL?1:0,u_linearColor:P,u_sourceColor:I,u_targetColor:R,u_heightfixed:Number(E),u_vertexScale:d,u_raisingHeight:Number(x),u_arrow:Number(M.enable),u_arrowHeight:M.arrowHeight||3,u_arrowWidth:M.arrowWidth||2,u_tailWidth:void 0===M.tailWidth?1:M.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=KE,e.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:a,fragmentShader:o,triangulation:KE,inject:this.getInject(),depth:{enable:r}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // æ§å¶è¿å¨\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n \n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // å®çº¿é¨å\n  } else {\n    // èçº¿é¨å\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // ä¿æé«åº¦ç¸å¯¹ä¸å\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // ä½¿ç¨æ¸åé¢è²\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n    gl_FragColor.a *= v_color.a;\n  } else { // ä½¿ç¨ color æ¹æ³ä¼ å¥çé¢è²\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:IV,type:"Linear"}:{frag:'// #extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // æ§å¶è¿å¨\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  float d_distance_ratio = v_texture_data.r; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // å½åé¡¶ç¹çè·ç¦»\n    float d_texPixelLen = v_texture_data.b;  // è´´å¾çåç´ é¿åº¦ï¼æ ¹æ®å°å¾å±çº§ç¼©æ¾\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // ç»å¶ border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth / 2.0;\n\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) { // å¤ä¾§\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:IV,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:sN.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:sN.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:sN.Attribute,descriptor:{name:"a_Miter",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]);var n,r}(nU),LV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"colorTexture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var n=_v(e.layer.getLayerConfig().rampColors);e.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE,min:IP.NEAREST,mag:IP.NEAREST,flipY:!1})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.vertexHeightScale,i=void 0===r?20:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s,c=e.linearDir,l=void 0===c?iU.VERTICAL:c;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:l===iU.VERTICAL?1:0,u_opacity:iz(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(a)}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,this.layer.triangulation=jU,e.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // çº¿æ¨ªååç§»çè·ç¦»ï¼åä¸¤ä¾§åç§»çåï¼\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // å®ç¹ä½ç½®åç§»ï¼æå°å¾ç­çº§ç¼©æ¾åçè·ç¦» åä¾§ * 2\n  float texV = lineOffsetWidth/linePixelSize; // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n  float linearRadio =currentLinePointRatio; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= u_opacity; // å¨å±éæåº¦\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // çº¿é¡¶ç¹çé«åº¦ - å¼å®¹ä¸å­å¨ç¬¬ä¸ä¸ªæ°å¼çæåµ vertex height\n  float lineHeight = a_Size.y; // size ç¬¬äºä¸ªåæ°ä»£è¡¨çé«åº¦ [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // ä¿æå amap/mapbox ä¸è´çææ\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // å¼å®¹ mapbox å¨çº¿é«åº¦ä¸çææè¡¨ç°åºæ¬ä¸è´\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // ä¿æé«åº¦ç¸å¯¹ä¸å\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight é¡¶ç¹åç§»é«åº¦\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // å¨å±éæåº¦\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:jU,depth:{enable:r}});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:sN.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:sN.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:sN.Attribute,descriptor:{name:"a_Miter",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]);var n,r}(nU),NV='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // çº¿é¡¶ç¹çé«åº¦ - å¼å®¹ä¸å­å¨ç¬¬ä¸ä¸ªæ°å¼çæåµ\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // å¼å®¹ mapbox å¨çº¿é«åº¦ä¸çææè¡¨ç°åºæ¬ä¸è´\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // ä¿æé«åº¦ç¸å¯¹ä¸å\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // ä¿æé«åº¦ç¸å¯¹ä¸å\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',DV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.vertexHeightScale,a=void 0===o?20:o,s=0,u=[0,0,0,0],c=[0,0,0,0];return r&&i&&(u=gv(r),c=gv(i),s=1),{u_opacity:iz(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:c,u_vertexScale:a}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= opacity; // å¨å±éæåº¦\n}\n",vert:NV,type:"lineSimpleLinear"}:{frag:"\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",vert:NV,type:"lineSimpleNormal"}}},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:VU,primitive:IP.LINES,depth:{enable:!1},pick:!1});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:sN.Attribute,descriptor:{name:"a_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:sN.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]);var n,r}(nU),FV={arc:_V,arc3d:TV,greatcircle:PV,wall:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:IP.NEAREST,min:IP.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.heightfixed,u=void 0!==s&&s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];return r&&i&&(g=gv(r),m=gv(i),v=1),{u_heightfixed:Number(u),u_opacity:iz(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:l?1:0,u_iconStepCount:d,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV çº¿å¾å± - è´´å¾é¨åç v åæ ï¼çº¿çå®½åº¦æ¹åï¼\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  float d_texPixelLen;    // è´´å¾çåç´ é¿åº¦ï¼æ ¹æ®å°å¾å±çº§ç¼©æ¾\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // é«åº¦é zoom è°æ´\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // è®¾ç½®æ°æ®éçåæ°\n  v_dataset[0] = d_distance_ratio; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  v_dataset[1] = a_Distance;       // å½åé¡¶ç¹çè·ç¦»\n  v_dataset[2] = d_texPixelLen;    // è´´å¾çåç´ é¿åº¦ï¼æ ¹æ®å°å¾å±çº§ç¼©æ¾\n  v_dataset[3] = miter;          // çº¿å¾å±è´´å¾é¨åç v åæ å¼ 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // åºå®é«åº¦\n  if(u_heightfixed < 1.0) {     // é«åº¦é zoom è°æ´\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // æ§å¶è¿å¨\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // è¿å¨éåº¦\n  float d_distance_ratio = v_dataset.r; // å½åç¹ä½è·ç¦»å çº¿æ»é¿çæ¯ä¾\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // ä½¿ç¨æ¸åé¢è²\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // ä½¿ç¨ color æ¹æ³ä¼ å¥çé¢è²\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // å¨å±éæåº¦\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // å½åé¡¶ç¹çè·ç¦»\n    float d_texPixelLen = v_dataset.b;  // è´´å¾çåç´ é¿åº¦ï¼æ ¹æ®å°å¾å±çº§ç¼©æ¾\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // çº¿å¾å±è´´å¾é¨åç v åæ å¼\n\n    // è®¡ç®çº¹çé´é start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // è®¡ç®çº¹çé´é end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: å¤æ­çº¹çé´é\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:jU,depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:sN.Attribute,descriptor:{name:"a_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:sN.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:sN.Attribute,descriptor:{name:"a_Miter",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]);var n,r}(nU),line:OV,simple:DV,linearline:LV,earthArc3d:CV,flowline:kV},zV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","LineLayer"),f(e,"enableShaderEncodeStyles",["opacity","offsets","stroke"]),f(e,"arrowInsertCount",0),f(e,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new FV[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=_({},e);e.coordinates.map((function(e){t.push(_(_({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]);var n}(eU);sr({target:"String",proto:!0},{repeat:_y});var BV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"raiseCount",0),f(e,"raiseRepeat",0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,c=e.heightfixed,l=void 0!==c&&c,h=e.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=gv(o),m=gv(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:iz(i)?i:1,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // é»è®¤ä¸åºå®\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// ç¨äºå°å¨é¡¶ç¹çè²å¨ä¸­è®¡ç®å¥½çæ ·å¼å¼ä¼ éç»çå\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // å¨ cell ä¸­åå¼çåç§»é\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z æ¯å¨æå»ºç½æ ¼çæ¶åä¼ å¥çæ åå¼ 0 - 1ï¼å¨æå¼å¨æå¼å¯ä»¥è·å 0ï½1 çº¿æ§æ¸åçå¼\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // æ§å¶åæ±ä½çå¤§å° - ä»æ ååä½åæ±ä½è¿è¡åç§»\n  if(u_heightfixed < 1.0) { // åæ±ä½ä¸åºå®é«åº¦\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// åæ±ä½åºå®é«åº¦ ï¼ å¤ç mapbox ï¼\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r æ§å¶åæ±ççé¿\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // åæ±åç§ææ\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // åæ¶ä¸åè¡¨è¾¾å¼ï¼å¢å¼ºå¥å£®æ§\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // è®¾ç½®åæ±çåºè²\n  if(u_linearColor == 1.0) { // ä½¿ç¨æ¸åé¢è²\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // ä½¿ç¨ color æ¹æ³ä¼ å¥çé¢è²\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // å¨å°çæ¨¡å¼ä¸ï¼å°åæ¬åç´äº xy å¹³é¢çåæ±è°æ´å§¿æå°éåºåçè§åº¦\n  //æè½¬ç©éµmxï¼åå»ºç»xè½´æè½¬ç©éµ\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//æ±è§£æè½¬è§åº¦ä½å¼¦å¼\n  float xsin = sin(xRadian);//æ±è§£æè½¬è§åº¦æ­£å¼¦å¼\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //æè½¬ç©éµmyï¼åå»ºç»yè½´æè½¬ç©éµ\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//æ±è§£æè½¬è§åº¦ä½å¼¦å¼\n  float ysin = sin(yRadian);//æ±è§£æè½¬è§åº¦æ­£å¼¦å¼\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // å¼å¯éæåº¦æ¸å\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:zU,depth:{enable:!0},cull:{enable:!0,face:kv(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:sN.Attribute,descriptor:{name:"a_Pos",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e){var t=ox(e.coordinates);return pU([t[0],t[1]])}}})}}]);var n,r}(nU),jV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,o=e.strokeWidth,a=void 0===o?0:o,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s,c=e.blend,l=e.blur;return{u_blur:void 0===l?0:l,u_additive:"additive"===c?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:gv(u)}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=FU,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize è®¾ç½®æ¾åå¤§å°\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) æ¯ä¸ºäºå¼å®¹å°çæ¨¡å¼\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:FU,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sN.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r){var i=E(n,3),o=i[0],a=i[1],s=i[2],u=j_(0,0,1),c=j_(o,0,s),l=o>=0?J_(u,c):2*Math.PI-J_(u,c),h=2*Math.PI-Math.asin(a/100),f=n_();h_(f,f,l),l_(f,f,h);var p=j_(1,1,0);$_(p,p,f),q_(p,p);var d=j_(-1,1,0);$_(d,d,f),q_(d,d);var v=j_(-1,-1,0);$_(v,v,f),q_(v,v);var g=j_(1,-1,0);$_(g,g,f),q_(g,g);var m=[].concat(T(p),T(d),T(v),T(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:sN.Attribute,descriptor:{name:"a_Shape",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]);var n,r}(nU),UV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"raiseCount",0),f(e,"raiseRepeat",0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,c=e.heightfixed,l=void 0!==c&&c,h=e.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=gv(o),m=gv(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,e.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // é»è®¤ä¸åºå®\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // æ§å¶åæ±ä½çå¤§å° - ä»æ ååä½åæ±ä½è¿è¡åç§»\n\n  if(u_heightfixed < 1.0) { // åæ±ä½ä¸åºå®é«åº¦\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 åæ ç³»ä¸ï¼ä¸ºäºå Web å¢¨å¡æåæ ç³»ç»ä¸ï¼zoom é»è®¤å3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// åæ±ä½åºå®é«åº¦ ï¼ å¤ç mapbox ï¼\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r æ§å¶åæ±ççé¿\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // åæ±åç§ææ\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // åæ¶ä¸åè¡¨è¾¾å¼ï¼å¢å¼ºå¥å£®æ§\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // è®¾ç½®åæ±çåºè²\n  if(u_linearColor == 1.0) { // ä½¿ç¨æ¸åé¢è²\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // å¼å¯éæåº¦æ¸å\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:zU,cull:{enable:!0,face:kv(this.mapService.version)},depth:{enable:r,range:[0,.9]}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:sN.Attribute,descriptor:{name:"a_Pos",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e){var t=ox(e.coordinates);return[t[0],t[1],0]}}})}}]);var n,r}(nU),VV="\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // æ ¹æ®å å æ¨¡å¼éæ©ææ\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // ä¼åæ°´æ³¢ç¹ blend additive æ¨¡å¼ä¸æçæ¾åææ \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",GV='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n// uniform float u_opacity : 1;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  // éæåº¦è®¡ç®\n  v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize è®¾ç½®æ¾åå¤§å°\n  *  u_meter2coord å¨ç­é¢ç§¯å¤§å°çæ¶åè®¾ç½®åä½\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  \n  // TODP: /abs(extrude.x) æ¯ä¸ºäºå¼å®¹å°çæ¨¡å¼\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',HV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,c=void 0===u?0:u,l=e.heightfixed,h=void 0!==l&&l,f=e.unit,p=void 0===f?"pixel":f;return _({u_blur_height_fixed:[s,Number(c),Number(h)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:aU[p]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),QE)}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=QE,e.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:QE,depth:{enable:!1}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(e){if(!e.enable)return{frag:"uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = v_color;\n  } else {\n    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n   // ä½ä¸º mask æ¨¡æ¿æ¶éè¦ä¸¢å¼éæçåç´ \n  if(gl_FragColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:GV,type:"pointFill"};switch(e.type){case"wave":default:return{frag:VV,vert:GV,type:"pointWave"}}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sN.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:sN.Attribute,descriptor:{name:"a_Shape",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]);var n,r}(nU),WV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"meter2coord",1),f(e,"texture",void 0),f(e,"isMeter",!1),f(e,"radian",0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:IP.LINEAR,min:IP.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.rotation,a=e.raisingHeight,s=void 0===a?0:a,u=e.heightfixed,c=void 0!==u&&u,l=e.unit,h=void 0===l?"pixel":l;this.rendererService.getDirty()&&this.texture.bind();var f=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(f=-1),this.radian=void 0!==o?f*Math.PI*o/180:f*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(c),u_size_unit:aU[h],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),DU)}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // æ¬èº«ç uv åæ \nvarying vec2 v_Iconuv; // icon è´´å¾ç uv åæ \n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // æ¬èº«ç uv åæ \nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:DU,depth:{enable:!1,range:[0,.9]},cull:{enable:!0,face:kv(this.mapService.version)}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:sN.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sN.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]);var n,r}(nU),YV=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:IP.LINEAR,min:IP.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(a),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(u_offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // äº®åº¦æå\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: å»é¤è¾¹ç¼é¨å mipmap å¯¼è´çæ··ååæ\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * u_opacity;\n      \n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:BU,depth:{enable:!1},primitive:IP.POINTS});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]);var n,r}(nU);function XV(e){var t=e.coordinates;return{vertices:T(t),indices:[0],size:t.length}}var ZV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:iz(t)?t:1}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=XV,e.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"varying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n}\n",triangulation:XV,depth:{enable:!1},primitive:IP.POINTS,pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]);var n,r}(nU),qV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,o=void 0===i?1:i,a=e.unit;return{u_size_unit:aU[void 0===a?"pixel":a],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),DU)}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // ä¸ä»¥ç±³ä¸ºå®éåä½\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',triangulation:DU,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sN.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]);var n,r}(nU);function KV(e){var t=e.coordinates;return{vertices:T(t),indices:[0],size:t.length}}var QV=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.blend,a=e.strokeOpacity,s=void 0===a?1:a,u=e.strokeWidth,c=void 0===u?0:u,l=e.stroke;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:c,u_stroke_color:gv(void 0===l?"#fff":l)}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=KV,e.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: çåå°ä¸­å¿ç¹çè·ç¦» 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: çåçåªåæåå½¢\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // å½å­å¨ stroke ä¸ stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // å½ä¸å­å¨ stroke æ stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:KV,depth:{enable:!1},primitive:IP.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]);var n,r}(nU),$V=function(){return l((function e(t,n,r){s(this,e),f(this,"boxCells",[]),f(this,"xCellCount",void 0),f(this,"yCellCount",void 0),f(this,"boxKeys",void 0),f(this,"bboxes",void 0),f(this,"width",void 0),f(this,"height",void 0),f(this,"xScale",void 0),f(this,"yScale",void 0),f(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}),[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c){var l,f=this.bboxes,p=h(c);try{for(p.s();!(l=p.n()).done;){var d=l.value;if(!u.box[d]){u.box[d]=!0;var v=4*d;if(e<=f[v+2]&&t<=f[v+3]&&n>=f[v+0]&&r>=f[v+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:f[v],y1:f[v+1],x2:f[v+2],y2:f[v+3]})}}}}catch(e){p.e(e)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),c=this.convertToYCellCoord(t),l=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=l;f++)for(var p=c;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}])}(),JV=function(){return l((function e(t,n){s(this,e),f(this,"width",void 0),f(this,"height",void 0),f(this,"grid",void 0),f(this,"viewportPadding",100),f(this,"screenRightBoundary",void 0),f(this,"screenBottomBoundary",void 0),f(this,"gridRightBoundary",void 0),f(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new $V(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}),[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=Ky(t,n,0,1),i=qy();return Qy(i,r,i_.apply(T_,T(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}])}();function eG(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function tG(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,c=n;c<=r;c++)e[c].x-=u}}function nG(e,t,n,r,i,o,a){var s,u=(t-n)*i,c=(-r*a+.5)*o,l=h(e);try{for(l.s();!(s=l.n()).done;){var f=s.value;f.x+=u,f.y+=c}}catch(e){l.e(e)}finally{l.f()}}function rG(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=l.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(l.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),l.length!==f){var n=s-a;c=Math.max(n,c),tG(l,t,f,l.length-1,h)}s=0,u-=r+5}));var p=eG(i),d=p.horizontalAlign,v=p.verticalAlign;nG(l,h,d,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*c,e.right=e.left+c}function iG(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=l.length;n.forEach((function(e){var n=t[e];if(n&&(l.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),l.length!==f){var i=s-a;c=Math.max(i,c),tG(l,t,f,l.length-1,h)}s=0,u-=r+5}));var p=eG(i),d=p.horizontalAlign,v=p.verticalAlign;nG(l,h,d,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*c,e.right=e.left+c}var oG='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // ä½ä¸º mask æ¨¡æ¿æ¶éè¦ä¸¢å¼éæçåç´ \n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',aG='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\n// uniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // ææ¬ç¼©æ¾æ¯ä¾\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function sG(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,T(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],T(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],T(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],T(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var uG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"glyphInfo",void 0),f(e,"glyphInfoMap",{}),f(e,"rawEncodeData",void 0),f(e,"texture",void 0),f(e,"currentZoom",-1),f(e,"extent",void 0),f(e,"textureHeight",0),f(e,"textCount",0),f(e,"preTextStyle",{}),f(e,"mapping",o(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,c=e.raisingHeight,l=void 0===c?0:c,h=this.getFontServiceMapping(),f=this.getFontServiceCanvas();return h&&Object.keys(h).length!==this.textCount&&f&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle(),_({u_raisingHeight:Number(l),u_stroke_width:i,u_stroke_color:gv(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null==f?void 0:f.width)||1,(null==f?void 0:f.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:(u=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),e.abrupt("return",this.buildModels());case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"buildModels",value:(i=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:aG,fragmentShader:oG,inject:this.getInject(),triangulation:sG.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"needUpdate",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,a=t.textOffset,s=t.padding,u=t.fontFamily,c=t.fontWeight,Uz(s,this.preTextStyle.padding)&&Uz(a,this.preTextStyle.textOffset)&&Uz(o,this.preTextStyle.textAnchor)&&Uz(u,this.preTextStyle.fontFamily)&&Uz(c,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(l=this.mapService.getZoom(),h=this.mapService.getBounds(),f=Jb(this.extent,h),!(Math.abs(this.currentZoom-l)>.5)&&f&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:sN.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:sN.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:sN.Attribute,descriptor:{name:"a_tex",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){return $b(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,o=h(r=r.toString());try{for(o.s();!(t=o.n()).done;){var a=t.value;-1===i.indexOf(a)&&i.push(a)}}catch(e){o.e(e)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,c=e.textAnchor,l=void 0===c?"center":c,h=e.textOffset,f=void 0===h?[0,0]:h,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,g=void 0===v?1:v,m=e.strokeWidth,y=void 0===m?0:m,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:l,textOffset:f,opacity:d,strokeOpacity:g,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map((function(r){var i=r.shape,a=void 0===i?"":i,c=r.id,l=r.size,f=void 0===l?1:l,p=r.textOffset?r.textOffset:u||[0,0],d=r.textAnchor?r.textAnchor:s||"center",v=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),c=[],l={positionedGlyphs:c,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?iG(l,t,u,n,r,i,o):rG(l,t,u,n,r,i,o),!!c.length&&l}(a.toString(),n,f,d,"left",o,p,e),g=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],s=h(o);try{for(s.s();!(t=s.n()).done;){var u=t.value,c=u.metrics,l=4,f=c.advance*u.scale/2,p=r?[u.x+f,u.y]:[0,0],d=r?[0,0]:[u.x+f+n[0],u.y+n[1]],v=(0-l)*u.scale-f+d[0],g=(0-l)*u.scale+d[1],m=v+c.width*u.scale,y=g+c.height*u.scale,_={x:v,y:g},b={x:m,y:g},x={x:v,y:y},S={x:m,y:y};a.push({tl:_,tr:b,bl:x,br:S,tex:c,glyphOffset:p})}}catch(e){s.e(e)}finally{s.f()}return a}(v,p,!1);return r.shaping=v,r.glyphQuads=g,r.centroid=ox(r.coordinates),r.originCentroid="GAODE2.x"===r.version||"MAPBOX"===r.version||"MAPLIBRE"===r.version?ox(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[c]={shaping:v,glyphQuads:g,centroid:ox(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new JV(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version||"MAPBOX"===t.version||"MAPLIBRE"===t.version?t.originCentroid:t.centroid,s=t.size/16,c=e.mapService.lngLatToContainer(a),l=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:c.x,anchorPointY:c.y}).box;return!(!l||!l.length)&&(u.insertCollisionBox(l,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:IP.LINEAR,min:IP.LINEAR,width:t.width,height:t.height})}},{key:"reBuildModel",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:aG,fragmentShader:oG,triangulation:sG.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n,r,i,u}(nU),cG={fillImage:WV,fill:HV,radar:qV,image:YV,normal:ZV,simplePoint:QV,extrude:UV,text:uG,earthFill:jV,earthExtrude:BV},lG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","PointLayer"),f(e,"enableShaderEncodeStyles",["opacity","offsets","stroke"]),f(e,"enableDataEncodeStyles",["textOffset","textAnchor"]),f(e,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return v(t,e),l(t,[{key:"buildModels",value:(r=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new cG[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"rebuildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=h(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(e){a.e(e)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]);var n,r}(eU),hG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.heightfixed,n=void 0!==t&&t,r=e.raisingHeight,i=void 0===r?0:r,o=e.topsurface,a=void 0===o||o,s=e.sidesurface,u=void 0===s||s,c=e.sourceColor,l=e.targetColor,h=0,f=[1,1,1,1],p=[1,1,1,1];return c&&l&&(f=gv(c),p=gv(l),h=1),_({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:h,u_sourceColor:f,u_targetColor:p,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:(i=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"buildModels",value:(r=o(x().mark((function e(){var t,n,r,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:ZU,depth:{range:[0,.9]}});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: é¨åæºå GPU è®¡ç®ç²¾åº¦å¼å®¹\n  if(isSide < 0.999) {// æ¯å¦æ¯è¾¹ç¼\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // é»è®¤ä¸åºå®\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // å¤æ­å ä½ä½æ¯å¦åºå®é«åº¦\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: é¨åæºå GPU è®¡ç®ç²¾åº¦å¼å®¹\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0; // é»è®¤ä¸åºå®\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // å¤æ­å ä½ä½æ¯å¦åºå®é«åº¦\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // é»è®¤ä¸åºå®\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // å¤æ­å ä½ä½æ¯å¦åºå®é«åº¦\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  // Tip: é¨åæºå GPU è®¡ç®ç²¾åº¦å¼å®¹\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],i=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var o=E(this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),2),a=o[0],s=o[1],u=E(this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),2),c=u[0],l=u[1];r=c-a,i=l-s,t=[a,s,c,l]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:sN.Attribute,descriptor:{name:"a_uvs",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,n,o){var a=o[0],s=o[1];return[(a-t[0])/r,(s-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(n=o(x().mark((function e(){var t,n,r,i=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e,t){var o=new Image;o.crossOrigin="anonymous",o.src=n,o.onload=function(){return i.texture=r({data:o,width:o.width,height:o.height,wrapS:IP.CLAMP_TO_EDGE,wrapT:IP.CLAMP_TO_EDGE,min:IP.LINEAR,mag:IP.LINEAR}),e(null)},o.onerror=function(){t(new Error("image load error"))}})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n,r,i}(nU),fG=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return _({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,i=t.triangulation,o=t.type,a=this.layer.getLayerConfig(),s=a.workerEnabled,u=void 0!==s&&s,c=a.enablePicking,this.layer.triangulation=i,e.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:IP.TRIANGLES,depth:{enable:!1},workerEnabled:u,workerOptions:{modelType:o,enablePicking:c}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:sN.Attribute,descriptor:{name:"a_linear",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:YU}:{frag:'varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n\n  // cal style mapping - æ°æ®çº¹çæ å°é¨åçè®¡ç®\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:$E}}}]);var n,r}(nU),pG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture1",void 0),f(e,"texture2",void 0),f(e,"texture3",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,o=e.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:gv(i),u_watercolor2:gv(a),u_opacity:iz(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:WU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=E(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:sN.Attribute,descriptor:{name:"a_uv",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,r,i,s){var u=E(e.version===TN["GAODE2.x"]||e.version===TN.MAPBOX||e.version===TN.MAPLIBRE?e.originCoordinates[0][s]:i,2),c=u[0],l=u[1];return[(c-t)/o,(l-n)/a]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(e){return i({data:e,width:e.width,height:e.height,wrapS:IP.MIRRORED_REPEAT,wrapT:IP.MIRRORED_REPEAT,min:IP.LINEAR,mag:IP.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),e=function(e){r.texture1=a(e[0]),r.texture2=a(e[1]),r.texture3=a(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]);var n,r}(nU),dG={fill:fG,line:OV,extrude:hG,text:uG,point_fill:HV,point_image:YV,point_normal:ZV,point_extrude:UV,water:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:iz(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:WU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=E(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:sN.Attribute,descriptor:{name:"a_uv",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,r,i,s){var u=E(e.version===TN["GAODE2.x"]||e.version===TN.MAPBOX||e.version===TN.MAPLIBRE?e.originCoordinates[0][s]:i,2),c=u[0],l=u[1];return[(c-t)/o,(l-n)/a]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommendï¼https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:IP.MIRRORED_REPEAT,wrapT:IP.MIRRORED_REPEAT,min:IP.LINEAR,mag:IP.LINEAR}),e.layerService.reRender()}}}]);var n,r}(nU),ocean:pG},vG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","PolygonLayer"),f(e,"enableShaderEncodeStyles",["opacity"]),f(e,"defaultSourceConfig",void 0),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new dG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]);var n}(eU),gG='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',mG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"colorTexture",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,c=e.domain,l=e.rampColors,h=c||Tv(l);return this.colorTexture=this.layer.textureService.getColorTexture(l,h),{u_opacity:n||1,u_texture:this.texture,u_domain:h,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(i=o(x().mark((function e(t){var n,r,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:IP.LUMINANCE,type:IP.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:gG,fragmentShader:"#extension GL_OES_standard_derivatives : enable\nprecision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",triangulation:KU,primitive:IP.TRIANGLES,depth:{enable:!1,range:[0,.9]}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r,i}(nU),yG=["data"],_G=["rasterData"],bG={raster:mG,rasterRgb:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"dataOption",{}),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:(i=o(x().mark((function e(t){var n,r,i,o,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=b(t,yG),this.dataOption=r,e.abrupt("return",_({data:n},r));case 4:return e.next=6,t.data;case 6:if(i=e.sent,o=i.rasterData,a=b(i,_G),this.dataOption=a,!Array.isArray(o)){e.next=14;break}return e.abrupt("return",_({data:o},a));case 14:return e.abrupt("return",_({data:Array.from(o)},a));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:IP.RGB,type:IP.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:gG,fragmentShader:"precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",triangulation:KU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r,i}(nU),raster3d:mG,rasterTerrainRgb:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,c=e.rampColors,l=e.colorTexture,h=e.rScaler,f=void 0===h?6553.6:h,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,g=void 0===v?.1:v,m=e.offset,y=void 0===m?1e4:m,_=u||Tv(c),b=l;return l?this.layer.textureService.setColorTexture(l,c,_):b=this.layer.textureService.getColorTexture(c,_),{u_opacity:t||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_unpack:[f,d,g,y],u_colorTexture:b}}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=4,t.data.images;case 4:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:IP.LINEAR,mag:IP.LINEAR}),e.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:KU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 8:return i=e.sent,e.abrupt("return",[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU)},xG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","RasterLayer"),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new bG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]);var n}(eU),SG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","TileDebugLayer"),f(e,"zIndex",1e4),f(e,"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]);var n}(eU),EG=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:iz(t)?t:1}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // å»é¤èé¢\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:eV,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU),AG={base:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"earthTime",3.4),f(e,"sunX",1e3),f(e,"sunY",1e3),f(e,"sunZ",1e3),f(e,"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;return null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),void 0!==(null==(n=t.globalOptions)?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){o.texture=i({data:e[0],width:e[0].width,height:e[0].height}),o.layerService.reRender()})),e.abrupt("return",this.buildModels());case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:"// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",triangulation:eV,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU),atomSphere:EG,bloomSphere:function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:iz(t)?t:1}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // å»é¤èé¢\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:tV,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sN.Attribute,descriptor:{name:"a_Size",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sN.Attribute,descriptor:{name:"a_Normal",buffer:{usage:IP.STATIC_DRAW,data:[],type:IP.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]);var n,r}(nU)},TG=["base","atomSphere","bloomSphere"],wG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","EarthLayer"),f(e,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new AG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("è¯·å¨ scene loaded ä¹åæ§è¡è¯¥æ¹æ³ï¼")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return TG.indexOf(n)<0&&(n="base"),n}}]);var n}(eU),CG={fill:function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:iz(n)?n:0,u_color:gv(i)}}},{key:"initModels",value:(r=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:WU,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]);var n,r}(nU)},kG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","MaskLayer"),f(e,"defaultSourceConfig",void 0),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new CG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]);var n}(eU);function MG(e,t,n){var r=PG(e,e.VERTEX_SHADER,t),i=PG(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var c=e.getActiveAttrib(o,u);o[c.name]=e.getAttribLocation(o,c.name)}for(var l=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),h=0;h<l;h++){var f=e.getActiveUniform(o,h);o[f.name]=e.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function PG(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function IG(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function RG(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function OG(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function LG(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function NG(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function DG(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var FG,zG,BG,jG,UG,VG,GG,HG,WG,YG,XG=function(){return l((function e(t){s(this,e),f(this,"width",512),f(this,"height",512),f(this,"pixels",void 0),f(this,"fadeOpacity",void 0),f(this,"speedFactor",void 0),f(this,"dropRate",void 0),f(this,"dropRateBump",void 0),f(this,"gl",void 0),f(this,"drawProgram",void 0),f(this,"fullScreenProgram",void 0),f(this,"updateProgram",void 0),f(this,"rampColors",void 0),f(this,"numParticles",65536),f(this,"numParticlesSize",void 0),f(this,"particleStateResolution",void 0),f(this,"quadBuffer",void 0),f(this,"particleIndexBuffer",void 0),f(this,"framebuffer",void 0),f(this,"colorRampTexture",void 0),f(this,"backgroundTexture",void 0),f(this,"screenTexture",void 0),f(this,"particleStateTexture0",void 0),f(this,"particleStateTexture1",void 0),f(this,"windTexture",void 0),f(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}),[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=MG(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=MG(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=MG(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer å§ç»ç¨éºæ»¡å±å¹ç texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=OG(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=IG(this.gl,this.gl.LINEAR,LG(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=IG(e,e.NEAREST,t,this.width,this.height),this.screenTexture=IG(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=IG(e,e.NEAREST,r,n,n),this.particleStateTexture1=IG(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=OG(e,o)}},{key:"setWind",value:function(e){this.windData=e,this.windTexture=function(e,t,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),r}(this.gl,this.gl.LINEAR,e.image)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=IG(t,t.NEAREST,r,n,n),this.particleStateTexture1=IG(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=OG(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=IG(t,t.LINEAR,LG(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=IG(n,n.NEAREST,r,e,t),this.screenTexture=IG(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return RG(t,this.windTexture,0),RG(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;DG(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),DG(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),RG(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),NG(e,this.particleIndexBuffer,t.a_index,1),RG(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;DG(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),NG(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,DG(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}])}(),ZG={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},qG={wind:function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"texture",void 0),f(e,"colorModel",void 0),f(e,"wind",void 0),f(e,"imageCoords",void 0),f(e,"sizeScale",.5),f(e,"frequency",new ey(7.2)),f(e,"cacheZoom",void 0),e}return v(t,e),l(t,[{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=o(x().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,v,g,m,y,_,b,S,E,A,T,w,C,k,M,P=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.layer.getLayerConfig(),o=i.uMin,a=void 0===o?-21.32:o,s=i.uMax,u=void 0===s?26.8:s,c=i.vMin,l=void 0===c?-21.57:c,h=i.vMax,f=void 0===h?21.42:h,p=i.fadeOpacity,d=void 0===p?.996:p,v=i.speedFactor,g=void 0===v?.25:v,m=i.dropRate,y=void 0===m?.003:m,_=i.dropRateBump,b=void 0===_?.01:_,S=i.rampColors,E=void 0===S?ZG:S,A=i.sizeScale,T=void 0===A?.5:A,w=this.rendererService.createTexture2D,C=this.layer.getSource(),this.texture=w({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),k=this.rendererService.getGLContext(),this.imageCoords=null===(t=C.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=C.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(e){var t;P.sizeScale=T*P.getZoomScale();var n=P.getWindSize(),r=n.imageWidth,i=n.imageHeight,o={glContext:k,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:g,dropRate:y,dropRateBump:b,rampColors:E};P.wind=new XG(o),P.wind.setWind({uMin:a,uMax:u,vMin:l,vMax:f,image:e[0]}),null===(t=P.texture)||void 0===t||t.destroy(),P.texture=w({width:r,height:i}),P.layerService.updateLayerRenderList()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:KU,primitive:IP.TRIANGLES,depth:{enable:!1}});case 10:return M=e.sent,this.colorModel=M,e.abrupt("return",[M]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(n=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:sN.Attribute,descriptor:{name:"a_Uv",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,c=e.numParticles,l=void 0===c?65535:c,h=e.fadeOpacity,f=void 0===h?.996:h,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,b=void 0===_?ZG:_,x=e.sizeScale,S=void 0===x?.5:x,E=l,A=Math.floor(this.mapService.getZoom());if("number"==typeof S&&S!==this.sizeScale||A!==this.cacheZoom){var T=this.getZoomScale();this.sizeScale=S,E*=T;var w=this.getWindSize(),C=w.imageWidth,k=w.imageHeight;this.wind.reSize(C,k),this.cacheZoom=A}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(E),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var M=this.wind.draw(),P=M.d,I=M.w,R=M.h;this.rendererService.setBaseState(),this.texture.update({data:P,width:I,height:R})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]);var n,r}(nU)},KG=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"type","WindLayer"),e}return v(t,e),l(t,[{key:"buildModels",value:(n=o(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new qG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]);var n}(eU),QG=(FG=Ce(),zG=we(Oe.ICoordinateSystemService),BG=we(Oe.IMapService),jG=we(Oe.IFontService),FG((GG=n((VG=function(){return l((function e(){s(this,e),g(this,"coordinateSystemService",GG,this),g(this,"mapService",HG,this),g(this,"fontService",WG,this)}),[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("DataMappingPlugin",o(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(tN.MappingStart,Vk.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(tN.MappingEnd,Vk.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=o(x().mark((function t(i){var o;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(tN.MappingStart,Vk.UPDATE),o=n.generateMaping(e,{styleAttributeService:r}),e.log(tN.MappingEnd,Vk.UPDATE),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var c=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(c)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),(0!==a.length||0!==e.encodeDataLength)&&(e.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(e,t,n,r){var i=this,o=e.getLayerConfig().arrow,a=void 0===o?{enable:!1}:o,s=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),u=n.map((function(t,n){var o=r?r[n]:{},u=_({id:t._id,coordinates:t.coordinates,originCoordinates:t.originCoordinates},o);if(s.forEach((function(e){var n=i.applyAttributeMapping(e,t);"color"!==e.name&&"stroke"!==e.name||(n=n.map((function(e){return gv(e)}))),u[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(u.shape=i.fontService.getIconFontKey(u[e.name]))})),a.enable&&"line"===u.shape){var c=u.coordinates;if(e.arrowInsertCount<e.encodeDataLength){var l=i.getArrowPoints(c[0],c[1]);u.coordinates.splice(1,0,l,l),e.arrowInsertCount++}}return u}));if(t.forEach((function(e){e.needRemapping=!1})),this.adjustData2SimpleCoordinates(u),this.coordinateSystemService.getCoordinateSystem()!==jy.METER_OFFSET&&(this.coordinateSystemService.offsetCenter=null,this.coordinateSystemService.offsetCenterTransform=null),this.coordinateSystemService.getCoordinateSystem()===jy.LNGLAT)this.adjustData2MapboxCoordinates(u);else if(this.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){var c=this.mapService.map,l=c.getCenter(),h=l.lng,f=l.lat,p=Ib([h,f],c,512);this.coordinateSystemService.offsetCenter||(this.coordinateSystemService.offsetCenter=[h,f]),this.coordinateSystemService.offsetCenterTransform||(this.coordinateSystemService.offsetCenterTransform=[p[0],p[1]]),this.adjustData2MapboxCoordinates(u)}return u}},{key:"adjustData2MapboxCoordinates",value:function(e){var t,n=this;e.length>0&&null!==(t=this.mapService)&&void 0!==t&&t.isMapBoxMapLibre()&&e.map((function(e){e.version=n.mapService.version,e.originCoordinates||(e.originCoordinates=aP(e.coordinates),e.coordinates=n.getMapboxCoordiantes(e.coordinates))}))}},{key:"getMapboxCoordiantes",value:function(e){var t=this,n=this.mapService.map;if("number"==typeof e[0])return this.project(e,n,512);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map((function(e){var i=[];e.map((function(e){i.push(t.project(e,n,512))})),r.push(i)})),r}var i=[];return e.map((function(e){i.push(t.project(e,n,512))})),i}},{key:"project",value:function(e,t,n){if(this.coordinateSystemService.getCoordinateSystem()===jy.METER_OFFSET){var r=Ib(e,t,n,this.coordinateSystemService.offsetCenter);return[Math.fround(r[0]),Math.fround(r[1])]}return Ib(e,t,n)}},{key:"getIsMultiCoor",value:function(){return!!this.mapService.isMapBoxMapLibre()&&Ob(this.mapService.map)}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&this.mapService.version===TN["GAODE2.x"]){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=TN["GAODE2.x"],e.originCoordinates=aP(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&this.mapService.version===TN.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=tx([t[0]-e[0],t[1]-e[1]]);return[e[0]+1e-4*n[0],e[1]+1e-4*n[1]]}}])}()).prototype,"coordinateSystemService",[zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HG=n(VG.prototype,"mapService",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WG=n(VG.prototype,"fontService",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=VG))||UG),$G=Ce()(YG=function(){return l((function e(){s(this,e),f(this,"mapService",void 0)}),[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(Oe.IMapService),e.hooks.init.tapPromise("DataSourcePlugin",o(x().mark((function n(){var r,i,o,a;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(tN.SourceInitStart,Vk.INIT),(r=e.getSource())||(i=e.sourceOption||e.defaultSourceConfig,o=i.data,a=i.options,r=new DF(o,a),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(tN.SourceInitEnd,Vk.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(tN.SourceInitEnd,Vk.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",o(x().mark((function n(){var r,i,o;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}])}())||YG;function JG(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function eH(e){return 1===e.length&&(e=function(e){return function(t,n){return JG(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var tH=eH(JG).right;function nH(e){return null===e?NaN:+e}function rH(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var iH=Math.sqrt(50),oH=Math.sqrt(10),aH=Math.sqrt(2);function sH(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=uH(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function uH(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=iH?10:o>=oH?5:o>=aH?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=iH?10:o>=oH?5:o>=aH?2:1)}function cH(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=iH?i*=10:o>=oH?i*=5:o>=aH&&(i*=2),t<e?-i:i}function lH(e,t,n){if(null==n&&(n=nH),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function hH(e){return function(){return e}}function fH(e){return 1==(e=+e)?pH:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):hH(isNaN(t)?n:t)}}function pH(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):hH(isNaN(e)?t:e)}var dH=function e(t){var n=fH(t);function r(e,t){var r=n((e=sv(e)).r,(t=sv(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=pH(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);var vH,gH=(vH=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return function(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}((n-r/t)*t,a,i,o,s)}},function(e){var t,n,r=e.length,i=new Array(r),o=new Array(r),a=new Array(r);for(t=0;t<r;++t)n=sv(e[t]),i[t]=n.r||0,o[t]=n.g||0,a[t]=n.b||0;return i=vH(i),o=vH(o),a=vH(a),n.opacity=1,function(e){return n.r=i(e),n.g=o(e),n.b=a(e),n+""}});function mH(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function yH(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=TH(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function _H(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function bH(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function xH(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=TH(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var SH=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,EH=new RegExp(SH.source,"g");function AH(e,t){var n,r,i,o=SH.lastIndex=EH.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=SH.exec(e))&&(r=EH.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:bH(n,r)})),o=EH.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function TH(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?hH(t):("number"===i?bH:"string"===i?(n=rv(t))?(t=n,dH):AH:t instanceof rv?dH:t instanceof Date?_H:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?yH:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?xH:bH:mH))(e,t)}function wH(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function CH(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function kH(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}function MH(){}function PH(e,t){var n=new MH;if(e instanceof MH)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function IH(){}MH.prototype=PH.prototype={constructor:MH,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var RH=PH.prototype;IH.prototype=function(e,t){var n=new IH;if(e instanceof IH)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:IH,has:RH.has,add:function(e){return this["$"+(e+="")]=e,this},remove:RH.remove,clear:RH.clear,values:RH.keys,size:RH.size,empty:RH.empty,each:RH.each};var OH=Array.prototype,LH=OH.map,NH=OH.slice,DH={name:"implicit"};function FH(){var e=PH(),t=[],n=[],r=DH;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==DH)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=PH();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=NH.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return FH(t,n).unknown(r)},CH.apply(i,arguments),i}function zH(e){return+e}var BH=[0,1];function jH(e){return e}function UH(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function VH(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function GH(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=UH(i,r),o=n(a,o)):(r=UH(r,i),o=n(o,a)),function(e){return o(r(e))}}function HH(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=UH(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=tH(e,t,1,r)-1;return o[n](i[n](t))}}function WH(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function YH(){var e,t,n,r,i,o,a=BH,s=BH,u=TH,c=jH;function l(){return r=Math.min(a.length,s.length)>2?HH:GH,i=o=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(c(t)))}return h.invert=function(n){return c(t((o||(o=r(s,a.map(e),bH)))(n)))},h.domain=function(e){return arguments.length?(a=LH.call(e,zH),c===jH||(c=VH(a)),l()):a.slice()},h.range=function(e){return arguments.length?(s=NH.call(e),l()):s.slice()},h.rangeRound=function(e){return s=NH.call(e),u=wH,l()},h.clamp=function(e){return arguments.length?(c=e?VH(a):jH,h):c!==jH},h.interpolate=function(e){return arguments.length?(u=e,l()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,l()}}function XH(e,t){return YH()(e,t)}function ZH(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function qH(e){return(e=ZH(Math.abs(e)))?e[1]:NaN}var KH,QH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $H(e){if(!(t=QH.exec(e)))throw new Error("invalid format: "+e);var t;return new JH({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function JH(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function eW(e,t){var n=ZH(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}$H.prototype=JH.prototype,JH.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var tW={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return eW(100*e,t)},r:eW,s:function(e,t){var n=ZH(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(KH=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+ZH(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function nW(e){return e}var rW,iW,oW,aW=Array.prototype.map,sW=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function uW(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?nW:(t=aW.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?nW:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(aW.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"-":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=$H(e)).fill,n=e.align,h=e.sign,f=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):tW[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?u:"",x=tW[y],S=/[defgprs%]/.test(y);function E(e){var i,o,u,f=_,E=b;if("c"===y)E=x(e)+E,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==h&&(A=!1),f=(A?"("===h?h:c:"-"===h||"("===h?"":h)+f,E=("s"===y?sW[8+KH/3]:"")+E+(A&&"("===h?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){E=(46===u?a+e.slice(i+1):e.slice(i))+E,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var T=f.length+e.length+E.length,w=T<d?new Array(d-T+1).join(t):"";switch(v&&p&&(e=r(w+e,w.length?d-E.length:1/0),w=""),n){case"<":e=f+e+E+w;break;case"=":e=f+w+e+E;break;case"^":e=w.slice(0,T=w.length>>1)+f+e+E+w.slice(T);break;default:e=w+f+e+E}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:h,formatPrefix:function(e,t){var n=h(((e=$H(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(qH(t)/3))),i=Math.pow(10,-r),o=sW[8+r/3];return function(e){return n(i*e)+o}}}}function cW(e,t,n,r){var i,o=cH(e,t,n);switch((r=$H(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(qH(t)/3)))-qH(Math.abs(e)))}(o,a))||(r.precision=i),oW(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,qH(t)-qH(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-qH(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return iW(r)}function lW(e){var t=e.domain;return e.ticks=function(e){var n=t();return sH(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return cW(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=uH(s,u,n))>0?r=uH(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=uH(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function hW(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function fW(e){return Math.log(e)}function pW(e){return Math.exp(e)}function dW(e){return-Math.log(-e)}function vW(e){return-Math.exp(-e)}function gW(e){return isFinite(e)?+("1e"+e):e<0?0:e}function mW(e){return function(t){return-e(-t)}}function yW(e){var t,n,r=e(fW,pW),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?gW:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=mW(t),n=mW(n),e(dW,vW)):e(fW,pW),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var c,l,h,f=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(l=1,c=n(f);l<o;++l)if(!((h=c*l)<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(l=o-1,c=n(f);l>=1;--l)if(!((h=c*l)<s)){if(h>u)break;v.push(h)}}else v=sH(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=iW(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(hW(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function _W(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function bW(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function xW(e){return e<0?-e*e:e*e}function SW(e){var t=e(jH,jH),n=1;function r(){return 1===n?e(jH,jH):.5===n?e(bW,xW):e(_W(n),_W(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},lW(t)}rW=uW({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),iW=rW.format,oW=rW.formatPrefix;var EW=new Date,AW=new Date;function TW(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return TW((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return EW.setTime(+t),AW.setTime(+r),e(EW),e(AW),Math.floor(n(EW,AW))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var wW=TW((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));wW.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?TW((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):wW:null};var CW=TW((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),kW=TW((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),MW=TW((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),PW=TW((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function IW(e){return TW((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var RW=IW(0),OW=IW(1),LW=(IW(2),IW(3),IW(4)),NW=(IW(5),IW(6),TW((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),DW=TW((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));DW.every=function(e){return isFinite(e=Math.floor(e))&&e>0?TW((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var FW=TW((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function zW(e){return TW((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var BW=zW(0),jW=zW(1),UW=(zW(2),zW(3),zW(4)),VW=(zW(5),zW(6),TW((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function GW(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function HW(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function WW(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}VW.every=function(e){return isFinite(e=Math.floor(e))&&e>0?TW((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var YW,XW,ZW={"-":"",_:" ",0:"0"},qW=/^\s*\d+/,KW=/^%/,QW=/[\\^$*+?|[\]().{}]/g;function $W(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function JW(e){return e.replace(QW,"\\$&")}function eY(e){return new RegExp("^(?:"+e.map(JW).join("|")+")","i")}function tY(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function nY(e,t,n){var r=qW.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function rY(e,t,n){var r=qW.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function iY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function oY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function aY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function sY(e,t,n){var r=qW.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function uY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function cY(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function lY(e,t,n){var r=qW.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function hY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function fY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function pY(e,t,n){var r=qW.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function dY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function vY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function gY(e,t,n){var r=qW.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function mY(e,t,n){var r=qW.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function yY(e,t,n){var r=qW.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function _Y(e,t,n){var r=KW.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function bY(e,t,n){var r=qW.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function xY(e,t,n){var r=qW.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function SY(e,t){return $W(e.getDate(),t,2)}function EY(e,t){return $W(e.getHours(),t,2)}function AY(e,t){return $W(e.getHours()%12||12,t,2)}function TY(e,t){return $W(1+PW.count(DW(e),e),t,3)}function wY(e,t){return $W(e.getMilliseconds(),t,3)}function CY(e,t){return wY(e,t)+"000"}function kY(e,t){return $W(e.getMonth()+1,t,2)}function MY(e,t){return $W(e.getMinutes(),t,2)}function PY(e,t){return $W(e.getSeconds(),t,2)}function IY(e){var t=e.getDay();return 0===t?7:t}function RY(e,t){return $W(RW.count(DW(e)-1,e),t,2)}function OY(e){var t=e.getDay();return t>=4||0===t?LW(e):LW.ceil(e)}function LY(e,t){return e=OY(e),$W(LW.count(DW(e),e)+(4===DW(e).getDay()),t,2)}function NY(e){return e.getDay()}function DY(e,t){return $W(OW.count(DW(e)-1,e),t,2)}function FY(e,t){return $W(e.getFullYear()%100,t,2)}function zY(e,t){return $W((e=OY(e)).getFullYear()%100,t,2)}function BY(e,t){return $W(e.getFullYear()%1e4,t,4)}function jY(e,t){var n=e.getDay();return $W((e=n>=4||0===n?LW(e):LW.ceil(e)).getFullYear()%1e4,t,4)}function UY(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+$W(t/60|0,"0",2)+$W(t%60,"0",2)}function VY(e,t){return $W(e.getUTCDate(),t,2)}function GY(e,t){return $W(e.getUTCHours(),t,2)}function HY(e,t){return $W(e.getUTCHours()%12||12,t,2)}function WY(e,t){return $W(1+FW.count(VW(e),e),t,3)}function YY(e,t){return $W(e.getUTCMilliseconds(),t,3)}function XY(e,t){return YY(e,t)+"000"}function ZY(e,t){return $W(e.getUTCMonth()+1,t,2)}function qY(e,t){return $W(e.getUTCMinutes(),t,2)}function KY(e,t){return $W(e.getUTCSeconds(),t,2)}function QY(e){var t=e.getUTCDay();return 0===t?7:t}function $Y(e,t){return $W(BW.count(VW(e)-1,e),t,2)}function JY(e){var t=e.getUTCDay();return t>=4||0===t?UW(e):UW.ceil(e)}function eX(e,t){return e=JY(e),$W(UW.count(VW(e),e)+(4===VW(e).getUTCDay()),t,2)}function tX(e){return e.getUTCDay()}function nX(e,t){return $W(jW.count(VW(e)-1,e),t,2)}function rX(e,t){return $W(e.getUTCFullYear()%100,t,2)}function iX(e,t){return $W((e=JY(e)).getUTCFullYear()%100,t,2)}function oX(e,t){return $W(e.getUTCFullYear()%1e4,t,4)}function aX(e,t){var n=e.getUTCDay();return $W((e=n>=4||0===n?UW(e):UW.ceil(e)).getUTCFullYear()%1e4,t,4)}function sX(){return"+0000"}function uX(){return"%"}function cX(e){return+e}function lX(e){return Math.floor(+e/1e3)}!function(e){YW=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,c=eY(i),l=tY(i),h=eY(o),f=tY(o),p=eY(a),d=tY(a),v=eY(s),g=tY(s),m=eY(u),y=tY(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:SY,e:SY,f:CY,g:zY,G:jY,H:EY,I:AY,j:TY,L:wY,m:kY,M:MY,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:cX,s:lX,S:PY,u:IY,U:RY,V:LY,w:NY,W:DY,x:null,X:null,y:FY,Y:BY,Z:UY,"%":uX},b={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:VY,e:VY,f:XY,g:iX,G:aX,H:GY,I:HY,j:WY,L:YY,m:ZY,M:qY,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:cX,s:lX,S:KY,u:QY,U:$Y,V:eX,w:tX,W:nX,x:null,X:null,y:rX,Y:oX,Z:sX,"%":uX},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:fY,e:fY,f:yY,g:uY,G:sY,H:dY,I:dY,j:pY,L:mY,m:hY,M:vY,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:lY,Q:bY,s:xY,S:gY,u:rY,U:iY,V:oY,w:nY,W:aY,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:uY,Y:sY,Z:cY,"%":_Y};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=ZW[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function E(e,t){return function(n){var r,i,o=WW(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=HW(WW(o.y,0,1))).getUTCDay(),r=i>4||0===i?jW.ceil(r):jW(r),r=FW.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=GW(WW(o.y,0,1))).getDay(),r=i>4||0===i?OW.ceil(r):OW(r),r=PW.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?HW(WW(o.y,0,1)).getUTCDay():GW(WW(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,HW(o)):GW(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in ZW?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=S(n,_),_.X=S(r,_),_.c=S(t,_),b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),{format:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=E(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=E(e+="",!0);return t.toString=function(){return e},t}}}(e),XW=YW.format,YW.parse,YW.utcFormat,YW.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var hX,fX;function pX(e){return new Date(e)}function dX(e){return e instanceof Date?+e:+new Date(+e)}function vX(e,t,n,r,i,o,a,s,u){var c=XH(jH,jH),l=c.invert,h=c.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=eH((function(e){return e[2]})).right(b,o);a===b.length?(i=cH(n/31536e6,r/31536e6,t),t=e):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(cH(n,r,t),1),t=s)}return null==i?t:t.every(i)}return c.invert=function(e){return new Date(l(e))},c.domain=function(e){return arguments.length?h(LH.call(e,dX)):h().map(pX)},c.ticks=function(e,t){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},c.tickFormat=function(e,t){return null==t?x:u(t)},c.nice=function(e,t){var n=h();return(e=S(e,n[0],n[n.length-1],t))?h(hW(n,e)):c},c.copy=function(){return WH(c,vX(e,t,n,r,i,o,a,s,u))},c}function gX(){var e,t,n,r,i,o=0,a=1,s=jH,u=!1;function c(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return c.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),c):[o,a]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),c}}function mX(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function yX(){var e,t,n,r,i,o,a,s=0,u=.5,c=1,l=jH,h=!1;function f(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),l(h?Math.max(0,Math.min(1,e)):e))}return f.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(c=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f):[s,u,c]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(l=e,f):l},f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return o=a,e=a(s),t=a(u),n=a(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f}}var _X,bX,xX=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,SX=(f(f(f(f(f(f(f(f(f(f(hX={},oN.LINEAR,(function e(){var t=XH(jH,jH);return t.copy=function(){return WH(t,e())},CH.apply(t,arguments),lW(t)})),oN.POWER,(function e(){var t=SW(YH());return t.copy=function(){return WH(t,e()).exponent(t.exponent())},CH.apply(t,arguments),t})),oN.LOG,(function e(){var t=yW(YH()).domain([1,10]);return t.copy=function(){return WH(t,e()).base(t.base())},CH.apply(t,arguments),t})),oN.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e().unknown(n)},i})),oN.SEQUENTIAL,(function e(){var t=lW(gX()(jH));return t.copy=function(){return mX(t,e())},kH.apply(t,arguments)})),oN.TIME,(function(){return CH.apply(vX(DW,NW,RW,PW,MW,kW,CW,wW,XW).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),oN.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=lH(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[tH(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(JG),o()},a.range=function(e){return arguments.length?(r=NH.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},CH.apply(a,arguments)})),oN.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[tH(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=NH.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},CH.apply(lW(s),arguments)})),oN.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[tH(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=NH.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=NH.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},CH.apply(o,arguments)})),oN.CAT,FH),f(hX,oN.DIVERGING,(function e(){var t=lW(yX()(jH));return t.copy=function(){return mX(t,e())},kH.apply(t,arguments)}))),EX=Ce()(fX=function(){return l((function e(){s(this,e),f(this,"scaleOptions",{})}),[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",o(x().mark((function t(){var i,o,a;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(tN.ScaleInitStart,Vk.INIT),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:e.log(tN.ScaleInitEnd,Vk.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=o(x().mark((function t(i){var o,a;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(tN.ScaleInitStart,Vk.UPDATE),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=e.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),e.log(tN.ScaleInitEnd,Vk.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale;r.names=n.parseFields(e.scale.field||[]);var i=[];r.names.forEach((function(r){var o;i.push(n.createScale(r,e.name,null===(o=e.scale)||void 0===o?void 0:o.values,t))})),i.some((function(e){return e.type===aN.VARIABLE}))?(r.type=aN.VARIABLE,i.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case oN.LOG:case oN.LINEAR:case oN.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case oN.QUANTILE:case oN.QUANTIZE:case oN.THRESHOLD:e.scale.range(r.values);break;case oN.IDENTITY:break;case oN.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case oN.DIVERGING:case oN.SEQUENTIAL:e.scale.interpolator(gH(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=aN.CONSTANT,r.defaultValues=i.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=i.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:PF(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,o,a=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:aN.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=FH([e]),s.type=aN.CONSTANT),s;var u=null===(o=r.find((function(t){return!VP(t[e])})))||void 0===o?void 0:o[e];if(this.isNumber(e)||VP(u)&&!a)s.scale=FH([e]),s.type=aN.CONSTANT;else{var c=a&&a.type||this.getDefaultType(u);"text"===n&&(c=oN.CAT);var l=this.createScaleConfig(c,e,a,r);s.scale=this.createDefaultScale(l),s.option=l}return s}},{key:"getDefaultType",value:function(e){var t=oN.LINEAR;return"string"==typeof e&&(t=xX.test(e)?oN.TIME:oN.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i={type:e},o=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(e===oN.CAT||e===oN.IDENTITY)i.domain=RR(o);else if(e===oN.QUANTILE)i.domain=o;else if(e===oN.DIVERGING){var a=rH(o),s=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(a[0]+a[1])/2;i.domain=[a[0],s,a[1]]}else i.domain=rH(o);return _(_({},i),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=SX[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}])}())||fX,AX=Ce()(_X=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(_({},e.layerModel.getAnimateUniforms()))}))}))}}])}())||_X,TX=Ce()(bX=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t,n=e.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!e.tileLayer&&r&&r.length>0&&((t=e.masks).push.apply(t,T(r)),e.updateLayerConfig({mask:i}))}))}}])}())||bX,wX=function(){return l((function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;s(this,e),f(this,"tileResource",new Map),f(this,"rendererService",void 0),f(this,"layerService",void 0),f(this,"parent",void 0),f(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}),[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"getVisibleTileByBox",value:function(e,t){return this.layerTiles.filter((function(n){return n.isLoaded&&n.visible&&n.boxInBounds(e,t)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);null==t||t.updateVisible(e.isVisible)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.some((function(e){var n=t.getTile(null==e?void 0:e.key);return!1===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(e=o(x().mark((function e(){var t,n,r=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,T(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,T(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]);var e}(),CX=O((function(e,t){e.exports=function(){
/**
       * splaytree v3.1.2
       * Fast Splay tree for Node and browser
       *
       * @author Alexander Milevski <info@w8r.name>
       * @license MIT
       * @preserve
       */
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation. All rights reserved.
      Licensed under the Apache License, Version 2.0 (the "License"); you may not use
      this file except in compliance with the License. You may obtain a copy of the
      License at http://www.apache.org/licenses/LICENSE-2.0

      THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
      KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
      WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
      MERCHANTABLITY OR NON-INFRINGEMENT.

      See the Apache Version 2.0 License for specific language governing permissions
      and limitations under the License.
      ***************************************************************************** */
function e(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var t=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function n(e,t){return e>t?1:e<t?-1:0}function r(e,n,r){for(var i=new t(null,null),o=i,a=i;;){var s=r(e,n.key);if(s<0){if(null===n.left)break;if(r(e,n.left.key)<0){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}a.left=n,a=n,n=n.left}else{if(!(s>0))break;if(null===n.right)break;if(r(e,n.right.key)>0&&(u=n.right,n.right=u.left,u.left=n,null===(n=u).right))break;o.right=n,o=n,n=n.right}}return o.right=n.left,a.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,n,i,o){var a=new t(e,n);if(null===i)return a.left=a.right=null,a;var s=o(e,(i=r(e,i,o)).key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(e,t,n){var i=null,o=null;if(t){var a=n((t=r(e,t,n)).key,e);0===a?(i=t.left,o=t.right):a<0?(o=t.right,t.right=null,i=t):(i=t.left,t.left=null,o=t)}return{left:i,right:o}}var a=function(){function a(e){void 0===e&&(e=n),this._root=null,this._size=0,this._comparator=e}return a.prototype.insert=function(e,t){return this._size++,this._root=i(e,t,this._root,this._comparator)},a.prototype.add=function(e,n){var i=new t(e,n);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=r(e,this._root,o),s=o(e,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},a.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},a.prototype._remove=function(e,t,n){var i;return null===t?null:0===n(e,(t=r(e,t,n)).key)?(null===t.left?i=t.right:(i=r(e,t.left,n)).right=t.right,this._size--,i):t},a.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=r(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},a.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},a.prototype.find=function(e){return this._root&&(this._root=r(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},a.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},a.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},a.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},a.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},a.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},a.prototype.min=function(){return this._root?this.minNode(this._root).key:null},a.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},a.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},a.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},a.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},a.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},a.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},a.prototype.clear=function(){return this._root=null,this._size=0,this},a.prototype.toList=function(){return function(e){for(var n=e,r=[],i=!1,o=new t(null,null),a=o;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=a=a.next=r.pop()).right:i=!0;return a.next=null,o.next}(this._root)},a.prototype.load=function(e,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=e.length,o=this._comparator;if(r&&function e(t,n,r,i,o){if(!(r>=i)){for(var a=t[r+i>>1],s=r-1,u=i+1;;){do{s++}while(o(t[s],a)<0);do{u--}while(o(t[u],a)>0);if(s>=u)break;var c=t[s];t[s]=t[u],t[u]=c,c=n[s],n[s]=n[u],n[u]=c}e(t,n,r,u,o),e(t,n,u+1,i,o)}}(e,n,0,i-1,o),null===this._root)this._root=function e(n,r,i,o){var a=o-i;if(a>0){var s=i+Math.floor(a/2),u=n[s],c=r[s],l=new t(u,c);return l.left=e(n,r,i,s),l.right=e(n,r,s+1,o),l}return null}(e,n,0,i),this._size=i;else{var a=function(e,n,r){for(var i=new t(null,null),o=i,a=e,s=n;null!==a&&null!==s;)r(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,o=0;o<e.length;o++)i=i.next=new t(e[o],n[o]);return i.next=null,r.next}(e,n),o);i=this._size+i,this._root=function e(t,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=e(t,n,o),s=t.head;return s.left=a,t.head=t.head.next,s.right=e(t,o+1,r),s}return null}({head:a},0,i)}return this},a.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),a.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return function e(t,n,r,i,o){if(t){i(n+(r?"âââ ":"âââ ")+o(t)+"\n");var a=n+(r?"    ":"â   ");t.left&&e(t.left,a,!1,i,o),t.right&&e(t.right,a,!0,i,o)}}(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},a.prototype.update=function(e,t,n){var a=this._comparator,s=o(e,this._root,a),u=s.left,c=s.right;a(e,t)<0?c=i(t,n,c,a):u=i(t,n,u,a),this._root=function(e,t,n){return null===t?e:(null===e||((t=r(e.key,t,n)).left=e),t)}(u,c,a)},a.prototype.split=function(e){return o(e,this._root,this._comparator)},a.prototype[Symbol.iterator]=function(){var t,n,r;return e(this,(function(e){switch(e.label){case 0:t=this._root,n=[],r=!1,e.label=1;case 1:return r?[3,6]:null===t?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return 0===n.length?[3,4]:[4,t=n.pop()];case 3:return e.sent(),t=t.right,[3,5];case 4:r=!0,e.label=5;case 5:return[3,1];case 6:return[2]}}))},a}();const s=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,u=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}};let c=Number.EPSILON;void 0===c&&(c=Math.pow(2,-52));const l=c*c,h=(e,t)=>{if(-c<e&&e<c&&-c<t&&t<c)return 0;const n=e-t;return n*n<l*e*t?0:e<t?-1:1};class f{constructor(){this.tree=new a,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===h(t.key,n.key))return this.tree.remove(e),n.key;const r=this.tree.next(t);return null!==r&&0===h(t.key,r.key)?(this.tree.remove(e),r.key):e}}const p=new class{constructor(){this.reset()}reset(){this.xRounder=new f,this.yRounder=new f}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}};function d(e,t,n,r,i){let o,a,s,u,c=t[0],l=r[0],h=0,f=0;l>c==l>-c?(o=c,c=t[++h]):(o=l,l=r[++f]);let p=0;if(h<e&&f<n)for(l>c==l>-c?(a=c+o,s=o-(a-c),c=t[++h]):(a=l+o,s=o-(a-l),l=r[++f]),o=a,0!==s&&(i[p++]=s);h<e&&f<n;)l>c==l>-c?(a=o+c,u=a-o,s=o-(a-u)+(c-u),c=t[++h]):(a=o+l,u=a-o,s=o-(a-u)+(l-u),l=r[++f]),o=a,0!==s&&(i[p++]=s);for(;h<e;)a=o+c,u=a-o,s=o-(a-u)+(c-u),c=t[++h],o=a,0!==s&&(i[p++]=s);for(;f<n;)a=o+l,u=a-o,s=o-(a-u)+(l-u),l=r[++f],o=a,0!==s&&(i[p++]=s);return 0===o&&0!==p||(i[p++]=o),p}function v(e){return new Float64Array(e)}const g=v(4),m=v(8),y=v(12),_=v(16),b=v(4);function x(e,t,n,r,i,o){const a=(t-o)*(n-i),s=(e-i)*(r-o),u=a-s,c=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*c?u:-function(e,t,n,r,i,o,a){let s,u,c,l,h,f,p,v,x,S,E,A,T,w,C,k,M,P;const I=e-i,R=n-i,O=t-o,L=r-o;w=I*L,f=134217729*I,p=f-(f-I),v=I-p,f=134217729*L,x=f-(f-L),S=L-x,C=v*S-(w-p*x-v*x-p*S),k=O*R,f=134217729*O,p=f-(f-O),v=O-p,f=134217729*R,x=f-(f-R),S=R-x,M=v*S-(k-p*x-v*x-p*S),E=C-M,h=C-E,g[0]=C-(E+h)+(h-M),A=w+E,h=A-w,T=w-(A-h)+(E-h),E=T-k,h=T-E,g[1]=T-(E+h)+(h-k),P=A+E,h=P-A,g[2]=A-(P-h)+(E-h),g[3]=P;let N=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,g),D=22204460492503146e-32*a;if(N>=D||-N>=D)return N;if(h=e-I,s=e-(I+h)+(h-i),h=n-R,c=n-(R+h)+(h-i),h=t-O,u=t-(O+h)+(h-o),h=r-L,l=r-(L+h)+(h-o),0===s&&0===u&&0===c&&0===l)return N;if(D=11093356479670487e-47*a+33306690738754706e-32*Math.abs(N),N+=I*l+L*s-(O*c+R*u),N>=D||-N>=D)return N;w=s*L,f=134217729*s,p=f-(f-s),v=s-p,f=134217729*L,x=f-(f-L),S=L-x,C=v*S-(w-p*x-v*x-p*S),k=u*R,f=134217729*u,p=f-(f-u),v=u-p,f=134217729*R,x=f-(f-R),S=R-x,M=v*S-(k-p*x-v*x-p*S),E=C-M,h=C-E,b[0]=C-(E+h)+(h-M),A=w+E,h=A-w,T=w-(A-h)+(E-h),E=T-k,h=T-E,b[1]=T-(E+h)+(h-k),P=A+E,h=P-A,b[2]=A-(P-h)+(E-h),b[3]=P;const F=d(4,g,4,b,m);w=I*l,f=134217729*I,p=f-(f-I),v=I-p,f=134217729*l,x=f-(f-l),S=l-x,C=v*S-(w-p*x-v*x-p*S),k=O*c,f=134217729*O,p=f-(f-O),v=O-p,f=134217729*c,x=f-(f-c),S=c-x,M=v*S-(k-p*x-v*x-p*S),E=C-M,h=C-E,b[0]=C-(E+h)+(h-M),A=w+E,h=A-w,T=w-(A-h)+(E-h),E=T-k,h=T-E,b[1]=T-(E+h)+(h-k),P=A+E,h=P-A,b[2]=A-(P-h)+(E-h),b[3]=P;const z=d(F,m,4,b,y);w=s*l,f=134217729*s,p=f-(f-s),v=s-p,f=134217729*l,x=f-(f-l),S=l-x,C=v*S-(w-p*x-v*x-p*S),k=u*c,f=134217729*u,p=f-(f-u),v=u-p,f=134217729*c,x=f-(f-c),S=c-x,M=v*S-(k-p*x-v*x-p*S),E=C-M,h=C-E,b[0]=C-(E+h)+(h-M),A=w+E,h=A-w,T=w-(A-h)+(E-h),E=T-k,h=T-E,b[1]=T-(E+h)+(h-k),P=A+E,h=P-A,b[2]=A-(P-h)+(E-h),b[3]=P;const B=d(z,y,4,b,_);return _[B-1]}(e,t,n,r,i,o,c)}const S=(e,t)=>e.x*t.y-e.y*t.x,E=(e,t)=>e.x*t.x+e.y*t.y,A=(e,t,n)=>{const r=x(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},T=e=>Math.sqrt(E(e,e)),w=(e,t,n)=>{const r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return S(i,r)/T(i)/T(r)},C=(e,t,n)=>{const r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return E(i,r)/T(i)/T(r)},k=(e,t,n)=>0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n},M=(e,t,n)=>0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)};class P{static compare(e,t){const n=P.comparePoints(e.point,t.point);return 0!==n?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:R.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(void 0===n.segment.consumedBy)for(let r=t+1;r<e;r++){const e=this.point.events[r];void 0===e.consumedBy&&n.otherSE.point.events===e.otherSE.point.events&&n.segment.consume(e.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){const t=new Map,n=n=>{const r=n.otherSE;t.set(n,{sine:w(this.point,e.point,r.point),cosine:C(this.point,e.point,r.point)})};return(e,r)=>{t.has(e)||n(e),t.has(r)||n(r);const{sine:i,cosine:o}=t.get(e),{sine:a,cosine:s}=t.get(r);return i>=0&&a>=0?o<s?1:o>s?-1:0:i<0&&a<0?o<s?-1:o>s?1:0:a<i?-1:a>i?1:0}}}let I=0;class R{static compare(e,t){const n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;const a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,c=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;const n=e.comparePoint(t.leftSE.point);if(n<0)return 1;if(n>0)return-1;const r=t.comparePoint(e.rightSE.point);return 0!==r?r:-1}if(n>r){if(a<s&&a<c)return-1;if(a>s&&a>c)return 1;const n=t.comparePoint(e.leftSE.point);if(0!==n)return n;const r=e.comparePoint(t.rightSE.point);return r<0?1:r>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){const n=t.comparePoint(e.rightSE.point);if(0!==n)return n}if(i>o){const n=e.comparePoint(t.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(i!==o){const e=u-a,t=i-n,l=c-s,h=o-r;if(e>t&&l<h)return 1;if(e<t&&l>h)return-1}return i>o?1:i<o||u<c?-1:u>c?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,r){this.id=++I,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=r}static fromRing(e,t,n){let r,i,o;const a=P.comparePoints(e,t);if(a<0)r=e,i=t,o=1;else{if(!(a>0))throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);r=t,i=e,o=-1}const s=new P(r,!0),u=new P(i,!1);return new R(s,u,[n],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;const a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),r=u(t,n);if(null===r)return null;const i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,c=e.rightSE.point,l=s(t,a)&&0===this.comparePoint(a),h=s(n,i)&&0===e.comparePoint(i),f=s(t,c)&&0===this.comparePoint(c),d=s(n,o)&&0===e.comparePoint(o);if(h&&l)return d&&!f?o:!d&&f?c:null;if(h)return f&&i.x===c.x&&i.y===c.y?null:i;if(l)return d&&o.x===a.x&&o.y===a.y?null:a;if(d&&f)return null;if(d)return o;if(f)return c;const v=((e,t,n,r)=>{if(0===t.x)return M(n,r,e.x);if(0===r.x)return M(e,t,n.x);if(0===t.y)return k(n,r,e.y);if(0===r.y)return k(e,t,n.y);const i=S(t,r);if(0==i)return null;const o={x:n.x-e.x,y:n.y-e.y},a=S(o,t)/i,s=S(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}})(i,this.vector(),a,e.vector());return null===v?null:s(r,v)?p.round(v.x,v.y):null}split(e){const t=[],n=void 0!==e.events,r=new P(e,!0),i=new P(e,!1),o=this.rightSE;this.replaceRightSE(i),t.push(i),t.push(r);const a=new R(r,o,this.rings.slice(),this.windings.slice());return P.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),P.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),i.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const r=R.compare(t,n);if(0!==r){if(r>0){const e=t;t=n,n=e}if(t.prev===n){const e=t;t=n,n=e}for(let e=0,r=n.rings.length;e<r;e++){const r=n.rings[e],i=n.windings[e],o=t.rings.indexOf(r);-1===o?(t.rings.push(r),t.windings.push(i)):t.windings[o]+=i}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let e=0,r=this.rings.length;e<r;e++){const r=this.rings[e],i=this.windings[e],o=t.indexOf(r);-1===o?(t.push(r),n.push(i)):n[o]+=i}const i=[],o=[];for(let e=0,r=t.length;e<r;e++){if(0===n[e])continue;const r=t[e],a=r.poly;if(-1===o.indexOf(a))if(r.isExterior)i.push(a);else{-1===o.indexOf(a)&&o.push(a);const e=i.indexOf(r.poly);-1!==e&&i.splice(e,1)}}for(let e=0,t=i.length;e<t;e++){const t=i[e].multiPoly;-1===r.indexOf(t)&&r.push(t)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(V.type){case"union":{const n=0===e.length,r=0===t.length;this._isInResult=n!==r;break}case"intersection":{let n,r;e.length<t.length?(n=e.length,r=t.length):(n=t.length,r=e.length),this._isInResult=r===V.numMultiPolys&&n<r;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2==1;break}case"difference":{const n=e=>1===e.length&&e[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error("Unrecognized operation type found "+V.type)}return this._isInResult}}class O{constructor(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=p.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let t=1,n=e.length;t<n;t++){if("number"!=typeof e[t][0]||"number"!=typeof e[t][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let n=p.round(e[t][0],e[t][1]);n.x===i.x&&n.y===i.y||(this.segments.push(R.fromRing(i,n,this)),n.x<this.bbox.ll.x&&(this.bbox.ll.x=n.x),n.y<this.bbox.ll.y&&(this.bbox.ll.y=n.y),n.x>this.bbox.ur.x&&(this.bbox.ur.x=n.x),n.y>this.bbox.ur.y&&(this.bbox.ur.y=n.y),i=n)}r.x===i.x&&r.y===i.y||this.segments.push(R.fromRing(i,r,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}}class L{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new O(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,n=e.length;t<n;t++){const n=new O(e[t],this,!1);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const n=this.interiorRings[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class N{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let t=0,n=e.length;t<n;t++){const n=new L(e[t],this);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class D{static factory(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(!r.isInResult()||r.ringOut)continue;let i=null,o=r.leftSE,a=r.rightSE;const s=[o],u=o.point,c=[];for(;i=o,o=a,s.push(o),o.point!==u;)for(;;){const e=o.getAvailableLinkedEvents();if(0===e.length){const e=s[0].point,t=s[s.length-1].point;throw new Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(1===e.length){a=e[0].otherSE;break}let n=null;for(let e=0,t=c.length;e<t;e++)if(c[e].point===o.point){n=e;break}if(null!==n){const e=c.splice(n)[0],r=s.splice(e.index);r.unshift(r[0].otherSE),t.push(new D(r.reverse()));continue}c.push({index:s.length,point:o.point});const r=o.getLeftmostComparator(i);a=e.sort(r)[0].otherSE;break}t.push(new D(s))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let n=1,r=this.events.length-1;n<r;n++){const r=this.events[n].point,i=this.events[n+1].point;0!==A(r,e,i)&&(t.push(r),e=r)}if(1===t.length)return null;const n=t[0],r=t[1];0===A(n,e,r)&&t.shift(),t.push(t[0]);const i=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,s=[];for(let e=o;e!=a;e+=i)s.push([t[e].x,t[e].y]);return s}isExteriorRing(){if(void 0===this._isExteriorRing){const e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,n=this.events.length;t<n;t++){const n=this.events[t];P.compare(e,n)>0&&(e=n)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class F{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const n=this.interiorRings[t].getGeom();null!==n&&e.push(n)}return e}}class z{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getGeom();null!==n&&e.push(n)}return e}_composePolys(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(!r.poly)if(r.isExteriorRing())t.push(new F(r));else{const e=r.enclosingRing();e.poly||t.push(new F(e)),e.poly.addInterior(r)}}return t}}class B{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.compare;this.queue=e,this.tree=new a(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let i=r,o=r,a=void 0,s=void 0;for(;void 0===a;)i=this.tree.prev(i),null===i?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)o=this.tree.next(o),null===o?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){let r=null;if(a){const e=a.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(r=e),!a.isAnEndpoint(e))){const t=this._splitSafely(a,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}let i=null;if(s){const e=s.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(i=e),!s.isAnEndpoint(e))){const t=this._splitSafely(s,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}if(null!==r||null!==i){let e=null;e=null===r?i:null===i||P.comparePoints(r,i)<=0?r:i,this.queue.remove(t.rightSE),n.push(t.rightSE);const o=t.split(e);for(let e=0,t=o.length;e<t;e++)n.push(o[e])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){const e=a.getIntersection(s);if(null!==e){if(!a.isAnEndpoint(e)){const t=this._splitSafely(a,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}if(!s.isAnEndpoint(e)){const t=this._splitSafely(s,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}}const j="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,U="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,V=new class{run(e,t,n){V.type=e,p.reset();const r=[new N(t,!0)];for(let e=0,t=n.length;e<t;e++)r.push(new N(n[e],!1));if(V.numMultiPolys=r.length,"difference"===V.type){const e=r[0];let t=1;for(;t<r.length;)null!==u(r[t].bbox,e.bbox)?t++:r.splice(t,1)}if("intersection"===V.type)for(let e=0,t=r.length;e<t;e++){const t=r[e];for(let n=e+1,i=r.length;n<i;n++)if(null===u(t.bbox,r[n].bbox))return[]}const i=new a(P.compare);for(let e=0,t=r.length;e<t;e++){const t=r[e].getSweepEvents();for(let e=0,n=t.length;e<n;e++)if(i.insert(t[e]),i.size>j)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new B(i);let s=i.size,c=i.pop();for(;c;){const e=c.key;if(i.size===s){const t=e.segment;throw new Error(`Unable to pop() ${e.isLeft?"left":"right"} SweepEvent [${e.point.x}, ${e.point.y}] from segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] from queue.`)}if(i.size>j)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>U)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const t=o.process(e);for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0===n.consumedBy&&i.insert(n)}s=i.size,c=i.pop()}p.reset();const l=D.factory(o.segments);return new z(l).getGeom()}};return{union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V.run("difference",e,n)}}}()}));function kX(e,t,n){void 0===n&&(n={});var r=QN(e),i=QN(t),o=CX.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?Oy(o[0],n.properties):function(e,t,n){return void 0===n&&(n={}),Ry({type:"MultiPolygon",coordinates:e},t,n)}(o,n.properties)}var MX=function(){return l((function e(){s(this,e)}),[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=Oy(e.coordinates);t=null===t?n:kX(t,n)})),n&&(t.properties=_({},n)),t}}])}(),PX=function(){return l((function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;s(this,e),f(this,"layerService",void 0),f(this,"tileLayerService",void 0),f(this,"tileSourceService",void 0),f(this,"parent",void 0),f(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new MX}),[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pickBoxSelectTiles",value:function(e,t){var n=E(e,4),r=n[0],i=n[1],o=n[2],a=n[3],s=t.unproject({x:r,y:i}),u=t.unproject({x:o,y:a});this.tileLayerService.getVisibleTileByBox(s,u).forEach((function(e){var t=e.getMainLayer();null==t||t.layerPickService.pickRender(s)}))}},{key:"pick",value:function(e,t){var n=this.parent.getContainer().get(Oe.IPickingService);if("RasterLayer"===e.type){var r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r&&void 0!==r.getMainLayer()){var i=r.getMainLayer();return i.layerPickService.pickRasterLayer(i,t,this.parent)}return!1}return this.pickRender(t),n.pickFromPickingFBO(e,t)}},{key:"selectFeature",value:function(e){var t=E(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set("select",o),this.updateHighLight(n,r,i,"select")}},{key:"highlightPickedFeature",value:function(e){var t=E(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set("active",o),this.updateHighLight(n,r,i,"active")}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case"select":null==o||o.hooks.beforeSelect.call([e,t,n]);break;case"active":null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get("select"),t=this.tilePickID.get("active");if(e){var n=E(this.pickId2Color(e),3),r=n[0],i=n[1],o=n[2];this.updateHighLight(r,i,o,"select")}else if(t){var a=E(this.pickId2Color(t),3),s=a[0],u=a[1],c=a[2];this.updateHighLight(s,u,c,"active")}else;}},{key:"color2PickId",value:function(e,t,n){return mv(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return yv(e)}},{key:"getFeatureById",value:function(e,t){var n=this.tileLayerService.getTiles().filter((function(e){return e.visible})),r=[];return n.forEach((function(n){r.push.apply(r,T(n.getFeatureById(e,t)))})),r}},{key:"pickRasterLayer",value:function(e,t,n){return!1}}])}(),IX=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function RX(e){return"PolygonLayer"===e?vG:"LineLayer"===e?zV:lG}function OX(e){return-1!==["PolygonLayer","LineLayer"].indexOf(e)}var LX=function(){return l((function e(t,n){s(this,e),f(this,"x",void 0),f(this,"y",void 0),f(this,"z",void 0),f(this,"key",void 0),f(this,"parent",void 0),f(this,"sourceTile",void 0),f(this,"visible",!0),f(this,"layers",[]),f(this,"isLoaded",!1),f(this,"tileMaskLayers",[]),f(this,"tileMask",void 0),this.parent=n,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}),[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=E(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"boxInBounds",value:function(e,t){var n=E(this.sourceTile.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3],s=e.lng,u=e.lat,c=t.lng,l=t.lat;return r>=s&&o<=c&&i>=u&&a<=l||r<=s&&o>=s||r<=c&&o>=c||i<=u&&a>=u||i<=l&&a>=l}},{key:"getLayerOptions",value:function(){var e,t=this.parent.getLayerConfig();return _(_({},t),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:OX(this.parent.type),mask:t.mask||0!==(null===(e=t.maskLayers)||void 0===e?void 0:e.length)&&t.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(n=o(x().mark((function e(){var t,n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new vG({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=ZL(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addMask",value:(t=o(x().mark((function e(t,n){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ZL(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addLayer",value:(e=o(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=ZL(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(f({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]);var e,t,n}(),NX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new zV).source(t.data,t.options).size(1).shape("line").color("red"),i=new lG({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]);var n}(LX),DX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new mV(_({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]);var n}(LX),FX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new kG(_({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]);var n}(LX),zX=["rasterData"],BX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new xG(_({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=b(t,zX);return{data:n,options:{parser:_({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]);var n}(LX),jX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new xG(_({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]);var n}(LX),UX=["rasterData"],VX={positions:[0,1],colors:["#000","#fff"]},GX=function(e){function t(){var e;s(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return f(e=a(this,t,[].concat(r)),"colorTexture",void 0),e}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i,o,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new xG(_(_({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;s[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=b(t,UX);return{data:n,options:{parser:_({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?VX:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||Tv(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]);var n}(LX),HX=function(e){function t(){return s(this,t),a(this,t,arguments)}return v(t,e),l(t,[{key:"initTileLayer",value:(n=o(x().mark((function e(){var t,n,r,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=RX(this.parent.type),i=this.getSourceOption()){e.next=7;break}return this.isLoaded=!0,e.abrupt("return");case 7:return o=new r(_({},n)).source(i.data,i.options),Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=11,this.addLayer(o);case 11:n.tileMask,this.setLayerMinMaxZoom(o),this.isLoaded=!0;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n=this.getMainLayer();if(!n)return[];var r=n.getSource(),i=aP(r.data.dataArray.filter((function(t){return t._id===e})));if(0===i.length)return i;if("geojson"===r.parser.type){var o=i.map((function(e){var n=e[t],i=r.originData.features.find((function(e){return e[t]===n||e.properties[t]===n})),o=aP(i);return delete e.coordinates,o.properties=e,o}));return o}return i}}]);var n}(LX);function WX(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return HX;case"TileDebugLayer":return NX;case"MaskLayer":return FX;case"RasterLayer":switch(e.getSource().parser.dataType){case lN.RGB:case lN.CUSTOMRGB:return BX;case lN.ARRAYBUFFER:case lN.CUSTOMARRAYBUFFER:return GX;case lN.TERRAINRGB:case lN.CUSTOMTERRAINRGB:return jX;default:return DX}default:return HX}}var YX,XX,ZX,qX=function(){return l((function e(t){var n=this;s(this,e),f(this,"parent",void 0),f(this,"tileLayerService",void 0),f(this,"mapService",void 0),f(this,"layerService",void 0),f(this,"rendererService",void 0),f(this,"pickingService",void 0),f(this,"tilePickService",void 0),f(this,"tilesetManager",void 0),f(this,"initedTileset",!1),f(this,"lastViewStates",void 0),f(this,"mapchange",(function(){var e,t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))})),f(this,"viewchange",mS(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(Oe.IRendererService),this.layerService=r.get(Oe.ILayerService),this.mapService=r.get(Oe.IMapService),this.pickingService=r.get(Oe.IPickingService),this.tileLayerService=new wX({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new PX({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}),[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r,this.getMap(),this.mapService.version)}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"getMap",value:function(){return this.mapService.map}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(e=o(x().mark((function e(){var t,n,r=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),e.next=6,Promise.all(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})).map(function(){var e=o(x().mark((function e(t){var n,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.tileLayerService.hasTile(t.key)){e.next=9;break}return n=WX(r.parent),i=new n(t,r.parent),e.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(t),r.layerService.reRender()),e.next=12;break;case 9:r.tileLayerService.updateTileVisible(t),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;IX.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]);var e}(),KX=Ce()(YX=function(){return l((function e(){s(this,e)}),[{key:"build",value:(n=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"initLayerModel",value:(t=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"prepareLayerModel",value:(e=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",o(x().mark((function n(){return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=4;break}return e.prepareBuildModel(),e.tileLayer=new qX(e),n.abrupt("return");case 4:return e.log(tN.BuildModelStart,Vk.INIT),n.next=7,t.initLayerModel(e);case 7:e.log(tN.BuildModelEnd,Vk.INIT);case 8:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=o(x().mark((function n(r){return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=5;break}return e.tileLayer=new qX(e),n.abrupt("return",!1);case 5:return e.log(tN.BuildModelStart,Vk.UPDATE),n.next=8,t.prepareLayerModel(e);case 8:return e.log(tN.BuildModelEnd,Vk.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]);var e,t,n}())||YX,QX=Ce()(XX=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}])}())||XX,$X=["type"],JX={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},eZ={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},tZ={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},nZ={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var rZ,iZ,oZ,aZ=Ce()(ZX=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(_({},(n={u_DirectionalLights:new Array(3).fill(_({},tZ)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(_({},nZ)),u_NumOfSpotLights:0},t&&t.length||(t=[eZ]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=b(e,$X),o=JX[r].lights,a=JX[r].num,s=n[a];n[o][s]=_(_({},n[o][s]),i),n[a]++})),n)));var t,n}))}))}}])}())||ZX,sZ=Ce()(rZ=function(){return l((function e(){s(this,e),f(this,"enabled",void 0)}),[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=Vj(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}])}())||rZ,uZ=1,cZ=2,lZ=Ce()(iZ=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e,t){var n=t.styleAttributeService;e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:sN.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:IP.FLOAT},size:3,update:function(e){var n=e.id;return t?yv(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:uZ})}))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:cZ})}))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?gv(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:mv(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:cZ,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o})}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?gv(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:mv(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:cZ,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o,u_CurrentSelectedId:t,u_SelectColor:a.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}])}())||iZ,hZ=["mvt","geojsonvt","testTile"];var fZ,pZ,dZ,vZ,gZ,mZ,yZ,_Z,bZ,xZ,SZ,EZ,AZ,TZ=Ce()(oZ=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return hZ.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:sN.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:IP.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(e){e.registerStyleAttribute({name:"filter",type:sN.Attribute,descriptor:{name:"filter",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e){return e.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:sN.Attribute,descriptor:{name:"a_Color",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:sN.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:IP.DYNAMIC_DRAW,data:[],type:IP.FLOAT},size:1,update:function(e,t){return[t]}}})}}])}())||oZ,wZ=(fZ=Ce(),pZ=we(Oe.ICameraService),dZ=we(Oe.ICoordinateSystemService),vZ=we(Oe.IRendererService),gZ=we(Oe.IMapService),fZ((_Z=n((yZ=function(){return l((function e(){s(this,e),g(this,"cameraService",_Z,this),g(this,"coordinateSystemService",bZ,this),g(this,"rendererService",xZ,this),g(this,"mapService",SZ,this)}),[{key:"resetLayerEncodeData",value:function(e){var t=this,n=this.mapService.map;if(n&&this.getIsMultiCoor()){this.mapZoom=n.getZoom();var r=function(){var r=o(x().mark((function r(){var i;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!((i=n.getZoom())<=12&&t.mapZoom>12)){r.next=5;break}return r.next=4,e.hooks.init.promise();case 4:t.mapZoom=i;case 5:if(!(i>12&&t.mapZoom<=12)){r.next=9;break}return r.next=8,e.hooks.init.promise();case 8:t.mapZoom=i;case 9:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();n.off("zoom",r),n.on("zoom",r)}}},{key:"apply",value:function(e){var t=this,n=this.mapService.version;this.resetLayerEncodeData(e);var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var o=e.getLayerConfig().tileOrigin,a=t.getIsMultiCoor()?"degree"===t.mapService.map.getCRS().unit?t.mapService.map.getCRS().extent:t.mapService.map.getCRS().getLngLatExtent():[];t.coordinateSystemService.refresh(o,a),"GAODE2.x"===n&&(t.setLayerCenter(e),r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var s=t.rendererService.getViewportSize(),u=s.width,c=s.height;e.models.forEach((function(n){var o;n.addUniforms((f(f(f(f(f(f(f(f(f(f(o={},eN.ProjectionMatrix,t.cameraService.getProjectionMatrix()),eN.ViewMatrix,t.cameraService.getViewMatrix()),eN.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),eN.Zoom,t.cameraService.getZoom()),eN.ZoomScale,t.cameraService.getZoomScale()),eN.FocalDistance,t.cameraService.getFocalDistance()),eN.CameraPosition,t.cameraService.getCameraPosition()),Uy.MultiCoor,t.getIsMultiCoor()),Uy.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),Uy.ViewportCenter,t.coordinateSystemService.getViewportCenter(t.mapService.map)),f(f(f(f(f(f(f(f(f(f(o,Uy.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),Uy.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),Uy.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),Uy.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),Uy.Mvp,r),"u_sceneCenterMercator",i),"u_ViewportSize",[u,c]),"u_ModelMatrix",t.cameraService.getModelMatrix()),"u_DevicePixelRatio",Ad.devicePixelRatio),"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),f(o,"u_shaderPick",Number(e.getShaderPickStat()))))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}},{key:"getIsMultiCoor",value:function(){return!!this.mapService.isMapBoxMapLibre()&&Ob(this.mapService.map)}}])}()).prototype,"cameraService",[pZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bZ=n(yZ.prototype,"coordinateSystemService",[dZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xZ=n(yZ.prototype,"rendererService",[vZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SZ=n(yZ.prototype,"mapService",[gZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mZ=yZ))||mZ),CZ=Ce()(EZ=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}])}())||EZ,kZ=Ce()(AZ=function(){return l((function e(){s(this,e)}),[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}])}())||AZ;GL.bind(Oe.ILayerPlugin).to($G).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(TZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(EX).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(QG).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(QX).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(TX).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(kZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(CZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(sZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(wZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(AX).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(aZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(lZ).inRequestScope(),GL.bind(Oe.ILayerPlugin).to(KX).inRequestScope(),sr({target:"String",proto:!0,forced:zE("link")},{link:function(e){return FE(this,"a","href",e)}}),cl("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}})),cl("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}})),cl("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),cl("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}})),cl("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var MZ={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},PZ="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",IZ={5:PZ,"5module":PZ+" export import",6:PZ+" const class extends export import super"},RZ=/^in(stanceof)?$/,OZ="ÂªÂµÂºÃ-ÃÃ-Ã¶Ã¸-ËË-ËË -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿ÎÎ-ÎÎÎ-Î¡Î£-ÏµÏ·-ÒÒ-Ô¯Ô±-ÕÕÕ -Ö×-×ª×¯-×²Ø -ÙÙ®Ù¯Ù±-ÛÛÛ¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ-Ü¯Ý-Þ¥Þ±ß-ßªß´ßµßºà -à à à ¤à ¨à¡-à¡à¡ -à¡ªà¢ -à¢´à¢¶-à£à¤-à¤¹à¤½à¥à¥-à¥¡à¥±-à¦à¦-à¦à¦à¦à¦-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§à§à§à§-à§¡à§°à§±à§¼à¨-à¨à¨à¨à¨-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©-à©à©à©²-à©´àª-àªàª-àªàª-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬-à¬à¬à¬à¬-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­à­à­-à­¡à­±à®à®-à®à®-à®à®-à®à®à®à®à®à®à®£à®¤à®¨-à®ªà®®-à®¹à¯à°-à°à°-à°à°-à°¨à°ª-à°¹à°½à±-à±à± à±¡à²à²-à²à²-à²à²-à²¨à²ª-à²³à²µ-à²¹à²½à³à³ à³¡à³±à³²à´-à´à´-à´à´-à´ºà´½àµàµ-àµàµ-àµ¡àµº-àµ¿à¶-à¶à¶-à¶±à¶³-à¶»à¶½à·-à·à¸-à¸°à¸²à¸³à¹-à¹àºàºàºàº-àºàº-àº£àº¥àº§-àº°àº²àº³àº½à»-à»à»à»-à»à¼à½-à½à½-à½¬à¾-à¾á-áªá¿á-áá-áá¡á¥á¦á®-á°áµ-ááá -áááá-áºá¼-áá-áá-ááá-áá -áá-áá-á°á²-áµá¸-á¾áá-áá-áá-áá-áá-áá-áá -áµá¸-á½á-á¬á¯-á¿á-áá -áªá®-á¸á-áá-áá -á±á-áá -á¬á®-á°á-á³ááá  -á¡¸á¢-á¢¨á¢ªá¢°-á£µá¤-á¤á¥-á¥­á¥°-á¥´á¦-á¦«á¦°-á§á¨-á¨á¨ -á©áª§á¬-á¬³á­-á­á®-á® á®®á®¯á®º-á¯¥á°-á°£á±-á±á±-á±½á²-á²á²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´-á¶¿á¸-á¼á¼-á¼á¼ -á½á½-á½á½-á½á½á½á½á½-á½½á¾-á¾´á¾¶-á¾¼á¾¾á¿-á¿á¿-á¿á¿-á¿á¿-á¿á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â-ââââ-âââ-ââ¤â¦â¨âª-â¹â¼-â¿â-âââ -ââ°-â°®â°°-â±â± -â³¤â³«-â³®â³²â³³â´-â´¥â´§â´­â´°-âµ§âµ¯â¶-â¶â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·-â·â·-â·â·-â·â·-â·ã-ãã¡-ã©ã±-ãµã¸-ã¼ã-ãã-ãã¡-ãºã¼-ã¿ã-ã¯ã±-ãã -ã¿ã°-ã¿ã-ä¶¿ä¸-é¿¼ê-êê-ê½ê-êê-êêªê«ê-ê®ê¿-êê -ê¯ê-êê¢-êê-ê¿ê-êêµ-ê ê -ê ê -ê ê -ê ¢ê¡-ê¡³ê¢-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤-ê¤¥ê¤°-ê¥ê¥ -ê¥¼ê¦-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨-ê¨¨ê©-ê©ê©-ê©ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«ê«ê«-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬ê¬-ê¬ê¬-ê¬ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­ê­-ê­©ê­°-ê¯¢ê°-í£í°-íí-í»ï¤-ï©­ï©°-ï«ï¬-ï¬ï¬-ï¬ï¬ï¬-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­ï­ï­ï­ï­-ï®±ï¯-ï´½ïµ-ï¶ï¶-ï·ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½ï½¦-ï¾¾ï¿-ï¿ï¿-ï¿ï¿-ï¿ï¿-ï¿",LZ="ââÂ·Ì-Í¯ÎÒ-ÒÖ-Ö½Ö¿×××××Ø-ØÙ-Ù©Ù°Û-ÛÛ-Û¤Û§Û¨Ûª-Û­Û°-Û¹ÜÜ°-ÝÞ¦-Þ°ß-ßß«-ß³ß½à -à à -à £à ¥-à §à ©-à ­à¡-à¡à£-à£¡à££-à¤à¤º-à¤¼à¤¾-à¥à¥-à¥à¥¢à¥£à¥¦-à¥¯à¦-à¦à¦¼à¦¾-à§à§à§à§-à§à§à§¢à§£à§¦-à§¯à§¾à¨-à¨à¨¼à¨¾-à©à©à©à©-à©à©à©¦-à©±à©µàª-àªàª¼àª¾-à«à«-à«à«-à«à«¢à«£à«¦-à«¯à«º-à«¿à¬-à¬à¬¼à¬¾-à­à­à­à­-à­à­-à­à­¢à­£à­¦-à­¯à®à®¾-à¯à¯-à¯à¯-à¯à¯à¯¦-à¯¯à°-à°à°¾-à±à±-à±à±-à±à±à±à±¢à±£à±¦-à±¯à²-à²à²¼à²¾-à³à³-à³à³-à³à³à³à³¢à³£à³¦-à³¯à´-à´à´»à´¼à´¾-àµàµ-àµàµ-àµàµàµ¢àµ£àµ¦-àµ¯à¶-à¶à·à·-à·à·à·-à·à·¦-à·¯à·²à·³à¸±à¸´-à¸ºà¹-à¹à¹-à¹àº±àº´-àº¼à»-à»à»-à»à¼à¼à¼ -à¼©à¼µà¼·à¼¹à¼¾à¼¿à½±-à¾à¾à¾à¾-à¾à¾-à¾¼à¿á«-á¾á-áá-áá-á á¢-á¤á§-á­á±-á´á-áá-áá-áá©-á±á-áá²-á´ááá²á³á´-ááá -á©á -á á -á á¢©á¤ -á¤«á¤°-á¤»á¥-á¥á§-á§á¨-á¨á©-á©á© -á©¼á©¿-áªáª-áªáª°-áª½áª¿á«á¬-á¬á¬´-á­á­-á­á­«-á­³á®-á®á®¡-á®­á®°-á®¹á¯¦-á¯³á°¤-á°·á±-á±á±-á±á³-á³á³-á³¨á³­á³´á³·-á³¹á·-á·¹á·»-á·¿â¿âââ-ââ¡â¥-â°â³¯-â³±âµ¿â· -â·¿ãª-ã¯ããê -ê©ê¯ê´-ê½êêê°ê±ê ê ê ê £-ê §ê ¬ê¢ê¢ê¢´-ê£ê£-ê£ê£ -ê£±ê£¿-ê¤ê¤¦-ê¤­ê¥-ê¥ê¦-ê¦ê¦³-ê§ê§-ê§ê§¥ê§°-ê§¹ê¨©-ê¨¶ê©ê©ê©ê©-ê©ê©»-ê©½êª°êª²-êª´êª·êª¸êª¾êª¿ê«ê««-ê«¯ê«µê«¶ê¯£-ê¯ªê¯¬ê¯­ê¯°-ê¯¹ï¬ï¸-ï¸ï¸ -ï¸¯ï¸³ï¸´ï¹-ï¹ï¼-ï¼ï¼¿",NZ=new RegExp("["+OZ+"]"),DZ=new RegExp("["+OZ+LZ+"]");OZ=LZ=null;var FZ=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],zZ=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function BZ(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function jZ(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&NZ.test(String.fromCharCode(e)):!1!==t&&BZ(e,FZ)))}function UZ(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&DZ.test(String.fromCharCode(e)):!1!==t&&(BZ(e,FZ)||BZ(e,zZ)))))}var VZ=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function GZ(e,t){return new VZ(e,{beforeExpr:!0,binop:t})}var HZ={beforeExpr:!0},WZ={startsExpr:!0},YZ={};function XZ(e,t){return void 0===t&&(t={}),t.keyword=e,YZ[e]=new VZ(e,t)}var ZZ={num:new VZ("num",WZ),regexp:new VZ("regexp",WZ),string:new VZ("string",WZ),name:new VZ("name",WZ),eof:new VZ("eof"),bracketL:new VZ("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new VZ("]"),braceL:new VZ("{",{beforeExpr:!0,startsExpr:!0}),braceR:new VZ("}"),parenL:new VZ("(",{beforeExpr:!0,startsExpr:!0}),parenR:new VZ(")"),comma:new VZ(",",HZ),semi:new VZ(";",HZ),colon:new VZ(":",HZ),dot:new VZ("."),question:new VZ("?",HZ),questionDot:new VZ("?."),arrow:new VZ("=>",HZ),template:new VZ("template"),invalidTemplate:new VZ("invalidTemplate"),ellipsis:new VZ("...",HZ),backQuote:new VZ("`",WZ),dollarBraceL:new VZ("${",{beforeExpr:!0,startsExpr:!0}),eq:new VZ("=",{beforeExpr:!0,isAssign:!0}),assign:new VZ("_=",{beforeExpr:!0,isAssign:!0}),incDec:new VZ("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new VZ("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:GZ("||",1),logicalAND:GZ("&&",2),bitwiseOR:GZ("|",3),bitwiseXOR:GZ("^",4),bitwiseAND:GZ("&",5),equality:GZ("==/!=/===/!==",6),relational:GZ("</>/<=/>=",7),bitShift:GZ("<</>>/>>>",8),plusMin:new VZ("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:GZ("%",10),star:GZ("*",10),slash:GZ("/",10),starstar:new VZ("**",{beforeExpr:!0}),coalesce:GZ("??",1),_break:XZ("break"),_case:XZ("case",HZ),_catch:XZ("catch"),_continue:XZ("continue"),_debugger:XZ("debugger"),_default:XZ("default",HZ),_do:XZ("do",{isLoop:!0,beforeExpr:!0}),_else:XZ("else",HZ),_finally:XZ("finally"),_for:XZ("for",{isLoop:!0}),_function:XZ("function",WZ),_if:XZ("if"),_return:XZ("return",HZ),_switch:XZ("switch"),_throw:XZ("throw",HZ),_try:XZ("try"),_var:XZ("var"),_const:XZ("const"),_while:XZ("while",{isLoop:!0}),_with:XZ("with"),_new:XZ("new",{beforeExpr:!0,startsExpr:!0}),_this:XZ("this",WZ),_super:XZ("super",WZ),_class:XZ("class",WZ),_extends:XZ("extends",HZ),_export:XZ("export"),_import:XZ("import",WZ),_null:XZ("null",WZ),_true:XZ("true",WZ),_false:XZ("false",WZ),_in:XZ("in",{beforeExpr:!0,binop:7}),_instanceof:XZ("instanceof",{beforeExpr:!0,binop:7}),_typeof:XZ("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:XZ("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:XZ("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},qZ=/\r\n?|\n|\u2028|\u2029/,KZ=new RegExp(qZ.source,"g");function QZ(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var $Z=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,JZ=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,eq=Object.prototype,tq=eq.hasOwnProperty,nq=eq.toString;function rq(e,t){return tq.call(e,t)}var iq=Array.isArray||function(e){return"[object Array]"===nq.call(e)};function oq(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var aq=function(e,t){this.line=e,this.column=t};aq.prototype.offset=function(e){return new aq(this.line,this.column+e)};var sq=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function uq(e,t){for(var n=1,r=0;;){KZ.lastIndex=r;var i=KZ.exec(e);if(!(i&&i.index<t))return new aq(n,t-r);++n,r=i.index+i[0].length}}var cq={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function lq(e){var t={};for(var n in cq)t[n]=e&&rq(e,n)?e[n]:cq[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),iq(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return iq(t.onComment)&&(t.onComment=function(e,t){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};e.locations&&(u.loc=new sq(this,a,s)),e.ranges&&(u.range=[i,o]),t.push(u)}}(t,t.onComment)),t}function hq(e,t){return 2|(e?4:0)|(t?8:0)}var fq=function(e,t,n){this.options=e=lq(e),this.sourceFile=e.sourceFile,this.keywords=oq(IZ[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var r="";if(!0!==e.allowReserved){for(var i=e.ecmaVersion;!(r=MZ[i]);i--);"module"===e.sourceType&&(r+=" await")}this.reservedWords=oq(r);var o=(r?r+" ":"")+MZ.strict;this.reservedWordsStrict=oq(o),this.reservedWordsStrictBind=oq(o+" "+MZ.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(qZ).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ZZ.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},pq={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};fq.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},pq.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},pq.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},pq.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},pq.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},pq.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},pq.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},fq.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},fq.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},fq.parse=function(e,t){return new this(t,e).parse()},fq.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},fq.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(fq.prototype,pq);var dq=fq.prototype,vq=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function gq(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}dq.strictDirective=function(e){for(;;){JZ.lastIndex=e,e+=JZ.exec(this.input)[0].length;var t=vq.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){JZ.lastIndex=e+t[0].length;var n=JZ.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||qZ.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}e+=t[0].length,JZ.lastIndex=e,e+=JZ.exec(this.input)[0].length,";"===this.input[e]&&e++}},dq.eat=function(e){return this.type===e&&(this.next(),!0)},dq.isContextual=function(e){return this.type===ZZ.name&&this.value===e&&!this.containsEsc},dq.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},dq.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},dq.canInsertSemicolon=function(){return this.type===ZZ.eof||this.type===ZZ.braceR||qZ.test(this.input.slice(this.lastTokEnd,this.start))},dq.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},dq.semicolon=function(){this.eat(ZZ.semi)||this.insertSemicolon()||this.unexpected()},dq.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},dq.expect=function(e){this.eat(e)||this.unexpected()},dq.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},dq.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},dq.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},dq.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},dq.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var mq=fq.prototype;mq.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==ZZ.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var yq={kind:"loop"},_q={kind:"switch"};mq.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;JZ.lastIndex=this.pos;var t=JZ.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(jZ(r,!0)){for(var i=n+1;UZ(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!RZ.test(o))return!0}return!1},mq.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;JZ.lastIndex=this.pos;var e=JZ.exec(this.input),t=this.pos+e[0].length;return!(qZ.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!==this.input.length&&UZ(this.input.charAt(t+8)))},mq.parseStatement=function(e,t,n){var r,i=this.type,o=this.startNode();switch(this.isLet(e)&&(i=ZZ._var,r="let"),i){case ZZ._break:case ZZ._continue:return this.parseBreakContinueStatement(o,i.keyword);case ZZ._debugger:return this.parseDebuggerStatement(o);case ZZ._do:return this.parseDoStatement(o);case ZZ._for:return this.parseForStatement(o);case ZZ._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!e);case ZZ._class:return e&&this.unexpected(),this.parseClass(o,!0);case ZZ._if:return this.parseIfStatement(o);case ZZ._return:return this.parseReturnStatement(o);case ZZ._switch:return this.parseSwitchStatement(o);case ZZ._throw:return this.parseThrowStatement(o);case ZZ._try:return this.parseTryStatement(o);case ZZ._const:case ZZ._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case ZZ._while:return this.parseWhileStatement(o);case ZZ._with:return this.parseWithStatement(o);case ZZ.braceL:return this.parseBlock(!0,o);case ZZ.semi:return this.parseEmptyStatement(o);case ZZ._export:case ZZ._import:if(this.options.ecmaVersion>10&&i===ZZ._import){JZ.lastIndex=this.pos;var a=JZ.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===ZZ._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!e);var c=this.value,l=this.parseExpression();return i===ZZ.name&&"Identifier"===l.type&&this.eat(ZZ.colon)?this.parseLabeledStatement(o,c,l,e):this.parseExpressionStatement(o,l)}},mq.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(ZZ.semi)||this.insertSemicolon()?e.label=null:this.type!==ZZ.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},mq.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},mq.parseDoStatement=function(e){return this.next(),this.labels.push(yq),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(ZZ._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ZZ.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},mq.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(yq),this.enterScope(0),this.expect(ZZ.parenL),this.type===ZZ.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===ZZ._var||this.type===ZZ._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===ZZ._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===ZZ._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var o=new gq,a=this.parseExpression(!0,o);return this.type===ZZ._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ZZ._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(o,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},mq.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,xq|(n?0:Sq),!1,t)},mq.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(ZZ._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},mq.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ZZ.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},mq.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(ZZ.braceL),this.labels.push(_q),this.enterScope(0);for(var n=!1;this.type!==ZZ.braceR;)if(this.type===ZZ._case||this.type===ZZ._default){var r=this.type===ZZ._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(ZZ.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},mq.parseThrowStatement=function(e){return this.next(),qZ.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var bq=[];mq.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===ZZ._catch){var t=this.startNode();if(this.next(),this.eat(ZZ.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?32:0),this.checkLVal(t.param,n?4:2),this.expect(ZZ.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(ZZ._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},mq.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},mq.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(yq),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},mq.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},mq.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},mq.parseLabeledStatement=function(e,t,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){o[i].name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===ZZ._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==e.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},mq.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},mq.parseBlock=function(e,t,n){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(ZZ.braceL),e&&this.enterScope(0);this.type!==ZZ.braceR;){var r=this.parseStatement(null);t.body.push(r)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},mq.parseFor=function(e,t){return e.init=t,this.expect(ZZ.semi),e.test=this.type===ZZ.semi?null:this.parseExpression(),this.expect(ZZ.semi),e.update=this.type===ZZ.parenR?null:this.parseExpression(),this.expect(ZZ.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},mq.parseForIn=function(e,t){var n=this.type===ZZ._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(ZZ.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},mq.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(ZZ.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===ZZ._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===ZZ._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(ZZ.comma))break}return e},mq.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?1:2,!1)};var xq=1,Sq=2;mq.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===ZZ.star&&t&Sq&&this.unexpected(),e.generator=this.eat(ZZ.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&xq&&(e.id=4&t&&this.type!==ZZ.name?null:this.parseIdent(),!e.id||t&Sq||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(hq(e.async,e.generator)),t&xq||(e.id=this.type===ZZ.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(e,t&xq?"FunctionDeclaration":"FunctionExpression")},mq.parseFunctionParams=function(e){this.expect(ZZ.parenL),e.params=this.parseBindingList(ZZ.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},mq.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(ZZ.braceL);this.type!==ZZ.braceR;){var o=this.parseClassElement(null!==e.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},mq.parseClassElement=function(e){var t=this;if(this.eat(ZZ.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,o=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===ZZ.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,o),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(ZZ.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(ZZ.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=e),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},mq.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},mq.parseClassId=function(e,t){this.type===ZZ.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},mq.parseClassSuper=function(e){e.superClass=this.eat(ZZ._extends)?this.parseExprSubscripts():null},mq.parseExport=function(e,t){if(this.next(),this.eat(ZZ.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==ZZ.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(ZZ._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===ZZ._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,4|xq,!1,n)}else if(this.type===ZZ._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==ZZ.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var o=0,a=e.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},mq.checkExport=function(e,t,n){e&&(rq(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},mq.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(e,o)}else if("ArrayPattern"===n)for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},mq.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},mq.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},mq.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(ZZ.braceL);!this.eat(ZZ.braceR);){if(n)n=!1;else if(this.expect(ZZ.comma),this.afterTrailingComma(ZZ.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},mq.parseImport=function(e){return this.next(),this.type===ZZ.string?(e.specifiers=bq,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===ZZ.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},mq.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===ZZ.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(ZZ.comma))return e}if(this.type===ZZ.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(ZZ.braceL);!this.eat(ZZ.braceR);){if(t)t=!1;else if(this.expect(ZZ.comma),this.afterTrailingComma(ZZ.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),e.push(this.finishNode(i,"ImportSpecifier"))}return e},mq.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},mq.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var Eq=fq.prototype;Eq.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,t),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},Eq.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var o=e[n-1];6===this.options.ecmaVersion&&t&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return e},Eq.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},Eq.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==ZZ.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},Eq.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ZZ.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(ZZ.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case ZZ.braceL:return this.parseObj(!0)}return this.parseIdent()},Eq.parseBindingList=function(e,t,n){for(var r=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(ZZ.comma),t&&this.type===ZZ.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===ZZ.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===ZZ.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},Eq.parseBindingListItem=function(e){return e},Eq.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ZZ.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},Eq.checkLVal=function(e,t,n){switch(void 0===t&&(t=0),e.type){case"Identifier":2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(rq(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),0!==t&&5!==t&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var Aq=fq.prototype;Aq.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var a=t[r="$"+r];if(a)("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=t[r]={init:!1,get:!1,set:!1};a[o]=!0}}},Aq.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===ZZ.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(ZZ.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,"SequenceExpression")}return i},Aq.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,o=-1;t?(i=t.parenthesizedAssign,o=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new gq,r=!0);var a=this.start,s=this.startLoc;this.type!==ZZ.parenL&&this.type!==ZZ.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var c=this.startNodeAt(a,s);return c.operator=this.value,c.left=this.type===ZZ.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=c.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),o>-1&&(t.trailingComma=o),u},Aq.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(ZZ.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(ZZ.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},Aq.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},Aq.parseExprOp=function(e,t,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==ZZ._in)&&o>r){var a=this.type===ZZ.logicalOR||this.type===ZZ.logicalAND,s=this.type===ZZ.coalesce;s&&(o=ZZ.logicalAND.binop);var u=this.value;this.next();var c=this.start,l=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),c,l,o,i),f=this.buildBinary(t,n,e,h,u,a||s);return(a&&this.type===ZZ.coalesce||s&&(this.type===ZZ.logicalOR||this.type===ZZ.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,t,n,r,i)}return e},Aq.buildBinary=function(e,t,n,r,i,o){var a=this.startNodeAt(e,t);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},Aq.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===ZZ.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!t&&this.eat(ZZ.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},Aq.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},Aq.parseSubscripts=function(e,t,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,o=!1;;){var a=this.parseSubscript(e,t,n,r,i,o);if(a.optional&&(o=!0),a===e||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(t,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}e=a}},Aq.parseSubscript=function(e,t,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(ZZ.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(ZZ.bracketL);if(u||s&&this.type!==ZZ.parenL&&this.type!==ZZ.backQuote||this.eat(ZZ.dot)){var c=this.startNodeAt(t,n);c.object=e,c.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),c.computed=!!u,u&&this.expect(ZZ.bracketR),a&&(c.optional=s),e=this.finishNode(c,"MemberExpression")}else if(!r&&this.eat(ZZ.parenL)){var l=new gq,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(ZZ.parenR,this.options.ecmaVersion>=8,!1,l);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(ZZ.arrow))return this.checkPatternErrors(l,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,n),d,!0);this.checkExpressionErrors(l,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(t,n);v.callee=e,v.arguments=d,a&&(v.optional=s),e=this.finishNode(v,"CallExpression")}else if(this.type===ZZ.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(t,n);g.tag=e,g.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(g,"TaggedTemplateExpression")}return e},Aq.parseExprAtom=function(e){this.type===ZZ.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case ZZ._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==ZZ.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==ZZ.dot&&this.type!==ZZ.bracketL&&this.type!==ZZ.parenL&&this.unexpected(),this.finishNode(t,"Super");case ZZ._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case ZZ.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(ZZ._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(ZZ.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===ZZ.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(ZZ.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case ZZ.regexp:var s=this.value;return(t=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},t;case ZZ.num:case ZZ.string:return this.parseLiteral(this.value);case ZZ._null:case ZZ._true:case ZZ._false:return(t=this.startNode()).value=this.type===ZZ._null?null:this.type===ZZ._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case ZZ.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case ZZ.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(ZZ.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case ZZ.braceL:return this.parseObj(!1,e);case ZZ._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case ZZ._class:return this.parseClass(this.startNode(),!1);case ZZ._new:return this.parseNew();case ZZ.backQuote:return this.parseTemplate();case ZZ._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Aq.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case ZZ.parenL:return this.parseDynamicImport(e);case ZZ.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},Aq.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(ZZ.parenR)){var t=this.start;this.eat(ZZ.comma)&&this.eat(ZZ.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},Aq.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},Aq.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},Aq.parseParenExpression=function(){this.expect(ZZ.parenL);var e=this.parseExpression();return this.expect(ZZ.parenR),e},Aq.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],c=!0,l=!1,h=new gq,f=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==ZZ.parenR;){if(c?c=!1:this.expect(ZZ.comma),i&&this.afterTrailingComma(ZZ.parenR,!0)){l=!0;break}if(this.type===ZZ.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===ZZ.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(ZZ.parenR),e&&!this.canInsertSemicolon()&&this.eat(ZZ.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!l||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?((t=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(t,"SequenceExpression",d,v)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},Aq.parseParenItem=function(e){return e},Aq.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var Tq=[];Aq.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ZZ.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===ZZ._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(ZZ.parenL)?e.arguments=this.parseExprList(ZZ.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Tq,this.finishNode(e,"NewExpression")},Aq.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===ZZ.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===ZZ.backQuote,this.finishNode(n,"TemplateElement")},Aq.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});for(n.quasis=[r];!r.tail;)this.type===ZZ.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ZZ.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(ZZ.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},Aq.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===ZZ.name||this.type===ZZ.num||this.type===ZZ.string||this.type===ZZ.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ZZ.star)&&!qZ.test(this.input.slice(this.lastTokEnd,this.start))},Aq.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(ZZ.braceR);){if(r)r=!1;else if(this.expect(ZZ.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ZZ.braceR))break;var o=this.parseProperty(e,t);e||this.checkPropClash(o,i,t),n.properties.push(o)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},Aq.parseProperty=function(e,t){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(ZZ.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===ZZ.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===ZZ.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===ZZ.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,o=this.startLoc),e||(n=this.eat(ZZ.star)));var s=this.containsEsc;return this.parsePropertyName(a),!e&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(ZZ.star),this.parsePropertyName(a,t)):r=!1,this.parsePropertyValue(a,e,n,r,i,o,t,s),this.finishNode(a,"Property")},Aq.parsePropertyValue=function(e,t,n,r,i,o,a,s){if((n||r)&&this.type===ZZ.colon&&this.unexpected(),this.eat(ZZ.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ZZ.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||s||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===ZZ.comma||this.type===ZZ.braceR||this.type===ZZ.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===ZZ.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var c=e.value.start;"get"===e.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},Aq.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(ZZ.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(ZZ.bracketR),e.key;e.computed=!1}return e.key=this.type===ZZ.num||this.type===ZZ.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},Aq.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},Aq.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|hq(t,r.generator)|(n?128:0)),this.expect(ZZ.parenL),r.params=this.parseBindingList(ZZ.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},Aq.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|hq(n,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(e,"ArrowFunctionExpression")},Aq.parseFunctionBody=function(e,t,n){var r=t&&this.type!==ZZ.braceL,i=this.strict,o=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(e,!i&&!o&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,5),e.body=this.parseBlock(!1,void 0,o&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=s}this.exitScope()},Aq.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){if("Identifier"!==n[t].type)return!1}return!0},Aq.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,t?null:n)}},Aq.parseExprList=function(e,t,n,r){for(var i=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(ZZ.comma),t&&this.afterTrailingComma(e))break;var a=void 0;n&&this.type===ZZ.comma?a=null:this.type===ZZ.ellipsis?(a=this.parseSpread(r),r&&this.type===ZZ.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},Aq.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))},Aq.parseIdent=function(e,t){var n=this.startNode();return this.type===ZZ.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},Aq.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===ZZ.semi||this.canInsertSemicolon()||this.type!==ZZ.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(ZZ.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},Aq.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var wq=fq.prototype;wq.raise=function(e,t){var n=uq(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},wq.raiseRecoverable=wq.raise,wq.curPosition=function(){if(this.options.locations)return new aq(this.curLine,this.pos-this.lineStart)};var Cq=fq.prototype,kq=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};Cq.enterScope=function(e){this.scopeStack.push(new kq(e))},Cq.exitScope=function(){this.scopeStack.pop()},Cq.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},Cq.declareName=function(e,t,n){var r=!1;if(2===t){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&1&i.flags&&delete this.undefinedExports[e]}else if(4===t){this.currentScope().lexical.push(e)}else if(3===t){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(e)>-1:o.lexical.indexOf(e)>-1||o.var.indexOf(e)>-1,o.functions.push(e)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(e)>-1&&!(32&s.flags&&s.lexical[0]===e)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(e)>-1){r=!0;break}if(s.var.push(e),this.inModule&&1&s.flags&&delete this.undefinedExports[e],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},Cq.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},Cq.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Cq.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},Cq.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var Mq=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new sq(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},Pq=fq.prototype;function Iq(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}Pq.startNode=function(){return new Mq(this,this.start,this.startLoc)},Pq.startNodeAt=function(e,t){return new Mq(this,e,t)},Pq.finishNode=function(e,t){return Iq.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Pq.finishNodeAt=function(e,t,n,r){return Iq.call(this,e,t,n,r)};var Rq=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},Oq={b_stat:new Rq("{",!1),b_expr:new Rq("{",!0),b_tmpl:new Rq("${",!1),p_stat:new Rq("(",!1),p_expr:new Rq("(",!0),q_tmpl:new Rq("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new Rq("function",!1),f_expr:new Rq("function",!0),f_expr_gen:new Rq("function",!0,!1,null,!0),f_gen:new Rq("function",!1,!1,null,!0)},Lq=fq.prototype;Lq.initialContext=function(){return[Oq.b_stat]},Lq.braceIsBlock=function(e){var t=this.curContext();return t===Oq.f_expr||t===Oq.f_stat||(e!==ZZ.colon||t!==Oq.b_stat&&t!==Oq.b_expr?e===ZZ._return||e===ZZ.name&&this.exprAllowed?qZ.test(this.input.slice(this.lastTokEnd,this.start)):e===ZZ._else||e===ZZ.semi||e===ZZ.eof||e===ZZ.parenR||e===ZZ.arrow||(e===ZZ.braceL?t===Oq.b_stat:e!==ZZ._var&&e!==ZZ._const&&e!==ZZ.name&&!this.exprAllowed):!t.isExpr)},Lq.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},Lq.updateContext=function(e){var t,n=this.type;n.keyword&&e===ZZ.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},ZZ.parenR.updateContext=ZZ.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===Oq.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},ZZ.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?Oq.b_stat:Oq.b_expr),this.exprAllowed=!0},ZZ.dollarBraceL.updateContext=function(){this.context.push(Oq.b_tmpl),this.exprAllowed=!0},ZZ.parenL.updateContext=function(e){var t=e===ZZ._if||e===ZZ._for||e===ZZ._with||e===ZZ._while;this.context.push(t?Oq.p_stat:Oq.p_expr),this.exprAllowed=!0},ZZ.incDec.updateContext=function(){},ZZ._function.updateContext=ZZ._class.updateContext=function(e){!e.beforeExpr||e===ZZ.semi||e===ZZ._else||e===ZZ._return&&qZ.test(this.input.slice(this.lastTokEnd,this.start))||(e===ZZ.colon||e===ZZ.braceL)&&this.curContext()===Oq.b_stat?this.context.push(Oq.f_stat):this.context.push(Oq.f_expr),this.exprAllowed=!1},ZZ.backQuote.updateContext=function(){this.curContext()===Oq.q_tmpl?this.context.pop():this.context.push(Oq.q_tmpl),this.exprAllowed=!1},ZZ.star.updateContext=function(e){if(e===ZZ._function){var t=this.context.length-1;this.context[t]===Oq.f_expr?this.context[t]=Oq.f_expr_gen:this.context[t]=Oq.f_gen}this.exprAllowed=!0},ZZ.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==ZZ.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var Nq="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Dq=Nq+" Extended_Pictographic",Fq={9:Nq,10:Dq,11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},zq="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Bq="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",jq=Bq+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Uq={9:Bq,10:jq,11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},Vq={};function Gq(e){var t=Vq[e]={binary:oq(Fq[e]+" "+zq),nonBinary:{General_Category:oq(zq),Script:oq(Uq[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}Gq(9),Gq(10),Gq(11);var Hq=fq.prototype,Wq=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Vq[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function Yq(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function Xq(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function Zq(e){return e>=65&&e<=90||e>=97&&e<=122}function qq(e){return Zq(e)||95===e}function Kq(e){return qq(e)||Qq(e)}function Qq(e){return e>=48&&e<=57}function $q(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Jq(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function eK(e){return e>=48&&e<=55}Wq.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},Wq.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},Wq.prototype.at=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return-1;var i=n.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=r)return i;var o=n.charCodeAt(e+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},Wq.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return r;var i,o=n.charCodeAt(e);return!t&&!this.switchU||o<=55295||o>=57344||e+1>=r||(i=n.charCodeAt(e+1))<56320||i>57343?e+1:e+2},Wq.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},Wq.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},Wq.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},Wq.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},Hq.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},Hq.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},Hq.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},Hq.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},Hq.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},Hq.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},Hq.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},Hq.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},Hq.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},Hq.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},Hq.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},Hq.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},Hq.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},Hq.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},Hq.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},Hq.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},Hq.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!Xq(t)&&(e.lastIntValue=t,e.advance(),!0)},Hq.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;-1!==(n=e.current())&&!Xq(n);)e.advance();return e.pos!==t},Hq.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},Hq.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},Hq.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},Hq.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Yq(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Yq(e.lastIntValue);return!0}return!1},Hq.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return jZ(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},Hq.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return UZ(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},Hq.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},Hq.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},Hq.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},Hq.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},Hq.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},Hq.regexp_eatZero=function(e){return 48===e.current()&&!Qq(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},Hq.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},Hq.regexp_eatControlLetter=function(e){var t=e.current();return!!Zq(t)&&(e.lastIntValue=t%32,e.advance(),!0)},Hq.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var n,r=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var o=e.lastIntValue;if(i&&o>=55296&&o<=56319){var a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}e.pos=a,e.lastIntValue=o}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((n=e.lastIntValue)>=0&&n<=1114111))return!0;i&&e.raise("Invalid unicode escape"),e.pos=r}return!1},Hq.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},Hq.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},Hq.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},Hq.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},Hq.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){rq(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},Hq.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},Hq.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";qq(t=e.current());)e.lastStringValue+=Yq(t),e.advance();return""!==e.lastStringValue},Hq.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";Kq(t=e.current());)e.lastStringValue+=Yq(t),e.advance();return""!==e.lastStringValue},Hq.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},Hq.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},Hq.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},Hq.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||eK(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},Hq.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},Hq.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!Qq(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},Hq.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},Hq.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;Qq(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},Hq.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;$q(n=e.current());)e.lastIntValue=16*e.lastIntValue+Jq(n),e.advance();return e.pos!==t},Hq.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},Hq.regexp_eatOctalDigit=function(e){var t=e.current();return eK(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},Hq.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!$q(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+Jq(i),e.advance()}return!0};var tK=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new sq(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},nK=fq.prototype;function rK(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}function iK(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}nK.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new tK(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},nK.getToken=function(){return this.next(),new tK(this)},"undefined"!=typeof Symbol&&(nK[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===ZZ.eof,value:t}}}}),nK.curContext=function(){return this.context[this.context.length-1]},nK.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(ZZ.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},nK.readToken=function(e){return jZ(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},nK.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},nK.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(KZ.lastIndex=n;(e=KZ.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},nK.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!QZ(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},nK.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&$Z.test(String.fromCharCode(e))))break e;++this.pos}}},nK.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},nK.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(ZZ.ellipsis)):(++this.pos,this.finishToken(ZZ.dot))},nK.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(ZZ.assign,2):this.finishOp(ZZ.slash,1)},nK.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?ZZ.star:ZZ.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=ZZ.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(ZZ.assign,n+1):this.finishOp(r,n)},nK.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(ZZ.assign,3);return this.finishOp(124===e?ZZ.logicalOR:ZZ.logicalAND,2)}return 61===t?this.finishOp(ZZ.assign,2):this.finishOp(124===e?ZZ.bitwiseOR:ZZ.bitwiseAND,1)},nK.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(ZZ.assign,2):this.finishOp(ZZ.bitwiseXOR,1)},nK.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!qZ.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(ZZ.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(ZZ.assign,2):this.finishOp(ZZ.plusMin,1)},nK.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(ZZ.assign,n+1):this.finishOp(ZZ.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(ZZ.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},nK.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(ZZ.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ZZ.arrow)):this.finishOp(61===e?ZZ.eq:ZZ.prefix,1)},nK.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(ZZ.questionDot,2)}if(63===t){if(e>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(ZZ.assign,3);return this.finishOp(ZZ.coalesce,2)}}return this.finishOp(ZZ.question,1)},nK.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ZZ.parenL);case 41:return++this.pos,this.finishToken(ZZ.parenR);case 59:return++this.pos,this.finishToken(ZZ.semi);case 44:return++this.pos,this.finishToken(ZZ.comma);case 91:return++this.pos,this.finishToken(ZZ.bracketL);case 93:return++this.pos,this.finishToken(ZZ.bracketR);case 123:return++this.pos,this.finishToken(ZZ.braceL);case 125:return++this.pos,this.finishToken(ZZ.braceR);case 58:return++this.pos,this.finishToken(ZZ.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ZZ.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(ZZ.prefix,1)}this.raise(this.pos,"Unexpected character '"+iK(e)+"'")},nK.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},nK.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(qZ.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new Wq(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(e){}return this.finishToken(ZZ.regexp,{pattern:i,flags:a,value:u})},nK.readInt=function(e,t,n){for(var r=this.options.ecmaVersion>=12&&void 0===t,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,c=null==t?1/0:t;u<c;++u,++this.pos){var l=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===l)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=l;else{if((h=l>=97?l-97+10:l>=65?l-65+10:l>=48&&l<=57?l-48:1/0)>=e)break;s=l,a=a*e+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=t&&this.pos-o!==t?null:a},nK.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=rK(this.input.slice(t,this.pos)),++this.pos):jZ(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ZZ.num,n)},nK.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=rK(this.input.slice(t,this.pos));return++this.pos,jZ(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ZZ.num,i)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),jZ(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=function(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}(this.input.slice(t,this.pos),n);return this.finishToken(ZZ.num,o)},nK.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},nK.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(QZ(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(ZZ.string,t)};var oK={};nK.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==oK)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},nK.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw oK;this.raise(e,t)},nK.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==ZZ.template&&this.type!==ZZ.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(ZZ.template,e)):36===n?(this.pos+=2,this.finishToken(ZZ.dollarBraceL)):(++this.pos,this.finishToken(ZZ.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(QZ(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},nK.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(ZZ.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},nK.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return iK(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return QZ(t)?"":String.fromCharCode(t)}},nK.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},nK.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(UZ(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?jZ:UZ)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),e+=iK(a),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},nK.readWord=function(){var e=this.readWord1(),t=ZZ.name;return this.keywords.test(e)&&(t=YZ[e]),this.finishToken(t,e)};function aK(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function sK(e){var t="function"==typeof Map?new Map:void 0;return(sK=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return cK(e,arguments,hK(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),lK(r,e)})(e)}function uK(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function cK(e,t,n){return(cK=uK()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&lK(i,n.prototype),i}).apply(null,arguments)}function lK(e,t){return(lK=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hK(e){return(hK=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}fq.acorn={Parser:fq,version:"7.4.1",defaultOptions:cq,Position:aq,SourceLocation:sq,getLineInfo:uq,Node:Mq,TokenType:VZ,tokTypes:ZZ,keywordTypes:YZ,TokContext:Rq,tokContexts:Oq,isIdentifierChar:UZ,isIdentifierStart:jZ,Token:tK,isNewLine:QZ,lineBreak:qZ,lineBreakG:KZ,nonASCIIwhitespace:$Z};var fK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(sK(Error)),pK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(sK(SyntaxError)),dK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(sK(ReferenceError)),vK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(sK(TypeError)),gK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(fK),mK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(pK),yK=function(e){function t(){return e.apply(this,arguments)||this}return aK(t,e),t}(dK),_K={UnknownError:[3001,"%0",gK],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",gK],NodeTypeSyntaxError:[1001,"Unknown node type: %0",yK],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",yK],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",yK],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",yK],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",yK],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",yK],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",yK],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",yK],ParamTypeSyntaxError:[1009,"Unknown param type: %0",yK],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",yK],FunctionUndefinedReferenceError:[2001,"%0 is not a function",dK],VariableUndefinedReferenceError:[2002,"%0 is not defined",dK],IsNotConstructor:[2003,"%0 is not a constructor",vK]};function bK(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function xK(e,t,n){return(xK=bK()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&SK(i,n.prototype),i}).apply(null,arguments)}function SK(e,t){return(SK=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function EK(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var AK=Object.prototype.hasOwnProperty,TK=Symbol("Break"),wK=Symbol("Continue"),CK=Symbol("DefaultCase"),kK=Symbol("EmptyStatementReturn"),MK=Symbol("WithScopeName"),PK=Symbol("SuperScopeName"),IK=Symbol("RootScopeName"),RK=Symbol("GlobalScopeName");function OK(e){return"function"==typeof e}var LK=function(){function e(e){this.interpreter=e}return e.prototype.generator=function(){var e=this.interpreter;return{getOptions:e.getOptions.bind(e),getCurrentScope:function(){return this.getCurrentScope()}.bind(e),getGlobalScope:function(){return this.getGlobalScope()}.bind(e),getCurrentContext:function(){return this.getCurrentContext()}.bind(e),getExecStartTime:e.getExecStartTime.bind(e)}},e}();function NK(e,t,n){if(void 0===n&&(n=!0),!(e instanceof LK))throw new Error("Illegal call");if("string"!=typeof t)return t;if(t){var r=e.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new HK(o,i).evaluate(t)}}function DK(e){if(!(e instanceof LK))throw new Error("Illegal call");for(var t=e.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new HK(t.getGlobalScope(),t.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(NK,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(DK,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var FK=function(e){this.value=e},zK=function(e){this.value=e},BK=function(e){this.value=e},jK=function(e,t,n){void 0===t&&(t=null),this.name=n,this.parent=t,this.data=e,this.labelStack=[]};function UK(){}function VK(e,t){return void 0===e&&(e=null),new jK(Object.create(null),e,t)}var GK={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:NK,Function:DK};"undefined"!=typeof JSON&&(GK.JSON=JSON),"undefined"!=typeof Promise&&(GK.Promise=Promise),"undefined"!=typeof Set&&(GK.Set=Set),"undefined"!=typeof Map&&(GK.Map=Map),"undefined"!=typeof Symbol&&(GK.Symbol=Symbol),"undefined"!=typeof Proxy&&(GK.Proxy=Proxy),"undefined"!=typeof WeakMap&&(GK.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(GK.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(GK.Reflect=Reflect);var HK=function(){function e(t,n){void 0===t&&(t=e.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(e){var t;if(e instanceof jK)t=e;else{var n=null,r=this.createSuperScope(e);this.options.rootContext&&(n=new jK(function(e){return Object.create(e)}(this.options.rootContext),r,IK)),t=new jK(e,n||r,RK)}this.globalScope=t,this.currentScope=this.globalScope,this.globalContext=t.data,this.currentContext=t.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(e){void 0===e&&(e=0),this.options.timeout=e},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(e){return e instanceof gK||e instanceof yK||e instanceof mK},t.createSuperScope=function(e){var t=Object.assign({},GK);return Object.keys(t).forEach((function(n){n in e&&delete t[n]})),new jK(t,null,PK)},t.setCurrentContext=function(e){this.currentContext=e},t.setCurrentScope=function(e){this.currentScope=e},t.evaluate=function(t){var n;if(void 0===t&&(t=""),t)return n=function(e,t){return fq.parse(e,t)}(t,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(n,t)},t.appendCode=function(e){return this.evaluate(e)},t.evaluateNode=function(e,t){var n=this;void 0===t&&(t=""),this.value=void 0,this.source=t,this.sourceList.push(t),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(e);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(e){throw e}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(e,t,n){var r=e[1].replace("%0",String(t));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},t.createError=function(e,t){return new t(e)},t.createThrowError=function(e,t){return this.createError(e,t)},t.createInternalThrowError=function(e,t,n){return this.createError(this.createErrorMessage(e,t,n),e[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var e=this.options.timeout||0;return Date.now()-this.execStartTime>e},t.getNodePosition=function(e){if(e){return e.loc?" ["+e.loc.start.line+":"+e.loc.start.column+"]":""}return""},t.createClosure=function(e){var t,n=this;switch(e.type){case"BinaryExpression":t=this.binaryExpressionHandler(e);break;case"LogicalExpression":t=this.logicalExpressionHandler(e);break;case"UnaryExpression":t=this.unaryExpressionHandler(e);break;case"UpdateExpression":t=this.updateExpressionHandler(e);break;case"ObjectExpression":t=this.objectExpressionHandler(e);break;case"ArrayExpression":t=this.arrayExpressionHandler(e);break;case"CallExpression":t=this.callExpressionHandler(e);break;case"NewExpression":t=this.newExpressionHandler(e);break;case"MemberExpression":t=this.memberExpressionHandler(e);break;case"ThisExpression":t=this.thisExpressionHandler(e);break;case"SequenceExpression":t=this.sequenceExpressionHandler(e);break;case"Literal":t=this.literalHandler(e);break;case"Identifier":t=this.identifierHandler(e);break;case"AssignmentExpression":t=this.assignmentExpressionHandler(e);break;case"FunctionDeclaration":t=this.functionDeclarationHandler(e);break;case"VariableDeclaration":t=this.variableDeclarationHandler(e);break;case"BlockStatement":case"Program":t=this.programHandler(e);break;case"ExpressionStatement":t=this.expressionStatementHandler(e);break;case"EmptyStatement":t=this.emptyStatementHandler(e);break;case"ReturnStatement":t=this.returnStatementHandler(e);break;case"FunctionExpression":t=this.functionExpressionHandler(e);break;case"IfStatement":t=this.ifStatementHandler(e);break;case"ConditionalExpression":t=this.conditionalExpressionHandler(e);break;case"ForStatement":t=this.forStatementHandler(e);break;case"WhileStatement":t=this.whileStatementHandler(e);break;case"DoWhileStatement":t=this.doWhileStatementHandler(e);break;case"ForInStatement":t=this.forInStatementHandler(e);break;case"WithStatement":t=this.withStatementHandler(e);break;case"ThrowStatement":t=this.throwStatementHandler(e);break;case"TryStatement":t=this.tryStatementHandler(e);break;case"ContinueStatement":t=this.continueStatementHandler(e);break;case"BreakStatement":t=this.breakStatementHandler(e);break;case"SwitchStatement":t=this.switchStatementHandler(e);break;case"LabeledStatement":t=this.labeledStatementHandler(e);break;case"DebuggerStatement":t=this.debuggerStatementHandler(e);break;default:throw this.createInternalThrowError(_K.NodeTypeSyntaxError,e.type,e)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(_K.ExecutionTimeOutError,r,null);return n.lastExecNode=e,t.apply(void 0,arguments)}},t.binaryExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){var i=n(),o=r();switch(e.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw t.createInternalThrowError(_K.BinaryOperatorSyntaxError,e.operator,e)}}},t.logicalExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){switch(e.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw t.createInternalThrowError(_K.LogicalOperatorSyntaxError,e.operator,e)}}},t.unaryExpressionHandler=function(e){var t=this;switch(e.operator){case"delete":var n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){return delete n()[r()]};default:var i;if("typeof"===e.operator&&"Identifier"===e.argument.type){var o=this.createObjectGetter(e.argument),a=this.createNameGetter(e.argument);i=function(){return o()[a()]}}else i=this.createClosure(e.argument);return function(){var n=i();switch(e.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return typeof n;default:throw t.createInternalThrowError(_K.UnaryOperatorSyntaxError,e.operator,e)}}}},t.updateExpressionHandler=function(e){var t=this,n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var i=n(),o=r();switch(t.assertVariable(i,o,e),e.operator){case"++":return e.prefix?++i[o]:i[o]++;case"--":return e.prefix?--i[o]:i[o]--;default:throw t.createInternalThrowError(_K.UpdateOperatorSyntaxError,e.operator,e)}}},t.objectExpressionHandler=function(e){var t=this,n=[];var r=Object.create(null);return e.properties.forEach((function(e){var i=e.kind,o=function(e){return"Identifier"===e.type?e.name:"Literal"===e.type?e.value:this.throwError(_K.ObjectStructureSyntaxError,e.type,e)}(e.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=t.createClosure(e.value),n.push({key:o,property:e})})),function(){for(var e={},t=n.length,i=0;i<t;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,c=s.get?s.get():function(){},l=s.set?s.set():function(e){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:c,set:l};Object.defineProperty(e,a,h)}else{var f=o.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||EK(u,f.key.name),e[a]=u}}return e}},t.arrayExpressionHandler=function(e){var t=this,n=e.elements.map((function(e){return e?t.createClosure(e):e}));return function(){for(var e=n.length,t=Array(e),r=0;r<e;r++){var i=n[r];i&&(t[r]=i())}return t}},t.safeObjectGet=function(e,t,n){return e[t]},t.createCallFunctionGetter=function(e){var t=this;switch(e.type){case"MemberExpression":var n=this.createClosure(e.object),r=this.createMemberKeyGetter(e),i=this.source;return function(){var o=n(),a=r(),s=t.safeObjectGet(o,a,e);if(!s||!OK(s)){var u=i.slice(e.start,e.end);throw t.createInternalThrowError(_K.FunctionUndefinedReferenceError,u,e)}return s.__IS_EVAL_FUNC?function(e){return s(new LK(t),e,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s.apply(void 0,[new LK(t)].concat(n))}:s.bind(o)};default:var o=this.createClosure(e);return function(){var n="";"Identifier"===e.type&&(n=e.name);var r=o();if(!r||!OK(r))throw t.createInternalThrowError(_K.FunctionUndefinedReferenceError,n,e);if("Identifier"===e.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(e){var i=t.getScopeFromName(n,t.getCurrentScope()),o=i.name===PK||i.name===RK||i.name===IK;return r(new LK(t),e,!o)};if(r.__IS_EVAL_FUNC)return function(e){return r(new LK(t),e,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[new LK(t)].concat(n))};var i=t.options.globalContextInFunction;if("Identifier"===e.type){var a=t.getIdentifierScope(e);a.name===MK&&(i=a.data)}return r.bind(i)}}},t.callExpressionHandler=function(e){var t=this,n=this.createCallFunctionGetter(e.callee),r=e.arguments.map((function(e){return t.createClosure(e)}));return function(){return n().apply(void 0,r.map((function(e){return e()})))}},t.functionExpressionHandler=function(e){var t=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=e.id?e.id.name:"",s=e.params.length,u=e.params.map((function(e){return t.createParamNameGetter(e)})),c=this.createClosure(e.body),l=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var t=n.getCurrentScope(),i=function e(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),f=VK(t,"FunctionScope("+a+")");n.setCurrentScope(f),n.addDeclarationsToScope(l,h,f),a&&(f.data[a]=e),f.data.arguments=arguments,u.forEach((function(e,t){f.data[e()]=i[t]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=c();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof FK)return d.value};return EK(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),i}},t.newExpressionHandler=function(e){var t=this,n=this.source,r=this.createClosure(e.callee),i=e.arguments.map((function(e){return t.createClosure(e)}));return function(){var o=r();if(!OK(o)||o.__IS_EVAL_FUNC){var a=e.callee,s=n.slice(a.start,a.end);throw t.createInternalThrowError(_K.IsNotConstructor,s,e)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new LK(t)].concat(i.map((function(e){return e()})))):xK(o,i.map((function(e){return e()})))}},t.memberExpressionHandler=function(e){var t=this.createClosure(e.object),n=this.createMemberKeyGetter(e);return function(){return t()[n()]}},t.thisExpressionHandler=function(e){var t=this;return function(){return t.getCurrentContext()}},t.sequenceExpressionHandler=function(e){var t=this,n=e.expressions.map((function(e){return t.createClosure(e)}));return function(){for(var e,t=n.length,r=0;r<t;r++){e=(0,n[r])()}return e}},t.literalHandler=function(e){return function(){return e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.value}},t.identifierHandler=function(e){var t=this;return function(){var n=t.getCurrentScope(),r=t.getScopeDataFromName(e.name,n);return t.assertVariable(r,e.name,e),r[e.name]}},t.getIdentifierScope=function(e){var t=this.getCurrentScope();return this.getScopeFromName(e.name,t)},t.assignmentExpressionHandler=function(e){var t=this;"Identifier"!==e.left.type||"FunctionExpression"!==e.right.type||e.right.id||(e.right.id={type:"Identifier",name:e.left.name});var n=this.createObjectGetter(e.left),r=this.createNameGetter(e.left),i=this.createClosure(e.right);return function(){var o=n(),a=r(),s=i();switch("="!==e.operator&&t.assertVariable(o,a,e),e.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw t.createInternalThrowError(_K.AssignmentExpressionSyntaxError,e.type,e)}}},t.functionDeclarationHandler=function(e){if(e.id){var t=this.functionExpressionHandler(e);Object.defineProperty(t,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(e.id.name,t)}return function(){return kK}},t.getVariableName=function(e){if("Identifier"===e.type)return e.name;throw this.createInternalThrowError(_K.VariableTypeSyntaxError,e.type,e)},t.variableDeclarationHandler=function(e){for(var t,n=this,r=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(t=this.createClosure({type:"BlockStatement",body:r})),function(){if(t){var e=n.isVarDeclMode;n.isVarDeclMode=!0,t(),n.isVarDeclMode=e}return kK}},t.assertVariable=function(e,t,n){if(e===this.globalScope.data&&!(t in e))throw this.createInternalThrowError(_K.VariableUndefinedReferenceError,t,n)},t.programHandler=function(e){var t=this,n=e.body.map((function(e){return t.createClosure(e)}));return function(){for(var e=kK,r=0;r<n.length;r++){var i=n[r],o=t.setValue(i());if(o!==kK&&((e=o)instanceof FK||e instanceof zK||e instanceof BK||e===TK||e===wK))break}return e}},t.expressionStatementHandler=function(e){return this.createClosure(e.expression)},t.emptyStatementHandler=function(e){return function(){return kK}},t.returnStatementHandler=function(e){var t=e.argument?this.createClosure(e.argument):UK;return function(){return new FK(t())}},t.ifStatementHandler=function(e){var t=this.createClosure(e.test),n=this.createClosure(e.consequent),r=e.alternate?this.createClosure(e.alternate):
/*!important*/
function(){return kK};return function(){return t()?n():r()}},t.conditionalExpressionHandler=function(e){return this.ifStatementHandler(e)},t.forStatementHandler=function(e){var t=this,n=UK,r=e.test?this.createClosure(e.test):function(){return!0},i=UK,o=this.createClosure(e.body);return"ForStatement"===e.type&&(n=e.init?this.createClosure(e.init):n,i=e.update?this.createClosure(e.update):UK),function(a){var s,u=kK,c="DoWhileStatement"===e.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();c||r();i()){c=!1;var l=t.setValue(o());if(l!==kK&&l!==wK){if(l===TK)break;if((u=l)instanceof BK&&u.value===s)u=kK;else if(u instanceof FK||u instanceof zK||u instanceof BK)break}}return u}},t.whileStatementHandler=function(e){return this.forStatementHandler(e)},t.doWhileStatementHandler=function(e){return this.forStatementHandler(e)},t.forInStatementHandler=function(e){var t=this,n=e.left,r=this.createClosure(e.right),i=this.createClosure(e.body);return"VariableDeclaration"===e.left.type&&(this.createClosure(e.left)(),n=e.left.declarations[0].id),function(e){var o,a,s=kK;e&&"LabeledStatement"===e.type&&(o=e.label.name);var u=r();for(a in u){t.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var c=t.setValue(i());if(c!==kK&&c!==wK){if(c===TK)break;if((s=c)instanceof BK&&s.value===o)s=kK;else if(s instanceof FK||s instanceof zK||s instanceof BK)break}}return s}},t.withStatementHandler=function(e){var t=this,n=this.createClosure(e.object),r=this.createClosure(e.body);return function(){var e=n(),i=t.getCurrentScope(),o=new jK(e,i,MK);t.setCurrentScope(o);var a=t.setValue(r());return t.setCurrentScope(i),a}},t.throwStatementHandler=function(e){var t=this,n=this.createClosure(e.argument);return function(){throw t.setValue(void 0),n()}},t.tryStatementHandler=function(e){var t=this,n=this.createClosure(e.block),r=e.handler?this.catchClauseHandler(e.handler):null,i=e.finalizer?this.createClosure(e.finalizer):null;return function(){var e,o,a=t.getCurrentScope(),s=t.getCurrentContext(),u=a.labelStack.concat([]),c=t.callStack.concat([]),l=kK,h=function(){t.setCurrentScope(a),t.setCurrentContext(s),a.labelStack=u,t.callStack=c};try{(l=t.setValue(n()))instanceof FK&&(e=l)}catch(n){if(h(),t.isInterruptThrow(n))throw n;if(r)try{(l=t.setValue(r(n)))instanceof FK&&(e=l)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}}if(i)try{(l=i())instanceof FK&&(e=l)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}if(o)throw o;return e||l}},t.catchClauseHandler=function(e){var t=this,n=this.createParamNameGetter(e.param),r=this.createClosure(e.body);return function(e){var i,o=t.getCurrentScope().data,a=n(),s=AK.call(o,a),u=o[a];return o[a]=e,i=r(),s?o[a]=u:delete o[a],i}},t.continueStatementHandler=function(e){return function(){return e.label?new BK(e.label.name):wK}},t.breakStatementHandler=function(e){return function(){return e.label?new zK(e.label.name):TK}},t.switchStatementHandler=function(e){var t=this,n=this.createClosure(e.discriminant),r=e.cases.map((function(e){return t.switchCaseHandler(e)}));return function(){for(var e,i,o,a=n(),s=!1,u=0;u<r.length;u++){var c=r[u](),l=c.testClosure();if(l!==CK){if(s||l===a){if(s=!0,(i=t.setValue(c.bodyClosure()))===kK)continue;if(i===TK)break;if((e=i)instanceof FK||e instanceof zK||e instanceof BK||e===wK)break}}else o=c}!s&&o&&((i=t.setValue(o.bodyClosure()))===kK||i===TK||i===wK||(e=i));return e}},t.switchCaseHandler=function(e){var t=e.test?this.createClosure(e.test):function(){return CK},n=this.createClosure({type:"BlockStatement",body:e.consequent});return function(){return{testClosure:t,bodyClosure:n}}},t.labeledStatementHandler=function(e){var t=this,n=e.label.name,r=this.createClosure(e.body);return function(){var i,o=t.getCurrentScope();return o.labelStack.push(n),(i=r(e))instanceof zK&&i.value===n&&(i=kK),o.labelStack.pop(),i}},t.debuggerStatementHandler=function(e){return function(){return kK}},t.createParamNameGetter=function(e){if("Identifier"===e.type)return function(){return e.name};throw this.createInternalThrowError(_K.ParamTypeSyntaxError,e.type,e)},t.createObjectKeyGetter=function(e){var t;return t="Identifier"===e.type?function(){return e.name}:this.createClosure(e),function(){return t()}},t.createMemberKeyGetter=function(e){return e.computed?this.createClosure(e.property):this.createObjectKeyGetter(e.property)},t.createObjectGetter=function(e){var t=this;switch(e.type){case"Identifier":return function(){return t.getScopeDataFromName(e.name,t.getCurrentScope())};case"MemberExpression":return this.createClosure(e.object);default:throw this.createInternalThrowError(_K.AssignmentTypeSyntaxError,e.type,e)}},t.createNameGetter=function(e){switch(e.type){case"Identifier":return function(){return e.name};case"MemberExpression":return this.createMemberKeyGetter(e);default:throw this.createInternalThrowError(_K.AssignmentTypeSyntaxError,e.type,e)}},t.varDeclaration=function(e){this.collectDeclVars[e]=void 0},t.funcDeclaration=function(e,t){this.collectDeclFuncs[e]=t},t.addDeclarationsToScope=function(e,t,n){var r=n.data;for(var i in t){var o=t[i];r[i]=o?o():o}for(var a in e)a in r||(r[a]=void 0)},t.getScopeValue=function(e,t){return this.getScopeFromName(e,t).data[e]},t.getScopeDataFromName=function(e,t){return this.getScopeFromName(e,t).data},t.getScopeFromName=function(e,t){var n=t;do{if(e in n.data)return n}while(n=n.parent);return this.globalScope},t.setValue=function(e){var t=this.callStack.length;return this.isVarDeclMode||t||e===kK||e===TK||e===wK||e instanceof zK||e instanceof BK||(this.value=e instanceof FK?e.value:e),e},t.getValue=function(){return this.value},e}();HK.version="0.0.3",HK.eval=NK,HK.Function=DK,HK.ecmaVersion=5,HK.globalContextInFunction=void 0,HK.global=Object.create(null);var WK,YK,XK=function(e,t,n){return function(e,t,n){return new HK(t,n).evaluate(e)}(e,t,n)},ZK=O((function(e,t){e.exports=function(e){var t=["WEBGL_depth_texture","OES_texture_float","OES_vertex_array_object","OES_standard_derivatives","OES_element_index_uint","EXT_frag_depth","EXT_blend_minmax","EXT_shader_texture_lod","ANGLE_instanced_arrays","WEBGL_draw_buffers"],n=function(e){return"WebGL2RenderingContext"===e.__proto__.constructor.name},r=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},i=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function o(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function a(e){var t=new Error("(regl) "+e);throw console.error(t),t}function s(e,t){e||a(t)}function u(e){return e?": "+e:""}function c(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"===C(e);case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"===C(e)}}function l(e,t,n){t.indexOf(e)<0&&a("invalid value"+u(n)+". must be one of: "+t)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function f(e,t){for(e+="";e.length<t;)e=" "+e;return e}function p(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function d(e,t){this.number=e,this.line=t,this.errors=[]}function v(e,t,n){this.file=e,this.line=t,this.message=n}function g(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function m(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function y(e,t){var n=e.split("\n"),r=1,i=0,a={unknown:new p,0:new p};a.unknown.name=a[0].name=t||g(),a.unknown.lines.push(new d(0,""));for(var s=0;s<n.length;++s){var u=n[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(r=0|l[1],l[2]&&((i=0|l[2])in a||(a[i]=new p)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);h&&(a[i].name=h[1]?o(h[2]):h[2])}a[i].lines.push(new d(r++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function _(e){e._commandRef=g()}function b(e,t){var n=m();a(e+" in command "+(t||g())+("unknown"===n?"":" called from "+n))}function x(e,t,n,r){c(e,t)||b("invalid parameter type"+u(n)+". expected "+t+", got "+C(e),r||g())}var S={};function E(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:S[e]*t}function A(e){return!(e&e-1||!e)}S[5120]=S[5121]=1,S[5122]=S[5123]=S[36193]=S[33635]=S[32819]=S[32820]=2,S[5124]=S[5125]=S[5126]=S[34042]=4;var T=i(s,{optional:function(e){e()},raise:a,commandRaise:b,command:function(e,t,n){e||b(t,n||g())},parameter:function(e,t,n){e in t||a("unknown parameter ("+e+")"+u(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||b("unknown parameter ("+e+")"+u(n)+". possible values: "+Object.keys(t).join(),r||g())},constructor:function(e){Object.keys(e).forEach((function(e){h.indexOf(e)<0&&a('invalid regl constructor argument "'+e+'". must be one of '+h)}))},type:function(e,t,n){c(e,t)||a("invalid parameter type"+u(n)+". expected "+t+", got "+C(e))},commandType:x,isTypedArray:function(e,t){r(e)||a("invalid parameter type"+u(t)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||a("invalid parameter type, ("+e+")"+u(t)+". must be a nonnegative integer")},oneOf:l,shaderError:function(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),a=r===e.FRAGMENT_SHADER?"fragment":"vertex";x(n,"string",a+" shader source must be a string",i);var u=y(n,i),c=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new v(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new v("unknown",0,e))}})),t}(o);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,c),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(f(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(f("| ",6)),i(f("^^^",t+3)+"\n","font-weight:bold"),i(f("| ",6)),i(r+"\n","font-weight:bold")})),i(f("| ",6)+"\n")}else i(f(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),s.raise("Error compiling "+a+" shader, "+u[0].name)}},linkError:function(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),a=y(n,i),u='Error linking program with vertex shader, "'+y(r,i)[0].name+'", and fragment shader "'+a[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+o),s.raise(u)}},callSite:m,saveCommandRef:_,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}_(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?l(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):l(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:g,texture2D:function(e,t,n){var r,i=t.width,o=t.height,a=t.channels;s(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||s(A(i)&&A(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&s(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(s(A(i)&&A(o),"texture must be a square power of 2 to support mipmapping"),s(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&s(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),s(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=o>>r;s(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(s(h.width===c&&h.height===l,"invalid shape for mip images"),s(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(E(h.type,a)*c/h.unpackAlignment)*h.unpackAlignment;s(h.data.byteLength===f*l,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||s(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&s(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var i=e.width,o=e.height,a=e.channels;s(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),s(i===o,"cube map must be square"),s(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];s(c.width===i&&c.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(s(!c.compressed,"can not generate mipmap for compressed textures"),s(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,h=0;h<16;++h){var f=l[h];if(f){var p=i>>h,d=o>>h;s(c.mipmask&1<<h,"missing mipmap data"),s(f.width===p&&f.height===d,"invalid shape for mip images"),s(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?s(f.data.byteLength===p*d*Math.max(E(f.type,a),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),w=0;function k(e,t){this.id=w++,this.type=e,this.data=t}function M(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function P(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+M(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+M(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var I={DynamicVariable:k,define:function(e,t){return new k(e,P(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof k},unbox:function e(t,n){return"function"==typeof t?new k(0,t):"number"==typeof t||"boolean"==typeof t?new k(5,t):Array.isArray(t)?new k(6,t.map((function(t,r){return e(t,n+"["+r+"]")}))):t instanceof k?t:void T(!1,"invalid option type in uniform "+n)},accessor:P},R={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},O="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function L(e){return"string"==typeof e?e.split():(T(Array.isArray(e),"invalid extension array"),e)}function N(e){return"string"==typeof e?(T("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function D(e){var t,n,r,o,a=e||{},s={},u=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,h=!1,f=function(e){e&&T.raise(e)},p=function(){};if("string"==typeof a?(T("undefined"!=typeof document,"selector queries only supported in DOM environments"),t=document.querySelector(a),T(t,"invalid query string for element")):"object"===C(a)?function(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}(a)?t=a:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(a)?r=(o=a).canvas:(T.constructor(a),"gl"in a?o=a.gl:"canvas"in a?r=N(a.canvas):"container"in a&&(n=N(a.container)),"attributes"in a&&(s=a.attributes,T.type(s,"object","invalid context attributes")),"extensions"in a&&(u=L(a.extensions)),"optionalExtensions"in a&&(c=L(a.optionalExtensions)),"onDone"in a&&(T.type(a.onDone,"function","invalid or missing onDone callback"),f=a.onDone),"profile"in a&&(h=!!a.profile),"pixelRatio"in a&&(l=+a.pixelRatio,T(l>0,"invalid pixel ratio"))):T.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!o){if(!r){T("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=function(e,t,n){var r,o=document.createElement("canvas");function a(){var t=window.innerWidth,r=window.innerHeight;if(e!==document.body){var i=o.getBoundingClientRect();t=i.right-i.left,r=i.bottom-i.top}o.width=n*t,o.height=n*r}return i(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(o),e===document.body&&(o.style.position="absolute",i(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(r=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){r?r.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(n||document.body,0,l);if(!d)return null;r=d.canvas,p=d.onDestroy}void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!0),(o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl2")||n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(r,s)).getExtension("OES_standard_derivatives")}return o?{gl:o,canvas:r,container:n,extensions:u,optionalExtensions:c,pixelRatio:l,profile:h,onDone:f,onDestroy:p}:(p(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function F(e,r){var i={};function o(r){T.type(r,"string","extension name must be string");var o,a=r.toLowerCase();try{o=i[a]=function(r){return e.getExtension(r)?e.getExtension(r):e.getExtension(r.toLowerCase())?e.getExtension(r.toLowerCase()):n(e)&&t.includes(r)?{}:null}(r)}catch(e){}return!!o}for(var a=0;a<r.extensions.length;++a){var s=r.extensions[a];if(!o(s))return r.onDestroy(),r.onDone('"'+s+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return r.optionalExtensions.forEach(o),{extensions:i,restore:function(){Object.keys(i).forEach((function(e){if(i[e]&&!o(e))throw new Error("(regl): error restoring extension "+e)}))}}}function z(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function B(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function j(){var e=z(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[B(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[B(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var U=j();function V(e){return!!e&&"object"===C(e)&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||r(e.data))}U.zero=j();var G=function(e){return Object.keys(e).map((function(t){return e[t]}))},H={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||U.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:W(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(n.length-r==4){var c=n[r+1],l=n[r+2],h=n[r+3];for(s=0;s<u;++s)W(t[s],c,l,h,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function W(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],c=0;c<n;++c)for(var l=u[c],h=0;h<r;++h)i[a++]=l[h]}var Y={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},X={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Z={dynamic:35048,stream:35040,static:35044},q=H.flatten,K=H.shape,Q=[];function $(e){return 0|Y[Object.prototype.toString.call(e)]}function J(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function ee(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}Q[5120]=1,Q[5122]=2,Q[5124]=4,Q[5121]=1,Q[5123]=2,Q[5125]=4,Q[5126]=4;var te={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ne=new Float32Array(1),re=new Uint32Array(ne.buffer);function ie(e){for(var t=U.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{ne[0]=e[n];var r=re[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function oe(e){return Array.isArray(e)||r(e)}var ae=function(e){return!(e&e-1||!e)},se=[9984,9986,9985,9987],ue=[0,6409,6410,6407,6408],ce={};function le(e){return"[object "+e+"]"}ce[6409]=ce[6406]=ce[6402]=1,ce[34041]=ce[6410]=2,ce[6407]=ce[35904]=3,ce[6408]=ce[35906]=4;var he=le("HTMLCanvasElement"),fe=le("OffscreenCanvas"),pe=le("CanvasRenderingContext2D"),de=le("ImageBitmap"),ve=le("HTMLImageElement"),ge=le("HTMLVideoElement"),me=Object.keys(Y).concat([he,fe,pe,de,ve,ge]),ye=[];ye[5121]=1,ye[5126]=4,ye[36193]=2,ye[5123]=2,ye[5125]=4;var _e=[];function be(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function xe(e){return!!Array.isArray(e)&&!(0===e.length||!oe(e[0]))}function Se(e){return Object.prototype.toString.call(e)}function Ee(e){return Se(e)===he}function Ae(e){return Se(e)===fe}function Te(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&e.getContext)}function we(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&"src"in e&&"crossOrigin"in e)}function Ce(e){if(!e)return!1;if(Te(e)||we(e))return!0;var t=Se(e);return me.indexOf(t)>=0||be(e)||xe(e)||V(e)}function ke(e){return 0|Y[Object.prototype.toString.call(e)]}function Me(e,t){return U.allocType(36193===e.type?5126:e.type,t)}function Pe(e,t){36193===e.type?(e.data=ie(t),U.freeType(t)):e.data=t}function Ie(e,t,n,r,i,o){var a;if(a=void 0!==_e[e]?_e[e]:ce[e]*ye[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Re(e,t,n,o,a,s,u){var c={"don't care":4352,"dont care":4352,nice:4354,fast:4353},l={repeat:10497,clamp:33071,mirror:33648},h={nearest:9728,linear:9729},f=i({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},h),p={none:0,browser:37444},d={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};t.ext_srgb&&(v.srgb=35904,v.srgba=35906),t.oes_texture_float&&(d.float32=d.float=5126),t.oes_texture_half_float&&(d.float16=d["half float"]=36193),t.webgl_depth_texture&&(i(v,{depth:6402,"depth stencil":34041}),i(d,{uint16:5123,uint32:5125,"depth stencil":34042})),t.webgl_compressed_texture_s3tc&&i(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),t.webgl_compressed_texture_atc&&i(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),t.webgl_compressed_texture_pvrtc&&i(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),t.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(e.getParameter(34467)||new Uint32Array(0));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);n.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var b=[];Object.keys(d).forEach((function(e){var t=d[e];b[t]=e}));var x=[];Object.keys(h).forEach((function(e){x[h[e]]=e}));var S=[];Object.keys(f).forEach((function(e){var t=f[e];S[t]=e}));var E=[];Object.keys(l).forEach((function(e){E[l[e]]=e}));var A=y.reduce((function(e,n){var r=v[n];return 6409===r||6406===r||6409===r||6410===r||6402===r||34041===r||t.ext_srgb&&(35904===r||35906===r)?e[r]=r:32855===r||n.indexOf("rgba")>=0?e[r]=6408:e[r]=6407,e}),{});function w(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function k(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,r){if("object"===C(r)&&r){if("premultiplyAlpha"in r&&(T.type(r.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=r.premultiplyAlpha),"flipY"in r&&(T.type(r.flipY,"boolean","invalid texture flip"),e.flipY=r.flipY),"alignment"in r&&(T.oneOf(r.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=r.alignment),"colorSpace"in r&&(T.parameter(r.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[r.colorSpace]),"type"in r){var i=r.type;T(t.oes_texture_float||!("float"===i||"float32"===i),"you must enable the OES_texture_float extension in order to use floating point textures."),T(t.oes_texture_half_float||!("half float"===i||"float16"===i),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),T(t.webgl_depth_texture||!("uint16"===i||"uint32"===i||"depth stencil"===i),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),T.parameter(i,d,"invalid texture type"),e.type=d[i]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in r?(T(Array.isArray(r.shape)&&r.shape.length>=2,"shape must be an array"),o=r.shape[0],a=r.shape[1],3===r.shape.length&&(s=r.shape[2],T(s>0&&s<=4,"invalid number of channels"),u=!0),T(o>=0&&o<=n.maxTextureSize,"invalid width"),T(a>=0&&a<=n.maxTextureSize,"invalid height")):("radius"in r&&(o=a=r.radius,T(o>=0&&o<=n.maxTextureSize,"invalid radius")),"width"in r&&(o=r.width,T(o>=0&&o<=n.maxTextureSize,"invalid width")),"height"in r&&(a=r.height,T(a>=0&&a<=n.maxTextureSize,"invalid height")),"channels"in r&&(s=r.channels,T(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var c=!1;if("format"in r){var l=r.format;T(t.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),T.parameter(l,v,"invalid texture format");var h=e.internalformat=v[l];e.format=A[h],l in d&&("type"in r||(e.type=d[l])),l in g&&(e.compressed=!0),c=!0}!u&&c?e.channels=ce[e.format]:u&&!c?e.channels!==ue[e.format]&&(e.format=e.internalformat=ue[e.channels]):c&&u&&T(e.channels===ce[e.format],"number of channels inconsistent with specified format")}}function P(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function I(){w.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function R(e,t){var i=null;if(Ce(t)?i=t:t&&(T.type(t,"object","invalid pixel data type"),M(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),Ce(t.data)&&(i=t.data)),T(!e.compressed||i instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),t.copy){T(!i,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,T(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(i){if(r(i))e.channels=e.channels||4,e.data=i,"type"in t||5121!==e.type||(e.type=ke(i));else if(be(i))e.channels=e.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=U.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=ie(t);break;default:T.raise("unsupported texture type, must specify a typed array")}}(e,i),e.alignment=1,e.needsFree=!0;else if(V(i)){var u=i.data;Array.isArray(u)||5121!==e.type||(e.type=ke(u));var c,l,h,f,p,d,v=i.shape,g=i.stride;3===v.length?(h=v[2],d=g[2]):(T(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),c=v[0],l=v[1],f=g[0],p=g[1],e.alignment=1,e.width=c,e.height=l,e.channels=h,e.format=e.internalformat=ue[h],e.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,c=Me(e,a*s*u),l=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)c[l++]=t[n*f+r*h+i*p+o];Pe(e,c)}(e,u,f,p,d,i.offset)}else if(Te(i)||Ee(i)||Ae(i)||function(e){return Se(e)===pe}(i))Te(i)||Ee(i)||Ae(i)?e.element=i:e.element=i.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(function(e){return Se(e)===de}(i))e.element=i,e.width=i.width,e.height=i.height,e.channels=4;else if(function(e){return Se(e)===ve}(i))e.element=i,e.width=i.naturalWidth,e.height=i.naturalHeight,e.channels=4;else if(we(i))e.element=i,e.width=i.width,e.height=i.height,e.channels=4;else if(function(e){return Se(e)===ge}(i))e.element=i,e.width=i.videoWidth,e.height=i.videoHeight,e.channels=4;else if(xe(i)){var m=e.width||i[0].length,y=e.height||i.length,_=e.channels;_=oe(i[0][0])?_||i[0][0].length:_||1;for(var b=H.shape(i),x=1,S=0;S<b.length;++S)x*=b[S];var E=Me(e,x);H.flatten(i,b,"",E),Pe(e,E),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=ue[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;5126===e.type?T(n.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===e.type&&T(n.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(t,n,r){var i=t.element,a=t.data,s=t.internalformat,u=t.format,c=t.type,l=t.width,h=t.height;P(t),i?e.texImage2D(n,r,u,u,c,i):t.compressed?e.compressedTexImage2D(n,r,s,l,h,0,a):t.needsCopy?(o(),e.copyTexImage2D(n,r,u,t.xOffset,t.yOffset,l,h,0)):e.texImage2D(n,r,u,l,h,0,u,c,a||null)}function L(t,n,r,i,a){var s=t.element,u=t.data,c=t.internalformat,l=t.format,h=t.type,f=t.width,p=t.height;P(t),s?e.texSubImage2D(n,a,r,i,l,h,s):t.compressed?e.compressedTexSubImage2D(n,a,r,i,c,f,p,u):t.needsCopy?(o(),e.copyTexSubImage2D(n,a,r,i,t.xOffset,t.yOffset,f,p)):e.texSubImage2D(n,a,r,i,f,p,l,h,u)}var N=[];function D(){return N.pop()||new I}function F(e){e.needsFree&&U.freeType(e.data),I.call(e),N.push(e)}function z(){w.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function B(e,t,n){var r=e.images[0]=D();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function j(e,t){var n=null;if(Ce(t))k(n=e.images[0]=D(),e),R(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)k(n=e.images[i]=D(),e),n.width>>=i,n.height>>=i,R(n,r[i]),e.mipmask|=1<<i;else k(n=e.images[0]=D(),e),R(n,t),e.mipmask=1;k(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||T(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function W(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],t,r)}}var Y=[];function X(){var e=Y.pop()||new z;w.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Z(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&F(t[n]),t[n]=null;Y.push(e)}function q(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function K(e,t){if("min"in t){var r=t.min;T.parameter(r,f),e.minFilter=f[r],se.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var i=t.mag;T.parameter(i,h),e.magFilter=h[i]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(T.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(T.parameter(s[0],l),T.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;T.parameter(u,l),o=l[u]}if("wrapT"in t){var p=t.wrapT;T.parameter(p,l),a=l[p]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;T("number"==typeof d&&d>=1&&d<=n.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(C(t.mipmap)){case"string":T.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":T(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:T.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function Q(n,r){e.texParameteri(r,10241,n.minFilter),e.texParameteri(r,10240,n.magFilter),e.texParameteri(r,10242,n.wrapS),e.texParameteri(r,10243,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,34046,n.anisotropic),n.genMipmaps&&(e.hint(33170,n.mipmapHint),e.generateMipmap(r))}var $=0,J={},ee=n.maxTextureUnits,te=Array(ee).map((function(){return null}));function ne(t){w.call(this),this.mipmask=0,this.internalformat=6408,this.id=$++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,u.profile&&(this.stats={size:0})}function re(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function le(){var t=te[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function he(t){var n=t.texture;T(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(33984+r),e.bindTexture(i,null),te[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete J[t.id],s.textureCount--}return i(ne.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(t<0){for(var n=0;n<ee;++n){var r=te[n];if(r){if(r.bindCount>0)continue;r.unit=-1}te[n]=this,t=n;break}t>=ee&&T.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&he(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(t,r){var i=new ne(3553);function o(e,t){var r=i.texInfo;q.call(r);var a=X();return"number"==typeof e?B(a,0|e,"number"==typeof t?0|t:0|e):e?(T.type(e,"object","invalid arguments to regl.texture"),K(r,e),j(a,e)):B(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),i.mipmask=a.mipmask,k(i,a),T.texture2D(r,a,n),i.internalformat=a.internalformat,o.width=a.width,o.height=a.height,re(i),W(a,3553),Q(r,3553),le(),Z(a),u.profile&&(i.stats.size=Ie(i.internalformat,i.type,a.width,a.height,r.genMipmaps,!1)),o.format=_[i.internalformat],o.type=b[i.type],o.mag=x[r.magFilter],o.min=S[r.minFilter],o.wrapS=E[r.wrapS],o.wrapT=E[r.wrapT],o}return J[i.id]=i,s.textureCount++,o(t,r),o.subimage=function(e,t,n,r){T(!!e,"must specify image data");var a=0|t,s=0|n,u=0|r,c=D();return k(c,i),c.width=0,c.height=0,R(c,e),c.width=c.width||(i.width>>u)-a,c.height=c.height||(i.height>>u)-s,T(i.type===c.type&&i.format===c.format&&i.internalformat===c.internalformat,"incompatible format for texture.subimage"),T(a>=0&&s>=0&&a+c.width<=i.width&&s+c.height<=i.height,"texture.subimage write out of bounds"),T(i.mipmask&1<<u,"missing mipmap data"),T(c.data||c.element||c.needsCopy,"missing image data"),re(i),L(c,3553,a,s,u),le(),F(c),o},o.resize=function(t,n){var r=0|t,a=0|n||r;if(r===i.width&&a===i.height)return o;o.width=i.width=r,o.height=i.height=a,re(i);for(var s=0;i.mipmask>>s;++s){var c=r>>s,l=a>>s;if(!c||!l)break;e.texImage2D(3553,s,i.format,c,l,0,i.format,i.type,null)}return le(),u.profile&&(i.stats.size=Ie(i.internalformat,i.type,r,a,!1,!1)),o},o._reglType="texture2d",o._texture=i,u.profile&&(o.stats=i.stats),o.destroy=function(){i.decRef()},o},createCube:function(t,r,i,o,a,c){var l=new ne(34067);J[l.id]=l,s.cubeCount++;var h=new Array(6);function f(e,t,r,i,o,a){var s,c=l.texInfo;for(q.call(c),s=0;s<6;++s)h[s]=X();if("number"!=typeof e&&e)if("object"===C(e))if(t)j(h[0],e),j(h[1],t),j(h[2],r),j(h[3],i),j(h[4],o),j(h[5],a);else if(K(c,e),M(l,e),"faces"in e){var p=e.faces;for(T(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)T("object"===C(p[s])&&!!p[s],"invalid input for cube map face"),k(h[s],l),j(h[s],p[s])}else for(s=0;s<6;++s)j(h[s],e);else T.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)B(h[s],d,d)}for(k(l,h[0]),T.optional((function(){n.npotTextureCube||T(ae(l.width)&&ae(l.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?l.mipmask=(h[0].width<<1)-1:l.mipmask=h[0].mipmask,T.textureCube(l,c,h,n),l.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,re(l),s=0;s<6;++s)W(h[s],34069+s);for(Q(c,34067),le(),u.profile&&(l.stats.size=Ie(l.internalformat,l.type,f.width,f.height,c.genMipmaps,!0)),f.format=_[l.internalformat],f.type=b[l.type],f.mag=x[c.magFilter],f.min=S[c.minFilter],f.wrapS=E[c.wrapS],f.wrapT=E[c.wrapT],s=0;s<6;++s)Z(h[s]);return f}return f(t,r,i,o,a,c),f.subimage=function(e,t,n,r,i){T(!!t,"must specify image data"),T("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return k(u,l),u.width=0,u.height=0,R(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,T(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),T(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),T(l.mipmask&1<<s,"missing mipmap data"),T(u.data||u.element||u.needsCopy,"missing image data"),re(l),L(u,34069+e,o,a,s),le(),F(u),f},f.resize=function(t){var n=0|t;if(n!==l.width){f.width=l.width=n,f.height=l.height=n,re(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)e.texImage2D(34069+r,i,l.format,n>>i,n>>i,0,l.format,l.type,null);return le(),u.profile&&(l.stats.size=Ie(l.internalformat,l.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=l,u.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){for(var t=0;t<ee;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),te[t]=null;G(J).forEach(he),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<ee;++t){var n=te[t];n&&(n.bindCount=0,n.unit=-1,te[t]=null)}G(J).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);Q(t.texInfo,t.target)}))},refresh:function(){for(var t=0;t<ee;++t){var n=te[t];n&&(n.bindCount=0,n.unit=-1,te[t]=null),e.activeTexture(33984+t),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}_e[32854]=2,_e[32855]=2,_e[36194]=2,_e[34041]=4,_e[33776]=.5,_e[33777]=.5,_e[33778]=1,_e[33779]=1,_e[35986]=.5,_e[35987]=1,_e[34798]=1,_e[35840]=.5,_e[35841]=.25,_e[35842]=.5,_e[35843]=.25,_e[36196]=.5;var Oe=[];function Le(e,t,n){return Oe[e]*t*n}Oe[32854]=2,Oe[32855]=2,Oe[36194]=2,Oe[33189]=2,Oe[36168]=1,Oe[34041]=4,Oe[35907]=4,Oe[34836]=16,Oe[34842]=8,Oe[34843]=6;var Ne=[6407,6408],De=[];De[6408]=4,De[6407]=3;var Fe=[];Fe[5121]=1,Fe[5126]=4,Fe[36193]=2;var ze=[32854,32855,36194,35907,34842,34843,34836],Be={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},je=["attributes","elements","offset","count","primitive","instances"];function Ue(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function Ve(e,t,n,i,o,a,s){function u(u){var c;null===t.next?(T(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=5121):(T(null!==t.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=t.next.colorAttachments[0].texture._texture.type,T.optional((function(){a.oes_texture_float?(T(5121===c||5126===c,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===c&&T(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):T(5121===c,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;r(u)?d=u:u&&(T.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,h=0|u.y,T(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),T(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-l),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(5121===c?T(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===c&&T(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),T(f>0&&f+l<=i.framebufferWidth,"invalid width for read pixels"),T(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),n();var v=f*p*4;return d||(5121===c?d=new Uint8Array(v):5126===c&&(d=d||new Float32Array(v))),T.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),T(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(3333,4),e.readPixels(l,h,f,p,6408,c,d),d}return function(e){return e&&"framebuffer"in e?function(e){var n;return t.setFBO({framebuffer:e.framebuffer},(function(){n=u(e)})),n}(e):u(e)}}function Ge(e){return Array.prototype.slice.call(e)}function He(e){return Ge(e).join("")}var We="xyzw".split(""),Ye="profile",Xe="framebuffer",Ze="vert",qe="frag",Ke="elements",Qe="primitive",$e="count",Je="offset",et="instances",tt="vao",nt=Xe+"Width",rt=Xe+"Height",it=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],ot={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},at=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],st={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ut={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ct={frag:35632,vert:35633},lt={cw:2304,ccw:2305};function ht(e){return Array.isArray(e)||r(e)||V(e)}function ft(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function pt(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function dt(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function vt(e){return new pt(!1,!1,!1,e)}function gt(e,t){var n=e.type;if(0===n){var r=e.data.length;return new pt(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new pt(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new pt(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var c=e.data[u];if(1===c.type)s=!0;else if(2===c.type)a=!0;else if(3===c.type)o=!0;else if(0===c.type){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else 4===c.type&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new pt(o,a,s,t)}return new pt(3===n,2===n,1===n,t)}var mt=new pt(!1,!1,!1,(function(){}));function yt(t,r,o,a,s,u,c,l,h,f,p,d,v,g,m){var y=f.Record,_={add:32774,subtract:32778,"reverse subtract":32779};o.ext_blend_minmax&&(_.min=32775,_.max=32776);var b=o.angle_instanced_arrays,x=o.webgl_draw_buffers,S=o.oes_vertex_array_object,E={dirty:!0,profile:m.profile},A={},w=[],k={},M={};function P(e){return e.replace(".","_")}function R(e,t,n){var r=P(e);w.push(e),A[r]=E[r]=!!n,k[r]=t}function O(e,t,n){var r=P(e);w.push(e),Array.isArray(n)?(E[r]=n.slice(),A[r]=n.slice()):E[r]=A[r]=n,M[r]=t}R("dither",3024),R("blend.enable",3042),O("blend.color","blendColor",[0,0,0,0]),O("blend.equation","blendEquationSeparate",[32774,32774]),O("blend.func","blendFuncSeparate",[1,0,1,0]),R("depth.enable",2929,!0),O("depth.func","depthFunc",513),O("depth.range","depthRange",[0,1]),O("depth.mask","depthMask",!0),O("colorMask","colorMask",[!0,!0,!0,!0]),R("cull.enable",2884),O("cull.face","cullFace",1029),O("frontFace","frontFace",2305),O("lineWidth","lineWidth",1),R("polygonOffset.enable",32823),O("polygonOffset.offset","polygonOffset",[0,0]),R("sample.alpha",32926),R("sample.enable",32928),O("sample.coverage","sampleCoverage",[1,!1]),R("stencil.enable",2960),O("stencil.mask","stencilMask",-1),O("stencil.func","stencilFunc",[519,0,-1]),O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),R("scissor.enable",3089),O("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),O("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var L={gl:t,context:v,strings:r,next:A,current:E,draw:d,elements:u,buffer:s,shader:p,attributes:f.state,vao:f,uniforms:h,framebuffer:l,extensions:o,timer:g,isBufferArgs:ht},N={primTypes:te,compareFuncs:st,blendFuncs:ot,blendEquations:_,stencilOps:ut,glTypes:X,orientationType:lt};T.optional((function(){L.isArrayLike=oe})),x&&(N.backBuffer=[1029],N.drawBuffer=z(a.maxDrawbuffers,(function(e){return 0===e?[0]:z(e,(function(e){return 36064+e}))})));var D=0;function F(){var t=function(){var t=0,n=[],r=[];function o(){var e=[],n=[];return i((function(){e.push.apply(e,Ge(arguments))}),{def:function(){var r="v"+t++;return n.push(r),arguments.length>0&&(e.push(r,"="),e.push.apply(e,Ge(arguments)),e.push(";")),r},toString:function(){return He([n.length>0?"var "+n.join(",")+";":"",He(e)])}})}function a(){var e=o(),t=o(),n=e.toString,r=t.toString;function a(n,r){t(n,r,"=",e.def(n,r),";")}return i((function(){e.apply(e,Ge(arguments))}),{def:e.def,entry:e,exit:t,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return n()+r()}})}var s=o(),u={};return{global:s,link:function(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var o="g"+t++;return n.push(o),r.push(e),o},block:o,proc:function(e,t){var n=[];function r(){var e="a"+n.length;return n.push(e),e}t=t||0;for(var o=0;o<t;++o)r();var s=a(),c=s.toString;return u[e]=i(s,{arg:r,toString:function(){return He(["function(",n.join(),"){",c(),"}"])}})},scope:a,cond:function(){var e=He(arguments),t=a(),n=a(),r=t.toString,o=n.toString;return i(t,{then:function(){return t.apply(t,Ge(arguments)),this},else:function(){return n.apply(n,Ge(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),He(["if(",e,"){",r(),"}",t])}})},compile:function(){var t=['"use strict";',s,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var i=He(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?e.Function.apply(null,n.concat(i)):Function.apply(null,n.concat(i))).apply(null,r)}}}(),n=t.link,o=t.global;t.id=D++,t.batchId="0";var a=n(L),s=t.shared={props:"a0"};Object.keys(L).forEach((function(e){s[e]=o.def(a,".",e)})),T.optional((function(){t.CHECK=n(T),t.commandStr=T.guessCommand(),t.command=n(t.commandStr),t.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},N.invalidBlendCombinations=at}));var u=t.next={},c=t.current={};Object.keys(M).forEach((function(e){Array.isArray(E[e])&&(u[e]=o.def(s.next,".",e),c[e]=o.def(s.current,".",e))}));var l=t.constants={};Object.keys(N).forEach((function(e){l[e]=o.def(JSON.stringify(N[e]))})),t.invoke=function(e,r){switch(r.type){case 0:var i=["this",s.context,s.props,t.batchId];return e.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case 1:return e.def(s.props,r.data);case 2:return e.def(s.context,r.data);case 3:return e.def("this",r.data);case 4:return r.data.append(t,e),r.data.ref;case 5:return r.data.toString();case 6:return r.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var h={};return t.scopeAttrib=function(e){var t=r.id(e);if(t in h)return h[t];var i=f.scope[t];return i||(i=f.scope[t]=new y),h[t]=n(i)},t}function B(e,t,n,i,c){var h=e.static,d=e.dynamic;T.optional((function(){var e=[Xe,Ze,qe,Ke,Qe,Je,$e,et,Ye,tt].concat(w);function t(t){Object.keys(t).forEach((function(t){T.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',c.commandStr)}))}t(h),t(d)}));var v=function(e,t){var n=e.static;if("string"==typeof n[qe]&&"string"==typeof n[Ze]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)T("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),g=function(e,t){var n=e.static,r=e.dynamic;if(Xe in n){var i=n[Xe];return i?(i=l.getFramebuffer(i),T.command(i,"invalid framebuffer object"),vt((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+nt,n+".width"),t.set(o,"."+rt,n+".height"),n}))):vt((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+nt,r+".drawingBufferWidth"),t.set(r,"."+rt,r+".drawingBufferHeight"),"null"}))}if(Xe in r){var o=r[Xe];return gt(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");T.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+nt,a+"?"+a+".width:"+s+".drawingBufferWidth"),t.set(s,"."+rt,a+"?"+a+".height:"+s+".drawingBufferHeight"),a}))}return null}(e),m=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];T.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,T.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,T.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new pt(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",nt,"-",c));var i=s;return"height"in o||(i=t.def(n,".",rt,"-",l)),[c,l,r,i]}))}if(e in i){var h=i[e],f=gt(h,(function(t,n){var r=t.invoke(n,h);T.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",nt,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",rt,"-",a,")");return T.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new pt(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",nt),t.def(n,".",rt)]})):null}var a=o("viewport");if(a){var s=a;a=new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o("scissor.box")}}(e,g,c),x=function(e,t){var n=e.static,r=e.dynamic,i={},o=!1,a=function(){if(tt in n){var e=n[tt];return null!==e&&null===f.getVAO(e)&&(e=f.createVAO(e)),o=!0,i.vao=e,vt((function(t){var n=f.getVAO(e);return n?t.link(n):"null"}))}if(tt in r){o=!0;var t=r[tt];return gt(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}(),s=!1,c=function(){if(Ke in n){var e=n[Ke];if(i.elements=e,ht(e)){var c=i.elements=u.create(e,!0);e=u.getElements(c),s=!0}else e&&(e=u.getElements(e),s=!0,T.command(e,"invalid elements",t.commandStr));var l=vt((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return l.value=e,l}if(Ke in r){s=!0;var h=r[Ke];return gt(h,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,h),a=t.def("null"),s=t.def(r,"(",o,")"),u=e.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return T.optional((function(){e.assert(u.else,"!"+o+"||"+a,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",a,");")),e.ELEMENTS=a,a}))}return o?new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}();function l(e,u){if(e in n){var c=0|n[e];return u?i.offset=c:i.instances=c,T.command(!u||c>=0,"invalid "+e,t.commandStr),vt((function(e,t){return u&&(e.OFFSET=c),c}))}if(e in r){var l=r[e];return gt(l,(function(t,n){var r=t.invoke(n,l);return u&&(t.OFFSET=r,T.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(u){if(s)return vt((function(e,t){return e.OFFSET=0,0}));if(o)return new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(o)return new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var h=l(Je,!0),p=function(){if(Qe in n){var e=n[Qe];return i.primitive=e,T.commandParameter(e,te,"invalid primitve",t.commandStr),vt((function(t,n){return te[e]}))}if(Qe in r){var u=r[Qe];return gt(u,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,u);return T.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(te))})),t.def(n,"[",r,"]")}))}return s?dt(c)?c.value?vt((function(e,t){return t.def(e.ELEMENTS,".primType")})):vt((function(){return 4})):new pt(c.thisDep,c.contextDep,c.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):o?new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if($e in n){var e=0|n[$e];return i.count=e,T.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),vt((function(){return e}))}if($e in r){var u=r[$e];return gt(u,(function(e,t){var n=e.invoke(t,u);return T.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(s){if(dt(c)){if(c)return h?new pt(h.thisDep,h.contextDep,h.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return T.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):vt((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var l=vt((function(){return-1}));return T.optional((function(){l.MISSING=!0})),l}var f=new pt(c.thisDep||h.thisDep,c.contextDep||h.contextDep,c.propDep||h.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return T.optional((function(){f.DYNAMIC=!0})),f}return o?new pt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}(),v=l(et,!1);return{elements:c,primitive:p,count:d,instances:v,offset:h,vao:a,vaoActive:o,elementsActive:s,static:i}}(e,c),S=function(e,t){var n=e.static,r=e.dynamic,i={};return w.forEach((function(e){var o=P(e);function s(t,a){if(e in n){var s=t(n[e]);i[o]=vt((function(){return s}))}else if(e in r){var u=r[e];i[o]=gt(u,(function(e,t){return a(e,t,e.invoke(t,u))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return T.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return T.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return T.commandParameter(n,st,"invalid "+e,t.commandStr),st[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return T.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(st))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return T.command(oe(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return T.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){T.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,a="dstAlpha"in e?e.dstAlpha:e.dst;return T.commandParameter(n,ot,o+".srcRGB",t.commandStr),T.commandParameter(r,ot,o+".srcAlpha",t.commandStr),T.commandParameter(i,ot,o+".dstRGB",t.commandStr),T.commandParameter(a,ot,o+".dstAlpha",t.commandStr),T.command(-1===at.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[ot[n],ot[i],ot[r],ot[a]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return T.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(ot))})),s}T.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");T.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"==typeof n?(T.commandParameter(n,_,"invalid "+e,t.commandStr),[_[n],_[n]]):"object"===C(n)?(T.commandParameter(n.rgb,_,e+".rgb",t.commandStr),T.commandParameter(n.alpha,_,e+".alpha",t.commandStr),[_[n.rgb],_[n.alpha]]):void T.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return T.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(_))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case"blend.color":return s((function(e){return T.command(oe(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),z(4,(function(t){return+e[t]}))}),(function(e,t,n){return T.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),z(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return T.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,n){return T.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){T.commandType(n,"object",o,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,a="mask"in n?n.mask:-1;return T.commandParameter(r,st,e+".cmp",t.commandStr),T.commandType(i,"number",e+".ref",t.commandStr),T.commandType(a,"number",e+".mask",t.commandStr),[st[r],i,a]}),(function(e,t,n){var r=e.constants.compareFuncs;return T.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){T.commandType(n,"object",o,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",a=n.zpass||"keep";return T.commandParameter(r,ut,e+".fail",t.commandStr),T.commandParameter(i,ut,e+".zfail",t.commandStr),T.commandParameter(a,ut,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,ut[r],ut[i],ut[a]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return T.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(ut))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",7680)}return T.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,o("fail"),o("zfail"),o("zpass")]}));case"polygonOffset.offset":return s((function(e){T.commandType(e,"object",o,t.commandStr);var n=0|e.factor,r=0|e.units;return T.commandType(n,"number",o+".factor",t.commandStr),T.commandType(r,"number",o+".units",t.commandStr),[n,r]}),(function(t,n,r){return T.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),T.command(!!n,o,t.commandStr),n}),(function(e,t,n){return T.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return T.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return T.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+a.lineWidthDims[0]+"&&"+n+"<="+a.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return T.commandParameter(e,lt,o,t.commandStr),lt[e]}),(function(e,t,n){return T.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return T.command(oe(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return T.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),z(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){T.command("object"===C(e)&&e,o,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return T.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return T.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}(e,c),E=function(e,t,n){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=r.id(i[e]);T.optional((function(){p.shader(ct[e],t,T.guessCommand())}));var n=vt((function(){return t}));return n.id=t,n}if(e in o){var a=o[e];return gt(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return T.optional((function(){n(t.shared.shader,".shader(",ct[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(qe),c=a(Ze),l=null;return dt(u)&&dt(c)?(l=p.program(c.id,u.id,null,n),s=vt((function(e,t){return e.link(l)}))):s=new pt(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",qe);var i=r+".program("+(c?c.append(e,t):t.def(r,".",Ze))+","+n;return T.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:c,progVar:s,program:l}}(e,0,v);function A(e){var t=m[e];t&&(S[e]=t)}A("viewport"),A(P("scissor.box"));var k=Object.keys(S).length>0,M={framebuffer:g,draw:x,shader:E,state:S,dirty:k,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(e){var t,n=e.static,r=e.dynamic;if(Ye in n){var i=!!n[Ye];(t=vt((function(e,t){return i}))).enable=i}else if(Ye in r){var o=r[Ye];t=gt(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),M.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=vt((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=vt((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(T.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=vt((function(e){return e.link(o.color[0])}))):T.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else oe(o)?r=vt((function(t){return t.global.def("[",z(o.length,(function(n){return T.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):T.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=gt(t,(function(e,n){return e.invoke(n,t)}))})),i}(n,c),M.drawVAO=M.scopeVAO=x.vao,!M.drawVAO&&E.program&&!v&&o.angle_instanced_arrays&&x.static.elements){var I=!0,R=E.program.attributes.map((function(e){var n=t.static[e];return I=I&&!!n,n}));if(I&&R.length>0){var O=f.getVAO(f.createVAO({attributes:R,elements:x.static.elements}));M.drawVAO=new pt(null,null,null,(function(e,t){return e.link(O)})),M.useVAO=!0}}return v?M.useVAO=!0:M.attributes=function(e,t){var n=e.static,i=e.dynamic,o={};return Object.keys(n).forEach((function(e){var i=n[e],a=r.id(e),u=new y;if(ht(i))u.state=1,u.buffer=s.getBuffer(s.create(i,34962,!1,!0)),u.type=0;else{var c=s.getBuffer(i);if(c)u.state=1,u.buffer=c,u.type=0;else if(T.command("object"===C(i)&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=2,"number"==typeof l?u.x=l:(T.command(oe(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),We.forEach((function(e,t){t<l.length&&(u[e]=l[t])})))}else{c=ht(i.buffer)?s.getBuffer(s.create(i.buffer,34962,!1,!0)):s.getBuffer(i.buffer),T.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;T.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;T.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;T.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,v=0;"type"in i&&(T.commandParameter(i.type,X,"invalid type for attribute "+e,t.commandStr),v=X[i.type]);var g=0|i.divisor;T.optional((function(){"divisor"in i&&(T.command(0===g||b,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),T.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){T.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=1,u.size=p,u.normalized=d,u.type=v||c.dtype,u.offset=h,u.stride=f,u.divisor=g}}o[e]=vt((function(e,t){var n=e.attribCache;if(a in n)return n[a];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[a]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];o[e]=gt(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;T.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new y;l.state=1,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var h=c.buffer,f=c.type;function p(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",h,"=",u,".createStream(",34962,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",2,";","if(typeof "+i+'.constant === "number"){',c[We[0]],"=",i,".constant;",We.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",We.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",34962,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",c.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",h,");","}"),c}))})),o}(t,c),M.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=vt((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=gt(t,(function(e,n){return e.invoke(n,t)}))})),r}(i),M}function j(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function U(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;x&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,c=e.constants,l=c.drawBuffer,h=c.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),x&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),x&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function V(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,c=e.cond(s,".dirty");w.forEach((function(t){var r,l,h=P(t);if(!(h in n.state))if(h in a){r=a[h],l=o[h];var f=z(E[h].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(f.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",M[h],"(",f,");",f.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(u,".",h);var p=e.cond(r,"!==",s,".",h);c(p),h in k?p(e.cond(r).then(i,".enable(",k[h],");").else(i,".disable(",k[h],");"),s,".",h,"=",r,";"):p(i,".",M[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),t(c)}function G(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;ft(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(k[i]){var l=k[i];dt(u)?t(s,c?".enable(":".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(oe(c)){var h=o[i];t(s,".",M[i],"(",c,");",c.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",M[i],"(",c,");",a,".",i,"=",c,";")}}))}function H(e,t){b&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function W(e,t,n,r,i){var o,a,s,u=e.shared,c=e.stats,l=u.current,h=u.timer,f=n.profile;function p(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),g&&(r?e(a=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",c,");"))}function v(e){e(c,".cpuTime+=",p(),"-",o,";"),g&&(r?e(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",c,");"):e(h,".endQuery();"))}function m(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(f){if(dt(f))return void(f.enable?(d(t),v(t.exit),m("true")):m("false"));m(s=f.append(e,t))}else s=t.def(l,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();v(_),t.exit("if(",s,"){",_,"}")}function Y(e,r,i,o,a){var s=e.shared;o.forEach((function(o){var u,c=o.name,l=i.attributes[c];if(l){if(!a(l))return;u=l.append(e,r)}else{if(!a(mt))return;var h=e.scopeAttrib(c);T.optional((function(){e.assert(r,h+".state","missing attribute "+c)})),u={},Object.keys(new y).forEach((function(e){u[e]=r.def(h,".",e)}))}!function(i,o,a){var u=s.gl,c=r.def(i,".location"),l=r.def(s.attributes,"[",c,"]"),h=a.state,f=a.buffer,p=[a.x,a.y,a.z,a.w],d=["buffer","normalized","offset","stride"];function v(){r("if(!",l,".buffer){",u,".enableVertexAttribArray(",c,");}");var i,s=a.type;if(i=a.size?r.def(a.size,"||",o):o,r("if(",l,".type!==",s,"||",l,".size!==",i,"||",d.map((function(e){return l+"."+e+"!=="+a[e]})).join("||"),"){",u,".bindBuffer(",34962,",",f,".buffer);",u,".vertexAttribPointer(",[c,i,s,a.normalized,a.stride,a.offset],");",l,".type=",s,";",l,".size=",i,";",d.map((function(e){return l+"."+e+"="+a[e]+";"})).join(""),"}"),b){var h=a.divisor;n(t)?r("if(",l,".divisor!==",h,"){",u,".vertexAttribDivisor(",[c,h],");",l,".divisor=",h,";}"):r("if(",l,".divisor!==",h,"){",e.instancing,".vertexAttribDivisorANGLE(",[c,h],");",l,".divisor=",h,";}")}}function g(){r("if(",l,".buffer){",u,".disableVertexAttribArray(",c,");",l,".buffer=null;","}if(",We.map((function(e,t){return l+"."+e+"!=="+p[t]})).join("||"),"){",u,".vertexAttrib4f(",c,",",p,");",We.map((function(e,t){return l+"."+e+"="+p[t]+";"})).join(""),"}")}1===h?v():2===h?g():(r("if(",h,"===",1,"){"),v(),r("}else{"),g(),r("}"))}(e.link(o),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(o.info.type),u)}))}function Z(e,t,n,i,o,a){for(var s,u=e.shared,c=u.gl,l=0;l<i.length;++l){var h,f=i[l],p=f.name,d=f.info.type,v=n.uniforms[p],g=e.link(f)+".location";if(v){if(!o(v))continue;if(dt(v)){var m=v.value;if(T.command(null!=m,'missing uniform "'+p+'"',e.commandStr),35678===d||35680===d){T.command("function"==typeof m&&(35678===d&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||35680===d&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,e.commandStr);var y=e.link(m._texture||m.color[0]._texture);t(c,".uniform1i(",g,",",y+".bind());"),t.exit(y,".unbind();")}else if(35674===d||35675===d||35676===d){T.optional((function(){T.command(oe(m),"invalid matrix for uniform "+p,e.commandStr),T.command(35674===d&&4===m.length||35675===d&&9===m.length||35676===d&&16===m.length,"invalid length for matrix uniform "+p,e.commandStr)}));var _=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(c,".uniformMatrix",b,"fv(",g,",false,",_,");")}else{switch(d){case 5126:T.commandType(m,"number","uniform "+p,e.commandStr),s="1f";break;case 35664:T.command(oe(m)&&2===m.length,"uniform "+p,e.commandStr),s="2f";break;case 35665:T.command(oe(m)&&3===m.length,"uniform "+p,e.commandStr),s="3f";break;case 35666:T.command(oe(m)&&4===m.length,"uniform "+p,e.commandStr),s="4f";break;case 35670:T.commandType(m,"boolean","uniform "+p,e.commandStr),s="1i";break;case 5124:T.commandType(m,"number","uniform "+p,e.commandStr),s="1i";break;case 35671:case 35667:T.command(oe(m)&&2===m.length,"uniform "+p,e.commandStr),s="2i";break;case 35672:case 35668:T.command(oe(m)&&3===m.length,"uniform "+p,e.commandStr),s="3i";break;case 35673:case 35669:T.command(oe(m)&&4===m.length,"uniform "+p,e.commandStr),s="4i"}t(c,".uniform",s,"(",g,",",oe(m)?Array.prototype.slice.call(m):m,");")}continue}h=v.append(e,t)}else{if(!o(mt))continue;h=t.def(u.uniforms,"[",r.id(p),"]")}35678===d?(T(!Array.isArray(h),"must specify a scalar prop for textures"),t("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):35680===d&&(T(!Array.isArray(h),"must specify a scalar prop for cube maps"),t("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),T.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){T(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(h)?T(h.length===t,"must have length "+t):n(u.isArrayLike+"("+h+")&&"+h+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){T(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:o(3553);break;case 35680:o(34067)}}));var x=1;switch(d){case 35678:case 35680:var S=t.def(h,"._texture");t(c,".uniform1i(",g,",",S,".bind());"),t.exit(S,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",x=2;break;case 35668:case 35672:s="3i",x=3;break;case 35669:case 35673:s="4i",x=4;break;case 5126:s="1f";break;case 35664:s="2f",x=2;break;case 35665:s="3f",x=3;break;case 35666:s="4f",x=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if("M"===s.charAt(0)){t(c,".uniform",s,"(",g,",");var E=Math.pow(d-35674+2,2),A=e.global.def("new Float32Array(",E,")");Array.isArray(h)?t("false,(",z(E,(function(e){return A+"["+e+"]="+h[e]})),",",A,")"):t("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",z(E,(function(e){return A+"["+e+"]="+h+"["+e+"]"})),",",A,")"),t(");")}else if(x>1){for(var w=[],C=[],k=0;k<x;++k)Array.isArray(h)?C.push(h[k]):C.push(t.def(h+"["+k+"]")),a&&w.push(t.def());a&&t("if(!",e.batchId,"||",w.map((function(e,t){return e+"!=="+C[t]})).join("||"),"){",w.map((function(e,t){return e+"="+C[t]+";"})).join("")),t(c,".uniform",s,"(",g,",",C.join(","),");"),a&&t("}")}else{if(T(!Array.isArray(h),"uniform value must not be an array"),a){var M=t.def();t("if(!",e.batchId,"||",M,"!==",h,"){",M,"=",h,";")}t(c,".uniform",s,"(",g,",",h,");"),a&&t("}")}}}function q(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var u,c=s.elements,l=t;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(e,l),s.elementsActive&&l("if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);")):(u=l.def(),l(u,"=",a,".",Ke,";","if(",u,"){",o,".bindBuffer(",34963,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",S?"":"if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);","}")),u}();function c(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,h,f=c(Qe),p=c(Je),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),T.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",$e),T.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");b&&(l=c(et),h=e.instancing);var v=u+".type",g=s.elements&&dt(s.elements)&&!s.vaoActive;function m(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,v,p+"<<(("+v+"-5121)>>1)",l],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,l],");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[f,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[f,p,d]+");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}b&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),m(),n("}else if(",l,"<0){"),y(),n("}")):m():y()}function K(e,t,n,r,i){var o=F(),a=o.proc("body",i);return T.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),b&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function Q(e,t,n,r){H(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),Y(e,t,n,r.attributes,(function(){return!0}))),Z(e,t,n,r.uniforms,(function(){return!0}),!1),q(e,t,t,n)}function $(e,t,n,r){function i(){return!0}e.batchId="a1",H(e,t),Y(e,t,n,r.attributes,i),Z(e,t,n,r.uniforms,i,!1),q(e,t,t,n)}function J(e,t,n,r){H(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function c(e){return e.contextDep&&i||e.propDep}function l(e){return!c(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&j(e,u,n.context),n.needsFramebuffer&&U(e,u,n.framebuffer),G(e,u,n.state,c),n.profile&&c(n.profile)&&W(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),Y(e,s,n,r.attributes,l),Y(e,u,n,r.attributes,c)),Z(e,s,n,r.uniforms,l,!1),Z(e,u,n,r.uniforms,c,!0),q(e,s,u,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return K($,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function ee(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===C(e)&&!oe(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(I.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(I.isDynamic(n)){"function"==typeof n&&(n=r[t]=I.unbox(n));var o=gt(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",t,"="),C(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new I.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(I.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:A,current:E,procs:function(){var e=F(),r=e.proc("poll"),i=e.proc("refresh"),s=e.block();r(s),i(s);var u,c=e.shared,l=c.gl,h=c.next,f=c.current;s(f,".dirty=false;"),U(e,r),U(e,i,null,!0),b&&(u=e.link(b)),o.oes_vertex_array_object&&i(e.link(o.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<a.maxAttributes;++p){var d=i.def(c.attributes,"[",p,"]"),v=e.cond(d,".buffer");v.then(l,".enableVertexAttribArray(",p,");",l,".bindBuffer(",34962,",",d,".buffer.buffer);",l,".vertexAttribPointer(",p,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(l,".disableVertexAttribArray(",p,");",l,".vertexAttrib4f(",p,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),i(v),b&&(n(t)?i(l,".vertexAttribDivisor(",p,",",d,".divisor);"):i(u,".vertexAttribDivisorANGLE(",p,",",d,".divisor);"))}return i(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(k).forEach((function(t){var n=k[t],o=s.def(h,".",t),a=e.block();a("if(",o,"){",l,".enable(",n,")}else{",l,".disable(",n,")}",f,".",t,"=",o,";"),i(a),r("if(",o,"!==",f,".",t,"){",a,"}")})),Object.keys(M).forEach((function(t){var n,o,a=M[t],u=E[t],c=e.block();if(c(l,".",a,"("),oe(u)){var p=u.length;n=e.global.def(h,".",t),o=e.global.def(f,".",t),c(z(p,(function(e){return n+"["+e+"]"})),");",z(p,(function(e){return o+"["+e+"]="+n+"["+e+"];"})).join("")),r("if(",z(p,(function(e){return n+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",c,"}")}else n=s.def(h,".",t),o=s.def(f,".",t),c(n,");",f,".",t,"=",n,";"),r("if(",n,"!==",o,"){",c,"}");i(c)})),e.compile()}(),compile:function(e,t,n,o,a){var s=F();s.stats=s.link(a),Object.keys(t.static).forEach((function(e){ee(s,t,e)})),it.forEach((function(t){ee(s,e,t)}));var u=B(e,t,n,o,s);return function(e,t){var n=e.proc("draw",1);H(e,n),j(e,n,t.context),U(e,n,t.framebuffer),V(e,n,t),G(e,n,t.state),W(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return K(Q,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(r){var o=t.shader[r];o&&n.set(i.shader,"."+r,o.append(e,n))}j(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),ft(Object.keys(t.state)).forEach((function(r){var o=t.state[r].append(e,n);oe(o)?o.forEach((function(t,i){n.set(e.next[r],"["+i+"]",t)})):n.set(i.next,"."+r,o)})),W(e,n,t,!0,!0),[Ke,Je,$e,et,Qe].forEach((function(r){var o=t.draw[r];o&&n.set(i.draw,"."+r,""+o.append(e,n))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(r){var i=t.attributes[r].append(e,n),o=e.scopeAttrib(r);Object.keys(new y).forEach((function(e){n.set(o,"."+e,i[e])}))})),t.scopeVAO&&n.set(i.vao,".targetVAO",t.scopeVAO.append(e,n)),a(Ze),a(qe),Object.keys(t.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",H(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(j(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||U(e,n,o)):U(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),V(e,n,t),G(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||W(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)J(e,n,t,null);else{var c=u.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)J(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),h=n.def(c,".id"),f=n.def(l,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",l,"[",h,"]=",e.link((function(n){return K(J,e,t,n,2)})),"(",c,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),i(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var _t=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function c(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var l=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),c(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var e,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,h[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var c=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),r(c)):i[e++]=c,l[n+1]=a,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=l[d]-l[p];var v=h[p],g=h[d];g===v?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=v,f.endQueryIndex=g,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function bt(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(e){var t=D(e);if(!t)return null;var o=t.gl,a=o.getContextAttributes(),s=o.isContextLost(),u=F(o,t);if(!u)return null;var c,l,h=(c={"":0},l=[""],{id:function(e){var t=c[e];return t||(t=c[e]=l.length,l.push(e),t)},str:function(e){return l[e]}}),f={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=u.extensions,d=_t(0,p),v=O(),g=o.drawingBufferWidth,m=o.drawingBufferHeight,y={tick:0,time:0,viewportWidth:g,viewportHeight:m,framebufferWidth:g,framebufferHeight:m,drawingBufferWidth:g,drawingBufferHeight:m,pixelRatio:t.pixelRatio},_={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=U.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),U.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),h=U.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),U.freeType(h),e.bindTexture(34067,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:c}}(o,p),x=function(e,t,n,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,n.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function c(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function l(e,t,n,i,o,a){var s,u;if(e.usage=n,Array.isArray(t)){if(e.dtype=i||5126,t.length>0)if(Array.isArray(t[0])){s=K(t);for(var l=1,h=1;h<s.length;++h)l*=s[h];e.dimension=l,c(e,u=q(t,s,e.dtype),n),a?e.persistentData=u:U.freeType(u)}else if("number"==typeof t[0]){e.dimension=o;var f=U.allocType(e.dtype,t.length);J(f,t),c(e,f,n),a?e.persistentData=f:U.freeType(f)}else r(t[0])?(e.dimension=t[0].length,e.dtype=i||$(t[0])||5126,c(e,u=q(t,[t.length,t[0].length],e.dtype),n),a?e.persistentData=u:U.freeType(u)):T.raise("invalid buffer data")}else if(r(t))e.dtype=i||$(t),e.dimension=o,c(e,t,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(V(t)){s=t.shape;var p=t.stride,d=t.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):T.raise("invalid shape"),e.dtype=i||$(t.data)||5126,e.dimension=g;var _=U.allocType(e.dtype,v*g);ee(_,t.data,v,g,m,y,d),c(e,_,n),a?e.persistentData=_:U.freeType(_)}else t instanceof ArrayBuffer?(e.dtype=5121,e.dimension=o,c(e,t,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(t)))):T.raise("invalid buffer data")}function h(n){t.bufferCount--,i(n);var r=n.buffer;T(r,"buffer must not be deleted already"),e.deleteBuffer(r),n.buffer=null,delete a[n.id]}return n.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,c){t.bufferCount++;var f=new s(o);function p(t){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(t)||r(t)||V(t)||t instanceof ArrayBuffer?o=t:"number"==typeof t?a=0|t:t&&(T.type(t,"object","buffer arguments must be an object, a number or an array"),"data"in t&&(T(null===o||Array.isArray(o)||r(o)||V(o),"invalid data for buffer"),o=t.data),"usage"in t&&(T.parameter(t.usage,Z,"invalid buffer usage"),i=Z[t.usage]),"type"in t&&(T.parameter(t.type,X,"invalid buffer type"),s=X[t.type]),"dimension"in t&&(T.type(t.dimension,"number","invalid dimension"),u=0|t.dimension),"length"in t&&(T.nni(a,"buffer length must be a nonnegative integer"),a=0|t.length)),f.bind(),o?l(f,o,i,s,u,c):(a&&e.bufferData(f.type,a,i),f.dtype=s||5121,f.usage=i,f.dimension=u,f.byteLength=a),n.profile&&(f.stats.size=f.byteLength*Q[f.dtype]),p}function d(t,n){T(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(e,t){var n,i=0|(t||0);if(f.bind(),r(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=U.allocType(f.dtype,e.length);J(o,e),d(o,i),U.freeType(o)}else if(Array.isArray(e[0])||r(e[0])){n=K(e);var a=q(e,n,f.dtype);d(a,i),U.freeType(a)}else T.raise("invalid buffer data")}else if(V(e)){n=e.shape;var s=e.stride,u=0,c=0,l=0,h=0;1===n.length?(u=n[0],c=1,l=s[0],h=0):2===n.length?(u=n[0],c=n[1],l=s[0],h=s[1]):T.raise("invalid shape");var v=Array.isArray(e.data)?f.dtype:$(e.data),g=U.allocType(v,u*c);ee(g,e.data,u,c,l,h,e.offset),d(g,i),U.freeType(g)}else T.raise("invalid data for buffer subdata");return p},n.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){G(a).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){G(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:l}}(o,f,t,(function(e){return E.destroyBuffer(e)})),S=function(e,t,n,i){var o={},a=0,s={uint8:5121,uint16:5123};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}t.oes_element_index_uint&&(s.uint32=5125),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(i,o,a,s,u,c,l){var h;if(i.buffer.bind(),o){var f=l;l||r(o)&&(!V(o)||r(o.data))||(f=t.oes_element_index_uint?5125:5123),n._initBuffer(i.buffer,o,a,f,3)}else e.bufferData(34963,c,a),i.buffer.dtype=h||5121,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(h=l,!l){switch(i.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125;break;default:T.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,T(5125!==h||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function h(e){i.elementsCount--,T(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,t){var o=n.create(null,34963,!0),a=new u(o._buffer);function c(e){if(e)if("number"==typeof e)o(e),a.primType=4,a.vertCount=0|e,a.type=5121;else{var t=null,n=35044,i=-1,u=-1,h=0,f=0;Array.isArray(e)||r(e)||V(e)?t=e:(T.type(e,"object","invalid arguments for elements"),"data"in e&&(t=e.data,T(Array.isArray(t)||r(t)||V(t),"invalid data for element buffer")),"usage"in e&&(T.parameter(e.usage,Z,"invalid element buffer usage"),n=Z[e.usage]),"primitive"in e&&(T.parameter(e.primitive,te,"invalid element buffer primitive"),i=te[e.primitive]),"count"in e&&(T("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(T.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?h=0|e.length:(h=u,5123===f||5122===f?h*=2:5125!==f&&5124!==f||(h*=4))),l(a,t,n,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=5121;return c}return i.elementsCount++,c(e),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){h(a)},c},createStream:function(e){var t=c.pop();return t||(t=new u(n.create(null,34963,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){c.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){G(o).forEach(h)}}}(o,p,x,f),E=function(e,t,i,o,a,s,u){for(var c=i.maxAttributes,l=new Array(c),h=0;h<c;++h)l[h]=new Ue;var f=0,p={},d={Record:Ue,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?function(){v()&&G(p).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(e){var n=new m;function i(e){var o;if(Array.isArray(e))o=e,n.elements&&n.ownsElements&&n.elements.destroy(),n.elements=null,n.ownsElements=!1,n.offset=0,n.count=0,n.instances=-1,n.primitive=4;else{if(T("object"===C(e),"invalid arguments for create vao"),T("attributes"in e,"must specify attributes for vao"),e.elements){var u=e.elements;n.ownsElements?"function"==typeof u&&"elements"===u._reglType?(n.elements.destroy(),n.ownsElements=!1):(n.elements(u),n.ownsElements=!1):s.getElements(e.elements)?(n.elements=e.elements,n.ownsElements=!1):(n.elements=s.create(e.elements),n.ownsElements=!0)}else n.elements=null,n.ownsElements=!1;o=e.attributes,n.offset=0,n.count=-1,n.instances=-1,n.primitive=4,n.elements&&(n.count=n.elements._elements.vertCount,n.primitive=n.elements._elements.primType),"offset"in e&&(n.offset=0|e.offset),"count"in e&&(n.count=0|e.count),"instances"in e&&(n.instances=0|e.instances),"primitive"in e&&(T(e.primitive in te,"bad primitive type: "+e.primitive),n.primitive=te[e.primitive]),T.optional((function(){for(var t=Object.keys(e),n=0;n<t.length;++n)T(je.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+je)})),T(Array.isArray(o),"attributes must be an array")}T(o.length<c,"too many attributes"),T(o.length>0,"must specify at least one attribute");var l={},h=n.attributes;h.length=o.length;for(var f=0;f<o.length;++f){var p,d=o[f],v=h[f]=new Ue,g=d.data||d;Array.isArray(g)||r(g)||V(g)?(n.buffers[f]&&(p=n.buffers[f],r(g)&&p._buffer.byteLength>=g.byteLength?p.subdata(g):(p.destroy(),n.buffers[f]=null)),n.buffers[f]||(p=n.buffers[f]=a.create(d,34962,!1,!0)),v.buffer=a.getBuffer(p),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,l[f]=1):a.getBuffer(d)?(v.buffer=a.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):a.getBuffer(d.buffer)?(v.buffer=a.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(T.parameter(d.type,X,"invalid buffer type"),v.type=X[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,T(v.size>=1&&v.size<=4,"size must be between 1 and 4"),T(v.offset>=0,"invalid offset"),T(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),T(v.divisor>=0,"divisor must be positive"),T(!v.divisor||!!t.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(T(f>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):T(!1,"invalid attribute spec for location "+f)}for(var m=0;m<n.buffers.length;++m)!l[m]&&n.buffers[m]&&(n.buffers[m].destroy(),n.buffers[m]=null);return n.refresh(),i}return o.vaoCount+=1,i.destroy=function(){for(var e=0;e<n.buffers.length;++e)n.buffers[e]&&n.buffers[e].destroy();n.buffers.length=0,n.ownsElements&&(n.elements.destroy(),n.elements=null,n.ownsElements=!1),n.destroy()},i._vao=n,i._reglType="vao",i(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}},setVAO:v()?function(e){if(e!==d.currentVAO){var t=v();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),d.currentVAO=e}}:function(t){if(t!==d.currentVAO){if(t)t.bindAttrs();else{for(var n=g(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}u.elements?e.bindBuffer(34963,u.elements.buffer.buffer):e.bindBuffer(34963,null)}d.currentVAO=t}},clear:v()?function(){G(p).forEach((function(e){e.destroy()}))}:function(){}};function v(){return t.oes_vertex_array_object}function g(){var r=t.angle_instanced_arrays;return n(e)&&(r.vertexAttribDivisorANGLE=e.vertexAttribDivisor),r}function m(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=v();this.vao=e?e.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}return m.prototype.bindAttrs=function(){for(var t=g(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(34962,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<c;++o)e.disableVertexAttribArray(o);var a=s.getElements(this.elements);a?e.bindBuffer(34963,a.buffer.buffer):e.bindBuffer(34963,null)},m.prototype.refresh=function(){var e=v();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,e.bindVertexArrayOES(null))},m.prototype.destroy=function(){if(this.vao){var e=v();this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],o.vaoCount-=1)},d}(o,p,b,f,x,S,_),A=function(e,t,n,r){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(n,r,i){var s=35632===n?o:a,u=s[r];if(!u){var c=t.str(r);u=e.createShader(n),e.shaderSource(u,c),e.compileShader(u),T.shaderError(e,u,c,n,i),s[r]=u}return u}var l={},h=[],f=0;function p(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,i,o){var a,l,h=c(35632,n.fragId),f=c(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),T.linkError(e,p,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(p,35718);r.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(a=0;a<v;++a)if(l=e.getActiveUniform(p,a))if(l.size>1)for(var m=0;m<l.size;++m){var y=l.name.replace("[0]","["+m+"]");u(g,new s(y,t.id(y),e.getUniformLocation(p,y),l))}else u(g,new s(l.name,t.id(l.name),e.getUniformLocation(p,l.name),l));var _=e.getProgramParameter(p,35721);r.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(a=0;a<_;++a)(l=e.getActiveAttrib(p,a))&&u(b,new s(l.name,t.id(l.name),e.getAttribLocation(p,l.name),l))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return h.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return h.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);G(o).forEach(t),o={},G(a).forEach(t),a={},h.forEach((function(t){e.deleteProgram(t.program)})),h.length=0,l={},n.shaderCount=0},program:function(t,r,s,u){T.command(t>=0,"missing vertex shader",s),T.command(r>=0,"missing fragment shader",s);var c=l[r];c||(c=l[r]={});var f=c[t];if(f&&(f.refCount++,!u))return f;var v=new p(r,t);return n.shaderCount++,d(v,s,u),f||(c[t]=v),h.push(v),i(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=h.indexOf(v);h.splice(t,1),n.shaderCount--}c[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete l[v.fragId][v.vertId]),Object.keys(l[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete l[v.fragId])}})},restore:function(){o={},a={};for(var e=0;e<h.length;++e)d(h[e],null,h[e].attributes.map((function(e){return[e.location,e.name]})))},shader:c,frag:-1,vert:-1}}(o,h,f,t),w=Re(o,p,b,(function(){P.procs.poll()}),y,f,t),k=function(e,t,n,r,i){var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function c(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;T(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var l=new c(e.createRenderbuffer());function h(t,r){var s=0,u=0,c=32854;if("object"===C(t)&&t){var f=t;if("shape"in f){var p=f.shape;T(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(T.parameter(f.format,o,"invalid renderbuffer format"),c=o[f.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?T.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(T(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||c!==l.format)return h.width=l.width=s,h.height=l.height=u,l.format=c,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,c,s,u),T(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Le(l.format,l.width,l.height)),h.format=a[l.format],h}return u[l.id]=l,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(T(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=l.width=o,h.height=l.height=a,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,l.format,o,a),T(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Le(l.format,l.width,l.height))),h},h._reglType="renderbuffer",h._renderbuffer=l,i.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){G(u).forEach(l)},restore:function(){G(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(o,p,b,f,t),M=function(e,t,n,r,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&c.push("srgba"),t.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);T(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;T(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"===C(e)&&(i=e.data,"target"in e&&(t=0|e.target)),T.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,T(3553===t)):"textureCube"===o?(n=i,T(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=36161):T.raise("invalid regl object for attachment"),new h(t,n,r)}function g(e,t,n,i,a){if(n){var s=r.create2D({width:e,height:t,format:i,type:a});return s._texture.refCount=0,new h(3553,s,null)}var u=o.create({width:e,height:t,format:i});return u._renderbuffer.refCount=0,new h(36161,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}t.oes_texture_half_float&&l.push("half float","float16"),t.oes_texture_float&&l.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function E(t){var n=t.framebuffer;T(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete b[t.id]}function A(t){var r;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(r=0;r<i.length;++r)d(36064+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(36160,36064+r,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),d(36096,t.depthAttachment),d(36128,t.stencilAttachment),d(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(36160);e.isContextLost()||36053===o||T.raise("framebuffer configuration not supported, status = "+Be[o]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function w(e,r){var o=new x;function h(e,r){var i;T(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",E="uint8",w=1,C=null,k=null,M=null,P=!1;if("number"==typeof e)a=0|e,f=0|r||a;else if(e){T.type(e,"object","invalid arguments for framebuffer");var I=e;if("shape"in I){var R=I.shape;T(Array.isArray(R)&&R.length>=2,"invalid shape for framebuffer"),a=R[0],f=R[1]}else"radius"in I&&(a=f=I.radius),"width"in I&&(a=I.width),"height"in I&&(f=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&T(1===_.length||t.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(w=0|I.colorCount,T(w>0,"invalid color buffer count")),"colorTexture"in I&&(b=!!I.colorTexture,x="rgba4"),"colorType"in I&&(E=I.colorType,b?(T(t.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),T(t.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===E||"float16"===E?(T(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==E&&"float32"!==E||(T(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),T.oneOf(E,l,"invalid color type")),"colorFormat"in I&&(x=I.colorFormat,u.indexOf(x)>=0?b=!0:c.indexOf(x)>=0?b=!1:T.optional((function(){b?T.oneOf(I.colorFormat,u,"invalid color format for texture"):T.oneOf(I.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(P=!(!I.depthTexture&&!I.depthStencilTexture),T(!P||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(C=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(k=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=y=I.depthStencil:(M=I.depthStencil,d=!1,y=!1))}else a=f=1;var O=null,L=null,N=null,D=null;if(Array.isArray(_))O=_.map(v);else if(_)O=[v(_)];else for(O=new Array(w),i=0;i<w;++i)O[i]=g(a,f,b,x,E);T(t.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),T(O.length<=n.maxColorAttachments,"too many color attachments, not supported"),a=a||O[0].width,f=f||O[0].height,C?L=v(C):d&&!y&&(L=g(a,f,P,"depth","uint32")),k?N=v(k):y&&!d&&(N=g(a,f,!1,"stencil","uint8")),M?D=v(M):!C&&!k&&y&&d&&(D=g(a,f,P,"depth stencil","depth stencil")),T(!!C+!!k+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<O.length;++i)if(p(O[i],a,f),T(!O[i]||O[i].texture&&Ne.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&ze.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var z=De[O[i].texture._texture.format]*Fe[O[i].texture._texture.type];null===F?F=z:T(F===z,"all color attachments much have the same number of bits per pixel.")}return p(L,a,f),T(!L||L.texture&&6402===L.texture._texture.format||L.renderbuffer&&33189===L.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(N,a,f),T(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(D,a,f),T(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),S(o),o.width=a,o.height=f,o.colorAttachments=O,o.depthAttachment=L,o.stencilAttachment=N,o.depthStencilAttachment=D,h.color=O.map(m),h.depth=m(L),h.stencil=m(N),h.depthStencil=m(D),h.width=o.width,h.height=o.height,A(o),h}return a.framebufferCount++,h(e,r),i(h,{resize:function(e,t){T(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,A(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){E(o),S(o)},use:function(e){s.setFBO({framebuffer:h},e)}})}return i(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:w,createCube:function(e){var o=Array(6);function a(e){var n;T(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,h={color:null},f=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)f=0|e;else if(e){T.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;T(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),T(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&T(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&T(1===p.length||t.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,T(g>0,"invalid color buffer count")),"colorType"in m&&(T.oneOf(m.colorType,l,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,T.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(c=[],n=0;n<p.length;++n)c[n]=p[n];else c=[p];else{c=Array(g);var _={radius:f,format:d,type:v};for(n=0;n<g;++n)c[n]=r.createCube(_)}for(h.color=Array(c.length),n=0;n<c.length;++n){var b=c[n];T("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,T(b.width===f&&b.height===f,"invalid cube map shape"),h.color[n]={target:34069,data:c[n]}}for(n=0;n<6;++n){for(var x=0;x<c.length;++x)h.color[x].target=34069+n;n>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[n]?o[n](h):o[n]=w(h)}return i(a,{width:f,height:f,color:c})}return a(e),i(a,{faces:o,resize:function(e){var t,r=0|e;if(T(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(r);for(t=0;t<6;++t)o[t].resize(r);return a.width=a.height=r,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){G(b).forEach(E)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,G(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}})}(o,p,b,w,k,f),P=yt(o,h,p,b,x,S,0,M,{},E,A,_,y,d,t),L=Ve(o,M,P.procs.poll,y,a,p,b),N=P.next,z=o.canvas,B=[],j=[],H=[],W=[t.onDestroy],Y=null;function ne(){if(0===B.length)return d&&d.update(),void(Y=null);Y=R.next(ne),pe();for(var e=B.length-1;e>=0;--e){var t=B[e];t&&t(y,null,0)}o.flush(),d&&d.update()}function re(){!Y&&B.length>0&&(Y=R.next(ne))}function ie(){Y&&(R.cancel(ne),Y=null)}function oe(e){e.preventDefault(),s=!0,ie(),j.forEach((function(e){e()}))}function ae(e){o.getError(),s=!1,u.restore(),A.restore(),x.restore(),w.restore(),k.restore(),M.restore(),E.restore(),d&&d.restore(),P.procs.refresh(),re(),H.forEach((function(e){e()}))}var se="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function ue(e){function t(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(I.isDynamic(o))r[i]=I.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(I.isDynamic(o[a]))return void(r[i]=I.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}T(!!e,"invalid args to regl({...})"),T.type(e,"object","invalid args to regl({...})");var n=t(e.context||{},!0),r=t(e.uniforms||{},!0),o=t(e.attributes||{},!1),a=t(function(e){var t=i({},e);function n(e){if(e in t){var n=t[e];delete t[e],Object.keys(n).forEach((function(r){t[e+"."+r]=n[r]}))}}return delete t.uniforms,delete t.attributes,delete t.context,delete t.vao,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),"vao"in e&&(t.vao=e.vao),t}(e),!1),u={gpuTime:0,cpuTime:0,count:0},c=P.compile(a,o,r,n,u),l=c.draw,h=c.batch,f=c.scope,p=[];return i((function(e,t){var n;if(s&&T.raise("context lost"),"function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u,destroy:function(){c.destroy()}})}!se&&z&&(z.addEventListener("webglcontextlost",oe,!1),z.addEventListener("webglcontextrestored",ae,!1));var ce=M.setFBO=ue({framebuffer:I.define.call(null,1,"framebuffer")});function le(e,t){var n=0;P.procs.poll();var r=t.color;r&&(o.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(o.clearDepth(+t.depth),n|=256),"stencil"in t&&(o.clearStencil(0|t.stencil),n|=1024),T(!!n,"called regl.clear with no buffer specified"),o.clear(n)}function he(e){return T.type(e,"function","regl.frame() callback must be a function"),B.push(e),re(),{cancel:function(){var t=bt(B,e);T(t>=0,"cannot cancel a frame twice"),B[t]=function e(){var t=bt(B,e);B[t]=B[B.length-1],B.length-=1,B.length<=0&&ie()}}}}function fe(){var e=N.viewport,t=N.scissor_box;e[0]=e[1]=t[0]=t[1]=0,y.viewportWidth=y.framebufferWidth=y.drawingBufferWidth=e[2]=t[2]=o.drawingBufferWidth,y.viewportHeight=y.framebufferHeight=y.drawingBufferHeight=e[3]=t[3]=o.drawingBufferHeight}function pe(){y.tick+=1,y.time=ve(),fe(),P.procs.poll()}function de(){w.refresh(),fe(),P.procs.refresh(),d&&d.update()}function ve(){return(O()-v)/1e3}de();var ge=i(ue,{clear:function(e){if(T("object"===C(e)&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)ce(i({framebuffer:e.framebuffer.faces[t]},e),le);else ce(e,le);else le(0,e)},prop:I.define.bind(null,1),context:I.define.bind(null,2),this:I.define.bind(null,3),draw:ue({}),buffer:function(e){return x.create(e,34962,!1,!1)},elements:function(e){return S.create(e,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:k.create,framebuffer:M.create,framebufferCube:M.createCube,vao:E.createVAO,attributes:a,frame:he,on:function(e,t){var n;switch(T.type(t,"function","listener callback must be a function"),e){case"frame":return he(t);case"lost":n=j;break;case"restore":n=H;break;case"destroy":n=W;break;default:T.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:b,hasExtension:function(e){return b.extensions.indexOf(e.toLowerCase())>=0},read:L,destroy:function(){B.length=0,ie(),!se&&z&&(z.removeEventListener("webglcontextlost",oe),z.removeEventListener("webglcontextrestored",ae)),A.clear(),M.clear(),k.clear(),E.clear(),w.clear(),S.clear(),x.clear(),d&&d.clear(),W.forEach((function(e){e()}))},_gl:o,_refresh:de,_textureState:w,_refreshTexture:w.refresh,poll:function(){pe(),d&&d.update()},now:ve,stats:f});return t.onDone(null,ge),ge}}(XK)})),qK=function(){return l((function e(t,n){s(this,e),f(this,"attribute",void 0),f(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,u=n.size,c=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:c||0},u&&(this.attribute.size=u)}),[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}])}(),KK=f(f(f(f(f(f(f({},IP.POINTS,"points"),IP.LINES,"lines"),IP.LINE_LOOP,"line loop"),IP.LINE_STRIP,"line strip"),IP.TRIANGLES,"triangles"),IP.TRIANGLE_FAN,"triangle fan"),IP.TRIANGLE_STRIP,"triangle strip"),QK=f(f(f({},IP.STATIC_DRAW,"static"),IP.DYNAMIC_DRAW,"dynamic"),IP.STREAM_DRAW,"stream"),$K=f(f(f(f(f(f(f({},IP.BYTE,"int8"),IP.UNSIGNED_INT,"int16"),IP.INT,"int32"),IP.UNSIGNED_BYTE,"uint8"),IP.UNSIGNED_SHORT,"uint16"),IP.UNSIGNED_INT,"uint32"),IP.FLOAT,"float"),JK=f(f(f(f(f(f(f(f(f(f({},IP.ALPHA,"alpha"),IP.LUMINANCE,"luminance"),IP.LUMINANCE_ALPHA,"luminance alpha"),IP.RGB,"rgb"),IP.RGBA,"rgba"),IP.RGBA4,"rgba4"),IP.RGB5_A1,"rgb5 a1"),IP.RGB565,"rgb565"),IP.DEPTH_COMPONENT,"depth"),IP.DEPTH_STENCIL,"depth stencil"),eQ=f(f(f({},IP.DONT_CARE,"dont care"),IP.NICEST,"nice"),IP.FASTEST,"fast"),tQ=f(f(f(f(f(f({},IP.NEAREST,"nearest"),IP.LINEAR,"linear"),IP.LINEAR_MIPMAP_LINEAR,"mipmap"),IP.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),IP.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),IP.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),nQ=f(f(f({},IP.REPEAT,"repeat"),IP.CLAMP_TO_EDGE,"clamp"),IP.MIRRORED_REPEAT,"mirror"),rQ=f(f({},IP.NONE,"none"),IP.BROWSER_DEFAULT_WEBGL,"browser"),iQ=f(f(f(f(f(f(f(f({},IP.NEVER,"never"),IP.ALWAYS,"always"),IP.LESS,"less"),IP.LEQUAL,"lequal"),IP.GREATER,"greater"),IP.GEQUAL,"gequal"),IP.EQUAL,"equal"),IP.NOTEQUAL,"notequal"),oQ=f(f(f(f(f({},IP.FUNC_ADD,"add"),IP.MIN_EXT,"min"),IP.MAX_EXT,"max"),IP.FUNC_SUBTRACT,"subtract"),IP.FUNC_REVERSE_SUBTRACT,"reverse subtract"),aQ=(f(f(f(f(f(f(f(f(f(f(WK={},IP.ZERO,"zero"),IP.ONE,"one"),IP.SRC_COLOR,"src color"),IP.ONE_MINUS_SRC_COLOR,"one minus src color"),IP.SRC_ALPHA,"src alpha"),IP.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),IP.DST_COLOR,"dst color"),IP.ONE_MINUS_DST_COLOR,"one minus dst color"),IP.DST_ALPHA,"dst alpha"),IP.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),f(f(f(f(f(WK,IP.CONSTANT_COLOR,"constant color"),IP.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),IP.CONSTANT_ALPHA,"constant alpha"),IP.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),IP.SRC_ALPHA_SATURATE,"src alpha saturate")),sQ=f(f(f(f(f(f(f(f({},IP.NEVER,"never"),IP.ALWAYS,"always"),IP.LESS,"less"),IP.LEQUAL,"lequal"),IP.GREATER,"greater"),IP.GEQUAL,"gequal"),IP.EQUAL,"equal"),IP.NOTEQUAL,"notequal"),uQ=f(f(f(f(f(f(f(f({},IP.ZERO,"zero"),IP.KEEP,"keep"),IP.REPLACE,"replace"),IP.INVERT,"invert"),IP.INCR,"increment"),IP.DECR,"decrement"),IP.INCR_WRAP,"increment wrap"),IP.DECR_WRAP,"decrement wrap"),cQ=f(f({},IP.FRONT,"front"),IP.BACK,"back"),lQ=function(){return l((function e(t,n){s(this,e),f(this,"buffer",void 0),f(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:QK[i||IP.STATIC_DRAW],type:$K[o||IP.UNSIGNED_BYTE]})}),[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}])}(),hQ=function(){return l((function e(t,n){s(this,e),f(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:QK[i||IP.STATIC_DRAW],type:$K[o||IP.UNSIGNED_BYTE],count:a})}),[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}])}(),fQ=function(){return l((function e(t,n){s(this,e),f(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,u={width:r,height:i};Array.isArray(a)&&(u.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(u.color=o.get()),this.framebuffer=t.framebuffer(u)}),[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}])}(),pQ=function(){return l((function e(t,n){s(this,e),f(this,"reGl",void 0),f(this,"destroyed",!1),f(this,"drawCommand",void 0),f(this,"drawParams",void 0),f(this,"options",void 0),f(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,u=n.primitive,c=n.count,l=n.elements,h=n.depth,p=n.cull,d=n.instances,v={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){v[e]=t.prop(e)})));var g={};Object.keys(o).forEach((function(e){g[e]=o[e].get()}));var m={attributes:g,frag:i,uniforms:v,vert:r,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:KK[void 0===u?IP.TRIANGLES:u]};d&&(m.instances=d),c?m.count=c:l&&(m.elements=l.get()),this.initDepthDrawParams({depth:h},m),this.initCullDrawParams({cull:p},m),this.drawCommand=t(m),this.drawParams=m}),[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=_(_({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=_(_({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=C(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.reGl._refreshTexture(),this.drawCommand(r)}}},{key:"destroy",value:function(){var e,t;null===(e=this.drawParams)||void 0===e||null===(t=e.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:iQ[n.func||IP.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:aQ[r&&r.srcRGB||IP.SRC_ALPHA],srcAlpha:aQ[r&&r.srcAlpha||IP.SRC_ALPHA],dstRGB:aQ[r&&r.dstRGB||IP.ONE_MINUS_SRC_ALPHA],dstAlpha:aQ[r&&r.dstAlpha||IP.ONE_MINUS_SRC_ALPHA]},equation:{rgb:oQ[i&&i.rgb||IP.FUNC_ADD],alpha:oQ[i&&i.alpha||IP.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,o=t.func,a=void 0===o?{cmp:IP.ALWAYS,ref:0,mask:-1}:o,s=t.opFront,u=void 0===s?{fail:IP.KEEP,zfail:IP.KEEP,zpass:IP.KEEP}:s,c=t.opBack,l=void 0===c?{fail:IP.KEEP,zfail:IP.KEEP,zpass:IP.KEEP}:c;return{enable:!!n,mask:i,func:_(_({},a),{},{cmp:sQ[a.cmp]}),opFront:{fail:uQ[u.fail],zfail:uQ[u.zfail],zpass:uQ[u.zpass]},opBack:{fail:uQ[l.fail],zfail:uQ[l.zfail],zpass:uQ[l.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?IP.BACK:i;t.cull={enable:!!r,face:cQ[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||yk(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(pk(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}])}(),dQ=function(){return l((function e(t,n){s(this,e),f(this,"texture",void 0),f(this,"width",void 0),f(this,"height",void 0),f(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?IP.UNSIGNED_BYTE:i,a=n.width,u=n.height,c=n.flipY,l=void 0!==c&&c,h=n.format,p=void 0===h?IP.RGBA:h,d=n.mipmap,v=void 0!==d&&d,g=n.wrapS,m=void 0===g?IP.CLAMP_TO_EDGE:g,y=n.wrapT,_=void 0===y?IP.CLAMP_TO_EDGE:y,b=n.aniso,x=void 0===b?0:b,S=n.alignment,E=void 0===S?1:S,A=n.premultiplyAlpha,T=void 0!==A&&A,w=n.mag,C=void 0===w?IP.NEAREST:w,k=n.min,M=void 0===k?IP.NEAREST:k,P=n.colorSpace,I=void 0===P?IP.BROWSER_DEFAULT_WEBGL:P,R=n.x,O=void 0===R?0:R,L=n.y,N=void 0===L?0:L,D=n.copy,F=void 0!==D&&D;this.width=a,this.height=u;var z={width:a,height:u,type:$K[o],format:JK[p],wrapS:nQ[m],wrapT:nQ[_],mag:tQ[C],min:tQ[M],alignment:E,flipY:l,colorSpace:rQ[I],premultiplyAlpha:T,aniso:x,x:O,y:N,copy:F};r&&(z.data=r),"number"==typeof v?z.mipmap=eQ[v]:"boolean"==typeof v&&(z.mipmap=v),this.texture=t.texture(z)}),[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}])}(),vQ=Ce()(YK=function(){return l((function e(){var t=this;s(this,e),f(this,"extensionObject",void 0),f(this,"gl",void 0),f(this,"$container",void 0),f(this,"canvas",void 0),f(this,"width",void 0),f(this,"height",void 0),f(this,"isDirty",void 0),f(this,"createModel",(function(e){return new pQ(t.gl,e)})),f(this,"createAttribute",(function(e){return new qK(t.gl,e)})),f(this,"createBuffer",(function(e){return new lQ(t.gl,e)})),f(this,"createElements",(function(e){return new hQ(t.gl,e)})),f(this,"createTexture2D",(function(e){return new dQ(t.gl,e)})),f(this,"createFramebuffer",(function(e){return new fQ(t.gl,e)})),f(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),f(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),f(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),f(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),f(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),f(this,"getContainer",(function(){return t.canvas})),f(this,"getCanvas",(function(){return t.canvas})),f(this,"getGLContext",(function(){return t.gl._gl})),f(this,"destroy",(function(){var e,n,r;t.canvas=null,null===(e=t.gl)||void 0===e||null===(n=e._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),t.gl.destroy(),t.gl=null}))}),[{key:"init",value:(e=o(x().mark((function e(t,n,r){var i=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){ZK({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(t,n,r){return e.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]);var e}())||YK,gQ=["selectstart","selecting","selectend"],mQ=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(this,t),f(n=a(this,t),"scene",void 0),f(n,"options",void 0),f(n,"isEnable",!1),f(n,"box",void 0),f(n,"startEvent",void 0),f(n,"endEvent",void 0),f(n,"onDragStart",(function(e){n.box.style.display="block",n.startEvent=n.endEvent=e,n.syncBoxBound(),n.emit("selectstart",n.getLngLatBox(),n.startEvent,n.endEvent)})),f(n,"onDragging",(function(e){n.endEvent=e,n.syncBoxBound(),n.emit("selecting",n.getLngLatBox(),n.startEvent,n.endEvent)})),f(n,"onDragEnd",(function(e){n.endEvent=e,n.box.style.display="none",n.emit("selectend",n.getLngLatBox(),n.startEvent,n.endEvent)})),n.scene=e,n.options=r,n}return v(t,e),l(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Am("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),c=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(c,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat;return sx([[t,n],[r.lng,r.lat]])}}])}(N),yQ=function(){return l((function e(t){s(this,e),f(this,"sceneService",void 0),f(this,"mapService",void 0),f(this,"controlService",void 0),f(this,"layerService",void 0),f(this,"debugService",void 0),f(this,"iconService",void 0),f(this,"markerService",void 0),f(this,"popupService",void 0),f(this,"fontService",void 0),f(this,"interactionService",void 0),f(this,"boxSelect",void 0),f(this,"container",void 0);var n=t.id,r=t.map,i=t.canvas,o=t.hasBaseMap,a=XL();this.container=a,r.setContainer(a,n,i,o),a.bind(Oe.IRendererService).to(vQ).inSingletonScope(),this.sceneService=a.get(Oe.ISceneService),this.mapService=a.get(Oe.IMapService),this.iconService=a.get(Oe.IIconService),this.fontService=a.get(Oe.IFontService),this.controlService=a.get(Oe.IControlService),this.layerService=a.get(Oe.ILayerService),this.debugService=a.get(Oe.IDebugService),this.debugService.setEnable(t.debug),this.markerService=a.get(Oe.IMarkerService),this.interactionService=a.get(Oe.IInteractionService),this.popupService=a.get(Oe.IPopupService),this.boxSelect=new mQ(this,{}),_d((null==t?void 0:t.isMini)||!1),Sd?this.sceneService.initMiniScene(t):(this.initComponent(n),this.sceneService.init(t),this.initControl())}),[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(i=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"exportMap",value:(r=o(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e);var t=this.getMapCanvasContainer().children[0];t&&(t.style.background=e)}},{key:"addLayer",value:function(e){var t=this,n=ZL(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new kG).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=ZL(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(n=o(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeAllLayer",value:(t=o(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=E(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(e=o(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Sd){e.next=5;break}return e.next=3,this.iconService.addImage(t,n);case 3:e.next=6;break;case 5:this.iconService.addImageMini(t,n,this.sceneService);case 6:case"end":return e.stop()}}),e,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers å·²åºå¼ï¼è¯·ä½¿ç¨ removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;gQ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):cN.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;gQ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):cN.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===cN.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;gQ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):cN.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||_(_({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(Oe.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:xm(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new uz({position:n}))}}]);var e,t,n,r,i}();e.$XMLHttpRequest=Td,e.$location=wd,e.$window=Ad,e.AJAXError=Cd,e.AttributeType=sN,e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=eU,e.BaseMapService=MN,e.BaseMapWrapper=hN,e.BaseModel=nU,e.BasePostProcessingPass=yL,e.BlendType=Bk,e.ButtonControl=HF,e.CameraUniform=eN,e.CanvasLayer=cU,e.CanvasUpdateType=sU,e.CityBuildingLayer=iV,e.Control=GF,e.CoordinateSystem=jy,e.CoordinateUniform=Uy,e.DOM=Wm,e.Earth=Oj,e.EarthLayer=wG,e.ExportImage=QF,e.FrequencyController=ey,e.Fullscreen=rz,e.GeoLocate=az,e.GeometryLayer=cV,e.HeatmapLayer=vV,e.IDebugLog=tN,e.ILayerStage=Vk,e.ImageLayer=mV,e.InteractionEvent=lM,e.LRUCache=bx,e.LayerPopup=kz,e.LayerSwitch=sz,e.LineLayer=zV,e.LineTriangulation=KE,e.LinearDir=iU,e.LoadTileDataStatus=Yx,e.Logo=uz,e.Map=zj,e.MapServiceEvent=uN,e.MapTheme=hz,e.Maplibre=LN,e.Marker=UF,e.MarkerLayer=VF,e.MaskLayer=kG,e.MaskOperation=Uk,e.MouseLocation=fz,e.PassType=qR,e.PointFillTriangulation=QE,e.PointLayer=lG,e.PolygonLayer=vG,e.PopperControl=XF,e.Popup=Cz,e.PositionType=qw,e.RasterLayer=xG,e.RasterTileType=lN,e.Satistics=Fx,e.Scale=pz,e.ScaleTypes=oN,e.Scene=yQ,e.SceneEventList=cN,e.SelectControl=qF,e.SizeUnitType=aU,e.Source=DF,e.SourceTile=nS,e.StencilType=jk,e.StyleScaleType=aN,e.TYPES=Oe,e.TextureBlend=oU,e.TileDebugLayer=SG,e.TilesetManager=AS,e.UpdateTileStrategy=Wx,e.Version=TN,e.Viewport=Lj,e.WindLayer=KG,e.WorkerSourceMap=eA,e.Zoom=dz,e.aProjectFlat=Zb,e.amap2Project=qb,e.amap2UnProject=Kb,e.anchorTranslate=Bd,e.anchorType=zd,e.applyAnchorClass=jd,e.bBoxToBounds=ex,e.bindAll=Jm,e.boundsContains=Jb,e.calAngle=function(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(rx(e)*rx(t)))/Math.PI},e.calDistance=nx,e.calculateCentroid=ox,e.calculatePointsCenterAndRadius=ax,e.container=GL,e.createLayerContainer=ZL,e.createSceneContainer=XL,e.decodePickingColor=mv,e.dispatchMapCameraParams=yd,e.dispatchMouseDown=Qp,e.dispatchMouseMove=$p,e.dispatchMouseUp=Jp,e.dispatchPointerDown=ud,e.dispatchPointerMove=cd,e.dispatchPointerUp=ld,e.dispatchTouchEnd=md,e.dispatchTouchMove=gd,e.dispatchTouchStart=vd,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=yv,e.executeWorkerTask=function(e,t){return aA.apply(this,arguments)},e.expandUrl=TS,e.extent=Gb,e.flow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=nx(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],c=ix(0,u);if(i>0){var l=r[i-1].rotation;l-c>360-l+c&&(c+=360)}r.push({start:o,end:a,dis:s,rotation:c,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}},e.formatImage=Fd,e.generateCatRamp=xv,e.generateColorRamp=_v,e.generateCustomRamp=Ev,e.generateLinearRamp=bv,e.generateQuantizeRamp=Sv,e.getAngle=ix,e.getArrayBuffer=Rd,e.getBBoxFromPoints=sx,e.getCullFace=kv,e.getDefaultDomain=Tv,e.getImage=Dd,e.getJSON=Id,e.getReferrer=Zm,e.getTileIndices=eS,e.getTileWarpXY=tS,e.getURLFromTemplate=wS,e.getWMTSURLFromTemplate=CS,e.gl=IP,e.guid=ux,e.isAndroid=Qm,e.isColor=function(e){return"string"==typeof e&&!!rv(e)},e.isImageBitmap=Ym,e.isMini=Sd,e.isMiniAli=bd,e.isPC=$m,e.isURLTemplate=function(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)},e.isWeChatMiniProgram=xd,e.isWorker=Xm,e.isiOS=Km,e.latitude=Yb,e.lazyInject=WL,e.lazyMultiInject=function(e){var t=HL.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lineAtOffset=_x,e.lineAtOffsetAsyc=function(e,t){return new Promise((function(n){e.inited?n(_x(e,t)):e.once("update",(function(){n(_x(e,t))}))}))},e.lineStyleType=rU,e.lngLatInExtent=Vb,e.lngLatToMeters=Hb,e.lnglatDistance=Qb,e.longitude=Wb,e.makeXMLHttpRequestPromise=Md,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/Ub*180,o=r/Ub*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]},e.miniWindow=Ed,e.normalize=tx,e.osmLonLat2TileXY=$x,e.osmTileXY2LonLat=function(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]},e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,s=e.stroke,u=e.strokeWidth,c=e.strokeOpacity,l=[],h=[],f=[],p=[JL(t[0],t[1]),JL(t[2],t[3])],d=[JL(s[0],s[1]),JL(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=E(e,2),s=t[0],v=t[1];l.push([].concat(p,[8388608*(s+1)+2097152*(v+1)+131072*$L(o)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,c])),f.push([a,0,0,0])})),{packedBuffer:l,packedBuffer2:h,packedBuffer3:f}},e.padBounds=$b,e.polygonFillTriangulation=$E,e.postData=function(e,t){return Pd(_(_({},e),{},{method:"POST"}),t)},e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=gv,e.sameOrigin=function(e){var t=Ad.document.createElement("a");return t.href=e,t.protocol===Ad.document.location.protocol&&t.host===Ad.document.location.host},e.setL7WorkerSource=iA,e.setMiniScene=_d,e.tileToBounds=Jx,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=E(e,2),o=i[0],a=i[1];return o=(o/(256<<20)-.5)/t,a=(a/(256<<20)-r)/n,a=2*(Math.atan(Math.pow(Math.E,a))-Math.PI/4),[o/(r=Math.PI/180),a/r]},e.validateLngLat=Xb,e.version="2.17.7",Object.defineProperty(e,"__esModule",{value:!0})}));
